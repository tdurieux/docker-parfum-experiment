{
  "startTime": 1674253190062,
  "endTime": 1674253190895,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 143
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 64,
        "lineEnd": 64,
        "columnStart": 7,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 18,
        "lineEnd": 41,
        "columnStart": 7,
        "columnEnd": 81
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 72,
        "lineEnd": 76,
        "columnStart": 22,
        "columnEnd": 40
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 18,
        "lineEnd": 41,
        "columnStart": 7,
        "columnEnd": 81
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 72,
        "lineEnd": 76,
        "columnStart": 22,
        "columnEnd": 40
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM registry.lil.tools/library/debian:11.3\nENV LANG=C.UTF-8 \\\n    LC_ALL=C.UTF-8 \\\n    PYTHONUNBUFFERED=1 \\\n    PIP_NO_CACHE_DIR=off \\\n    PIP_DISABLE_PIP_VERSION_CHECK=on \\\n    PIP_SRC=/usr/local/src \\\n    OPENSSL_CONF=/etc/ssl\nRUN mkdir -p /perma/perma_web\nWORKDIR /perma/perma_web\n\n# For fonts-roboto and ttf-mscorefonts-installer\nRUN echo \"deb http://deb.debian.org/debian bullseye main contrib\" > /etc/apt/sources.list \\\n    && echo \"deb https://deb.debian.org/debian-security bullseye-security main contrib\" >> /etc/apt/sources.list \\\n    && echo \"ttf-mscorefonts-installer msttcorefonts/accepted-mscorefonts-eula select true\" | debconf-set-selections\n\n# Get build dependencies and packages required by the app\nRUN apt-get update \\\n    && apt-get install --no-install-recommends -y \\\n        wget \\\n        curl \\\n        bzip2 \\\n        gnupg \\\n        python3-pip \\\n        python3-dev \\\n        python-is-python3 \\\n        virtualenv \\\n        git \\\n        nano \\\n        procps `# ps and pkill` \\\n\n        postgresql-client \\\n        libpq-dev \\\n        xvfb \\\n        libffi-dev \\\n        libjpeg62-turbo-dev \\\n        libfontconfig1 \\\n        imagemagick \\\n        libmagickwand-dev \\\n        ttf-mscorefonts-installer fonts-roboto `# commonly used web fonts for better screen shots` \\\n        libnss3-tools `# for certutil` \\\n        tor `# for optional use as a proxy` && rm -rf /var/lib/apt/lists/*;\n\n# Install a cert for use by warcprox\nCOPY perma_web/perma-warcprox-ca.pem /perma/perma_web\nRUN mkdir -p $HOME/.pki/nssdb \\\n    && certutil -d $HOME/.pki/nssdb -N --empty-password \\\n    && certutil -d sql:$HOME/.pki/nssdb -A -t \"C,,\" -n 'warcprox CA cert' -i perma-warcprox-ca.pem\n\n# pin node version -- see https://github.com/nodesource/distributions/issues/33\nRUN curl -f -o nodejs.deb https://deb.nodesource.com/node_14.x/pool/main/n/nodejs/nodejs_14.19.3-deb-1nodesource1_$(dpkg --print-architecture).deb \\\n    && dpkg -i ./nodejs.deb \\\n    && rm nodejs.deb\n\n# npm\nCOPY perma_web/package.json /perma/perma_web\nCOPY perma_web/npm-shrinkwrap.json /perma/perma_web\nRUN npm install \\\n    && rm package.json \\\n    && rm npm-shrinkwrap.json && npm cache clean --force;\n\n# python requirements\nCOPY perma_web/requirements.txt /perma/perma_web\nRUN pip install --no-cache-dir pip==22.0.4 \\\n    && pip install --no-cache-dir -r /perma/perma_web/requirements.txt \\\n    && rm /perma/perma_web/requirements.txt\n\n# Install Chromium and driver\nCOPY perma_web/lil-archive-keyring.gpg /usr/share/keyrings/lil-archive-keyring.gpg\nRUN echo \"deb [signed-by=/usr/share/keyrings/lil-archive-keyring.gpg] https://repo.lil.tools/ bullseye-security updates/main\" > /etc/apt/sources.list.d/lil-chromium.list\n\nENV CHROMIUM_VERSION=103.0.5060.53-1~deb11u1\nRUN apt-get update && apt-get install --no-install-recommends -y chromium=${CHROMIUM_VERSION} \\\n    chromium-common=${CHROMIUM_VERSION} \\\n    chromium-driver=${CHROMIUM_VERSION} \\\n    chromium-l10n=${CHROMIUM_VERSION} \\\n    chromium-sandbox=${CHROMIUM_VERSION} && rm -rf /var/lib/apt/lists/*;\n"
}