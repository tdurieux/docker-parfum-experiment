{
  "startTime": 1674254626393,
  "endTime": 1674254627541,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 104,
        "lineEnd": 104,
        "columnStart": 4,
        "columnEnd": 44
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ompzowe/zowecicd-node12-java8:v2.1 as builder\n\n# allow to customize which Zowe build to build from\n# There are 3 possible values:\n# 1. ZOWE_BUILD=: empty, which will try to find the local zowe.pax in same directory. The build has to be named as zowe.pax.\n# 2. ZOWE_BUILD=latest: will download the most recent official release and use it as base build\n# 3. ZOWE_BUILD=<url>: will download Zowe build from this url and use it as base build\nARG ZOWE_BUILD=\n\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n    ca-certificates curl wget \\\n    groff iproute2 moreutils pax && \\\n    rm -rf /var/lib/apt/lists/*\n\nEXPOSE 7553/tcp\nEXPOSE 7554/tcp\nEXPOSE 7556/tcp\n\n#ENV ZOWE_ZOSMF_HOST='zosmf.host.com'\n#ENV ZOWE_ZSS_HOST='zss.host.com'\n#ENV ZWED_agent_host='zwed.host.com'\nENV ZOWE_EXPLORER_HOST='localhost'\nENV ZOWE_IP_ADDRESS=0.0.0.0\n\nENV ZOWE_ZOSMF_PORT='443'\n#ENV ZWES_SERVER_PORT='00000'\n\n\nENV LAUNCH_COMPONENT_GROUPS=DESKTOP,GATEWAY\n\nRUN mkdir /home/zowe/utils && \\\n    mkdir /home/zowe/samples\nCOPY utils/ /home/zowe/utils/\nCOPY start.sh /home/zowe/samples/\nCOPY NOTICE.txt LICENSE.txt /home/zowe/\n\nRUN cd /home/zowe/utils/autoconv && \\\n    npm install && \\\n    npm run build && \\\n    rm -rf node_modules src samples *.js *.json .editorconfig *ignore *.md && \\\n    ln -s ./autoconv/bin/autoconv ../autoconv.sh && npm cache clean --force;\n\n# copy run.sh and optional zowe.pax\nCOPY run.sh run_inner.sh /home/zowe/\nCOPY zowe.pax* /tmp\n\n# download zowe build if specified\nRUN /home/zowe/utils/download-zowe-build.sh \"${ZOWE_BUILD}\"\n\n# 1. Convert content of pax files from ebcdic to ASCII\n# 2. replace or remove some zos specific parameters\n# 3. Install zowe, then remove installer files\nRUN mv /home/zowe/run_inner.sh /home/zowe/.run_inner.sh && \\\n    mkdir -p /tmp/zowe-install && cd /tmp/zowe-install && \\\n    tar -xvf ../zowe.pax --strip 1 && \\\n    find . -type f -iregex '.*\\.\\(rexx\\|js\\|sh\\|json\\|jcl\\|yaml\\|clist\\|env\\)$' -exec sh -c \"conv '{}' | sponge '{}'\" \\; && \\\n    find . -type f -name '*.sh' -exec sh -c \"sed -i 's/-Xquickstart//' {}\" \\; && \\\n    find . -type f -name '*.sh' -exec sh -c \"sed -i 's/-ppx/-pp/' {}\" \\; && \\\n    find . -type f -name '*.sh' -exec sh -c \"sed -i 's/iconv -f IBM-1047 -t IBM-850/cat/' {}\" \\; && \\\n    find . -type f -name '*.sh' -exec sh -c \"chmod +x {}\" \\; && \\\n    echo \"exit 0\" > scripts/opercmd && \\\n    sed -i 's/java version/openjdk version/' scripts/utils/validate-java.sh && \\\n    \\\n    \\\n    cd /tmp/zowe-install/files && \\\n    mv app-server-*.pax zlux && \\\n    for f in *.pax; do \\\n        echo \"Processing ebcdic pax $f\" && \\\n        cd /tmp/zowe-install/files &&\\\n        rm -rf tmp && \\\n        mkdir tmp && \\\n        cd tmp && \\\n        pax -rf ../$f && \\\n        rm ../$f && \\\n        find . -type f -iregex '.*\\.\\(rexx\\|js\\|sh\\|json\\|jcl\\|yaml\\|clist\\|html\\|template\\|css\\|svg\\|map\\|gz\\|env\\)$' -exec sh -c \"conv '{}' | sponge '{}'\" \\; && \\\n        find . -type f -name '*.sh' -exec sh -c \"sed -i 's/-Xquickstart//' {}\" \\; && \\\n        pax -wf ../$f . && \\\n        cd .. ;  \\\n    done && \\\n    rm -f zss*.pax && \\\n    cd zlux && \\\n    for f in *.pax; do \\\n        echo \"Processing tagged pax $f\" &&\\\n        cd /tmp/zowe-install/files/zlux &&\\\n        rm -rf tmp &&\\\n        mkdir tmp &&\\\n        cd tmp &&\\\n        pax -rf ../$f &&\\\n        rm ../$f &&\\\n        find . -type f -iregex '.*\\.\\(sh\\)$' -exec sh -c \"conv '{}' | sponge '{}'\" \\; && \\\n        find . -type f -name '*.sh' -exec sh -c \"sed -i 's/-Xquickstart//' {}\" \\; &&\\\n        find . -type f -name '*.sh' -exec sh -c \"sed -i 's/-px //' {}\" \\; && \\\n        pax -wf ../$f . &&\\\n        cd .. ; \\\n    done && \\\n    mv app-server-*.pax .. && \\\n    \\\n    \\\n    /tmp/zowe-install/install/zowe-install.sh -i /home/zowe/install -l /home/zowe/logs && \\\n  \tbash -c \"/home/zowe/install/bin/zowe-configure-instance.sh -c /home/zowe/instance\" && \\\n    \\\n    \\\n    cd /home/zowe/install/components/explorer-ui-server && \\\n    rm -rf node_modules && \\\n    npm install --only=prod --ignore-scripts && \\\n    cd /home/zowe/install/components && \\\n    find */bin -type f -name '*.sh' -exec sh -c \"sed -i 's/-Xquickstart//' {}\" \\; && npm cache clean --force;\n\n# Could be modified during runtime, back it up.\nRUN cp /home/zowe/instance/instance.env /home/zowe/instance/instance.env.bkp \\\n    && cp /home/zowe/install/bin/zowe-setup-certificates.env /home/zowe/install/bin/zowe-setup-certificates.env.bkp\n\nFROM ompzowe/zowecicd-node12-java8:v2.1\n\nEXPOSE 7553/tcp\nEXPOSE 7554/tcp\nEXPOSE 7556/tcp\n\n#ENV ZOWE_ZOSMF_HOST='zosmf.host.com'\n#ENV ZOWE_ZSS_HOST='zss.host.com'\n#ENV ZWED_agent_host='zwed.host.com'\nENV ZOWE_EXPLORER_HOST='localhost'\nENV ZOWE_IP_ADDRESS=0.0.0.0\n\nENV ZOWE_ZOSMF_PORT='443'\n#ENV ZWES_SERVER_PORT='00000'\nENV ZWED_agent_https_port='7557'\n\n# authorization needs to point to zss endpoint\nENV APIML_SECURITY_AUTHORIZATION_PROVIDER=endpoint\nENV APIML_SECURITY_AUTHORIZATION_ENDPOINT_ENABLED=true\n\nENV LAUNCH_COMPONENT_GROUPS=DESKTOP,GATEWAY\n\nCOPY --chown=zowe:zowe --from=builder /home/zowe /home/zowe\nRUN chmod a+x /home/zowe/*.sh /home/zowe/.run_inner.sh\n\nENTRYPOINT [\"/home/zowe/run.sh\"]\n"
}