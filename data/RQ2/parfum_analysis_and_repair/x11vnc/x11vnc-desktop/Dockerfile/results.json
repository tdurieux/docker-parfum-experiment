{
  "startTime": 1674254445005,
  "endTime": 1674254446547,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 76
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 119,
        "lineEnd": 119,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 103,
        "lineEnd": 103,
        "columnStart": 4,
        "columnEnd": 88
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 84,
        "lineEnd": 84,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 116,
        "lineEnd": 116,
        "columnStart": 4,
        "columnEnd": 74
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Builds a base Docker image for Ubuntu with X Windows and VNC support.\n#\n# The built image can be found at:\n#\n#   https://hub.docker.com/r/x11vnc/docker-desktop\n#\n# Authors:\n# Xiangmin Jiao <xmjiao@gmail.com>\n\nFROM ubuntu:22.04\nLABEL maintainer Xiangmin Jiao <xmjiao@gmail.com>\n\nARG DOCKER_LANG=en_US\nARG DOCKER_TIMEZONE=America/New_York\nARG X11VNC_VERSION=latest\n\nENV LANG=$DOCKER_LANG.UTF-8 \\\n    LANGUAGE=$DOCKER_LANG:UTF-8 \\\n    LC_ALL=$DOCKER_LANG.UTF-8\n\nWORKDIR /tmp\n\nARG DEBIAN_FRONTEND=noninteractive\n\n# Install some required system tools and packages for X Windows and ssh.\n# Also remove the message regarding unminimize.\n# Note that Ubuntu 22.04 uses snapd for firefox, which does not work properly,\n# so we install it from ppa:mozillateam/ppa instead.\nRUN apt-get update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \\\n        apt-utils \\\n        apt-file \\\n        locales \\\n        language-pack-en && \\\n    locale-gen $LANG && \\\n    dpkg-reconfigure -f noninteractive locales && \\\n    DEBIAN_FRONTEND=noninteractive apt-get install -y --no-install-recommends \\\n        curl \\\n        less \\\n        vim \\\n        psmisc \\\n        runit \\\n        apt-transport-https ca-certificates \\\n        software-properties-common \\\n        man \\\n        sudo \\\n        rsync \\\n        libarchive-tools \\\n        net-tools \\\n        gpg-agent \\\n        inetutils-ping \\\n        csh \\\n        tcsh \\\n        zsh zsh-autosuggestions \\\n        build-essential autoconf automake autotools-dev pkg-config \\\n        libssl-dev \\\n        git \\\n        dos2unix \\\n        dbus-x11 \\\n        \\\n        openssh-server \\\n        python3 \\\n        python3-distutils \\\n        python3-tk \\\n        python3-dbus \\\n        \\\n        xserver-xorg-video-dummy \\\n        lxde \\\n        x11-xserver-utils \\\n        xterm \\\n        gnome-themes-standard \\\n        gtk2-engines-pixbuf \\\n        gtk2-engines-murrine \\\n        libcanberra-gtk-module libcanberra-gtk3-module \\\n        fonts-liberation \\\n        xfonts-base xfonts-100dpi xfonts-75dpi xfonts-scalable xfonts-cyrillic \\\n        libopengl0 mesa-utils libglu1-mesa libgl1-mesa-dri libjpeg8 libjpeg62 \\\n        xauth xdg-utils \\\n        x11vnc && \\\n    chmod 755 /usr/local/share/zsh/site-functions && \\\n    add-apt-repository -y ppa:mozillateam/ppa && \\\n    echo 'Package: *' > /etc/apt/preferences.d/mozilla-firefox && \\\n    echo 'Pin: release o=LP-PPA-mozillateam' >> /etc/apt/preferences.d/mozilla-firefox && \\\n    echo 'Pin-Priority: 1001' >> /etc/apt/preferences.d/mozilla-firefox && \\\n    apt install --no-install-recommends -y firefox && \\\n    apt-get -y autoremove && \\\n    ssh-keygen -A && \\\n    ln -s -f /lib64/ld-linux-x86-64.so.2 /lib64/ld-lsb-x86-64.so && \\\n    perl -p -i -e 's/#?X11Forwarding\\s+\\w+/X11Forwarding yes/g; \\\n        s/#?X11UseLocalhost\\s+\\w+/X11UseLocalhost no/g; \\\n        s/#?PasswordAuthentication\\s+\\w+/PasswordAuthentication no/g; \\\n        s/#?PermitEmptyPasswords\\s+\\w+/PermitEmptyPasswords no/g' \\\n        /etc/ssh/sshd_config && \\\n    rm -f /etc/update-motd.d/??-unminimize && \\\n    rm -f /etc/xdg/autostart/lxpolkit.desktop && \\\n    chmod a-x /usr/bin/lxpolkit && \\\n    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\n# Install websokify and noVNC\nRUN curl -f -O https://bootstrap.pypa.io/get-pip.py && \\\n    python3 get-pip.py && \\\n    pip3 install --no-cache-dir \\\n        setuptools && \\\n    pip3 install --no-cache-dir -U https://github.com/novnc/websockify/archive/refs/tags/v0.10.0.tar.gz && \\\n    mkdir /usr/local/noVNC && \\\n    curl -f -s -L https://github.com/x11vnc/noVNC/archive/refs/heads/x11vnc.zip | \\\n          bsdtar zxf - -C /usr/local/noVNC --strip-components 1 && \\\n    (chmod a+x /usr/local/noVNC/utils/launch.sh || \\\n        (chmod a+x /usr/local/noVNC/utils/novnc_proxy && \\\n         ln -s -f /usr/local/noVNC/utils/novnc_proxy /usr/local/noVNC/utils/launch.sh)) && \\\n    rm -rf /tmp/* /var/tmp/*\n\n# Install latest version of x11vnc from source\n# Also, fix issue with Shift-Tab not working\n# https://askubuntu.com/questions/839842/vnc-pressing-shift-tab-tab-only\nRUN apt-get update && \\\n    apt-get install --no-install-recommends -y libxtst-dev libssl-dev libvncserver-dev libjpeg-dev && \\\n\n    mkdir -p /tmp/x11vnc-${X11VNC_VERSION} && \\\n    curl -f -s -L https://github.com/LibVNC/x11vnc/archive/refs/heads/master.zip | \\\n        bsdtar zxf - -C /tmp/x11vnc-${X11VNC_VERSION} --strip-components 1 && \\\n    cd /tmp/x11vnc-${X11VNC_VERSION} && \\\n    bash autogen.sh --prefix=/usr/local CFLAGS='-O2 -fno-common -fno-stack-protector' && \\\n    make && \\\n    make install && \\\n    perl -e 's/,\\s*ISO_Left_Tab//g' -p -i /usr/share/X11/xkb/symbols/pc && \\\n    apt-get -y remove libxtst-dev libssl-dev libvncserver-dev libjpeg-dev && \\\n    apt-get -y autoremove && \\\n    ldconfig && \\\n    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\n########################################################\n# Customization for user and location\n########################################################\n# Set up user so that we do not run as root in DOCKER\nENV DOCKER_USER=ubuntu \\\n    DOCKER_UID=9999 \\\n    DOCKER_GID=9999 \\\n    DOCKER_SHELL=/bin/zsh\n\nENV DOCKER_GROUP=$DOCKER_USER \\\n    DOCKER_HOME=/home/$DOCKER_USER \\\n    SHELL=$DOCKER_SHELL\n\n\n# Change the default timezone to $DOCKER_TIMEZONE\n# Run ldconfig so that /usr/local/lib etc. are in the default\n# search path for dynamic linker\nRUN groupadd -g $DOCKER_GID $DOCKER_GROUP && \\\n    useradd -m -u $DOCKER_UID -g $DOCKER_GID -s $DOCKER_SHELL -G sudo $DOCKER_USER && \\\n    echo \"$DOCKER_USER:\"`openssl rand -base64 12` | chpasswd && \\\n    echo \"$DOCKER_USER ALL=(ALL) NOPASSWD: ALL\" >> /etc/sudoers && \\\n    echo \"$DOCKER_TIMEZONE\" > /etc/timezone && \\\n    ln -s -f /usr/share/zoneinfo/$DOCKER_TIMEZONE /etc/localtime\n\nADD image/etc /etc\nADD image/usr /usr\nADD image/sbin /sbin\nADD image/home $DOCKER_HOME\n\n# Make home directory readable to work with Singularity\nRUN mkdir -p $DOCKER_HOME/.config/mozilla && \\\n    ln -s -f .config/mozilla $DOCKER_HOME/.mozilla && \\\n    touch $DOCKER_HOME/.sudo_as_admin_successful && \\\n    mkdir -p $DOCKER_HOME/shared && \\\n    mkdir -p $DOCKER_HOME/.ssh && \\\n    mkdir -p $DOCKER_HOME/.log && touch $DOCKER_HOME/.log/vnc.log && \\\n    chown -R $DOCKER_USER:$DOCKER_GROUP $DOCKER_HOME && \\\n    chmod -R a+r $DOCKER_HOME && \\\n    find $DOCKER_HOME -type d -exec chmod a+x {} \\;\n\nWORKDIR $DOCKER_HOME\n\nENV DOCKER_CMD=start_vnc\n\nUSER root\nENTRYPOINT [\"/sbin/my_init\", \"--\", \"/sbin/setuser\", \"ubuntu\"]\nCMD [\"$DOCKER_CMD\"]\n"
}