{
  "startTime": 1674249649882,
  "endTime": 1674249650565,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 38,
        "lineEnd": 52,
        "columnStart": 7,
        "columnEnd": 12
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#  Licensed to the Apache Software Foundation (ASF) under one\n#  or more contributor license agreements.  See the NOTICE file\n#  distributed with this work for additional information\n#  regarding copyright ownership.  The ASF licenses this file\n#  to you under the Apache License, Version 2.0 (the\n#  \"License\"); you may not use this file except in compliance\n#  with the License.  You may obtain a copy of the License at\n#\n#      http://www.apache.org/licenses/LICENSE-2.0\n#\n#  Unless required by applicable law or agreed to in writing, software\n#  distributed under the License is distributed on an \"AS IS\" BASIS,\n#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#  See the License for the specific language governing permissions and\n# limitations under the License.\n\n\n## Presto docker setup is based on https://github.com/smizy/docker-presto\n\nARG HADOOP_VERSION=2.8.4\nARG HIVE_VERSION=2.3.3\nFROM apachehudi/hudi-hadoop_${HADOOP_VERSION}-base:latest as hadoop-base\n\nARG PRESTO_VERSION=0.271\n\nENV PRESTO_VERSION       ${PRESTO_VERSION}\nENV PRESTO_HOME          /opt/presto-server-${PRESTO_VERSION}\nENV PRESTO_CONF_DIR      ${PRESTO_HOME}/etc\nENV PRESTO_LOG_DIR       /var/log/presto\nENV PRESTO_JVM_MAX_HEAP  2G\nENV PRESTO_QUERY_MAX_MEMORY          1GB\nENV PRESTO_QUERY_MAX_MEMORY_PER_NODE 512MB\nENV PRESTO_DISCOVERY_URI  http://presto-coordinator-1:8090\nENV PATH        $PATH:${PRESTO_HOME}/bin\n\nRUN set -x \\\n    && DEBIAN_FRONTEND=noninteractive apt-get -yq update \\\n    && apt-get -yq --no-install-recommends install \\\n        bash \\\n        less \\\n        python \\\n        tar \\\n        wget \\\n    ## - hadoop native dependency lib\n        bzip2 \\\n        fts \\\n        fuse \\\n        libtirpc1 \\\n        libsnappy1v5 \\\n        zip \\\n        cron \\\n        gosu \\\n    && rm -rf /var/lib/apt/lists/* \\\n    ## presto-server\n    && wget -q -O - https://repo1.maven.org/maven2/com/facebook/presto/presto-server/${PRESTO_VERSION}/presto-server-${PRESTO_VERSION}.tar.gz \\\n        | tar -xzf - -C /opt/ \\\n    && mkdir -p /var/hoodie/ws/docker/hoodie/hadoop/prestobase/target/ \\\n    ## presto-client\n    && wget -q -O /usr/local/bin/presto https://repo1.maven.org/maven2/com/facebook/presto/presto-cli/${PRESTO_VERSION}/presto-cli-${PRESTO_VERSION}-executable.jar \\\n    && chmod +x /usr/local/bin/presto \\\n    ## user/dir/permmsion\n    && adduser --shell /sbin/nologin --uid 1000 docker \\\n    && adduser --shell /sbin/nologin presto \\\n    && mkdir -p \\\n        ${PRESTO_CONF_DIR} \\\n        ${PRESTO_LOG_DIR} \\\n    && chmod -R 777 \\\n        ${PRESTO_HOME} \\\n        ${PRESTO_LOG_DIR} \\\n    ## cleanup\n    && rm -rf /tmp/nativelib\n\nCOPY etc/  ${PRESTO_CONF_DIR}/\nCOPY bin/*  /usr/local/bin/\nCOPY lib/*  /usr/local/lib/\nRUN chmod +x /usr/local/bin/entrypoint.sh\n\nADD target/ /var/hoodie/ws/docker/hoodie/hadoop/prestobase/target/\nENV HUDI_PRESTO_BUNDLE /var/hoodie/ws/docker/hoodie/hadoop/prestobase/target/hudi-presto-bundle.jar\nRUN  cp ${HUDI_PRESTO_BUNDLE} ${PRESTO_HOME}/plugin/hive-hadoop2/\n# TODO: the latest master of Presto relies on hudi-presto-bundle, while current Presto releases\n# rely on hudi-common and hudi-hadoop-mr 0.9.0, which are pulled in plugin/hive-hadoop2/ in the\n# docker setup, making it hard to test the latest changes in Hudi due to class conflict.\n# To get around the conflicts due to older Hudi jars below, they are removed for integration tests,\n# so the hudi-presto-bundle build can be used solely for testing.  This temporary logic must be\n# removed once Presto has a new release depending on hudi-presto-bundle and we upgrade docker setup\n# to that release version.\nRUN rm ${PRESTO_HOME}/plugin/hive-hadoop2/hudi-common-*\nRUN rm ${PRESTO_HOME}/plugin/hive-hadoop2/hudi-hadoop-mr-*\n\nVOLUME [\"${PRESTO_LOG_DIR}\"]\n\nWORKDIR ${PRESTO_HOME}\n\nENTRYPOINT [\"entrypoint.sh\"]\n"
}