{
  "startTime": 1674215207183,
  "endTime": 1674215207874,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 68,
        "lineEnd": 68,
        "columnStart": 4,
        "columnEnd": 30
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# Licensed to the Apache Software Foundation (ASF) under one\n# or more contributor license agreements.  See the NOTICE file\n# distributed with this work for additional information\n# regarding copyright ownership.  The ASF licenses this file\n# to you under the Apache License, Version 2.0 (the\n# \"License\"); you may not use this file except in compliance\n# with the License.  You may obtain a copy of the License at\n#\n#   http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing,\n# software distributed under the License is distributed on an\n# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n# KIND, either express or implied.  See the License for the\n# specific language governing permissions and limitations\n# under the License.\n#\n\n# First create a stage with just the Pulsar tarball and scripts\nFROM busybox as pulsar\n\nARG PULSAR_TARBALL\n\nADD ${PULSAR_TARBALL} /\nRUN mv /apache-pulsar-* /pulsar\n\nCOPY scripts/apply-config-from-env.py /pulsar/bin\nCOPY scripts/apply-config-from-env-with-prefix.py /pulsar/bin\nCOPY scripts/gen-yml-from-env.py /pulsar/bin\nCOPY scripts/generate-zookeeper-config.sh /pulsar/bin\nCOPY scripts/pulsar-zookeeper-ruok.sh /pulsar/bin\nCOPY scripts/watch-znode.py /pulsar/bin\nCOPY scripts/install-pulsar-client.sh /pulsar/bin\n\n# The final image needs to give the root group sufficient permission for Pulsar components\n# to write to specific directories within /pulsar\n# The file permissions are preserved when copying files from this builder image to the target image.\nRUN for SUBDIRECTORY in conf data download logs; do \\\n     [ -d /pulsar/$SUBDIRECTORY ] || mkdir /pulsar/$SUBDIRECTORY; \\\n     chmod -R g+w /pulsar/$SUBDIRECTORY; \\\n     done\n\n# Presto writes logs to this directory (at least during tests), so we need to give the process permission\n# to create those log directories. This should be removed when presto is removed.\nRUN chmod g+w /pulsar/lib/presto\n\n### Create 2nd stage from Ubuntu image\n### and add OpenJDK and Python dependencies (for Pulsar functions)\n\nFROM ubuntu:20.04\n\nARG DEBIAN_FRONTEND=noninteractive\nARG UBUNTU_MIRROR=mirror://mirrors.ubuntu.com/mirrors.txt\n\n# Install some utilities\nRUN sed -i \"s|http://archive\\.ubuntu\\.com/ubuntu/|${UBUNTU_MIRROR:-mirror://mirrors.ubuntu.com/mirrors.txt}|g\" /etc/apt/sources.list \\\n     && echo 'Acquire::http::Timeout \"30\";\\nAcquire::ftp::Timeout \"30\";\\nAcquire::Retries \"3\";' > /etc/apt/apt.conf.d/99timeout_and_retries \\\n     && apt-get update \\\n     && apt-get -y dist-upgrade \\\n     && apt-get -y install --no-install-recommends openjdk-17-jdk-headless netcat dnsutils less procps iputils-ping \\\n                 python3 python3-kazoo python3-pip \\\n                 curl ca-certificates \\\n     && apt-get -y --purge autoremove \\\n     && apt-get autoclean \\\n     && apt-get clean \\\n     && rm -rf /var/lib/apt/lists/*\n\nRUN pip3 install --no-cache-dir pyyaml==5.4.1\n\n# Pulsar currently writes to the below directories, assuming the default configuration.\n# Note that number 4 is the reason that pulsar components need write access to the /pulsar directory.\n# 1. /pulsar/data - both bookkeepers and zookeepers use this directory\n# 2. /pulsar/logs - function workers write to this directory and pulsar-admin initializes this directory\n# 3. /pulsar/download - functions write to this directory\n# 4. /pulsar - hadoop writes to this directory\nRUN mkdir /pulsar && chmod g+w /pulsar\n\nENV JAVA_HOME /usr/lib/jvm/java-17-openjdk-amd64\nRUN echo networkaddress.cache.ttl=1 >> /usr/lib/jvm/java-17-openjdk-amd64/conf/security/java.security\nADD target/python-client/ /pulsar/pulsar-client\n\nENV PULSAR_ROOT_LOGGER=INFO,CONSOLE\n\n\nCOPY --from=pulsar /pulsar /pulsar\nWORKDIR /pulsar\n\n# This script is intentionally run as the root user to make the dependencies available for all UIDs.\nRUN /pulsar/bin/install-pulsar-client.sh\n\n# The UID must be non-zero. Otherwise, it is arbitrary. No logic should rely on its specific value.\nUSER 10000\n"
}