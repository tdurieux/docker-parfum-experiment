{
  "startTime": 1674253849546,
  "endTime": 1674253850276,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 45,
        "lineEnd": 45,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 68,
        "lineEnd": 70,
        "columnStart": 4,
        "columnEnd": 5
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n# use this file except in compliance with the License. You may obtain a copy of\n# the License at\n#\n#   http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n# License for the specific language governing permissions and limitations under\n# the License.\n\nFROM debian:buster-slim\n\nLABEL maintainer=\"CouchDB Developers dev@couchdb.apache.org\"\n\n# Add CouchDB user account to make sure the IDs are assigned consistently\nRUN groupadd -g 5984 -r couchdb && useradd -u 5984 -d /opt/couchdb -g couchdb couchdb\n\n# be sure GPG and apt-transport-https are available and functional\nRUN set -ex; \\\n    apt-get update; \\\n    apt-get install -y --no-install-recommends \\\n        apt-transport-https \\\n        ca-certificates \\\n        dirmngr \\\n        gnupg \\\n     ; \\\n    rm -rf /var/lib/apt/lists/*\n\n# grab gosu for easy step-down from root and tini for signal handling and zombie reaping\n# see https://github.com/apache/couchdb-docker/pull/28#discussion_r141112407\nRUN set -eux; \\\n    apt-get update; \\\n    apt-get install -y --no-install-recommends gosu tini; \\\n    rm -rf /var/lib/apt/lists/*; \\\n    gosu nobody true; \\\n    tini --version\n\n# http://docs.couchdb.org/en/latest/install/unix.html#installing-the-apache-couchdb-packages\nENV GPG_COUCH_KEY \\\n# gpg: rsa8192 205-01-19 The Apache Software Foundation (Package repository signing key) <root@apache.org>\n    390EF70BB1EA12B2773962950EE62FB37A00258D\nRUN set -eux; \\\n    apt-get update; \\\n    apt-get install --no-install-recommends -y curl; \\\n    export GNUPGHOME=\"$(mktemp -d)\"; \\\n    curl -fL -o keys.asc https://couchdb.apache.org/repo/keys.asc; \\\n    gpg --batch --import keys.asc; \\\n    gpg --batch --export \"${GPG_COUCH_KEY}\" > /usr/share/keyrings/couchdb-archive-keyring.gpg; \\\n    command -v gpgconf && gpgconf --kill all || :; \\\n    rm -rf \"$GNUPGHOME\"; \\\n    apt-key list; \\\n    apt purge -y --autoremove curl; \\\n    rm -rf /var/lib/apt/lists/*\n\nENV COUCHDB_VERSION 2.3.1-1\n\nRUN . /etc/os-release; \\\n    echo \"deb [signed-by=/usr/share/keyrings/couchdb-archive-keyring.gpg] https://apache.jfrog.io/artifactory/couchdb-deb/ ${VERSION_CODENAME} main\" | \\\n        tee /etc/apt/sources.list.d/couchdb.list >/dev/null\n\n# https://github.com/apache/couchdb-pkg/blob/master/debian/README.Debian\nRUN set -eux; \\\n    apt-get update; \\\n\n    echo \"couchdb couchdb/mode select none\" | debconf-set-selections; \\\n# we DO want recommends this time\n    DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends install -y --allow-downgrades --allow-remove-essential --allow-change-held-packages \\\n            couchdb=\"$COUCHDB_VERSION\"~buster \\\n    ; \\\n# Undo symlinks to /var/log and /var/lib\n    rmdir /var/lib/couchdb /var/log/couchdb; \\\n    rm /opt/couchdb/data /opt/couchdb/var/log; \\\n    mkdir -p /opt/couchdb/data /opt/couchdb/var/log; \\\n    chown couchdb:couchdb /opt/couchdb/data /opt/couchdb/var/log; \\\n    chmod 777 /opt/couchdb/data /opt/couchdb/var/log; \\\n# Remove file that sets logging to a file\n    rm /opt/couchdb/etc/default.d/10-filelog.ini; \\\n# Check we own everything in /opt/couchdb. Matches the command in dockerfile_entrypoint.sh\n    find /opt/couchdb \\! \\( -user couchdb -group couchdb \\) -exec chown -f couchdb:couchdb '{}' +; \\\n# Setup directories and permissions for config. Technically these could be 555 and 444 respectively\n# but we keep them as 755 and 644 for consistency with CouchDB defaults and the dockerfile_entrypoint.sh.\n    find /opt/couchdb/etc -type d ! -perm 0755 -exec chmod -f 0755 '{}' +; \\\n    find /opt/couchdb/etc -type f ! -perm 0644 -exec chmod -f 0644 '{}' +; \\\n# only local.d needs to be writable for the docker_entrypoint.sh\n    chmod -f 0777 /opt/couchdb/etc/local.d; \\\n# apt clean-up\n    rm -rf /var/lib/apt/lists/*;\n\n# Add configuration\nCOPY --chown=couchdb:couchdb 10-docker-default.ini /opt/couchdb/etc/default.d/\nCOPY --chown=couchdb:couchdb vm.args /opt/couchdb/etc/\n\nCOPY docker-entrypoint.sh /usr/local/bin\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh # backwards compat\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\n\nVOLUME /opt/couchdb/data\n\n# 5984: Main CouchDB endpoint\n# 4369: Erlang portmap daemon (epmd)\n# 9100: CouchDB cluster communication port\nEXPOSE 5984 4369 9100\nCMD [\"/opt/couchdb/bin/couchdb\"]\n"
}