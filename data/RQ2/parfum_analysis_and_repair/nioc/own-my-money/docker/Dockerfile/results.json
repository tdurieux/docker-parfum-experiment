{
  "startTime": 1674254540235,
  "endTime": 1674254540825,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 108
      }
    },
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 4,
        "columnEnd": 15
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# This dockerfile build VueJS GUI and serve both PHP API and static files with Apache.\n\n# Build image: `docker build -f Dockerfile --build-arg VERSION=$VERSION --build-arg GIT_COMMIT=$(git log -1 --format=%h) --build-arg BUILD_DATE=$(date -u +'%Y-%m-%dT%H:%M:%SZ') -t nioc/own-my-money:latest ../`\n# Start image (see the wiki for environment variables): `docker run -d -p 80:80 --rm --name own-my-money-1 nioc/own-my-money:latest`\n\n# VueJS GUI build stage\nFROM node:lts-alpine as build-stage\n\n# Install app dependencies\nRUN apk add --no-cache git\nWORKDIR /app\nCOPY money-front-vue/package*.json ./\nRUN npm install && npm cache clean --force;\n\n# Copy src files (exluding files defined in .dockerignore)\nCOPY money-front-vue/. .\nCOPY .git/. .\n\n# Build VueJS app\nRUN npm run build\n\n\n# Production stage\nFROM php:7.4-apache as production-stage\n\n# Install PHP modules\nRUN apt-get update && \\\n    apt-get install --no-install-recommends -y libicu-dev libcurl4-openssl-dev libxml2-dev zlib1g-dev libpng-dev libjpeg62-turbo-dev && \\\n    docker-php-ext-configure gd --with-jpeg && \\\n    docker-php-ext-install gd intl pdo pdo_mysql curl xml exif && \\\n    docker-php-ext-configure intl && \\\n    apt-get clean && \\\n    rm -rf /var/lib/apt/lists/*\n\nEXPOSE 80\n\n# Copy Apache & PHP conf\nWORKDIR /var/www/own-my-money\nCOPY docker/vhost-001-money.conf /etc/apache2/sites-available/001-money.conf\nCOPY docker/apache.conf /etc/apache2/conf-available/custom.conf\nCOPY docker/docker-entrypoint.sh /docker-entrypoint.sh\nCOPY docker/php.ini /usr/local/etc/php/php.ini\n\n# Enable Apache modules & site\nRUN a2enmod headers rewrite && \\\n    a2dissite 000-default && \\\n    a2ensite 001-money\n\n# Copy PHP scripts\nCOPY server /var/www/own-my-money/server\nRUN sed -i \"s|containerized = 0|containerized = 1|g\" /var/www/own-my-money/server/configuration/configuration.ini\n\n# Copy VueJS GUI files\nCOPY --from=build-stage /app/dist /var/www/own-my-money/front\n\n# Set ownership to Apache user\nRUN chown www-data /var/www/own-my-money/ -RL\n\n# Set default environment variables\nENV OMM_BASE_URI=http://localhost\nENV OMM_DB_HOST=\nENV OMM_DB_USER=\nENV OMM_DB_PWD=\nENV OMM_DB_NAME=\nENV OMM_MAILER=\nENV OMM_MAIL_SENDER=\nENV OMM_HASH_KEY=\nENV OMM_SETUP=\n\n# Tag image\nARG GIT_COMMIT=unspecified\nARG BUILD_DATE\nARG VERSION=unspecified\nLABEL org.label-schema.name=\"own-my-money\"\nLABEL org.label-schema.vendor=\"nioc\"\nLABEL org.label-schema.license=\"AGPL-3.0-or-later\"\nLABEL org.label-schema.vcs-url=\"https://github.com/nioc/own-my-money\"\nLABEL org.label-schema.vcs-ref=$GIT_COMMIT\nLABEL org.label-schema.build-date=$BUILD_DATE\nLABEL org.label-schema.version=$VERSION\nLABEL maintainer=\"nioc <dev@nioc.eu>\"\n\n# Update config at runtime and start Apache\nENTRYPOINT [\"bash\", \"/docker-entrypoint.sh\"]\nCMD [\"apache2-foreground\"]\n"
}