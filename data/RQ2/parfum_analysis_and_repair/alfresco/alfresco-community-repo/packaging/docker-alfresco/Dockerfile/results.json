{
  "startTime": 1674216673300,
  "endTime": 1674216674220,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 67,
        "lineEnd": 72,
        "columnStart": 4,
        "columnEnd": 47
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Fetch image based on Tomcat 9.0, Java 11 and Centos 7\n# More infos about this image: https://github.com/Alfresco/alfresco-docker-base-tomcat\nFROM alfresco/alfresco-base-tomcat:tomcat9-jre11-centos7-202203091924\n\n# Set default docker_context.\nARG resource_path=target\n\n# Set default user information\nARG GROUPNAME=Alfresco\nARG GROUPID=1000\nARG IMAGEUSERNAME=alfresco\nARG USERID=33000\n\n# Set default environment args\nARG TOMCAT_DIR=/usr/local/tomcat\n\n\n# Create prerequisite to store tools and properties\nRUN mkdir -p ${TOMCAT_DIR}/shared/classes/alfresco/extension/mimetypes && \\\n    mkdir -p ${TOMCAT_DIR}/shared/classes/alfresco/extension/transform/renditions && \\\n    mkdir -p ${TOMCAT_DIR}/shared/classes/alfresco/extension/transform/pipelines && \\\n    mkdir /licenses && \\\n    mkdir -p ${TOMCAT_DIR}/shared/classes/alfresco/extension/keystore && \\\n    mkdir ${TOMCAT_DIR}/alfresco-mmt && \\\n    touch ${TOMCAT_DIR}/shared/classes/alfresco-global.properties\n\n# You need to run `mvn clean install` in the root of this project to update the following dependencies\n# Copy the WAR files to the appropriate location for your application server\n# Copy the JDBC drivers for the database you are using to the lib/ directory.\n# Copy the alfresco-mmt.jar\n# Copy Licenses to the root of the Docker image\n# Copy default keystore\nCOPY ${resource_path}/war ${TOMCAT_DIR}/webapps\nCOPY ${resource_path}/connector/* ${TOMCAT_DIR}/lib/\nCOPY ${resource_path}/alfresco-mmt/* ${TOMCAT_DIR}/alfresco-mmt/\nCOPY ${resource_path}/dependency/licenses/ /licenses/\nCOPY ${resource_path}/dependency/keystore/metadata-keystore/keystore ${TOMCAT_DIR}/shared/classes/alfresco/extension/keystore\n\n# Change the value of the shared.loader= property to the following:\n# shared.loader=${catalina.base}/shared/classes\nRUN sed -i \"s/shared.loader=/shared.loader=\\${catalina.base}\\/shared\\/classes/\" ${TOMCAT_DIR}/conf/catalina.properties\n\nRUN mkdir -p ${TOMCAT_DIR}/amps\n\n#RUN echo -e '\\n\\\n#log4j.logger.org.alfresco.repo.content.transform.TransformerDebug=debug\\n\\\n#' >> ${TOMCAT_DIR}/shared/classes/alfresco/extension/custom-log4j.propertiesRUN mkdir -p ${TOMCAT_DIR}/amps\n\n# Copy the amps from build context to the appropriate location for your application server\nCOPY ${resource_path}/amps ${TOMCAT_DIR}/amps\n\n# Install amps on alfresco.war\nRUN java -jar ${TOMCAT_DIR}/alfresco-mmt/alfresco-mmt*.jar install \\\n              ${TOMCAT_DIR}/amps \\\n              ${TOMCAT_DIR}/webapps/alfresco -directory -nobackup\n\n# Move the log file\nRUN sed -i -e \"s_log4j.appender.File.File\\=alfresco.log_log4j.appender.File.File\\=${TOMCAT_DIR}/logs\\/alfresco.log_\" \\\n        ${TOMCAT_DIR}/webapps/alfresco/WEB-INF/classes/log4j.properties && \\\n\n# Add catalina.policy to ROOT.war and alfresco.war\n# Grant all security permissions to alfresco webapp because of numerous permissions required in order to work properly.\n# Grant only deployXmlPermission to ROOT webapp.\n    sed -i -e \"\\$a\\grant\\ codeBase\\ \\\"file:\\$\\{catalina.base\\}\\/webapps\\/alfresco\\/-\\\" \\{\\n\\    permission\\ java.security.AllPermission\\;\\n\\};\\ngrant\\ codeBase\\ \\\"file:\\$\\{catalina.base\\}\\/webapps\\/ROOT\\/-\\\" \\{\\n\\    permission org.apache.catalina.security.DeployXmlPermission \\\"ROOT\\\";\\n\\};\" ${TOMCAT_DIR}/conf/catalina.policy\n\n# fontconfig is required by Activiti worflow diagram generator\n# installing pinned dependencies as well\nRUN yum install -y fontconfig-2.13.0-4.3.el7 \\\n                   dejavu-fonts-common-2.33-6.el7 \\\n                   fontpackages-filesystem-1.44-8.el7 \\\n                   freetype-2.8-14.el7_9.1 \\\n                   libpng-1.5.13-8.el7 \\\n                   dejavu-sans-fonts-2.33-6.el7 && \\\n    yum clean all && rm -rf /var/cache/yum\n\n# The standard configuration is to have all Tomcat files owned by root with group GROUPNAME and whilst owner has read/write privileges,\n# group only has restricted permissions and world has no permissions.\nRUN mkdir -p ${TOMCAT_DIR}/conf/Catalina/localhost && \\\n    mkdir -p ${TOMCAT_DIR}/alf_data && \\\n    groupadd -g ${GROUPID} ${GROUPNAME} && \\\n    useradd -u ${USERID} -G ${GROUPNAME} ${IMAGEUSERNAME} && \\\n    chgrp -R ${GROUPNAME} ${TOMCAT_DIR} && \\\n    chmod g+rx ${TOMCAT_DIR}/conf && \\\n    chmod -R g+r ${TOMCAT_DIR}/conf && \\\n    find ${TOMCAT_DIR}/webapps -type d -exec chmod 0750 {} \\; && \\\n    find ${TOMCAT_DIR}/webapps -type f -exec chmod 0640 {} \\; && \\\n    chmod -R g+r ${TOMCAT_DIR}/webapps && \\\n    chmod g+r ${TOMCAT_DIR}/conf/Catalina && \\\n    chmod g+rwx ${TOMCAT_DIR}/alf_data && \\\n    chmod g+rwx ${TOMCAT_DIR}/logs && \\\n    chmod o-w ${TOMCAT_DIR}/logs && \\\n    chmod g+rwx ${TOMCAT_DIR}/temp && \\\n    chmod g+rwx ${TOMCAT_DIR}/work && \\\n    chmod o-w ${TOMCAT_DIR}/work && \\\n    chmod 664 ${TOMCAT_DIR}/alfresco-mmt/alfresco-mmt-*.jar && \\\n    find /licenses -type d -exec chmod 0755 {} \\; && \\\n    find /licenses -type f -exec chmod 0644 {} \\;\n\nEXPOSE 10001\n\n# For remote debug\nEXPOSE 8000\n\nUSER ${IMAGEUSERNAME}"
}