{
  "startTime": 1674249853980,
  "endTime": 1674249855186,
  "originalSmells": [
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 87,
        "lineEnd": 87,
        "columnStart": 25,
        "columnEnd": 75
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# GenericOS - Main Docker Image\n#\n# Build steps:\n# - `docker build --pull -t dfinity/genericos-main -f Dockerfile .`\n#\n# First build stage:\n# - Construct the actual target image (IC-OS root filesystem)\n#\n# Update below image when new dfinity/genericos-base image gets produced (see deploy-guest-os-baseimg CI job on master/rc).\nFROM dfinity/genericos-base@sha256:64d13fcf6b26ae33a187477fb2f0d25ae53e5ad859c088bfeab01dc70107463e\n\nRUN mkdir -p /boot/{efi,grub}\n\nCOPY /etc /etc\nCOPY /opt /opt\n\n# Update POSIX permissions in /etc/\nRUN find /etc -type d -exec chmod 0755 {} \\+ && \\\n    find /etc -type f -not -path \"/etc/hostname\" -not -path \"/etc/hosts\" -not -path \"/etc/resolv.conf\" -exec chmod 0644 {} \\+\n\n# Regenerate initramfs (config changed after copying in /etc)\nRUN RESUME=none SOURCE_DATE_EPOCH=0 update-initramfs -c -k all\n\nARG ROOT_PASSWORD=\nRUN if [ \"${ROOT_PASSWORD}\" != \"\" ]; then echo \"root:${ROOT_PASSWORD}\" | chpasswd ; fi\n\n# Delete generated ssh keys, otherwise every host will have the same key pair.\n# They will be generated on first boot.\nRUN rm /etc/ssh/ssh*key*\n# Allow root login only via keys. In prod deployments there are never any\n# keys set up for root, but in dev deployments there may be.\n# Actually, prohibit-password is the default config, so would not be\n# strictly necessary to be explicit here.\nRUN sed -e \"s/.*PermitRootLogin.*/PermitRootLogin prohibit-password/\" -i /etc/ssh/sshd_config\n\n# Mount points for config storage.\nRUN mkdir -p /var/lib/ic/data\n\nRUN \\\n    for SERVICE in /etc/systemd/system/*; do \\\n        if [ -f \"$SERVICE\" -a ! -L \"$SERVICE\" ] ; then systemctl enable \"${SERVICE#/etc/systemd/system/}\" ; fi ; \\\n    done\n\nRUN systemctl enable \\\n    chrony \\\n    nftables \\\n    systemd-networkd \\\n    systemd-networkd-wait-online \\\n    systemd-resolved \\\n    systemd-journal-gatewayd\n\n# User which will run the dfinity boundary node service.\nRUN adduser --system --disabled-password --home /var/lib/ic --no-create-home dfinity\n\n# Group accounts to which parts of the runtime state are assigned such that\n# user accounts can be granted individual access rights.\n# Note that a group \"backup\" already exists and is used for the purpose of\n# allowing backup read access.\nRUN addgroup --system nonconfidential && \\\n    addgroup --system confidential && \\\n    addgroup --system vsock\n\n# The \"read-only\" user account. May read everything besides crypto.\nRUN adduser --system --disabled-password --home /var/lib/readonly --shell /bin/bash readonly && \\\n    adduser readonly backup && \\\n    adduser readonly nonconfidential && \\\n    adduser readonly systemd-journal\n\n# The omnipotent \"admin\" account. May read everything and crucially can also\n# arbitrarily change system state via sudo.\nRUN adduser --system --disabled-password --home /var/lib/admin --shell /bin/bash admin && \\\n    chown admin:staff /var/lib/admin && \\\n    adduser admin backup && \\\n    adduser admin nonconfidential && \\\n    adduser admin systemd-journal && \\\n    adduser admin vsock && \\\n    adduser admin sudo\n\n# Delete generated ssh keys, otherwise every host will have the same key pair.\n# They will be generated on first boot.\n# Allow root login via default password (for now).\n# RUN rm /etc/ssh/ssh*key*\n# RUN sed -e \"s/.*PermitRootLogin.*/PermitRootLogin yes/\" -i /etc/ssh/sshd_config\n\nRUN chmod 0440 /etc/sudoers\n\n# Compile locale specification\nRUN apt-get -y update && apt-get -y --no-install-recommends install locales && rm -rf /var/lib/apt/lists/*;\nRUN localedef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8\n"
}