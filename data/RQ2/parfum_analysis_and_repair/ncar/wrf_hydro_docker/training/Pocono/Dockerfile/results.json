{
  "startTime": 1674251634540,
  "endTime": 1674251635366,
  "originalSmells": [
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 88,
        "lineEnd": 88,
        "columnStart": 11,
        "columnEnd": 69
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 26,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 87,
        "lineEnd": 87,
        "columnStart": 18,
        "columnEnd": 87
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 87,
        "lineEnd": 87,
        "columnStart": 18,
        "columnEnd": 87
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "###################################\n# Image name: wrfhydro/nwm-training:v2.0\n# Author: Ryan Cabell <rcabell@ucar.edu>\n# Date:  2019-04-24\n###################################\nFROM wrfhydro/dev:base as build\n\nMAINTAINER rcabell@ucar.edu\nUSER root\n\nRUN mkdir /home/docker/nwm-training && chown docker:docker /home/docker/nwm-training\n\n# install NCL\n#RUN wget https://www.earthsystemgrid.org/dataset/ncl.640.dap/file/ncl_ncarg-6.4.0-Debian8.6_64bit_gnu492.tar.gz \\\n#  && mkdir /usr/local/ncl-6.4.0 \\\n#  && tar -xzf ncl_ncarg-6.4.0-Debian8.6_64bit_gnu492.tar.gz -C /usr/local/ncl-6.4.0 \\\n#  && rm ncl_ncarg-6.4.0-Debian8.6_64bit_gnu492.tar.gz\n\n#ENV NCARG_ROOT=/usr/local/ncl-6.4.0\n#ENV PATH=$NCARG_ROOT/bin:$PATH\n\n# install python modules\n\nRUN conda install nodejs\n\nRUN pip install --no-cache-dir --upgrade pip && \\\n    pip install --no-cache-dir jupyterlab jupyter_contrib_nbextensions ipython \\\n    matplotlib h5py netcdf4 dask toolz xarray \\\n    numpy pandas psutil\n\nRUN jupyter labextension install @jupyterlab/toc\n\nADD example_case.tgz /home/docker/nwm-training\nRUN chown -R docker:docker /home/docker/nwm-training/example_case # && \\\n    chown -R docker:docker /home/docker/miniconda3\n\n# Modifying PATH to place conda stuff at the end.\n#ENV PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/bin:/home/docker/miniconda3/bin\n\n############################\n## SWITCH TO USER \"DOCKER\"\n\nUSER docker\nWORKDIR /home/docker\nENV version=v5.1.0\n\n# get regridding scripts\n#RUN wget https://ral.ucar.edu/sites/default/files/public/ESMFregrid_NLDAS.tar_.gz \\\n#\t&& tar -xf ESMFregrid_NLDAS.tar_.gz \\\n#\t&& mv NLDAS /home/docker/nwm-training/regridding \\\n#\t&& rm ESMFregrid_NLDAS.tar_.gz\n\n#COPY ./gdrive_download.py gdrive_download.py\n#RUN chmod +x gdrive_download.py\n\n#RUN mkdir /home/docker/nwm-training/regridding/data/ \\\n#  && python gdrive_download.py --file_id 1yyfO2ofec49H4SqR-RuFly9mJPqs73Hw \\\n#  --dest_file /home/docker/nwm-training/regridding/data/nldas_forcing.tar.gz\n\n#RUN rm gdrive_download.py\n\nRUN git clone --single-branch --branch rfc_training https://github.com/aubreyd/wrf_hydro_nwm_public \\\n    && mv /home/docker/wrf_hydro_nwm_public /home/docker/nwm-training/wrf_hydro_nwm_public\n\nRUN git clone --single-branch --branch RFC_Training https://github.com/NCAR/wrf_hydro_training \\\n     && mv /home/docker/wrf_hydro_training/lessons/training /home/docker/nwm-training/lessons \\\n     && rm -rf /home/docker/wrf_hydro_training\n\n# Obtain the latest calibration workflow code.\nRUN git clone --single-branch https://github.com/logankarsten/PyWrfHydroCalib \\\n    && mv /home/docker/PyWrfHydroCalib /home/docker/nwm-training/PyWrfHydroCalib\n\n# Modifying PATH to place conda stuff at the end.\nENV PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/bin:/home/docker/miniconda3/bin\n\n### second stage build\n\nFROM wrfhydro/dev:base\n\n## R\n#install R and libraries\nUSER root\n\nCOPY --from=build --chown=docker:docker /home/docker /home/docker\nCOPY --chown=docker:docker ./entrypoint.sh /.\nCOPY --chown=docker:docker ./jupyter_notebook_config.py /home/docker/.jupyter/\n\nRUN apt update && apt install --no-install-recommends -y r-base-core libcurl4-gnutls-dev libssl-dev libxml2-dev \\\n        && wget https://cirrus.ucsd.edu/~pierce/ncdf/ncdf4_1.13.tar.gz \\\n        && R CMD INSTALL ncdf4_1.13.tar.gz \\\n        && rm ncdf4_1.13.tar.gz \\\n        && Rscript -e 'install.packages(c(\"devtools\",\"data.table\",\"ggplot2\",\"plyr\",\"boot\",\"sensitivity\",\"randtoolbox\",\"gridExtra\",\"raster\",\"IRkernel\"), repos=\"https://cran.rstudio.com\")' \\\n        && Rscript -e 'devtools::install_github(\"NCAR/rwrfhydro\")' && rm -rf /var/lib/apt/lists/*;\n\nUSER docker\nWORKDIR /home/docker\n\nRUN Rscript -e 'IRkernel::installspec()'\nRUN chmod -R ugo-s /home/docker/nwm-training/example_case && \\\n    chmod -R o-w /home/docker/nwm-training/example_case && \\\n    chmod o-w /home/docker\n\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"interactive\"]\n"
}