{
  "startTime": 1674254274615,
  "endTime": 1674254275469,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 95,
        "lineEnd": 95,
        "columnStart": 4,
        "columnEnd": 24
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 115,
        "lineEnd": 115,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 110,
        "lineEnd": 110,
        "columnStart": 4,
        "columnEnd": 25
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 102,
        "lineEnd": 102,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 103,
        "lineEnd": 103,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 104,
        "lineEnd": 104,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 102,
        "lineEnd": 102,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 103,
        "lineEnd": 103,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 104,
        "lineEnd": 104,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 51
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 102,
        "lineEnd": 102,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 103,
        "lineEnd": 103,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 104,
        "lineEnd": 104,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 51
      }
    }
  ],
  "repairedDockerfile": "# main image\nFROM nvidia/cuda:10.1-cudnn7-devel-ubuntu18.04\n\n# tweaked azureml pytorch image\n# as of Aug 31, 2020 pt 1.6 doesn't seem to work with horovod on native mixed precision\n\nLABEL maintainer=\"Albert\"\nLABEL maintainer_email=\"alsadovn@microsoft.com\"\nLABEL version=\"0.1\"\n\nUSER root:root\n\nENV com.nvidia.cuda.version $CUDA_VERSION\nENV com.nvidia.volumes.needed nvidia_driver\nENV LANG=C.UTF-8 LC_ALL=C.UTF-8\nENV DEBIAN_FRONTEND noninteractive\nENV LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/cuda/lib64:/usr/local/cuda/extras/CUPTI/lib64\nENV NCCL_DEBUG=INFO\nENV HOROVOD_GPU_ALLREDUCE=NCCL\n\n# Install Common Dependencies\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends \\\n    # SSH and RDMA\n    libmlx4-1 \\\n    libmlx5-1 \\\n    librdmacm1 \\\n    libibverbs1 \\\n    libmthca1 \\\n    libdapl2 \\\n    dapl2-utils \\\n    openssh-client \\\n    openssh-server \\\n    iproute2 && \\\n    # Others\n    apt-get install -y --no-install-recommends \\\n    build-essential \\\n    bzip2=1.0.6-8.1ubuntu0.2 \\\n    libbz2-1.0=1.0.6-8.1ubuntu0.2 \\\n    systemd \\\n    git=1:2.17.1-1ubuntu0.7 \\\n    wget \\\n    cpio \\\n    libsm6 \\\n    libxext6 \\\n    libxrender-dev \\\n    fuse && \\\n    apt-get clean -y && \\\n    rm -rf /var/lib/apt/lists/*\n\n# Conda Environment\nENV MINICONDA_VERSION 4.7.12.1\nENV PATH /opt/miniconda/bin:$PATH\nRUN wget -qO /tmp/miniconda.sh https://repo.continuum.io/miniconda/Miniconda3-${MINICONDA_VERSION}-Linux-x86_64.sh && \\\n    bash /tmp/miniconda.sh -bf -p /opt/miniconda && \\\n    conda clean -ay && \\\n    rm -rf /opt/miniconda/pkgs && \\\n    rm /tmp/miniconda.sh && \\\n    find / -type d -name __pycache__ | xargs rm -rf\n\n# To resolve horovod hangs due to a known NCCL issue in version 2.4.\n# Can remove it once we upgrade NCCL to 2.5+.\n# https://github.com/horovod/horovod/issues/893\n# ENV NCCL_TREE_THRESHOLD=0\nENV PIP=\"pip install --no-cache-dir\"\n\nRUN conda install -y conda=4.8.5 python=3.6.2 && conda clean -ay && \\\n    conda install -y mkl=2020.1 && \\\n    conda install -y numpy scipy scikit-learn scikit-image imageio protobuf && \\\n    conda install -y ruamel.yaml==0.16.10 && \\\n    # ruamel_yaml is a copy of ruamel.yaml package\n    # conda installs version ruamel_yaml v0.15.87 which is vulnerable\n    # force uninstall it leaving other packages intact\n    conda remove --force -y ruamel_yaml && \\\n    conda clean -ay && \\\n    # Install AzureML SDK\n    ${PIP} azureml-defaults && \\\n    # Install PyTorch\n    ${PIP} torch==1.4.0 && \\\n    ${PIP} torchvision==0.2.1 && \\\n    ${PIP} wandb && \\\n    # # Install Horovod\n    # HOROVOD_WITH_PYTORCH=1 ${PIP} horovod[pytorch]==0.19.5 && \\\n    # ldconfig && \\\n    ${PIP} tensorboard==1.15.0 && \\\n    ${PIP} future==0.17.1 && \\\n    ${PIP} onnxruntime==1.4.0 && \\\n    ${PIP} pytorch-lightning && \\\n    ${PIP} opencv-python-headless~=4.4.0 && \\\n    ${PIP} imgaug==0.4.0 --no-deps && \\\n    # hydra\n    ${PIP} hydra-core --upgrade && \\\n    ${PIP} lmdb pyarrow\n\nRUN pip3 install --no-cache-dir --upgrade pip\nRUN pip3 install --no-cache-dir pipreqs\n\nRUN apt-get update\nRUN apt-get install -y --no-install-recommends libglib2.0-dev && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install -y --no-install-recommends vim && rm -rf /var/lib/apt/lists/*;\n\nWORKDIR /\nRUN apt-get install -y --no-install-recommends libunwind8 && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install -y --no-install-recommends libicu-dev && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install -y --no-install-recommends htop && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install -y --no-install-recommends net-tools && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install -y --no-install-recommends rsync && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install -y --no-install-recommends tree && rm -rf /var/lib/apt/lists/*;\n\nRUN  wget -O azcopy.tar.gz https://aka.ms/downloadazcopylinux64\nRUN tar -xf azcopy.tar.gz && rm azcopy.tar.gz\nRUN ./install.sh\n\n# put the requirements file for your own repo under /app for pip-based installation!!!\nWORKDIR /app\nRUN pip3 install --no-cache-dir -r requirements.txt\n"
}