{
  "startTime": 1674252889427,
  "endTime": 1674252890197,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 4,
        "columnEnd": 104
      }
    },
    {
      "rule": "sha256sumEchoOneSpaces",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 7,
        "columnEnd": 59
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 18,
        "columnEnd": 57
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 18,
        "columnEnd": 57
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "## This is a generated file, do not edit directly. Edit build/docker/templates/intel-fpga-initcontainer.Dockerfile.in instead.\n##\n## Copyright 2022 Intel Corporation. All Rights Reserved.\n##\n## Licensed under the Apache License, Version 2.0 (the \"License\");\n## you may not use this file except in compliance with the License.\n## You may obtain a copy of the License at\n##\n## http://www.apache.org/licenses/LICENSE-2.0\n##\n## Unless required by applicable law or agreed to in writing, software\n## distributed under the License is distributed on an \"AS IS\" BASIS,\n## WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n## See the License for the specific language governing permissions and\n## limitations under the License.\n###\n## FINAL_BASE can be used to configure the base image of the final image.\n##\n## This is used in two ways:\n## 1) make <image-name> BUILDER=<docker|buildah>\n## 2) docker build ... -f <image-name>.Dockerfile\n##\n## The project default is 1) which sets FINAL_BASE=gcr.io/distroless/static\n## (see build-image.sh).\n## 2) and the default FINAL_BASE is primarily used to build Redhat Certified Openshift Operator container images that must be UBI based.\n## The RedHat build tool does not allow additional image build parameters.\nARG FINAL_BASE=registry.access.redhat.com/ubi8-micro\n###\n##\n## GOLANG_BASE can be used to make the build reproducible by choosing an\n## image by its hash:\n## GOLANG_BASE=golang@sha256:9d64369fd3c633df71d7465d67d43f63bb31192193e671742fa1c26ebc3a6210\n##\n## This is used on release branches before tagging a stable version.\n## The main branch defaults to using the latest Golang base image.\nARG GOLANG_BASE=golang:1.18-bullseye\n###\nFROM ${GOLANG_BASE} as builder\nARG DIR=/intel-device-plugins-for-kubernetes\nARG GO111MODULE=on\nARG BUILDFLAGS=\"-ldflags=-w -s\"\nARG GOLICENSES_VERSION\nARG CRI_HOOK=intel-fpga-crihook\nARG CMD=fpga_crihook\nARG EP=/usr/local/fpga-sw/$CRI_HOOK\nWORKDIR ${DIR}\nCOPY . .\nRUN cd cmd/${CMD}; GO111MODULE=${GO111MODULE} CGO_ENABLED=0 go install \"${BUILDFLAGS}\"; cd - \\\n    && install -D /go/bin/${CMD} /install_root${EP}\nRUN install -D ${DIR}/LICENSE /install_root/licenses/intel-device-plugins-for-kubernetes/LICENSE \\\n    && if [ ! -d \"licenses/$CMD\" ] ; then \\\n    GO111MODULE=on go run github.com/google/go-licenses@${GOLICENSES_VERSION} save \"./cmd/$CMD\" \\\n    --save_path /install_root/licenses/$CMD/go-licenses ; \\\n    else mkdir -p /install_root/licenses/$CMD/go-licenses/ && cd licenses/$CMD && cp -r * /install_root/licenses/$CMD/go-licenses/ ; fi\n###\nARG CMD=fpga_tool\nARG EP=/usr/local/fpga-sw/$CMD\nWORKDIR ${DIR}\nCOPY . .\nRUN cd cmd/${CMD}; GO111MODULE=${GO111MODULE} CGO_ENABLED=0 go install \"${BUILDFLAGS}\"; cd - \\\n    && install -D /go/bin/${CMD} /install_root${EP}\nRUN install -D ${DIR}/LICENSE /install_root/licenses/intel-device-plugins-for-kubernetes/LICENSE \\\n    && if [ ! -d \"licenses/$CMD\" ] ; then \\\n    GO111MODULE=on go run github.com/google/go-licenses@${GOLICENSES_VERSION} save \"./cmd/$CMD\" \\\n    --save_path /install_root/licenses/$CMD/go-licenses ; \\\n    else mkdir -p /install_root/licenses/$CMD/go-licenses/ && cd licenses/$CMD && cp -r * /install_root/licenses/$CMD/go-licenses/ ; fi\n###\nARG SRC_DIR=/usr/local/fpga-sw\nARG DST_DIR=/opt/intel/fpga-sw\nRUN echo \"{\\n\\\n    \\\"hook\\\" : \\\"$DST_DIR/$CRI_HOOK\\\",\\n\\\n    \\\"stage\\\" : [ \\\"prestart\\\" ],\\n\\\n    \\\"annotation\\\": [ \\\"fpga.intel.com/region\\\" ]\\n\\\n}\\n\">>/install_root/$SRC_DIR/$CRI_HOOK.json\nARG TOYBOX_VERSION=\"0.8.7\"\nARG TOYBOX_SHA256=\"b6f43d5738df54623ed21c32f430d1d5c5ac7ef465a6a883890f104b59d5d9e4\"\nARG ROOT=/install_root\nRUN apt update && apt -y --no-install-recommends install musl musl-tools musl-dev && rm -rf /var/lib/apt/lists/*;\nRUN curl -f -SL https://github.com/landley/toybox/archive/refs/tags/$TOYBOX_VERSION.tar.gz -o toybox.tar.gz \\\n    && echo \"$TOYBOX_SHA256  toybox.tar.gz\" | sha256sum -c - \\\n    && tar -xzf toybox.tar.gz \\\n    && rm toybox.tar.gz \\\n    && cd toybox-$TOYBOX_VERSION \\\n    && KCONFIG_CONFIG=${DIR}/build/docker/toybox-config LDFLAGS=\"--static\" CC=musl-gcc PREFIX=$ROOT V=2 make toybox install \\\n    && install -D LICENSE $ROOT/licenses/toybox \\\n    && cp -r /usr/share/doc/musl $ROOT/licenses/\n###\nFROM ${FINAL_BASE}\nLABEL vendor='Intel®'\nLABEL version='devel'\nLABEL release='1'\nLABEL name='intel-fpga-initcontainer'\nLABEL summary='Intel® FPGA programming CRI hook for Kubernetes'\nLABEL description='The FPGA prestart CRI-O hook performs discovery of the requested FPGA function bitstream and programs FPGA devices based on the environment variables in the workload description'\nCOPY --from=builder /install_root /\nENTRYPOINT [ \"/bin/sh\", \"-c\", \"cp -a /usr/local/fpga-sw/* /opt/intel/fpga-sw/ && ln -sf /opt/intel/fpga-sw/intel-fpga-crihook.json /etc/containers/oci/hooks.d/\" ]\n"
}