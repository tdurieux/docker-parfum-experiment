{
  "startTime": 1674216480363,
  "endTime": 1674216481735,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 88,
        "lineEnd": 88,
        "columnStart": 49,
        "columnEnd": 306
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# -*- coding: utf-8 -*-\n#\n# This file is part of WEKO3.\n# Copyright (C) 2017 National Institute of Informatics.\n#\n# WEKO3 is free software; you can redistribute it\n# and/or modify it under the terms of the GNU General Public License as\n# published by the Free Software Foundation; either version 2 of the\n# License, or (at your option) any later version.\n#\n# WEKO3 is distributed in the hope that it will be\n# useful, but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n# General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with WEKO3; if not, write to the\n# Free Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,\n# MA 02111-1307, USA.\n\n# Use Python-3.6:\nFROM python:3.6-slim-buster as stage_1\n\n# Configure Weko instance:\nENV INVENIO_WEB_HOST=127.0.0.1\nENV INVENIO_WEB_INSTANCE=invenio\nENV INVENIO_WEB_VENV=invenio\nENV INVENIO_WEB_HOST_NAME=invenio\nENV INVENIO_USER_EMAIL=wekosoftware@nii.ac.jp\nENV INVENIO_USER_PASS=uspass123\nENV INVENIO_POSTGRESQL_HOST=postgresql\nENV INVENIO_POSTGRESQL_DBNAME=invenio\nENV INVENIO_POSTGRESQL_DBUSER=invenio\nENV INVENIO_POSTGRESQL_DBPASS=dbpass123\nENV INVENIO_REDIS_HOST=redis\nENV INVENIO_ELASTICSEARCH_HOST=elasticsearch\nENV INVENIO_RABBITMQ_HOST=rabbitmq\nENV INVENIO_RABBITMQ_USER=guest\nENV INVENIO_RABBITMQ_PASS=guest\nENV INVENIO_RABBITMQ_VHOST=/\nENV INVENIO_WORKER_HOST=127.0.0.1\nENV SEARCH_INDEX_PREFIX=tenant1\n# Configure SQLAlchemy connection pool\n# see: https://docs.sqlalchemy.org/en/12/core/pooling.html#api-documentation-available-pool-implementations\nENV INVENIO_DB_POOL_CLASS=QueuePool\n\nFROM stage_1 AS stage_2\n# Install Weko web node pre-requisites:\nCOPY scripts/provision-web.sh /tmp/\nRUN /tmp/provision-web.sh\n\nFROM stage_2 AS stage_3\n# Add Weko sources to `code` and work there:\nWORKDIR /code\nRUN adduser --uid 1000 --disabled-password --gecos '' invenio\nUSER invenio\nCOPY --chown=invenio:invenio scripts /code/scripts\nCOPY --chown=invenio:invenio modules /code/modules\nCOPY --chown=invenio:invenio packages.txt /code/packages.txt\nCOPY --chown=invenio:invenio packages-invenio.txt /code/packages-invenio.txt\nCOPY --chown=invenio:invenio requirements-weko-modules.txt /code/requirements-weko-modules.txt\nCOPY --chown=invenio:invenio invenio /code/invenio\n\nFROM stage_3 AS stage_4\n# Create Weko instance:\nRUN chmod +x /code/scripts/create-instance.sh;/code/scripts/create-instance.sh\n\nFROM stage_4 AS stage_5\n# Create Weko instance2:\nWORKDIR /code\nCOPY --chown=invenio:invenio scripts/instance.cfg /code/scripts/instance.cfg\nRUN chmod +x /code/scripts/create-instance2.sh;/code/scripts/create-instance2.sh\n\nFROM stage_5 AS build-env\n# Make given VENV default:\nENV PATH=/home/invenio/.virtualenvs/invenio/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n#ENV VIRTUALENVWRAPPER_PYTHON=/usr/local/bin/python\nENV VIRTUALENVWRAPPER_PYTHON=/home/invenio/.virtualenvs/invenio/bin/python\n#RUN echo \"source /usr/local/bin/virtualenvwrapper.sh\" >> ~/.bashrc ; echo \"workon invenio\" >> ~/.bashrc\nRUN pip install --no-cache-dir virtualenvwrapper\nRUN echo \"source /home/invenio/.virtualenvs/invenio/bin/virtualenvwrapper.sh\" >> ~/.bashrc ; echo \"workon invenio\" >> ~/.bashrc\n\n#RUN mv /home/invenio/.virtualenvs/invenio/var/instance/static /home/invenio/.virtualenvs/invenio/var/instance/static.org\n\n# CMD [\"/bin/bash\", \"-c\", \"gunicorn invenio_app.wsgi --workers=4 --worker-class=meinheld.gmeinheld.MeinheldWorker -b 0.0.0.0:5000 \"]\n#CMD [\"/bin/bash\",\"-c\",\"uwsgi --ini /code/scripts/uwsgi.ini\"]\n\nFROM python:3.6-slim-buster as product-base\nRUN apt-get -y update --allow-releaseinfo-change; apt-get -y --no-install-recommends install sudo curl rlwrap screen vim gnupg libpcre3 libffi6 libfreetype6 libmsgpackc2 libssl1.1 libtiff5 libxml2 libxslt1.1 libzip4 nodejs libpq5 default-jre libreoffice-java-common libreoffice fonts-ipafont fonts-ipaexfont && rm -rf /var/lib/apt/lists/*;\nCOPY --from=build-env /usr/bin /usr/bin\nCOPY --from=build-env /usr/lib/node_modules /usr/lib/node_modules\nRUN adduser --uid 1000 --disabled-password --gecos '' invenio\nUSER invenio\nWORKDIR /code\nCOPY --from=build-env --chown=invenio:invenio /code /code\nCOPY --from=build-env --chown=invenio:invenio /home/invenio/.virtualenvs /home/invenio/.virtualenvs\n#RUN mv /home/invenio/.virtualenvs/invenio/var/instance/static /home/invenio/.virtualenvs/invenio/var/instance/static.org\n# CMD [\"/bin/bash\"]\nCMD [\"/bin/bash\", \"-c\", \"invenio run -h 0.0.0.0\"]\n# FROM python:3.6-slim-buster as product-env\n\n# # Configure Weko instance:\n# ENV INVENIO_WEB_HOST=127.0.0.1\n# ENV INVENIO_WEB_INSTANCE=invenio\n# ENV INVENIO_WEB_VENV=invenio\n# ENV INVENIO_WEB_HOST_NAME=invenio\n# ENV INVENIO_USER_EMAIL=wekosoftware@nii.ac.jp\n# ENV INVENIO_USER_PASS=uspass123\n# ENV INVENIO_POSTGRESQL_HOST=postgresql\n# ENV INVENIO_POSTGRESQL_DBNAME=invenio\n# ENV INVENIO_POSTGRESQL_DBUSER=invenio\n# ENV INVENIO_POSTGRESQL_DBPASS=dbpass123\n# ENV INVENIO_REDIS_HOST=redis\n# ENV INVENIO_ELASTICSEARCH_HOST=elasticsearch\n# ENV INVENIO_RABBITMQ_HOST=rabbitmq\n# ENV INVENIO_RABBITMQ_USER=guest\n# ENV INVENIO_RABBITMQ_PASS=guest\n# ENV INVENIO_RABBITMQ_VHOST=/\n# ENV INVENIO_WORKER_HOST=127.0.0.1\n# ENV SEARCH_INDEX_PREFIX=tenant1\n# # Configure SQLAlchemy connection pool\n# # see: https://docs.sqlalchemy.org/en/12/core/pooling.html#api-documentation-available-pool-implementations\n# ENV INVENIO_DB_POOL_CLASS=QueuePool\n\n# RUN apt-get -y update && apt-get -y install curl nano default-jre libreoffice libreoffice-java-common fonts-ipafont fonts-ipaexfont --no-install-recommends && apt-get -y clean && pip install -U setuptools pip virtualenvwrapper && adduser --uid 1000 --disabled-password --gecos '' invenio\n# USER invenio\n# COPY --from=build-env --chown=invenio:invenio /home/invenio/.virtualenvs /home/invenio/.virtualenvs\n# COPY --from=build-env --chown=invenio:invenio /code /code\n# COPY --from=build-env /usr/bin /usr/bin\n\n# ENV PATH=/home/invenio/.virtualenvs/invenio/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n# ENV VIRTUALENVWRAPPER_PYTHON=/usr/local/bin/python\n# RUN echo \"source /usr/local/bin/virtualenvwrapper.sh\" >> ~/.bashrc && echo \"workon invenio\" >> ~/.bashrc\n# WORKDIR /code\n\n# CMD [\"/bin/bash\", \"-c\", \"invenio run -h 0.0.0.0\"]\n\n\n"
}