{
  "startTime": 1674218937713,
  "endTime": 1674218938638,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 79
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ghcr.io/greenbone/data-objects:community-staging AS data_objects\nRUN mv `ls -d /var/lib/gvm/data-objects/gvmd/*/*configs | sort -r | head -n 1` /policies\n\nFROM ghcr.io/greenbone/vulnerability-tests:community-staging AS nasl\n# use latest version\nRUN mv `ls -d /var/lib/openvas/* | sort -r | head -n 1`/vt-data/nasl /nasl\n\nFROM greenbone/openvas-scanner:unstable\n\nRUN apt-get update && apt-get install --no-install-recommends --no-install-suggests -y \\\n    mosquitto \\\n    redis \\\n    python3 \\\n    python3-pip \\\n    python3-setuptools \\\n    python3-packaging \\\n    python3-wrapt \\\n    python3-cffi \\\n    python3-psutil \\\n    python3-lxml \\\n    python3-defusedxml \\\n    python3-redis \\\n    python3-gnupg \\\n    python3-paho-mqtt \\\n    make \\\n    openssh-server \\\n    curl &&\\\n\tapt-get remove --purge --auto-remove -y &&\\\n\trm -rf /var/lib/apt/lists/*\n# due to old version in buster\nRUN curl -f -L https://golang.org/dl/go1.17.2.linux-amd64.tar.gz -o /tmp/go.tar.gz && \\\n    rm -rf /usr/local/go && \\\n    tar -C /usr/local -xzf /tmp/go.tar.gz && \\\n    rm /tmp/go.tar.gz\n\n\nCOPY --chmod=7777 . /usr/local/src/ospd-openvas\nCOPY smoketest/redis.conf /etc/redis/redis.conf\nRUN rm -rf /var/lib/openvas/plugins/*\nRUN cp -r /usr/local/src/ospd-openvas/smoketest/data/plugins/* /var/lib/openvas/plugins\nRUN cp -r /usr/local/src/ospd-openvas/smoketest/data/notus /var/lib/openvas/plugins/notus\n\nRUN useradd -rm -s /bin/bash -g redis -u 1000 gvm\nRUN mkdir /run/redis\nRUN chown gvm:redis /run/redis\nRUN mkdir -p /var/run/ospd/\nRUN chown gvm:redis /var/run/ospd\nRUN touch /etc/openvas/openvas_log.conf\nRUN chown gvm:redis /etc/openvas/openvas_log.conf\nWORKDIR /usr/local/src/ospd-openvas\nRUN python3 -m pip install .\nRUN chown gvm:redis /var/log/gvm\nRUN mkdir /run/mosquitto\nRUN echo \"allow_anonymous true\" >> /etc/mosquitto.conf\nRUN echo \"pid_file /tmp/mosquitto.pid\" >> /etc/mosquitto.conf\nRUN echo \"log_dest file /tmp/mosquitto.log\" >> /etc/mosquitto.conf\nRUN echo \"persistence_location = /tmp/\" >> /etc/mosquitto.conf\nRUN echo \"persistence true\" >> /etc/mosquitto.conf\nRUN echo \"mqtt_server_uri = localhost:1883\" >> /etc/openvas/openvas.conf\nRUN chown mosquitto:mosquitto /run/mosquitto\nRUN mkdir -p /var/log/mosquitto/\nRUN chown mosquitto:mosquitto /var/log/mosquitto\nRUN chmod 774 /var/log/mosquitto\n\nWORKDIR /usr/local/src/ospd-openvas/smoketest\nRUN GO=\"/usr/local/go/bin/go\" make build-cmds\nRUN mv bin/* /usr/local/bin/\nRUN mv /usr/local/src/ospd-openvas/smoketest/run-tests.sh /usr/local/bin/run\nCOPY --from=nasl --chmod=7777 /nasl /usr/local/src/nasl\nCOPY --from=data_objects --chmod=7777 /policies /usr/local/src/policies\nRUN ospd-policy-feed -s /usr/local/src/nasl -t /var/lib/openvas/plugins -p /usr/local/src/policies\nRUN rm -rf /usr/local/go\nRUN rm -rf /usr/local/src/ospd-openvas\n#RUN rm -rf /usr/local/src/nasl\nRUN apt-get remove --purge --auto-remove -y curl python3-pip python3-packaging make\nRUN chown -R gvm:redis /var/lib/openvas/plugins/\nRUN mkdir /run/sshd\n# make gvm capable of running sshd\nRUN chown -R gvm:redis /etc/ssh\nRUN echo 'gvm:test' | chpasswd\nRUN sed -i 's/#PidFile/Pidfile/' /etc/ssh/sshd_config\nUSER gvm\nWORKDIR /home/gvm\nCMD /usr/local/bin/run\n"
}