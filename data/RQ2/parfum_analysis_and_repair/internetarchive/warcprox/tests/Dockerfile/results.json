{
  "startTime": 1674255154649,
  "endTime": 1674255156028,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 155
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 52,
        "lineEnd": 52,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 112,
        "lineEnd": 112,
        "columnStart": 7,
        "columnEnd": 67
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 113,
        "lineEnd": 113,
        "columnStart": 7,
        "columnEnd": 68
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 49,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 25,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 42,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 44,
        "lineEnd": 44,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 139,
        "lineEnd": 139,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 42,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 44,
        "lineEnd": 44,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 139,
        "lineEnd": 139,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 25,
        "columnEnd": 53
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 42,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 44,
        "lineEnd": 44,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 139,
        "lineEnd": 139,
        "columnStart": 4,
        "columnEnd": 50
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 78
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 42,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 44,
        "lineEnd": 44,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 75
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 139,
        "lineEnd": 139,
        "columnStart": 4,
        "columnEnd": 74
      }
    }
  ],
  "repairedDockerfile": "#\n# Dockerfile for warcprox tests\n#\n# Copyright (C) 2015-2017 Internet Archive\n#\n# This program is free software; you can redistribute it and/or\n# modify it under the terms of the GNU General Public License\n# as published by the Free Software Foundation; either version 2\n# of the License, or (at your option) any later version.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program; if not, write to the Free Software\n# Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301,\n# USA.\n#\n\nFROM ubuntu:focal-20220404\nMAINTAINER Noah Levitt <nlevitt@archive.org>\n\n# see https://github.com/stuartpb/rethinkdb-dockerfiles/blob/master/trusty/2.1.3/Dockerfile\n# and https://github.com/chali/hadoop-cdh-pseudo-docker/blob/master/Dockerfile\n\nENV LANG=C.UTF-8\n\nRUN apt-get update && apt-get --auto-remove -y dist-upgrade\nRUN apt-get install --no-install-recommends -y ca-certificates curl gnupg wget && rm -rf /var/lib/apt/lists/*;\n\n# Add the RethinkDB repository and public key\nRUN curl -f -Ss https://download.rethinkdb.com/repository/raw/pubkey.gpg | apt-key add -\nRUN echo \"deb https://download.rethinkdb.com/repository/ubuntu-focal focal main\" > /etc/apt/sources.list.d/rethinkdb.list \\\n    && apt-get update && apt-get -y --no-install-recommends install rethinkdb && rm -rf /var/lib/apt/lists/*;\n\nRUN mkdir -vp /etc/service/rethinkdb \\\n    && echo \"#!/bin/bash\\nexec rethinkdb --bind 0.0.0.0 --directory /tmp/rethink-data --runuser rethinkdb --rungroup rethinkdb\\n\" > /etc/service/rethinkdb/run \\\n    && chmod a+x /etc/service/rethinkdb/run\n\nRUN apt-get -y --no-install-recommends install git && rm -rf /var/lib/apt/lists/*;\nRUN apt-get -y --no-install-recommends install libpython2.7-dev libpython3-dev libffi-dev libssl-dev \\\n               python-setuptools python3-setuptools && rm -rf /var/lib/apt/lists/*;\nRUN apt-get -y --no-install-recommends install gcc && rm -rf /var/lib/apt/lists/*;\n\nRUN echo '57ff41e99cb01b6a1c2b0999161589b726f0ec8b  /tmp/pip-9.0.1.tar.gz' > /tmp/sha1sums.txt\nRUN curl -f -sSL -o /tmp/pip-9.0.1.tar.gz https://pypi.python.org/packages/11/b6/abcb525026a4be042b486df43905d6893fb04f05aac21c32c638e939e447/pip-9.0.1.tar.gz\nRUN sha1sum -c /tmp/sha1sums.txt\nRUN tar -C /tmp -xf /tmp/pip-9.0.1.tar.gz && rm /tmp/pip-9.0.1.tar.gz\nRUN cd /tmp/pip-9.0.1 && python3 setup.py install\n\nRUN pip install --no-cache-dir virtualenv\n\nRUN apt-get -y --no-install-recommends install tor && rm -rf /var/lib/apt/lists/*;\nRUN mkdir -vp /etc/service/tor \\\n    && echo \"#!/bin/sh\\nexec tor\\n\" > /etc/service/tor/run \\\n    && chmod a+x /etc/service/tor/run\n\n# hadoop hdfs for trough\n\nARG DEBIAN_FRONTEND=noninteractive\nENV TZ=Etc/UTC\nRUN apt-get install --no-install-recommends -y openjdk-8-jdk openssh-server && rm -rf /var/lib/apt/lists/*;\n\n# set java home\nENV JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64\n\n# setup ssh with no passphrase\nRUN ssh-keygen -t rsa -f $HOME/.ssh/id_rsa -P \"\" \\\n    && cat $HOME/.ssh/id_rsa.pub >> $HOME/.ssh/authorized_keys\n\nRUN wget -O /hadoop-2.7.3.tar.gz -q https://archive.apache.org/dist/hadoop/common/hadoop-2.7.3/hadoop-2.7.3.tar.gz \\\n        && tar xfz hadoop-2.7.3.tar.gz \\\n        && mv /hadoop-2.7.3 /usr/local/hadoop \\\n        && rm /hadoop-2.7.3.tar.gz\n\n# hadoop environment variables\nENV HADOOP_HOME=/usr/local/hadoop\nENV PATH=$PATH:$HADOOP_HOME/bin:$HADOOP_HOME/sbin\n\n# hadoop-store\nRUN mkdir -p $HADOOP_HOME/hdfs/namenode \\\n        && mkdir -p $HADOOP_HOME/hdfs/datanode\n\n# Temporary files: http://refspecs.linuxfoundation.org/FHS_3.0/fhs/ch03s18.html\nCOPY config/ /tmp/\nRUN mv /tmp/ssh_config $HOME/.ssh/config \\\n    && mv /tmp/hadoop-env.sh $HADOOP_HOME/etc/hadoop/hadoop-env.sh \\\n    && mv /tmp/core-site.xml $HADOOP_HOME/etc/hadoop/core-site.xml \\\n    && mv /tmp/hdfs-site.xml $HADOOP_HOME/etc/hadoop/hdfs-site.xml \\\n    && mv /tmp/mapred-site.xml $HADOOP_HOME/etc/hadoop/mapred-site.xml.template \\\n    && cp $HADOOP_HOME/etc/hadoop/mapred-site.xml.template $HADOOP_HOME/etc/hadoop/mapred-site.xml \\\n    && mv /tmp/yarn-site.xml $HADOOP_HOME/etc/hadoop/yarn-site.xml\n\n# Add startup script\nADD config/hadoop-services.sh $HADOOP_HOME/hadoop-services.sh\n\n# set permissions\nRUN chmod 744 -R $HADOOP_HOME\n\n# format namenode\nRUN $HADOOP_HOME/bin/hdfs namenode -format\n\n# run hadoop services\n#ENTRYPOINT $HADOOP_HOME/hadoop-services.sh; bash\n\nRUN apt-get install --no-install-recommends -y libsqlite3-dev build-essential && rm -rf /var/lib/apt/lists/*;\n\n# trough itself\nRUN virtualenv -p python3 /opt/trough-ve3 \\\n    && . /opt/trough-ve3/bin/activate \\\n    && pip install --no-cache-dir git+https://github.com/nlevitt/snakebite.git@py3 \\\n    && pip install --no-cache-dir git+https://github.com/internetarchive/trough.git\n\nRUN mkdir -vp /etc/service/trough-sync-local \\\n    && echo \"#!/bin/bash\\nsource /opt/trough-ve3/bin/activate\\nexec sync.py >>/tmp/trough-sync-local.out 2>&1\" > /etc/service/trough-sync-local/run \\\n    && chmod a+x /etc/service/trough-sync-local/run\n\nRUN mkdir -vp /etc/service/trough-sync-server \\\n    && echo '#!/bin/bash\\nsource /opt/trough-ve3/bin/activate\\nsleep 5\\npython -c $\"import doublethink ; from trough.settings import settings ; rr = doublethink.Rethinker(settings[\\\"RETHINKDB_HOSTS\\\"]) ; rr.db(\\\"trough_configuration\\\").wait().run()\"\\nexec sync.py --server >>/tmp/trough-sync-server.out 2>&1' > /etc/service/trough-sync-server/run \\\n    && chmod a+x /etc/service/trough-sync-server/run\n\nRUN mkdir -vp /etc/service/trough-read \\\n    && echo '#!/bin/bash\\nvenv=/opt/trough-ve3\\nsource $venv/bin/activate\\nsleep 5\\npython -c $\"import doublethink ; from trough.settings import settings ; rr = doublethink.Rethinker(settings[\\\"RETHINKDB_HOSTS\\\"]) ; rr.db(\\\"trough_configuration\\\").wait().run()\"\\nexec uwsgi --venv=$venv --http :6444 --master --processes=2 --harakiri=3200 --socket-timeout=3200 --max-requests=50000 --vacuum --die-on-term --wsgi-file $venv/bin/reader.py >>/tmp/trough-read.out 2>&1' > /etc/service/trough-read/run \\\n    && chmod a+x /etc/service/trough-read/run\n\nRUN mkdir -vp /etc/service/trough-write \\\n    && echo '#!/bin/bash\\nvenv=/opt/trough-ve3\\nsource $venv/bin/activate\\nsleep 5\\npython -c $\"import doublethink ; from trough.settings import settings ; rr = doublethink.Rethinker(settings[\\\"RETHINKDB_HOSTS\\\"]) ; rr.db(\\\"trough_configuration\\\").wait().run()\"\\nexec uwsgi --venv=$venv --http :6222 --master --processes=2 --harakiri=240 --max-requests=50000 --vacuum --die-on-term --wsgi-file $venv/bin/writer.py >>/tmp/trough-write.out 2>&1' > /etc/service/trough-write/run \\\n    && chmod a+x /etc/service/trough-write/run\n\nRUN mkdir -vp /etc/service/trough-segment-manager-local \\\n    && echo '#!/bin/bash\\nvenv=/opt/trough-ve3\\nsource $venv/bin/activate\\nsleep 5\\npython -c $\"import doublethink ; from trough.settings import settings ; rr = doublethink.Rethinker(settings[\\\"RETHINKDB_HOSTS\\\"]) ; rr.db(\\\"trough_configuration\\\").wait().run()\"\\nexec uwsgi --venv=$venv --http :6112 --master --processes=2 --harakiri=7200 --http-timeout=7200 --max-requests=50000 --vacuum --die-on-term --mount /=trough.wsgi.segment_manager:local >>/tmp/trough-segment-manager-local.out 2>&1' > /etc/service/trough-segment-manager-local/run \\\n    && chmod a+x /etc/service/trough-segment-manager-local/run\n\nRUN mkdir -vp /etc/service/trough-segment-manager-server \\\n    && echo '#!/bin/bash\\nvenv=/opt/trough-ve3\\nsource $venv/bin/activate\\nsleep 5\\npython -c $\"import doublethink ; from trough.settings import settings ; rr = doublethink.Rethinker(settings[\\\"RETHINKDB_HOSTS\\\"]) ; rr.db(\\\"trough_configuration\\\").wait().run()\"\\nexec uwsgi --venv=$venv --http :6111 --master --processes=2 --harakiri=7200 --http-timeout=7200 --max-requests=50000 --vacuum --die-on-term --mount /=trough.wsgi.segment_manager:server >>/tmp/trough-segment-manager-server.out 2>&1' > /etc/service/trough-segment-manager-server/run \\\n    && chmod a+x /etc/service/trough-segment-manager-server/run\n\nRUN apt-get install --no-install-recommends -y daemontools daemontools-run && rm -rf /var/lib/apt/lists/*;\n"
}