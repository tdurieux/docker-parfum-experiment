{
  "startTime": 1674251918792,
  "endTime": 1674251920622,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 134
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 4,
        "columnEnd": 108
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 42,
        "lineEnd": 42,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 91
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 76,
        "lineEnd": 76,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 181
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 82,
        "lineEnd": 82,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 83,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 134
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 4,
        "columnEnd": 108
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 42,
        "lineEnd": 42,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 91
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 76,
        "lineEnd": 76,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 181
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 82,
        "lineEnd": 82,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 83,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 134
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 4,
        "columnEnd": 108
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 42,
        "lineEnd": 42,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 91
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 76,
        "lineEnd": 76,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 181
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 82,
        "lineEnd": 82,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 83,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 35
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 158
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 88
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 4,
        "columnEnd": 132
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 42,
        "lineEnd": 42,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 115
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 76,
        "lineEnd": 76,
        "columnStart": 4,
        "columnEnd": 82
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 205
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 82,
        "lineEnd": 82,
        "columnStart": 4,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 83,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 59
      }
    }
  ],
  "repairedDockerfile": "# Description:\n#   This runtime environment example Dockerfile creates a container with a minimal Ubuntu server and postfix+dovecot+postfixadmin+lemp stack mail server environment\n# Usage:\n#   From this directory, run $ docker build -t temailsvr .\n#   By default, runs as root\n#   https://www.dovecot.org\n#   http://www.postfix.org\n#   http://postfixadmin.sourceforge.net\n#   https://www.linuxbabe.com/mail-server/postfixadmin-ubuntu\n\nFROM ubuntu:20.04\n\n#https://grigorkh.medium.com/fix-tzdata-hangs-docker-image-build-cdb52cc3360d\nENV TZ=US/Eastern\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone\n\n#avoid question/dialog during apt-get installs\nARG DEBIAN_FRONTEND noninteractive\n\n# Setup container's ENV for systemd\nENV container docker\n\n#update\nRUN apt-get update\n\n#install utilities\nRUN apt-get install --no-install-recommends apt-utils dpkg-dev debconf debconf-utils -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends net-tools iputils-ping iptables iproute2 wget nmap bind9-dnsutils dnsutils inetutils-traceroute isc-dhcp-common -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends vim acl sudo telnet ssh netcat nfs-common -y && rm -rf /var/lib/apt/lists/*;\n\n#install dependencies for systemd and syslog\nRUN apt-get install --no-install-recommends systemd systemd-sysv syslog-ng syslog-ng-core syslog-ng-mod-sql syslog-ng-mod-mongodb -y && rm -rf /var/lib/apt/lists/*;\n\n#start systemd\nCMD [\"/usr/lib/systemd/systemd\", \"--system\"]\n\n#install all the things (postfix)\nCOPY postfix/postfix_install.sh /root/postfix_install.sh\nRUN chmod +x /root/postfix_install.sh\nRUN /root/postfix_install.sh\nRUN apt-get install --no-install-recommends postfix -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends spamassassin spamc -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends spamass-milter -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends postfix-pcre -y && rm -rf /var/lib/apt/lists/*;\n\n# configure postfix\nCOPY postfix/etc_postfix_main.cf /etc/postfix/main.cf\nCOPY postfix/etc_postfix_master.cf /etc/postfix/master.cf\nRUN mkdir /etc/postfix/sql\nCOPY postfix/etc_postfix_sql_mysql_virtual_alias_domain_catchall_maps.cf /etc/postfix/sql/mysql_virtual_alias_domain_catchall_maps.cf\nCOPY postfix/etc_postfix_sql_mysql_virtual_alias_domain_mailbox_maps.cf /etc/postfix/sql/mysql_virtual_alias_domain_mailbox_maps.cf\nCOPY postfix/etc_postfix_sql_mysql_virtual_alias_domain_maps.cf /etc/postfix/sql/mysql_virtual_alias_domain_maps.cf\nCOPY postfix/etc_postfix_sql_mysql_virtual_alias_maps.cf /etc/postfix/sql/mysql_virtual_alias_maps.cf\nCOPY postfix/etc_postfix_sql_mysql_virtual_domains_maps.cf /etc/postfix/sql/mysql_virtual_domains_maps.cf\nCOPY postfix/etc_postfix_sql_mysql_virtual_mailbox_maps.cf /etc/postfix/sql/mysql_virtual_mailbox_maps.cf\nRUN chown -R root:postfix /etc/postfix/sql\nRUN chmod -R go-w /etc/postfix/sql/*.cf /etc/postfix/*.cf /etc/postfix/makedefs.out\nRUN adduser vmail --system --group --uid 2000 --disabled-login --no-create-home\nRUN mkdir /var/vmail\nRUN chown vmail:vmail /var/vmail/ -R\nRUN postconf maillog_file=/var/log/postfix.log\n\n#install dovecot\nRUN apt-get install --no-install-recommends dovecot-core dovecot-imapd dovecot-pop3d dovecot-mysql dovecot-lmtpd -y && rm -rf /var/lib/apt/lists/*;\n\n#configure dovecot\nCOPY dovecot/etc_dovecot_dovecot.conf /etc/dovecot/dovecot.conf\nCOPY dovecot/etc_dovecot_dovecot-sql.conf.ext /etc/dovecot/dovecot-sql.conf.ext\nCOPY dovecot/etc_dovecot_conf.d_10-auth.conf /etc/dovecot/conf.d/10-auth.conf\nCOPY dovecot/etc_dovecot_conf.d_10-mail.conf /etc/dovecot/conf.d/10-mail.conf\nCOPY dovecot/etc_dovecot_conf.d_10-master.conf /etc/dovecot/conf.d/10-master.conf\nCOPY dovecot/etc_dovecot_conf.d_15-mailboxes.conf /etc/dovecot/conf.d/15-mailboxes.conf\n#create dovecot and mail users\nRUN adduser dovecot mail\n\n#install all the things (web server, MariaDB database server, PHP7.4, postfixadmin)\nRUN apt-get install --no-install-recommends nginx mariadb-server mariadb-client -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends php7.4 php7.4-fpm php7.4-mysql php-common php7.4-cli php7.4-common php7.4-json php7.4-opcache php7.4-readline php7.4-mbstring php7.4-xml php7.4-gd php7.4-curl -y && rm -rf /var/lib/apt/lists/*;\n\n#remove the default nginx site\nRUN rm /etc/nginx/sites-enabled/default /etc/nginx/sites-available/default\n\nRUN apt-get install --no-install-recommends dbconfig-no-thanks -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends postfixadmin -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get remove dbconfig-no-thanks -y\n\nCOPY postfixadmin/etc_nginx_conf.d_postfixadmin.conf /etc/nginx/conf.d/postfixadmin.conf\nRUN mkdir -p /usr/share/postfixadmin/templates_c\nRUN chown -R www-data /usr/share/postfixadmin/templates_c\nCOPY postfixadmin/usr_share_postfixadmin_config.local.php /usr/share/postfixadmin/config.local.php\n\nRUN ln -s /usr/share/postfixadmin/public /usr/share/nginx/html/postfixadmin\n\nRUN echo \"mail\" >> /etc/hostname\n\n# Finished!\nRUN echo $'\\n\\\n* Container is ready, run it using $ docker run -d --name emailsvr --hostname mail --add-host mail.netsec-docker.isi.jhu.edu:127.0.1.1 --dns 192.168.25.10 --dns-search netsec-docker.isi.jhu.edu --privileged -v /sys/fs/cgroup:/sys/fs/cgroup:ro --network host --cpus=1 temailsvr:latest \\n\\\n* Attach to it using $ docker exec -it emailsvr bash \\n\\\n* Build the postfixadmin mysql database # dpkg-reconfigure postfixadmin \\n\\\n    * Specify these values when prompted: \\n\\\n        * Reinstall database for postfixadmin? [yes/no] yes \\n\\\n        * Connection method for MySQL database of postfixadmin: 1 \\n\\\n        * Authentication plugin for MySQL database: 1 \\n\\\n        * MySQL database name for postfixadmin: postfixadmin \\n\\\n        * MySQL username for postfixadmin: postfixadmin@localhost \\n\\\n        * MySQL application password for postfixadmin: nwsec123 \\n\\\n        * Password confirmation: nwsec123 \\n\\\n        * Name of the database administrative user: root \\n\\\n* Edit /etc/postfixadmin/dbconfig.inc.php and change value of line with $dbtype from mysql to mysqli \\n\\\n* Edit /etc/dbconfig-common/postfixadmin.conf and change value of line with dbc_dbtype from mysql to mysqli \\n\\\n* Log in to http://mail.netsec-docker.isi.jhu.edu/postfixadmin/setup.php \\n\\\n    * Specify a setup password and copy the generated hash into the value for the setup_password variable in /etc/postfixadmin/config.inc.php \\n\\\n    * Then, create a superadmin account Admin postfixadmin@netsec-docker.isi.jhu.edu and specify its password \\n\\\n* Use that superadmin account to log in to http://mail.netsec-docker.isi.jhu.edu/postfixadmin/login.php \\n\\\n    * Create a new netsec-docker.isi.jhu.edu domain \\n\\\n    * Create new email accounts in the netsec-docker.isi.jhu.edu domain \\n\\\n    * Note, you will need to create an email account for superadmin user \\n\\\n* Use Mozilla Thunderbird for a mail client from the VM or another container to access email'\n"
}