{
  "startTime": 1674254144120,
  "endTime": 1674254145198,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 52,
        "lineEnd": 52,
        "columnStart": 59,
        "columnEnd": 135
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM debian:bookworm-slim\n\n# Set version label\nLABEL maintainer=\"lycheeorg\"\n\n# Environment variables\nENV PUID='1000'\nENV PGID='1000'\nENV USER='lychee'\nENV PHP_TZ=UTC\n\n# Arguments\n# To use the latest Lychee release instead of master pass `--build-arg TARGET=release` to `docker build`\nARG TARGET=dev\n\n# Add User and Group\nRUN \\\r\n    addgroup --gid \"$PGID\" \"$USER\" && \\\r\n    adduser --gecos '' --no-create-home --disabled-password --uid \"$PUID\" --gid \"$PGID\" \"$USER\"\n\n# Install base dependencies, clone the repo and install php libraries\nRUN \\\n    set -ev && \\\r\n    apt-get update && \\\r\n    apt-get upgrade -qy && \\\r\n    apt-get install -qy --no-install-recommends\\\r\n    nginx-light \\\r\n    php8.1-mysql \\\r\n    php8.1-pgsql \\\r\n    php8.1-sqlite3 \\\r\n    php8.1-imagick \\\r\n    php8.1-mbstring \\\r\n    php8.1-gd \\\r\n    php8.1-xml \\\r\n    php8.1-zip \\\r\n    php8.1-fpm \\\r\n    php8.1-redis \\\r\n    php8.1-bcmath \\\r\n    php8.1-intl \\\r\n    curl \\\r\n    libimage-exiftool-perl \\\r\n    ffmpeg \\\r\n    git \\\r\n    jpegoptim \\\r\n    optipng \\\r\n    pngquant \\\r\n    gifsicle \\\r\n    webp \\\r\n    cron \\\r\n    composer \\\r\n    unzip && \\\r\n    cd /var/www/html && \\\n    if [ \"$TARGET\" = \"release\" ] ; then \\\n    RELEASE_TAG=\"-b v$( curl -f -s https://raw.githubusercontent.com/LycheeOrg/Lychee/master/version.md)\" ; fi && \\\n    git clone --depth 1 $RELEASE_TAG https://github.com/LycheeOrg/Lychee.git && \\\n    mv Lychee/.git/refs/heads/master Lychee/master || cp Lychee/.git/HEAD Lychee/master && \\\n    mv Lychee/.git/HEAD Lychee/HEAD && \\\n    rm -r Lychee/.git/* && \\\n    mkdir -p Lychee/.git/refs/heads && \\\n    mv Lychee/HEAD Lychee/.git/HEAD && \\\n    mv Lychee/master Lychee/.git/refs/heads/master && \\\n    echo \"$TARGET\" > /var/www/html/Lychee/docker_target && \\\n    cd /var/www/html/Lychee && \\\n    echo \"Last release: $(cat version.md)\" && \\\n    composer install --no-dev --prefer-dist && \\\n    find . -wholename '*/[Tt]ests/*' -delete && \\\n    find . -wholename '*/[Tt]est/*' -delete && \\\n    rm -r storage/framework/cache/data/* 2> /dev/null || true && \\\n    rm    storage/framework/sessions/* 2> /dev/null || true && \\\n    rm    storage/framework/views/* 2> /dev/null || true && \\\n    rm    storage/logs/* 2> /dev/null || true && \\\n    chown -R www-data:www-data /var/www/html/Lychee && \\\n    echo \"* * * * * www-data cd /var/www/html/Lychee && php artisan schedule:run >> /dev/null 2>&1\" >> /etc/crontab && \\\n    apt-get purge -y --autoremove git composer && \\\n    apt-get clean -qy && \\\n    rm -rf /var/lib/apt/lists/*\n\n# Add custom Nginx configuration\nCOPY default.conf /etc/nginx/nginx.conf\n\nEXPOSE 80\nVOLUME /conf /uploads /sym\n\nWORKDIR /var/www/html/Lychee\n\nCOPY entrypoint.sh inject.sh /\n\nRUN chmod +x /entrypoint.sh && \\\r\n    chmod +x /inject.sh && \\\r\n    mkdir /run/php\n\nHEALTHCHECK CMD curl --fail http://localhost:80/ || exit 1\n\nENTRYPOINT [ \"/entrypoint.sh\" ]\n\nCMD [ \"nginx\" ]\n"
}