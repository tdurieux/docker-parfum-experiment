{
  "startTime": 1674248815711,
  "endTime": 1674248817695,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 29,
        "lineEnd": 29,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 25
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 45,
        "lineEnd": 45,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 51,
        "lineEnd": 51,
        "columnStart": 14,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 74
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 4,
        "columnEnd": 83
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 22
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 32,
        "lineEnd": 32,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 74
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 4,
        "columnEnd": 83
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 22
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 32,
        "lineEnd": 32,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 74
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 4,
        "columnEnd": 83
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 22
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 32,
        "lineEnd": 32,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 44
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 68
      }
    }
  ],
  "repairedDockerfile": "FROM docker:19.03 AS idocker\nRUN mv $(command -v  docker) /tmp/docker\n\nFROM ubuntu:20.04\n\nARG FRAMEWORK_TAG=master\nARG WEB_TAG=master\n\nWORKDIR /root/\n\nENV TARS_INSTALL  /usr/local/tars/cpp/deploy\n\nENV GOPATH=/usr/local/go\nENV DEBIAN_FRONTEND=noninteractive\nENV SWOOLE_VERSION=v4.4.16\n# Install\nRUN apt update\n\nCOPY --from=idocker /tmp/docker /usr/local/bin/docker\n\nRUN apt install --no-install-recommends -y mysql-client git build-essential unzip make golang cmake flex bison python3 \\\n\t&& apt install --no-install-recommends -y libprotobuf-dev libprotobuf-c-dev zlib1g-dev libssl-dev \\\n\t&& apt install --no-install-recommends -y curl wget net-tools iproute2 \\\n\t#intall php tars\n\t&& apt install --no-install-recommends -y php php-dev php-cli php-gd php-curl php-mysql \\\n\t&& apt install --no-install-recommends -y php-zip php-fileinfo php-redis php-mbstring tzdata git make wget \\\n\t&& apt install --no-install-recommends -y build-essential libmcrypt-dev php-pear \\\n\t# Get and install nodejs\n\t&& apt install --no-install-recommends -y npm \\\n\t&& npm install -g npm pm2 n \\\n\t&& n install v16.13.0 \\\n\t# Get and install JDK\n\t&& apt install --no-install-recommends -y openjdk-11-jdk \\\n\t&& apt clean && npm cache clean --force; && rm -rf /var/lib/apt/lists/*;\n\nRUN apt install --no-install-recommends -y python3 python3-pip maven \\\n\t&& pip3 install --no-cache-dir requests \\\n\t&& apt clean && rm -rf /var/lib/apt/lists/*;\n\n# Clone Tars repo and init php submodule\nRUN cd /root/ && git clone https://github.com/TarsCloud/Tars.git \\\n\t&& cd /root/Tars/ \\\n\t&& git submodule update --init --recursive php \\\n\t#intall PHP Tars module\n\t&& cd /root/Tars/php/tars-extension/ && phpize \\\n\t&& ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --enable-phptars && make && make install \\\n\t&& echo \"extension=phptars.so\" > /etc/php/7.4/cli/conf.d/10-phptars.ini \\\n\t# Install PHP swoole module\n\t&& cd /root && git clone https://github.com/swoole/swoole \\\n\t&& cd /root/swoole && git checkout $SWOOLE_VERSION \\\n\t&& cd /root/swoole \\\n\t&& phpize && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --with-php-config=/usr/bin/php-config \\\n\t&& make \\\n\t&& make install \\\n\t&& echo \"extension=swoole.so\" > /etc/php/7.4/cli/conf.d/20-swoole.ini \\\n\t# Do somethine clean\n\t&& cd /root && rm -rf swoole \\\n\t&& mkdir -p /root/phptars && cp -f /root/Tars/php/tars2php/src/tars2php.php /root/phptars\n\n# Install tars go\nRUN go get github.com/TarsCloud/TarsGo/tars \\\n\t&& cd $GOPATH/src/github.com/TarsCloud/TarsGo/tars/tools/tars2go \\\n\t&& go build .  \\\n\t&& mkdir -p /usr/local/go/bin \\\n\t&& chmod a+x /usr/local/go/src/github.com/TarsCloud/TarsGo/tars/tools/tars2go/tars2go \\\n\t&& ln -s /usr/local/go/src/github.com/TarsCloud/TarsGo/tars/tools/tars2go/tars2go /usr/local/go/bin/tars2go\n\nRUN mkdir -p /root/Tars && cd /root/Tars && git clone https://github.com/TarsCloud/TarsFramework framework --recursive && cd framework && git checkout $FRAMEWORK_TAG && git submodule update --init --recursive\nRUN cd /root/Tars && git clone https://github.com/TarsCloud/TarsWeb web && cd web && git checkout $WEB_TAG\n\nRUN cd /root/Tars/framework/build/ \\\n\t&& cmake .. && make -j4 && make install \\\n\t&& cp -rf /root/Tars/web /usr/local/tars/cpp/deploy/ \\\n\t&& rm -rf /root/Tars\n\nRUN /usr/local/tars/cpp/deploy/tar-server.sh\n\nENTRYPOINT [ \"/usr/local/tars/cpp/deploy/docker-init.sh\" ]\n\n#web\nEXPOSE 3000\n#tarslog\nEXPOSE 18993\n#tarspatch\nEXPOSE 18793\n#tarsqueryproperty\nEXPOSE 18693\n#tarsconfig\nEXPOSE 18193\n#tarsnotify\nEXPOSE 18593\n#tarsproperty\nEXPOSE 18493\n#tarsquerystat\nEXPOSE 18393\n#tarsstat\nEXPOSE 18293\n#tarsAdminRegistry\nEXPOSE 12000\n#tarsnode\nEXPOSE 19385\n#tarsregistry\nEXPOSE 17890\nEXPOSE 17891\n"
}