{
  "startTime": 1674251246693,
  "endTime": 1674251247227,
  "originalSmells": [
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 4,
        "columnEnd": 15
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG REGISTRY=docker.io\nARG ALPINE_VER=3\nARG GO_VER=1.17-alpine\n\nFROM --platform=$BUILDPLATFORM ${REGISTRY}/library/golang:${GO_VER} as golang\nRUN apk add --no-cache \\\n      ca-certificates \\\n      git \\\n      make\nRUN addgroup -g 1000 appuser \\\n && adduser -u 1000 -G appuser -D appuser \\\n && mkdir -p /home/appuser/.docker \\\n && chown -R appuser /home/appuser\nWORKDIR /src\n\nFROM --platform=$BUILDPLATFORM golang as dev\nCOPY --link . /src/\nENV PATH=${PATH}:/src/bin\nCMD make bin/regbot && bin/regbot\n\nFROM --platform=$BUILDPLATFORM dev as build\nARG TARGETOS\nARG TARGETARCH\nRUN --mount=type=cache,id=gomod,target=/go/pkg/mod/cache \\\n    --mount=type=cache,id=goroot,target=/root/.cache/go-build \\\n    GOOS=${TARGETOS} GOARCH=${TARGETARCH} \\\n    make bin/regbot\nUSER appuser\nCMD [ \"bin/regbot\" ]\n\nFROM scratch as artifact\nCOPY --link --from=build /src/bin/regbot /regbot\n\nFROM --platform=$BUILDPLATFORM golang as docker-cred-ecr-login\nARG TARGETOS\nARG TARGETARCH\nRUN --mount=type=cache,id=gomod,target=/go/pkg/mod/cache \\\n    --mount=type=cache,id=goroot,target=/root/.cache/go-build \\\n    GOOS=${TARGETOS} GOARCH=${TARGETARCH} \\\n    go install github.com/awslabs/amazon-ecr-credential-helper/ecr-login/cli/docker-credential-ecr-login@latest \\\n && ( cp \"${GOPATH}/bin/docker-credential-ecr-login\" /usr/local/bin/docker-credential-ecr-login \\\n   || cp \"${GOPATH}/bin/${TARGETOS}_${TARGETARCH}/docker-credential-ecr-login\" /usr/local/bin/docker-credential-ecr-login )\n\nFROM --platform=$BUILDPLATFORM golang as docker-cred-gcr\nARG TARGETOS\nARG TARGETARCH\nRUN --mount=type=cache,id=gomod,target=/go/pkg/mod/cache \\\n    --mount=type=cache,id=goroot,target=/root/.cache/go-build \\\n    GOOS=${TARGETOS} GOARCH=${TARGETARCH} \\\n    go install github.com/GoogleCloudPlatform/docker-credential-gcr@latest \\\n && ( cp \"${GOPATH}/bin/docker-credential-gcr\" /usr/local/bin/docker-credential-gcr \\\n   || cp \"${GOPATH}/bin/${TARGETOS}_${TARGETARCH}/docker-credential-gcr\" /usr/local/bin/docker-credential-gcr )\n\nFROM --platform=$BUILDPLATFORM ${REGISTRY}/library/alpine:${ALPINE_VER} as lua-mods\nRUN apk add --no-cache git \\\n && mkdir -p /lua /src \\\n && git clone https://github.com/grafi-tt/lunajson.git /src/json \\\n && git clone https://github.com/kikito/semver.lua.git /src/semver \\\n && cp -r /src/json/src/* /lua/ \\\n && cp /src/semver/semver.lua /lua/ \\\n && cd /lua \\\n && ln -s lunajson.lua json.lua\nCOPY --link cmd/regbot/lua/ /lua/\n\nFROM ${REGISTRY}/library/alpine:${ALPINE_VER} as release-alpine\nCOPY --link --from=build /etc/passwd /etc/group /etc/\nCOPY --link --from=build /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/\nCOPY --link --from=build --chown=1000:1000 /home/appuser /home/appuser\nCOPY --link --from=docker-cred-ecr-login /usr/local/bin/docker-credential-* /usr/local/bin/\nCOPY --link --from=docker-cred-gcr /usr/local/bin/docker-credential-* /usr/local/bin/\nCOPY --link --from=build /src/bin/regbot /usr/local/bin/regbot\nCOPY --link --from=lua-mods /lua /lua-mods\nENV LUA_PATH=\"?;?.lua;/lua-user/?;/lua-user/?.lua;/lua-mods/?;/lua-mods/?.lua\"\nUSER appuser\nCMD [ \"regbot\", \"--help\" ]\n\nARG BUILD_DATE\nARG VCS_REF\nLABEL maintainer=\"\" \\\n      org.opencontainers.image.created=$BUILD_DATE \\\n      org.opencontainers.image.authors=\"Regclient contributors\" \\\n      org.opencontainers.image.url=\"https://github.com/regclient/regclient\" \\\n      org.opencontainers.image.documentation=\"https://github.com/regclient/regclient\" \\\n      org.opencontainers.image.source=\"https://github.com/regclient/regclient\" \\\n      org.opencontainers.image.version=\"latest\" \\\n      org.opencontainers.image.revision=$VCS_REF \\\n      org.opencontainers.image.vendor=\"\" \\\n      org.opencontainers.image.licenses=\"Apache 2.0\" \\\n      org.opencontainers.image.title=\"regbot\" \\\n      org.opencontainers.image.description=\"\"\n\nFROM scratch as release-scratch\nADD  --link build/root.tgz /\nCOPY --link --from=build /etc/passwd /etc/group /etc/\nCOPY --link --from=build /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/\nCOPY --link --from=build --chown=1000:1000 /home/appuser/ /home/appuser/\nCOPY --link --from=build /src/bin/regbot /regbot\nCOPY --link --from=lua-mods /lua/ /lua-mods/\nENV LUA_PATH=\"?;?.lua;/lua-user/?;/lua-user/?.lua;/lua-mods/?;/lua-mods/?.lua\"\nUSER appuser\nENTRYPOINT [ \"/regbot\" ]\n\nARG BUILD_DATE\nARG VCS_REF\nLABEL maintainer=\"\" \\\n      org.opencontainers.image.created=$BUILD_DATE \\\n      org.opencontainers.image.authors=\"Regclient contributors\" \\\n      org.opencontainers.image.url=\"https://github.com/regclient/regclient\" \\\n      org.opencontainers.image.documentation=\"https://github.com/regclient/regclient\" \\\n      org.opencontainers.image.source=\"https://github.com/regclient/regclient\" \\\n      org.opencontainers.image.version=\"latest\" \\\n      org.opencontainers.image.revision=$VCS_REF \\\n      org.opencontainers.image.vendor=\"\" \\\n      org.opencontainers.image.licenses=\"Apache 2.0\" \\\n      org.opencontainers.image.title=\"regbot\" \\\n      org.opencontainers.image.description=\"\"\n"
}