{
  "startTime": 1674248124313,
  "endTime": 1674248125522,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 148,
        "lineEnd": 148,
        "columnStart": 5,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 116,
        "lineEnd": 116,
        "columnStart": 22,
        "columnEnd": 67
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 119,
        "lineEnd": 119,
        "columnStart": 22,
        "columnEnd": 103
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 27,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 10
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 116,
        "lineEnd": 116,
        "columnStart": 22,
        "columnEnd": 67
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 119,
        "lineEnd": 119,
        "columnStart": 22,
        "columnEnd": 103
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Copyright 2015 Google Inc.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Dockerfile for PHP 7.3/7.4/8.0 using nginx as the webserver.\n\nFROM gcr.io/gcp-runtimes/ubuntu_18_0_4\n\n# Install build scripts - composer, nginx, php\nCOPY build-scripts /build-scripts\n# Files for stackdriver setup\nCOPY stackdriver-files /stackdriver-files\n\nRUN chown -R www-data /build-scripts /stackdriver-files\n\nRUN apt-get update -y && \\\n    apt-get -y upgrade && \\\n    apt-get install -y --no-install-recommends \\\n    curl \\\n    libssl1.1 \\\n    openssl \\\n    gettext \\\n    git \\\n    libbz2-1.0 \\\n    libcurl3-gnutls \\\n    libev4 \\\n    libevent-2.1-6 \\\n    libevent-extra-2.1-6 \\\n    libevent-openssl-2.1-6 \\\n    libeio1 \\\n    libext2fs2 \\\n    # gd\n    libfontconfig1 \\\n    libfreetype6 \\\n    libxpm4 \\\n    libgd-dev \\\n    libgd3 \\\n    libgmp10 \\\n    libicu60 \\\n    libjpeg-turbo8 \\\n    libjudydebian1 \\\n    liblua5.3-0 \\\n    libmcrypt4 \\\n    libmemcached11 \\\n    libmemcachedutil2 \\\n    libonig4 \\\n    libexif12 \\\n    libpcre2-dev \\\n    libpcre3 \\\n    libpq5 \\\n    libreadline7 \\\n    librecode0 \\\n    libsasl2-modules \\\n    libsodium23 \\\n    libsqlite3-0 \\\n    libtiff5 \\\n    libwrap0 \\\n    libxml2 \\\n    libxslt1.1 \\\n    libyaml-0-2 \\\n    libzip4 \\\n    imagemagick \\\n    mercurial \\\n    # vips\n    liborc-0.4-0 \\\n    libgif7 \\\n    libglib2.0-0 \\\n    libgsf-1-114 \\\n    libjpeg8 \\\n    liblcms2-2 \\\n    libmatio4 \\\n    libpng16-16 \\\n    libpoppler-glib8 \\\n    librsvg2-2 \\\n    libwebp6 \\\n    libcairo2 \\\n    libcfitsio5 \\\n    fftw3 \\\n    libopenexr22 \\\n    libopenslide0 \\\n    libpango-1.0-0 \\\n    libwebpdemux2 \\\n    libwebpmux3 \\\n    libvips42 \\\n    # nginx-extras \\\n    gnupg \\\n    ca-certificates \\\n    sasl2-bin \\\n    subversion \\\n    supervisor \\\n    wget \\\n    software-properties-common \\\n    apt-transport-https \\\n    unzip \\\n    zip \\\n    zlib1g && \\\n    /bin/bash /build-scripts/apt-cleanup.sh && rm -rf /var/lib/apt/lists/*;\n\nRUN wget https://downloads.datastax.com/cpp-driver/ubuntu/18.04/dependencies/libuv/v1.35.0/libuv1_1.35.0-1_amd64.deb && \\\n        dpkg -i libuv1_1.35.0-1_amd64.deb\n\nRUN wget https://downloads.datastax.com/cpp-driver/ubuntu/18.04/dependencies/libuv/v1.35.0/libuv1-dev_1.35.0-1_amd64.deb && \\\n        dpkg -i libuv1-dev_1.35.0-1_amd64.deb\n\nRUN wget -qO - https://packages.confluent.io/deb/5.0/archive.key | apt-key add - && \\\n    add-apt-repository \"deb [arch=amd64] https://packages.confluent.io/deb/5.0 stable main\" && \\\n    apt-get update && apt-get install --no-install-recommends -y librdkafka-dev librdkafka1 && rm -rf /var/lib/apt/lists/*;\n\nRUN add-apt-repository ppa:ondrej/nginx-mainline -y && \\\n    apt-get update && apt-get install --no-install-recommends -y nginx-core nginx-common nginx nginx-full libnginx-mod-http-lua && \\\n    nginx -V && rm -rf /var/lib/apt/lists/*;\n\nENV NGINX_DIR=/etc/nginx \\\n    PHP_DIR=/opt/php \\\n    PHP_CONFIG_TEMPLATE=/opt/php-configs \\\n    PHP73_DIR=/opt/php73 \\\n    PHP74_DIR=/opt/php74 \\\n    PHP80_DIR=/opt/php80 \\\n    APP_DIR=/app \\\n    NGINX_USER_CONF_DIR=/etc/nginx/conf.d \\\n    UPLOAD_DIR=/upload \\\n    SESSION_SAVE_PATH=/tmp/sessions \\\n    PATH=/opt/php/bin:$PATH \\\n    WWW_HOME=/var/www \\\n    COMPOSER_HOME=/opt/composer \\\n    DOCUMENT_ROOT=/app \\\n    FRONT_CONTROLLER_FILE=index.php\n\nARG RUNTIME_DISTRIBUTION=\"gcp-php-runtime-bionic-unstable\"\n\nCOPY ${RUNTIME_DISTRIBUTION} /${RUNTIME_DISTRIBUTION}\n\nRUN mkdir -p $PHP_CONFIG_TEMPLATE\nCOPY php-fpm.conf php.ini php-cli.ini \"${PHP_CONFIG_TEMPLATE}/\"\n\nRUN apt-get -y update && \\\n\tdpkg -i --force-depends /${RUNTIME_DISTRIBUTION}/*.deb && \\\n\tapt-get install -yf --no-install-recommends && \\\n    ( curl -f https://packages.cloud.google.com/apt/doc/apt-key.gpg \\\n    | apt-key add -) && \\\n\t/bin/bash /build-scripts/dump_php_versions.sh && \\\n\t/bin/bash /build-scripts/apt-cleanup.sh && \\\n\trm -rf /${RUNTIME_DISTRIBUTION}\n\nEXPOSE 8080\n\n# Lock down the web directories\nRUN mkdir -p $APP_DIR $UPLOAD_DIR $SESSION_SAVE_PATH \\\n        $NGINX_USER_CONF_DIR $WWW_HOME $COMPOSER_HOME \\\n    && chown -R www-data.www-data \\\n        $APP_DIR $UPLOAD_DIR $SESSION_SAVE_PATH \\\n        $NGINX_USER_CONF_DIR $WWW_HOME $COMPOSER_HOME \\\n    && chmod 755 $UPLOAD_DIR $SESSION_SAVE_PATH $COMPOSER_HOME \\\n    && ln -sf ${PHP_DIR}/bin/php /usr/bin/php\n# Linking for easy access to php with `su www-data -c $CMD`\n\n# Put other config and shell files into place.\nCOPY nginx.conf fastcgi_params gzip_params \"${NGINX_DIR}/\"\nCOPY nginx-app.conf nginx-http.conf \"${NGINX_USER_CONF_DIR}/\"\nCOPY supervisord.conf /etc/supervisor/supervisord.conf\n\nRUN chmod +x /build-scripts/entrypoint.sh /build-scripts/composer.sh\n\nWORKDIR $APP_DIR\n\nCMD [\"/usr/bin/supervisord\", \"-c\", \"/etc/supervisor/supervisord.conf\"]\n"
}