{
  "startTime": 1674216632307,
  "endTime": 1674216634256,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 144,
        "lineEnd": 147,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 148,
        "lineEnd": 148,
        "columnStart": 4,
        "columnEnd": 89
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 149,
        "lineEnd": 149,
        "columnStart": 4,
        "columnEnd": 25
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 167,
        "lineEnd": 170,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 65,
        "lineEnd": 65,
        "columnStart": 4,
        "columnEnd": 117
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 87,
        "lineEnd": 87,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 103,
        "lineEnd": 103,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 119,
        "lineEnd": 119,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 135,
        "lineEnd": 135,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 156,
        "lineEnd": 156,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 174,
        "lineEnd": 174,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 204,
        "lineEnd": 204,
        "columnStart": 4,
        "columnEnd": 117
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 210,
        "lineEnd": 210,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 229,
        "lineEnd": 229,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 24,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 40,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 57,
        "lineEnd": 60,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 80,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 96,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 112,
        "lineEnd": 115,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 128,
        "lineEnd": 131,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 24,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 40,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 57,
        "lineEnd": 60,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 80,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 96,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 112,
        "lineEnd": 115,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 128,
        "lineEnd": 131,
        "columnStart": 4,
        "columnEnd": 49
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Copyright 2020 Google LLC\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     https://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n# Build as DOCKER_BUILDKIT=1 docker build -o /tmp/out .\n# or DOCKER_BUILDKIT=1 docker build -o /tmp/out . --target=buster\n# Generated tarball(s) will end up in /tmp/out\n\nFROM debian:bullseye AS bullseye-build\n\n# TODO: Factor out the common code without rerunning apt-get on every debian and\n# ubuntu build.\n\nRUN set -x; apt-get update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install git systemd \\\n    autoconf libtool libcurl4-openssl-dev libltdl-dev libssl-dev libyajl-dev \\\n    build-essential cmake bison flex file libsystemd-dev \\\n    devscripts cdbs pkg-config openjdk-11-jdk zip && rm -rf /var/lib/apt/lists/*;\n\nADD https://golang.org/dl/go1.17.linux-amd64.tar.gz /tmp/go1.17.linux-amd64.tar.gz\nRUN set -xe; \\\n    tar -xf /tmp/go1.17.linux-amd64.tar.gz -C /usr/local && rm /tmp/go1.17.linux-amd64.tar.gz\n\nCOPY . /work\nWORKDIR /work\nRUN ./pkg/deb/build.sh\n\nFROM debian:buster AS buster-build\n\nRUN set -x; apt-get update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install git systemd \\\n    autoconf libtool libcurl4-openssl-dev libltdl-dev libssl-dev libyajl-dev \\\n    build-essential cmake bison flex file libsystemd-dev \\\n    devscripts cdbs pkg-config openjdk-11-jdk zip && rm -rf /var/lib/apt/lists/*;\n\nADD https://golang.org/dl/go1.17.linux-amd64.tar.gz /tmp/go1.17.linux-amd64.tar.gz\nRUN set -xe; \\\n    tar -xf /tmp/go1.17.linux-amd64.tar.gz -C /usr/local && rm /tmp/go1.17.linux-amd64.tar.gz\n\nCOPY . /work\nWORKDIR /work\nRUN ./pkg/deb/build.sh\n\nFROM debian:stretch AS stretch-build\n\nRUN set -x; \\\n    apt-get update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install git systemd \\\n    autoconf libtool libcurl4-openssl-dev libltdl-dev libssl1.0-dev libyajl-dev \\\n    build-essential cmake bison flex file libsystemd-dev \\\n    devscripts cdbs pkg-config zip && rm -rf /var/lib/apt/lists/*;\n\nADD https://github.com/adoptium/temurin11-binaries/releases/download/jdk-11.0.13%2B8/OpenJDK11U-jdk_x64_linux_hotspot_11.0.13_8.tar.gz /tmp/OpenJDK11U-jdk_x64_linux_hotspot_11.0.13_8.tar.gz\nRUN set -xe; \\\n    mkdir -p /usr/local/java-11-openjdk && \\\n    tar -xf /tmp/OpenJDK11U-jdk_x64_linux_hotspot_11.0.13_8.tar.gz -C /usr/local/java-11-openjdk --strip-components=1 && rm /tmp/OpenJDK11U-jdk_x64_linux_hotspot_11.0.13_8.tar.gz\n\nENV JAVA_HOME /usr/local/java-11-openjdk/\n\nADD https://golang.org/dl/go1.17.linux-amd64.tar.gz /tmp/go1.17.linux-amd64.tar.gz\nRUN set -xe; \\\n    tar -xf /tmp/go1.17.linux-amd64.tar.gz -C /usr/local && rm /tmp/go1.17.linux-amd64.tar.gz\n\nCOPY . /work\nWORKDIR /work\nRUN ./pkg/deb/build.sh\n\nFROM ubuntu:jammy AS jammy-build\n\nRUN set -x; apt-get update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install git systemd \\\n    autoconf libtool libcurl4-openssl-dev libltdl-dev libssl-dev libyajl-dev \\\n    build-essential cmake bison flex file libsystemd-dev \\\n    devscripts cdbs pkg-config openjdk-11-jdk zip && rm -rf /var/lib/apt/lists/*;\n\nADD https://golang.org/dl/go1.17.linux-amd64.tar.gz /tmp/go1.17.linux-amd64.tar.gz\nRUN set -xe; \\\n    tar -xf /tmp/go1.17.linux-amd64.tar.gz -C /usr/local && rm /tmp/go1.17.linux-amd64.tar.gz\n\nCOPY . /work\nWORKDIR /work\nRUN ./pkg/deb/build.sh\n\nFROM ubuntu:impish AS impish-build\n\nRUN set -x; apt-get update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install git systemd \\\n    autoconf libtool libcurl4-openssl-dev libltdl-dev libssl-dev libyajl-dev \\\n    build-essential cmake bison flex file libsystemd-dev \\\n    devscripts cdbs pkg-config openjdk-11-jdk zip && rm -rf /var/lib/apt/lists/*;\n\nADD https://golang.org/dl/go1.17.linux-amd64.tar.gz /tmp/go1.17.linux-amd64.tar.gz\nRUN set -xe; \\\n    tar -xf /tmp/go1.17.linux-amd64.tar.gz -C /usr/local && rm /tmp/go1.17.linux-amd64.tar.gz\n\nCOPY . /work\nWORKDIR /work\nRUN ./pkg/deb/build.sh\n\nFROM ubuntu:focal AS focal-build\n\nRUN set -x; apt-get update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install git systemd \\\n    autoconf libtool libcurl4-openssl-dev libltdl-dev libssl-dev libyajl-dev \\\n    build-essential cmake bison flex file libsystemd-dev \\\n    devscripts cdbs pkg-config openjdk-11-jdk zip && rm -rf /var/lib/apt/lists/*;\n\nADD https://golang.org/dl/go1.17.linux-amd64.tar.gz /tmp/go1.17.linux-amd64.tar.gz\nRUN set -xe; \\\n    tar -xf /tmp/go1.17.linux-amd64.tar.gz -C /usr/local && rm /tmp/go1.17.linux-amd64.tar.gz\n\nCOPY . /work\nWORKDIR /work\nRUN ./pkg/deb/build.sh\n\nFROM ubuntu:bionic AS bionic-build\n\nRUN set -x; apt-get update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install git systemd \\\n    autoconf libtool libcurl4-openssl-dev libltdl-dev libssl-dev libyajl-dev \\\n    build-essential cmake bison flex file libsystemd-dev \\\n    devscripts cdbs pkg-config openjdk-11-jdk zip && rm -rf /var/lib/apt/lists/*;\n\nADD https://golang.org/dl/go1.17.linux-amd64.tar.gz /tmp/go1.17.linux-amd64.tar.gz\nRUN set -xe; \\\n    tar -xf /tmp/go1.17.linux-amd64.tar.gz -C /usr/local && rm /tmp/go1.17.linux-amd64.tar.gz\n\nCOPY . /work\nWORKDIR /work\nRUN ./pkg/deb/build.sh\n\nFROM centos:7 AS centos7-build\n\nRUN set -x; yum -y update && \\\n    yum -y install git systemd \\\n    autoconf libtool libcurl-devel libtool-ltdl-devel openssl-devel yajl-devel \\\n    gcc gcc-c++ make bison flex file systemd-devel zlib-devel gtest-devel rpm-build java-11-openjdk-devel \\\n    expect rpm-sign zip && \\\n    yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm && \\\n    yum install -y cmake3 && \\\n    ln -fs cmake3 /usr/bin/cmake && rm -rf /var/cache/yum\n\nENV JAVA_HOME /usr/lib/jvm/java-11-openjdk/\n\nADD https://golang.org/dl/go1.17.linux-amd64.tar.gz /tmp/go1.17.linux-amd64.tar.gz\nRUN set -xe; \\\n    tar -xf /tmp/go1.17.linux-amd64.tar.gz -C /usr/local && rm /tmp/go1.17.linux-amd64.tar.gz\n\nCOPY . /work\nWORKDIR /work\nRUN ./pkg/rpm/build.sh\n\nFROM rockylinux:8 AS centos8-build\n\nRUN set -x; yum -y update && \\\n    dnf -y install 'dnf-command(config-manager)' && \\\n    yum config-manager --set-enabled powertools && \\\n    yum -y install git systemd \\\n    autoconf libtool libcurl-devel libtool-ltdl-devel openssl-devel yajl-devel \\\n    gcc gcc-c++ make cmake bison flex file systemd-devel zlib-devel gtest-devel rpm-build systemd-rpm-macros java-11-openjdk-devel \\\n    expect rpm-sign zip && rm -rf /var/cache/yum\n\nADD https://golang.org/dl/go1.17.linux-amd64.tar.gz /tmp/go1.17.linux-amd64.tar.gz\nRUN set -xe; \\\n    tar -xf /tmp/go1.17.linux-amd64.tar.gz -C /usr/local && rm /tmp/go1.17.linux-amd64.tar.gz\n\nCOPY . /work\nWORKDIR /work\nRUN ./pkg/rpm/build.sh\n\n# Use OpenSUSE Leap 42.3 to emulate SLES 12: https://en.opensuse.org/openSUSE:Build_Service_cross_distribution_howto#Detect_a_distribution_flavor_for_special_code\nFROM opensuse/archive:42.3 AS sles12-build\n\nRUN set -x; \\\n    # The 'OSS Update' repo signature is no longer valid, so verify the checksum instead.\n    zypper --no-gpg-check refresh 'OSS Update' && \\\n    (echo 'b889b4bba03074cd66ef9c0184768f4816d4ccb1fa9ec2721c5583304c5f23d0  /var/cache/zypp/raw/OSS Update/repodata/repomd.xml' | sha256sum --check) && \\\n    zypper -n install git systemd autoconf automake flex libtool libcurl-devel libopenssl-devel libyajl-devel gcc gcc-c++ zlib-devel rpm-build expect cmake systemd-devel systemd-rpm-macros unzip zip && \\\n    # Remove expired root certificate.\n    mv /var/lib/ca-certificates/pem/DST_Root_CA_X3.pem /etc/pki/trust/blacklist/ && \\\n    update-ca-certificates && \\\n    # Add home:Ledest:devel repo to install >3.4 bison\n    zypper addrepo https://download.opensuse.org/repositories/home:Ledest:devel/openSUSE_Leap_42.3/home:Ledest:devel.repo && \\\n    zypper -n --gpg-auto-import-keys refresh && \\\n    zypper -n update && \\\n    # zypper/libcurl has a use-after-free bug that causes segfaults for particular download sequences.\n    # If this bug happens to trigger in the future, adding a \"zypper -n download\" of a subset of the packages can avoid the segfault.\n    zypper -n install bison>3.4 && \\\n    # Allow fluent-bit to find systemd\n    ln -fs /usr/lib/systemd /lib/systemd\n\nADD https://github.com/adoptium/temurin11-binaries/releases/download/jdk-11.0.13%2B8/OpenJDK11U-jdk_x64_linux_hotspot_11.0.13_8.tar.gz /tmp/OpenJDK11U-jdk_x64_linux_hotspot_11.0.13_8.tar.gz\nRUN set -xe; \\\n    mkdir -p /usr/local/java-11-openjdk && \\\n    tar -xf /tmp/OpenJDK11U-jdk_x64_linux_hotspot_11.0.13_8.tar.gz -C /usr/local/java-11-openjdk --strip-components=1 && rm /tmp/OpenJDK11U-jdk_x64_linux_hotspot_11.0.13_8.tar.gz\n\nENV JAVA_HOME /usr/local/java-11-openjdk/\n\nADD https://golang.org/dl/go1.17.linux-amd64.tar.gz /tmp/go1.17.linux-amd64.tar.gz\nRUN set -xe; \\\n    tar -xf /tmp/go1.17.linux-amd64.tar.gz -C /usr/local && rm /tmp/go1.17.linux-amd64.tar.gz\n\nCOPY . /work\nWORKDIR /work\nRUN ./pkg/rpm/build.sh\n\nFROM opensuse/leap:15.1 AS sles15-build\n\nRUN set -x; zypper -n install git systemd autoconf automake flex libtool libcurl-devel libopenssl-devel libyajl-devel gcc gcc-c++ zlib-devel rpm-build expect cmake systemd-devel systemd-rpm-macros java-11-openjdk-devel unzip zip && \\\n    # Add home:ptrommler:formal repo to install >3.4 bison\n    zypper addrepo https://download.opensuse.org/repositories/home:ptrommler:formal/openSUSE_Leap_15.1/home:ptrommler:formal.repo && \\\n    zypper -n --gpg-auto-import-keys refresh && \\\n    zypper -n update && \\\n    zypper -n install bison>3.4 && \\\n    # Allow fluent-bit to find systemd\n    ln -fs /usr/lib/systemd /lib/systemd\n\nADD https://golang.org/dl/go1.17.linux-amd64.tar.gz /tmp/go1.17.linux-amd64.tar.gz\nRUN set -xe; \\\n    tar -xf /tmp/go1.17.linux-amd64.tar.gz -C /usr/local && rm /tmp/go1.17.linux-amd64.tar.gz\n\nCOPY . /work\nWORKDIR /work\nRUN ./pkg/rpm/build.sh\n\nFROM scratch AS bullseye\nCOPY --from=bullseye-build /tmp/google-cloud-ops-agent.tgz /google-cloud-ops-agent-debian-bullseye.tgz\nCOPY --from=bullseye-build /google-cloud-ops-agent*.deb /\n\nFROM scratch AS buster\nCOPY --from=buster-build /tmp/google-cloud-ops-agent.tgz /google-cloud-ops-agent-debian-buster.tgz\nCOPY --from=buster-build /google-cloud-ops-agent*.deb /\n\nFROM scratch AS stretch\nCOPY --from=stretch-build /tmp/google-cloud-ops-agent.tgz /google-cloud-ops-agent-debian-stretch.tgz\nCOPY --from=stretch-build /google-cloud-ops-agent*.deb /\n\nFROM scratch AS jammy\nCOPY --from=jammy-build /tmp/google-cloud-ops-agent.tgz /google-cloud-ops-agent-ubuntu-jammy.tgz\nCOPY --from=jammy-build /google-cloud-ops-agent*.deb /\n\nFROM scratch AS impish\nCOPY --from=impish-build /tmp/google-cloud-ops-agent.tgz /google-cloud-ops-agent-ubuntu-impish.tgz\nCOPY --from=impish-build /google-cloud-ops-agent*.deb /\n\nFROM scratch AS focal\nCOPY --from=focal-build /tmp/google-cloud-ops-agent.tgz /google-cloud-ops-agent-ubuntu-focal.tgz\nCOPY --from=focal-build /google-cloud-ops-agent*.deb /\n\nFROM scratch AS bionic\nCOPY --from=bionic-build /tmp/google-cloud-ops-agent.tgz /google-cloud-ops-agent-ubuntu-bionic.tgz\nCOPY --from=bionic-build /google-cloud-ops-agent*.deb /\n\nFROM scratch AS centos7\nCOPY --from=centos7-build /tmp/google-cloud-ops-agent.tgz /google-cloud-ops-agent-centos-7.tgz\nCOPY --from=centos7-build /google-cloud-ops-agent*.rpm /\n\nFROM scratch AS centos8\nCOPY --from=centos8-build /tmp/google-cloud-ops-agent.tgz /google-cloud-ops-agent-centos-8.tgz\nCOPY --from=centos8-build /google-cloud-ops-agent*.rpm /\n\nFROM scratch AS sles12\nCOPY --from=sles12-build /tmp/google-cloud-ops-agent.tgz /google-cloud-ops-agent-sles-12.tgz\nCOPY --from=sles12-build /google-cloud-ops-agent*.rpm /\n\nFROM scratch AS sles15\nCOPY --from=sles15-build /tmp/google-cloud-ops-agent.tgz /google-cloud-ops-agent-sles-15.tgz\nCOPY --from=sles15-build /google-cloud-ops-agent*.rpm /\n\nFROM scratch\nCOPY --from=bullseye /* /\nCOPY --from=buster /* /\nCOPY --from=stretch /* /\nCOPY --from=impish /* /\nCOPY --from=focal /* /\nCOPY --from=bionic /* /\nCOPY --from=centos7 /* /\nCOPY --from=centos8 /* /\nCOPY --from=sles12 /* /\nCOPY --from=sles15 /* /\n"
}