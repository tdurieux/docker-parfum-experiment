{
  "startTime": 1674249852914,
  "endTime": 1674249854474,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 72
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 11,
        "lineEnd": 11,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 11,
        "lineEnd": 11,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 11,
        "lineEnd": 11,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 31
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 11,
        "lineEnd": 11,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 55
      }
    }
  ],
  "repairedDockerfile": "FROM ascotbe/medusa:latest\nMAINTAINER ascotbe\n#所有启动服务放在run.sh中用RUN结束后会终止该命令\n#安装所需的包\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt-get clean\nRUN echo \"deb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse\\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse\\ndeb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse\\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse\\ndeb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse\\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse\\ndeb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse\\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse\\ndeb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse\\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse\\n\" > /etc/apt/sources.list\nRUN dpkg --add-architecture i386\nRUN apt-get update\nRUN apt-get install --no-install-recommends wine -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends wine32 -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends libwine -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends git -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends nodejs -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends npm -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends nginx -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends redis -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends python3 -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends python3-pip -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends mingw-w64 -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends golang-go -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends nim -y && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends sendmail -y && rm -rf /var/lib/apt/lists/*;\n#修改Redis密码\nRUN sed -i \"s/# requirepass foobared/requirepass redis_passwd123/g\" /etc/redis/redis.conf\n#copy压缩包后解压到制定路径\nADD ./Medusa.tat.gz /Medusa\n#修改你nginx的配置\nRUN echo \"server {\\n    listen       443 ssl;\\n    server_name  medusa.ascotbe.com;\\n    ssl_certificate     /etc/nginx/cert/ssl.pem;  \\n    ssl_certificate_key  /etc/nginx/cert/ssl.key;\\n    client_max_body_size 100m;\\n    ssl_session_timeout  5m;    \\n    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;    \\n    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;    \\n    ssl_prefer_server_ciphers on;\\n    gzip on;\\n    gzip_min_length 1k;\\n    gzip_comp_level 5;\\n    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript image/jpeg image/gif image/png application/vnd.ms-fontobject font/ttf font/opentype font/x-woff image/svg+xml;\\n    gzip_vary on;\\n    gzip_disable \\\"MSIE [1-6]\\\\.\\\";\\n       gzip_buffers 32 4k;\\n    location / {\\n                \\n        root   /var/www/html/dist;\\n        index  index.html;\\n    }\\n    location /api {\\n                proxy_pass http://127.0.0.1:9999/api;\\n    }\\n    location /s {\\n                proxy_pass http://127.0.0.1:9999/s;\\n    }\\n    location /a {\\n                proxy_pass http://127.0.0.1:9999/a;\\n    }\\n    location /b {\\n                proxy_pass http://127.0.0.1:9999/b;\\n    }\\n}\\nserver {\\n    listen       80;\\n    server_name  medusa.ascotbe.com;\\n    location / {\\n                \\n        root   /var/www/html/dist;\\n        index  index.html;\\n    }\\n    location /api {\\n                proxy_pass http://127.0.0.1:9999/api;\\n    }\\n    location /s {\\n                proxy_pass http://127.0.0.1:9999/s;\\n    }\\n    location /a {\\n                proxy_pass http://127.0.0.1:9999/a;\\n    }\\n    location /b {\\n                proxy_pass http://127.0.0.1:9999/b;\\n    }\\n}\\nserver {\\n    listen       80;\\n    client_max_body_size 100m;\\n    server_name  dnslogtest.ascotbe.com;\\n    gzip on;\\n    gzip_min_length 1k;\\n    gzip_comp_level 5;\\n    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript image/jpeg image/gif image/png application/vnd.ms-fontobject font/ttf font/opentype font/x-woff image/svg+xml;\\n    gzip_vary on;\\n    gzip_disable \\\"MSIE [1-6]\\\\.\\\";\\n       gzip_buffers 32 4k;\\n    location / {\\n        proxy_pass  http://127.0.0.1:8888; \\n        proxy_set_header Host \\$host;\\n              proxy_set_header X-Real-IP \\$remote_addr; \\n        proxy_set_header x-forwarded-for \\$proxy_add_x_forwarded_for;       \\n    }\\n}\\nserver {\\n    listen       80;\\n    client_max_body_size 100m;\\n    server_name  *.dnslogtest.ascotbe.com;\\n    location / {\\n        proxy_pass  http://127.0.0.1:8888;\\n        proxy_set_header Host \\$host;\\n              proxy_set_header X-Real-IP \\$remote_addr;\\n        proxy_set_header x-forwarded-for \\$proxy_add_x_forwarded_for;      \\n    }\\n}\" > /etc/nginx/sites-enabled/default\nRUN sed -i \"s/medusa.ascotbe.com/this_is_you_domain_name/g\" /etc/nginx/sites-enabled/default\nRUN sed -i \"s/dnslogtest.ascotbe.com/this_is_your_dnslog_name/g\" /etc/nginx/sites-enabled/default\n#修改邮服配置\nRUN sed -i \"s/Family=inet,  Name=MTA-v4, Port=smtp, Addr=127.0.0.1/Family=inet,  Name=MTA-v4, Port=smtp, Addr=0.0.0.0/g\" /etc/mail/sendmail.mc\nRUN sed -i \"s/Family=inet,  Name=MSP-v4, Port=submission, M=Ea, Addr=127.0.0.1/Family=inet,  Name=MSP-v4, Port=submission, M=Ea, Addr=0.0.0.0/g\" /etc/mail/sendmail.mc\nRUN echo \"\\nthis_is_your_mail_server_domain_name\\nmail.this_is_your_mail_server_domain_name\" >> /etc/mail/local-host-names\n#生成流\nRUN m4 /etc/mail/sendmail.mc > /etc/mail/sendmail.cf\n#安装配置vue\nWORKDIR /Medusa/Vue/\nRUN rm -rf package-lock.json\nRUN npm install highcharts --save --registry=http://registry.cnpmjs.org && npm cache clean --force;\nRUN npm run build\nRUN mv dist/ /var/www/html/\nWORKDIR /etc/nginx/\nRUN mkdir cert/\n#配置HTTPS证书\nWORKDIR /Medusa\nRUN mv ssl.pem /etc/nginx/cert/\nRUN mv ssl.key /etc/nginx/cert/\n#安装后端所需的包\nRUN python3 -m pip install -r Medusa.txt -i https://pypi.tuna.tsinghua.edu.cn/simple\n#生成脚本\nRUN echo \"#!/bin/bash\\npython3 -c 'from Web.CVE.NistMonitoring.NistInitialization import NistInitialization;from Web.ActiveScan import InitializationPlugin;InitializationPlugin.Run();NistInitialization();from manage import InitialConfiguration;InitialConfiguration()'\\nredis-server /etc/redis/redis.conf &\\nservice sendmail start &\\npython3 DNSServer.py &\\npython3 HTTPServer.py &\\ncelery -A Web worker -B --loglevel=info --pool=solo &\\nnginx &\\ngunicorn Web.wsgi:application --bind 0.0.0.0:9999 --workers 6\" > run.sh\n#启动运行脚本\nRUN chmod +x run.sh\nCMD ./run.sh"
}