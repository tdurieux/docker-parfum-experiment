{
  "startTime": 1674220710801,
  "endTime": 1674220711766,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 11,
        "lineEnd": 11,
        "columnStart": 4,
        "columnEnd": 42
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG BASE=registry.access.redhat.com/ubi8/ubi:8.5\nFROM $BASE\n\nLABEL com.ibm.name=\"IBM Spectrum Scale bridge for Grafana\"\nLABEL com.ibm.vendor=\"IBM\"\nLABEL com.ibm.description=\"This tool translates the IBM Spectrum Scale performance data collected internally \\\nto the query requests acceptable by the Grafana integrated openTSDB plugin\"\nLABEL com.ibm.summary=\"It allows the IBM Spectrum Scale users to perform performance monitoring for IBM Spectrum Scale devices using Grafana\"\n\nCOPY ./requirements/requirements_ubi8.txt  /root/requirements_ubi8.txt\n\nRUN yum install -y python36 python36-devel && rm -rf /var/cache/yum\nRUN /usr/bin/pip3 install --upgrade pip\n\nRUN /usr/bin/pip3 install -r /root/requirements_ubi8.txt\nRUN echo \"Installed python version: $(/usr/bin/python3 -V)\"\nRUN echo \"Installed python packages: $(/usr/bin/pip3 list)\"\n\nUSER root\n\nRUN mkdir -p /opt/IBM/bridge\nRUN mkdir -p /opt/IBM/zimon\nRUN mkdir -p /var/mmfs/gen\nRUN mkdir -p /etc/ssl/certs\nRUN mkdir -p /etc/perfmon-api-keys\n\nCOPY LICENSE /licenses/\n\nCOPY ./source/ /opt/IBM/bridge\nCOPY ./source/gpfsConfig/mmsdrfs* /var/mmfs/gen/\nCOPY ./source/gpfsConfig/ZIMon* /opt/IBM/zimon/\n\nARG HTTPPROTOCOL=http\nENV PROTOCOL=$HTTPPROTOCOL\nRUN echo \"the HTTP/S protocol is set to $PROTOCOL\"\n\nARG HTTPPORT=4242\nENV PORT=$HTTPPORT\nRUN echo \"the HTTP/S port is set to $PORT\"\n\nARG PERFMONPORT=9980\nENV SERVERPORT=$PERFMONPORT\nRUN echo \"the PERFMONPORT port is set to $SERVERPORT\"\n\nARG CERTPATH='/etc/bridge_ssl/certs'\nENV TLSKEYPATH=$CERTPATH\nRUN mkdir -p $CERTPATH\n\nARG KEYFILE=None\nENV TLSKEYFILE=$KEYFILE\n\nARG CERTFILE=None\nENV TLSCERTFILE=$CERTFILE\n\nARG KEYNAME=None\nENV APIKEYNAME=$KEYNAME\n\nARG KEYVALUE=None\nENV APIKEYVALUE=$KEYVALUE\nRUN if [ \"${APIKEYVALUE:0:1}\" = \"/\" ]; then ln -s $APIKEYVALUE /etc/perfmon-api-keys; echo \"APIKEYVALUE is a PATH\"; else echo \"APIKEYVALUE not a PATH\"; fi\n\nRUN if [ -z \"$TLSKEYPATH\" ] || [ -z \"$TLSCERTFILE\" ] || [ -z \"$TLSKEYFILE\" ] && [ \"$PROTOCOL\" = \"https\" ]; then echo \"TLSKEYPATH FOR SSL CONNECTION NOT SET - ERROR\"; exit 1; else echo \"PASS\"; fi\nRUN echo \"the ssl certificates path is set to $TLSKEYPATH\"\n\nARG PMCOLLECTORIP=0.0.0.0\nENV SERVER=$PMCOLLECTORIP\nRUN echo \"the pmcollector server ip is set to $SERVER\"\n\nARG DEFAULTLOGPATH='/var/log/ibm_bridge_for_grafana'\nENV LOGPATH=$DEFAULTLOGPATH\nRUN mkdir -p $LOGPATH\nRUN echo \"the log will use $LOGPATH\"\n\n# Switch to the working directory\nWORKDIR /opt/IBM/bridge\nRUN echo \"$(pwd)\"\n\n# Create a user 'bridge' under 'root' group\nRUN groupadd -g 2099 bridge\nRUN useradd -rm -d /home/2001 -s /bin/bash -g 2099 -u 2001 bridge\n\n# Chown all the files to the grafanabridge 'bridge' user\nRUN chown -R 2001:2099 /opt/IBM/bridge\nRUN chown -R 2001:2099 /opt/IBM/zimon\nRUN chown -R 2001:2099 /var/mmfs/gen\nRUN chown -R 2001:2099 /etc/ssl/certs\nRUN chown -R 2001:2099 /etc/perfmon-api-keys\nRUN chown -R 2001:2099 $TLSKEYPATH\nRUN chown -R 2001:2099 $LOGPATH\n\n# Switch to user 'bridge'\nUSER 2001\n\n\nCMD [\"sh\", \"-c\", \"python3 zimonGrafanaIntf.py -c 10 -s $SERVER -r $PROTOCOL -p $PORT -P $SERVERPORT -t $TLSKEYPATH -l $LOGPATH --tlsKeyFile $TLSKEYFILE --tlsCertFile $TLSCERTFILE --apiKeyName $APIKEYNAME --apiKeyValue $APIKEYVALUE\"]\n\nEXPOSE 4242 8443\n\n#CMD [\"tail\", \"-f\", \"/dev/null\"]\n"
}