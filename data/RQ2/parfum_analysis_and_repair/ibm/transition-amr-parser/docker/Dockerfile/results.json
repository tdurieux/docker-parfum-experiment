{
  "startTime": 1674249438532,
  "endTime": 1674249439674,
  "originalSmells": [
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 3,
        "lineEnd": 3,
        "columnStart": 28,
        "columnEnd": 125
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 3,
        "lineEnd": 3,
        "columnStart": 28,
        "columnEnd": 125
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "## install cuda\nFROM nvidia/cuda as ubuntu-pytorch\n## some basic utilities\nRUN apt-get -q -y update && DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -q -y install curl vim locales lsb-release python3-pip ssh && apt-get clean && rm -rf /var/lib/apt/lists/*;\n## add locale\nRUN locale-gen en_US.UTF-8 && /usr/sbin/update-locale LANG=en_US.UTF-8\nENV LANG en_US.UTF-8\nENV LANGUAGE en_US:en\nENV LC_ALL en_US.UTF-8\n## Install grpc for python3\nRUN python3 -m pip install --upgrade pip && python3 -m pip install protobuf grpcio grpcio-tools && python3 -m pip install statsd\n\n# Copy code\nADD . /amr_parser\nWORKDIR /amr_parser\n\n# Model Location\nENV MODEL_PATH \"models/model.epoch25.params\"\n\n# GRPC Port (so that it can be set during run time)\nENV GRPC_PORT \"50051\"\n\n# Set cache paths\nENV CACHE_DIR \"cache/\"\nENV ROBERTA_CACHE_PATH ${CACHE_DIR}/roberta.large\n\n# Download the roberta large model\nRUN wget -P ${CACHE_DIR} https://dl.fbaipublicfiles.com/fairseq/models/roberta.large.tar.gz\nRUN tar -xzvf ${CACHE_DIR}/roberta.large.tar.gz -C ${CACHE_DIR} && rm ${CACHE_DIR}/roberta.large.tar.gz\nRUN rm ${CACHE_DIR}/roberta.large.tar.gz\n\n# Install the packages\nRUN python3 -m pip install --editable .\nRUN python3 -m spacy download en\n\n# Compile the protos\nRUN python3 -m grpc_tools.protoc -I./service/  --python_out=./service/ --grpc_python_out=./service/ ./service/wordvec.proto\nRUN python3 -m grpc_tools.protoc -I./service/  --python_out=./service/ --grpc_python_out=./service/ ./service/amr.proto\n\n# start the server\nCMD python3 -u service/amr_server.py --in-model ${MODEL_PATH} --roberta-cache-path ${ROBERTA_CACHE_PATH} --port ${GRPC_PORT}\n"
}