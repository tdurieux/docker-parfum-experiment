{
  "startTime": 1674252361339,
  "endTime": 1674252361799,
  "originalSmells": [
    {
      "rule": "sha256sumEchoOneSpaces",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 2,
        "columnEnd": 59
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# ---------------------------------------------------------------------------\n# See the NOTICE file distributed with this work for additional\n# information regarding copyright ownership.\n#\n# This is free software; you can redistribute it and/or modify it\n# under the terms of the GNU Lesser General Public License as\n# published by the Free Software Foundation; either version 2.1 of\n# the License, or (at your option) any later version.\n#\n# This software is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n# Lesser General Public License for more details.\n#\n# You should have received a copy of the GNU Lesser General Public\n# License along with this software; if not, write to the Free\n# Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n# 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n# ---------------------------------------------------------------------------\nFROM tomcat:9-jre11-openjdk\n\n#    ____  ____  ____      ____  _   __        _\n#   |_  _||_  _||_  _|    |_  _|(_) [  |  _   (_)\n#     \\\\ \\\\  / /    \\\\ \\\\  /\\\\  / /  __   | | / ]  __\n#      > `' <      \\\\ \\\\/  \\\\/ /  [  |  | '' <  [  |\n#    _/ /'`\\\\ \\\\_     \\\\  /\\\\  /    | |  | |`\\\\ \\\\  | |\n#   |____||____|     \\\\/  \\\\/    [___][__|  \\\\_][___]\n\nLABEL org.opencontainers.image.authors='XWiki Development Team <committers@xwiki.org>'\nLABEL org.opencontainers.image.url='https://hub.docker.com/_/xwiki'\nLABEL org.opencontainers.image.documentation='https://hub.docker.com/_/xwiki'\nLABEL org.opencontainers.image.source='https://github.com/xwiki/xwiki-docker.git'\nLABEL org.opencontainers.image.vendor='xwiki.org'\nLABEL org.opencontainers.image.licenses='LGPL-2.1'\n\n# Note: when using docker-compose, the ENV values below are overridden from the .env file.\n\n# Install LibreOffice + other tools\n# Note that procps is required to get ps which is used by JODConverter to start LibreOffice\nRUN apt-get update && \\\\\n  apt-get --no-install-recommends -y install \\\\\n    curl \\\\\n    libreoffice \\\\\n    unzip \\\\\n    procps <% if (db == 'postgres') print '\\\\\\n    libpostgresql-jdbc-java ' %>&& \\\\\n  rm -rf /var/lib/apt/lists/*\n\n# Install XWiki as the ROOT webapp context in Tomcat\n# Create the Tomcat temporary directory\n# Configure the XWiki permanent directory\nENV XWIKI_VERSION=\"$xwikiVersion\"\nENV XWIKI_URL_PREFIX \"https://maven.xwiki.org/releases/org/xwiki/platform/xwiki-platform-distribution-war/\\${XWIKI_VERSION}\"\nENV XWIKI_DOWNLOAD_SHA256 $xwikiSha256\nRUN rm -rf /usr/local/tomcat/webapps/* && \\\\\n  mkdir -p /usr/local/tomcat/temp && \\\\\n  mkdir -p /usr/local/xwiki/data && \\\\\n  curl -fSL \"\\${XWIKI_URL_PREFIX}/xwiki-platform-distribution-war-\\${XWIKI_VERSION}.war\" -o xwiki.war && \\\\\n  echo \"\\$XWIKI_DOWNLOAD_SHA256  xwiki.war\" | sha256sum -c - && \\\\\n  unzip -d /usr/local/tomcat/webapps/ROOT xwiki.war && \\\\\n  rm -f xwiki.war\n\n# Copy the JDBC driver in the XWiki webapp\n<% if (db == 'mysql') {\n  println \"# For MYSQL, download the MySQL driver version from the Maven Central repository since there's no up to \"\n  println \"# date Debian repository for it anymore.\"\n  println \"ENV MYSQL_JDBC_VERSION=\\\"$mysqlJDBCVersion\\\"\"\n  println \"ENV MYSQL_JDBC_SHA256=\\\"$mysqlJDBCSha256\\\"\"\n  println \"ENV MYSQL_JDBC_PREFIX=\\\"https://repo1.maven.org/maven2/mysql/mysql-connector-java/\\${MYSQL_JDBC_VERSION}\\\"\"\n  println \"ENV MYSQL_JDBC_ARTIFACT=\\\"mysql-connector-java-\\${MYSQL_JDBC_VERSION}.jar\\\"\"\n  println \"ENV MYSQL_JDBC_TARGET=\\\"/usr/local/tomcat/webapps/ROOT/WEB-INF/lib/\\${MYSQL_JDBC_ARTIFACT}\\\"\"\n  println \"RUN curl -fSL \\\"\\${MYSQL_JDBC_PREFIX}/\\${MYSQL_JDBC_ARTIFACT}\\\" -o \\$MYSQL_JDBC_TARGET && \\\\\"\n  print \"  echo \\\"\\$MYSQL_JDBC_SHA256 \\$MYSQL_JDBC_TARGET\\\" | sha256sum -c -\"\n} else if (db == 'mariadb') {\n  println \"# For MariaDB, download the MariaDB driver version from the Maven Central repository to control the version \"\n  println \"# used.\"\n  println \"ENV MARIADB_JDBC_VERSION=\\\"$mariadbJDBCVersion\\\"\"\n  println \"ENV MARIADB_JDBC_SHA256=\\\"$mariadbJDBCSha256\\\"\"\n  println \"ENV MARIADB_JDBC_PREFIX=\\\"https://repo1.maven.org/maven2/org/mariadb/jdbc/mariadb-java-client/\\${MARIADB_JDBC_VERSION}\\\"\"\n  println \"ENV MARIADB_JDBC_ARTIFACT=\\\"mariadb-java-client-\\${MARIADB_JDBC_VERSION}.jar\\\"\"\n  println \"ENV MARIADB_JDBC_TARGET=\\\"/usr/local/tomcat/webapps/ROOT/WEB-INF/lib/\\${MARIADB_JDBC_ARTIFACT}\\\"\"\n  println \"RUN curl -fSL \\\"\\${MARIADB_JDBC_PREFIX}/\\${MARIADB_JDBC_ARTIFACT}\\\" -o \\$MARIADB_JDBC_TARGET && \\\\\"\n  print \"  echo \\\"\\$MARIADB_JDBC_SHA256 \\$MARIADB_JDBC_TARGET\\\" | sha256sum -c -\"\n} else if (db == 'postgres') {\n  print 'RUN cp /usr/share/java/postgresql-jdbc4.jar /usr/local/tomcat/webapps/ROOT/WEB-INF/lib/'\n} %>\n\n# Configure Tomcat. For example set the memory for the Tomcat JVM since the default value is too small for XWiki\nCOPY tomcat/setenv.sh /usr/local/tomcat/bin/\n\n# Setup the XWiki Hibernate configuration\nCOPY xwiki/hibernate.cfg.xml /usr/local/tomcat/webapps/ROOT/WEB-INF/hibernate.cfg.xml\n\n# Set a specific distribution id in XWiki for this docker packaging.\nRUN sed -i \\'s/<id>org.xwiki.platform:xwiki-platform-distribution-war/<id>org.xwiki.platform:xwiki-platform-distribution-docker/\\' \\\\\n  /usr/local/tomcat/webapps/ROOT/META-INF/extension.xed\n\n# Add scripts required to make changes to XWiki configuration files at execution time\n# Note: we don't run CHMOD since 1) it's not required since the executabe bit is already set in git and 2) running\n# CHMOD after a COPY will sometimes fail, depending on different host-specific factors (especially on AUFS).\nCOPY xwiki/docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh\n\n# Make the XWiki directory (the permanent directory is included in it) persist on the host (so that it's not recreated\n# across runs)\nVOLUME /usr/local/xwiki\n\n# At this point the image is done and what remains below are the runtime configuration used by the user to configure\n# the container that will be created out of the image. Namely the user can override some environment variables with\n#   docker run -e \"var1=val1\" -e \"var2=val2\" ...\n# The supported environment variables that can be overridden are:\n# - DB_USER: the name of the user configured for XWiki in the DB. Default is \"xwiki\". This is used to configure\n#            xwiki's hibernate.cfg.xml file.\n# - DB_PASSWORD: the password for the user configured for XWiki in the DB. Default is \"xwiki\". This is used to\n#                configure xwiki's hibernate.cfg.xml file.\n# - DB_DATABASE: the name of the database to use. Default is \"xwiki\". This is used to configure xwiki's\n#                hibernate.cfg.xml file.\n# - DB_HOST: The name of the host (or docker container) containing the database. Default is \"db\". This is used to\n#            configure xwiki's hibernate.cfg.xml file.\n# - CONTEXT_PATH: The name of the context path under which XWiki will be deployed in Tomcat. If not specified then it'll\n#                 be deployed as ROOT.\n\n# Example:\n#   docker run -it -e \"DB_USER=xwiki\" -e \"DB_PASSWORD=xwiki\" <imagename>\n\n# Starts XWiki by starting Tomcat. All options passed to \"docker run [OPTIONS] IMAGE[:TAG|@DIGEST] [COMMAND] [ARG...]\"\n# are also passed to docker-entrypoint.sh. If \"xwiki\" is passed then XWiki will be configured the first time the\n# container executes and Tomcat will be started. If some other parameter is passed then it'll be executed to comply\n# with best practices defined at https://github.com/docker-library/official-images#consistency.\nENTRYPOINT [\"docker-entrypoint.sh\"]\nCMD [\"xwiki\"]\n"
}