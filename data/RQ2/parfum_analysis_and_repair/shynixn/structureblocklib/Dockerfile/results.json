{
  "startTime": 1674219261572,
  "endTime": 1674219262825,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 24
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 4,
        "columnEnd": 22
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 24
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 5,
        "lineEnd": 5,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 5,
        "lineEnd": 5,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 5,
        "lineEnd": 5,
        "columnStart": 4,
        "columnEnd": 28
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# This docker file uses multi-stage builds.\n# 1. Resolve minecraft-dependencies for 1.8 - 1.16 with jdk8\nFROM openjdk:8 AS dependencies-jdk8\nWORKDIR /tmp\nRUN apt-get update && apt-get install --no-install-recommends maven -y && rm -rf /var/lib/apt/lists/*;\nRUN wget \"https://hub.spigotmc.org/jenkins/job/BuildTools/lastSuccessfulBuild/artifact/target/BuildTools.jar\"\nRUN java -jar BuildTools.jar --rev 1.9.4\nRUN java -jar BuildTools.jar --rev 1.10\nRUN java -jar BuildTools.jar --rev 1.11\nRUN java -jar BuildTools.jar --rev 1.12\nRUN java -jar BuildTools.jar --rev 1.13.2\nRUN java -jar BuildTools.jar --rev 1.14.4\nRUN java -jar BuildTools.jar --rev 1.15\nRUN java -jar BuildTools.jar --rev 1.16.4\nCMD [\"sh\",\"-c\",\"/bin/bash\"]\n\n# 2. Resolve minecraft-dependencies for 1.17 - 1.18 - latest with jdk17\nFROM amazoncorretto:17 AS dependencies-jdk17\nWORKDIR /tmp\nRUN yum update -y\nRUN yum install maven -y && rm -rf /var/cache/yum\nRUN yum install wget -y && rm -rf /var/cache/yum\nRUN yum install git -y && rm -rf /var/cache/yum\nRUN wget \"https://hub.spigotmc.org/jenkins/job/BuildTools/lastSuccessfulBuild/artifact/target/BuildTools.jar\"\nRUN java -jar BuildTools.jar --rev 1.17.1 --remapped\nRUN java -jar BuildTools.jar --rev 1.18 --remapped\nRUN java -jar BuildTools.jar --rev 1.18.2 --remapped\nRUN java -jar BuildTools.jar --rev 1.19 --remapped\n\n# 3. Build plugin for 1.8 - 1.17 with jdk17\nFROM amazoncorretto:17 AS plugin-jdk17\nWORKDIR /tmp\nRUN yum update -y\nRUN yum install maven -y && rm -rf /var/cache/yum\nRUN yum install dos2unix -y && rm -rf /var/cache/yum\nCOPY --from=dependencies-jdk8 /root/.m2/repository/org/spigotmc /root/.m2/repository/org/spigotmc/\nCOPY --from=dependencies-jdk17 /root/.m2/repository/org/spigotmc /root/.m2/repository/org/spigotmc/\nCOPY . /tmp\nRUN chmod +x gradlew\nRUN dos2unix gradlew\nRUN ./gradlew build pluginJar --no-daemon\n\n# 4. Launch a minecraft server with jdk17 and plugin\nFROM amazoncorretto:17\n# Change to the current plugin version present in build.gradle\nENV PLUGIN_VERSION=2.8.0\n# Change to the server version you want to test.\nENV SERVER_VERSION=spigot-1.19.jar\n# Port of the Minecraft Server.\nEXPOSE 25565\n# Port for Remote Debugging\nEXPOSE 5005\nWORKDIR /app\nRUN yum update -y\nRUN echo \"eula=true\" > eula.txt && mkdir plugins\nCOPY ./structureblocklib-tools/world-1.14 /app/\nCOPY ./structureblocklib-tools/ops.json /app/\n# For < 1.18 COPY --from=dependencies-jdk17 /root/.m2/repository/org/spigotmc/spigot/$SERVER_VERSION /app/spigot.jar\nCOPY --from=dependencies-jdk17 /tmp/$SERVER_VERSION /app/spigot.jar\nCOPY --from=plugin-jdk17 /tmp/structureblocklib-bukkit-sample/build/libs/structureblocklib-bukkit-sample-$PLUGIN_VERSION.jar /app/plugins/Structureblocklib.jar\nCMD [\"sh\",\"-c\",\"java -DIReallyKnowWhatIAmDoingISwear -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=5005 -jar spigot.jar\"]\n"
}