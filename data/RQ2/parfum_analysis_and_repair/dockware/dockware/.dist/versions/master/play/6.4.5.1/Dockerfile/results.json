{
  "startTime": 1674249675096,
  "endTime": 1674249678358,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 384,
        "lineEnd": 384,
        "columnStart": 7,
        "columnEnd": 79
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 11,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 44,
        "lineEnd": 44,
        "columnStart": 7,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 45,
        "lineEnd": 45,
        "columnStart": 7,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 7,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 7,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 7,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 49,
        "lineEnd": 49,
        "columnStart": 7,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 7,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 51,
        "lineEnd": 51,
        "columnStart": 7,
        "columnEnd": 40
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 52,
        "lineEnd": 52,
        "columnStart": 7,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 7,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 7,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 7,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 7,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 7,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 58,
        "lineEnd": 58,
        "columnStart": 7,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 11,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 66,
        "lineEnd": 66,
        "columnStart": 11,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 67,
        "lineEnd": 67,
        "columnStart": 15,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 68,
        "lineEnd": 68,
        "columnStart": 7,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 7,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 126,
        "lineEnd": 126,
        "columnStart": 7,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 127,
        "lineEnd": 127,
        "columnStart": 7,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 128,
        "lineEnd": 128,
        "columnStart": 7,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 164,
        "lineEnd": 164,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 165,
        "lineEnd": 165,
        "columnStart": 7,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 166,
        "lineEnd": 166,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 167,
        "lineEnd": 167,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 169,
        "lineEnd": 169,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 170,
        "lineEnd": 170,
        "columnStart": 7,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 171,
        "lineEnd": 171,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 172,
        "lineEnd": 172,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 173,
        "lineEnd": 173,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 174,
        "lineEnd": 174,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 175,
        "lineEnd": 175,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 176,
        "lineEnd": 176,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 177,
        "lineEnd": 177,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 178,
        "lineEnd": 178,
        "columnStart": 7,
        "columnEnd": 40
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 179,
        "lineEnd": 179,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 180,
        "lineEnd": 180,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 181,
        "lineEnd": 181,
        "columnStart": 7,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 182,
        "lineEnd": 182,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 183,
        "lineEnd": 183,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 184,
        "lineEnd": 184,
        "columnStart": 7,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 185,
        "lineEnd": 185,
        "columnStart": 7,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 186,
        "lineEnd": 186,
        "columnStart": 7,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 187,
        "lineEnd": 187,
        "columnStart": 7,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 189,
        "lineEnd": 189,
        "columnStart": 7,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 199,
        "lineEnd": 199,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 200,
        "lineEnd": 200,
        "columnStart": 7,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 201,
        "lineEnd": 201,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 202,
        "lineEnd": 202,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 204,
        "lineEnd": 204,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 205,
        "lineEnd": 205,
        "columnStart": 7,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 206,
        "lineEnd": 206,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 207,
        "lineEnd": 207,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 208,
        "lineEnd": 208,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 209,
        "lineEnd": 209,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 210,
        "lineEnd": 210,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 211,
        "lineEnd": 211,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 212,
        "lineEnd": 212,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 213,
        "lineEnd": 213,
        "columnStart": 7,
        "columnEnd": 40
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 214,
        "lineEnd": 214,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 215,
        "lineEnd": 215,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 216,
        "lineEnd": 216,
        "columnStart": 7,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 217,
        "lineEnd": 217,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 218,
        "lineEnd": 218,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 219,
        "lineEnd": 219,
        "columnStart": 7,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 220,
        "lineEnd": 220,
        "columnStart": 7,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 221,
        "lineEnd": 221,
        "columnStart": 7,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 222,
        "lineEnd": 222,
        "columnStart": 7,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 224,
        "lineEnd": 224,
        "columnStart": 7,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 234,
        "lineEnd": 234,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 235,
        "lineEnd": 235,
        "columnStart": 7,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 237,
        "lineEnd": 237,
        "columnStart": 7,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 238,
        "lineEnd": 238,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 239,
        "lineEnd": 239,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 240,
        "lineEnd": 240,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 241,
        "lineEnd": 241,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 242,
        "lineEnd": 242,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 243,
        "lineEnd": 243,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 244,
        "lineEnd": 244,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 245,
        "lineEnd": 245,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 246,
        "lineEnd": 246,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 247,
        "lineEnd": 247,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 248,
        "lineEnd": 248,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 249,
        "lineEnd": 249,
        "columnStart": 7,
        "columnEnd": 40
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 250,
        "lineEnd": 250,
        "columnStart": 7,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 251,
        "lineEnd": 251,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 252,
        "lineEnd": 252,
        "columnStart": 7,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 253,
        "lineEnd": 253,
        "columnStart": 7,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 254,
        "lineEnd": 254,
        "columnStart": 7,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 255,
        "lineEnd": 255,
        "columnStart": 7,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 256,
        "lineEnd": 256,
        "columnStart": 7,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 257,
        "lineEnd": 257,
        "columnStart": 7,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 258,
        "lineEnd": 258,
        "columnStart": 7,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 260,
        "lineEnd": 260,
        "columnStart": 7,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 301,
        "lineEnd": 301,
        "columnStart": 7,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 309,
        "lineEnd": 309,
        "columnStart": 7,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 324,
        "lineEnd": 324,
        "columnStart": 7,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 351,
        "lineEnd": 351,
        "columnStart": 7,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 352,
        "lineEnd": 352,
        "columnStart": 7,
        "columnEnd": 40
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 353,
        "lineEnd": 353,
        "columnStart": 7,
        "columnEnd": 34
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 309,
        "lineEnd": 309,
        "columnStart": 7,
        "columnEnd": 29
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Official Dockware Image\n# Tag: 6.4.5.1\n# Copyright 2022 dasistweb GmbH\n#\nFROM ubuntu:18.04\nLABEL title=\"Dockware play:6.4.5.1\" \\\n      version=\"1.5.3\" \\\n      maintainer=\"dasistweb GmbH\"\n\n# remember build-date\nRUN date >/build-date.txt && \\\n    mkdir -p /var/www && \\\n    mkdir -p /var/www/scripts\n\n# add our changelog to the containers\nADD ./assets/CHANGELOG.md /var/www/CHANGELOG.md\n\n## ***********************************************************************\n##  IMAGE VARIABLES\n## ***********************************************************************\nENV TZ Europe/Berlin\nENV PHP_VERSION 7.4\nENV APACHE_DOCROOT /var/www/html/public\nENV SW_TASKS_ENABLED 0\nENV COMPOSER_VERSION not-set\nENV NODE_VERSION 12\nRUN echo \"export TZ=${TZ}\" >> /etc/profile \\\n && echo \"export PHP_VERSION=${PHP_VERSION}\" >> /etc/profile \\\n && echo \"export APACHE_DOCROOT=${APACHE_DOCROOT}\" >> /etc/profile \\\n && echo \"export SW_TASKS_ENABLED=${SW_TASKS_ENABLED}\" >> /etc/profile \\\n && echo \"export COMPOSER_VERSION=${COMPOSER_VERSION}\" >> /etc/profile \\\n && echo \"export NODE_VERSION=${NODE_VERSION}\" >> /etc/profile\n\nENV SW_CURRENCY 'not-set'\nRUN echo \"export SW_CURRENCY=${SW_CURRENCY}\" >> /etc/profile\n\nENV SW_API_ACCESS_KEY 'not-set'\nRUN echo \"export SW_API_ACCESS_KEY=${SW_API_ACCESS_KEY}\" >> /etc/profile\n\n## ***********************************************************************\n##  BASE REQUIREMENTS\n## ***********************************************************************\nRUN apt-get update \\\n        && apt-get install --no-install-recommends -y gosu \\\n    && apt-get install --no-install-recommends -y sudo \\\n    && apt-get install --no-install-recommends -y wget \\\n    && apt-get install --no-install-recommends -y curl \\\n    && apt-get install --no-install-recommends -y unzip \\\n    && apt-get install --no-install-recommends -y bzip2 \\\n    && apt-get install --no-install-recommends -y ssmtp \\\n    && apt-get install --no-install-recommends -y lsof \\\n    && apt-get install --no-install-recommends -y openssh-server \\\n    && apt-get install --no-install-recommends -y cron \\\n    && apt-get install --no-install-recommends -y vim \\\n    && apt-get install --no-install-recommends -y nano \\\n    && apt-get install --no-install-recommends -y jq \\\n    && apt-get install --no-install-recommends -y gnupg2 \\\n    && apt-get install --no-install-recommends -y gpg-agent \\\n    && apt-get install --no-install-recommends -y chromium-browser \\\n    && mkdir /var/run/sshd \\\n    # TIMEZONE SETTINGS\n    # otherwise we would have an interactive input dialog\n    && ln -fs /usr/share/zoneinfo/Europe/Berlin /etc/localtime \\\n        && apt-get install --no-install-recommends -y tzdata \\\n    && dpkg-reconfigure --frontend noninteractive tzdata \\\n\n        && apt-get install --no-install-recommends -y xdg-utils \\\n            && apt-get install --no-install-recommends -y libsodium-dev \\\n    && apt-get install --no-install-recommends -y php-dev \\\n    && apt-get install --no-install-recommends -y php-pear \\\n    && pecl install -f libsodium \\\n    && apt-get remove -y php-pear \\\n    && apt-get remove -y php-dev \\\n            && rm -rf /var/lib/apt/lists/* /var/cache/apt/*\n\n## ***********************************************************************\n##  USER MANAGEMENT\n## ***********************************************************************\n# set easy root pwd for dev purpose\nRUN echo \"root:root\" | chpasswd \\\n    # set password for www-data, and also\n    # avoid shell login (we have a separate user for that)\n    && echo 'www-data:www-data' | chpasswd \\\n    && usermod -s /usr/sbin/nologin www-data \\\n    # this option makes sure to avoid root SSH login\n    # we just replace our lines with nothing\n    && sed -i 's/PermitRootLogin without-password//' /etc/ssh/sshd_config \\\n    && sed -i 's/PermitRootLogin prohibit-password//' /etc/ssh/sshd_config \\\n    # allow root and sudo group to run sudo without password\n    && sed -i /etc/sudoers -re 's/^%sudo.*/%sudo ALL=(ALL:ALL) NOPASSWD: ALL/g' \\\n    && sed -i /etc/sudoers -re 's/^root.*/root ALL=(ALL:ALL) NOPASSWD: ALL/g' \\\n    # remove include directory\n    && sed -i /etc/sudoers -re 's/^#includedir.*/## **Removed the include directive** ##\"/g'\n\n## ***********************************************************************\n## creates a new user as www-data alias and adds it to the sudo group\n## along with privileges to run sudo without password\n## params:\n#       - string user\n#       - string pwd\n#       - bool sudo\n## ***********************************************************************\nRUN adduser --disabled-password --uid 5577 --gecos \"\" --ingroup www-data dockware \\\n    && usermod -m -d /var/www dockware | true \\\n    && echo \"dockware:dockware\" | chpasswd \\\n        && usermod -a -G sudo dockware \\\n    # allow sudo without pwd and dont require tty (for entrypoint commands)\n    && echo \"Defaults:dockware !requiretty\" >> /etc/sudoers \\\n        && sed -i 's/dockware:x:5577:33:/dockware:x:33:33:/g' /etc/passwd\nRUN echo 'AllowUsers dockware' >> /etc/ssh/sshd_config\n\nENV BASH_ENV /var/www/.bashrc\n\nRUN echo \"source /var/www/.nvm/nvm.sh\" >> /var/www/.bashrc \\\n    # -------------------------------------------------\n    && chown 33:33 /var/www/.bashrc \\\n    # -------------------------------------------------\n    && echo \"export BASH_ENV=${BASH_ENV}\" >> /etc/profile\n\n## ***********************************************************************\n##  APACHE INSTALLATION\n## ***********************************************************************\n#this conf is needed for enconf command ...\nADD ./config/apache/http2.conf /etc/apache2/conf-available/http2.conf\n\nRUN apt-get update \\\n    && apt-get install --no-install-recommends -y apache2 \\\n    && apt-get install --no-install-recommends -y libapache2-mod-fcgid \\\n    && apt-get install --no-install-recommends -y software-properties-common \\\n    && LC_ALL=C.UTF-8 add-apt-repository ppa:ondrej/php \\\n    && a2enmod headers \\\n    && a2enmod rewrite \\\n    && a2enmod expires \\\n    && a2enmod proxy \\\n    && a2enmod proxy_http \\\n    && a2enmod proxy_wstunnel \\\n    && a2enmod actions \\\n    && a2enmod fcgid \\\n    && a2enmod alias \\\n    && a2enmod proxy_fcgi \\\n    && a2enmod http2 \\\n    && sudo a2enconf http2 \\\n    && sudo a2dismod mpm_prefork > /dev/null 2>&1 \\\n    && sudo a2enmod mpm_event > /dev/null 2>&1 \\\n    && rm -rf /var/lib/apt/lists/* /var/cache/apt/*\n\nADD ./config/apache/apache2.conf /etc/apache2/apache2.conf\nADD ./config/apache/ports.conf /etc/apache2/ports.conf\nADD ./config/apache/sites.conf /etc/apache2/sites-enabled/000-default.conf\n\n# create a new id_rsa for the www-data dockeruser.\n# thus we have a SSH Key for connections out of the box\n\nRUN mkdir -p /var/www/.ssh \\\n    && rm -rf /var/www/.ssh/id_rsa; true  \\\n    && rm -rf /var/www/.ssh/id_rsa.pub; true  \\\n    && ssh-keygen -t rsa -b 4096 -f /var/www/.ssh/id_rsa -C \"Dockware Container\" -P \"\"  \\\n    && chown -R www-data:www-data /var/www/.ssh \\\n    && chmod 0700 /var/www/.ssh\n\n## ***********************************************************************\n##  PHP INSTALLATION\n## ***********************************************************************\nRUN apt-get update \\\n    && apt-get install --no-install-recommends -y php8.1-fpm \\\n    && apt-get install --no-install-recommends -y php8.1-gd \\\n    && apt-get install --no-install-recommends -y php8.1-iconv \\\n    && apt-get install --no-install-recommends -y php8.1-intl \\\n    #&& apt-get install -y php8.1-json \\\n    && apt-get install --no-install-recommends -y php8.1-xml \\\n    && apt-get install --no-install-recommends -y php8.1-mbstring \\\n    && apt-get install --no-install-recommends -y php8.1-pdo \\\n    && apt-get install --no-install-recommends -y php8.1-mysql \\\n    && apt-get install --no-install-recommends -y php8.1-apcu \\\n    && apt-get install --no-install-recommends -y php8.1-curl \\\n    && apt-get install --no-install-recommends -y php8.1-cli \\\n    && apt-get install --no-install-recommends -y php8.1-ldap \\\n    && apt-get install --no-install-recommends -y php8.1-pgsql \\\n    && apt-get install --no-install-recommends -y php8.1-gettext \\\n    && apt-get install --no-install-recommends -y php8.1-zip \\\n    && apt-get install --no-install-recommends -y php8.1-soap \\\n    && apt-get install --no-install-recommends -y php8.1-bcmath \\\n    && apt-get install --no-install-recommends -y php8.1-redis \\\n    && apt-get install --no-install-recommends -y php8.1-imap \\\n    && apt-get install --no-install-recommends -y dh-php \\\n    && apt-get install --no-install-recommends -y php-geoip \\\n    && apt-get install --no-install-recommends -y php-ssh2 \\\n    && apt-get install --no-install-recommends -y php-amqp \\\n    # shopware required pcre\n    && apt-get install --no-install-recommends -y libpcre3 libpcre3-dev \\\n    # remove pecl again\n    && apt-get remove -y dh-php \\\n    && rm -rf /var/lib/apt/lists/* /var/cache/apt/*\n\nCOPY ./config/php/general.ini /etc/php/8.1/fpm/conf.d/01-general.ini\nCOPY ./config/php/general.ini /etc/php/8.1/cli/conf.d/01-general.ini\nCOPY ./config/php/cli.ini /etc/php/8.1/cli/conf.d/01-general-cli.ini\n\nRUN apt-get update \\\n    && apt-get install --no-install-recommends -y php8.0-fpm \\\n    && apt-get install --no-install-recommends -y php8.0-gd \\\n    && apt-get install --no-install-recommends -y php8.0-iconv \\\n    && apt-get install --no-install-recommends -y php8.0-intl \\\n    #&& apt-get install -y php8.0-json \\\n    && apt-get install --no-install-recommends -y php8.0-xml \\\n    && apt-get install --no-install-recommends -y php8.0-mbstring \\\n    && apt-get install --no-install-recommends -y php8.0-pdo \\\n    && apt-get install --no-install-recommends -y php8.0-mysql \\\n    && apt-get install --no-install-recommends -y php8.0-apcu \\\n    && apt-get install --no-install-recommends -y php8.0-curl \\\n    && apt-get install --no-install-recommends -y php8.0-cli \\\n    && apt-get install --no-install-recommends -y php8.0-ldap \\\n    && apt-get install --no-install-recommends -y php8.0-pgsql \\\n    && apt-get install --no-install-recommends -y php8.0-gettext \\\n    && apt-get install --no-install-recommends -y php8.0-zip \\\n    && apt-get install --no-install-recommends -y php8.0-soap \\\n    && apt-get install --no-install-recommends -y php8.0-bcmath \\\n    && apt-get install --no-install-recommends -y php8.0-redis \\\n    && apt-get install --no-install-recommends -y php8.0-imap \\\n    && apt-get install --no-install-recommends -y dh-php \\\n    && apt-get install --no-install-recommends -y php-geoip \\\n    && apt-get install --no-install-recommends -y php-ssh2 \\\n    && apt-get install --no-install-recommends -y php-amqp \\\n    # shopware required pcre\n    && apt-get install --no-install-recommends -y libpcre3 libpcre3-dev \\\n    # remove pecl again\n    && apt-get remove -y dh-php \\\n    && rm -rf /var/lib/apt/lists/* /var/cache/apt/*\n\nCOPY ./config/php/general.ini /etc/php/8.0/fpm/conf.d/01-general.ini\nCOPY ./config/php/general.ini /etc/php/8.0/cli/conf.d/01-general.ini\nCOPY ./config/php/cli.ini /etc/php/8.0/cli/conf.d/01-general-cli.ini\n\nRUN apt-get update \\\n    && apt-get install --no-install-recommends -y php7.4-fpm \\\n    && apt-get install --no-install-recommends -y php7.4-gd \\\n    #make sure mbstring is installed BEFORE iconv see: https://github.com/dockware/dockware/issues/36 => https://github.com/docker-library/php/issues/240#issuecomment-355489551\n    && apt-get install --no-install-recommends -y php7.4-mbstring \\\n    && apt-get install --no-install-recommends -y php7.4-iconv \\\n    && apt-get install --no-install-recommends -y php7.4-intl \\\n    && apt-get install --no-install-recommends -y php7.4-json \\\n    && apt-get install --no-install-recommends -y php7.4-xml \\\n    && apt-get install --no-install-recommends -y php7.4-pdo \\\n    && apt-get install --no-install-recommends -y php7.4-mysql \\\n    && apt-get install --no-install-recommends -y php7.4-apcu \\\n    && apt-get install --no-install-recommends -y php7.4-curl \\\n    && apt-get install --no-install-recommends -y php7.4-cli \\\n    && apt-get install --no-install-recommends -y php7.4-ldap \\\n    && apt-get install --no-install-recommends -y php7.4-pgsql \\\n    && apt-get install --no-install-recommends -y php7.4-gettext \\\n    && apt-get install --no-install-recommends -y php7.4-zip \\\n    && apt-get install --no-install-recommends -y php7.4-soap \\\n    && apt-get install --no-install-recommends -y php7.4-bcmath \\\n    && apt-get install --no-install-recommends -y php7.4-redis \\\n    && apt-get install --no-install-recommends -y php7.4-imap \\\n    && apt-get install --no-install-recommends -y dh-php \\\n    && apt-get install --no-install-recommends -y php-geoip \\\n    && apt-get install --no-install-recommends -y php-ssh2 \\\n    && apt-get install --no-install-recommends -y php-amqp \\\n    # shopware required pcre\n    && apt-get install --no-install-recommends -y libpcre3 libpcre3-dev \\\n    # remove pecl again\n    && apt-get remove -y dh-php \\\n    && rm -rf /var/lib/apt/lists/* /var/cache/apt/*\n\nCOPY ./config/php/general.ini /etc/php/7.4/fpm/conf.d/01-general.ini\nCOPY ./config/php/general.ini /etc/php/7.4/cli/conf.d/01-general.ini\nCOPY ./config/php/cli.ini /etc/php/7.4/cli/conf.d/01-general-cli.ini\n\n#make sure the installation runs also in default php version\nRUN sudo update-alternatives --set php /usr/bin/php7.4 > /dev/null 2>&1 &\n# make sure the installation runs using our default php version\nRUN service php7.4-fpm stop > /dev/null 2>&1 && \\\n    service php7.4-fpm start && \\\n    sudo update-alternatives --set php /usr/bin/php7.4 > /dev/null 2>&1\n\n# make sure our php user has rights on the session\nRUN chown www-data:www-data -R /var/lib/php/sessions\n\n# remove the standard apache index file\nRUN mkdir -p /var/www/html \\\n    && rm -rf /var/www/html/* \\\n    && chown -R www-data:www-data /var/www/html \\\n    && sudo -u www-data sh -c 'mkdir -p /var/www/html/public'\n\n# make sure the configured log folder exists and is writeable\nRUN chmod -R 0777 /var/www \\\n    && chgrp -R www-data /var/log/apache2 \\\n    && mkdir -p /var/log/mysql \\\n    && chgrp -R www-data /var/log/mysql\\\n    && mkdir /var/log/php -p  \\\n    && touch /var/log/php/cli_errors.log  \\\n    && touch /var/log/php/fpm_errors.log  \\\n    && chown -R www-data:www-data /var/log/php  \\\n    && chmod 0755 /var/log/php\n\n## ***********************************************************************\n##  MOD_SSL\n##  create SSL certificate\n## ***********************************************************************\nRUN apt-get update \\\n    && apt-get install --no-install-recommends -y openssl \\\n    && a2enmod ssl \\\n    && mkdir /etc/apache2/ssl \\\n    && openssl req -new -x509 -days 365 -sha1 -newkey rsa:2048 -nodes -keyout /etc/apache2/ssl/server.key -out /etc/apache2/ssl/server.crt -subj '/O=Company/OU=Department/CN=localhost' \\\n    && rm -rf /var/lib/apt/lists/* /var/cache/apt/*\n\nRUN apt-get update \\\n\n    && apt-get install --no-install-recommends -y git && rm -rf /var/lib/apt/lists/*;\n\n## ***********************************************************************\n##  MYSQL INSTALL\n## ***********************************************************************\n\n# prepare environment variables to allow a\n# quiet install of the mysql server\n# this sets the root password to root without user prompts\nRUN echo debconf mysql-server/root_password password root | debconf-set-selections\nRUN echo debconf mysql-server/root_password_again password root | debconf-set-selections\n\nRUN DEBIAN_FRONTEND=noninteractive \\\n    # install mysql server\n    && apt-get update \\\n    && apt-get install --no-install-recommends -y -q mysql-server \\\n    # set requires permissions\n    && usermod -d /var/lib/mysql/ mysql \\\n    # cleanup download folders\n    && rm -rf /var/lib/apt/lists/* /var/cache/apt/*\n\n# copy our custom configuration to the image\nADD ./config/mysql/my.cnf /etc/mysql/my.cnf\n\n# i dont know why, but this is suddenly required\nRUN chmod 0444 /etc/mysql/my.cnf\n\nRUN service mysql start && \\\n    mysql --user=root --password=root -e \"use mysql; update user set host='%' where host='localhost';\" && \\\n    service mysql restart\n\n## ***********************************************************************\n##  ADMINER\n## ***********************************************************************\n\nRUN mkdir /usr/share/adminer \\\n    && wget \"https://github.com/vrana/adminer/releases/download/v4.8.1/adminer-4.8.1.php\" -O /usr/share/adminer/latest.php \\\n    && ln -s /usr/share/adminer/latest.php /usr/share/adminer/adminer.php \\\n    && echo \"Alias /adminer.php /usr/share/adminer/adminer.php\" | sudo tee /etc/apache2/conf-available/adminer.conf \\\n    && a2enconf adminer.conf\n\nRUN apt-get update \\\n    && apt-get install --no-install-recommends -y build-essential \\\n    && apt-get install --no-install-recommends -y libsqlite3-dev \\\n    && apt-get install --no-install-recommends -y ruby-dev \\\n    && gem install sqlite3 -v 1.3.4 \\\n    && gem install mailcatcher --conservative --no-ri --no-rdoc \\\n    && phpenmod mailcatcher \\\n    && rm -rf /var/lib/apt/lists/* /var/cache/apt/*\n\nCOPY ./config/ssmtp/ssmtp.conf /etc/ssmtp/ssmtp.conf\nRUN echo \"sendmail_path = /usr/bin/env $(which catchmail) -f 'local@dockware'\" >> /etc/php/8.1/mods-available/mailcatcher.ini && \\\necho \"sendmail_path = /usr/bin/env $(which catchmail) -f 'local@dockware'\" >> /etc/php/8.0/mods-available/mailcatcher.ini && \\\necho \"sendmail_path = /usr/bin/env $(which catchmail) -f 'local@dockware'\" >> /etc/php/7.4/mods-available/mailcatcher.ini && \\\n    echo \"\"\n\nRUN mkdir -p /var/www/pimpmylog && \\\n    wget -O - https://github.com/potsky/PimpMyLog/tarball/master | tar xzf - && \\\n    mv potsky-PimpMyLog-* /var/www/pimpmylog && \\\n    mv /var/www/pimpmylog/potsky-PimpMyLog-2fed8c1/* /var/www/pimpmylog && \\\n    rm -rf /var/www/pimpmylog/potsky-PimpMyLog-*\n\nCOPY /config/pimpmylog/config.user.d /var/www/pimpmylog/config.user.d\nCOPY /config/pimpmylog/config.user.json /var/www/pimpmylog/config.user.json\n\n# apply our custom file with fixes for PHP 8\n# its used from here: https://github.com/potsky/PimpMyLog/pull/149/files\nCOPY /config/pimpmylog/global.inc.php /var/www/pimpmylog/inc/global.inc.php\n\nRUN chown -R www-data:www-data /var/www/pimpmylog/\n\nRUN ls -la \\\n    && mkdir \"/var/www/.nvm\" \\\n    && export NVM_DIR=\"/var/www/.nvm\" \\\n    # ----------------------------------------------------------------------------------------- \\\n    && curl -f -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.1/install.sh | bash \\\n    # -----------------------------------------------------------------------------------------\n    && [ -s \"$NVM_DIR/nvm.sh\" ] && \\. \"$NVM_DIR/nvm.sh\" \\\n    && [ -s \"$NVM_DIR/bash_completion\" ] && \\. \"$NVM_DIR/bash_completion\" \\\n    # -----------------------------------------------------------------------------------------\n    && nvm install 16 \\\n    && nvm install 14 \\\n    && nvm install 12 \\\n    # -----------------------------------------------------------------------------------------\n    && nvm use 12 \\\n    && nvm alias default 12\n\nENV NODE_PATH $NVM_DIR/v$NODE_VERSION/lib/node_modules\nENV PATH      $NVM_DIR/v$NODE_VERSION/bin:$PATH\n\nRUN echo \"\" \\\n\n    && rm -rf /var/lib/apt/lists/* /var/cache/apt/*\n\nCOPY ./assets/scripts/makefile /var/www/makefile\nCOPY ./assets/scripts/bin /var/www/scripts/bin\nCOPY ./assets/scripts/cron /var/www/scripts/cron\n\nCOPY ./assets/shopware6/files /var/www/scripts/shopware6\n\nRUN chown www-data:www-data -R /var/www/scripts\n#make sure for the whole installation xdebug is off for performance\nRUN sh /var/www/scripts/bin/xdebug_disable.sh\n\nADD entrypoint.sh /entrypoint.sh\nRUN chmod 755 /*.sh\n\n## ***********************************************************************\n##  INSTALL SHOPWARE\n## ***********************************************************************\nRUN rm -rf /var/www/html/* \\\n    && wget --no-check-certificate https://www.shopware.com/en/Download/redirect/version/sw6/file/install_v6.4.5.1_092cb2a2d16ae64c08a52ecafcb698c6998152b7.zip -qq -O /var/www/shopware.zip \\\n    && unzip -q /var/www/shopware.zip -d /var/www/html \\\n    && rm -rf /var/www/shopware.zip\n\nRUN echo \"APP_ENV=prod\" >> /var/www/html/.env && \\\n    echo \"APP_SECRET=1\" >> /var/www/html/.env && \\\n    echo \"INSTANCE_ID=1\" >> /var/www/html/.env && \\\n    echo \"DATABASE_URL=mysql://root:root@localhost:3306/shopware\" >> /var/www/html/.env && \\\n    echo \"APP_URL=http://localhost\" >> /var/www/html/.env && \\\n    echo \"MAILER_URL=smtp://localhost:1025\" >> /var/www/html/.env && \\\n    echo \"COMPOSER_HOME=/var/www/html/var/cache/composer\" >> /var/www/html/.env && \\\n    echo \"SHOPWARE_ES_ENABLED=0\" >> /var/www/html/.env\n\nRUN sudo service mysql start && \\\n    # switch to default PHP before installing\n    sudo update-alternatives --set php /usr/bin/php7.4 > /dev/null 2>&1 && \\\n    # -------------------------------------------------------------------------------------------\n    cd /var/www/html && php bin/console system:install --create-database --basic-setup && \\\n    # make sure assets like logos are ready\n    cd /var/www/html && php bin/console assets:install && \\\n    # -------------------------------------------------------------------------------------------\n    # add some demo data\n        cd /var/www/html && APP_ENV=prod php bin/console store:download -p SwagPlatformDemoData && \\\n    cd /var/www/html && APP_ENV=prod php bin/console plugin:refresh && \\\n    cd /var/www/html && APP_ENV=prod php bin/console plugin:install --activate SwagPlatformDemoData && \\\n        # -------------------------------------------------------------------------------------------\n    # clear cache and refresh dal index to show the new demo data\n    cd /var/www/html && php bin/console cache:clear && \\\n    cd /var/www/html && php bin/console dal:refresh:index && \\\n    rm -rf /var/www/html/var/cache/* && \\\n    # -------------------------------------------------------------------------------------------\n    mysql --user=root --password=root -e \"use shopware; INSERT INTO system_config (id, configuration_key, configuration_value, sales_channel_id, created_at, updated_at) VALUES (X'b3ae4d7111114377af9480c4a0911111', 'core.frw.completedAt', '{\\\"_value\\\": \\\"2019-10-07T10:46:23+00:00\\\"}', NULL, '2019-10-07 10:46:23.169', NULL);\" && \\\n    sudo service mysql stop\n\nRUN chown 33:33 -R /var/www/html\n\n## ***********************************************************************\n## SWITCH TO NORMAL USER (NOT ROOT ANYMORE!)\n## everything down here is now done as our www-data / dockware user\n## just like you would do it manually in the container\n## ***********************************************************************\n\nUSER dockware\n\n# make the apache folder the working directory\nWORKDIR /var/www/html\n\n## ***********************************************************************\n##  POST BUILD\n## ***********************************************************************\n\nENTRYPOINT [\"/bin/bash\", \"/entrypoint.sh\"]\n"
}