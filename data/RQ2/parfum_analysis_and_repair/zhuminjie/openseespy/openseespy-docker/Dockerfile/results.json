{
  "startTime": 1674255493449,
  "endTime": 1674255494815,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 4,
        "columnEnd": 68
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 5,
        "lineEnd": 7,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 150,
        "lineEnd": 150,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 166,
        "lineEnd": 166,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 183,
        "lineEnd": 183,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 270,
        "lineEnd": 270,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 200,
        "lineEnd": 200,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 216,
        "lineEnd": 216,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 234,
        "lineEnd": 234,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 252,
        "lineEnd": 252,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 289,
        "lineEnd": 289,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 200,
        "lineEnd": 200,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 216,
        "lineEnd": 216,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 234,
        "lineEnd": 234,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 252,
        "lineEnd": 252,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 289,
        "lineEnd": 289,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 200,
        "lineEnd": 200,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 216,
        "lineEnd": 216,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 234,
        "lineEnd": 234,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 252,
        "lineEnd": 252,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 289,
        "lineEnd": 289,
        "columnStart": 4,
        "columnEnd": 44
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 200,
        "lineEnd": 200,
        "columnStart": 4,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 216,
        "lineEnd": 216,
        "columnStart": 4,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 234,
        "lineEnd": 234,
        "columnStart": 4,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 252,
        "lineEnd": 252,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 289,
        "lineEnd": 289,
        "columnStart": 4,
        "columnEnd": 68
      }
    }
  ],
  "repairedDockerfile": "########################################################\n## install centos packages\nFROM centos:7 AS centos-packages\n#\nRUN yum update -y && \\\n    yum install -y make gcc-c++ gcc-gfortran git \\\n    tcl tcl-devel boost-devel \\\n    blas-devel openssl-devel bzip2-devel libffi-devel curl wget && \\\n    cd /home && \\\n    curl -f -O https://www.python.org/ftp/python/3.8.7/Python-3.8.7.tgz && \\\n    tar -xzf Python-3.8.7.tgz && \\\n    cd Python-3.8.7 && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --enable-optimizations && \\\n    make altinstall && \\\n    cd .. && \\\n    wget https://www.mpich.org/static/downloads/3.2/mpich-3.2.tar.gz && \\\n    tar -xf mpich-3.2.tar.gz && \\\n    mkdir /home/bin && \\\n    mkdir /home/lib && \\\n    mkdir /home/bin/mpich-install && \\\n    mkdir /home/lib/mpich-3.2 && \\\n    cd /home/lib/mpich-3.2 && \\\n    /home/mpich-3.2/configure \\\n    --prefix=/home/bin/mpich-install \\\n    --enable-fast=all \\\n    MPICHLIB_CFLAGS='-O3 -fPIC' \\\n    MPICHLIB_FFLAGS='-O3 -fPIC' \\\n    MPICHLIB_CXXFLAGS='-O3 -fPIC' \\\n    MPICHLIB_FCFLAGS='-O3 -fPIC' \\\n    --enable-shared=no && \\\n    make -j4 && \\\n    make install && rm -rf /var/cache/yum\n\n########################################################\n\n########################################################\n# configure petsc\nFROM centos-packages AS centos-petsc\nRUN cd /home && \\\n    git clone -b release \\\n    https://gitlab.com/petsc/petsc.git petsc && \\\n    cd /home/petsc && \\\n    /usr/local/bin/python3.8 configure \\\n    --download-cmake \\\n    --with-mpi-dir=/home/bin/mpich-install --download-fblaslapack \\\n    --download-scalapack --download-mumps --download-metis \\\n    --download-parmetis --with-shared-libraries=0 \\\n    --with-debugging=0 \\\n    COPTFLAGS='-O3 -march=native -mtune=native -fPIC' \\\n    CXXOPTFLAGS='-O3 -march=native -mtune=native -fPIC' \\\n    FOPTFLAGS='-O3 -march=native -mtune=native -fPIC'\n########################################################\n\n########################################################\n## get openseespy code\nFROM centos-petsc AS centos-openseespy-code\n\nWORKDIR /home\nCOPY opensees /home/opensees\nCOPY Makefile.def /home/opensees/\n\n########################################################\n## compile openseespy\nFROM centos-openseespy-code AS centos-openseespy\n\nWORKDIR /home/opensees\nRUN make python -j4\n########################################################\n\n########################################################\n## compile openseespy-pip\nFROM centos-openseespy AS centos-pip\n\n# Build openseespy package\nWORKDIR /home\nCOPY openseespylinux-pip /home/openseespylinux-pip\n\nWORKDIR /home/openseespylinux-pip\nRUN python3.8 build_pip.py python3.8 build \\\n    ../opensees/SRC/interpreter/opensees.so \\\n    copy_dep \\\n    no_zip\n\nENTRYPOINT [ \"python3.8\", \"build_pip.py\", \"python3.8\"]\nCMD [ \"upload-test\" ]\n########################################################\n\n########################################################\nFROM centos-pip  AS centos-pip-bash\n\nENTRYPOINT [ \"bash\"]\n########################################################\n\n########################################################\n## compile petsc        exit()\n\n#     git clone -b release \\\n#     https://gitlab.com/petsc/petsc.git petsc && \\\n#     cd /home/petsc && \\\n#     ./configure --with-cc=gcc-4.8 --with-cxx=g++-4.8 --with-fc=gfortran-4.8 --download-cmake --download-mpich --download-fblaslapack --download-scalapack --download-mumps --download-metis --download-parmetis --with-shared-libraries=0 --with-debugging=0 COPTFLAGS='-O3 -march=native -mtune=native -fPIC' CXXOPTFLAGS='-O3 -march=native -mtune=native -fPIC' FOPTFLAGS='-O3 -march=native -mtune=native -fPIC'\n########################################################\n\n\n########################################################\n## compile openseespy\n# FROM ubuntu-petsc AS ubuntu-openseespy\n\n# ENV DEBIAN_FRONTEND=noninteractive\n\n# WORKDIR /home\n# COPY opensees /home/opensees\n# COPY Makefile.def /home/opensees/\n\n# RUN mkdir /home/bin && \\\n#     mkdir /home/lib\n\n# WORKDIR /home/opensees\n# RUN make python -j\n########################################################\n\n########################################################\n## compile openseespy-pip\n# FROM ubuntu-openseespy AS ubuntu-pip\n\n# # Build openseespy package\n# WORKDIR /home\n# COPY openseespy-pip /home/openseespy-pip\n# RUN apt-get -y install apt-utils  python3.8-distutils curl && \\\n#     curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py && \\\n#     python3.8 get-pip.py\n\n# copy windows version\n# COPY opensees.pyd /home/bin/\n\n# copy mac version\n# COPY opensees.so /home/bin/\n\n# WORKDIR /home/openseespy-pip\n# RUN python3.8 build_pip.py build \\\n#     ../opensees/SRC/interpreter/opensees.so \\\n#     /home/bin/opensees.pyd \\\n#     /home/bin/opensees.so \\\n#     copy_dep \\\n#     python3.8 no_zip\n########################################################\n\n#######################################################\n# test centos\nFROM centos:7.5.1804  AS test-centos-7.5.1804\nRUN yum update -y && \\\n    yum -y install python3 python3-pip && \\\n    python3 -m pip install pytest && rm -rf /var/cache/yum\n\nWORKDIR /home\nCOPY openseespy-pip /home/openseespy-pip\n\nWORKDIR /home/openseespy-pip\n\nENTRYPOINT [ \"python3\", \"build_pip.py\", \"python3\"]\nCMD [ \"test-test\" ]\n#######################################################\n\n#######################################################\n# test centos\nFROM centos:7  AS test-centos-7\nRUN yum update -y\nRUN yum -y install python3 python3-pip && \\\n    python3 -m pip install pytest && rm -rf /var/cache/yum\n\nWORKDIR /home\nENV test=test\nCOPY openseespy-pip /home/openseespy-pip\n\nWORKDIR /home/openseespy-pip\n\nENTRYPOINT [ \"python3\", \"build_pip.py\", \"python3\"]\nCMD [ \"test-test\" ]\n#######################################################\n\n#######################################################\n# test centos\nFROM centos:8  AS test-centos-8\nRUN yum update -y\nRUN yum -y install python3.8 python3-pip && \\\n    python3.8 -m pip install pytest && rm -rf /var/cache/yum\n\nWORKDIR /home\nCOPY openseespy-pip /home/openseespy-pip\n\nWORKDIR /home/openseespy-pip\n\nENTRYPOINT [ \"python3.8\", \"build_pip.py\", \"python3.8\"]\nCMD [ \"test-test\" ]\n#######################################################\n\n#######################################################\n# test ubuntu\nFROM ubuntu:16.04  AS test-ubuntu-16.04\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt-get update -y\nRUN apt-get -y --no-install-recommends install python3.5 python3-pip && rm -rf /var/lib/apt/lists/*;\n\nWORKDIR /home\nCOPY openseespy-pip /home/openseespy-pip\n\nWORKDIR /home/openseespy-pip\n\nENTRYPOINT [ \"bash\"]\n# CMD [ \"python3.5\", \"build_pip.py\", \"python3.5\"]\n#######################################################\n\n#######################################################\n# test ubuntu\nFROM ubuntu:18.04  AS test-ubuntu-18.04\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt-get update -y\nRUN apt-get -y --no-install-recommends install python3.8 python3-pip && \\\n    python3.8 -m pip install --upgrade pip && \\\n    python3.8 -m pip install pytest && rm -rf /var/lib/apt/lists/*;\n\nWORKDIR /home\nCOPY openseespy-pip /home/openseespy-pip\n\nWORKDIR /home/openseespy-pip\n\nENTRYPOINT [ \"python3.8\", \"build_pip.py\", \"python3.8\"]\nCMD [ \"test-test\" ]\n#######################################################\n\n#######################################################\n# test ubuntu\nFROM ubuntu:20.04  AS test-ubuntu-20.04\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt-get update -y\nRUN apt-get -y --no-install-recommends install python3.8 python3-pip && \\\n    python3.8 -m pip install --upgrade pip && \\\n    python3.8 -m pip install pytest && rm -rf /var/lib/apt/lists/*;\n\nWORKDIR /home\nCOPY openseespy-pip /home/openseespy-pip\n\nWORKDIR /home/openseespy-pip\n\nENTRYPOINT [ \"python3.8\", \"build_pip.py\", \"python3.8\"]\nCMD [ \"test-test\" ]\n#######################################################\n\n#######################################################\n# test debian\nFROM debian  AS test-debian\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt-get update -y\nRUN apt-get -y --no-install-recommends install python3 python3-pip && \\\n    python3 -m pip install --upgrade pip && \\\n    python3 -m pip install pytest && rm -rf /var/lib/apt/lists/*;\n\nWORKDIR /home\nENV test=test\nCOPY openseespy-pip /home/openseespy-pip\n\nWORKDIR /home/openseespy-pip\n\nENTRYPOINT [ \"python3\", \"build_pip.py\", \"python3\"]\nCMD [ \"test-test\" ]\n#######################################################\n\n#######################################################\n# test fedora\nFROM fedora  AS test-fedora\nRUN yum update -y\nRUN yum -y install python3 python3-pip && \\\n    python3 -m pip install --upgrade pip && \\\n    python3 -m pip install pytest && rm -rf /var/cache/yum\n\nWORKDIR /home\nENV test=test\nCOPY openseespy-pip /home/openseespy-pip\n\nWORKDIR /home/openseespy-pip\n\nENTRYPOINT [ \"python3\", \"build_pip.py\", \"python3\"]\nCMD [ \"test-test\" ]\n#######################################################\n\n#######################################################\n# install openseespy\nFROM ubuntu:18.04  AS ubuntu-install\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt-get update -y\nRUN apt-get -y --no-install-recommends install python3.8 python3-pip && rm -rf /var/lib/apt/lists/*;\nWORKDIR /home\nCOPY --from=2 /home/openseespy-pip/dist/openseespy-*.whl /home/\nCOPY --from=0 /home/petsc/arch-linux-c-opt/bin/mpiexec* /usr/local/bin/\nCOPY --from=0 /home/petsc/arch-linux-c-opt/bin/hydra_* /usr/local/bin/\nCOPY hello.py /home/\nRUN python3.8 -m pip install openseespy-*.whl\nRUN rm -f openseespy-*.whl\nWORKDIR /\nCMD python3.8\n#######################################################\n\n#######################################################\n# openseespy\nFROM ubuntu-install AS ubuntu-notebook\nRUN python3.8 -m pip install notebook\nWORKDIR /\nCMD jupyter notebook --ip=0.0.0.0 --no-browser --allow-root\n#######################################################\n\n\n# #######################################################\n# # opensees tcl serial\n# FROM ubuntu:18.04 AS opensees-serial\n# RUN apt-get update -y\n# RUN apt-get -y install libgfortran4 libgomp1 libblas3 libtcl8.6\n# RUN mkdir /app\n# WORKDIR /app\n# COPY --from=0 /home/bin/openseesmp /app/openseesmp\n# COPY --from=0 /home/petsc/arch-linux2-c-opt/bin/mpiexec* /app/\n# COPY --from=0 /home/petsc/arch-linux2-c-opt/bin/hydra_* /app/\n# WORKDIR /home\n# CMD /app/openseesmp\n# #######################################################\n\n# #######################################################\n# # opensees tcl parallel\n# FROM ubuntu:18.04 AS opensees-parallel\n# RUN apt-get update -y\n# RUN apt-get -y install libgfortran4 libgomp1 libblas3 libtcl8.6\n# RUN mkdir /app\n# WORKDIR /app\n# ENV np=1\n# ENV script=hello.tcl\n# COPY --from=0 /home/bin/openseesmp /app/openseesmp\n# COPY --from=0 /home/petsc/arch-linux2-c-opt/bin/mpiexec* /app/\n# COPY --from=0 /home/petsc/arch-linux2-c-opt/bin/hydra_* /app/\n# COPY ${script} /home\n# WORKDIR /home\n# CMD /app/mpiexec -np $np /app/openseesmp $script\n# #######################################################"
}