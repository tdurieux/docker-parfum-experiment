{
  "startTime": 1674216400062,
  "endTime": 1674216401397,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 4,
        "columnEnd": 15
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM node:14.16.1 AS build\n\nWORKDIR /opt/ng\n\nRUN apt-get update && apt-get install -y --no-install-recommends git && \\\n    rm -rf /var/lib/apt/lists/*\n\nCOPY package.json package-lock.json ./\nRUN npm install && npm cache clean --force;\n\nCOPY . ./\nRUN npm run build-prod\n\nARG GIT_HEAD_COMMIT\nARG GIT_CURRENT_BRANCH\nRUN if [ -z \"$GIT_HEAD_COMMIT\" ] ; then \\\n    printf '{\"name\": \"ui\", \"version\":\"%s\", \"gitHeadCommit\":\"%s\",\"gitCurrentBranch\":\"%s\", \"nodeVersion\":\"%s\"}\\n' \"$(cat version)\" \"$(git rev-parse HEAD)\" \"$(git rev-parse --abbrev-ref HEAD)\" \"$(node --version)\" >> buildinfo.json ; else \\\n    printf '{\"name\": \"ui\", \"version\":\"%s\", \"gitHeadCommit\":\"%s\",\"gitCurrentBranch\":\"%s\", \"nodeVersion\":\"%s\"}\\n' \"$(cat version)\" \"$GIT_HEAD_COMMIT\" \"$GIT_CURRENT_BRANCH\" \"$(node --version)\" >> buildinfo.json ; \\\n    fi\n\nFROM openresty/openresty:1.19.9.1-0-amzn2\nLABEL maintainer=\"support@hydrosphere.io\"\n\nRUN yum update -y && yum upgrade -y && yum clean all\n\nRUN useradd -u 42069 --create-home --shell /bin/bash app && \\\n    chown -R app:app /usr/local/openresty/\n\nUSER app\n\nENV OSS=true;\n\nENV MANAGER_HOST=localhost\nENV GATEWAY_HOST=localhost\nENV MONITORING_HOST=localhost\nENV ROOTCAUSE_HOST=localhost\nENV PROMETHEUS_AM_HOST=localhost\nENV VISUALIZATION_HOST=localhost\nENV STAT_HOST=localhost\nENV AUTO_OD_HOST=localhost\n\nENV MANAGER_HTTP_PORT=8080\nENV MANAGER_GRPC_PORT=9090\nENV GATEWAY_HTTP_PORT=8080\nENV GATEWAY_GRPC_PORT=9090\nENV MONITORING_HTTP_PORT=8080\nENV MONITORING_GRPC_PORT=9090\nENV ROOTCAUSE_HTTP_PORT=5005\nENV PROMETHEUS_AM_PORT=9093\nENV VISUALIZATION_HTTP_PORT=5000\nENV VISUALIZATION_GRPC_PORT=5003\nENV STAT_PORT=5000\nENV AUTO_OD_GRPC_PORT=5000\n\nENV INGRESS_PATH=/\n\nEXPOSE 8080\n\nCOPY --chown=app:app docker/nginx/conf.d /etc/nginx/conf.d/\nCOPY --chown=app:app docker/nginx/config/nginx.conf /usr/local/openresty/nginx/conf/nginx.conf\nCOPY --chown=app:app --from=build /opt/ng/hydro-serving-ui /usr/share/nginx/html\nCOPY --chown=app:app --from=build /opt/ng/buildinfo.json /usr/share/nginx/html/assets/buildinfo.json\n\nCMD envsubst '${GATEWAY_HOST} ${GATEWAY_GRPC_PORT}' < /etc/nginx/conf.d/grpc/include.gateway.template > /etc/nginx/conf.d/grpc/include.gateway \\\n  && envsubst '${MANAGER_HOST} ${MANAGER_GRPC_PORT}' < /etc/nginx/conf.d/grpc/include.manager.template > /etc/nginx/conf.d/grpc/include.manager \\\n  && envsubst '${MONITORING_HOST} ${MONITORING_GRPC_PORT}' < /etc/nginx/conf.d/grpc/include.monitoring.template > /etc/nginx/conf.d/grpc/include.monitoring \\\n  && envsubst '${AUTO_OD_HOST} ${AUTO_OD_GRPC_PORT}' < /etc/nginx/conf.d/grpc/include.auto_od.template > /etc/nginx/conf.d/grpc/include.auto_od \\\n  && envsubst '${VISUALIZATION_HOST} ${VISUALIZATION_GRPC_PORT}' < /etc/nginx/conf.d/grpc/include.visualization.template > /etc/nginx/conf.d/grpc/include.visualization \\\n#\n  && envsubst '${PROMETHEUS_AM_HOST} ${PROMETHEUS_AM_PORT}' < /etc/nginx/conf.d/http/include.alerts.template > /etc/nginx/conf.d/http/include.alerts \\\n  && envsubst '${GATEWAY_HOST} ${GATEWAY_HTTP_PORT}' < /etc/nginx/conf.d/http/include.gateway.template > /etc/nginx/conf.d/http/include.gateway \\\n  && envsubst '${MANAGER_HOST} ${MANAGER_HTTP_PORT}' < /etc/nginx/conf.d/http/include.manager.template > /etc/nginx/conf.d/http/include.manager \\\n  && envsubst '${MONITORING_HOST} ${MONITORING_HTTP_PORT}' < /etc/nginx/conf.d/http/include.monitoring.template > /etc/nginx/conf.d/http/include.monitoring \\\n  && envsubst '${ROOTCAUSE_HOST} ${ROOTCAUSE_HTTP_PORT}' < /etc/nginx/conf.d/http/include.rootcause.template > /etc/nginx/conf.d/http/include.rootcause \\\n  && envsubst '${VISUALIZATION_HOST} ${VISUALIZATION_HTTP_PORT}' < /etc/nginx/conf.d/http/include.visualization.template > /etc/nginx/conf.d/http/include.visualization \\\n  && envsubst '${STAT_HOST} ${STAT_PORT}' < /etc/nginx/conf.d/http/include.stat.template > /etc/nginx/conf.d/http/include.stat \\\n#\n  && envsubst '${INGRESS_PATH}' < /etc/nginx/conf.d/http/include.root.template > /etc/nginx/conf.d/http/include.root \\\n#\n  && exec /usr/local/openresty/bin/openresty -g 'daemon off;'\n"
}