{
  "startTime": 1674255438528,
  "endTime": 1674255439467,
  "originalSmells": [
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 59,
        "lineEnd": 62,
        "columnStart": 22,
        "columnEnd": 43
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG docker_repo=zokradonh\nFROM ${docker_repo}/kopano_php\n\nARG ADDITIONAL_KOPANO_PACKAGES=\"\"\nARG ADDITIONAL_KOPANO_WEBAPP_PLUGINS=\"\"\nARG DEBIAN_FRONTEND=noninteractive\nARG DOWNLOAD_COMMUNITY_PACKAGES=1\nARG KOPANO_CORE_REPOSITORY_URL=\"file:/kopano/repo/core\"\nARG KOPANO_CORE_VERSION=newest\nARG KOPANO_REPOSITORY_FLAGS=\"trusted=yes\"\nARG KOPANO_WEBAPP_FILES_REPOSITORY_URL=\"file:/kopano/repo/files\"\nARG KOPANO_WEBAPP_MDM_REPOSITORY_URL=\"file:/kopano/repo/mdm\"\nARG KOPANO_WEBAPP_REPOSITORY_URL=\"file:/kopano/repo/webapp\"\nARG KOPANO_WEBAPP_SMIME_REPOSITORY_URL=\"file:/kopano/repo/smime\"\nARG KOPANO_WEBAPP_VERSION=newest\n\nENV \\\n    ADDITIONAL_KOPANO_PACKAGES=$ADDITIONAL_KOPANO_PACKAGES \\\n    ADDITIONAL_KOPANO_WEBAPP_PLUGINS=$ADDITIONAL_KOPANO_WEBAPP_PLUGINS \\\n    DOWNLOAD_COMMUNITY_PACKAGES=$DOWNLOAD_COMMUNITY_PACKAGES \\\n    KOPANO_CORE_REPOSITORY_URL=$KOPANO_CORE_REPOSITORY_URL \\\n    KOPANO_CORE_VERSION=$KOPANO_CORE_VERSION \\\n    KOPANO_REPOSITORY_FLAGS=$KOPANO_REPOSITORY_FLAGS \\\n    KOPANO_WEBAPP_FILES_REPOSITORY_URL=$KOPANO_WEBAPP_FILES_REPOSITORY_URL \\\n    KOPANO_WEBAPP_MDM_REPOSITORY_URL=$KOPANO_WEBAPP_MDM_REPOSITORY_URL \\\n    KOPANO_WEBAPP_REPOSITORY_URL=$KOPANO_WEBAPP_REPOSITORY_URL \\\n    KOPANO_WEBAPP_SMIME_REPOSITORY_URL=$KOPANO_WEBAPP_SMIME_REPOSITORY_URL \\\n    KOPANO_WEBAPP_VERSION=$KOPANO_WEBAPP_VERSION \\\n    LANG=en_US.UTF-8\n\nLABEL maintainer=az@zok.xyz \\\n    org.label-schema.name=\"Kopano WebApp container\" \\\n    org.label-schema.description=\"Container for running Kopano WebApp\" \\\n    org.label-schema.url=\"https://kopano.io\" \\\n    org.label-schema.vcs-url=\"https://github.com/zokradonh/kopano-docker\" \\\n    org.label-schema.version=$KOPANO_WEBAPP_VERSION \\\n    org.label-schema.schema-version=\"1.0\"\n\nSHELL [\"/bin/bash\", \"-o\", \"pipefail\", \"-c\"]\n\n# install Kopano WebApp\n# hadolint ignore=SC2129\nRUN --mount=type=secret,id=repocred,target=/etc/apt/auth.conf.d/kopano.conf \\\n\n\n    . /kopano/helper/create-kopano-repo.sh && \\\n    if [ ${DOWNLOAD_COMMUNITY_PACKAGES} -eq 1 ]; then \\\n        dl_and_package_community \"webapp\" \"Debian_10\"; \\\n        dl_and_package_community \"files\" \"Debian_10\"; \\\n        dl_and_package_community \"mdm\" \"Debian_10\"; \\\n        dl_and_package_community \"smime\" \"Debian_10\"; \\\n    fi; \\\n    echo \"deb [${KOPANO_REPOSITORY_FLAGS}] ${KOPANO_WEBAPP_REPOSITORY_URL} ./\" >> /etc/apt/sources.list.d/kopano.list; \\\n    echo \"deb [${KOPANO_REPOSITORY_FLAGS}] ${KOPANO_WEBAPP_SMIME_REPOSITORY_URL} ./\" >> /etc/apt/sources.list.d/kopano.list; \\\n    echo \"deb [${KOPANO_REPOSITORY_FLAGS}] ${KOPANO_WEBAPP_MDM_REPOSITORY_URL} ./\" >> /etc/apt/sources.list.d/kopano.list; \\\n    echo \"deb [${KOPANO_REPOSITORY_FLAGS}] ${KOPANO_WEBAPP_FILES_REPOSITORY_URL} ./\" >> /etc/apt/sources.list.d/kopano.list; \\\n    # install\n    set -x && \\\n    apt-get update && apt-get install -y --no-install-recommends \\\n        kopano-webapp \\\n        ${ADDITIONAL_KOPANO_PACKAGES} \\\n        ${ADDITIONAL_KOPANO_WEBAPP_PLUGINS} \\\n    && rm -rf /var/cache/apt /var/lib/apt/lists && rm -rf /var/lib/apt/lists/*;\n\n# tweak to make the container read-only\nRUN mkdir -p /tmp/webapp/ && \\\n    for i in /etc/kopano/webapp/* /etc/kopano/webapp/.[^.]*; do \\\n        mv \"$i\" \"$i.dist\"; \\\n        ln -s /tmp/webapp/\"$(basename \"$i\")\" \"$i\"; \\\n    done\n\nCOPY kopano-webapp.conf /etc/php/7.3/fpm/pool.d/\nCOPY kweb.cfg /etc/kweb.cfg\nCOPY start.sh /kopano/start.sh\nCOPY goss* /goss/\n\nWORKDIR /kopano/path\n\nENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\nCMD [ \"/kopano/start.sh\" ]\n\nHEALTHCHECK --interval=1m --timeout=10s \\\n    CMD goss -g /goss/goss.yaml validate\n\nARG VCS_REF\nLABEL org.label-schema.vcs-ref=$VCS_REF"
}