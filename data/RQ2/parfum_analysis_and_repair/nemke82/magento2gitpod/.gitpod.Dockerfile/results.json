{
  "startTime": 1674249535443,
  "endTime": 1674249538540,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 117,
        "lineEnd": 117,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 118,
        "lineEnd": 118,
        "columnStart": 7,
        "columnEnd": 53
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 126,
        "lineEnd": 126,
        "columnStart": 12,
        "columnEnd": 140
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 141,
        "lineEnd": 141,
        "columnStart": 9,
        "columnEnd": 85
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 150,
        "lineEnd": 150,
        "columnStart": 9,
        "columnEnd": 85
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 190,
        "lineEnd": 190,
        "columnStart": 2,
        "columnEnd": 95
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 227,
        "lineEnd": 227,
        "columnStart": 4,
        "columnEnd": 90
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 239,
        "lineEnd": 239,
        "columnStart": 4,
        "columnEnd": 126
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 243,
        "lineEnd": 243,
        "columnStart": 4,
        "columnEnd": 124
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 247,
        "lineEnd": 247,
        "columnStart": 4,
        "columnEnd": 150
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 127,
        "lineEnd": 127,
        "columnStart": 12,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 240,
        "lineEnd": 240,
        "columnStart": 7,
        "columnEnd": 43
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 244,
        "lineEnd": 244,
        "columnStart": 7,
        "columnEnd": 42
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 248,
        "lineEnd": 248,
        "columnStart": 7,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 3,
        "lineEnd": 3,
        "columnStart": 9,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 4,
        "lineEnd": 4,
        "columnStart": 9,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 5,
        "lineEnd": 5,
        "columnStart": 9,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 9,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 7,
        "lineEnd": 7,
        "columnStart": 9,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 9,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 9,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 9,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 11,
        "lineEnd": 11,
        "columnStart": 9,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 9,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 9,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 9,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 9,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 9,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 9,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 12,
        "columnEnd": 95
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 12,
        "columnEnd": 341
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 9,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 73,
        "lineEnd": 74,
        "columnStart": 6,
        "columnEnd": 79
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 104,
        "lineEnd": 109,
        "columnStart": 12,
        "columnEnd": 75
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 121,
        "lineEnd": 121,
        "columnStart": 12,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 122,
        "lineEnd": 122,
        "columnStart": 12,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 142,
        "lineEnd": 142,
        "columnStart": 63,
        "columnEnd": 98
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 152,
        "lineEnd": 152,
        "columnStart": 40,
        "columnEnd": 72
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 163,
        "lineEnd": 164,
        "columnStart": 9,
        "columnEnd": 14
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 261,
        "lineEnd": 265,
        "columnStart": 12,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 268,
        "lineEnd": 268,
        "columnStart": 9,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 3,
        "lineEnd": 3,
        "columnStart": 9,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 4,
        "lineEnd": 4,
        "columnStart": 9,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 5,
        "lineEnd": 5,
        "columnStart": 9,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 9,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 7,
        "lineEnd": 7,
        "columnStart": 9,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 9,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 9,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 9,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 11,
        "lineEnd": 11,
        "columnStart": 9,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 9,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 9,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 9,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 9,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 9,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 9,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 103,
        "lineEnd": 103,
        "columnStart": 65,
        "columnEnd": 84
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 104,
        "lineEnd": 109,
        "columnStart": 12,
        "columnEnd": 75
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 268,
        "lineEnd": 268,
        "columnStart": 9,
        "columnEnd": 57
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 3,
        "lineEnd": 3,
        "columnStart": 9,
        "columnEnd": 39
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 4,
        "lineEnd": 4,
        "columnStart": 9,
        "columnEnd": 37
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 5,
        "lineEnd": 5,
        "columnStart": 9,
        "columnEnd": 34
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 9,
        "columnEnd": 46
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 7,
        "lineEnd": 7,
        "columnStart": 9,
        "columnEnd": 33
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 9,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 9,
        "columnEnd": 39
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 9,
        "columnEnd": 42
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 11,
        "lineEnd": 11,
        "columnStart": 9,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 9,
        "columnEnd": 50
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 9,
        "columnEnd": 65
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 9,
        "columnEnd": 41
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 9,
        "columnEnd": 31
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 9,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 9,
        "columnEnd": 34
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 73,
        "lineEnd": 74,
        "columnStart": 6,
        "columnEnd": 79
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 104,
        "lineEnd": 109,
        "columnStart": 12,
        "columnEnd": 75
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 121,
        "lineEnd": 121,
        "columnStart": 12,
        "columnEnd": 46
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 122,
        "lineEnd": 122,
        "columnStart": 12,
        "columnEnd": 44
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 261,
        "lineEnd": 265,
        "columnStart": 12,
        "columnEnd": 64
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 268,
        "lineEnd": 268,
        "columnStart": 9,
        "columnEnd": 57
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 3,
        "lineEnd": 3,
        "columnStart": 9,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 4,
        "lineEnd": 4,
        "columnStart": 9,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 5,
        "lineEnd": 5,
        "columnStart": 9,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 9,
        "columnEnd": 70
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 7,
        "lineEnd": 7,
        "columnStart": 9,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 9,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 9,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 9,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 11,
        "lineEnd": 11,
        "columnStart": 9,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 9,
        "columnEnd": 74
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 9,
        "columnEnd": 89
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 9,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 9,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 9,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 9,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 103,
        "lineEnd": 103,
        "columnStart": 65,
        "columnEnd": 84
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 104,
        "lineEnd": 109,
        "columnStart": 12,
        "columnEnd": 75
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 268,
        "lineEnd": 268,
        "columnStart": 9,
        "columnEnd": 81
      }
    }
  ],
  "repairedDockerfile": "FROM gitpod/workspace-full:latest\n\nRUN sudo apt-get update\nRUN sudo apt-get -y --no-install-recommends install lsb-release && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-get -y --no-install-recommends install apt-utils && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-get -y --no-install-recommends install python && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-get install --no-install-recommends -y libmysqlclient-dev && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-get -y --no-install-recommends install rsync && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-get -y --no-install-recommends install curl && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-get -y --no-install-recommends install libnss3-dev && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-get -y --no-install-recommends install openssh-client && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-get -y --no-install-recommends install mc && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt install --no-install-recommends -y software-properties-common && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-get -y --no-install-recommends install gcc make autoconf libc-dev pkg-config && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-get -y --no-install-recommends install libmcrypt-dev && rm -rf /var/lib/apt/lists/*;\nRUN sudo mkdir -p /tmp/pear/cache\nRUN sudo mkdir -p /etc/bash_completion.d/cargo\nRUN sudo apt install --no-install-recommends -y php-dev && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt install --no-install-recommends -y php-pear && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-get -y --no-install-recommends install dialog && rm -rf /var/lib/apt/lists/*;\n\n#Install php-fpm7.4\nRUN sudo apt-get update \\\n    && sudo apt-get install --no-install-recommends -y curl zip unzip git software-properties-common supervisor sqlite3 \\\n    && sudo add-apt-repository -y ppa:ondrej/php \\\n    && sudo apt-get update \\\n    && sudo apt-get install --no-install-recommends -y php7.4-dev php7.4-dev php7.4-fpm php7.4-common php7.4-cli php7.4-imagick php7.4-gd php7.4-mysql php7.4-pgsql php7.4-imap php-memcached php7.4-mbstring php7.4-xml php7.4-xmlrpc php7.4-soap php7.4-zip php7.4-curl php7.4-bcmath php7.4-sqlite3 php7.4-apcu php7.4-apcu-bc php7.4-intl php-dev php7.4-xdebug php-redis php7.4-dev \\\n    && sudo php -r \"readfile('http://getcomposer.org/installer');\" | sudo php -- --install-dir=/usr/bin/ --version=1.10.16 --filename=composer \\\n    && sudo mkdir /run/php \\\n    && sudo chown gitpod:gitpod /run/php \\\n    && sudo chown -R gitpod:gitpod /etc/php \\\n    && sudo apt-get remove -y --purge software-properties-common \\\n    && sudo apt-get -y autoremove \\\n    && sudo apt-get clean \\\n    && sudo rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* \\\n    && sudo update-alternatives --remove php /usr/bin/php8.0 \\\n    && sudo update-alternatives --remove php /usr/bin/php7.3 \\\n    && sudo update-alternatives --set php /usr/bin/php7.4 \\\n    && sudo echo \"daemon off;\" >> /etc/nginx/nginx.conf\n\n#Adjust few options for xDebug and disable it by default\nRUN echo \"xdebug.remote_enable=on\" >> /etc/php/7.4/mods-available/xdebug.ini\n    #&& echo \"xdebug.remote_autostart=on\" >> /etc/php/7.4/mods-available/xdebug.ini\n    #&& echo \"xdebug.profiler_enable=On\" >> /etc/php/7.4/mods-available/xdebug.ini \\\n    #&& echo \"xdebug.profiler_output_dir = /workspace/magento2pitpod\" >> /etc/php/7.4/mods-available/xdebug.ini \\\n    #&& echo \"xdebug.profiler_output_name = nemanja.log >> /etc/php/7.4/mods-available/xdebug.ini \\\n    #&& echo \"xdebug.show_error_trace=On\" >> /etc/php/7.4/mods-available/xdebug.ini \\\n    #&& echo \"xdebug.show_exception_trace=On\" >> /etc/php/7.4/mods-available/xdebug.ini\nRUN mv /etc/php/7.4/cli/conf.d/20-xdebug.ini /etc/php/7.4/cli/conf.d/20-xdebug.ini-bak\nRUN mv /etc/php/7.4/fpm/conf.d/20-xdebug.ini /etc/php/7.4/fpm/conf.d/20-xdebug.ini-bak\n\n# Install MySQL\nENV PERCONA_MAJOR 5.7\nRUN sudo apt-get update \\\n && sudo apt-get -y --no-install-recommends install gnupg2 \\\n && sudo apt-get clean && sudo rm -rf /var/cache/apt/* /var/lib/apt/lists/* /tmp/* \\\n && sudo mkdir /var/run/mysqld \\\n && sudo wget -c https://repo.percona.com/apt/percona-release_latest.stretch_all.deb \\\n && sudo dpkg -i percona-release_latest.stretch_all.deb \\\n && sudo apt-get update\n\nRUN set -ex; \\\n\t{ \\\n\t\tfor key in \\\n\t\t\tpercona-server-server/root_password \\\n\t\t\tpercona-server-server/root_password_again \\\n\t\t\t\"percona-server-server-$PERCONA_MAJOR/root-pass\" \\\n\t\t\t\"percona-server-server-$PERCONA_MAJOR/re-root-pass\" \\\n\t\t; do \\\n\t\t\tsudo echo \"percona-server-server-$PERCONA_MAJOR\" \"$key\" password 'nem4540'; \\\n\t\tdone; \\\n\t} | sudo debconf-set-selections; \\\n\tsudo apt-get update; \\\n\tsudo apt-get install --no-install-recommends -y \\\n\t\tpercona-server-server-5.7 percona-server-client-5.7 percona-server-common-5.7 \\\n\t; rm -rf /var/lib/apt/lists/*;\n\nRUN sudo chown -R gitpod:gitpod /etc/mysql /var/run/mysqld /var/log/mysql /var/lib/mysql /var/lib/mysql-files /var/lib/mysql-keyring\n\n# Install our own MySQL config\nCOPY mysql.cnf /etc/mysql/conf.d/mysqld.cnf\nCOPY .my.cnf /home/gitpod\nCOPY mysql.conf /etc/supervisor/conf.d/mysql.conf\nRUN sudo chown gitpod:gitpod /home/gitpod/.my.cnf\n\n# Install default-login for MySQL clients\nCOPY client.cnf /etc/mysql/conf.d/client.cnf\n\n#Copy nginx default and php-fpm.conf file\n#COPY default /etc/nginx/sites-available/default\nCOPY php-fpm.conf /etc/php/7.4/fpm/php-fpm.conf\nCOPY sp-php-fpm.conf /etc/supervisor/conf.d/sp-php-fpm.conf\nRUN sudo chown -R gitpod:gitpod /etc/php\n\nCOPY nginx.conf /etc/nginx\n\n#Selenium required for MFTF\nRUN sudo wget -c https://selenium-release.storage.googleapis.com/3.141/selenium-server-standalone-3.141.59.jar\nRUN sudo wget -c https://chromedriver.storage.googleapis.com/80.0.3987.16/chromedriver_linux64.zip\nRUN sudo unzip chromedriver_linux64.zip\n\n# Install Chrome and Chromium\nRUN sudo wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb \\\n    && sudo dpkg -i google-chrome-stable_current_amd64.deb; sudo apt-get -fy install \\\n    && sudo apt-get install --no-install-recommends -yq \\\n       gconf-service libasound2 libatk1.0-0 libatk-bridge2.0-0 libc6 libcairo2 libcups2 libdbus-1-3 \\\n       libexpat1 libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 libglib2.0-0 libgtk-3-0 libnspr4 \\\n       libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 \\\n       libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 ca-certificates \\\n       fonts-liberation libappindicator1 libnss3 lsb-release xdg-utils wget && rm -rf /var/lib/apt/lists/*;\n\nENV BLACKFIRE_LOG_LEVEL 1\nENV BLACKFIRE_LOG_FILE /var/log/blackfire/blackfire.log\nENV BLACKFIRE_SOCKET unix:///tmp/agent.sock\nENV BLACKFIRE_SOURCEDIR /etc/blackfire\nENV BLACKFIRE_USER gitpod\n\nRUN curl -f -sS https://packagecloud.io/gpg.key | sudo apt-key add \\\n    && curl -f -sS https://packages.blackfire.io/gpg.key | sudo apt-key add \\\n    && sudo echo \"deb http://packages.blackfire.io/debian any main\" | sudo tee /etc/apt/sources.list.d/blackfire.list \\\n    && sudo apt-get update \\\n    && sudo apt-get install --no-install-recommends -y blackfire-agent \\\n    && sudo apt-get install --no-install-recommends -y blackfire-php && rm -rf /var/lib/apt/lists/*;\n\nRUN \\\n    version=$(php -r \"echo PHP_MAJOR_VERSION, PHP_MINOR_VERSION;\") \\\n    && sudo curl -f -A \"Docker\" -o /tmp/blackfire-probe.tar.gz -D - -L -s https://blackfire.io/api/v1/releases/probe/php/linux/amd64/${version} \\\n    && sudo tar zxpf /tmp/blackfire-probe.tar.gz -C /tmp \\\n    && sudo mv /tmp/blackfire-*.so $(php -r \"echo ini_get('extension_dir');\")/blackfire.so && rm /tmp/blackfire-probe.tar.gz\n\nCOPY blackfire-agent.ini /etc/blackfire/agent\nCOPY blackfire-php.ini /etc/php/7.4/fpm/conf.d/92-blackfire-config.ini\nCOPY blackfire-php.ini /etc/php/7.4/cli/conf.d/92-blackfire-config.ini\n\nCOPY blackfire-run.sh /blackfire-run.sh\n\nENTRYPOINT [\"/bin/bash\", \"/blackfire-run.sh\"]\n\n#Install Tideways\nRUN sudo apt-get update\nRUN sudo echo 'deb http://s3-eu-west-1.amazonaws.com/tideways/packages debian main' | sudo tee /etc/apt/sources.list.d/tideways.list && \\\n    sudo curl -f -sS 'https://s3-eu-west-1.amazonaws.com/tideways/packages/EEB5E8F4.gpg' | sudo apt-key add -\nRUN DEBIAN_FRONTEND=noninteractive sudo apt-get update && sudo apt-get install --no-install-recommends -yq tideways-daemon && \\\n    sudo apt-get autoremove --assume-yes && \\\n    sudo apt-get clean && \\\n    sudo rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\nENTRYPOINT [\"tideways-daemon\",\"--hostname=tideways-daemon\",\"--address=0.0.0.0:9135\"]\n\nRUN sudo echo 'deb http://s3-eu-west-1.amazonaws.com/tideways/packages debian main' | sudo tee /etc/apt/sources.list.d/tideways.list && \\\n    sudo curl -f -sS 'https://s3-eu-west-1.amazonaws.com/tideways/packages/EEB5E8F4.gpg' | sudo apt-key add - && \\\n    sudo apt-get update && \\\n    DEBIAN_FRONTEND=noninteractive sudo apt-get -yq --no-install-recommends install tideways-php && \\\n    sudo apt-get autoremove --assume-yes && \\\n    sudo apt-get clean && \\\n    sudo rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\nRUN echo 'extension=tideways.so\\ntideways.connection=tcp://0.0.0.0:9135\\ntideways.api_key=${TIDEWAYS_APIKEY}\\n' > /etc/php/7.4/cli/conf.d/40-tideways.ini\nRUN echo 'extension=tideways.so\\ntideways.connection=tcp://0.0.0.0:9135\\ntideways.api_key=${TIDEWAYS_APIKEY}\\n' > /etc/php/7.4/fpm/conf.d/40-tideways.ini\nRUN sudo rm -f /etc/php/7.4/cli/20-tideways.ini\n\n# Install Redis.\nRUN sudo apt-get update \\\n && sudo apt-get install --no-install-recommends -y \\\n  redis-server \\\n && sudo rm -rf /var/lib/apt/lists/*\n\n #n98-magerun2 tool.\n RUN wget https://files.magerun.net/n98-magerun2.phar \\\n     && chmod +x ./n98-magerun2.phar \\\n     && sudo mv ./n98-magerun2.phar /usr/local/bin/n98-magerun2\n\n#Install APCU\nRUN echo \"apc.enable_cli=1\" > /etc/php/7.4/cli/conf.d/20-apcu.ini\nRUN echo \"priority=25\" > /etc/php/7.4/cli/conf.d/25-apcu_bc.ini\nRUN echo \"extension=apcu.so\" >> /etc/php/7.4/cli/conf.d/25-apcu_bc.ini\nRUN echo \"extension=apc.so\" >> /etc/php/7.4/cli/conf.d/25-apcu_bc.ini\n\nRUN sudo chown -R gitpod:gitpod /var/log/blackfire\nRUN sudo chown -R gitpod:gitpod /etc/init.d/blackfire-agent\nRUN sudo mkdir -p /var/run/blackfire\nRUN sudo chown -R gitpod:gitpod /var/run/blackfire\nRUN sudo chown -R gitpod:gitpod /etc/blackfire\nRUN sudo chown -R gitpod:gitpod /etc/php\nRUN sudo chown -R gitpod:gitpod /etc/nginx\nRUN sudo chown -R gitpod:gitpod /etc/init.d/\nRUN sudo echo \"net.core.somaxconn=65536\" | sudo tee /etc/sysctl.conf\n\n#New Relic\nRUN \\\n  curl -f -L https://download.newrelic.com/php_agent/release/newrelic-php5-9.18.1.303-linux.tar.gz | tar -C /tmp -zx && \\\n  sudo NR_INSTALL_USE_CP_NOT_LN=1 NR_INSTALL_SILENT=1 /tmp/newrelic-php5-*/newrelic-install install && \\\n  sudo rm -rf /tmp/newrelic-php5-* /tmp/nrinstall* && \\\n  sudo touch /etc/php/7.4/fpm/conf.d/newrelic.ini && \\\n  sudo touch /etc/php/7.4/cli/conf.d/newrelic.ini && \\\n  sudo sed -i \\\n      -e 's/\"REPLACE_WITH_REAL_KEY\"/\"ba052d5cdafbbce81ed22048d8a004dd285aNRAL\"/' \\\n      -e 's/newrelic.appname = \"PHP Application\"/newrelic.appname = \"magento2gitpod\"/' \\\n      -e 's/;newrelic.daemon.app_connect_timeout =.*/newrelic.daemon.app_connect_timeout=15s/' \\\n      -e 's/;newrelic.daemon.start_timeout =.*/newrelic.daemon.start_timeout=5s/' \\\n      /etc/php/7.4/cli/conf.d/newrelic.ini && \\\n  sudo sed -i \\\n      -e 's/\"REPLACE_WITH_REAL_KEY\"/\"ba052d5cdafbbce81ed22048d8a004dd285aNRAL\"/' \\\n      -e 's/newrelic.appname = \"PHP Application\"/newrelic.appname = \"magento2gitpod\"/' \\\n      -e 's/;newrelic.daemon.app_connect_timeout =.*/newrelic.daemon.app_connect_timeout=15s/' \\\n      -e 's/;newrelic.daemon.start_timeout =.*/newrelic.daemon.start_timeout=5s/' \\\n      /etc/php/7.4/fpm/conf.d/newrelic.ini && \\\n  sudo sed -i 's|/var/log/newrelic/|/tmp/|g' /etc/php/7.4/fpm/conf.d/newrelic.ini && \\\n  sudo sed -i 's|/var/log/newrelic/|/tmp/|g' /etc/php/7.4/cli/conf.d/newrelic.ini\n\nRUN sudo chown -R gitpod:gitpod /etc/php\nRUN sudo chown -R gitpod:gitpod /etc/newrelic\nCOPY newrelic.cfg /etc/newrelic\nRUN sudo rm -f /usr/bin/php\nRUN sudo ln -s /usr/bin/php7.4 /usr/bin/php\n\n# nvm environment variables\nRUN sudo mkdir -p /usr/local/nvm\nRUN sudo chown gitpod:gitpod /usr/local/nvm\nENV NVM_DIR /usr/local/nvm\nENV NODE_VERSION 14.17.3\n\n# Replace shell with bash so we can source files\nRUN sudo rm /bin/sh && sudo ln -s /bin/bash /bin/sh\n\n# install nvm\n# https://github.com/creationix/nvm#install-script\nRUN curl -f --silent -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash\n\n# install node and npm, set default alias\nRUN source $NVM_DIR/nvm.sh \\\n  && nvm install $NODE_VERSION \\\n  && nvm alias default $NODE_VERSION \\\n  && nvm use default\n\n# add node and npm to path so the commands are available\nENV NODE_PATH $NVM_DIR/v$NODE_VERSION/lib/node_modules\nENV PATH $NVM_DIR/versions/node/v$NODE_VERSION/bin:$PATH\n\nRUN curl -f https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-5.6.16.tar.gz --output elasticsearch-5.6.16.tar.gz \\\n    && tar -xzf elasticsearch-5.6.16.tar.gz && rm elasticsearch-5.6.16.tar.gz\nENV ES_HOME56=\"$HOME/elasticsearch-5.6.16\"\n\nRUN curl -f https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-6.8.9.tar.gz --output elasticsearch-6.8.9.tar.gz \\\n    && tar -xzf elasticsearch-6.8.9.tar.gz && rm elasticsearch-6.8.9.tar.gz\nENV ES_HOME68=\"$HOME/elasticsearch-6.8.9\"\n\nRUN curl -f https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.9.3-linux-x86_64.tar.gz --output elasticsearch-7.9.3-linux-x86_64.tar.gz \\\n    && tar -xzf elasticsearch-7.9.3-linux-x86_64.tar.gz && rm elasticsearch-7.9.3-linux-x86_64.tar.gz\nENV ES_HOME79=\"$HOME/elasticsearch-7.9.3\"\n\nCOPY sp-elasticsearch.conf /etc/supervisor/conf.d/elasticsearch.conf\n\nRUN sudo apt-key adv --keyserver \"hkps://keys.openpgp.org\" --recv-keys \"0x0A9AF2115F4687BD29803A206B73A36E6026DFCA\" \\\n    && sudo apt-key adv --keyserver \"keyserver.ubuntu.com\" --recv-keys \"F77F1EDA57EBB1CC\" \\\n    && sudo curl -1sLf 'https://packagecloud.io/rabbitmq/rabbitmq-server/gpgkey' | sudo apt-key add - \\\n    && sudo echo 'deb http://ppa.launchpad.net/rabbitmq/rabbitmq-erlang/ubuntu bionic main' | sudo tee /etc/apt/sources.list.d/rabbitmq.list \\\n    && sudo echo 'deb-src http://ppa.launchpad.net/rabbitmq/rabbitmq-erlang/ubuntu bionic main' | sudo tee /etc/apt/sources.list.d/rabbitmq.list \\\n    && sudo echo 'deb https://packagecloud.io/rabbitmq/rabbitmq-server/debian/ buster main' | sudo tee /etc/apt/sources.list.d/rabbitmq.list \\\n    && sudo echo 'deb-src https://packagecloud.io/rabbitmq/rabbitmq-server/debian/ buster main' | sudo tee /etc/apt/sources.list.d/rabbitmq.list \\\n    && sudo apt-get update -y \\\n    && sudo apt-get install --no-install-recommends -y erlang-base \\\n       erlang-asn1 erlang-crypto erlang-eldap erlang-ftp erlang-inets \\\n       erlang-mnesia erlang-os-mon erlang-parsetools erlang-public-key \\\n       erlang-runtime-tools erlang-snmp erlang-ssl \\\n       erlang-syntax-tools erlang-tftp erlang-tools erlang-xmerl && rm -rf /var/lib/apt/lists/*;\n\n## Install rabbitmq-server and its dependencies\nRUN sudo apt-get install --no-install-recommends rabbitmq-server -y --fix-missing && rm -rf /var/lib/apt/lists/*;\n\nCOPY lighthouse.conf /etc\nCOPY rabbitmq.conf /etc/rabbitmq/rabbitmq.conf\nRUN sudo cat /etc/lighthouse.conf >> /home/gitpod/.bashrc\n"
}