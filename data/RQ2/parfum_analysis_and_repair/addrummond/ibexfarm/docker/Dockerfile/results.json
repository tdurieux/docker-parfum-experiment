{
  "startTime": 1674220768896,
  "endTime": 1674220770227,
  "originalSmells": [
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 104,
        "lineEnd": 104,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 4,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 9
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM alpine:3.8\n\n# Install required alpine linux packages.\nRUN apk update && \\\n    apk add --no-cache \\\n      git \\\n      perl \\\n      perl-dev \\\n      musl-dev \\\n      python \\\n      apache2 \\\n      gcc \\\n      make \\\n      perl-app-cpanminus \\\n      perl-namespace-autoclean \\\n      perl-yaml \\\n      perl-yaml-xs \\\n      perl-moose \\\n      perl-time-hires \\\n      perl-archive-zip \\\n      perl-params-classify \\\n      gdbm \\\n      apache2-dev \\\n      curl \\\n      apache2-utils \\\n      apache2-ssl \\\n      shadow \\\n      vim\n\n# Install the remaining required perl modules using cpanm.\n# Build Crypt::Rijndael perl module from source\n# because we need to apply a patch to rijndael.h.\n# Build modperl from source because no stable alpine package available.\nRUN cd /tmp && \\\n    wget https://archive.apache.org/dist/perl/mod_perl-2.0.10.tar.gz && \\\n    tar -xzf mod_perl-2.0.10.tar.gz && \\\n    cd mod_perl-2.0.10/ && \\\n    perl Makefile.PL MP_APXS=/usr/bin/apxs && \\\n    make && make install && \\\n    rm -r /tmp/mod_perl-2.0.10* && \\\n    cd /tmp && \\\n    wget https://cpan.metacpan.org/authors/id/L/LE/LEONT/Crypt-Rijndael-1.13.tar.gz && \\\n    cd /tmp && \\\n    tar -xzf Crypt-Rijndael-1.13.tar.gz && \\\n    cd Crypt-Rijndael-1.13/ && \\\n    perl Makefile.PL && \\\n    sed -i s/__uint8_t/uint8_t/g rijndael.h && \\\n    sed -i s/__uint32_t/uint32_t/g rijndael.h && \\\n    make install && \\\n    cd .. && \\\n    rm -rf Crypt-Rijndael-1.13/ && \\\n    cd ~ && \\\n    cpanm --notest --no-man-pages --no-wget --curl \\\n        MooseX::Types \\\n        MooseX::ConfigFromFile \\\n        MooseX::Getopt \\\n        MooseX::Role::Parameterized \\\n        MooseX::SimpleConfig \\\n        MooseX::StrictConstructor \\\n        MooseX::Types::DateTime \\\n        Catalyst::Devel \\\n        Catalyst::Plugin::RequireSSL \\\n        Catalyst::Plugin::Session::Store::File \\\n        JSON \\\n        JSON::XS \\\n        Catalyst::View::JSON \\\n        Template::Plugin::Filter::Minify::CSS \\\n        Template::Plugin::Filter::Minify::JavaScript \\\n        Catalyst::Plugin::Cache::FileCache \\\n        Catalyst::Plugin::UploadProgress \\\n        HTML::GenerateUtil \\\n        Class::Factory \\\n        Digest \\\n        Data::Validate::URI \\\n        Log::Handler \\\n        Crypt::OpenPGP \\\n        Variable::Magic \\\n        DateTime \\\n        Class::ISA \\\n        Catalyst::Authentication::User::Hash \\\n        Catalyst::Plugin::Session::State::Cookie \\\n        Catalyst::View::TT \\\n        Catalyst::Plugin::ConfigLoader::Environment \\\n        Devel::OverloadInfo \\\n        Net::SSLeay \\\n        Crypt::Argon2 \\\n        String::Random && rm mod_perl-2.0.10.tar.gz\n\nRUN mkdir /ibexfarm.git && \\\n    git clone --depth 1 https://github.com/addrummond/ibexfarm.git /ibexfarm.git && \\\n    chown -R apache:apache /ibexfarm.git\n\n# Checkout the revision of github.com/addrummond/ibex corresponding to 0.3.9\n# and create a tarball.\nRUN mkdir /var/ibexfarm && \\\n    cd /tmp && \\\n    git clone https://github.com/addrummond/ibex && \\\n    cd ibex && \\\n    git checkout 0e4978d73a085fffd4d1ab73098f4f81e3065c3c && \\\n    rm -rf .git* && \\\n    rm -rf docs && \\\n    rm -rf contrib && \\\n    rm -f LICENSE README example_lighttpd.conf mkdist.sh server_conf.py && \\\n    cd .. && \\\n    tar -czf ibex-deploy-original.tar.gz ibex && \\\n    mv ibex-deploy-original.tar.gz /var/ibexfarm && rm ibex-deploy-original.tar.gz\n\nRUN mkdir -p /run/apache2 && \\\n    sed -i 's/^Listen[\\t ].*/Listen ${IBEXFARM_port}'/ /etc/apache2/httpd.conf && \\\n    sed -i 's/LoadModule mpm_prefork/#LoadModule mpm_prefork/' /etc/apache2/httpd.conf && \\\n    sed -i 's/#LoadModule mpm_worker_module/LoadModule mpm_worker_module/' /etc/apache2/httpd.conf && \\\n    printf \"\\\nLoadModule perl_module /usr/lib/apache2/mod_perl.so\\n\\\nServerName localhost\\n\\\n\\n\\\nPerlSwitches -I\\${IBEXFARM_src_dir}/lib\\n\\\nPerlModule IbexFarm\\n\\\n\\n\\\n<LocationMatch \\\"^/(?!(?:static/|ibexexps/))\\\">\\n\\\n    SetHandler modperl\\n\\\n    PerlResponseHandler IbexFarm\\n\\\n</LocationMatch>\\n\\\n\\n\\\nAlias /static/ \\${IBEXFARM_src_dir}/root/static/\\n\\\n<Directory \\${IBEXFARM_src_dir}/root/static/>\\n\\\n    Options none\\n\\\n    Require all granted\\n\\\n</Directory>\\n\\\n<Location /static>\\n\\\n    SetHandler default-handler\\n\\\n</Location>\\n\\\n\\n\\\nDocumentRoot \\\"/var/www\\\"\\n\\\n\\n\\\nAddHandler cgi-script .py\\n\\\nAlias /ibexexps /ibexdata/ibexexps\\n\\\n\\n\\\n<Directory \\\"/ibexdata/ibexexps\\\" >\\n\\\n    Options +ExecCGI +FollowSymLinks\\n\\\n    AllowOverride AuthConfig\\n\\\n    DirectoryIndex experiment.html\\n\\\n    AuthUserFile \\\"/ibexdata/htpasswd\\\"\\n\\\n    Require all granted\\n\\\n</Directory>\\n\\\n\\n\\\n#\\n\\\n# Relax access to content within /var/www.\\n\\\n#\\n\\\n<Directory \\\"/var/www\\\">\\n\\\n    AllowOverride None\\n\\\n    # Allow open access:\\n\\\n    Require all granted\\n\\\n</Directory>\\n\\\n\\n\\\n# Log to stdout/stderr\\n\\\nErrorLog /dev/stderr\\n\\\nTransferLog /dev/stdout\\n\\\n\\n\\\nLoadModule cgi_module modules/mod_cgi.so\\n\\\n# SetEnv rather than PerlSetEnv for IBEXFARM_config_url because\\n\\\n# it needs to go through to CGI scripts, not modperl code.\\n\\\nSetEnv IBEXFARM_config_url \\\"\\${IBEXFARM_config_url}\\\"\\n\\\nInclude /etc/apache2/perlenv\\n\" >> /etc/apache2/httpd.conf\n\n# Create wrapper we use to run httpd.\nRUN printf \"#!bin/sh\\n\\\necho 'Starting the Ibex Farm...'\\n\\\ncat <<\\\"END\\\">\\${IBEXFARM_src_dir}/ibexfarm.yaml\\n\\\n---\\n\\\nname: IbexFarm\\n\\\n\\n\\\nurl_prefix: '/'\\n\\\n\\n\\\nwebmaster_name: 'IBEX_WEBMASTER'\\n\\\nwebmaster_email: 'IBEX_WEBMASTER_EMAIL'\\n\\\n\\n\\\nibex_archive: '/var/ibexfarm/ibex-deploy.tar.gz'\\n\\\nibex_version: '0.3.9'\\n\\\ndeployment_dir: '/ibexdata/deploy'\\n\\\ndeployment_www_dir: '/ibexdata/ibexexps'\\n\\\n\\n\\\nmax_fname_length: 150\\n\\\n\\n\\\ndirs: [ 'js_includes', 'css_includes', 'data_includes', 'chunk_includes', 'server_state', 'results' ]\\n\\\nsync_dirs: [ 'js_includes', 'css_includes', 'data_includes', 'chunk_includes', 'server_state' ]\\n\\\ndirs_to_types:\\n\\\n  js_includes: 'text/javascript'\\n\\\n  css_includes: 'text/css'\\n\\\n  data_includes: 'text/javascript'\\n\\\n  chunk_includes: 'text/html'\\n\\\n  server_state: 'text/plain'\\n\\\n  results: 'text/plain'\\n\\\noptional_dirs:\\n\\\n  server_state: 1\\n\\\n  results: 1\\n\\\nwritable: [ 'data_includes/*', 'results/*', 'server_state/*','chunk_includes/*' ]\\n\\\n\\n\\\nenforce_quotas: 0\\n\\\nquota_max_files_in_dir: 500\\n\\\nquota_max_file_size: 1048576\\n\\\nquota_max_total_size: 1048576\\n\\\nquota_record_dir: '/ibexdata/quota'\\n\\\n\\n\\\npassword_protect_apache:\\n\\\n    htpasswd: '/usr/bin/htpasswd'\\n\\\n    passwd_file: '/ibexdata/htpasswd'\\n\\\n\\n\\\nmax_upload_size_bytes: 5242880\\n\\\n\\n\\\nexperiment_password_protection: Apache\\n\\\n\\n\\\ngit_path: '/usr/bin/git'\\n\\\ngit_checkout_timeout_seconds: 25\\n\\\n\\n\\\nevent_log_file: '/dev/stdout'\\n\\\n\\n\\\nexperiment_base_url: '/ibexexps/'\\n\\\n\\n\\\npython_hashbang: '/usr/bin/python'\\n\\\n\\n\\\nconfig_url: 'http://localhost/ajax/config'\\n\\\nconfig_permitted_hosts: ['localhost', '::1']\\n\\\nEND\\n\\\n\\n\\\nmkdir -p /ibexdata/deploy\\n\\\nmkdir -p /ibexdata/ibexexps\\n\\\nmkdir -p /ibexdata/quota\\n\\\nmkdir -p /ibexdata/tmp\\n\\\n\\n\\\nif [ -z \\\"\\${IBEXFARM_dont_chown_data_volume}\\\" ]; then\\n\\\n  chown -R apache:apache /ibexdata\\n\\\nfi\\n\\\n\\n\\\nif [ ! -z \\\"\\${IBEXFARM_spellout_legacy_jank}\\\" ]; then\\n\\\n    mkdir -p /opt/local\\n\\\n    mkdir -p /opt/local/bin\\n\\\n    ln -sf /usr/bin/python /opt/local/bin/python\\n\\\n    mkdir -p /var/l-apps\\n\\\n    mkdir -p /var/l-apps/ibexfarm\\n\\\n    ln -sf /ibexdata/deploy/ /var/l-apps/ibexfarm/deploy\\n\\\n    ln -sf /ibexdata/deploy /var/ibexfarm/deploy\\n\\\nfi\\n\\\n\\n\\\ncd /tmp\\n\\\ntar -xzf /var/ibexfarm/ibex-deploy-original.tar.gz\\n\\\nif [ \\\"\\${IBEXFARM_ibex_archive_root_dir}\\\" != \\\"ibex\\\" ]; then\\n\\\n    mv ibex \\${IBEXFARM_ibex_archive_root_dir}\\n\\\nfi\\n\\\ntar -czf ibex-deploy.tar.gz \\${IBEXFARM_ibex_archive_root_dir}\\n\\\nmv ibex-deploy.tar.gz /var/ibexfarm/ibex-deploy.tar.gz\\n\\\nrm -rf \\${IBEXFARM_ibex_archive_root_dir}\\n\\\ncd ~\\n\\\n\\n\\\ntouch /ibexdata/htpasswd\\n\\\nchown apache:apache /ibexdata/htpasswd\\n\\\n\\n\\\n# Work around issue with PerlSetEnv not liking empty second arg\\n\\\necho \"\" > /etc/apache2/perlenv\\n\\\nif [ -n \\\"\\$IBEXFARM_host\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_host \\\\\\\"\\\\\\${IBEXFARM_host}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_url_prefix\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_url_prefix \\\\\\\"\\\\\\${IBEXFARM_url_prefix}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_webmaster_email\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_webmaster_email \\\\\\\"\\\\\\${IBEXFARM_webmaster_email}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_webmaster_name\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_webmaster_name \\\\\\\"\\\\\\${IBEXFARM_webmaster_name}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_config_secret\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_config_secret \\\\\\\"\\\\\\${IBEXFARM_config_secret}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_config_url_envvar\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_config_url_envvar \\\\\\\"\\\\\\${IBEXFARM_config_url_envvar}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_rehash_old_passwords\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_rehash_old_passwords \\\\\\\"\\\\\\${IBEXFARM_rehash_old_passwords}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_argon2id_t_cost\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_argon2id_t_cost \\\\\\\"\\\\\\${IBEXFARM_argon2id_t_cost}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_argon2id_m_factor\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_argon2id_m_factor \\\\\\\"\\\\\\${IBEXFARM_argon2id_m_factor}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_argon2id_parallelism\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_argon2id_parallelism \\\\\\\"\\\\\\${IBEXFARM_argon2id_parallelism}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_argon2id_tag_size\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_argon2id_tag_size \\\\\\\"\\\\\\${IBEXFARM_argon2id_tag_size}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_argon2id_salt_length\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_argon2id_salt_length \\\\\\\"\\\\\\${IBEXFARM_argon2id_salt_length}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_ibex_archive_root_dir\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_ibex_archive_root_dir \\\\\\\"\\\\\\${IBEXFARM_ibex_archive_root_dir}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_front_page_html_message\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_front_page_html_message \\\\\\\"\\\\\\${IBEXFARM_front_page_html_message}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_enforce_quotas\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_enforce_quotas \\\\\\\"\\\\\\${IBEXFARM_enforce_quotas}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_quota_max_files_in_dir\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_quota_max_files_in_dir \\\\\\\"\\\\\\${IBEXFARM_quota_max_files_in_dir}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_quota_max_file_size\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_quota_max_file_size \\\\\\\"\\\\\\${IBEXFARM_quota_max_file_size}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nif [ -n \\\"\\$IBEXFARM_quota_max_total_size\\\" ]; then\\n\\\n    echo PerlSetEnv IBEXFARM_quota_max_total_size \\\\\\\"\\\\\\${IBEXFARM_quota_max_total_size}\\\\\\\" >> /etc/apache2/perlenv\\n\\\nfi\\n\\\nchown apache:apache /etc/apache2/perlenv\\n\\\n\\n\\\nexec /usr/sbin/httpd -D FOREGROUND\\n\\\n\" > /var/ibexfarm/start.sh && \\\n    chmod +x /var/ibexfarm/start.sh\n\n# Fix the id of the apache user and group so we know what they are\n# if doing chowns in the host system.\nRUN groupmod -g 987654 apache && \\\n    usermod -u 987654 apache\n\nEXPOSE 80\nENTRYPOINT [\"/var/ibexfarm/start.sh\"]\n"
}