{
  "startTime": 1674250516172,
  "endTime": 1674250516983,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 46
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG COMPOSER_VERSION\nARG PHP_VERSION\nARG DEBIAN_RELEASE\n\nFROM php:${PHP_VERSION}-apache-${DEBIAN_RELEASE}\n\n# we need some extra libs to be installed in the runtime\nRUN apt-get update && \\\n\tapt-get install -y --no-install-recommends curl git zip unzip && \\\n\tapt-get install -y --no-install-recommends libicu-dev libxml2-dev && \\\n\tdocker-php-ext-install intl pdo pdo_mysql mysqli simplexml && \\\n\tapt-get remove -y --purge libicu-dev libxml2-dev && \\\n\tapt-get clean && \\\n\trm -rf /var/lib/apt/lists/*\n\nCOPY composer.json composer.json\n\n# install composer as root\nARG COMPOSER_VERSION\nRUN curl -f -sL https://getcomposer.org/installer | \\\n\tphp -- --install-dir=/usr/bin/ --filename=composer --version=${COMPOSER_VERSION}\n\n# switch back to unprivileged user for composer install\nUSER www-data\n\nRUN composer install \\\n\t--no-interaction \\\n\t--no-plugins \\\n\t--no-scripts \\\n\t--prefer-dist\n\n# web server configuration\nUSER root\n\n# allow .htaccess overrides and push them\nRUN a2enmod rewrite\nRUN sed -i -r '/DocumentRoot/a \\\\t<Directory /var/www/html/>\\n\\t\\tAllowOverride all\\n\\t</Directory>' /etc/apache2/sites-available/000-default.conf\nCOPY --chown=www-data docker/etc/DocumentRoot.htaccess /var/www/html/.htaccess\nCOPY --chown=www-data docker/etc/webroot.htaccess /var/www/html/webroot/.htaccess\n\n# passing environment variables through apache\nRUN a2enmod env\nRUN echo 'PassEnv CEREBRATE_DB_HOST'          >> /etc/apache2/conf-enabled/environment.conf\nRUN echo 'PassEnv CEREBRATE_DB_NAME'          >> /etc/apache2/conf-enabled/environment.conf\nRUN echo 'PassEnv CEREBRATE_DB_PASSWORD'      >> /etc/apache2/conf-enabled/environment.conf\nRUN echo 'PassEnv CEREBRATE_DB_PORT'          >> /etc/apache2/conf-enabled/environment.conf\nRUN echo 'PassEnv CEREBRATE_DB_SCHEMA'        >> /etc/apache2/conf-enabled/environment.conf\nRUN echo 'PassEnv CEREBRATE_DB_USERNAME'      >> /etc/apache2/conf-enabled/environment.conf\nRUN echo 'PassEnv CEREBRATE_EMAIL_HOST'       >> /etc/apache2/conf-enabled/environment.conf\nRUN echo 'PassEnv CEREBRATE_EMAIL_PASSWORD'   >> /etc/apache2/conf-enabled/environment.conf\nRUN echo 'PassEnv CEREBRATE_EMAIL_PORT'       >> /etc/apache2/conf-enabled/environment.conf\nRUN echo 'PassEnv CEREBRATE_EMAIL_TLS'        >> /etc/apache2/conf-enabled/environment.conf\nRUN echo 'PassEnv CEREBRATE_EMAIL_USERNAME'   >> /etc/apache2/conf-enabled/environment.conf\nRUN echo 'PassEnv CEREBRATE_SECURITY_SALT'    >> /etc/apache2/conf-enabled/environment.conf\n\n# entrypoint\nCOPY docker/entrypoint.sh /entrypoint.sh\nRUN chmod 755 /entrypoint.sh\n\n# copy actual codebase\nCOPY --chown=www-data . /var/www/html\n\n# last checks with unprivileged user\nUSER www-data\n\n# CakePHP seems to not handle very well externally installed components\n# this will chown/chmod/symlink all in place for its own good\nRUN composer install --no-interaction\n\n# app config override making use of environment variables\nCOPY --chown=www-data docker/etc/app_local.php /var/www/html/config/app_local.php\n# version 1.0 addition requires a config/config.json file\n# can still be overriden by a docker volume\nRUN cp -a /var/www/html/config/config.example.json /var/www/html/config/config.json\n\n# also can be overridin by a docker volume\nRUN mkdir -p /var/www/html/logs\n\nENTRYPOINT [ \"/entrypoint.sh\" ]\n"
}