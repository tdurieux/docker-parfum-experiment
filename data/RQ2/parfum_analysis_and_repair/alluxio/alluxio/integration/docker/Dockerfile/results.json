{
  "startTime": 1674248948361,
  "endTime": 1674248949655,
  "originalSmells": [
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 2,
        "columnEnd": 24
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# The Alluxio Open Foundation licenses this work under the Apache License, version 2.0\n# (the \"License\"). You may not use this work except in compliance with the License, which is\n# available at www.apache.org/licenses/LICENSE-2.0\n#\n# This software is distributed on an \"AS IS\" basis, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,\n# either express or implied, as more fully set forth in the License.\n#\n# See the NOTICE file distributed with this work for information regarding copyright ownership.\n#\n\n# Setup CSI\n# Make sure any changes to CSI installation are made in Dockerfile-dev as well\nFROM golang:1.15.13-alpine AS csi-dev\nENV GO111MODULE=on\nRUN mkdir -p /alluxio-csi\nCOPY ./csi /alluxio-csi\nRUN cd /alluxio-csi && \\\n    CGO_ENABLED=0 go build -o /usr/local/bin/alluxio-csi\n\n# We have to do an ADD to put the tarball into extractor, then do a COPY with chown into final\n# ADD then chown in two steps will double the image size\n#   See - https://stackoverflow.com/questions/30085621/why-does-chown-increase-size-of-docker-image\n#       - https://github.com/moby/moby/issues/5505\n#       - https://github.com/moby/moby/issues/6119\n# ADD with chown doesn't chown the files inside tarball\n#   See - https://github.com/moby/moby/issues/35525\nFROM alpine:3.10.2 AS alluxio-extractor\n# Note that downloads for *-SNAPSHOT tarballs are not available.\nARG ALLUXIO_TARBALL=http://downloads.alluxio.io/downloads/files/2.9.0-SNAPSHOT/alluxio-2.9.0-SNAPSHOT-bin.tar.gz\n# (Alert):It's not recommended to set this Argument to true, unless you know exactly what you are doing\nARG ENABLE_DYNAMIC_USER=false\n\nADD ${ALLUXIO_TARBALL} /opt/\n# Remote tarball needs to be untarred. Local tarball is untarred automatically.\n# Use ln -s instead of mv to avoid issues with Centos (see https://github.com/moby/moby/issues/27358)\nRUN cd /opt && \\\n    (if ls | grep -q \".tar.gz\"; then tar -xzf *.tar.gz && rm *.tar.gz; fi) && \\\n    ln -s alluxio-* alluxio\n\nRUN if [ ${ENABLE_DYNAMIC_USER} = \"true\" ] ; then \\\n       chmod -R 777 /opt/* ; \\\n    fi\n\n# For production use, we use alpine as base image to minimize alluxio image size.\nFROM alpine:3.10.2 AS final\n\nADD dockerfile-common.sh /\n\n# Install libfuse2 and libfuse3. Libfuse2 setup is modified from cheyang/fuse2:ubuntu1604-customize to be applied on alpine\nWORKDIR /\n\nENV MAX_IDLE_THREADS \"64\"\n\n# wget depends on ca-certificates\nRUN \\\n  apk update && apk upgrade && \\\n  apk add --no-cache ca-certificates wget bash && \\\n  apk add --no-cache --virtual .build-deps \\\n  build-base pkgconfig eudev git gcc make cmake gettext-dev libtool autoconf automake && \\\n  ./dockerfile-common.sh install-libfuse2 && \\\n  rm -rf libfuse && \\\n  apk add --no-cache fuse3=3.2.6-r1 && \\\n  apk del --no-cache .build-deps\n\nENV LD_LIBRARY_PATH \"/usr/local/lib:${LD_LIBRARY_PATH}\"\n\nARG ALLUXIO_USERNAME=alluxio\nARG ALLUXIO_GROUP=alluxio\nARG ALLUXIO_UID=1000\nARG ALLUXIO_GID=1000\nARG ENABLE_DYNAMIC_USER=true\n\n# Add Tini for Alluxio helm charts (https://github.com/Alluxio/alluxio/pull/12233)\n# - https://github.com/krallin/tini\nENV TINI_VERSION v0.18.0\nADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini-static /usr/local/bin/tini\nRUN chmod +x /usr/local/bin/tini\n\nRUN apk add --no-cache openjdk8 openjdk8-jre-lib unzip vim\n\nENV JAVA_HOME /usr/lib/jvm/java-1.8-openjdk\n\n# Disable JVM DNS cache (https://github.com/Alluxio/alluxio/pull/9452)\nRUN echo \"networkaddress.cache.ttl=0\" >> ${JAVA_HOME}/jre/lib/security/java.security\n\n# Add the following for native libraries needed by rocksdb\nENV LD_LIBRARY_PATH /lib64:${LD_LIBRARY_PATH}\n\n# If Alluxio user, group, gid, and uid aren't root|0, create the alluxio user and set file permissions accordingly\nRUN ./dockerfile-common.sh user-operation ${ALLUXIO_USERNAME} ${ALLUXIO_GROUP} ${ALLUXIO_UID} ${ALLUXIO_GID} alpine\n\n# Docker 19.03+ required to expand variables in --chown argument\n# https://github.com/moby/buildkit/pull/926#issuecomment-503943557\nCOPY --from=alluxio-extractor --chown=${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} /opt /opt/\nCOPY --chown=${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} conf /opt/alluxio/conf/\nCOPY --chown=${ALLUXIO_USERNAME}:${ALLUXIO_GROUP} entrypoint.sh /\nCOPY --from=csi-dev /usr/local/bin/alluxio-csi /usr/local/bin/\n\nRUN ./dockerfile-common.sh enable-dynamic-user ${ENABLE_DYNAMIC_USER}\n\nUSER ${ALLUXIO_UID}\n\nWORKDIR /opt/alluxio\n\nENV PATH=\"/opt/alluxio/bin:${PATH}\"\n\nENTRYPOINT [\"/entrypoint.sh\"]\n"
}