{
  "startTime": 1674252017356,
  "endTime": 1674252018794,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 4,
        "lineEnd": 4,
        "columnStart": 4,
        "columnEnd": 28
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM node:14-alpine as node-build\nWORKDIR /code\n\nCOPY ./package.json ./package-lock.json ./\nRUN npm install --production && npm cache clean --force;\n\nRUN mkdir public && mkdir public/scss && mkdir public/css\n\nCOPY ./public/scss ./public/scss/\nRUN npm run scss\n\nFROM php:8.1-fpm as php-target\n\nRUN apt-get update \\\n    && apt-get install -y --no-install-recommends \\\n        cron \\\n        git \\\n        ghostscript \\\n        libcurl4-openssl-dev \\\n        libfreetype6-dev \\\n        libicu-dev \\\n        libjpeg62-turbo-dev \\\n        libmagickwand-dev \\\n        libmemcached-dev \\\n        libpng-dev \\\n        libpq-dev \\\n        libzip-dev \\\n        poppler-utils \\\n        rsync \\\n        ssh \\\n        sshpass \\\n        unzip \\\n    && apt-get upgrade -y --no-install-recommends \\\n    && rm -rf /var/lib/apt/lists/*\n\nRUN docker-php-ext-configure \\\n        gd --with-freetype --with-jpeg \\\n    && docker-php-ext-install \\\n        calendar \\\n        curl \\\n        exif \\\n        gd \\\n        intl \\\n        opcache \\\n        pgsql \\\n        pdo_mysql \\\n        pdo_pgsql \\\n        zip\n\nRUN pecl install -o imagick \\\n    && docker-php-ext-enable imagick \\\n    && pecl install -o memcached \\\n    && docker-php-ext-enable memcached\n\nRUN sed -i 's/<policy domain=\"coder\" rights=\"none\" pattern=\"PDF\" \\/>/<policy domain=\"coder\" rights=\"read|write\" pattern=\"PDF\" \\/>/g' /etc/ImageMagick-6/policy.xml\n\nFROM php-target as gewisweb_web_production\nWORKDIR /code\n\nRUN php -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\" \\\n    && php composer-setup.php \\\n    && php -r \"unlink('composer-setup.php');\"\n\nCOPY ./composer.json ./composer.lock ./\nRUN php composer.phar install -o --no-dev\n\nCOPY --chown=www-data:www-data ./docker/web/production/php.ini /usr/local/etc/php/conf.d/default.ini\nCOPY --chown=www-data:www-data ./docker/web/production/php-fpm.conf /usr/local/etc/php-fpm.d/php-fpm.conf\nCOPY --chown=www-data:www-data ./config/autoload/local.production.php.dist ./config/autoload/local.php\nCOPY --chown=www-data:www-data ./config/autoload/doctrine.local.production.php.dist ./config/autoload/doctrine.local.php\nCOPY --chown=www-data:www-data ./config/autoload/gewisdb.local.php.dist ./config/autoload/gewisdb.local.php\n\nCOPY --chown=www-data:www-data ./docker/web/production/crontab /etc/cron.d/crontab\nRUN chmod 0644 /etc/cron.d/crontab && crontab /etc/cron.d/crontab\n\nCOPY --chown=www-data:www-data ./docker/web/production/docker-entrypoint.sh ./docker-entrypoint.sh\nRUN chmod 0775 ./docker-entrypoint.sh\n\nCOPY --chown=www-data:www-data . /code\n\nRUN php composer.phar dump-autoload -a --no-dev\n\nCOPY --chown=www-data:www-data --from=node-build /code/public/css/gewis-theme.css /code/public/css/gewis-theme.css\n\nARG GIT_COMMIT\nENV GIT_COMMIT=${GIT_COMMIT}\n\nVOLUME [\"/code/data\", \"/code/public\"]\n\nENTRYPOINT [\"/bin/sh\", \"/code/docker-entrypoint.sh\"]\n"
}