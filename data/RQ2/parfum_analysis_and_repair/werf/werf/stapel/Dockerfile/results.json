{
  "startTime": 1674255946403,
  "endTime": 1674255950331,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 224,
        "lineEnd": 224,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 225,
        "lineEnd": 225,
        "columnStart": 4,
        "columnEnd": 43
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 226,
        "lineEnd": 226,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 357,
        "lineEnd": 357,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 218,
        "lineEnd": 218,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 262,
        "lineEnd": 262,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 271,
        "lineEnd": 271,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 280,
        "lineEnd": 280,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 289,
        "lineEnd": 289,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 298,
        "lineEnd": 298,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 307,
        "lineEnd": 307,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 316,
        "lineEnd": 316,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 332,
        "lineEnd": 332,
        "columnStart": 4,
        "columnEnd": 116
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 341,
        "lineEnd": 341,
        "columnStart": 4,
        "columnEnd": 121
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 350,
        "lineEnd": 350,
        "columnStart": 4,
        "columnEnd": 121
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 371,
        "lineEnd": 371,
        "columnStart": 4,
        "columnEnd": 120
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 0,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 0,
        "columnEnd": 46
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 0,
        "columnEnd": 51
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 59,
        "lineEnd": 59,
        "columnStart": 0,
        "columnEnd": 49
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 61,
        "lineEnd": 61,
        "columnStart": 0,
        "columnEnd": 49
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 95,
        "lineEnd": 95,
        "columnStart": 0,
        "columnEnd": 49
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 103,
        "lineEnd": 103,
        "columnStart": 0,
        "columnEnd": 49
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 124,
        "lineEnd": 124,
        "columnStart": 0,
        "columnEnd": 46
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 126,
        "lineEnd": 126,
        "columnStart": 0,
        "columnEnd": 51
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 128,
        "lineEnd": 128,
        "columnStart": 0,
        "columnEnd": 49
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 130,
        "lineEnd": 130,
        "columnStart": 0,
        "columnEnd": 49
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 150,
        "lineEnd": 150,
        "columnStart": 0,
        "columnEnd": 56
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 169,
        "lineEnd": 169,
        "columnStart": 0,
        "columnEnd": 46
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 171,
        "lineEnd": 171,
        "columnStart": 0,
        "columnEnd": 51
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 173,
        "lineEnd": 173,
        "columnStart": 0,
        "columnEnd": 49
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 175,
        "lineEnd": 175,
        "columnStart": 0,
        "columnEnd": 49
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 216,
        "lineEnd": 216,
        "columnStart": 0,
        "columnEnd": 52
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 259,
        "lineEnd": 259,
        "columnStart": 0,
        "columnEnd": 63
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 269,
        "lineEnd": 269,
        "columnStart": 0,
        "columnEnd": 57
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 278,
        "lineEnd": 278,
        "columnStart": 0,
        "columnEnd": 57
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 287,
        "lineEnd": 287,
        "columnStart": 0,
        "columnEnd": 53
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 296,
        "lineEnd": 296,
        "columnStart": 0,
        "columnEnd": 47
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 305,
        "lineEnd": 305,
        "columnStart": 0,
        "columnEnd": 45
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 314,
        "lineEnd": 314,
        "columnStart": 0,
        "columnEnd": 51
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 330,
        "lineEnd": 330,
        "columnStart": 0,
        "columnEnd": 51
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 339,
        "lineEnd": 339,
        "columnStart": 0,
        "columnEnd": 49
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 348,
        "lineEnd": 348,
        "columnStart": 0,
        "columnEnd": 60
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 360,
        "lineEnd": 360,
        "columnStart": 0,
        "columnEnd": 47
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 369,
        "lineEnd": 369,
        "columnStart": 0,
        "columnEnd": 54
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 380,
        "lineEnd": 380,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 224,
        "lineEnd": 224,
        "columnStart": 42,
        "columnEnd": 56
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 225,
        "lineEnd": 225,
        "columnStart": 46,
        "columnEnd": 60
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 11,
        "lineEnd": 14,
        "columnStart": 18,
        "columnEnd": 48
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 223,
        "lineEnd": 223,
        "columnStart": 4,
        "columnEnd": 178
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 356,
        "lineEnd": 356,
        "columnStart": 4,
        "columnEnd": 105
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 411,
        "lineEnd": 411,
        "columnStart": 18,
        "columnEnd": 62
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 469,
        "lineEnd": 469,
        "columnStart": 0,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 471,
        "lineEnd": 471,
        "columnStart": 0,
        "columnEnd": 24
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 223,
        "lineEnd": 223,
        "columnStart": 4,
        "columnEnd": 178
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 356,
        "lineEnd": 356,
        "columnStart": 4,
        "columnEnd": 105
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 11,
        "lineEnd": 14,
        "columnStart": 18,
        "columnEnd": 48
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 223,
        "lineEnd": 223,
        "columnStart": 4,
        "columnEnd": 178
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 356,
        "lineEnd": 356,
        "columnStart": 4,
        "columnEnd": 105
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 411,
        "lineEnd": 411,
        "columnStart": 18,
        "columnEnd": 62
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 469,
        "lineEnd": 469,
        "columnStart": 0,
        "columnEnd": 46
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 471,
        "lineEnd": 471,
        "columnStart": 0,
        "columnEnd": 24
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 223,
        "lineEnd": 223,
        "columnStart": 4,
        "columnEnd": 202
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 356,
        "lineEnd": 356,
        "columnStart": 4,
        "columnEnd": 129
      }
    }
  ],
  "repairedDockerfile": "FROM ubuntu:18.04 as base\n\nRUN rm /bin/sh && ln -s /bin/bash /bin/sh\nRUN >/etc/profile && >/root/.profile\nRUN echo \"set +h\" >> /root/.profile && \\\necho \"umask 022\" >> /root/.profile\n\nSHELL [\"/bin/bash\", \"-lc\"]\n\nENV DEBIAN_FRONTEND=noninteractive\n\nRUN apt update && apt install --no-install-recommends -y \\\nbuild-essential wget curl gawk flex bison bzip2 liblzma5 texinfo file \\\ngettext python python3 curl git fakeroot gettext gpg ruby ruby-bundler \\\nruby-dev make file m4 xz-utils texlive vim rsync && rm -rf /var/lib/apt/lists/*;\n\nRUN git config --global user.name flant && git config --global user.email 256@flant.com\n\nENV LFS=/mnt/lfs\nENV TOOLS=/.werf/stapel\nENV LFS_TGT=x86_64-lfs-linux-gnu\n\nRUN mkdir -pv $LFS$TOOLS && mkdir -pv $LFS/sources && chmod -v a+wt $LFS/sources\nADD stapel/wget-list-before-omnibus $LFS/sources/wget-list-before-omnibus\nRUN wget --input-file=$LFS/sources/wget-list-before-omnibus --continue --directory-prefix=$LFS/sources || true\nADD stapel/wget-list-before-omnibus.md5sums $LFS/sources/wget-list-before-omnibus.md5sums\nRUN bash -c \"pushd $LFS/sources && md5sum -c $LFS/sources/wget-list-before-omnibus.md5sums && popd\"\nADD stapel/version-check.sh $LFS/sources/version-check.sh\nRUN $LFS/sources/version-check.sh\n\nRUN ln -sv $LFS/.werf /\n\nENV LC_ALL=POSIX\nENV PATH=$TOOLS/bin:/bin:/usr/bin\nENV MAKEFLAGS='-j 5'\n\nRUN echo \"Binutils pass 1\" && cd $LFS/sources/ && \\\nmkdir binutils && \\\ntar xf binutils-*.tar.* -C binutils --strip-components 1 && \\\ncd binutils && \\\nmkdir -v build && \\\ncd build && \\\n../configure --prefix=$TOOLS \\\n--with-sysroot=$LFS \\\n--with-lib-path=$TOOLS/lib \\\n--target=$LFS_TGT \\\n--disable-nls \\\n--disable-werror && rm binutils-*.tar.*\nWORKDIR $LFS/sources/binutils/build\nRUN make\nRUN mkdir -pv $TOOLS/lib && ln -sv lib $TOOLS/lib64 && make install\n\nADD stapel/gcc-before-configure.sh $LFS/sources/gcc-before-configure.sh\nRUN echo \"GCC pass 1\" && cd $LFS/sources/ && \\\nmkdir gcc && \\\ntar xf gcc-*.tar.* -C gcc --strip-components 1 && \\\nmkdir gcc/mpfr && \\\ntar xf mpfr*.tar.* -C gcc/mpfr --strip-components 1 && \\\nmkdir gcc/gmp && \\\ntar xf gmp*.tar.* -C gcc/gmp --strip-components 1 && \\\nmkdir gcc/mpc && \\\ntar xf mpc*.tar.* -C gcc/mpc --strip-components 1 && \\\ncd gcc && \\\n$LFS/sources/gcc-before-configure.sh && \\\nmkdir -v build && \\\ncd build && \\\n../configure \\\n--target=$LFS_TGT \\\n--prefix=$TOOLS \\\n--with-glibc-version=2.11 \\\n--with-sysroot=$LFS \\\n--with-newlib \\\n--without-headers \\\n--enable-initfini-array \\\n--with-local-prefix=$TOOLS \\\n--with-native-system-header-dir=$TOOLS/include \\\n--disable-nls \\\n--disable-shared \\\n--disable-multilib \\\n--disable-decimal-float \\\n--disable-threads \\\n--disable-libatomic \\\n--disable-libgomp \\\n--disable-libmpx \\\n--disable-libquadmath \\\n--disable-libssp \\\n--disable-libvtv \\\n--disable-libstdcxx \\\n--enable-languages=c,c++ && rm gcc-*.tar.*\nWORKDIR $LFS/sources/gcc/build\nRUN make\nRUN make install\n\nRUN cd $LFS/sources/ && \\\nmkdir linux && \\\ntar xf linux*.tar.* -C linux --strip-components 1 && rm linux*.tar.*\nWORKDIR $LFS/sources/linux\nRUN echo \"Linux API Headers\" && make mrproper && \\\nmake INSTALL_HDR_PATH=dest headers_install && \\\ncp -rv dest/include/* $TOOLS/include\n\nRUN echo \"Glibc\" && cd $LFS/sources/ && \\\nmkdir glibc && \\\ntar xf glibc*.tar.* -C glibc --strip-components 1 && \\\ncd glibc && \\\nmkdir -v build && \\\ncd build && \\\n../configure \\\n--prefix=$TOOLS \\\n--host=$LFS_TGT \\\n--enable-kernel=3.2 \\\n--with-headers=$TOOLS/include \\\nlibc_cv_forced_unwind=yes \\\nlibc_cv_c_cleanup=yes \\\nlibc_cv_slibdir=$TOOLS/lib && rm glibc*.tar.*\nWORKDIR $LFS/sources/glibc/build\nRUN make\nRUN make install\nRUN mkdir /.werf/stapel/lib/locale\nRUN /.werf/stapel/bin/localedef -i POSIX -f UTF-8 C.UTF-8 || true\n\nRUN echo \"Libstdc++ pass 1\" && cd $LFS/sources/ && \\\nrm -rf gcc && \\\nmkdir gcc && \\\ntar xf gcc-*.tar.* -C gcc --strip-components 1 && \\\nmkdir gcc/mpfr && \\\ntar xf mpfr*.tar.* -C gcc/mpfr --strip-components 1 && \\\nmkdir gcc/gmp && \\\ntar xf gmp*.tar.* -C gcc/gmp --strip-components 1 && \\\nmkdir gcc/mpc && \\\ntar xf mpc*.tar.* -C gcc/mpc --strip-components 1 && \\\ncd gcc && \\\n$LFS/sources/gcc-before-configure.sh && \\\nmkdir -v build && \\\ncd build && \\\n../libstdc++-v3/configure \\\n--host=$LFS_TGT \\\n--prefix=$TOOLS \\\n--disable-multilib \\\n--disable-nls \\\n--disable-libstdcxx-pch \\\n--disable-libstdcxx-threads \\\n--with-gxx-include-dir=$TOOLS/$LFS_TGT/include/c++/11.2.0 && rm gcc-*.tar.*\nWORKDIR $LFS/sources/gcc/build\nRUN make\nRUN make install\n\nRUN echo \"Binutils pass 2\" && cd $LFS/sources/ && \\\nrm -rf binutils && \\\nmkdir binutils && \\\ntar xf binutils-*.tar.* -C binutils --strip-components 1 && \\\ncd binutils && \\\nmkdir -v build && \\\ncd build && \\\nCC=$LFS_TGT-gcc \\\nAR=$LFS_TGT-ar \\\nRANLIB=$LFS_TGT-ranlib \\\n../configure \\\n--prefix=$TOOLS \\\n--host=$LFS_TGT \\\n--disable-nls \\\n--enable-shared \\\n--disable-werror \\\n--enable-64-bit-bfd \\\n--with-lib-path=$TOOLS/lib && rm binutils-*.tar.*\n\nRUN echo \"GCC pass 2\" && cd $LFS/sources/ && \\\nrm -rf gcc && \\\nmkdir gcc && \\\ntar xf gcc-*.tar.* -C gcc --strip-components 1 && \\\nmkdir gcc/mpfr && \\\ntar xf mpfr*.tar.* -C gcc/mpfr --strip-components 1 && \\\nmkdir gcc/gmp && \\\ntar xf gmp*.tar.* -C gcc/gmp --strip-components 1 && \\\nmkdir gcc/mpc && \\\ntar xf mpc*.tar.* -C gcc/mpc --strip-components 1 && \\\ncd gcc && \\\ncat gcc/limitx.h gcc/glimits.h gcc/limity.h > \\\n  `dirname $($LFS_TGT-gcc -print-libgcc-file-name)`/include-fixed/limits.h && \\\n$LFS/sources/gcc-before-configure.sh && \\\nmkdir -v build && \\\ncd build && \\\nCC=$LFS_TGT-gcc \\\nCXX=$LFS_TGT-g++ \\\nAR=$LFS_TGT-ar \\\nRANLIB=$LFS_TGT-ranlib \\\n../configure \\\n--target=$LFS_TGT \\\n--prefix=$TOOLS \\\nCC_FOR_TARGET=$LFS_TGT-gcc \\\n--with-build-sysroot=$LFS \\\n--enable-initfini-array \\\n--disable-nls \\\n--disable-multilib \\\n--disable-decimal-float \\\n--disable-libatomic \\\n--disable-libgomp \\\n--disable-libquadmath \\\n--disable-libssp \\\n--disable-libvtv \\\n--disable-libstdcxx \\\n--disable-lto \\\n--with-local-prefix=$TOOLS \\\n--with-sysroot=$LFS \\\n--with-native-system-header-dir=$TOOLS/include \\\n--oldincludedir=$TOOLS/include \\\n--enable-languages=c,c++ && rm gcc-*.tar.*\nWORKDIR $LFS/sources/gcc/build\nRUN make\nRUN make DESTDIR=$LFS install\nRUN ln -sv gcc $TOOLS/bin/cc\nRUN for tool in $(ls /.werf/stapel/bin/ | grep $LFS_TGT) ; do ln -fs /.werf/stapel/bin/$tool /.werf/stapel/bin/$(echo $tool | sed -e \"s|$LFS_TGT-||\") ; done\n\n# libffi\nRUN echo \"libffi\" && cd $LFS/sources && \\\nmkdir libffi && \\\ntar xf libffi-*.tar.* -C libffi --strip-components 1 && rm libffi-*.tar.*\nWORKDIR $LFS/sources/libffi\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS --disable-static --with-gcc-arch=native\nRUN make\nRUN make install\n\nENV PATH=/sbin:/usr/sbin:/usr/local/sbin:/bin:/usr/bin:/usr/local/bin\nRUN apt install --no-install-recommends -y libssl-dev autoconf automake libffi-dev libgdbm-dev libncurses5-dev libsqlite3-dev libtool libyaml-dev pkg-config sqlite3 zlib1g-dev libreadline-dev libssl-dev && rm -rf /var/lib/apt/lists/*;\nRUN curl -f -sSL https://rvm.io/mpapis.asc | gpg --batch --import -\nRUN curl -f -sSL https://rvm.io/pkuczynski.asc | gpg --batch --import -\nRUN curl -f -sSL https://get.rvm.io -o /tmp/rvm.sh && cat /tmp/rvm.sh | bash -s stable\nRUN source /etc/profile.d/rvm.sh && rvm install 2.7\n\nADD stapel/omnibus /omnibus\nWORKDIR /omnibus\nENV BUNDLE_GEMFILE=/omnibus/Gemfile\nRUN source /etc/profile.d/rvm.sh && bundle install --without development\n\nENV PATH=$TOOLS/$LFS_TGT/bin:$TOOLS/bin:$PATH\n\n# Dpkg-architecture binary will make python-omnibus-package fail to build,\n# because of python setup.py, which hardcodes /usr/include/... into preceeding include paths,\n# in the case when dpkg-architecture is available in system: https://github.com/python/cpython/blob/master/setup.py#L485\n# It is needed to remove that binary before omnibus-building.\nRUN mv $(which dpkg-architecture) /tmp/dpkg-architecture\n\n#ENV CC=$LFS_TGT-gcc\n#ENV CXX=$LFS_TGT-g++\n#ENV AR=$LFS_TGT-ar\n#ENV RANLIB=$LFS_TGT-ranlib\nENV CC_FOR_TARGET=$LFS_TGT-gcc\nENV PKG_CONFIG_PATH=\"/.werf/stapel/lib/pkgconfig:/.werf/stapel/embedded/lib/pkgconfig\"\n\nRUN source /etc/profile.d/rvm.sh && bundle exec omnibus build -o append_timestamp:false werf-stapel\n\nADD stapel/wget-list-after-omnibus $LFS/sources/wget-list-after-omnibus\nADD stapel/wget-list-after-omnibus.md5sums $LFS/sources/wget-list-after-omnibus.md5sums\nRUN wget --input-file=$LFS/sources/wget-list-after-omnibus --continue --directory-prefix=$LFS/sources || true\nRUN bash -c \"pushd $LFS/sources && md5sum -c $LFS/sources/wget-list-after-omnibus.md5sums && popd\"\n\n# libgpg-error\nRUN echo \"libgpg-error\" && cd $LFS/sources && \\\nmkdir libgpg-error && \\\ntar xf libgpg-error*.tar.* -C libgpg-error --strip-components 1 && rm libgpg-error*.tar.*\nWORKDIR $LFS/sources/libgpg-error\nRUN sed -i 's/namespace/pkg_&/' src/Makefile.{am,in} src/mkstrtable.awk\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS\nRUN make\nRUN make install\n\n# libgcrypt\nRUN echo \"libgcrypt\" && cd $LFS/sources && \\\nmkdir libgcrypt && \\\ntar xf libgcrypt*.tar.* -C libgcrypt --strip-components 1 && rm libgcrypt*.tar.*\nWORKDIR $LFS/sources/libgcrypt\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS\nRUN make\nRUN make install\n\n# libassuan\nRUN echo \"libassuan\" && cd $LFS/sources && \\\nmkdir libassuan && \\\ntar xf libassuan*.tar.* -C libassuan --strip-components 1 && rm libassuan*.tar.*\nWORKDIR $LFS/sources/libassuan\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS\nRUN make\nRUN make install\n\n# libksba\nRUN echo \"libksba\" && cd $LFS/sources && \\\nmkdir libksba && \\\ntar xf libksba*.tar.* -C libksba --strip-components 1 && rm libksba*.tar.*\nWORKDIR $LFS/sources/libksba\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS\nRUN make\nRUN make install\n\n# npth\nRUN echo \"npth\" && cd $LFS/sources && \\\nmkdir npth && \\\ntar xf npth*.tar.* -C npth --strip-components 1 && rm npth*.tar.*\nWORKDIR $LFS/sources/npth\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS\nRUN make\nRUN make install\n\n# gmp\nRUN echo \"gmp\" && cd $LFS/sources && \\\nmkdir gmp && \\\ntar xf gmp*.tar.* -C gmp --strip-components 1 && rm gmp*.tar.*\nWORKDIR $LFS/sources/gmp\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS --disable-static\nRUN make\nRUN make install\n\n# nettle\nRUN echo \"nettle\" && cd $LFS/sources && \\\nmkdir nettle && \\\ntar xf nettle*.tar.* -C nettle --strip-components 1 && rm nettle*.tar.*\nWORKDIR $LFS/sources/nettle\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS --disable-static\nRUN make\nRUN make install && chmod -v 755 $TOOLS/lib/libnettle.so\n\n## p11-kit\n#RUN echo \"p11-kit\" && cd $LFS/sources && \\\n#mkdir p11-kit && \\\n#tar xf p11-kit*.tar.* -C p11-kit --strip-components 1\n#WORKDIR $LFS/sources/p11-kit\n#RUN ./configure --prefix=$TOOLS --sysconfigdir=$TOOLS/etc\n\n# gnutls\nRUN echo \"gnutls\" && cd $LFS/sources && \\\nmkdir gnutls && \\\ntar xf gnutls*.tar.* -C gnutls --strip-components 1 && rm gnutls*.tar.*\nWORKDIR $LFS/sources/gnutls\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS --disable-guile --without-p11-kit --with-included-libtasn1 --with-included-unistring\nRUN make\nRUN make install\n\n# gnupg\nRUN echo \"gnupg\" && cd $LFS/sources && \\\nmkdir gnupg && \\\ntar xf gnupg*.tar.* -C gnupg --strip-components 1 && rm gnupg*.tar.*\nWORKDIR $LFS/sources/gnupg\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS --enable-symcryptrun --localstatedir=/.werf/stapel/var --sysconfdir=/etc --disable-sqlite\nRUN make\nRUN make install\n\n# util-linux\nRUN echo \"util-linux\" && cd $LFS/sources && \\\nmkdir util-linux && \\\ntar xf util-linux-*.tar.* -C util-linux --strip-components 1 && rm util-linux-*.tar.*\nWORKDIR $LFS/sources/util-linux\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS --without-python --disable-makeinstall-chown --without-systemdsystemunitdir PKG_CONFIG=\"\"\nRUN make\nRUN make install\n\n# glib\nRUN PATH=/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin:/usr/local/sbin apt update\nRUN PATH=/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin:/usr/local/sbin apt --no-install-recommends install -y python3-pip xsltproc && rm -rf /var/lib/apt/lists/*;\nRUN PATH=/bin:/usr/bin:/usr/local/bin:/sbin:/usr/sbin:/usr/local/sbin pip3 --no-cache-dir install meson ninja\nRUN echo \"glib\" && cd $LFS/sources && \\\nmkdir glib && \\\ntar xf glib-*.tar* -C glib --strip-components 1 && rm glib-*.tar*\nWORKDIR $LFS/sources/glib\nRUN LDFLAGS=\"-static-libgcc -Wl,-rpath-link,$TOOLS/lib,-rpath-link,$TOOLS/x86_64-lfs-linux-gnu/lib,-rpath-link,$TOOLS/embedded/lib,--library-path,$TOOLS/lib,--library-path,$TOOLS/x86_64-lfs-linux-gnu/lib,--library-path,$TOOLS/embedded/lib\" meson _build -Diconv=external -Dman=false --prefix=$TOOLS -Dselinux=disabled\nRUN ninja -C _build\nRUN ninja -C _build install\n\n# libxml2\nRUN echo \"libxml2\" && cd $LFS/sources && \\\nmkdir libxml2 && \\\ntar xf libxml2-*.tar.* -C libxml2 --strip-components 1 && rm libxml2-*.tar.*\nWORKDIR $LFS/sources/libxml2\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=$TOOLS --disable-static --with-history --with-python=$TOOLS/embedded/bin/python --with-iconv=no\nRUN make\nRUN make install\n\n# Restore PATH *not to* use stapel build tools anymore\nENV PATH=/sbin:/bin:/usr/sbin:/usr/bin:/usr/local/sbin:/usr/local/bin\n\n# Install golang\nRUN wget https://dl.google.com/go/go1.17.linux-amd64.tar.gz -O /tmp/go.tar.gz\nRUN tar -C /usr/local -xzf /tmp/go.tar.gz && rm /tmp/go.tar.gz\nENV PATH=$PATH:/usr/local/go/bin\nENV GO111MODULE=on\n\nENV CC=\nENV CXX=\nENV AR=\nENV RANLIB=\nENV CC_FOR_TARGET=\nENV PKG_CONFIG_PATH=\n\nRUN go get github.com/werf/logboek@v0.5.4\nRUN cd /root/go/pkg/mod/github.com/werf/logboek@v0.5.4 && \\\ngo build -o $TOOLS/embedded/lib/python2.7/_logboek.so -buildmode=c-shared github.com/werf/logboek/c_lib && \\\ncp logboek.py $TOOLS/embedded/lib/python2.7\n\nADD pkg /werf/pkg\nRUN cp /werf/pkg/build/builder/ansible/crypt.py $TOOLS/embedded/lib/python2.7\n\n# Ansible tools overlay takes precedence over PATH and library linker path (using LD_LIBRARY_PATH)\nRUN mkdir -p $TOOLS/ansible_tools_overlay/bin $TOOLS/ansible_tools_overlay/lib\n\n# Shadow /usr/bin/tar with gnu tar (needed for unarchive ansible module in alpine based image)\nRUN ln -fs $TOOLS/embedded/bin/tar $TOOLS/ansible_tools_overlay/bin/tar\n\n# Binaries and libraries built and linked for ubuntu:18.04\nRUN mkdir -p $TOOLS/ubuntu_tools/bin $TOOLS/ubuntu_tools/lib $TOOLS/ubuntu_tools/lib/python2.7 $TOOLS/ubuntu_tools/lib/python2.7\n\n# python-apt package will install all libs in docker.from image.\n# python-apt will be installed automatically by ansible apt module on first run.\n# registry.werf.io/werf/stapel offers support for ansible-apt-module only for ubuntu:14.04 ubuntu:16.04 ubuntu:18.04\nRUN apt update && apt install --no-install-recommends -y python-apt libzstd1 apt-utils && rm -rf /var/lib/apt/lists/*;\nRUN \\\ncp /usr/lib/x86_64-linux-gnu/libapt-private.so.0.0 $TOOLS/ubuntu_tools/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/libapt-private.so.0.0.0 $TOOLS/ubuntu_tools/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/libapt-pkg.so.5.0 $TOOLS/ubuntu_tools/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/libapt-pkg.so.5.0.2 $TOOLS/ubuntu_tools/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/libapt-inst.so.2.0 $TOOLS/ubuntu_tools/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/libapt-inst.so.2.0.0 $TOOLS/ubuntu_tools/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/liblz4.so.1 $TOOLS/ubuntu_tools/lib/ && \\\ncp /lib/x86_64-linux-gnu/liblzma.so.5 $TOOLS/ubuntu_tools/lib/ && \\\ncp /lib/x86_64-linux-gnu/libbz2.so.1.0 $TOOLS/ubuntu_tools/lib/ && \\\ncp /lib/x86_64-linux-gnu/libudev.so.1 $TOOLS/ubuntu_tools/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/libzstd.so* $TOOLS/ubuntu_tools/lib/ && \\\ncp /usr/lib/python2.7/dist-packages/apt_inst.x86_64-linux-gnu.so /tmp/apt_inst.so && \\\ncp /tmp/apt_inst.so $TOOLS/ubuntu_tools/lib/python2.7/ && \\\ncp /usr/lib/python2.7/dist-packages/apt_pkg.x86_64-linux-gnu.so /tmp/apt_pkg.so && \\\ncp /tmp/apt_pkg.so $TOOLS/ubuntu_tools/lib/python2.7/ && \\\ncp -r /usr/lib/python2.7/dist-packages/apt $TOOLS/ubuntu_tools/lib/python2.7/ && \\\ncp -r /usr/lib/python2.7/dist-packages/aptsources $TOOLS/ubuntu_tools/lib/python2.7/ && \\\ncp /lib/x86_64-linux-gnu/libsystemd.so.0.21.0 $TOOLS/ubuntu_tools/lib && \\\ncp /lib/x86_64-linux-gnu/libsystemd.so.0 $TOOLS/ubuntu_tools/lib && \\\ncp /usr/bin/apt-extracttemplates $TOOLS/ubuntu_tools/bin && \\\nln -fs $TOOLS/ubuntu_tools/lib/libapt-private.so.0.0   $TOOLS/embedded/lib/libapt-private.so.0.0 && \\\nln -fs $TOOLS/ubuntu_tools/lib/libapt-private.so.0.0.0 $TOOLS/embedded/lib/libapt-private.so.0.0.0 && \\\nln -fs $TOOLS/ubuntu_tools/lib/libapt-pkg.so.5.0   $TOOLS/embedded/lib/libapt-pkg.so.5.0 && \\\nln -fs $TOOLS/ubuntu_tools/lib/libapt-pkg.so.5.0.2 $TOOLS/embedded/lib/libapt-pkg.so.5.0.2 && \\\nln -fs $TOOLS/ubuntu_tools/lib/libapt-inst.so.2.0   $TOOLS/embedded/lib/libapt-inst.so.2.0 && \\\nln -fs $TOOLS/ubuntu_tools/lib/libapt-inst.so.2.0.0 $TOOLS/embedded/lib/libapt-inst.so.2.0.0 && \\\nln -fs $TOOLS/ubuntu_tools/lib/liblz4.so.1 $TOOLS/embedded/lib/liblz4.so.1 && \\\nln -fs $TOOLS/ubuntu_tools/lib/liblzma.so.5 $TOOLS/embedded/lib/liblzma.so.5 && \\\nln -fs $TOOLS/ubuntu_tools/lib/libbz2.so.1.0 $TOOLS/embedded/lib/libbz2.so.1.0 && \\\nln -fs $TOOLS/ubuntu_tools/lib/libudev.so.1 $TOOLS/embedded/lib/libudev.so.1 && \\\nln -fs $TOOLS/ubuntu_tools/lib/libzstd.so.1 $TOOLS/embedded/lib/libzstd.so.1 && \\\nln -fs $TOOLS/ubuntu_tools/lib/libzstd.so.1.3.3 $TOOLS/embedded/lib/libzstd.so.1.3.3 && \\\nln -fs $TOOLS/ubuntu_tools/lib/python2.7/apt_inst.so $TOOLS/embedded/lib/python2.7/apt_inst.so && \\\nln -fs $TOOLS/ubuntu_tools/lib/python2.7/apt_pkg.so $TOOLS/embedded/lib/python2.7/apt_pkg.so && \\\nln -fs $TOOLS/ubuntu_tools/lib/python2.7/apt $TOOLS/embedded/lib/python2.7/apt && \\\nln -fs $TOOLS/ubuntu_tools/lib/python2.7/aptsources $TOOLS/embedded/lib/python2.7/aptsources && \\\nln -fs $TOOLS/ubuntu_tools/lib/libsystemd.so.0.21.0 $TOOLS/embedded/lib/libsystemd.so.0.21.0 && \\\nln -fs $TOOLS/ubuntu_tools/lib/libsystemd.so.0 $TOOLS/embedded/lib/libsystemd.so.0 && \\\nln -fs $TOOLS/ubuntu_tools/bin/apt-extracttemplates $TOOLS/embedded/bin/apt-extracttemplates && \\\nln -fs $TOOLS/ubuntu_tools/lib/libapt-inst.so.2.0 $TOOLS/ansible_tools_overlay/lib/libapt-inst.so.2.0 && \\\nln -fs $TOOLS/ubuntu_tools/lib/libapt-inst.so.2.0.0 $TOOLS/ansible_tools_overlay/lib/libapt-inst.so.2.0.0\n\n# TODO: FIXME: https://github.com/werf/werf/issues/1798\n# TODO: FIXME: try set nsswitch.conf file: http://www.linuxfromscratch.org/lfs/view/9.0-systemd-rc1/chapter06/glibc.html\n\nENV CC=$LFS_TGT-gcc\nENV CXX=$LFS_TGT-g++\nENV AR=$LFS_TGT-ar\nENV RANLIB=$LFS_TGT-ranlib\nENV CC_FOR_TARGET=$LFS_TGT-gcc\nENV PKG_CONFIG_PATH=\"/.werf/stapel/lib/pkgconfig:/.werf/stapel/embedded/lib/pkgconfig\"\n\nENV PATH=$TOOLS/x86_64-lfs-linux-gnu/bin:$TOOLS/bin:$PATH\n\n# yum-utils package needed for ansible yum module to work\nRUN apt update && \\\n apt install --no-install-recommends -y libcurl4-openssl-dev libssl-dev && \\\n$TOOLS/embedded/bin/pip install urlgrabber && \\\n apt install --no-install-recommends -y yum-utils && rm -rf /var/lib/apt/lists/*;\n\nRUN \\\ncp -r /usr/lib/python2.7/dist-packages/yumutils $TOOLS/embedded/lib/python2.7/ && \\\ncp -r /usr/lib/python2.7/dist-packages/yum $TOOLS/embedded/lib/python2.7/ && \\\ncp -r /usr/lib/python2.7/dist-packages/rpmUtils $TOOLS/embedded/lib/python2.7 && \\\ncp -r /usr/lib/python2.7/dist-packages/rpm $TOOLS/embedded/lib/python2.7 && \\\nln -fs $TOOLS/embedded/lib/python2.7/rpm/_rpm.x86_64-linux-gnu.so $TOOLS/embedded/lib/python2.7/rpm/_rpm.so && \\\nln -fs $TOOLS/embedded/lib/python2.7/rpm/_rpmb.x86_64-linux-gnu.so $TOOLS/embedded/lib/python2.7/rpm/_rpmb.so && \\\nln -fs $TOOLS/embedded/lib/python2.7/rpm/_rpms.x86_64-linux-gnu.so $TOOLS/embedded/lib/python2.7/rpm/_rpms.so && \\\ncp /usr/lib/python2.7/dist-packages/sqlitecachec.py $TOOLS/embedded/lib/python2.7 && \\\ncp /usr/lib/python2.7/dist-packages/_sqlitecache.so $TOOLS/embedded/lib/python2.7 && \\\ncp /usr/lib/x86_64-linux-gnu/librpmbuild.so.8.0.1 $TOOLS/embedded/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/librpmsign.so.8.0.1 $TOOLS/embedded/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/librpm.so.8.0.1 $TOOLS/embedded/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/librpm.so.8 $TOOLS/embedded/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/librpmio.so.8 $TOOLS/embedded/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/librpmsign.so.8 $TOOLS/embedded/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/librpmio.so.8.0.1 $TOOLS/embedded/lib/ && \\\ncp /usr/lib/x86_64-linux-gnu/librpmbuild.so.8 $TOOLS/embedded/lib/ && \\\ncp /lib/x86_64-linux-gnu/libcap.so.2.25 $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libcap.so.2 $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/liblua5.2.so.0 $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libdb-5.3.so $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libelf.so.1 $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libplc4.so $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libplds4.so $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libnspr4.so $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_nis.so.2 $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_compat.so.2 $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_nis-2.27.so $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_files-2.27.so $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_nisplus-2.27.so $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_nisplus.so.2 $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_hesiod-2.27.so $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_dns.so.2 $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_hesiod.so.2 $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_dns-2.27.so $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_files.so.2 $TOOLS/lib && \\\ncp /lib/x86_64-linux-gnu/libnss_compat-2.27.so $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libnss_files.so $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libnss_dns.so $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libnss_nis.so $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libnss_nisplus.so $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libnss3.so $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libnss_hesiod.so $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libnss_compat.so $TOOLS/lib && \\\ncp /usr/lib/x86_64-linux-gnu/libnssutil3.so $TOOLS/lib && \\\ncp -r /usr/lib/x86_64-linux-gnu/nss $TOOLS/lib && \\\nln -fs $TOOLS/embedded/lib/librpmbuild.so.8.0.1 $TOOLS/ansible_tools_overlay/lib/librpmbuild.so.8.0.1 && \\\nln -fs $TOOLS/embedded/lib/librpmsign.so.8.0.1 $TOOLS/ansible_tools_overlay/lib/librpmsign.so.8.0.1 && \\\nln -fs $TOOLS/embedded/lib/librpm.so.8.0.1 $TOOLS/ansible_tools_overlay/lib/librpm.so.8.0.1 && \\\nln -fs $TOOLS/embedded/lib/librpm.so.8 $TOOLS/ansible_tools_overlay/lib/librpm.so.8 && \\\nln -fs $TOOLS/embedded/lib/librpmio.so.8 $TOOLS/ansible_tools_overlay/lib/librpmio.so.8 && \\\nln -fs $TOOLS/embedded/lib/librpmsign.so.8 $TOOLS/ansible_tools_overlay/lib/librpmsign.so.8 && \\\nln -fs $TOOLS/embedded/lib/librpmio.so.8.0.1 $TOOLS/ansible_tools_overlay/lib/librpmio.so.8.0.1 && \\\nln -fs $TOOLS/embedded/lib/librpmbuild.so.8 $TOOLS/ansible_tools_overlay/lib/librpmbuild.so.8\n\n\n# Cleanup stapel: only runtime libs and binaries are needed\nRUN rm -rf \\\n$TOOLS/LICENSE* \\\n$TOOLS/version-manifest.* \\\n$TOOLS/include \\\n$TOOLS/share/aclocal \\\n$TOOLS/share/common-lisp \\\n$TOOLS/share/doc \\\n$TOOLS/share/gcc-8.2.0 \\\n$TOOLS/share/gnupg \\\n$TOOLS/share/info \\\n$TOOLS/share/libgpg-error \\\n$TOOLS/share/man \\\n$TOOLS/share/locale \\\n$TOOLS/x86_64-lfs-linux-gnu/include \\\n$TOOLS/x86_64-lfs-linux-gnu/lib \\\n$TOOLS/lib/*.a \\\n$TOOLS/lib/*.o \\\n$TOOLS/lib64/*.a \\\n$TOOLS/lib/gcc \\\n$TOOLS/libexec/gcc \\\n$TOOLS/var \\\n$TOOLS/embedded/lib/*.a \\\n$TOOLS/embedded/include \\\n$TOOLS/embedded/lib/python2.7/test \\\n$TOOLS/embedded/lib/python2.7/site-packages/ansible/galaxy \\\n$TOOLS/embedded/lib/python2.7/site-packages/ansible/modules/clustering \\\n$TOOLS/embedded/lib/python2.7/site-packages/ansible/modules/source_control \\\n$TOOLS/embedded/lib/python2.7/site-packages/ansible/modules/notification \\\n$TOOLS/embedded/lib/python2.7/site-packages/ansible/modules/web_infrastructure \\\n$TOOLS/embedded/lib/python2.7/site-packages/ansible/modules/remote_management \\\n$TOOLS/embedded/lib/python2.7/site-packages/ansible/modules/monitoring \\\n$TOOLS/embedded/lib/python2.7/site-packages/ansible/modules/windows \\\n$TOOLS/embedded/lib/python2.7/site-packages/ansible/modules/storage \\\n$TOOLS/embedded/lib/python2.7/site-packages/ansible/modules/cloud \\\n$TOOLS/embedded/lib/python2.7/site-packages/ansible/modules/network \\\n$TOOLS/embedded/lib/python2.7/site-packages/*.dist-info \\\n$TOOLS/embedded/share/aclocal \\\n$TOOLS/embedded/share/doc \\\n$TOOLS/embedded/share/info \\\n$TOOLS/embedded/share/man \\\n$TOOLS/embedded/share/local \\\n$TOOLS/embedded/share/locale \\\n$TOOLS/embedded/var \\\n$TOOLS/embedded/info \\\n$TOOLS/embedded/man\n\nRUN cp $TOOLS/share/i18n/charmaps/UTF-8.gz /tmp && \\\nrm -rf $TOOLS/share/i18n/charmaps/ && \\\nmkdir -p $TOOLS/share/i18n/charmaps/ && \\\nmv /tmp/UTF-8.gz $TOOLS/share/i18n/charmaps/\n\nRUN cp $TOOLS/share/i18n/locales/POSIX /tmp && \\\nrm -rf $TOOLS/share/i18n/locales/ && \\\nmkdir -p $TOOLS/share/i18n/locales/ && \\\nmv /tmp/POSIX $TOOLS/share/i18n/locales/\n\nRUN cp $TOOLS/x86_64-lfs-linux-gnu/bin/ld /tmp && \\\nrm -rf $TOOLS/x86_64-lfs-linux-gnu/bin && \\\nmkdir -p $TOOLS/x86_64-lfs-linux-gnu/bin && \\\nmv /tmp/ld $TOOLS/x86_64-lfs-linux-gnu/bin\n\nRUN cp $TOOLS/lib/gconv/UNICODE.so /tmp && \\\nrm -rf $TOOLS/lib/gconv && \\\nmkdir -p $TOOLS/lib/gconv && \\\nmv /tmp/UNICODE.so $TOOLS/lib/gconv\n\nRUN find $TOOLS/embedded/lib/python2.7 -name *.py[oc] | xargs rm\n\nRUN sed -i -e 's|if sys.version_info\\[0\\] == 2:|if False:|g' $TOOLS/embedded/lib/python2.7/site-packages/cryptography/__init__.py\n\nRUN mkdir /tmp/bin && \\\ncp $TOOLS/bin/gpg* /tmp/bin && \\\ncp $TOOLS/bin/gnutls* /tmp/bin && \\\ncp $TOOLS/bin/nettle* /tmp/bin && \\\ncp $TOOLS/bin/libassuan* /tmp/bin && \\\ncp $TOOLS/bin/libgcrypt* /tmp/bin && \\\ncp $TOOLS/bin/npth* /tmp/bin && \\\ncp $TOOLS/bin/dirmngr* /tmp/bin && \\\nrm -rf $TOOLS/bin && \\\nmv /tmp/bin $TOOLS/bin\n\n# Import tools\n\nFROM scratch as final\nCMD [\"no-such-command\"]\nENV TOOLS=/.werf/stapel\nCOPY --from=0 $TOOLS/libexec $TOOLS/libexec\nCOPY --from=0 $TOOLS/x86_64-lfs-linux-gnu $TOOLS/x86_64-lfs-linux-gnu\nCOPY --from=0 $TOOLS/sbin $TOOLS/sbin\nCOPY --from=0 $TOOLS/bin $TOOLS/bin\nCOPY --from=0 $TOOLS/lib64 $TOOLS/lib64\nCOPY --from=0 $TOOLS/lib $TOOLS/lib\nCOPY --from=0 $TOOLS/etc $TOOLS/etc\nCOPY --from=0 $TOOLS/share $TOOLS/share\nCOPY --from=0 $TOOLS/embedded/bin $TOOLS/embedded/bin\nCOPY --from=0 $TOOLS/embedded/etc $TOOLS/embedded/etc\nCOPY --from=0 $TOOLS/embedded/lib $TOOLS/embedded/lib\nCOPY --from=0 $TOOLS/embedded/libexec $TOOLS/embedded/libexec\nCOPY --from=0 $TOOLS/embedded/sbin $TOOLS/embedded/sbin\nCOPY --from=0 $TOOLS/embedded/share $TOOLS/embedded/share\nCOPY --from=0 $TOOLS/embedded/ssl $TOOLS/embedded/ssl\nCOPY --from=0 $TOOLS/ubuntu_tools $TOOLS/ubuntu_tools\nCOPY --from=0 $TOOLS/ansible_tools_overlay $TOOLS/ansible_tools_overlay\n"
}