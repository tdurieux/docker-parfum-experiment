{
  "startTime": 1674250548888,
  "endTime": 1674250550628,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 201,
        "lineEnd": 201,
        "columnStart": 1,
        "columnEnd": 43
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 247,
        "lineEnd": 247,
        "columnStart": 1,
        "columnEnd": 79
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 1,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 90
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 97
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 80,
        "lineEnd": 80,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 90
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 97
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 80,
        "lineEnd": 80,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 1,
        "columnEnd": 56
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 90
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 97
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 80,
        "lineEnd": 80,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 40
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 114
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 121
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 80,
        "lineEnd": 80,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 64
      }
    }
  ],
  "repairedDockerfile": "FROM ubuntu:20.04\n\n#\n# Configure FLAT\n#\n\nENV FLAT_NAME=flat\n#ENV FLAT_HOST=192.168.99.100\nENV FLAT_HOST=localhost\nENV FLAT_ICON_DIR=/app/flat/data/icons\nENV FLAT_TIMEOUT=150\nENV CMD_EXTENSION=cmdi\nENV FLAT_NAMESPACE=lat\n#docker: ENV FLAT_START=\"/bin/bash -l \\$*\"\n#compose: ENV FLAT_START=\"tail -f /dev/null\"\nENV FLAT_START_MODE=fg\n\n\n#\n# Setup workdir\n#\n\nRUN mkdir -p /app/flat/lib &&\\\n\tmkdir -p /app/flat/bin &&\\\n\tmkdir -p /app/flat/tmp\n\nWORKDIR /app/flat\n\nENV HOME /root\nENV PATH=\"/app/flat/bin:${PATH}\"\n\n# expose ports\nEXPOSE 80\nEXPOSE 8080\nEXPOSE 443\nEXPOSE 8983\n\n# set debconf to Noninteractive\nRUN echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections\n\n# install apt-utils, software-properties-common\nRUN apt-get update &&\\\n\tapt-get -y dist-upgrade && \\\n\tapt-get -y --no-install-recommends install apt-utils software-properties-common && \\\n\tapt-get update && rm -rf /var/lib/apt/lists/*;\n\n# add ondrej PPA apt repos for Apache, PHP 7.2,\nRUN add-apt-repository -y ppa:ondrej/php &&\\\n\tadd-apt-repository -y ppa:ondrej/apache2 && \\\n\tapt-get update\n\n#\n# locale\n#\n\nENV TZ 'Europe/Amsterdam'\nRUN echo $TZ > /etc/timezone && \\\n    apt-get -y --no-install-recommends install tzdata && \\\n    rm /etc/localtime && \\\n    ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && \\\n    dpkg-reconfigure -f noninteractive tzdata && rm -rf /var/lib/apt/lists/*;\n\nRUN apt-get -y --no-install-recommends install locales && \\\n\tsed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen && \\\n    echo 'LANG=\"en_US.UTF-8\"'>/etc/default/locale && \\\n    dpkg-reconfigure --frontend=noninteractive locales && \\\n    update-locale LANG=en_US.UTF-8 && rm -rf /var/lib/apt/lists/*;\nENV LANG \"en_US.UTF-8\"\nENV LANGUAGE \"en_US.UTF-8\"\nENV LC_ALL \"en_US.UTF-8\"\n\n#\n# Update and install all system libraries\n#\nRUN apt-get -y --no-install-recommends install supervisor curl wget openssl apache2 postgresql unzip ssh rsync git && rm -rf /var/lib/apt/lists/*;\n\n# PHP\nRUN apt-get -y --no-install-recommends install php7.1 libapache2-mod-php7.1 php7.1-gd php7.1-pgsql php7.1-xsl php7.1-curl && rm -rf /var/lib/apt/lists/*;\n\n# Java 8\nRUN apt-get -y --no-install-recommends install openjdk-8-jdk maven && rm -rf /var/lib/apt/lists/*;\nENV JAVA_HOME \"/usr/lib/jvm/java-8-openjdk-amd64\"\nRUN update-java-alternatives -s /usr/lib/jvm/java-1.8.0-openjdk-amd64\n\n# dev\nRUN apt-get -y --no-install-recommends install libxml2-utils vim && rm -rf /var/lib/apt/lists/*;\n\n#\n# Configure apache\n#   - set apache ulimit to 1024\nADD apache/envvars /etc/apache2/envvars\nADD apache/apache2.conf /etc/apache2/apache2.conf\nRUN a2enmod ssl &&\\\n\ta2enmod rewrite &&\\\n\ta2enmod proxy &&\\\n\ta2enmod proxy_http &&\\\n\ta2enmod sed &&\\\n\tsed -i \"s|FLAT_NAME|${FLAT_NAME}|g\" /etc/apache2/apache2.conf\n\n#\n# enable HTTPS\n#\n\nRUN a2enmod ssl &&\\\n    a2enmod headers &&\\\n    a2ensite default-ssl\n\n#\n# Configure postgres\n#   - initialise databases for fedora and drupal\nADD postgresql/wait-postgres.sh /wait-postgres.sh\nADD postgresql/wait-sergtsop.sh /wait-sergtsop.sh\nRUN chmod u+x /wait-postgres.sh &&\\\n\tchmod u+x /wait-sergtsop.sh &&\\\n    /etc/init.d/postgresql start &&\\\n\t/wait-postgres.sh &&\\\n\tsu -c \"psql -c \\\"CREATE USER fedora WITH PASSWORD 'fedora'\\\"\" postgres &&\\\n\tsu -c \"createdb -O fedora fedora\" postgres &&\\\n\tsu -c \"createdb -O fedora proai\" postgres &&\\\n\tsu -c \"createdb -O fedora --encoding=UNICODE -T template0 drupal\" postgres &&\\\n\t/etc/init.d/postgresql stop &&\\\n\t/wait-sergtsop.sh\n\n#\n# Download packages for the islandora setup\n#   - fedora commons\n#   - proai\n#   - drupal\n#       - tuque\n#   - islandora\n#\n\nENV FEDORA_HOME /var/www/fedora\nENV CATALINA_HOME /var/www/fedora/tomcat\n\nRUN mkdir /tmp/fedora &&\\\n\tcd /tmp/fedora &&\\\n\twget \"https://github.com/fcrepo3/fcrepo/releases/download/v3.8.1/fcrepo-installer-3.8.1.jar\"\n\nADD fedora/install.properties /tmp/fedora/install.properties\nRUN /etc/init.d/postgresql start &&\\\n\t/wait-postgres.sh &&\\\n\tcd /tmp/fedora &&\\\n\tjava -jar fcrepo-installer-3.8.1.jar install.properties &&\\\n\t/etc/init.d/postgresql stop &&\\\n\t/wait-sergtsop.sh\n\n# tell fedora about CMDI\nRUN sed -i 's|</mappings>|<mime-mapping><mime-type>application/x-cmdi+xml</mime-type><extension>cmdi</extension></mime-mapping></mappings>|g' /var/www/fedora/server/config/mime-to-extensions.xml\n\n#\n# All services are installed, add start script to automatically start required services\n#\n\nADD flat.txt /flat.txt\nADD supervisor/start-*.sh /\nRUN\tchmod u+x /start-*.sh\nADD supervisor/*.conf /etc/supervisor/conf.d/\nADD supervisor/start.sh /start.sh\nRUN\tchmod u+x /start.sh\n#RUN echo \" \" >> /start.sh && echo \"${FLAT_START}\" >> /start.sh\nRUN echo \". /etc/environment\" >> /etc/default/supervisor\n\nENTRYPOINT /start.sh\n\n#\n# starting fedora will initialize required directories\n#\n\nADD fedora/wait-tomcat.sh /wait-tomcat.sh\nRUN chmod u+x /wait-tomcat.sh &&\\\n    service supervisor start &&\\\n\t/wait-postgres.sh &&\\\n\tsupervisorctl start tomcat &&\\\n\t/wait-tomcat.sh &&\\\n\tsupervisorctl stop all &&\\\n\tservice supervisor stop &&\\\n\t/wait-sergtsop.sh\n\n# policies\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-purge-*\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-policy-management-if-not-administrator.xml\nRUN rm -v /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-inactive-or-deleted-objects-or-datastreams-if-not-administrator.xml\nADD fedora/deny-deleted-objects-or-datastreams-if-not-administrator.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-deleted-objects-or-datastreams-if-not-administrator.xml\nADD fedora/permit-anything-to-localhost.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/permit-anything-to-localhost.xml\nADD fedora/deny-unallowed-file-resolution.xml /var/www/fedora/data/fedora-xacml-policies/repository-policies/default/deny-unallowed-file-resolution.xml\nRUN cd /var/www/fedora/data/fedora-xacml-policies/repository-policies/ &&\\\n\twget https://github.com/Islandora/islandora-xacml-policies/archive/master.zip &&\\\n\tunzip master.zip &&\\\n\trm master.zip &&\\\n\tmv islandora-xacml-policies-master islandora\n\n# authorisation filter (there is no specific 7.1.13 tagged release but there have been no changes since 7.1.9)\nRUN cd /var/www/fedora/tomcat/webapps/fedora/WEB-INF/lib &&\\\n\twget \"https://github.com/Islandora/islandora_drupal_filter/releases/download/7.1.12/fcrepo-drupalauthfilter-3.8.1.jar\"\nADD fedora/jaas.conf /var/www/fedora/server/config/jaas.conf\nADD fedora/filter-drupal.xml /var/www/fedora/server/config/filter-drupal.xml\n\n##Download and configure drupal (via drush)\nRUN mkdir -p /var/www/composer &&\\\n\tcd /var/www/composer && \\\n\tcurl -f -sS https://getcomposer.org/installer | php && \\\n\tmv composer.phar composer\nENV COMPOSER_HOME=/var/www/composer\nRUN $COMPOSER_HOME/composer global require drush/drush:8.*\n\nRUN cd /var/www/html &&\\\n\t/var/www/composer/vendor/drush/drush/drush -v dl drupal-7 --drupal-project-rename=$FLAT_NAME\nENV PGPASSWORD=fedora\nRUN service supervisor start &&\\\n    /wait-postgres.sh &&\\\n\tsupervisorctl start tomcat &&\\\n\t/wait-tomcat.sh &&\\\n\tcd /var/www/html/$FLAT_NAME &&\\\n\texport PHP_OPTIONS=\"-d sendmail_path=`which true`\" &&\\\n\t/var/www/composer/vendor/drush/drush/drush site-install standard --site-name=FLAT --account-name=admin --account-pass=admin --db-su=fedora --db-su-pw=fedora --db-url=pgsql://fedora:fedora@localhost/drupal -y &&\\\n\tsupervisorctl stop all &&\\\n\tservice supervisor stop &&\\\n\t/wait-sergtsop.sh\n\nRUN mkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/custom &&\\\n\tchown www-data:www-data /var/www/html/$FLAT_NAME/sites/default/files &&\\\n\tchown www-data:www-data /var/www/html/$FLAT_NAME/sites/default/settings.php &&\\\n\tchown www-data:www-data /var/www/html/$FLAT_NAME/sites/all/modules/custom\n\nADD drupal/flat-logo.png /var/www/html/$FLAT_NAME/sites/default/files/flat-logo.png\nADD drupal/flat /var/www/html/$FLAT_NAME/sites/all/modules/custom/\nADD drupal/flat-logo.php /tmp/\n\n# To check accessibility we use a HEAD request using the http(s)?://<user>:<pass>@<host>(:<port>)?/<path>... support of drupal_http_request\n# however if the username or password does contain funny characters no escaping is supported\n# this change allows to use rawurlencode, as drupal_http_request will now do a rawurldecode\nRUN sed -i \"s|base64_encode(\\$uri\\['user'\\]|base64_encode(rawurldecode(\\$uri['user'])|g\" /var/www/html/$FLAT_NAME/includes/common.inc &&\\\n\tsed -i \"s| \\$uri\\['pass'\\] | rawurldecode(\\$uri['pass']) |g\" /var/www/html/$FLAT_NAME/includes/common.inc\n\nRUN mkdir /tmp/tuque &&\\\n\tcd /tmp/tuque &&\\\n\twget \"https://github.com/Islandora/tuque/archive/refs/tags/1.13.zip\" &&\\\n\tunzip 1.13.zip &&\\\n\tmv /tmp/tuque/tuque-1.13 /var/www/html/$FLAT_NAME/sites/all/libraries/tuque &&\\\n\tsed -i 's|public $verifyPeer = TRUE;|public $verifyPeer = FALSE;|g' /var/www/html/$FLAT_NAME/sites/all/libraries/tuque/HttpConnection.php\n\nRUN mkdir -p /tmp/islandora &&\\\n\tmkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/contrib &&\\\n\tmkdir -p /var/www/html/$FLAT_NAME/sites/all/themes &&\\\n\tcd /tmp/islandora &&\\\n\twget \"https://github.com/Islandora/islandora/archive/refs/tags/7.x-1.13.tar.gz\" &&\\\n\ttar -xf 7.x-1.13.tar.gz -C /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ &&\\\n\tcd /tmp/islandora &&\\\n\twget -O islandora_solution_pack_collection-7.x-1.13.zip \"https://github.com/islandora/islandora_solution_pack_collection/archive/refs/tags/7.x-1.13.zip\" &&\\\n\tunzip islandora_solution_pack_collection-7.x-1.13.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ &&\\\n\tcd /tmp/islandora &&\\\n\twget -O islandora_xacml_editor-7.x-1.13.zip \"https://github.com/Islandora/islandora_xacml_editor/archive/refs/tags/7.x-1.13.zip\" &&\\\n\tunzip islandora_xacml_editor-7.x-1.13.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ &&\\\n\tcd /tmp/islandora &&\\\n\twget -O islandora_solution_pack_compound-7.x-1.13.zip \"https://github.com/Islandora/islandora_solution_pack_compound/archive/refs/tags/7.x-1.13.zip\" &&\\\n\tunzip islandora_solution_pack_compound-7.x-1.13.zip -d /var/www/html/$FLAT_NAME/sites/all/modules/contrib/ && \\\n    sed -i 's|function islandora_compound_object_islandora_compoundCModel_islandora_view_object|function islandora_compound_object_islandora_compoundCModel_islandora_view_object_DISABLED_BY_FLAT|g' /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_compound-7.x-1.13/islandora_compound_object.module && rm 7.x-1.13.tar.gz\n\n# add CMDI solution pack\nRUN mkdir -p /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_cmdi\nADD flat/islandora_solution_pack_cmdi /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora_solution_pack_cmdi\n\n# tell islandora about CMDI\nRUN sed -i \"/\\\"json\\\"/a \\\"cmdi\\\" => \\\"application/x-cmdi+xml\\\",\" /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora-7.x-1.13/includes/mimetype.utils.inc &&\\\n\tsed -i \"/header('Content-type: ' . \\$datastream/a if (\\$datastream->ID == 'CMD') {\\nheader('Content-type: ' . 'application/xml');\\n}\" /var/www/html/$FLAT_NAME/sites/all/modules/contrib/islandora-7.x-1.13/includes/datastream.inc\n\nRUN mkdir -p /tmp/bootstrap &&\\\n\tcd /tmp/bootstrap &&\\\n\twget \"https://ftp.drupal.org/files/projects/bootstrap-7.x-3.26.zip\" &&\\\n\tunzip bootstrap-7.x-3.26.zip &&\\\n\tmv /tmp/bootstrap/bootstrap /var/www/html/$FLAT_NAME/sites/all/themes/bootstrap\n\nRUN cp -r /var/www/html/$FLAT_NAME/sites/all/themes/bootstrap/starterkits/THEMENAME  /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme &&\\\n\tcd /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/ &&\\\n\tmv THEMENAME.starterkit flat_bootstrap_theme.info &&\\\n    echo \";; FLAT settings\" >> flat_bootstrap_theme.info &&\\\n\techo \"settings[bootstrap_cdn_jsdelivr_theme] = 'flatly'\" >> flat_bootstrap_theme.info &&\\\n    echo \"settings[bootstrap_fluid_container] = 1\" >> flat_bootstrap_theme.info &&\\\n\tmkdir -p /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/js\n# determine our own object view\nADD islandora/islandora-default.tpl.php /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/templates/islandora-default.tpl.php\n# overwrite the compound behavior, which does special things for the first member (as being the representative)\nADD islandora/template.php /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/template.php\nADD islandora/flat.js /var/www/html/$FLAT_NAME/sites/all/themes/flat_bootstrap_theme/js/flat.js\n\nRUN service supervisor start &&\\\n\t/wait-postgres.sh &&\\\n\tsupervisorctl start tomcat &&\\\n\t/wait-tomcat.sh &&\\\n\tcd /var/www/html/$FLAT_NAME/ &&\\\n\t/var/www/composer/vendor/drush/drush/drush vset islandora_base_url http://localhost:8080/fedora &&\\\n\t/var/www/composer/vendor/drush/drush/drush en islandora -y &&\\\n\t/var/www/composer/vendor/drush/drush/drush en islandora_xacml_editor -y &&\\\n\t/var/www/composer/vendor/drush/drush/drush en islandora_basic_collection -y &&\\\n\t/var/www/composer/vendor/drush/drush/drush en islandora_compound_object -y &&\\\n\t/var/www/composer/vendor/drush/drush/drush en islandora_cmdi -y &&\\\n\t/var/www/composer/vendor/drush/drush/drush vset islandora_metadata_display cmdi &&\\\n\t/var/www/composer/vendor/drush/drush/drush dl features_extra -y &&\\\n\t/var/www/composer/vendor/drush/drush/drush en flat -y &&\\\n\t/var/www/composer/vendor/drush/drush/drush php-script flat-logo --script-path=/tmp &&\\\n\t/var/www/composer/vendor/drush/drush/drush en jquery_update -y &&\\\n\t/var/www/composer/vendor/drush/drush/drush en bootstrap -y &&\\\n\t/var/www/composer/vendor/drush/drush/drush en flat_bootstrap_theme -y &&\\\n\t/var/www/composer/vendor/drush/drush/drush vset theme_default flat_bootstrap_theme &&\\\n\tsupervisorctl stop all &&\\\n\tservice supervisor stop &&\\\n\t/wait-sergtsop.sh\n\n#\n# Add LAT2FOX\n#\n\nENV MAVEN_OPTS -Xss10M\n\nRUN cd /tmp &&\\\n    git clone -b develop https://github.com/TheLanguageArchive/SchemAnon.git SchemAnon &&\\\n    cd /tmp/SchemAnon &&\\\n    mvn clean install &&\\\n    mv target/SchemAnon.jar /app/flat/lib/SchemAnon.jar\n\nRUN mkdir -p /tmp/LAT2FOX\nADD flat/LAT2FOX /tmp/LAT2FOX\nRUN cd /tmp/LAT2FOX &&\\\n    mvn clean package &&\\\n    mv target/lat2fox.jar /app/flat/lib/lat2fox.jar\n\n#\n# Add FLAT's own scripts, tools and icons\n#\n\nADD flat/scripts/* /app/flat/bin/\nRUN chmod +x /app/flat/bin/*.sh &&\\\n    mv /app/flat/bin/do-*.sh /app/flat/\n\nRUN mkdir -p /app/flat/deposit\nADD flat/policies /app/flat/deposit/policies\nADD flat/policies-private-resources /app/flat/deposit/policies-private-resources\nADD flat/policies /app/flat/deposit/policies\n\nRUN mkdir -p $FLAT_ICON_DIR\nADD flat/icons $FLAT_ICON_DIR\n\n#\n# Cleanup\n#\n\n# clean up APT and /tmp when done.\nRUN apt-get clean &&\\\n\trm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n"
}