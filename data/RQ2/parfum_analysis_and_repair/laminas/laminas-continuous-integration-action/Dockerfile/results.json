{
  "startTime": 1674219997941,
  "endTime": 1674220000758,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 60,
        "lineEnd": 60,
        "columnStart": 8,
        "columnEnd": 67
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 10,
        "lineEnd": 11,
        "columnStart": 7,
        "columnEnd": 11
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 56,
        "lineEnd": 59,
        "columnStart": 7,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 63,
        "lineEnd": 200,
        "columnStart": 7,
        "columnEnd": 18
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Aliasing base images, so we can change just this, when needing to upgrade or pull base layers\nFROM ubuntu:20.04 AS base-distro\nFROM composer:2.3.9 AS composer\n\n\nFROM base-distro AS install-markdownlint\n\n# Install system dependencies first - these don't change much\nRUN export DEBIAN_FRONTEND=noninteractive \\\n    && apt update \\\n    && apt install -y --no-install-recommends \\\n        npm \\\n    && apt clean && rm -rf /var/lib/apt/lists/*;\n\nCOPY setup/markdownlint/package.json \\\n    setup/markdownlint/package-lock.json \\\n    setup/markdownlint/markdownlint.json \\\n    /markdownlint/\n\nCOPY setup/markdownlint/dummy-ok-markdown-test-file.md \\\n    setup/markdownlint/dummy-ko-markdown-test-file.md \\\n    /test-files/\n\nRUN cd /markdownlint \\\n    && npm ci \\\n    # Smoke-testing the installation, just making sure it works as expected - should pass first file, fail on second\n    && node_modules/.bin/markdownlint-cli2 /test-files/dummy-ok-markdown-test-file.md \\\n    && if node_modules/.bin/markdownlint-cli2 /test-files/dummy-ko-markdown-test-file.md; then exit 1; else exit 0; fi\n\n\nFROM composer AS staabm-annotate-pull-request-from-checkstyle\n\nCOPY setup/staabm-annotate-pull-request-from-checkstyle/composer.json \\\n    setup/staabm-annotate-pull-request-from-checkstyle/composer.lock \\\n    /staabm-annotate-pull-request-from-checkstyle/\n\nRUN cd /staabm-annotate-pull-request-from-checkstyle \\\n    && composer install \\\n        --no-dev \\\n        --classmap-authoritative\n\n\nFROM base-distro\n\nLABEL \"repository\"=\"http://github.com/laminas/laminas-continuous-integration-action\"\nLABEL \"homepage\"=\"http://github.com/laminas/laminas-continuous-integration-action\"\nLABEL \"maintainer\"=\"https://github.com/laminas/technical-steering-committee/\"\n\nENV COMPOSER_HOME=/usr/local/share/composer \\\n    DEBIAN_FRONTEND=noninteractive \\\n    ACCEPT_EULA=Y\n\n# This may look a bit long, but it's just a big `apt install` section, followed by a cleanup,\n# so that we get a single compact layer, with not too many layer overwrites.\nRUN apt update \\\n    && apt upgrade -y \\\n    && apt install -y --no-install-recommends \\\n      curl \\\n      gpg-agent \\\n      software-properties-common \\\n    && ( curl -f -sSL https://packages.microsoft.com/keys/microsoft.asc | apt-key add -) \\\n    && add-apt-repository -y ppa:ondrej/php \\\n    && add-apt-repository -y https://packages.microsoft.com/ubuntu/20.04/prod \\\n    && apt install -y --no-install-recommends \\\n        # Base dependencies\n        git \\\n        jq \\\n        libxml2-utils \\\n        libzip-dev \\\n        nodejs \\\n        sudo \\\n        wget \\\n        yamllint \\\n        zip \\\n        msodbcsql17 \\\n        \\\n        php5.6-bz2 \\\n        php5.6-cli \\\n        php5.6-curl \\\n        php5.6-dev \\\n        php5.6-fileinfo \\\n        php5.6-intl \\\n        php5.6-json \\\n        php5.6-mbstring \\\n        php5.6-phar \\\n        php5.6-phpdbg \\\n        php5.6-readline \\\n        php5.6-sockets \\\n        php5.6-xml \\\n        php5.6-xsl \\\n        php5.6-zip \\\n        \\\n        php7.0-cli \\\n        php7.0-bz2 \\\n        php7.0-curl \\\n        php7.0-dev \\\n        php7.0-fileinfo \\\n        php7.0-intl \\\n        php7.0-json \\\n        php7.0-mbstring \\\n        php7.0-phar \\\n        php7.0-phpdbg \\\n        php7.0-readline \\\n        php7.0-sockets \\\n        php7.0-xml \\\n        php7.0-xsl \\\n        php7.0-zip \\\n        \\\n        php7.1-cli \\\n        php7.1-bz2 \\\n        php7.1-curl \\\n        php7.1-dev \\\n        php7.1-fileinfo \\\n        php7.1-intl \\\n        php7.1-json \\\n        php7.1-mbstring \\\n        php7.1-phar \\\n        php7.1-phpdbg \\\n        php7.1-readline \\\n        php7.1-sockets \\\n        php7.1-xml \\\n        php7.1-xsl \\\n        php7.1-zip \\\n        \\\n        php7.2-cli \\\n        php7.2-bz2 \\\n        php7.2-curl \\\n        php7.2-dev \\\n        php7.2-fileinfo \\\n        php7.2-intl \\\n        php7.2-json \\\n        php7.2-mbstring \\\n        php7.2-phar \\\n        php7.2-phpdbg \\\n        php7.2-readline \\\n        php7.2-sockets \\\n        php7.2-xml \\\n        php7.2-xsl \\\n        php7.2-zip \\\n        \\\n        php7.3-cli \\\n        php7.3-bz2 \\\n        php7.3-curl \\\n        php7.3-dev \\\n        php7.3-fileinfo \\\n        php7.3-intl \\\n        php7.3-json \\\n        php7.3-mbstring \\\n        php7.3-phar \\\n        php7.3-phpdbg \\\n        php7.3-readline \\\n        php7.3-sockets \\\n        php7.3-xml \\\n        php7.3-xsl \\\n        php7.3-zip \\\n        \\\n        php7.4-cli \\\n        php7.4-bz2 \\\n        php7.4-curl \\\n        php7.4-dev \\\n        php7.4-fileinfo \\\n        php7.4-intl \\\n        php7.4-json \\\n        php7.4-mbstring \\\n        php7.4-phar \\\n        php7.4-phpdbg \\\n        php7.4-readline \\\n        php7.4-sockets \\\n        php7.4-xml \\\n        php7.4-xsl \\\n        php7.4-zip \\\n        \\\n        php8.0-cli \\\n        php8.0-bz2 \\\n        php8.0-curl \\\n        php8.0-dev \\\n        php8.0-fileinfo \\\n        php8.0-intl \\\n        php8.0-mbstring \\\n        php8.0-phar \\\n        php8.0-phpdbg \\\n        php8.0-readline \\\n        php8.0-sockets \\\n        php8.0-xml \\\n        php8.0-xsl \\\n        php8.0-zip \\\n        \\\n        php8.1-cli \\\n        php8.1-bz2 \\\n        php8.1-curl \\\n        php8.1-dev \\\n        php8.1-fileinfo \\\n        php8.1-intl \\\n        php8.1-mbstring \\\n        php8.1-phar \\\n        php8.1-phpdbg \\\n        php8.1-readline \\\n        php8.1-sockets \\\n        php8.1-xml \\\n        php8.1-xsl \\\n        php8.1-zip \\\n    # Set default PHP version\n    && update-alternatives --set php /usr/bin/php7.4 \\\n    && update-alternatives --set phpize /usr/bin/phpize7.4 \\\n    && update-alternatives --set php-config /usr/bin/php-config7.4 \\\n    && apt autoremove -y \\\n    && apt clean && rm -rf /var/lib/apt/lists/*;\n\n# Build/install static modules that do not have packages\nCOPY mods-available /mods-available\nCOPY mods-install /mods-install\nRUN set -e; for INSTALLER in /mods-install/*.sh; do ${INSTALLER} ; done\n\nCOPY scripts /scripts\nRUN chmod a+x /scripts/*\n\nRUN /scripts/php_ini_dev_settings.sh\nCOPY entrypoint.sh /usr/local/bin/entrypoint.sh\nCOPY php-extensions-with-version.php /usr/local/bin/php-extensions-with-version.php\nRUN chmod +x /usr/local/bin/php-extensions-with-version.php\n\n# Copy Markdownlint installation to this stage\nCOPY --from=install-markdownlint /markdownlint /markdownlint\nRUN ln -s /markdownlint/node_modules/.bin/markdownlint-cli2 /usr/local/bin/markdownlint\nCOPY --from=install-markdownlint /markdownlint/markdownlint.json /etc/laminas-ci/markdownlint.json\n\n\n# Copy staabm/annotate-pull-request-from-checkstyle to this stage\nCOPY --from=staabm-annotate-pull-request-from-checkstyle /staabm-annotate-pull-request-from-checkstyle /staabm-annotate-pull-request-from-checkstyle\nRUN ln -s /staabm-annotate-pull-request-from-checkstyle/vendor/bin/cs2pr /usr/local/bin/cs2pr\n\n\n# Add composer binary to the image\nCOPY --from=composer /usr/bin/composer /usr/bin/composer\n\n\n# We use https://github.com/xt0rted/markdownlint-problem-matcher/blob/caf6b376527f8a8ac3b8ed6746989e51a6e560c8/.github/problem-matcher.json\n# and https://github.com/shivammathur/setup-php/blob/57db6baebbe30a3126c7a03aa0e3267fa7872d96/src/configs/pm/phpunit.json\n# to match the output of Markdownlint and PHPUnit to GitHub Actions\n# annotations (https://docs.github.com/en/actions/using-workflows/workflow-commands-for-github-actions#setting-a-warning-message)\nCOPY setup/markdownlint/problem-matcher.json /etc/laminas-ci/problem-matcher/markdownlint.json\nCOPY setup/phpunit/problem-matcher.json /etc/laminas-ci/problem-matcher/phpunit.json\n\n\nRUN useradd -ms /bin/bash testuser\n\nENTRYPOINT [\"entrypoint.sh\"]\n"
}