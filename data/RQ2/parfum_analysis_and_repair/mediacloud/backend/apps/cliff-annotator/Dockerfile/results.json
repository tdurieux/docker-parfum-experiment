{
  "startTime": 1674216936905,
  "endTime": 1674216938245,
  "originalSmells": [
    {
      "rule": "mkdirUsrSrcThenRemove",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 22
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# CLIFF annotator service\n#\n\nFROM gcr.io/mcback/java-base:latest\n\nENV PATH=\"/usr/lib/maven/bin:/usr/lib/tomcat7/bin:${PATH}\" \\\n    #\n    # Annotator requires some more RAM\n    JAVA_OPTS=\"-Xmx4096m\"\n\n# Download and extract CLAVIN's geonames index\nRUN \\\n    mkdir -p /etc/cliff2/IndexDirectory/ && \\\n    /dl_to_stdout.sh \"https://github.com/mediacloud/clavin-build-geonames-index/releases/download/2020-11-25/IndexDirectory.tar.gz\" | \\\n        tar -zx -C /etc/cliff2/IndexDirectory/ --strip 1 && \\\n    true\n\n# Install Maven for building CLIFF\n# (can't use APT because we didn't install Java through it)\nRUN \\\n    mkdir -p /usr/lib/maven/ && \\\n    /dl_to_stdout.sh \"https://repo.maven.apache.org/maven2/org/apache/maven/apache-maven/3.6.2/apache-maven-3.6.2-bin.tar.gz\" | \\\n        tar -zx -C /usr/lib/maven/ --strip 1 && \\\n    true\n\n# Install Tomcat 7\nRUN \\\n    mkdir -p /usr/lib/tomcat7/ && \\\n    /dl_to_stdout.sh \"https://mediacloud-archive-apache-org.s3.amazonaws.com/apache-tomcat-7.0.96.tar.gz\" | \\\n        tar -zx -C /usr/lib/tomcat7/ --strip 1 && \\\n    true\n\n# Copy source\nRUN mkdir -p /usr/src/ && rm -rf /usr/src/\nCOPY src/ /usr/src/\n\n# Build CLIFF\nRUN \\\n    #\n    # Test if submodules were checked out\n    if [ ! -f /usr/src/CLIFF/LICENSE ]; then \\\n        echo && \\\n        echo \"Git submodules haven't been checked out, please run:\" && \\\n        echo && \\\n        echo \"    git submodule update --init --recursive\" && \\\n        echo && \\\n        echo \"and then rebuild this container.\" && \\\n        echo && \\\n        exit 1; \\\n    fi && \\\n    #\n    # Test if the builder machine has enough RAM\n    if [ $(/container_memory_limit.sh) -le 3900 ]; then \\\n        echo && \\\n        echo \"The builder machine needs at least 4 GB of RAM to run CLIFF\" && \\\n        echo \"annotator tests. Please increase RAM available to Docker or\" && \\\n        echo \"try rebuilding on a bigger machine.\" && \\\n        echo && \\\n        exit 1; \\\n    fi && \\\n    #\n    # Build CLIFF\n    cd /usr/src/CLIFF/ && \\\n    mvn --no-transfer-progress package && \\\n    #\n    # Copy exploded WAR to Tomcat 7's webroot\n    mv webapp/target/cliff-2.6.1/ /usr/lib/tomcat7/webapps/cliff/ && \\\n    #\n    # Cleanup\n    mvn -q clean && \\\n    rm -rf ~/.m2/ && \\\n    true\n\n# Configure Tomcat 7\nRUN \\\n    #\n    # Copy configuration\n    mv /usr/src/tomcat7/conf/logging.properties /usr/lib/tomcat7/conf/logging.properties && \\\n    mv /usr/src/tomcat7/conf/server.xml /usr/lib/tomcat7/conf/server.xml && \\\n    rm -rf /usr/src/tomcat7/ && \\\n    #\n    # No secrets in configuration\n    chmod 644 /usr/lib/tomcat7/conf/* && \\\n    #\n    # Some extra directories that seem to be needed\n    mkdir -p /usr/lib/tomcat7/conf/Catalina/localhost/ && \\\n    chown -R www-data:www-data /usr/lib/tomcat7/conf/Catalina/localhost/ && \\\n    mkdir -p /usr/lib/tomcat7/work/Catalina/localhost/ && \\\n    chown -R www-data:www-data /usr/lib/tomcat7/work/Catalina/localhost/ && \\\n    true\n\n# Expose Tomcat 7's port\nEXPOSE 8080\n\n# Change to non-privileged user\nUSER www-data\n\n# Run Tomcat 7\nCMD [\"catalina.sh\", \"run\"]\n"
}