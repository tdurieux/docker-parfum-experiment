{
  "startTime": 1674216135118,
  "endTime": 1674216135890,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 95,
        "lineEnd": 100,
        "columnStart": 1,
        "columnEnd": 6
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG REDHAT_SUBSCRIPTION_ORG_ID\nARG REDHAT_SUBSCRIPTION_ACTIVATION_KEY\n\nARG CACHE_REPO\nARG CACHE_TAG\n\nARG CHECKOUT_BEFORE_PATCHING=true\n\nFROM registry.access.redhat.com/ubi8/ubi:8.6 AS rhel-8-base\n\nARG REDHAT_SUBSCRIPTION_ORG_ID\nARG REDHAT_SUBSCRIPTION_ACTIVATION_KEY\n\nENV DOCKERIZED=1\n\n# Subscription registration is only needed to install RHEL packages\n# if on a non-RHEL host. (See https://access.redhat.com/solutions/5558771)\nRUN subscription-manager register \\\n\t--org \"${REDHAT_SUBSCRIPTION_ORG_ID}\" \\\n\t--activationkey \"${REDHAT_SUBSCRIPTION_ACTIVATION_KEY}\" && \\\n\tdnf -y update && \\\n\tdnf -y install \\\n\t\tmake \\\n\t\tcmake \\\n\t\tgcc-c++ \\\n\t\tllvm-7.0.1 \\\n\t\tclang-7.0.1 \\\n\t\tpatch \\\n\t\telfutils-libelf \\\n\t\telfutils-libelf-devel \\\n\t\tgit \\\n\t\tpython3 \\\n\t\tkmod && \\\n\tln -s /usr/bin/gcc /usr/bin/gcc-8 && \\\n\tsubscription-manager unregister\n\n# This directory goes separately to prevent it from being modified/deleted when switching branches\nCOPY /collector/kernel-modules/dockerized/scripts /scripts\nCOPY /collector/kernel-modules/build/prepare-src /scripts/prepare-src.sh\nCOPY /collector/kernel-modules/build/build-kos /scripts/\nCOPY /collector/kernel-modules/build/build-wrapper.sh /scripts/compile.sh\n\nFROM rhel-8-base AS patcher\n\nARG BRANCH=master\nARG LEGACY_PROBES=false\n\nCOPY /collector /collector\n\nENV CHECKOUT_BEFORE_PATCHING=$CHECKOUT_BEFORE_PATCHING\nRUN /scripts/patch-files.sh $BRANCH $LEGACY_PROBES\n\nFROM $CACHE_REPO/collector-drivers:$CACHE_TAG AS cache\n\nFROM rhel-8-base AS task-master\n\nARG USE_KERNELS_FILE=false\nENV USE_KERNELS_FILE=$USE_KERNELS_FILE\n\nCOPY /bundles /bundles\nCOPY /collector/kernel-modules/build/apply-blocklist.py /scripts\nCOPY /collector/kernel-modules/BLOCKLIST /scripts\nCOPY /collector/kernel-modules/dockerized/BLOCKLIST /scripts/dockerized/\nCOPY /collector/kernel-modules/KERNEL_VERSIONS /KERNEL_VERSIONS\nCOPY --from=patcher /kobuild-tmp/versions-src /kobuild-tmp/versions-src\nCOPY --from=cache /kernel-modules/ /kernel-modules/\n\nRUN /scripts/get-build-tasks.sh; rm -rf /bundles/ /kobuild-tmp/ /kernel-modules/\n\nFROM rhel-8-base AS rhel-8-builder\n\nCOPY /bundles /bundles\nCOPY --from=patcher /kobuild-tmp/versions-src /kobuild-tmp/versions-src\nCOPY --from=task-master /build-tasks /build-tasks\n\n# This stage will only build bundles for kernel 4+\nRUN sed -i '/^[0-3]\\./d' /build-tasks; \\\n\t/scripts/compile.sh </build-tasks; \\\n\trm -rf /bundles/\n\nFROM registry.access.redhat.com/ubi7/ubi:7.9 AS rhel-7-base\n\nARG REDHAT_SUBSCRIPTION_ORG_ID\nARG REDHAT_SUBSCRIPTION_ACTIVATION_KEY\n\nENV DOCKERIZED=1\n\n# Subscription registration is only needed to install RHEL packages\n# if on a non-RHEL host. (See https://access.redhat.com/solutions/5558771)\nRUN subscription-manager register \\\n\t--org \"${REDHAT_SUBSCRIPTION_ORG_ID}\" \\\n\t--activationkey \"${REDHAT_SUBSCRIPTION_ACTIVATION_KEY}\" && \\\n\tsubscription-manager repos --enable rhel-7-server-devtools-rpms && \\\n\tsubscription-manager repos --enable rhel-server-rhscl-7-rpms && \\\n\tyum -y update && \\\n\tyum -y install \\\n\t\tmake \\\n\t\tgcc-c++ \\\n\t\tllvm-toolset-7.0 \\\n\t\telfutils-libelf \\\n\t\tkmod && \\\n\tsubscription-manager unregister && rm -rf /var/cache/yum\n\n# This directory goes separately to prevent it from being modified/deleted when switching branches\nCOPY /collector/kernel-modules/dockerized/scripts /scripts\nCOPY /collector/kernel-modules/build/prepare-src /scripts/prepare-src.sh\nCOPY /collector/kernel-modules/build/build-kos /scripts/\nCOPY /collector/kernel-modules/build/build-wrapper.sh /scripts/compile.sh\nCOPY /collector/kernel-modules/probe/ /probe\n\nFROM rhel-7-base AS rhel-7-builder\n\nCOPY /bundles /bundles\nCOPY --from=patcher /kobuild-tmp/versions-src /kobuild-tmp/versions-src\nCOPY --from=task-master /build-tasks /build-tasks\n\n# This stage will only build bundles for kernel 0-3\nRUN sed -i '/^[4-9]\\./d' /build-tasks; \\\n\tscl enable llvm-toolset-7.0 /scripts/compile.sh </build-tasks; \\\n\trm -rf /bundles/\n\n# Create a clean image leaving only the compiled kernel modules\nFROM registry.access.redhat.com/ubi8/ubi:8.6\n\nCOPY --from=rhel-8-builder /kernel-modules /kernel-modules\nCOPY --from=rhel-7-builder /kernel-modules /kernel-modules\nCOPY --from=rhel-8-builder /FAILURES /FAILURES\nCOPY --from=rhel-7-builder /FAILURES /FAILURES\n\nENTRYPOINT [ \"/bin/bash\", \"-c\" ]\n"
}