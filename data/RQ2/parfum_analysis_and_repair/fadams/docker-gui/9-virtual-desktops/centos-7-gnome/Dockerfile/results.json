{
  "startTime": 1674245992643,
  "endTime": 1674245993709,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 48,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 24
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# Licensed to the Apache Software Foundation (ASF) under one\n# or more contributor license agreements.  See the NOTICE file\n# distributed with this work for additional information\n# regarding copyright ownership.  The ASF licenses this file\n# to you under the Apache License, Version 2.0 (the\n# \"License\"); you may not use this file except in compliance\n# with the License.  You may obtain a copy of the License at\n#\n#   http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing,\n# software distributed under the License is distributed on an\n# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n# KIND, either express or implied.  See the License for the\n# specific language governing permissions and limitations\n# under the License.\n#\n\nFROM centos:7.7.1908\n\nENV LANG=en_GB.UTF-8\nENV LC_ALL=en_GB.UTF-8\nENV TZ=Europe/London\n\nRUN \\\n\n\n\n\n\n    rpm --import \\\n        /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7 && \\\n    rpm --import \\\n        /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-Testing-7 && \\\n    rpm --import \\\n        /etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-Debug-7 && \\\n    # Install required packages. Add deltarpm to get rid\n    # of some warnings & epel-release is needed for lightdm.\n    yum -y install deltarpm epel-release && \\\n    yum -y update && \\\n    rpm --import /etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7 && \\\n    yum -y --exclude=abrt* groups install \\\n    \"GNOME Desktop\" || true && \\\n    yum -y groups install \\\n    \"Office Suite and Productivity\" && \\\n    yum -y groups install \\\n    \"Graphics Creation Tools\" && \\\n    yum -y install \\\n    xorg-x11-server-Xephyr thunderbird pavucontrol lightdm \\\n    pulseaudio-module-zeroconf slick-greeter dbus-x11 \\\n    nss-mdns mesa-libGLU && \\\n    # Generate locales\n    echo LANG=\\\"$LANG\\\" > /etc/locale.conf && \\\n    localedef -i \"${LANG%.*}\" -f \"${LANG#*.}\" $LANG && \\\n    # Set up the timezone\n    echo $TZ > /etc/timezone && \\\n    ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && \\\n    # Set up Keyboard mapping\n    echo -e 'XKBMODEL=\"pc105\"\\nXKBLAYOUT=\"gb\"\\nXKBVARIANT=\"\"\\nXKBOPTIONS=\"\"' > /etc/default/keyboard && \\\n    sed -i 's/KEYMAP=\"us\"/KEYMAP=\"uk\"/' \\\n        /etc/vconsole.conf && \\\n    sed -i 's/Option \"XkbLayout\" \"us\"/Option \"XkbLayout\" \"gb\"\\n        Option \"XkbModel\" \"pc105\"\\n        Option \"XkbOptions\" \"terminate:ctrl_alt_bksp\"/' /etc/X11/xorg.conf.d/00-keyboard.conf && \\\n    # Configure LightDM Display Manager to use Xephyr\n    # instead of X. Reorganise /usr/share/xsessions to set\n    # gnome-classic as default session as slick-greeter\n    # uses hardcoded names to select the default session.\n    mv /usr/share/xsessions/gnome.desktop \\\n       /usr/share/xsessions/gnome-xorg.desktop && \\\n    mv /usr/share/xsessions/gnome-classic.desktop \\\n       /usr/share/xsessions/gnome.desktop && \\\n    echo -e '#!/bin/bash\\nexport XAUTHORITY=/root/.Xauthority.docker\\nexport DISPLAY=:0\\nexec Xephyr $1 -ac >> /var/log/lightdm/x-1.log' > /usr/bin/Xephyr-lightdm-wrapper && \\\n    chmod +x /usr/bin/Xephyr-lightdm-wrapper && \\\n    echo -e '[LightDM]\\nminimum-display-number=1\\n[Seat:*]\\nsession-setup-script=xrandr --output default --mode 1600x1200\\nuser-session=gnome\\nxserver-command=/usr/bin/Xephyr-lightdm-wrapper' > /etc/lightdm/lightdm.conf.d/70-centos.conf && \\\n    # CentOS defaults to GDM, change to LightDM\n    rm -f /etc/systemd/system/display-manager.service && \\\n    ln -s /usr/lib/systemd/system/lightdm.service \\\n          /etc/systemd/system/display-manager.service && \\\n    # CentOS defaults init to multi-user.target,\n    # change to graphical.target\n    rm -f /etc/systemd/system/default.target && \\\n    ln -s /usr/lib/systemd/system/graphical.target \\\n          /etc/systemd/system/default.target && \\\n    # Change nautilus and desktop icons from large to small\n    # https://unix.stackexchange.com/questions/250266/rhel-7-gnome-shell-decrease-desktop-icon-size\n    sed -i '/default-zoom-level/{n; s/large/small/}' \\\n      /usr/share/glib-2.0/schemas/org.gnome.nautilus.gschema.xml && \\\n    glib-compile-schemas \\\n        /usr/share/glib-2.0/schemas/ >/dev/null 2>&1 && \\\n    # Prevent PulseAudio trying to launch rtkit-daemon\n    # because the container doesn't have the required caps\n    # and the failures slow desktop launch.\n    sed -i 's/load-module module-udev-detect/load-module module-udev-detect tsched=0/' /etc/pulse/default.pa && \\\n    # Disable org.freedesktop.RealtimeKit1.service DBus svc\n    rm -f /usr/share/dbus-1/system-services/org.freedesktop.RealtimeKit1.service && \\\n    # Fix issues with slow shutdown\n    sed -i 's/#DefaultTimeoutStopSec=90s/DefaultTimeoutStopSec=5s/' /etc/systemd/system.conf && \\\n    # Fix Polkit issues caused by container login being\n    # considered to be an \"inactive\" session.\n    chmod 755 /etc/polkit-1/localauthority && \\\n    # Date & Time\n    echo -e \"[Date & Time]\\nIdentity=unix-user:*\\nAction=org.gnome.controlcenter.datetime.configure\\nResultAny=auth_admin_keep\\nResultInactive=auth_admin_keep\\nResultActive=auth_admin_keep\\n\" > /etc/polkit-1/localauthority/50-local.d/10-datetimemechanism.pkla && \\\n    # User Accounts\n    echo -e \"[Manage user accounts]\\nIdentity=unix-user:*\\nAction=org.gnome.controlcenter.user-accounts.administration\\nResultAny=auth_admin_keep\\nResultInactive=auth_admin_keep\\nResultActive=auth_admin_keep\\n\" > /etc/polkit-1/localauthority/50-local.d/10-user-accounts.pkla && \\\n    # Gnome System Log\n    echo -e \"[Gnome System Log]\\nIdentity=unix-user:*\\nAction=org.gnome.logview.pkexec.run\\nResultAny=auth_admin_keep\\nResultInactive=auth_admin_keep\\nResultActive=auth_admin_keep\\n\" > /etc/polkit-1/localauthority/50-local.d/10-system-log.pkla && \\\n    # System Color Manager\n    echo -e \"[System Color Manager]\\nIdentity=unix-user:*\\nAction=org.freedesktop.color-manager.create-device;org.freedesktop.color-manager.create-profile;org.freedesktop.color-manager.delete-device;org.freedesktop.color-manager.delete-profile;org.freedesktop.color-manager.modify-device;org.freedesktop.color-manager.modify-profile;org.freedesktop.color-manager.device-inhibit;org.freedesktop.color-manager.sensor-lock\\nResultAny=yes\\nResultInactive=yes\\nResultActive=yes\\n\" > /etc/polkit-1/localauthority/50-local.d/10-color.pkla && \\\n    # Shutdown & Restart\n    # Note that auth_admin_keep may be better than yes\n    # here, but there seems to be an issue with the\n    # authentication dialog appearing.\n    echo -e \"[Shutdown & Restart]\\nIdentity=unix-user:*\\nAction=org.freedesktop.login1.power-off;org.freedesktop.login1.power-off-multiple-sessions;org.freedesktop.login1.reboot;org.freedesktop.login1.reboot-multiple-sessions\\nResultAny=yes\\nResultInactive=yes\\nResultActive=yes\\n\" > /etc/polkit-1/localauthority/50-local.d/10-shutdown.pkla && rm -rf /var/cache/yum\n\n#-------------------------------------------------------------------------------\n# Example usage\n#\n# Build the image\n# docker build -t centos-gnome:7.7 .\n\n"
}