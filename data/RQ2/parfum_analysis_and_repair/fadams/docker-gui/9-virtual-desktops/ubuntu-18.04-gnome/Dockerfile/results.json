{
  "startTime": 1674216296218,
  "endTime": 1674216297073,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 61,
        "lineEnd": 62,
        "columnStart": 22,
        "columnEnd": 38
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# Licensed to the Apache Software Foundation (ASF) under one\n# or more contributor license agreements.  See the NOTICE file\n# distributed with this work for additional information\n# regarding copyright ownership.  The ASF licenses this file\n# to you under the Apache License, Version 2.0 (the\n# \"License\"); you may not use this file except in compliance\n# with the License.  You may obtain a copy of the License at\n#\n#   http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing,\n# software distributed under the License is distributed on an\n# \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n# KIND, either express or implied.  See the License for the\n# specific language governing permissions and limitations\n# under the License.\n#\n\nFROM ubuntu:18.04\n\nENV LANG=en_GB.UTF-8\nENV TZ=Europe/London\n\nRUN \\\n\n    sed -i 's/# deb http:\\/\\/archive.canonical.com\\/ubuntu bionic partner/deb http:\\/\\/archive.canonical.com\\/ubuntu bionic partner/' /etc/apt/sources.list && \\\n    # Remove \"This system has been minimized\" warning.\n    rm -f /etc/update-motd.d/60-unminimize && \\\n    rm -f /etc/update-motd.d/98-fsck-at-reboot && \\\n    # Update base packages.\n    apt-get update && DEBIAN_FRONTEND=noninteractive \\\n    apt-get -fy -o Dpkg::Options::=\"--force-confnew\" \\\n                -o APT::Immediate-Configure=false \\\n                dist-upgrade && \\\n    # Add the main packages\n    DEBIAN_FRONTEND=noninteractive \\\n    apt-get install -y --no-install-recommends \\\n    base-files curl ntp add-apt-key aptdaemon \\\n    apt-transport-https language-pack-en gnome \\\n    ubuntu-minimal ubuntu-standard ubuntu-desktop \\\n    ubuntu-system-service ubuntu-restricted-extras \\\n    gsettings-ubuntu-schemas gnome-system-log \\\n    gnome-shell-extension-ubuntu-dock libpam-kwallet4 \\\n    gnome-shell-extension-appindicator libpam-kwallet5 \\\n    gnome-control-center-faces gnome-software-plugin-snap \\\n    # Add packages to be similar to Ubuntu iso installation.\n    thunderbird-locale-en thunderbird-locale-en-us \\\n    firefox-locale-en tracker-miner-fs avahi-utils vlc \\\n    transmission-gtk synaptic inkscape gimp pidgin remmina \\\n    remmina-common remmina-plugin-rdp remmina-plugin-vnc \\\n    remmina-plugin-nx remmina-plugin-spice \\\n    remmina-plugin-xdmcp mesa-utils libcanberra-pulse \\\n    pulseaudio-module-bluetooth paprefs pavucontrol \\\n    gstreamer1.0-pulseaudio pulseaudio-module-zeroconf \\\n    cups system-config-printer-gnome \\\n    # Install Display Manager and dependencies\n    lightdm slick-greeter dbus-x11 && \\\n    # Default libgl1-mesa-dri causes \"black window\" issues\n    # when software rendering. Use ppa to upgrade version.\n    add-apt-repository -y ppa:oibaf/graphics-drivers && \\\n    apt-get update && DEBIAN_FRONTEND=noninteractive \\\n    apt-get --no-install-recommends install -y libgl1-mesa-dri && \\\n    # Stop synaptic package manager being painfully slow\n    rm /etc/apt/apt.conf.d/docker-gzip-indexes && \\\n    rm -rf /var/lib/apt/lists/* && apt-get update && \\\n    # Generate locales\n    echo LANG=$LANG > /etc/default/locale && \\\n    update-locale LANG=$LANG && \\\n    # Set up the timezone\n    echo $TZ > /etc/timezone && \\\n    ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && \\\n    DEBIAN_FRONTEND=noninteractive \\\n    dpkg-reconfigure tzdata && \\\n    # Configure LightDM Display Manager to use\n    # Xephyr instead of X\n    rm /usr/share/lightdm/lightdm.conf.d/50-ubuntu.conf && \\\n    rm /usr/share/wayland-sessions/*.desktop && \\\n    # Reorganise /usr/share/xsessions to set Ubuntu as\n    # default session as slick-greeter uses hardcoded names\n    # to select the default session.\n    rm /usr/share/xsessions/gnome.desktop && \\\n    mv /usr/share/xsessions/ubuntu.desktop \\\n       /usr/share/xsessions/ubuntu-xorg.desktop && \\\n    mv /usr/share/xsessions/gnome-xorg.desktop \\\n       /usr/share/xsessions/gnome-classic.desktop && \\\n    echo '#!/bin/bash\\nexport XAUTHORITY=/root/.Xauthority.docker\\nexport DISPLAY=:0\\nexec Xephyr $1 -ac >> /var/log/lightdm/x-1.log' > /usr/bin/Xephyr-lightdm-wrapper && \\\n    chmod +x /usr/bin/Xephyr-lightdm-wrapper && \\\n    echo '[LightDM]\\nminimum-display-number=1\\n[Seat:*]\\nuser-session=ubuntu-xorg\\nxserver-command=/usr/bin/Xephyr-lightdm-wrapper' > /etc/lightdm/lightdm.conf.d/70-ubuntu.conf && \\\n    echo '[Greeter]\\nbackground=/usr/share/backgrounds/warty-final-ubuntu.png\\n' > /etc/lightdm/slick-greeter.conf && \\\n    # Configure console\n    echo \"console-setup console-setup/charmap select UTF-8\" | debconf-set-selections && \\\n    # Fix synaptic Empty Dir::Cache::pkgcache setting not\n    # handled correctly https://bugs.launchpad.net/ubuntu/+source/synaptic/+bug/1243615\n    # which causes synaptic to barf with: E: Could not \n    # open file - open (2: No such file or directory)\n    # E: _cache->open() failed, please report.\n    sed -i 's/Dir::Cache::pkgcache \"\"; //' \\\n        /etc/apt/apt.conf.d/docker-clean && \\\n    # Disable getty@tty1.service to speed up desktop loading.\n    rm -f /etc/systemd/system/getty.target.wants/getty@tty1.service && \\\n    # Fix issues with slow shutdown\n    sed -i 's/#DefaultTimeoutStopSec=90s/DefaultTimeoutStopSec=5s/' /etc/systemd/system.conf && \\\n    # Fix Polkit issues caused by container login being\n    # considered to be an \"inactive\" session.\n    chmod 755 /etc/polkit-1/localauthority && \\\n    # Date & Time\n    echo \"[Date & Time]\\nIdentity=unix-user:*\\nAction=org.gnome.controlcenter.datetime.configure\\nResultAny=auth_admin_keep\\nResultInactive=auth_admin_keep\\nResultActive=auth_admin_keep\\n\" > /etc/polkit-1/localauthority/50-local.d/10-datetimemechanism.pkla && \\\n    # User Accounts\n    echo \"[Manage user accounts]\\nIdentity=unix-user:*\\nAction=org.gnome.controlcenter.user-accounts.administration\\nResultAny=auth_admin_keep\\nResultInactive=auth_admin_keep\\nResultActive=auth_admin_keep\\n\" > /etc/polkit-1/localauthority/50-local.d/10-user-accounts.pkla && \\\n    # Gnome System Log\n    echo \"[Gnome System Log]\\nIdentity=unix-user:*\\nAction=org.debian.pkexec.gnome-system-log.run\\nResultAny=auth_admin_keep\\nResultInactive=auth_admin_keep\\nResultActive=auth_admin_keep\\n\" > /etc/polkit-1/localauthority/50-local.d/10-system-log.pkla && \\\n    # System Color Manager\n    echo \"[System Color Manager]\\nIdentity=unix-user:*\\nAction=org.freedesktop.color-manager.create-device;org.freedesktop.color-manager.create-profile;org.freedesktop.color-manager.delete-device;org.freedesktop.color-manager.delete-profile;org.freedesktop.color-manager.modify-device;org.freedesktop.color-manager.modify-profile;org.freedesktop.color-manager.device-inhibit;org.freedesktop.color-manager.sensor-lock\\nResultAny=yes\\nResultInactive=yes\\nResultActive=yes\\n\" > /etc/polkit-1/localauthority/50-local.d/10-color.pkla && \\\n    # Shutdown & Restart\n    # Note that auth_admin_keep may be better than yes\n    # here, but there seems to be an issue with the\n    # authentication dialog appearing.\n    echo \"[Shutdown & Restart]\\nIdentity=unix-user:*\\nAction=org.freedesktop.login1.power-off;org.freedesktop.login1.power-off-multiple-sessions;org.freedesktop.login1.reboot;org.freedesktop.login1.reboot-multiple-sessions\\nResultAny=yes\\nResultInactive=yes\\nResultActive=yes\\n\" > /etc/polkit-1/localauthority/50-local.d/10-shutdown.pkla\n\n#-------------------------------------------------------------------------------\n# Example usage\n#\n# Build the image\n# docker build -t ubuntu-gnome:18.04 .\n\n"
}