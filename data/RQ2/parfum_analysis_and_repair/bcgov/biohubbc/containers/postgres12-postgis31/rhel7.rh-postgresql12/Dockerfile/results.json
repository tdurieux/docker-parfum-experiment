{
  "startTime": 1674248756254,
  "endTime": 1674248756946,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 64,
        "lineEnd": 64,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 89
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 64
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM registry.redhat.io/rhscl/postgresql-12-rhel7\n\n# PostgreSQL image for OpenShift with PostGIS extension.\n# Volumes:\n#  * /var/lib/psql/data   - Database cluster for PostgreSQL\n# Environment:\n#  * $POSTGRESQL_USER     - Database user name\n#  * $POSTGRESQL_PASSWORD - User's password\n#  * $POSTGRESQL_DATABASE - Name of the database to create\n#  * $POSTGRESQL_ADMIN_PASSWORD (Optional) - Password for the 'postgres'\n#                           PostgreSQL administrative account\n\nENV POSTGIS_EXTENSION=N \\\n    PGCRYPTO_EXTENSION=N \\\n    POSTGRESQL_VERSION=12 \\\n    POSTGRESQL_PREV_VERSION=10 \\\n    HOME=/var/lib/pgsql \\\n    PGUSER=postgres \\\n    LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8 \\\n    APP_DATA=/opt/app-root\n\nENV POSTGISV 3\nENV TZ America/Vancouver\nENV PORT 5432\n\nENV SUMMARY=\"PostgreSQL is an advanced Object-Relational database management system\" \\\n    DESCRIPTION=\"PostgreSQL is an advanced Object-Relational database management system (DBMS). \\\nThe image contains the client and server programs that you'll need to \\\ncreate, run, maintain and access a PostgreSQL DBMS server.\"\n\nLABEL summary=$SUMMARY \\\n      description=\"$DESCRIPTION\" \\\n      io.k8s.description=\"$DESCRIPTION\" \\\n      io.k8s.display-name=\"PostgreSQL $POSTGRESQL_VERSION\" \\\n      io.openshift.expose-services=\"5432:postgresql\" \\\n      io.openshift.tags=\"database,postgresql,postgresql$POSTGRESQL_VERSION,rh-postgresql$POSTGRESQL_VERSION,postgis,postgis$POSTGISV\" \\\n      name=\"rhscl/postgresql-$POSTGRESQL_VERSION-rhel7\" \\\n      com.redhat.component=\"rh-postgresql$POSTGRESQL_VERSION-container\" \\\n      version=\"1\" \\\n      release=\"1\" \\\n      com.redhat.license_terms=\"https://www.redhat.com/en/about/red-hat-end-user-license-agreements#rhel\" \\\n      usage=\"podman run -d --name postgresql_database -e POSTGRESQL_USER=user -e POSTGRESQL_PASSWORD=pass -e POSTGRESQL_DATABASE=db -p 5432:5432 rhscl/postgresql-$POSTGRESQL_VERSION-rhel7\" \\\n      maintainer=\"SoftwareCollections.org <sclorg@redhat.com>\"\n\nCOPY root/usr/libexec/fix-permissions /usr/libexec/fix-permissions\n\n# Copy entitlements and subscription manager configurations\n# https://github.com/BCDevOps/OpenShift4-Migration/issues/15\nCOPY ./etc-pki-entitlement /etc/pki/entitlement\nCOPY ./rhsm-conf /etc/rhsm\nCOPY ./rhsm-ca /etc/rhsm/ca\n\n# This image must forever use UID 26 for postgres user so our volumes are\n# safe in the future. This should *never* change, the last test is there\n# to make sure of that.\n# rhel-7-server-ose-3.2-rpms is enabled for nss_wrapper until this pkg is\n# in base RHEL\n#\n# We need to call 2 (!) yum commands before being able to enable repositories properly\n# This is a workaround for https://bugzilla.redhat.com/show_bug.cgi?id=1479388\n# Initialize /etc/yum.repos.d/redhat.repo\n# See https://access.redhat.com/solutions/1443553\nRUN rm /etc/rhsm-host && \\\n    yum repolist > /dev/null && \\\n    yum install -y yum-utils gettext && \\\n    yum-config-manager --disable \\* & rm -rf /var/cache/yum > /dev/null && \\\n    yum-config-manager --enable rhel-server-rhscl-7-rpms && \\\n    yum-config-manager --enable rhel-7-server-rpms && \\\n    yum-config-manager --enable rhel-7-server-optional-rpms && \\\n    INSTALL_PKGS=\"rsync tar gettext bind-utils nss_wrapper\" && \\\n    INSTALL_PKGS=\"$INSTALL_PKGS rh-postgresql$POSTGRESQL_VERSION-pgaudit\" && \\\n    yum -y --setopt=tsflags=nodocs install $INSTALL_PKGS && \\\n    rpm -V $INSTALL_PKGS && \\\n    yum -y clean all --enablerepo='*' && \\\n    ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone && \\\n    localedef -f UTF-8 -i en_US en_US.UTF-8 && \\\n    test \"$(id postgres)\" = \"uid=26(postgres) gid=26(postgres) groups=26(postgres)\" && \\\n    mkdir -p /var/lib/pgsql/data && \\\n    /usr/libexec/fix-permissions /var/lib/pgsql /var/run/postgresql\n\nRUN touch /etc/yum/pluginconf.d/rhnplugin.conf && \\\n    echo  exclude=postgresql* >> /etc/yum/pluginconf.d/rhnplugin.conf   \n\nRUN bash /usr/libexec/fix-permissions /var/run/postgresql\n\n# Get prefix path and path to scripts rather than hard-code them in scripts\nENV CONTAINER_SCRIPTS_PATH=/usr/share/container-scripts/postgresql \\\n    ENABLED_COLLECTIONS=rh-postgresql12\n\n# When bash is started non-interactively, to run a shell script, for example it\n# looks for this variable and source the content of this file. This will enable\n# the SCL for all scripts without need to do 'scl enable'.\nENV BASH_ENV=${CONTAINER_SCRIPTS_PATH}/scl_enable \\\n    ENV=${CONTAINER_SCRIPTS_PATH}/scl_enable \\\n    PROMPT_COMMAND=\". ${CONTAINER_SCRIPTS_PATH}/scl_enable\"\n\nVOLUME [\"/var/lib/pgsql/data\", \"/var/run/postgresql\"]\n\nCOPY root /\nENV PGCONFIG /opt/rh/rh-postgresql12/root/usr/bin\nENV PATH /opt/rh/rh-postgresql12/root/usr/bin/:/usr/bin/:${PATH}\n\n# Aquire and build PostGIS 3.1, for PostgreSQL 12.x\nRUN cd /tmp && \\\n    rpm -ivh https://download.postgresql.org/pub/repos/yum/reporpms/EL-6-x86_64/pgdg-redhat-repo-latest.noarch.rpm && \\\n    yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm && rm -rf /var/cache/yum\n\nRUN yum install -y postgis31_12 postgis31_12-client pgrouting_12 && rm -rf /var/cache/yum\n\nRUN /usr/bin/install -c -m 755  /usr/pgsql-12/lib/postgis* '/opt/rh/rh-postgresql12/root/usr/lib64/pgsql/' && \\\n    /usr/bin/install -c -m 755  /usr/pgsql-12/lib/libpgrouting* '/opt/rh/rh-postgresql12/root/usr/lib64/pgsql/' && \\\n    /usr/bin/install -c -m 755  /usr/pgsql-12/lib/pgcrypto* '/opt/rh/rh-postgresql12/root/usr/lib64/pgsql/' && \\\n    /usr/bin/install -c -m 755  /usr/pgsql-12/lib/fuzzystrmatch* '/opt/rh/rh-postgresql12/root/usr/lib64/pgsql/' && \\    \n    /usr/bin/install -c -m 644 /usr/pgsql-12/share/extension/postgis* '/opt/rh/rh-postgresql12/root/usr/share/pgsql/extension/' && \\\n    /usr/bin/install -c -m 644 /usr/pgsql-12/share/extension/pgrouting* '/opt/rh/rh-postgresql12/root/usr/share/pgsql/extension/' && \\\n    /usr/bin/install -c -m 644 /usr/pgsql-12/share/extension/pgcrypto* '/opt/rh/rh-postgresql12/root/usr/share/pgsql/extension/' && \\\n    /usr/bin/install -c -m 644 /usr/pgsql-12/share/extension/fuzzystrmatch* '/opt/rh/rh-postgresql12/root/usr/share/pgsql/extension/' && \\\n    mv /usr/pgsql-12/share/contrib/postgis-3.1/ /opt/rh/rh-postgresql12/root/usr/share/pgsql/contrib/\n\nRUN rm -rf /tmp/pgdg-redhat-repo-latest.noarch.rpm /var/cache/yum\n\n# Remove entitlements and Subscription Manager configs\nRUN rm -rf /etc/pki/entitlement && \\\n    rm -rf /etc/rhsm\n\nRUN bash /usr/libexec/fix-permissions /var/lib/pgsql\n\nUSER 26\n\nEXPOSE ${PORT}\n\nENTRYPOINT [\"/usr/bin/container-entrypoint\"]\nCMD [\"/usr/bin/run-postgresql\"]"
}