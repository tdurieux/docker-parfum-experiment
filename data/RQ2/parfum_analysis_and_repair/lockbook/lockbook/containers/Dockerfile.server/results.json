{
  "startTime": 1674248190873,
  "endTime": 1674248192628,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 108
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG HASH\nFROM rust:1.59 AS server-build\nRUN rustup component add rustfmt\nRUN rustup component add clippy\n\nWORKDIR server\n\n# Server depends on core via a relative import\nCOPY core/Cargo.toml /core/Cargo.toml\nCOPY core/libs/models/Cargo.toml /core/libs/models/Cargo.toml\nCOPY core/libs/crypto/Cargo.toml /core/libs/crypto/Cargo.toml\n\n# Required to get cargo to get and compile deps but not our source\n# https://blog.mgattozzi.dev/caching-rust-docker-builds/\nCOPY containers/dummy.rs /core/src/lib.rs\nCOPY containers/dummy.rs /core/libs/models/src/lib.rs\nCOPY containers/dummy.rs /core/libs/crypto/src/lib.rs\n\nCOPY containers/dummy.rs src/main.rs\nCOPY containers/dummy.rs src/lib.rs\nCOPY server/server/Cargo.toml .\nCOPY server/server/build.rs .\nCOPY rustfmt.toml .\n\nRUN curl -f -L https://github.com/stripe/stripe-cli/releases/download/v1.7.13/stripe_1.7.13_linux_x86_64.tar.gz | tar -xz -C /usr/bin\n\n# Dependency on core which has compile-time env var\nENV API_URL=unused\nRUN cargo test --release # test to pickup dev deps\n\n# Build our source\nCOPY server/server .\nCOPY core /core\n\n# Cargo thinks this file hasn't changed on the filesystem\nRUN touch src/main.rs\nRUN touch /core/src/lib.rs\nRUN touch /core/libs/models/src/lib.rs\nRUN touch /core/libs/crypto/src/lib.rs\nRUN cargo build --release\n\n# Check formatting\nFROM server:${HASH} AS server-fmt\nRUN cargo fmt -- --check -l\n\n# Check lint\nFROM server:${HASH} AS server-lint\nRUN cargo clippy -- -D warnings\nRUN cargo clippy --tests -- -D warnings\n"
}