{
  "startTime": 1674251707358,
  "endTime": 1674251708434,
  "originalSmells": [
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 5,
        "lineEnd": 5,
        "columnStart": 18,
        "columnEnd": 41
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM alpine:3.15.4 AS base\n\nFROM base AS build\nRUN apk update && apk add --no-cache alpine-sdk sudo\nRUN adduser -Dh /nsbuild nsbuild && \\\n    adduser nsbuild abuild && \\\n    echo 'nsbuild ALL=(ALL) NOPASSWD: ALL' > /etc/sudoers.d/nsbuild\n\nUSER nsbuild\nRUN mkdir -p /nsbuild/src/main /nsbuild/packages/main && \\\n    abuild-keygen -ain\n\nFROM build AS build-wine\nCOPY --chown=nsbuild:nsbuild ./wine/ /nsbuild/src/main/wine/\nRUN ulimit -n 1024; cd /nsbuild/src/main/wine && abuild -r\n\nFROM build AS build-northstar\nCOPY --chown=nsbuild:nsbuild ./northstar/ /nsbuild/src/main/northstar/\nRUN ulimit -n 1024; cd /nsbuild/src/main/northstar && abuild -r\n\nFROM build AS build-nswrap\nCOPY --chown=nsbuild:nsbuild ./nswrap/ /nsbuild/src/main/nswrap/\nRUN ulimit -n 1024; cd /nsbuild/src/main/nswrap && abuild -r\n\nFROM build AS build-entrypoint\nCOPY --chown=nsbuild:nsbuild ./entrypoint/ /nsbuild/src/main/entrypoint/\nRUN ulimit -n 1024; cd /nsbuild/src/main/entrypoint && abuild -r\n\nFROM base\nRUN apk add --no-cache gnutls tzdata ca-certificates sudo\nRUN --mount=from=build-wine,source=/nsbuild/packages/main/x86_64,target=/nsbuild/wine \\\n    apk add --no-cache --allow-untrusted /nsbuild/wine/northstar-dedicated-wine-[0-9]*-r*.apk xvfb\nRUN --mount=from=build-northstar,source=/nsbuild/packages/main/x86_64,target=/nsbuild/northstar \\\n    apk add --no-cache --allow-untrusted /nsbuild/northstar/*.apk\nRUN --mount=from=build-nswrap,source=/nsbuild/packages/main/x86_64,target=/nsbuild/nswrap \\\n    --mount=from=build-entrypoint,source=/nsbuild/packages/main/x86_64,target=/nsbuild/entrypoint \\\n    apk add --no-cache --allow-untrusted /nsbuild/nswrap/*.apk /nsbuild/entrypoint/*.apk\n\n# silence Xvfb xkbcomp warnings by working around the bug (present in libX11 1.7.2) fixed in libX11 1.8 by https://gitlab.freedesktop.org/xorg/lib/libx11/-/merge_requests/79\nRUN echo 'partial xkb_symbols \"evdev\" {};' > /usr/share/X11/xkb/symbols/inet\n\nRUN adduser -D northstar && \\\n    echo 'northstar ALL=(ALL) NOPASSWD: ALL' > /etc/sudoers.d/northstar && \\\n    mkdir /mnt/titanfall /mnt/mods /mnt/navs\nUSER northstar\n\nENV WINEPREFIX=\"/home/northstar/.wine\"\nRUN /usr/bin/nswrap-wineprefix && \\\n    for x in \\\n        /home/northstar/.wine/drive_c/\"Program Files\"/\"Common Files\"/System/*/* \\\n        /home/northstar/.wine/drive_c/windows/* \\\n        /home/northstar/.wine/drive_c/windows/system32/* \\\n        /home/northstar/.wine/drive_c/windows/system32/drivers/* \\\n        /home/northstar/.wine/drive_c/windows/system32/wbem/* \\\n        /home/northstar/.wine/drive_c/windows/system32/spool/drivers/x64/*/* \\\n        /home/northstar/.wine/drive_c/windows/system32/Speech/common/* \\\n        /home/northstar/.wine/drive_c/windows/winsxs/*/* \\\n    ; do \\\n        orig=\"/usr/lib/wine/x86_64-windows/$(basename \"$x\")\"; \\\n        if cmp -s \"$orig\" \"$x\"; then ln -sf \"$orig\" \"$x\"; fi; \\\n    done && \\\n    for x in \\\n        /home/northstar/.wine/drive_c/windows/globalization/sorting/*.nls \\\n        /home/northstar/.wine/drive_c/windows/system32/*.nls \\\n    ; do \\\n        orig=\"/usr/share/wine/nls/$(basename \"$x\")\"; \\\n        if cmp -s \"$orig\" \"$x\"; then ln -sf \"$orig\" \"$x\"; fi; \\\n    done\nEXPOSE 8081/tcp\nEXPOSE 37015/udp\nENTRYPOINT [\"/usr/libexec/nsdedi\"]\n"
}