{
  "startTime": 1674247063451,
  "endTime": 1674247066420,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 81,
        "lineEnd": 81,
        "columnStart": 4,
        "columnEnd": 25
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Step1 - nodejs binaries\nFROM node:8.11.4-alpine AS nodebase\n\n# Step2 - openjdk base image\nFROM onesaitplatform/baseimage:latest\n\n# Metadata\nLABEL module.maintainer=\"onesaitplatform@indra.es\" \\\n\t  module.name=\"flowengine\"\n\n#HZ_SERVICE_DISCOVERY_STRATEGY can take values: service or zookeeper\n\nENV ASPECTJ_VERSION 1.8.9\n\nENV JAVA_OPTS=\"$JAVA_OPTS -Xms1G -Xmx2G -javaagent:/usr/local/aspectjweaver-$ASPECTJ_VERSION.jar\" \\\n\tSERVERNAME=localhost \\\n\tPROTOCOL=https \\\n    REALTIMEDBSERVERS=realtimedb:27017 \\\n\t\tCONFIGDBMASTERURL=\"jdbc:mysql://configdb:3306/onesaitplatform_master_config?useUnicode=true&characterEncoding=UTF-8&allowMultiQueries=true&useSSL=false&autoReconnect=true\" \\\n\t\tCONFIGDBURL=\"jdbc:mysql://configdb:3306/onesaitplatform_config?useUnicode=true&characterEncoding=UTF-8&allowMultiQueries=true&useSSL=false&autoReconnect=true&nullDatabaseMeansCurrent=true\" \\\n    CONFIGDBUSER=root \\\n    CONFIGDBPASS=changeIt! \\\n    CONFIGDB_MAX_ACTIVE=2 \\\n    CONFIGDB_MAX_IDLE=2 \\\n    JDBCPROTOCOL=\"jdbc:mysql:\" \\\n    DBADDPROPS=\"\" \\\n    ELASTICDBHOST=elasticdb \\\n    ELASTICDBPORT=9200 \\\n    AUDITGLOBALNOTIFY=true \\\n    QUASARHOST=quasar \\\n    QUASARPORT=10800 \\\n    HZ_SERVICE_DISCOVERY_STRATEGY=service \\\n    HZ_ZOOKEEPER_URL=zookeeper:2181 \\\n    REALTIMEDBNAME=onesaitplatform_rtdb \\\n    ENABLE_NODERED_LOG=true \\\n    NODERED_LOG_PATH=/var/log/platform-logs \\\n    NODERED_LOG_RETAIN_DAYS=5 \\\n    HTTPREQUESTTIMEOUT=20000 \\\n    SOCKETTIMEOUT=22000 \\\n    GRAYLOG_ENABLED=false \\\n    GRAYLOG_HOST=log-centralizer \\\n    GRAYLOG_PORT=12201 \\\n\tSBA_USERNAME=operations \\\n\tSBA_SECRET=changeIt2019!\n\nCOPY --from=nodebase /usr/local/bin/node /bin\n\n# Download tzdata for Timezone support and aspectj library\nRUN apk add --no-cache \\\n    tzdata \\ \n    npm \\\n    python \\\n    build-base \\\n    libexecinfo-dev \\\n    libc6-compat \\\n    git \\\n    openssh\n\nRUN mkdir -p /opt/nodeRed && \\\n\tmkdir -p /tmp/logs/flowEngine && \\\n    mkdir -p /var/log/platform-logs && \\\n\tmkdir ./target && \\\n    cd /usr/local && \\\n    wget https://repo1.maven.org/maven2/org/aspectj/aspectjweaver/$ASPECTJ_VERSION/aspectjweaver-$ASPECTJ_VERSION.jar\n\nADD *-exec.jar app.jar\nADD Flow-Engine-Manager /opt/nodeRed/Flow-Engine-Manager\n\n# create onesait user/group\nRUN addgroup -S onesait -g 433 && adduser -u 431 -S -g onesait -h /usr/local -s /sbin/nologin onesait\n\nRUN chown -R onesait:onesait /usr/local && \\\n    chown -R onesait:onesait /var/log/platform-logs && \\\n    chown -R onesait:onesait ./target && \\\n    chown -R onesait:onesait /opt/nodeRed && \\\n    chown onesait:onesait app.jar && \\\n    chmod -R 777 ./target && \\\n    chmod -R 777 /var/log && \\\n    chmod -R 777 /usr/local && \\\n    chmod -R 777 /opt/nodeRed &&\\\n    cd /opt/nodeRed/Flow-Engine-Manager && \\\n    npm i appmetrics-dash && npm cache clean --force;\n\nVOLUME [\"/tmp\", \"/var/log/platform-logs\"]\n\n\nEXPOSE 10000 20100 5050\n\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN chmod 775 /usr/local/bin/docker-entrypoint.sh\n\nUSER onesait\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\n"
}