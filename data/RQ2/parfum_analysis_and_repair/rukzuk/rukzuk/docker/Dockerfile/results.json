{
  "startTime": 1674255327806,
  "endTime": 1674255329644,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 141,
        "lineEnd": 141,
        "columnStart": 4,
        "columnEnd": 148
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 141,
        "lineEnd": 141,
        "columnStart": 14,
        "columnEnd": 80
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 203,
        "lineEnd": 203,
        "columnStart": 4,
        "columnEnd": 121
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 203,
        "lineEnd": 203,
        "columnStart": 14,
        "columnEnd": 83
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 210,
        "lineEnd": 210,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 70,
        "lineEnd": 70,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 100,
        "lineEnd": 103,
        "columnStart": 1,
        "columnEnd": 2
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 16,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 12
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 38,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 56,
        "lineEnd": 61,
        "columnStart": 4,
        "columnEnd": 16
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 70,
        "lineEnd": 70,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 185,
        "lineEnd": 191,
        "columnStart": 4,
        "columnEnd": 13
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 16,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 12
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 38,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 56,
        "lineEnd": 61,
        "columnStart": 4,
        "columnEnd": 16
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 70,
        "lineEnd": 70,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 100,
        "lineEnd": 103,
        "columnStart": 1,
        "columnEnd": 2
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 185,
        "lineEnd": 191,
        "columnStart": 4,
        "columnEnd": 13
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 16,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 12
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 38,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 56,
        "lineEnd": 61,
        "columnStart": 4,
        "columnEnd": 16
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 70,
        "lineEnd": 70,
        "columnStart": 4,
        "columnEnd": 60
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 185,
        "lineEnd": 191,
        "columnStart": 4,
        "columnEnd": 13
      }
    }
  ],
  "repairedDockerfile": "# based on ubuntu 18.04 (bionic)\nFROM phusion/baseimage:0.11\n\nVOLUME /srv/rukzuk/htdocs/cms\n\n# proposed breaks some php packages (e.g. php-intl)\nRUN rm -rf /etc/apt/sources.list.d/proposed.list\n\n# phusion/baseimage is not always up to date. :-(\nRUN apt-get update  && \\\n    apt-get dist-upgrade -y --no-install-recommends\n\n# Set Timezone\nRUN echo \"Europe/Berlin\" > /etc/timezone\n\n# Install Depencies\nRUN apt-get install -y --no-install-recommends \\\n        tzdata \\\n        sudo && rm -rf /var/lib/apt/lists/*;\n\nRUN dpkg-reconfigure --frontend noninteractive tzdata\n\n# Make Debian/Ubuntu and Docker friends\nENV DEBIAN_FRONTEND noninteractive\n\n# install phantomjs\nRUN apt-get install -y --no-install-recommends phantomjs && rm -rf /var/lib/apt/lists/*;\n\n# PhantomJS Offscreen wrapper\nCOPY phantomjs-offscreen /usr/local/bin/phantomjs\nRUN chmod +x /usr/local/bin/phantomjs\n\n# add php source list\nRUN apt-get install -y --no-install-recommends software-properties-common && \\\n    add-apt-repository ppa:ondrej/php && \\\n    apt-get update && rm -rf /var/lib/apt/lists/*;\n\n# Install Apache httpd\nRUN apt-get install -y --no-install-recommends \\\n        sqlite3 \\\n        apache2 \\\n        libapache2-mod-php7.3 \\\n        msmtp \\\n        msmtp-mta \\\n        php7.3 \\\n\n        php7.3-mysql \\\n        php7.3-cli \\\n        php7.3-curl \\\n        php7.3-gd \\\n        php7.3-intl \\\n        php7.3-xml \\\n        php7.3-zip \\\n        php7.3-mbstring && rm -rf /var/lib/apt/lists/*;\n\n# dev/build stuff (pecl for mcrypt and v8js)\nRUN apt-get install -y --no-install-recommends \\\n        build-essential \\\n        libmcrypt-dev \\\n        libmcrypt4 \\\n        php7.3-dev \\\n        php-pear && rm -rf /var/lib/apt/lists/*;\n\n# install mcrypt (now pecl) DISABLED because it is deprecated\n#RUN sudo CFLAGS=-w CPPFLAGS=-w pecl install mcrypt\n#RUN echo \"extension = mcrypt.so\" | sudo tee -a /etc/php/7.3/mods-available/mcrypt.ini\n#RUN phpenmod mcrypt\n\n# lib v8\nRUN add-apt-repository ppa:stesie/libv8 && apt-get update\nRUN apt-get install --no-install-recommends -y libv8-7.5-dev && rm -rf /var/lib/apt/lists/*;\n\nRUN echo \"/opt/libv8-7.5/lib\" | sudo tee -a /etc/ld.so.conf.d/libv8.conf\nRUN ldconfig\n\nRUN printf \"\\/opt/libv8-7.5\\n\" | sudo CFLAGS=-w CPPFLAGS=-w pecl install v8js-2.1.1\nRUN echo \"extension = v8js.so\" | sudo tee -a /etc/php/7.3/mods-available/v8js.ini\n\n# Activate PHP mods\nRUN phpenmod v8js\n\n# Activate Apache mods\nRUN a2enmod ssl && \\\n    a2enmod rewrite\n\n# Install mysql\nRUN apt-get install -y --no-install-recommends mariadb-server && rm -rf /var/lib/apt/lists/*;\n\n# major version update if\nENV MARIADB_MAJOR 10.1\n\n## based on https://github.com/docker-library/mariadb/blob/master/10.1/Dockerfile#L90\n# the \"/var/lib/mysql\" stuff here is because the mysql-server postinst doesn't have an explicit way to disable the mysql_install_db codepath besides having a database already \"configured\" (ie, stuff in /var/lib/mysql/mysql)\n# also, we set debconf keys to make APT a little quieter\nRUN set -ex; \\\n\t{ \\\n\t\techo \"mariadb-server-$MARIADB_MAJOR\" mysql-server/root_password password 'unused'; \\\n\t\techo \"mariadb-server-$MARIADB_MAJOR\" mysql-server/root_password_again password 'unused'; \\\n\t} | debconf-set-selections; \\\n\tapt-get update; \\\n\tapt-get install --no-install-recommends -y \\\n\t\t\"mariadb-server\" \\\n\t\tsocat \\\n\t; rm -rf /var/lib/apt/lists/*; \\\n#\trm -rf /var/lib/apt/lists/*; \\\n# comment out any \"user\" entires in the MySQL config (\"docker-entrypoint.sh\" or \"--user\" will handle user switching)\n\tsed -ri 's/^user\\s/#&/' /etc/mysql/my.cnf /etc/mysql/conf.d/*; \\\n# purge and re-create /var/lib/mysql with appropriate ownership\n\trm -rf /var/lib/mysql; \\\n\tmkdir -p /var/lib/mysql /var/run/mysqld; \\\n\tchown -R mysql:mysql /var/lib/mysql /var/run/mysqld; \\\n# ensure that /var/run/mysqld (used for socket and lock files) is writable regardless of the UID our mysqld instance ends up having at runtime\n\tchmod 777 /var/run/mysqld; \\\n# comment out a few problematic configuration values\n\tfind /etc/mysql/ -name '*.cnf' -print0 \\\n\t\t| xargs -0 grep -lZE '^(bind-address|log)' \\\n\t\t| xargs -rt -0 sed -Ei 's/^(bind-address|log)/#&/'; \\\n# don't reverse lookup hostnames, they are usually another container; fix log size\n\techo '[mysqld]\\nskip-host-cache\\nskip-name-resolve\\ninnodb_log_file_size=128M\\ninnodb_buffer_pool_size=512M' > /etc/mysql/conf.d/docker.cnf\n\nVOLUME /var/lib/mysql\n\n# Activate mysql in runit\nRUN mkdir -p /etc/service/mysqld\nCOPY mysqld.runit /etc/service/mysqld/run\nRUN chmod +x /etc/service/mysqld/run\n\n\n# Activate apache2 in runit\nRUN mkdir -p /etc/service/apache2\nCOPY apache2.runit /etc/service/apache2/run\nRUN chmod +x /etc/service/apache2/run\n\n# Create folder\nENV CMS_PATH /opt/rukzuk/htdocs\nENV INSTANCE_PATH /srv/rukzuk\nRUN mkdir -p ${CMS_PATH}\nRUN mkdir -p ${INSTANCE_PATH}/htdocs/cms\nRUN chown -R www-data:www-data ${INSTANCE_PATH}/htdocs\n\n# Install latest github release\nRUN curl -f -L $( curl -f -s https://api.github.com/repos/rukzuk/rukzuk/releases/latest | grep browser_download_url | grep 'tgz\\|tar.gz' | cut -d '\"' -f 4) | tar -xz --strip 1 -C ${CMS_PATH}/..\n\nRUN ln -s ${CMS_PATH}/app/server/environment ${INSTANCE_PATH}/environment\nRUN ln -s ${CMS_PATH} ${INSTANCE_PATH}/application\n\n# rukzuk env config (for init script)\nENV APPLICATION_ENV standalone\n\n## sqlite (disabled)\n#  ENV CMS_DB_TYPE=sqlite\n#  ENV CMS_SQLITE_DB ${INSTANCE_PATH}/htdocs/cms/db.sqlite3\n#  COPY config_sqlite.php ${INSTANCE_PATH}/config.php\n\n## mysql\nENV CMS_DB_TYPE=mysql\nENV CMS_MYSQL_USER=rukzuk\nENV CMS_MYSQL_PASSWORD=rukzuk\nENV CMS_MYSQL_DB=rukzuk\nCOPY config_mysql.php ${INSTANCE_PATH}/config.php\n\nCOPY cms.apache /etc/apache2/sites-available/000-default.conf\nCOPY msmtprc.tpl /etc/msmtprc.tpl\nCOPY root-my-cnf.tpl /etc/root-my-cnf.tpl\n\n# my init scripts (run before any runit services)\nRUN mkdir -p /etc/my_init.d\nCOPY mysql_start.sh     /etc/my_init.d/20-mysql_start.sh\nRUN chmod +x            /etc/my_init.d/20-mysql_start.sh\nCOPY mysql_conf_user.sh /etc/my_init.d/21-mysql_conf_user.sh\nRUN chmod +x            /etc/my_init.d/21-mysql_conf_user.sh\nCOPY init.sh            /etc/my_init.d/30-rukzuk_init.sh\nRUN chmod +x            /etc/my_init.d/30-rukzuk_init.sh\nCOPY mysql_end.sh       /etc/my_init.d/40-mysql_end.sh\nRUN chmod +x            /etc/my_init.d/40-mysql_end.sh\n\n# tool scripts\nRUN mkdir -p /opt/rukzuk-tools/\nCOPY import-metajson.php /opt/rukzuk-tools/import-metajson.php\nCOPY import-data.sh      /opt/rukzuk-tools/import-data.sh\nRUN chmod +x             /opt/rukzuk-tools/import-data.sh\n\n## Publisher\n\n# install phyton and pip\nRUN apt-get install -y --no-install-recommends \\\n        build-essential \\\n        python3 \\\n        python3-dev \\\n        python3-pip \\\n        python3-setuptools \\\n        redis && rm -rf /var/lib/apt/lists/*;\n\n# Add users and folders\nRUN useradd -s /bin/bash -d /opt/publisher publisher\nRUN mkdir -p /var/log/publisher\nRUN chown publisher /var/log/publisher\nRUN mkdir -p /var/tmp/publisher\nRUN chown publisher /var/tmp/publisher\n\n# copy code\nRUN mkdir -p /opt/publisher\n# get latest publisher release form github and extract it\nRUN curl -f -L $( curl -f -s https://api.github.com/repos/rukzuk/publisher/releases/latest | grep tarball_url | cut -d '\"' -f 4) | tar -xz --strip 1 -C /opt/publisher\n# remove dev config file\nRUN rm /opt/publisher/settings-dev.ini 2>/dev/null\n# fix rights\nRUN chown -R publisher /opt/publisher\n\n# install requirements\nRUN pip3 install --no-cache-dir -r /opt/publisher/requirements.txt\n\n# Activate services in runit\nRUN mkdir -p /etc/service/supervisord\nRUN cp /opt/publisher/conf/supervisord.runit /etc/service/supervisord/run\nRUN chmod +x /etc/service/supervisord/run\n\nRUN mkdir -p /etc/service/redis\nRUN cp /opt/publisher/conf/redis.runit /etc/service/redis/run\nRUN chmod +x /etc/service/redis/run\n\n### End Publisher\n\n\n# Remove unused packages (only used to build)  & Cleanup\nRUN apt-get purge -y php7.3-dev libmcrypt-dev php-pear build-essential\nRUN apt-get clean -y\nRUN apt-get autoremove -y\nRUN rm -rf /var/lib/apt/lists/*\n\nEXPOSE 80\n\n"
}