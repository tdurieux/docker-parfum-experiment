{
  "startTime": 1674249062188,
  "endTime": 1674249062796,
  "originalSmells": [
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 4,
        "lineEnd": 16,
        "columnStart": 22,
        "columnEnd": 8
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# the default php images from docker are werid...\nFROM debian:buster-slim\n\n# install apache, php, and mariadb (mysql)\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n    apache2 \\\n    php \\\n    php-mysql \\\n    php-mbstring \\\n    php-gd php-xml \\\n    mariadb-server \\\n    make \\\n    python \\\n    vim \\\n    mg \\\n    git \\\n    curl && rm -rf /var/lib/apt/lists/*;\n\n# rm any files/folders created by apcahe\nRUN rm -rvf /var/www/html/*\n\n# use older broken utf8 implementation, we need to fix this\nRUN sed -i -e 's/character-set-server \\+= utf8mb4/character-set-server = utf8/' -e 's/collation-server/#collation-server/' /etc/mysql/mariadb.conf.d/50-server.cnf\n\nADD . /var/www/html/\nWORKDIR /var/www/html/\nRUN cd /var/www/html/; make patches; make css\nRUN mkdir -p /var/local/alloc/; chown www-data /var/local/alloc/\n\nRUN echo '\\\nUPDATE config SET value = \"USD\" WHERE name = \"currency\"; \\n\\\nUPDATE currencyType SET currencyTypeActive = true, currencyTypeSeq = 1 WHERE currencyTypeID = \"USD\"; \\n\\\nDELETE FROM exchangeRate; \\n\\\nINSERT INTO exchangeRate (exchangeRateCreatedDate,exchangeRateCreatedTime,fromCurrency,toCurrency,exchangeRate) VALUES (\"2020-03-23\",\"2020-03-23 01:07:06\",\"USD\",\"USD\",1); \\n\\\nUPDATE config SET value = \"http://localhost/\" WHERE name = \"allocURL\"; \\n\\\nUPDATE person SET password = \"$2y$10$pyjwF/RYHZDMGgt19s6u8OUBWUAKyq7v9p1Ov.1Y5R/FvDKlcheWO\" WHERE personID = 1; \\n\\\nUPDATE person SET emailAddress = \"test@example.com\" WHERE personID = 1; \\n\\\nUPDATE config SET value = \"UTC\" WHERE name = \"allocTimezone\";' > /var/local/alloc/db_config.sql\nRUN cat /var/local/alloc/db_config.sql\n\nRUN echo '<?php\\n\\\ndefine(\"ALLOC_DB_NAME\",\"alloc\"); \\n\\\ndefine(\"ALLOC_DB_USER\",\"alloc\"); \\n\\\ndefine(\"ALLOC_DB_PASS\",\"changeme\"); \\n\\\ndefine(\"ALLOC_DB_HOST\",\"localhost\"); \\n\\\ndefine(\"ATTACHMENTS_DIR\",\"/var/local/alloc/\");' > /var/www/html/alloc_config.php\nRUN cat /var/www/html/alloc_config.php\n\nRUN /etc/init.d/mysql start && sleep 10 && pidof mysqld && \\\n  echo 'DROP DATABASE IF EXISTS alloc;'                        | mysql -u root && \\\n  echo 'CREATE DATABASE alloc;'                                | mysql -u root && \\\n  echo 'GRANT ALL ON alloc.* TO alloc@localhost IDENTIFIED BY \"changeme\";' | mysql -u root && \\\n  echo 'FLUSH PRIVILEGES;'                                     | mysql -u root && \\\n  echo 'SOURCE /var/www/html/installation/db_structure.sql;'   | mysql -u root alloc && \\\n  echo 'SOURCE /var/www/html/installation/db_patches.sql;'     | mysql -u root alloc && \\\n  echo 'SOURCE /var/www/html/installation/db_data.sql;'        | mysql -u root alloc && \\\n  echo 'SOURCE /var/www/html/installation/db_constraints.sql;' | mysql -u root alloc && \\\n  echo 'SOURCE /var/www/html/installation/db_triggers.sql;'    | mysql -u root alloc && \\\n  echo 'SOURCE /var/local/alloc/db_config.sql;'                | mysql -u root alloc\n\nRUN for i in task client project invoice comment backups whatsnew wiki logos search tmp; do \\\n  mkdir /var/local/alloc/${i} && \\\n  chmod 775 /var/local/alloc/${i} && \\\n  chgrp www-data /var/local/alloc/${i}; \\\ndone\n\n# follow the apache error log\nEXPOSE 80\nADD start.sh /\nCMD [\"/bin/bash\", \"/start.sh\"]\n"
}