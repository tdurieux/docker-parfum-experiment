{
  "startTime": 1674256248530,
  "endTime": 1674256249384,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 60
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG BASE_IMAGE='gamechanger/core/base-env:latest'\nFROM $BASE_IMAGE\n\n## shell for RUN cmd purposes\nSHELL [\"/bin/bash\", \"-c\"]\nUSER root\nARG TMP_BASE_DIR=\"/tmp/staging\"\n\n#####\n## ## StreamSets Setup\n#####\n\nRUN mkdir -p \"${TMP_BASE_DIR}\"\nARG STREAMSETS_TGZ_URL='https://archives.streamsets.com/datacollector/3.6.2/tarball/streamsets-datacollector-all-3.6.2.tgz'\nARG STREAMSETS_TGZ_PATH=\"${TMP_BASE_DIR}/streamsets.tgz\"\nARG STREAMSETS_UNPACKED_BASE_DIR=\"/opt/streamsets-datacollector-3.6.2\"\n\n# pull down the goods & extract at the home location\nRUN curl -f -kL -o \"$STREAMSETS_TGZ_PATH\" \"$STREAMSETS_TGZ_URL\" \\\n    && tar -xzf \"$STREAMSETS_TGZ_PATH\" -C \"/opt\" \\\n    && test -d \"$STREAMSETS_UNPACKED_BASE_DIR\" \\\n    && rm -f \"$STREAMSETS_TGZ_PATH\"\n\n# setup sdc user/group\nRUN useradd sdc && echo password | passwd --stdin sdc\n# non-login user, not as useful for debugging\n# RUN groupadd -r sdc && useradd -r -d \"$STREAMSETS_UNPACKED_BASE_DIR\" -g sdc -s /sbin/nologin sdc\n\n# some important streamsets env vars\nENV SDC_CONF=/etc/sdc\nENV SDC_HOME=\"$STREAMSETS_UNPACKED_BASE_DIR\"\nENV SDC_LOG=/var/log/sdc\nENV SDC_DATA=/var/lib/sdc\nENV SDC_RESOURCES=/var/lib/sdc-resources\n\n# create relevant directories\nRUN mkdir -p \"$SDC_LOG\" \\\n    && mkdir -p \"$SDC_CONF\" \\\n    && mkdir -p \"$SDC_DATA\" \\\n    && mkdir -p \"$SDC_RESOURCES\"\n\n# populate misc streamsets dirs & set permissions\nRUN cp -R \"$STREAMSETS_UNPACKED_BASE_DIR\"/etc/* \"$SDC_CONF\" \\\n    && chown -R sdc:sdc \"$SDC_LOG\" \\\n    && chown -R sdc:sdc \"$SDC_CONF\" \\\n    && chown -R sdc:sdc \"$SDC_DATA\" \\\n    && chown -R sdc:sdc \"$SDC_RESOURCES\" \\\n    && chown -R sdc:sdc \"$SDC_HOME\"\n\n#####\n## ## Misc Config  (placed later to avoid heavier layer rebuilds)\n#####\n\n# this doesn't matter since StreamSets tarball install includes ALL packages, but.. just in case, this fixes a cert bug\nRUN sed -i 's/run curl/run curl --insecure /g'  \"${SDC_HOME}/libexec/_stagelibs\"\n\n# run /bin/bash shell in executor stage by default\nRUN echo 'stage.conf_com.streamsets.pipeline.stage.executor.shell.shell=/bin/bash' >> \"${SDC_CONF}\"/sdc.properties\n\n# clean up\nRUN rm -rf \"$TMP_BASE_DIR\"\n\n#####\n## ## SDC user config\n#####\n\nENV SDC_USER_HOME='/home/sdc'\nENV DOCKER_ENTRYPOINT=\"/usr/local/bin/docker-entrypoint.sh\"\n\nCOPY ./dev/docker/devtools/streamsets/docker-entrypoint.sh \"$DOCKER_ENTRYPOINT\"\nRUN chmod a+x \"$DOCKER_ENTRYPOINT\"\n\n# grant sudo to sdc user\nRUN usermod -aG wheel sdc\n\n# run these cmds and entrypoint after as sdc user\nUSER sdc\n\nRUN echo insecure > \"$SDC_USER_HOME/.curlrc\"\n\n#####\n## ## START CONFIG\n#####\n\nEXPOSE 18630/tcp\n\nENTRYPOINT $DOCKER_ENTRYPOINT"
}