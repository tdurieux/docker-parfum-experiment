{
  "startTime": 1674248242602,
  "endTime": 1674248243416,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 63,
        "lineEnd": 73,
        "columnStart": 8,
        "columnEnd": 37
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG LEGATO_TARGET=\"virt-x86\"\nARG FLASH_FILE\nARG KERNEL_IMG=/data/kernel\nARG DTB_FILE=/data/target.dtb\nARG ROOTFS_IMG\nARG LEGATO_IMG\nARG USERFS_IMG\nARG QEMU_CONFIG=/data/qemu-config\nARG QEMU_CONFIG_JSON=/data/qemu.json\nARG QEMU_DIR=/opt/qemu\n\n# Build QEmu\nFROM alpine:3.10 AS build\nARG QEMU_DIR\n\n# Dependencies from https://git.alpinelinux.org/aports/tree/main/qemu/APKBUILD\nRUN ( \\\n        apk add --no-cache \\\n                alpine-sdk \\\n                alsa-lib-dev \\\n                bison \\\n                curl-dev \\\n                flex \\\n                glib-dev \\\n                glib-static \\\n                gnutls-dev \\\n                gtk+3.0-dev \\\n                libaio-dev \\\n                libcap-dev \\\n                libcap-ng-dev \\\n                dtc-dev \\\n                libjpeg-turbo-dev \\\n                libnfs-dev \\\n                libpng-dev \\\n                libseccomp-dev \\\n                libssh2-dev \\\n                libusb-dev \\\n                libxml2-dev \\\n                linux-headers \\\n                lzo-dev \\\n                ncurses-dev \\\n                paxmark \\\n                perl \\\n                python \\\n                python3 \\\n                py-sphinx \\\n                sdl2-dev \\\n                snappy-dev \\\n                spice-dev \\\n                texinfo \\\n                usbredir-dev \\\n                util-linux-dev \\\n                vde2-dev \\\n                virglrenderer-dev \\\n                vte3-dev \\\n                xfsprogs-dev \\\n                zlib-dev \\\n    )\n\nADD qemu/ /tmp/\n\nRUN ( cd /tmp/qemu/ && \\\n        ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=\"$QEMU_DIR\" \\\n                    --target-list=arm-softmmu \\\n                    --disable-tools \\\n                    --enable-modules \\\n                    --disable-glusterfs \\\n                    --disable-debug-info \\\n                    --disable-bsd-user \\\n                    --disable-werror \\\n                    --disable-sdl \\\n                    --disable-xen \\\n                    --cc=\"${CC:-gcc}\" && \\\n        make ARFLAGS=\"rc\" -j && \\\n        make install)\n\n# Runtime image\nFROM alpine:3.10 AS runtime\nARG LEGATO_TARGET\nARG FLASH_FILE\nARG KERNEL_IMG\nARG DTB_FILE\nARG ROOTFS_IMG\nARG LEGATO_IMG\nARG USERFS_IMG\nARG QEMU_CONFIG\nARG QEMU_CONFIG_JSON\nARG QEMU_DIR\n\n# Runtime Dependencies & tools\nRUN ( \\\n        apk add --no-cache \\\n                bash \\\n                jq \\\n                qemu-system-x86_64 \\\n                gtk+3.0 \\\n                libfdt \\\n                libnfs \\\n                libssh2 \\\n    )\n\nCOPY --from=build ${QEMU_DIR} ${QEMU_DIR}\n\nADD data /data/\n\nENV PID_FILE=/tmp/qemu.pid \\\n    DATA_DIR=/data \\\n    LEGATO_TARGET=$LEGATO_TARGET \\\n    FLASH_FILE=$FLASH_FILE \\\n    KERNEL_IMG=$KERNEL_IMG \\\n    DTB_FILE=$DTB_FILE \\\n    ROOTFS_IMG=$ROOTFS_IMG \\\n    LEGATO_IMG=$LEGATO_IMG \\\n    USERFS_IMG=$USERFS_IMG \\\n    QEMU_CONFIG=$QEMU_CONFIG \\\n    QEMU_CONFIG_JSON=$QEMU_CONFIG_JSON \\\n    QEMU_DIR=$QEMU_DIR \\\n    QEMU_PATH=$QEMU_DIR\n\n# No offset at the port level, so:\n# - telnet is available on 21\n# - SSH on 22\n# - simu control on 5000\nENV OFFSET_PORT 0\n\nVOLUME /data\n\nEXPOSE 21 \\\n       22 \\\n       5000 \\\n       8080 \\\n       8443\n\nENTRYPOINT [\"/data/legato-qemu\"]\n"
}