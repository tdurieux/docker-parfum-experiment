{
  "startTime": 1674248472674,
  "endTime": 1674248475672,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 223,
        "lineEnd": 223,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 223,
        "lineEnd": 223,
        "columnStart": 60,
        "columnEnd": 99
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 224,
        "lineEnd": 224,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 247,
        "lineEnd": 247,
        "columnStart": 4,
        "columnEnd": 81
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 306,
        "lineEnd": 306,
        "columnStart": 4,
        "columnEnd": 123
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 334,
        "lineEnd": 334,
        "columnStart": 4,
        "columnEnd": 91
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 339,
        "lineEnd": 339,
        "columnStart": 4,
        "columnEnd": 88
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 343,
        "lineEnd": 343,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 366,
        "lineEnd": 366,
        "columnStart": 4,
        "columnEnd": 70
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 401,
        "lineEnd": 401,
        "columnStart": 4,
        "columnEnd": 110
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 502,
        "lineEnd": 502,
        "columnStart": 53,
        "columnEnd": 77
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 223,
        "lineEnd": 223,
        "columnStart": 42,
        "columnEnd": 56
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ubuntu:20.04 as build-image\nARG TARGETARCH=amd64\nENV TARGETARCH \"${TARGETARCH}\"\n\nLABEL maintainer Netlify\n\n################################################################################\n#\n# Dependencies\n#\n################################################################################\n\nENV LANGUAGE en_US:en\nENV LANG en_US.UTF-8\nENV LC_ALL en_US.UTF-8\nENV PANDOC_VERSION 2.13\n\n# language export needed for ondrej/php PPA https://github.com/oerdnj/deb.sury.org/issues/56\nRUN export DEBIAN_FRONTEND=noninteractive && \\\n    apt-get -y update && \\\n    apt-get install -y --no-install-recommends software-properties-common language-pack-en-base apt-transport-https curl gnupg && \\\n    echo 'Acquire::Languages {\"none\";};' > /etc/apt/apt.conf.d/60language && \\\n    echo 'LANG=\"en_US.UTF-8\"' > /etc/default/locale && \\\n    echo 'LANGUAGE=\"en_US:en\"' >> /etc/default/locale && \\\n    locale-gen en_US.UTF-8 && \\\n    update-locale en_US.UTF-8 && \\\n    apt-key adv --fetch-keys https://packages.erlang-solutions.com/ubuntu/erlang_solutions.asc && \\\n    add-apt-repository -y ppa:ondrej/php && \\\n    add-apt-repository -y ppa:openjdk-r/ppa && \\\n    add-apt-repository -y ppa:git-core/ppa && \\\n    add-apt-repository -y ppa:deadsnakes/ppa && \\\n    apt-add-repository -y 'deb https://packages.erlang-solutions.com/ubuntu focal contrib' && \\\n    apt-get -y update && \\\n    apt-get install -y --no-install-recommends \\\n        advancecomp \\\n        apache2-utils \\\n        autoconf \\\n        automake \\\n        bison \\\n        build-essential \\\n        bzr \\\n        cmake \\\n        doxygen \\\n        elixir \\\n        emacs-nox \\\n        esl-erlang \\\n        expect \\\n        file \\\n        fontconfig \\\n        fontconfig-config \\\n        g++ \\\n        gawk \\\n        git \\\n        git-lfs \\\n        gifsicle \\\n        gobject-introspection \\\n        graphicsmagick \\\n        graphviz \\\n        gtk-doc-tools \\\n        gnupg2 \\\n        imagemagick \\\n        iptables \\\n        jpegoptim \\\n        jq \\\n        language-pack-ar \\\n        language-pack-ca \\\n        language-pack-cs \\\n        language-pack-da \\\n        language-pack-de \\\n        language-pack-el \\\n        language-pack-es \\\n        language-pack-eu \\\n        language-pack-fi \\\n        language-pack-fr \\\n        language-pack-gl \\\n        language-pack-he \\\n        language-pack-hi \\\n        language-pack-it \\\n        language-pack-ja \\\n        language-pack-ka \\\n        language-pack-ko \\\n        language-pack-nn \\\n        language-pack-pl \\\n        language-pack-pt \\\n        language-pack-ro \\\n        language-pack-ru \\\n        language-pack-sv \\\n        language-pack-ta \\\n        language-pack-th \\\n        language-pack-tr \\\n        language-pack-uk \\\n        language-pack-vi \\\n        language-pack-zh-hans \\\n        language-pack-zh-hant \\\n        libasound2 \\\n        libcurl4 \\\n        libcurl4-gnutls-dev \\\n        libenchant1c2a \\\n        libexif-dev \\\n        libffi-dev \\\n        libfontconfig1 \\\n        libgbm1 \\\n        libgconf-2-4 \\\n        libgd-dev \\\n        libgdbm-dev \\\n        libgif-dev \\\n        libglib2.0-dev \\\n        libgmp3-dev \\\n        libgsl23 \\\n        libgsl-dev \\\n        libgtk-3-0 \\\n        libgtk2.0-0 \\\n        libicu-dev \\\n        libimage-exiftool-perl \\\n        libjpeg-progs \\\n        libjpeg-turbo8-dev \\\n        libmagickwand-dev \\\n        libmcrypt-dev \\\n        libncurses5-dev \\\n        libnss3 \\\n        libpng-dev \\\n        libreadline6-dev \\\n        librsvg2-bin \\\n        libsm6 \\\n        libsqlite3-dev \\\n        libssl-dev \\\n        libtiff5-dev \\\n        libtool \\\n        libwebp-dev \\\n        libwebp6 \\\n        libxml2-dev \\\n        libxrender1 \\\n        libxslt-dev \\\n        libxss1 \\\n        libxtst6 \\\n        libvips-dev \\\n        libvips-tools \\\n        libyaml-dev \\\n        mercurial \\\n        nasm \\\n        openjdk-8-jdk \\\n        optipng \\\n        php7.4 \\\n        php7.4-xml \\\n        php7.4-mbstring \\\n        php7.4-gd \\\n        php7.4-sqlite3 \\\n        php7.4-curl \\\n        php7.4-zip \\\n        php7.4-intl \\\n        php8.0 \\\n        php8.0-xml \\\n        php8.0-mbstring \\\n        php8.0-gd \\\n        php8.0-sqlite3 \\\n        php8.0-curl \\\n        php8.0-zip \\\n        php8.0-intl \\\n        pngcrush \\\n        python-setuptools \\\n        python3-setuptools \\\n        python3.8-dev \\\n        rlwrap \\\n        rsync \\\n        software-properties-common \\\n        sqlite3 \\\n        ssh \\\n        strace \\\n        swig \\\n        tree \\\n        unzip \\\n        virtualenv \\\n        wget \\\n        xfonts-base \\\n        xfonts-75dpi \\\n        xvfb \\\n        zip \\\n        zstd \\\n# dotnet core dependencies\n\tlibunwind8-dev \\\n\tlibicu-dev \\\n\tliblttng-ust0 \\\n\tlibkrb5-3 \\\n        && \\\n    /var/lib/dpkg/info/ca-certificates-java.postinst configure && \\\n    apt-get clean && \\\n    rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* && \\\n    apt-get autoremove -y && \\\n    unset DEBIAN_FRONTEND\n\n################################################################################\n#\n# Pandoc & Wkhtmltopdf\n#\n################################################################################\n\nRUN wget -nv https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6-1/wkhtmltox_0.12.6-1.focal_$TARGETARCH.deb && \\\n    dpkg -i wkhtmltox_0.12.6-1.focal_$TARGETARCH.deb && \\\n    rm wkhtmltox_0.12.6-1.focal_$TARGETARCH.deb && \\\n    wkhtmltopdf -V\n\n# install Pandoc (more recent version to what is provided in Ubuntu 14.04)\nRUN wget https://github.com/jgm/pandoc/releases/download/$PANDOC_VERSION/pandoc-$PANDOC_VERSION-1-$TARGETARCH.deb && \\\n    dpkg -i pandoc-$PANDOC_VERSION-1-$TARGETARCH.deb && \\\n    rm pandoc-$PANDOC_VERSION-1-$TARGETARCH.deb && \\\n    pandoc -v\n\n################################################################################\n#\n# User\n#\n################################################################################\n\nRUN adduser --system --disabled-password --uid 2500 --group --quiet buildbot --home /opt/buildhome\n\n################################################################################\n#\n# Ruby\n#\n################################################################################\n\n## TODO: Consider switching to rbenv or asdf-vm\nUSER buildbot\nRUN curl -f -sSL https://rvm.io/mpapis.asc | gpg --batch --import - && curl -f -sSL https://rvm.io/pkuczynski.asc | gpg2 --import && \\\n    curl -f -sL https://get.rvm.io | bash -s stable --with-gems=\"bundler\" --autolibs=read-fail\n\nENV PATH /usr/local/rvm/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n\n# Match this set latest Stable releases we can support on https://www.ruby-lang.org/en/downloads/\nENV RUBY_VERSION=2.7.2\nENV RUBY_2_6_VERSION=2.6.6\n# Also preinstall Ruby 2.6, as many customers are pinned to it and installing is slow\nRUN /bin/bash -c \"source ~/.rvm/scripts/rvm && \\\n                  rvm install $RUBY_2_6_VERSION && rvm use $RUBY_2_6_VERSION && gem install bundler && \\\n                  rvm install $RUBY_VERSION && rvm use $RUBY_VERSION && gem install bundler && \\\n                  rvm use $RUBY_VERSION --default && rvm cleanup all\"\n\nENV PATH /usr/local/rvm/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nUSER root\n\n################################################################################\n#\n# Node.js\n#\n################################################################################\n\n\nRUN curl -f -o- -L https://yarnpkg.com/install.sh > /usr/local/bin/yarn-installer.sh\n\nENV NVM_VERSION=0.38.0\n\n# Install node.js, yarn, grunt, bower and elm\nUSER buildbot\nRUN git clone https://github.com/creationix/nvm.git ~/.nvm && \\\n    cd ~/.nvm && \\\n    git checkout v$NVM_VERSION && \\\n    cd /\n\nENV ELM_VERSION=0.19.1-5\nENV YARN_VERSION=1.22.10\n\nENV NETLIFY_NODE_VERSION=\"16\"\n\nRUN /bin/bash -c \". ~/.nvm/nvm.sh && \\\n         nvm install --no-progress $NETLIFY_NODE_VERSION && \\\n         npm install -g grunt-cli bower elm@$ELM_VERSION && \\\n             bash /usr/local/bin/yarn-installer.sh --version $YARN_VERSION && \\\n         nvm alias default node && nvm cache clear\"\nENV PATH \"/opt/buildhome/.yarn/bin:$PATH\"\n\nUSER root\n\n################################################################################\n#\n# Python\n#\n################################################################################\n\nENV PIPENV_RUNTIME 3.8\n\nUSER root\n\nUSER buildbot\n\nRUN virtualenv -p python2.7 /opt/buildhome/python2.7 && \\\n    /bin/bash -c 'source /opt/buildhome/python2.7/bin/activate' && \\\n    ln -nfs /opt/buildhome/python2.7 /opt/buildhome/python2.7.18\n\nRUN virtualenv -p python3.8 /opt/buildhome/python3.8 && \\\n    /bin/bash -c 'source /opt/buildhome/python3.8/bin/activate' && \\\n    ln -nfs /opt/buildhome/python3.8 /opt/buildhome/python3.8.10\n\nRUN /opt/buildhome/python${PIPENV_RUNTIME}/bin/pip install pipenv\n\nUSER root\n\n\n################################################################################\n#\n# Binrc\n#\n################################################################################\n\nENV BINRC_VERSION 0.2.9\n\nRUN mkdir /opt/binrc && cd /opt/binrc && \\\n    curl -f -sL https://github.com/netlify/binrc/releases/download/v${BINRC_VERSION}/binrc_${BINRC_VERSION}_Linux-64bit.tar.gz | tar zxvf - && \\\n    ln -s /opt/binrc/binrc_${BINRC_VERSION}_linux_${TARGETARCH}/binrc_${BINRC_VERSION}_linux_${TARGETARCH} /usr/local/bin/binrc\n\n# Create a place for binrc to link/persist installs to the PATH\nUSER buildbot\nRUN mkdir -p /opt/buildhome/.binrc/bin\nENV PATH \"/opt/buildhome/.binrc/bin:$PATH\"\n\nUSER root\n\n################################################################################\n#\n# Hugo\n#\n################################################################################\n\nENV HUGO_VERSION 0.85.0\n\nRUN binrc install gohugoio/hugo ${HUGO_VERSION} -c /opt/buildhome/.binrc | xargs -n 1 -I{} ln -s {} /usr/local/bin/hugo_${HUGO_VERSION} && \\\n    ln -s /usr/local/bin/hugo_${HUGO_VERSION} /usr/local/bin/hugo\n\n################################################################################\n#\n# Clojure\n#\n################################################################################\n\nRUN mkdir /opt/leiningen && cd /opt/leiningen && \\\n    curl -f -sL https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein > lein && \\\n    chmod +x lein && \\\n    ln -s /opt/leiningen/lein /usr/local/bin/lein\n\nRUN mkdir /opt/boot-clj && cd /opt/boot-clj && \\\n    curl -f -sL https://github.com/boot-clj/boot-bin/releases/download/2.5.2/boot.sh > boot && \\\n    chmod +x boot && \\\n    ln -s /opt/boot-clj/boot /usr/local/bin/boot\n\nRUN curl -f -sL https://download.clojure.org/install/linux-install-1.10.1.492.sh | bash\n\nUSER buildbot\n\nRUN lein\n\nRUN boot -u\n\n################################################################################\n#\n# Cask\n#\n################################################################################\nUSER buildbot\nRUN rm -rf /opt/buildhome/.cask && git clone https://github.com/cask/cask.git /opt/buildhome/.cask\nENV PATH \"$PATH:/opt/buildhome/.cask/bin\"\n\n###\n# LZ4 Compression\n###\n\nUSER root\nENV LZ4_VERSION 1.8.0\nRUN curl -f -sL https://github.com/lz4/lz4/archive/v${LZ4_VERSION}.tar.gz | tar xzvf - && \\\n    cd lz4-${LZ4_VERSION} && \\\n    make && \\\n    make install && \\\n    cd .. && rm -rf lz4-${LZ4_VERSION}\n\n################################################################################\n#\n# PHP\n#\n################################################################################\n\nUSER root\n\n# set default to 8.0\nRUN update-alternatives --set php /usr/bin/php8.0 && \\\n    update-alternatives --set phar /usr/bin/phar8.0 && \\\n    update-alternatives --set phar.phar /usr/bin/phar.phar8.0\n\nRUN wget https://raw.githubusercontent.com/composer/getcomposer.org/76a7060ccb93902cd7576b67264ad91c8a2700e2/web/installer -O - -q | php -- --quiet && \\\n    mv composer.phar /usr/local/bin/composer\n\nUSER buildbot\n\nRUN mkdir -p /opt/buildhome/.php && ln -s /usr/bin/php8.0 /opt/buildhome/.php/php\nENV PATH \"/opt/buildhome/.php:$PATH\"\n\n################################################################################\n#\n# Go\n#\n################################################################################\nUSER buildbot\nRUN mkdir -p /opt/buildhome/.gimme/bin/ && \\\n    mkdir -p /opt/buildhome/.gimme/env/ && \\\n    curl -f -sL -o /opt/buildhome/.gimme/bin/gimme https://raw.githubusercontent.com/travis-ci/gimme/master/gimme && \\\n    chmod u+x /opt/buildhome/.gimme/bin/gimme\nENV PATH \"$PATH:/opt/buildhome/.gimme/bin\"\nENV GOPATH \"/opt/buildhome/.gimme_cache/gopath\"\nENV GOCACHE \"/opt/buildhome/.gimme_cache/gocache\"\n# Install the default version\nENV GIMME_GO_VERSION \"1.17.x\"\nENV GIMME_ENV_PREFIX \"/opt/buildhome/.gimme/env\"\nRUN gimme | bash\n\n################################################################################\n#\n# Dotnet Core\n#\n################################################################################\nWORKDIR /tmp\nENV DOTNET_VERSION 6.0\nRUN wget https://dot.net/v1/dotnet-install.sh\nRUN chmod u+x /tmp/dotnet-install.sh\nRUN /tmp/dotnet-install.sh -c ${DOTNET_VERSION}\nENV PATH \"$PATH:/opt/buildhome/.dotnet/tools\"\nENV PATH \"$PATH:/opt/buildhome/.dotnet\"\nENV DOTNET_ROOT \"/opt/buildhome/.dotnet\"\n#populate local package cache\nRUN dotnet new\n\n################################################################################\n#\n# Swift\n#\n################################################################################\nUSER buildbot\nENV SWIFTENV_ROOT \"/opt/buildhome/.swiftenv\"\nRUN git clone --depth 1 https://github.com/kylef/swiftenv.git \"$SWIFTENV_ROOT\"\nENV PATH \"$SWIFTENV_ROOT/bin:$SWIFTENV_ROOT/shims:$PATH\"\n\n################################################################################\n#\n# Homebrew\n#\n################################################################################\nUSER root\nRUN mkdir -p /home/linuxbrew/.linuxbrew && chown -R buildbot /home/linuxbrew/\nUSER buildbot\nRUN /bin/bash -c \"$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)\"\nENV HOMEBREW_PREFIX \"/home/linuxbrew/.linuxbrew\"\nENV PATH \"${HOMEBREW_PREFIX}/bin:${PATH}\"\nENV HOMEBREW_CELLAR \"${HOMEBREW_PREFIX}/Cellar\"\nENV HOMEBREW_REPOSITORY \"${HOMEBREW_PREFIX}/Homebrew\"\nENV HOMEBREW_CACHE \"/opt/buildhome/.homebrew-cache\"\nRUN brew tap homebrew/bundle\n\nWORKDIR /\n\n################################################################################\n#\n# rustup\n#\n################################################################################\nRUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y --default-toolchain none\nENV PATH \"$PATH:/opt/buildhome/.cargo/bin\"\n\n# Cleanup\nUSER root\n\n# Add buildscript for local testing\nRUN mkdir -p /opt/build-bin\nADD run-build-functions.sh /opt/build-bin/run-build-functions.sh\nADD run-build.sh /opt/build-bin/build\nADD buildbot-git-config /root/.gitconfig\nRUN rm -r /tmp/*\n\nUSER buildbot\n# The semver version associated with this build (i.e. v3.0.0)\nARG NF_IMAGE_VERSION\nENV NF_IMAGE_VERSION ${NF_IMAGE_VERSION:-latest}\n\n# The commit SHA tag associated with this build\nARG NF_IMAGE_TAG\nENV NF_IMAGE_TAG ${NF_IMAGE_TAG:-latest}\n\n# The codename associated with this build (i.e. focal)\nARG NF_IMAGE_NAME\nENV NF_IMAGE_NAME ${NF_IMAGE_NAME:-focal}\n\n\n################################################################################\n#\n# Test stage Dockerfile\n#\n################################################################################\n\nFROM build-image as build-image-test\n\nUSER buildbot\nSHELL [\"/bin/bash\", \"-c\"]\n\nADD --chown=buildbot:buildbot package.json /opt/buildhome/test-env/package.json\n\n# We need to install with `--legacy-peer-deps` because of:\n# https://github.com/bats-core/bats-assert/issues/27\nRUN cd /opt/buildhome/test-env && . ~/.nvm/nvm.sh && npm i --legacy-peer-deps &&\\\n    ln -s /opt/build-bin/run-build-functions.sh /opt/buildhome/test-env/run-build-functions.sh && \\\n    ln -s /opt/build-bin/build /opt/buildhome/test-env/run-build.sh && npm cache clean --force;\n\nADD --chown=buildbot:buildbot tests /opt/buildhome/test-env/tests\nWORKDIR /opt/buildhome/test-env\n\n# Set `bats` as entrypoint\nENTRYPOINT [\"node_modules/.bin/bats\"]\n# Set the default flags for `bats`\nCMD [\"--recursive\", \"--timing\", \"--formatter\", \"tap\", \"--report-formatter\", \"junit\", \"tests\"]\n"
}