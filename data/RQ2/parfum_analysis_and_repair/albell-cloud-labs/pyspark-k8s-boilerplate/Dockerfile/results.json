{
  "startTime": 1674217818258,
  "endTime": 1674217819294,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 75
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 92,
        "lineEnd": 93,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 94,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 7,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 22,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 49,
        "columnEnd": 71
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 78
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 68
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 22,
        "columnEnd": 45
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 49,
        "columnEnd": 71
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 78
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 27
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 51
      }
    }
  ],
  "repairedDockerfile": "FROM ubuntu:18.04\n\n# toggle these versions judiciously, there are downstream effects and\n# interactions between them\nENV HADOOP_VERSION=3.2.2 \\\n    SPARK_VERSION=3.1.2 \\\n    SCALA_VERSION=2.12.0 \\\n    PYTHON_VERSION=3.9 \\\n    JDK_VERSION=8\n\n\n# Add packages and configure based on official spark-on-k8s dockerfile\nENV TINI_VERSION v0.19.0\nADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini \\\n    /usr/bin/tini\nRUN chmod +x /usr/bin/tini\n\nRUN set -ex && \\\n    apt-get update && \\\n    apt-get install --no-install-recommends -y libc6 libpam-modules krb5-user libnss3 procps && \\\n    ln -s /lib /lib64 && \\\n    rm /bin/sh && \\\n    ln -sv /bin/bash /bin/sh && \\\n    echo \"auth required pam_wheel.so use_uid\" >> /etc/pam.d/su && \\\n    chgrp root /etc/passwd && chmod ug+rw /etc/passwd && \\\n    rm -rf /var/cache/apt/* && rm -rf /var/lib/apt/lists/*;\n\n# change shell to bash which supports parameter expansion\nSHELL [\"/bin/bash\", \"-c\"]\n\n# install some essential utilities\nRUN apt-get update && apt-get install --no-install-recommends curl -y && apt-get install --no-install-recommends vim -y && rm -rf /var/lib/apt/lists/*;\n\n# install python and pip\nRUN apt-get install --no-install-recommends software-properties-common -y && \\\n    add-apt-repository ppa:deadsnakes/ppa -y && apt-get update && \\\n    export DEBIAN_FRONTEND=\"noninteractive\" && \\\n    apt-get install --no-install-recommends -y python${PYTHON_VERSION} python${PYTHON_VERSION:0:1}-pip && \\\n    apt-get install --no-install-recommends -y python${PYTHON_VERSION}-distutils && \\\n    apt-get install --no-install-recommends -y python${PYTHON_VERSION}-venv && \\\n    python${PYTHON_VERSION} -m pip install --upgrade setuptools && \\\n    curl -f https://bootstrap.pypa.io/get-pip.py -o get-pip.py && \\\n    python${PYTHON_VERSION} get-pip.py && \\\n    pip${PYTHON_VERSION} install --no-cache-dir build && rm -rf /var/lib/apt/lists/*;\n\n# install jdk\nRUN apt-get install --no-install-recommends openjdk-${JDK_VERSION}-jdk -y && \\\n     ln -s /usr/bin/java /bin/java && rm -rf /var/lib/apt/lists/*;\n\n# install scala\nRUN apt-get install --no-install-recommends wget -y && \\\n    wget www.scala-lang.org/files/archive/scala-${SCALA_VERSION}.deb && \\\n    dpkg -i scala-${SCALA_VERSION}.deb && rm -rf /var/lib/apt/lists/*;\n\n# install spark\nRUN export SPARK_PRE=https://mirrors.sonic.net/apache/spark/spark- && \\\n    export \\\n    SPARK_TAR=spark-${SPARK_VERSION}-bin-hadoop${HADOOP_VERSION:0:3}.tgz && \\\n    wget ${SPARK_PRE}${SPARK_VERSION}/${SPARK_TAR} && \\\n    tar xvf ${SPARK_TAR} && \\\n    mv ${SPARK_TAR:0:-4} /opt/spark && \\\n    mkdir -p /opt/spark/work-dir && \\\n    cp -r /opt/spark/kubernetes/tests /opt/spark/tests && \\\n    cp /opt/spark/kubernetes/dockerfiles/spark/entrypoint.sh /opt/ && \\\n    cp /opt/spark/kubernetes/dockerfiles/spark/decom.sh /opt/\n\nENV SPARK_HOME=/opt/spark \\\n    PATH=$PATH:/opt/spark/bin \\\n    PYSPARK_PYTHON=/usr/bin/python${PYTHON_VERSION}\n\n# download and install hadoop\nENV HADOOP_URL_PRE http://archive.apache.org/dist/hadoop/common/hadoop-\nRUN mkdir -p /opt && \\\n    cd /opt && \\\n    curl -f ${HADOOP_URL_PRE}${HADOOP_VERSION}/hadoop-${HADOOP_VERSION}.tar.gz | \\\n        tar -zx hadoop-${HADOOP_VERSION}/lib/native && \\\n    ln -s hadoop-${HADOOP_VERSION} hadoop\n\nADD spark-defaults.conf /opt/spark/conf/spark-defaults.conf\n\n###############################################################################\n# Cloud provider specific configuration -- modify, remove, or replace with    #\n# your provider of choice                                                     #\n###############################################################################\n\n# set GCP project\nARG gcp_project\n\n# install gcloud client and hadoop storage connector\nENV GCS_LIB_VERS=2.2.2 \\\n    GCS_URL=https://storage.googleapis.com/hadoop-lib/gcs/ \\\n    JAR_PATH=/jars/gcs-connector-hadoop\nRUN curl -f https://dl.google.com/dl/cloudsdk/release/google-cloud-sdk.tar.gz \\\n    > /tmp/google-cloud-sdk.tar.gz && \\\n    curl -f \\\n    ${GCS_URL}gcs-connector-hadoop${HADOOP_VERSION:0:1}-${GCS_LIB_VERS}.jar \\\n    > ${SPARK_HOME}${JAR_PATH}${HADOOP_VERSION:0:1}-${GCS_LIB_VERS}.jar && \\\n    mkdir -p /usr/local/gcloud \\\n    && tar -C /usr/local/gcloud -xvf /tmp/google-cloud-sdk.tar.gz \\\n    && /usr/local/gcloud/google-cloud-sdk/install.sh && rm /tmp/google-cloud-sdk.tar.gz\n\nENV PATH $PATH:/usr/local/gcloud/google-cloud-sdk/bin\n\n# set default project\nRUN gcloud config set project ${gcp_project}\n\n###############################################################################\n# Cloud specific configuration done                                           #\n###############################################################################\n\n# some final housekeeping from official spark-on-k8s dockerfile\nWORKDIR /opt/spark/work-dir\nRUN chmod g+w /opt/spark/work-dir\nRUN chmod a+x /opt/decom.sh\nADD . /opt/spark/work-dir\n\nRUN sed -i '2iexport GOOGLE_APPLICATION_CREDENTIALS=/secrets/key-file' /opt/entrypoint.sh\nRUN sed -i '3igcloud auth activate-service-account --key-file=/secrets/key-file --verbosity=none' /opt/entrypoint.sh\n\nRUN make clean-install\n\nENTRYPOINT [ \"/opt/entrypoint.sh\" ]\n"
}