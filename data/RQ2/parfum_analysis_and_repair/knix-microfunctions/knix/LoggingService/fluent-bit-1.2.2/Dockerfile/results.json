{
  "startTime": 1674214949807,
  "endTime": 1674214950449,
  "originalSmells": [
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 90
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 25,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 9
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 77,
        "lineEnd": 82,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 90
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 90
      }
    }
  ],
  "repairedDockerfile": "#   Copyright 2020 The KNIX Authors\n#\n#   Licensed under the Apache License, Version 2.0 (the \"License\");\n#   you may not use this file except in compliance with the License.\n#   You may obtain a copy of the License at\n#\n#       http://www.apache.org/licenses/LICENSE-2.0\n#\n#   Unless required by applicable law or agreed to in writing, software\n#   distributed under the License is distributed on an \"AS IS\" BASIS,\n#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#   See the License for the specific language governing permissions and\n#   limitations under the License.\n\nFROM ubuntu:18.04 as builder\n\n# Fluent Bit version\nENV FLB_MAJOR 1\nENV FLB_MINOR 2\nENV FLB_PATCH 2\nENV FLB_VERSION 1.2.2\n\nENV DEBIAN_FRONTEND=noninteractive\n\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends \\\n      build-essential \\\n      cmake \\\n      make \\\n      wget \\\n      unzip \\\n      libssl1.0-dev \\\n      libasl-dev \\\n      libsasl2-dev \\\n      pkg-config \\\n      libsystemd-dev \\\n      zlib1g-dev \\\n      flex \\\n      bison \\\n      tar && rm -rf /var/lib/apt/lists/*;\n\nRUN mkdir -p /fluent-bit/bin /fluent-bit/conf /tmp/src/\nCOPY ./fluent-bit-1.2.2.tar.gz /tmp/src/fluent-bit-1.2.2.tar.gz\nRUN tar -zxvf /tmp/src/fluent-bit-1.2.2.tar.gz -C /tmp/src/ && rm /tmp/src/fluent-bit-1.2.2.tar.gz\nRUN rm -rf /tmp/src/fluent-bit-1.2.2/build/*\n\nWORKDIR /tmp/src/fluent-bit-1.2.2/build/\nRUN cmake -DFLB_BINARY=On \\\n          -DFLB_JEMALLOC=On \\\n          -DFLB_BUFFERING=On \\\n          -DFLB_LUAJIT=On \\\n          -DFLB_BACKTRACE=On \\\n          -DFLB_TLS=On \\\n          -DFLB_DEBUG=Off \\\n          -DFLB_TRACE=Off \\\n          -DFLB_SHARED_LIB=Off \\\n          -DFLB_EXAMPLES=Off \\\n          -DFLB_HTTP_SERVER=Off \\\n          -DFLB_IN_SYSTEMD=Off \\\n          -DFLB_OUT_KAFKA=Off ..\n\nRUN make -j $(getconf _NPROCESSORS_ONLN)\nRUN install bin/fluent-bit /fluent-bit/bin/\n\n# Configuration files\nRUN cd .. && cp conf/fluent-bit.conf \\\n     conf/parsers.conf \\\n     conf/plugins.conf \\\n     /fluent-bit/conf/\n\n\n\n# This is image is used for mfn sandboxes\nFROM ubuntu:18.04\n\n# These are already included in mfn sandboxes\nRUN apt-get update && \\\n    apt-get install -y --no-install-recommends \\\n      build-essential \\\n      netbase \\\n      unzip \\\n      file \\\n      libmagic1 && rm -rf /var/lib/apt/lists/*;\n\n#COPY --from=builder /usr/lib/x86_64-linux-gnu/*sasl* /usr/lib/x86_64-linux-gnu/\n#COPY --from=builder /usr/lib/x86_64-linux-gnu/libz* /usr/lib/x86_64-linux-gnu/\n#COPY --from=builder /lib/x86_64-linux-gnu/libz* /lib/x86_64-linux-gnu/\n#COPY --from=builder /usr/lib/x86_64-linux-gnu/libssl.so* /usr/lib/x86_64-linux-gnu/\n#COPY --from=builder /usr/lib/x86_64-linux-gnu/libcrypto.so* /usr/lib/x86_64-linux-gnu/\n# These below are all needed for systemd\n#COPY --from=builder /lib/x86_64-linux-gnu/libsystemd* /lib/x86_64-linux-gnu/\n#COPY --from=builder /lib/x86_64-linux-gnu/libselinux.so* /lib/x86_64-linux-gnu/\n#COPY --from=builder /lib/x86_64-linux-gnu/liblzma.so* /lib/x86_64-linux-gnu/\n#COPY --from=builder /usr/lib/x86_64-linux-gnu/liblz4.so* /usr/lib/x86_64-linux-gnu/\n#COPY --from=builder /lib/x86_64-linux-gnu/libgcrypt.so* /lib/x86_64-linux-gnu/\n#COPY --from=builder /lib/x86_64-linux-gnu/libpcre.so* /lib/x86_64-linux-gnu/\n#COPY --from=builder /lib/x86_64-linux-gnu/libgpg-error.so* /lib/x86_64-linux-gnu/\n\n# Install additional dependencies needed by fluent-bit\nRUN apt-get -y --no-install-recommends install zlib1g libssl1.0 libsasl2-2 ca-certificates && rm -rf /var/lib/apt/lists/*;\n\n# copy fluent-bit from the builder container\nCOPY --from=builder /fluent-bit /fluent-bit\n\n# check if all the dependencies can be loaded\nRUN ldd /fluent-bit/bin/fluent-bit\n\nRUN chmod -R 777 /fluent-bit\n\n# Entry point\nCMD [\"/fluent-bit/bin/fluent-bit\", \"-c\", \"/fluent-bit/conf/fluent-bit.conf\"]\n"
}