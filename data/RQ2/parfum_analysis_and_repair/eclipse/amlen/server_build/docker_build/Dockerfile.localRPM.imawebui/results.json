{
  "startTime": 1674246008813,
  "endTime": 1674246009846,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 36
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Copyright (c) 2015-2021 Contributors to the Eclipse Foundation\n#\n# See the NOTICE file(s) distributed with this work for additional\n# information regarding copyright ownership.\n#\n# This program and the accompanying materials are made available under the\n# terms of the Eclipse Public License 2.0 which is available at\n# http://www.eclipse.org/legal/epl-2.0\n#\n# SPDX-License-Identifier: EPL-2.0\n#\n\n#Choose a base image that matches the type of build we are using...\n#By default we use: centos7\nFROM quay.io/centos/centos:7\n# For a RHEL8/CentOS8 distro, we use AlmaLinux:\n# ***NB: For RHEL8 - we also need to enable extra repos - see later ***\n#FROM quay.io/almalinux/almalinux:8\n# For Fedora, the verion changes very often due to their short life\n#FROM quay.io/fedora/fedora:35-x86_64\n\n#File author / Maintainer\nMAINTAINER ISM Build\n\nWORKDIR ${IMA_WEBUI_INSTALL_PATH}/bin\n\n# For RHEL8 and compatible distros, openldap-servers is not in the default repo\n# and that is a prereq so one of:\n#  1) CodeReady Builder stream for RHEL\n#  2) PowerTools for CentOS/AlmaLinux\n#  3) Symas repo\n# Needs to be enabled e.g. to enable symas:\n# RUN curl -o /etc/yum.repos.d/sofl.repo https://repo.symas.com/configs/SOFL/rhel8/sofl.repo\n\n# Add RPM in a temporary directory inside the container\n# Make sure that imawebui.rpm is available in the directory where \"docker build\" command\n# is being executed\nADD ./imawebui.rpm /tmp/\n\n# Update all packages\nRUN yum -y upgrade\n\n\n#To run as a non-root user\n# 1) Create the user and group outside the container with a selected uid/gid\n#        groupadd -r -g 463 ima\n#        useradd -r  -s /sbin/nologin -g ima -u 463 ima\n# 2) Give that user read/write access to any volumes that will be used\n# 3) Create a config file so the RPM knows the user\n#        RUN echo 'user=ima' >/etc/messagesight-user.cfg\n# 4) Uncomment the RUN group/useradd setup lines:\n#      (Ensure the numeric uid/gid below match step 1 above)\n#        RUN groupadd -r -g 463 ima\n#        RUN useradd -r  -s /sbin/nologin -g ima -u 463 ima\n# 5) Uncomment the USER line above the Entrypoint before the entrypoint\n\n# We see a bug where if the WebUI is installed in the same transaction as the java\n# it depends on, java is not in the path when the postinstall scripts are run.\n# We work around this by finding the required version of java and installing it first:\nRUN yum deplist /tmp/imawebui.rpm |  awk '/provider:/ {print $2}' | grep java | sort -u |  xargs yum -y install\n\n#Install the WebUI intself\nRUN yum -y install /tmp/imawebui.rpm && rm -rf /var/cache/yum\n\n# Delete imawebui.rpm from temporary directory\nRUN rm -f /tmp/imawebui.rpm\n\n#Uncomment below USER line to run as a non-root user (but do the above steps 1-4 as well!)\n#USER ima:ima\n\n# Set file permissions\nRUN chmod -R +x ${IMA_WEBUI_APPSRV_INSTALL_PATH}\n\nENTRYPOINT [ \"${IMA_WEBUI_INSTALL_PATH}/bin/startWebUI.sh\" ]\n"
}