{
  "startTime": 1674220791264,
  "endTime": 1674220792057,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 9,
        "lineEnd": 10,
        "columnStart": 2,
        "columnEnd": 29
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Inherit from the official Synapse docker image\nARG SYNAPSE_VERSION=latest\nFROM matrixdotorg/synapse:$SYNAPSE_VERSION\n\n# Install deps\nRUN \\\n   --mount=type=cache,target=/var/cache/apt,sharing=locked \\\n   --mount=type=cache,target=/var/lib/apt,sharing=locked \\\n  apt-get update -qq && \\\n  DEBIAN_FRONTEND=noninteractive apt-get install -yqq --no-install-recommends \\\n     redis-server nginx-light && rm -rf /var/lib/apt/lists/*;\n\n# Install supervisord with pip instead of apt, to avoid installing a second\n# copy of python.\nRUN --mount=type=cache,target=/root/.cache/pip \\\n    pip install --no-cache-dir supervisor~=4.2\n\n# Disable the default nginx sites\nRUN rm /etc/nginx/sites-enabled/default\n\n# Copy Synapse worker, nginx and supervisord configuration template files\nCOPY ./docker/conf-workers/* /conf/\n\n# Copy a script to prefix log lines with the supervisor program name\nCOPY ./docker/prefix-log /usr/local/bin/\n\n# Expose nginx listener port\nEXPOSE 8080/tcp\n\n# A script to read environment variables and create the necessary\n# files to run the desired worker configuration. Will start supervisord.\nCOPY ./docker/configure_workers_and_start.py /configure_workers_and_start.py\nENTRYPOINT [\"/configure_workers_and_start.py\"]\n\n# Replace the healthcheck with one which checks *all* the workers. The script\n# is generated by configure_workers_and_start.py.\nHEALTHCHECK --start-period=5s --interval=15s --timeout=5s \\\n    CMD /bin/sh /healthcheck.sh\n"
}