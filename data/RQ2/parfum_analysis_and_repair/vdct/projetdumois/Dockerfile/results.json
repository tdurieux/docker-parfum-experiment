{
  "startTime": 1674253380901,
  "endTime": 1674253381934,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 7,
        "columnEnd": 62
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 150
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 15
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM node:14.18.0-bullseye-slim\n\nENV DB_URL=postgres://localhost:5432/osm\nENV PORT=3000\nARG IMPOSM3_VERSION=0.11.0\n\nRUN groupadd --gid 10001 -r osm \\\n    && useradd --uid 10001 -d /home/osm -m -r -s /bin/false -g osm osm \\\n    && mkdir -p /data/files/pdm /opt/pdm /opt/imposm3 \\\n    && apt-get update \\\n    && apt-get -y install --no-install-recommends \\\n        apt-utils curl xsltproc osmctools ca-certificates gnupg \\\n    && curl -f https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \\\n    && echo \"deb http://apt.postgresql.org/pub/repos/apt bullseye-pgdg main\" > /etc/apt/sources.list.d/pgdg.list \\\n    && apt-get update \\\n    && apt-get -y --no-install-recommends install postgresql-client-13 libpq-dev libgeos-dev osmium-tool python3 python3-requests bc \\\n    && apt-get clean \\\n    && update-ca-certificates \\\n    && rm -rf /var/lib/apt/lists/*\n\nWORKDIR /opt/imposm3\n\nRUN curl -f -L https://github.com/omniscale/imposm3/releases/download/v${IMPOSM3_VERSION}/imposm-${IMPOSM3_VERSION}-linux-x86-64.tar.gz -o imposm3.tar.gz \\\n    && tar -xvf imposm3.tar.gz --strip 1 \\\n    && rm -f imposm3.tar.gz \\\n    && chmod a+x ./imposm \\\n    && cp ./imposm /usr/local/bin/ \\\n    && cp ./lib/* /usr/lib/\n\nWORKDIR /opt/pdm\n\nCOPY --chown=osm:osm ./lib ./lib\nRUN sed -i -e 's/allow_read_prefs\": \"yes\"/allow_read_prefs\": \"1\"/g' ./lib/sendfile_osm_oauth_protector/oauth_cookie_client.py\n\nCOPY --chown=osm:osm ./package.json ./package.json\nRUN npm install && npm cache clean --force;\n\nCOPY --chown=osm:osm dockerfiles/docker-entrypoint.sh README.md ./\nCOPY --chown=osm:osm ./db/ ./db\nCOPY --chown=osm:osm ./website ./website\nCOPY --chown=osm:osm ./projects ./projects\n\nRUN chmod +x ./docker-entrypoint.sh \\\n    && chown -R osm:osm /data/files/pdm \\\n    && chmod -R 755 /data/files/pdm\n\nCOPY --chown=osm:osm ./config.json ./config.json\n\nUSER osm\n\nEXPOSE 3000\nENTRYPOINT [\"./docker-entrypoint.sh\"]\n"
}