{
  "startTime": 1674249690649,
  "endTime": 1674249692045,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 49,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 49,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 44
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Copyright (C) 2017 Kilian Cavalotti <kilian@stanford.edu>\n#\n# This file is part of slurm-web.\n#\n# slurm-web is free software: you can redistribute it and/or modify\n# it under the terms of the GNU General Public License as published by\n# the Free Software Foundation, either version 3 of the License, or\n# (at your option) any later version.\n#\n# slurm-web is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with slurm-web.  If not, see <http://www.gnu.org/licenses/>.\n\n# Use phusion/baseimage as base image. To make your builds reproducible, make\n# sure you lock down to a specific version, not to `latest`!\n# See https://github.com/phusion/baseimage-docker/blob/master/Changelog.md for\n# a list of version numbers.\n\nFROM phusion/baseimage:0.9.19\nMAINTAINER Kilian Cavalotti <kilian@stanford.edu>\n\n# Set correct environment variables.\nENV HOME /root\nENV DEBIAN_FRONTEND noninteractive\nENV LC_ALL C.UTF-8\nENV LANG en_US.UTF-8\nENV LANGUAGE en_US.UTF-8\n\n# Use baseimage-docker's init system\nCMD [\"/sbin/my_init\"]\n\n# Install locales\nRUN locale-gen en_US.UTF-8\n\nENV BUILD_DEPS=\"git devscripts equivs apt-utils apache2-dev libslurm-dev python-setuptools cython python-dev libslurmdb-dev libslurm-dev ca-certificates\"\n\nENV RUN_DEPS=\"apache2 libapache2-mod-wsgi javascript-common python-flask clustershell libjs-bootstrap libjs-jquery-flot libjs-jquery-tablesorter munge slurm-llnl node-uglify fonts-dejavu-core python-ldap python-redis libjs-requirejs libjs-requirejs-text libjs-three libjs-d3 libjs-handlebars\"\n\n# Enable universe and multiverse\n#RUN cat /etc/apt/sources.list && \\\n#    sed -i 's/^#\\s*\\(deb.*universe\\)$/\\1/g' /etc/apt/sources.list && \\\n#    sed -i 's/^#\\s*\\(deb.*multiverse\\)$/\\1/g' /etc/apt/sources.list\n\n# Install system dependencies\nRUN apt-get update -q && \\\n    apt-get -y --no-install-recommends install $BUILD_DEPS $RUN_DEPS && \\\n    ln -s /usr/lib/x86_64-linux-gnu/ /usr/lib64 && rm -rf /var/lib/apt/lists/*;\n\nRUN a2enmod wsgi && \\\n    a2enconf javascript-common\n\n# Build and install specific deps\nENV SLURM_VER=15.08.2\nRUN cd /usr/src && \\\n    git clone https://github.com/PySlurm/pyslurm.git && \\\n    cd pyslurm && \\\n    git checkout remotes/origin/$SLURM_VER && \\\n    sed -i 's/__max_slurm_hex_version__ = \"0x0f0803\"/__max_slurm_hex_version__ = \"0x0f0807\"/' setup.py && \\\n    tar cvfj ../python-pyslurm_$SLURM_VER.orig.tar.bz2 --exclude .git . && \\\n    mk-build-deps -ri -t \"apt-get -y --no-install-recommends\" && \\\n    dch -v $SLURM_VER-1 -D testing \"New upstream release\" && \\\n    debuild -us -uc && \\\n    dpkg -i ../python-pyslurm_$SLURM_VER-1_amd64.deb\n\nRUN cd /usr/src && \\\n    git clone https://github.com/edf-hpc/opentypejs.git && \\\n    cd opentypejs && \\\n    git checkout debian/0.4.3-2 && \\\n\ttar cvfj ../opentypejs_0.4.3.orig.tar.bz2 --exclude .git . && \\\n\tmk-build-deps -ri -t \"apt-get -y --no-install-recommends\" && \\\n\tdebuild -us -uc && \\\n\tdpkg -i ../node-opentypejs_0.4.3-2_all.deb\n\nRUN cd /usr/src && \\\n\tgit clone https://github.com/edf-hpc/libjs-bootstrap-typeahead.git && \\\n\tcd libjs-bootstrap-typeahead/ && \\\n    git checkout debian/0.11.1-1 && \\\n\ttar cvfj ../libjs-bootstrap-typeahead_0.11.1.orig.tar.bz2 --exclude .git . && \\\n\tdebuild -us -uc && \\\n\tdpkg -i ../libjs-bootstrap-typeahead_0.11.1-1_all.deb\n\nRUN cd /usr/src && \\\n\tgit clone https://github.com/edf-hpc/libjs-bootstrap-tagsinput.git && \\\n\tcd libjs-bootstrap-tagsinput/ && \\\n    git checkout debian/0.8.0-1 && \\\n\ttar cvfj ../libjs-bootstrap-tagsinput_0.8.0.orig.tar.bz2 --exclude .git . && \\\n\tdebuild -us -uc && \\\n\tdpkg -i ../libjs-bootstrap-tagsinput_0.8.0-1_all.deb\n\n\nRUN cd /usr/src && \\\n    git clone https://github.com/edf-hpc/slurm-web.git && \\\n    cd slurm-web && \\\n    git checkout debian/2.0.0 && \\\n    debuild -us -uc && \\\n    dpkg -i ../slurm-web-*deb\n\n# Create apache2 service file and start it\nRUN rm /etc/apache2/sites-available/default-ssl.conf && \\\n    echo www-data > /etc/container_environment/APACHE_RUN_USER && \\\n    echo www-data > /etc/container_environment/APACHE_RUN_GROUP && \\\n    echo /var/log/apache2 > /etc/container_environment/APACHE_LOG_DIR && \\\n    echo /var/lock/apache2 > /etc/container_environment/APACHE_LOCK_DIR && \\\n    echo /var/run/apache2.pid > /etc/container_environment/APACHE_PID_FILE && \\\n    echo /var/run/apache2 > /etc/container_environment/APACHE_RUN_DIR && \\\n    chown -R www-data:www-data /var/log/apache2\nRUN mkdir -p /etc/service/apache2\nCOPY apache2.sh /etc/service/apache2/run\nRUN chmod +x /etc/service/apache2/run\n\n# Create munge service file and start it\nRUN chown munge: /var/log/munge /var/lib/munge && \\\n    mkdir -p /etc/service/munge\nCOPY munge.sh /etc/service/munge/run\nRUN chmod +x /etc/service/munge/run\n\n\n# Cleanup\nRUN apt-get clean\n\nEXPOSE 80/tcp\n\nVOLUME [\"/etc/slurm-web\"]\n"
}