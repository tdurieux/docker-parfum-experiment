{
  "startTime": 1674249617162,
  "endTime": 1674249617786,
  "originalSmells": [
    {
      "rule": "yarnCacheCleanAfterInstall",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "yarnCacheCleanAfterInstall",
      "position": {
        "lineStart": 29,
        "lineEnd": 29,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "yarnCacheCleanAfterInstall",
      "position": {
        "lineStart": 66,
        "lineEnd": 66,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 35,
        "lineEnd": 36,
        "columnStart": 22,
        "columnEnd": 6
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 40,
        "lineEnd": 42,
        "columnStart": 22,
        "columnEnd": 296
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# NOTE: Docker context should be set to git root directory, to include the viewer\n\n\n# build stage\nFROM node:16.15-buster-slim as build-stage\n\nARG NODE_ENV=production\nENV NODE_ENV=${NODE_ENV}\n\n\nWORKDIR /speckle-server\nCOPY .yarnrc.yml .\nCOPY .yarn ./.yarn\nCOPY package.json yarn.lock ./\n\n# Onyl copy in the relevant package.json files for the dependencies\nCOPY packages/preview-service/package.json ./packages/preview-service/\nCOPY packages/viewer/package.json ./packages/viewer/\nCOPY packages/objectloader/package.json ./packages/objectloader/\n\nRUN yarn workspaces focus -A && yarn cache clean;\nRUN yarn\n\n# Onyl copy in the relevant source files for the dependencies\nCOPY packages/objectloader ./packages/objectloader/\nCOPY packages/viewer ./packages/viewer/\nCOPY packages/preview-service ./packages/preview-service/\n\n# This way the foreach only builds the frontend and its deps\nRUN yarn workspaces foreach -pt run build && yarn cache clean;\n\n\n\nFROM node:16.15-bullseye-slim as node\n\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n  tini \\\n  && rm -rf /var/lib/apt/lists/*\n\n# chromium dependencies\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n  # ca-certificates fonts-liberation libappindicator3-1 libasound2 libatk-bridge2.0-0 libatk1.0-0 libc6 libcairo2 libcups2 libdbus-1-3 libexpat1 libfontconfig1 libgbm1 libgcc1 libglib2.0-0 libgtk-3-0 libnspr4 libnss3 libpango-1.0-0 libpangocairo-1.0-0 libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 libxdamage1 libxext6 libxfixes3 libxi6 libxrandr2 libxrender1 libxss1 libxtst6 lsb-release wget xdg-utils \\\n  ca-certificates fonts-liberation libasound2 libatk-bridge2.0-0 libatk1.0-0 libatspi2.0-0 libcairo2 libcups2 libdbus-1-3 libdrm2 libexpat1 libgbm1 libglib2.0-0 libnspr4 libnss3 libpango-1.0-0 libx11-6 libxcb1 libxcomposite1 libxdamage1 libxext6 libxfixes3 libxkbcommon0 libxrandr2 wget xdg-utils \\\n  && rm -rf /var/lib/apt/lists/*\n\nADD https://github.com/ufoscout/docker-compose-wait/releases/download/2.8.0/wait /wait\nRUN chmod +x /wait\n\nARG NODE_ENV=production\nENV NODE_ENV=${NODE_ENV}\n\nWORKDIR /speckle-server\nCOPY .yarnrc.yml .\nCOPY .yarn ./.yarn\nCOPY package.json yarn.lock ./\n\n# Onyl copy in the relevant package.json files for the dependencies\nCOPY packages/preview-service/package.json ./packages/preview-service/\n\nWORKDIR /speckle-server/packages\n\nCOPY --from=build-stage /speckle-server/packages/objectloader ./objectloader\nCOPY --from=build-stage /speckle-server/packages/viewer ./viewer\nCOPY --from=build-stage /speckle-server/packages/preview-service ./preview-service\n\nWORKDIR /speckle-server/packages/preview-service\nRUN yarn workspaces focus --production && yarn cache clean;\n\nENTRYPOINT [ \"tini\", \"--\" ]\nCMD [\"yarn\", \"node\", \"bin/www\"]\n"
}