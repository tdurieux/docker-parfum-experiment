{
  "startTime": 1674249619426,
  "endTime": 1674249620746,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 3,
        "lineEnd": 5,
        "columnStart": 23,
        "columnEnd": 113
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 3,
        "lineEnd": 5,
        "columnStart": 23,
        "columnEnd": 113
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ubuntu:focal-20220113 AS install_dependencies\n\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt-get update && apt-get install --no-install-recommends -y cmake git build-essential libgtest-dev libssl-dev qtbase5-dev \\\n    zip libmysqlcppconn-dev libboost1.71-all-dev libmysqlclient-dev uuid-dev libxerces-c-dev qtbase5-dev \\\n    libcurl4-openssl-dev libgps-dev libsnmp-dev librdkafka-dev libjsoncpp-dev libev-dev libuv1-dev libcpprest-dev && rm -rf /var/lib/apt/lists/*;\n# Build and install GTest\nWORKDIR cd /usr/src/googletest/googletest\nRUN mkdir ~/build\nWORKDIR /usr/src/googletest/googletest/build\nRUN cmake ..\nRUN make\nRUN cd lib && cp libgtest* /usr/lib/\nWORKDIR cd /usr/src/googletest/googletest\nRUN rm -rf build\nRUN mkdir /usr/local/lib/googletest\nRUN ln -s /usr/lib/libgtest.a /usr/local/lib/googletest/libgtest.a\nRUN ln -s /usr/lib/libgtest_main.a /usr/local/lib/googletest/libgtest_main.a\nRUN ldconfig\n\n# Build and install tmx\nRUN mkdir ~/V2X-Hub\nCOPY ./src /home/V2X-Hub/src/\nWORKDIR /home/V2X-Hub/src/tmx/\nRUN cmake .\nRUN make\nRUN make install\n\n# Scripts\nCOPY ./ext /home/V2X-Hub/ext\nCOPY ./container /home/V2X-Hub/container\nWORKDIR /home/V2X-Hub/container/\nRUN /home/V2X-Hub/container/database.sh\nRUN /home/V2X-Hub/container/library.sh\nRUN ldconfig\n\nWORKDIR /home/V2X-Hub/\nRUN mkdir -p /home/V2X-Hub/ext\nWORKDIR /home/V2X-Hub/ext/\nRUN git clone https://github.com/usdot-fhwa-OPS/libwebsockets.git\nWORKDIR /home/V2X-Hub/ext/libwebsockets/\nRUN cmake -DLWS_WITH_SHARED=OFF .\nRUN make\nRUN make install\n\nWORKDIR /home/V2X-Hub/ext\nRUN git clone https://github.com/usdot-fhwa-OPS/qhttpengine.git\nWORKDIR /home/V2X-Hub/ext/qhttpengine\nRUN cmake .\nRUN make\nRUN make install\n\nWORKDIR /home/V2X-Hub/ext/\nRUN git clone https://github.com/HowardHinnant/date.git\nWORKDIR /home/V2X-Hub/ext/date\nRUN cmake .\nRUN make\nRUN make install\nRUN ldconfig\n\n\n\nCOPY ext/ /home/V2X-Hub/ext\nWORKDIR /home/V2X-Hub/ext/server\nRUN cmake .\nRUN make\nRUN make install\n\nWORKDIR /home/V2X-Hub/ext/ccserver\nRUN cmake .\nRUN make\nRUN make install\nWORKDIR /home/V2X-Hub/ext/ccserver\n\nWORKDIR /home/V2X-Hub/ext/pdclient\nRUN cmake .\nRUN make\nRUN make install\n\nWORKDIR /home/V2X-Hub/src/v2i-hub/\nRUN cmake . -DqserverPedestrian_DIR=/usr/local/share/qserverPedestrian/cmake -Dv2xhubWebAPI_DIR=/usr/local/share/v2xhubWebAPI/cmake/\nRUN make\n\nRUN ln -s ../bin CommandPlugin/bin\nRUN zip CommandPlugin.zip CommandPlugin/bin/CommandPlugin CommandPlugin/manifest.json\nRUN ln -s ../bin CswPlugin/bin\nRUN zip CswPlugin.zip CswPlugin/bin/CswPlugin CswPlugin/manifest.json\nRUN ln -s ../bin DmsPlugin/bin\nRUN zip DmsPlugin.zip DmsPlugin/bin/DmsPlugin DmsPlugin/manifest.json\nRUN ln -s ../bin DsrcImmediateForwardPlugin/bin\nRUN zip DsrcImmediateForwardPlugin.zip DsrcImmediateForwardPlugin/bin/DsrcImmediateForwardPlugin DsrcImmediateForwardPlugin/manifest.json\nRUN ln -s ../bin LocationPlugin/bin\nRUN zip LocationPlugin.zip LocationPlugin/bin/LocationPlugin LocationPlugin/manifest.json\nRUN ln -s ../bin MapPlugin/bin\nRUN zip MapPlugin.zip MapPlugin/bin/MapPlugin MapPlugin/manifest.json\nRUN ln -s ../bin MessageReceiverPlugin/bin\nRUN zip MessageReceiverPlugin.zip MessageReceiverPlugin/bin/MessageReceiverPlugin MessageReceiverPlugin/manifest.json\nRUN ln -s ../bin ODEPlugin/bin\nRUN zip ODEPlugin.zip ODEPlugin/bin/ODEPlugin ODEPlugin/manifest.json\nRUN ln -s ../bin RtcmPlugin/bin\nRUN zip RtcmPlugin.zip RtcmPlugin/bin/RtcmPlugin RtcmPlugin/manifest.json\nRUN ln -s ../bin SpatPlugin/bin\nRUN zip SpatPlugin.zip SpatPlugin/bin/SpatPlugin SpatPlugin/manifest.json\nRUN ln -s ../bin PreemptionPlugin/bin\nRUN zip PreemptionPlugin.zip PreemptionPlugin/bin/PreemptionPlugin PreemptionPlugin/manifest.json\nRUN ln -s ../bin SPaTLoggerPlugin/bin\nRUN zip SPaTLoggerPlugin.zip SPaTLoggerPlugin/bin/SPaTLoggerPlugin SPaTLoggerPlugin/manifest.json\nRUN ln -s ../bin MessageLoggerPlugin/bin\nRUN zip MessageLoggerPlugin.zip MessageLoggerPlugin/bin/MessageLoggerPlugin MessageLoggerPlugin/manifest.json\nRUN ln -s ../bin PedestrianPlugin/bin\nRUN zip PedestrianPlugin.zip PedestrianPlugin/bin/PedestrianPlugin PedestrianPlugin/manifest.json\nRUN ln -s ../bin TimPlugin/bin\nRUN zip TimPlugin.zip TimPlugin/bin/TimPlugin TimPlugin/manifest.json\nRUN ln -s ../bin CARMACloudPlugin/bin\nRUN zip CARMACloudPlugin.zip CARMACloudPlugin/bin/CARMACloudPlugin CARMACloudPlugin/manifest.json\n\nRUN ln -s ../bin PortDrayagePlugin/bin\nRUN zip PortDrayagePlugin.zip PortDrayagePlugin/bin/PortDrayagePlugin PortDrayagePlugin/manifest.json\n\nRUN ln -s ../bin ODELoggerPlugin/bin\nRUN zip ODELoggerPlugin.zip ODELoggerPlugin/bin/ODELoggerPlugin ODELoggerPlugin/manifest.json\nRUN ln -s ../bin CARMAStreetsPlugin/bin\nRUN zip CARMAStreetsPlugin.zip CARMAStreetsPlugin/bin/CARMAStreetsPlugin CARMAStreetsPlugin/manifest.json\n\nWORKDIR /home/V2X-Hub/src/tmx/TmxCore/\nRUN cp tmxcore.service /lib/systemd/system/ && cp tmxcore.service /usr/sbin/\nWORKDIR /home/V2X-Hub/container/\nRUN chmod +x /home/V2X-Hub/container/service.sh && chmod +x /home/V2X-Hub/container/wait-for-it.sh\nWORKDIR /var/www/\nRUN mkdir ~/plugins\nWORKDIR /home/V2X-Hub/src/v2i-hub/\nWORKDIR /var/www/plugins/\nRUN mkdir /var/www/plugins/MAP\nRUN mkdir /var/www/plugins/.ssl\nRUN chown plugin .ssl\nRUN chgrp www-data .ssl\nWORKDIR /var/www/plugins/.ssl/\nRUN openssl req -x509 -newkey rsa:4096 -sha256 -nodes -keyout tmxcmd.key -out tmxcmd.crt -subj \"/CN= <127.0.0.1> \" -days 3650\nRUN chown plugin *\nRUN chgrp www-data *\nWORKDIR /home/V2X-Hub/src/v2i-hub/\n\n# Set metadata labels\nLABEL org.label-schema.schema-version=\"1.0\"\nLABEL org.label-schema.name=\"V2X-Hub-Deployment\"\nLABEL org.label-schema.description=\"Image V2X-Hub Deployment\"\nLABEL org.label-schema.vendor=\"Leidos\"\nLABEL org.label-schema.version=\"${VERSION}\"\nLABEL org.label-schema.url=\"https://highways.dot.gov/research/research-programs/operations\"\nLABEL org.label-schema.vcs-url=\"https://github.com/usdot-fhwa-ops/V2X-HUB\"\nLABEL org.label-schema.vcs-ref=${VCS_REF}\nLABEL org.label-schema.build-date=${BUILD_DATE}\n\nENTRYPOINT [\"/home/V2X-Hub/container/service.sh\"]\n"
}