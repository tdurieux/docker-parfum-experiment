{
  "startTime": 1674221074352,
  "endTime": 1674221077168,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 7,
        "columnEnd": 53
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 102,
        "lineEnd": 102,
        "columnStart": 7,
        "columnEnd": 41
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 130,
        "lineEnd": 130,
        "columnStart": 7,
        "columnEnd": 135
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 141,
        "lineEnd": 141,
        "columnStart": 7,
        "columnEnd": 45
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 143,
        "lineEnd": 143,
        "columnStart": 7,
        "columnEnd": 124
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 151,
        "lineEnd": 151,
        "columnStart": 75,
        "columnEnd": 101
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 173,
        "lineEnd": 173,
        "columnStart": 81,
        "columnEnd": 107
      }
    },
    {
      "rule": "yarnCacheCleanAfterInstall",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 20
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 95,
        "lineEnd": 95,
        "columnStart": 7,
        "columnEnd": 34
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 96,
        "lineEnd": 96,
        "columnStart": 7,
        "columnEnd": 31
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 134,
        "lineEnd": 134,
        "columnStart": 7,
        "columnEnd": 40
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 139,
        "lineEnd": 139,
        "columnStart": 7,
        "columnEnd": 42
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 181,
        "lineEnd": 181,
        "columnStart": 7,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 7,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 7,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 7,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 7,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 75,
        "lineEnd": 75,
        "columnStart": 7,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 76,
        "lineEnd": 76,
        "columnStart": 7,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 7,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 92,
        "lineEnd": 92,
        "columnStart": 7,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 7,
        "columnEnd": 72
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 7,
        "columnEnd": 86
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 7,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 104,
        "lineEnd": 104,
        "columnStart": 7,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 117,
        "lineEnd": 117,
        "columnStart": 7,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 128,
        "lineEnd": 128,
        "columnStart": 7,
        "columnEnd": 75
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 162,
        "lineEnd": 162,
        "columnStart": 7,
        "columnEnd": 34
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 7,
        "columnEnd": 35
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 7,
        "columnEnd": 29
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 7,
        "columnEnd": 41
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 7,
        "columnEnd": 41
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 75,
        "lineEnd": 75,
        "columnStart": 7,
        "columnEnd": 39
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 76,
        "lineEnd": 76,
        "columnStart": 7,
        "columnEnd": 39
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 7,
        "columnEnd": 39
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 92,
        "lineEnd": 92,
        "columnStart": 7,
        "columnEnd": 39
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 7,
        "columnEnd": 72
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 7,
        "columnEnd": 86
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 7,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 104,
        "lineEnd": 104,
        "columnStart": 7,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 117,
        "lineEnd": 117,
        "columnStart": 7,
        "columnEnd": 61
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 128,
        "lineEnd": 128,
        "columnStart": 7,
        "columnEnd": 75
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 162,
        "lineEnd": 162,
        "columnStart": 7,
        "columnEnd": 34
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "yarnCacheCleanAfterInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 24,
        "columnEnd": 40
      }
    }
  ],
  "repairedDockerfile": "ARG docker_registry=docker.io/alnoda\nARG image_tag=2.2\n\n## Images used:\nARG BUILD_IMAGE=node:12.18.3\nARG DEPLOY_IMAGE=${docker_registry}/base-workspace:${image_tag}\nARG MKDOCS_COPY_IMAGE=${docker_registry}/ide-workspace:${image_tag}\n\n################################################################################ BUILD\n\nARG THEIA_VERSION=1.15.0\nFROM ${BUILD_IMAGE} as theia-builder\n\nARG THEIA_VERSION\n\nRUN apt-get update \\\n    && apt-get upgrade -y \\\n    && apt-get install --no-install-recommends -y apt-utils \\\n    && apt-get install --no-install-recommends -y git \\\n    && apt-get install --no-install-recommends -y libsecret-1-dev \\\n    && mkdir /opt/theia && rm -rf /var/lib/apt/lists/*;\n\nWORKDIR /opt/theia\nADD ${THEIA_VERSION}.package.json ./package.json\nARG GITHUB_TOKEN\nRUN yarn --pure-lockfile && \\\n    NODE_OPTIONS=\"--max_old_space_size=8192\" yarn theia build && \\\n    yarn theia download:plugins && \\\n    yarn --production && \\\n    yarn autoclean --init && \\\n    echo *.ts >> .yarnclean && \\\n    echo *.ts.map >> .yarnclean && \\\n    echo *.spec.* >> .yarnclean && \\\n    yarn autoclean --force && \\\n    yarn cache clean && yarn cache clean;\n\n\n################################################################################ IMAGE\n\nFROM ${MKDOCS_COPY_IMAGE} as docs_image\nFROM dimitri/pgloader:ccl.latest as pgloader-builder\nFROM ${DEPLOY_IMAGE}\n\nUSER root\n\nRUN apt-get update \\\n    && mkdir -p -m 777 /opt/theia \\\n    && cd /opt/theia && nodeenv --node=12.18.3 env && . env/bin/activate \\\n    && mkdir -p -m 777 /home/project \\\n    && apt-get install --no-install-recommends -y libsecret-1-dev && rm -rf /var/lib/apt/lists/*;\n\nCOPY --from=theia-builder /opt/theia /opt/theia\nCOPY settings.json /home/abc/.theia/settings.json\nCOPY supervisord-postgres.conf /etc/supervisord/\n\nCOPY --from=docs_image /home/docs/ /home/docs/\nCOPY ./mkdocs/mkdocs.yml /home/docs/mkdocs.yml\n\nCOPY schemaspy/schemaspy.sh /opt/schemaspy/schemaspy.sh\n\nENV SHELL=/bin/bash \\\n    THEIA_DEFAULT_PLUGINS=local-dir:/opt/theia/plugins \\\n    USE_LOCAL_GIT=true \\\n    HOME=/home/abc \\\n    PATH=\"/home/abc/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/lib/postgresql/14/bin\" \\\n    NVM_DIR=/home/abc/.nvm \\\n    PGDATA=\"/var/postgres\"\n\nCOPY --from=pgloader-builder /usr/local/bin/pgloader  /usr/bin/pgloader\n\nRUN echo \"------------------------------------------------------ postgres\" \\\n    && sh -c 'echo \"deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main\" > /etc/apt/sources.list.d/pgdg.list' \\\n    && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add - \\\n    && apt-get update \\\n    && apt-get -y --no-install-recommends install postgresql-12 \\\n    && apt-get -y --no-install-recommends install postgresql-13 \\\n    && apt-get -y --no-install-recommends install postgresql-14 \\\n    && ln -s /usr/lib/postgresql/14/bin/pg_dump /usr/bin/pg_dump_14 \\\n    && ln -s /usr/lib/postgresql/14/bin/pg_dumpall /usr/bin/pg_dumpall_14 \\\n    && ln -s /usr/lib/postgresql/14/bin/pg_restore /usr/bin/pg_restore_14 \\\n    && ln -s /usr/lib/postgresql/14/bin/psql /usr/bin/psql_14 \\\n    && ln -s /usr/lib/postgresql/13/bin/pg_dump /usr/bin/pg_dump_13 \\\n    && ln -s /usr/lib/postgresql/13/bin/pg_dumpall /usr/bin/pg_dumpall_13 \\\n    && ln -s /usr/lib/postgresql/13/bin/pg_restore /usr/bin/pg_restore_13 \\\n    && ln -s /usr/lib/postgresql/13/bin/psql /usr/bin/psql_13 \\\n    && ln -s /usr/lib/postgresql/12/bin/pg_dump /usr/bin/pg_dump_12 \\\n    && ln -s /usr/lib/postgresql/12/bin/pg_dumpall /usr/bin/pg_dumpall_12 \\\n    && ln -s /usr/lib/postgresql/12/bin/pg_restore /usr/bin/pg_restore_12 \\\n    && ln -s /usr/lib/postgresql/12/bin/psql /usr/bin/psql_12 \\\n    && echo \"------------------------------------------------------ java\" \\\n    && apt-get -y update \\\n    && apt-get install --no-install-recommends -y openjdk-8-jre \\\n    && echo \"------------------------------------------------------ python\" \\\n    && apt-get install --no-install-recommends -y libpq-dev python-dev python3-dev python3.8-dev \\\n    && pip install --no-cache-dir psycopg2==2.9.3 \\\n    && pip install --no-cache-dir pgcli==3.3.1 \\\n    && echo \"------------------------------------------------------ nodejs\" \\\n    && apt-get -y --no-install-recommends install curl dirmngr apt-transport-https lsb-release ca-certificates \\\n    && curl -f -sL https://deb.nodesource.com/setup_12.x | sudo -E bash - \\\n    && apt-get install --no-install-recommends -y nodejs \\\n    && echo \"------------------------------------------------------ rclone\" \\\n    && curl -f https://rclone.org/install.sh | bash \\\n    && echo \"------------------------------------------------------ pspg\" \\\n    && apt-get install --no-install-recommends -y pspg \\\n    && echo \"------------------------------------------------------ pgmetrics\" \\\n    && cd /tmp && wget https://github.com/rapidloop/pgmetrics/releases/download/v1.12.0/pgmetrics_1.12.0_linux_amd64.tar.gz \\\n    && tar -xzf /tmp/pgmetrics_1.12.0_linux_amd64.tar.gz \\\n    && chmod +x /tmp/pgmetrics_1.12.0_linux_amd64/pgmetrics \\\n    && mv /tmp/pgmetrics_1.12.0_linux_amd64/pgmetrics /usr/bin/pgmetrics \\\n    && rm /tmp/pgmetrics_1.12.0_linux_amd64.tar.gz \\\n    && rm -rf /tmp/pgmetrics_1.12.0_linux_amd64 \\\n    && echo \"------------------------------------------------------ pg_sample\" \\\n    && git clone https://github.com/mla/pg_sample.git /opt/pg_sample \\\n    && ln -s /opt/pg_sample/pg_sample /usr/bin/pg_sample \\\n    && echo \"------------------------------------------------------ pgcenter\" \\\n    && cd /tmp && wget https://github.com/lesovsky/pgcenter/releases/download/v0.9.2/pgcenter_0.9.2_linux_amd64.deb \\\n    && apt-get install --no-install-recommends -y /tmp/pgcenter_0.9.2_linux_amd64.deb \\\n    && rm /tmp/pgcenter_0.9.2_linux_amd64.deb \\\n    && echo \"------------------------------------------------------ pgclimb\" \\\n    && cd /tmp && wget -O pgclimb https://github.com/lukasmartinelli/pgclimb/releases/download/v0.3/pgclimb_linux_amd64 \\\n    && chmod +x /tmp/pgclimb \\\n    && mv /tmp/pgclimb /usr/bin/pgclimb \\\n    && echo \"------------------------------------------------------ pgfutter\" \\\n    && cd /tmp && wget https://github.com/lukasmartinelli/pgfutter/releases/download/v1.2/pgfutter_linux_386 \\\n    && chmod +x /tmp/pgfutter_linux_386 \\\n    && mv /tmp/pgfutter_linux_386 /usr/bin/pgfutter \\\n    && echo \"------------------------------------------------------ sqitch\" \\\n    && apt-get install --no-install-recommends -y sqitch libdbd-pg-perl libdbd-sqlite3-perl sqlite3 \\\n    && echo \"------------------------------------------------------ yuniql\" \\\n    && curl -f https://github.com/rdagumampan/yuniql/releases/download/v1.1.55/yuniql-cli-linux-x64-latest.tar.gz -L -o /tmp/yuniql.tar.gz \\\n    && tar -xvzf /tmp/yuniql.tar.gz -C /bin \\\n    && rm /tmp/yuniql.tar.gz \\\n    && echo \"------------------------------------------------------ migra\" \\\n    && pip install --no-cache-dir migra==3.0.1621480950 \\\n    # && echo \"------------------------------------------------------ pgsh\" \\\n    # && npm i -g yarn@latest \\\n    # && yarn global add pgsh \\\n    && echo \"------------------------------------------------------ yandex-pgmigrate\" \\\n    && pip install --no-cache-dir yandex-pgmigrate==1.0.6 \\\n    && echo \"------------------------------------------------------ synth\" \\\n    && curl -f -sSL https://getsynth.com/install | sh \\\n    && echo \"------------------------------------------------------ mock-data\" \\\n    && curl -f https://github.com/faisaltheparttimecoder/mock-data/releases/download/v3.0/mock-linux-amd64-v3.0 -L -o /tmp/mock \\\n    && chmod +x /tmp/mock \\\n    && mv /tmp/mock /usr/bin/mock \\\n    && echo \"------------------------------------------------------ pev-2\" \\\n    && cd /tmp && wget https://github.com/dalibo/pev2/releases/download/v0.24.0/pev2.tar.gz \\\n    && tar -xzf /tmp/pev2.tar.gz \\\n    && mkdir /opt/pev2 && mv pev2 /opt/pev2 \\\n    && rm /tmp/pev2.tar.gz \\\n    && cd /opt/pev2 && nodeenv --node=12.18.3 env && . env/bin/activate && npm install -g http-server \\\n    && echo \"------------------------------------------------------ pgflame\" \\\n    && cd /tmp && wget https://github.com/mgartner/pg_flame/releases/download/v1.2/pg_flame_1.2_Linux_i386.tar.gz \\\n    && tar -xzf /tmp/pg_flame_1.2_Linux_i386.tar.gz \\\n    && chmod +x /tmp/pg_flame \\\n    && mv /tmp/pg_flame /usr/bin/pg_flame \\\n    && rm /tmp/pg_flame_1.2_Linux_i386.tar.gz \\\n    && echo \"------------------------------------------------------ schemaspy\" \\\n    && cd /tmp && wget https://github.com/schemaspy/schemaspy/releases/download/v6.1.0/schemaspy-6.1.0.jar \\\n    && mv /tmp/schemaspy-6.1.0.jar /opt/schemaspy/schemaspy.jar \\\n    && cd /opt/schemaspy && wget https://jdbc.postgresql.org/download/postgresql-42.3.1.jar \\\n    && apt-get install --no-install-recommends -y graphviz \\\n    && chmod +x /opt/schemaspy/schemaspy.sh \\\n    && ln -s /opt/schemaspy/schemaspy.sh /usr/bin/schemaspy \\\n    && echo \"------------------------------------------------------ tbls\" \\\n    && cd /tmp && wget https://github.com/k1LoW/tbls/releases/download/v1.54.2/tbls_v1.54.2_linux_amd64.tar.gz \\\n    && mkdir /tmp/tbls && tar -xzf /tmp/tbls_v1.54.2_linux_amd64.tar.gz --directory /tmp/tbls \\\n    && chmod +x /tmp/tbls/tbls \\\n    && mv /tmp/tbls/tbls /usr/bin/ \\\n    && rm -rf /tmp/tbls && rm tbls_v1.54.2_linux_amd64.tar.gz \\\n    && echo \"------------------------------------------------------ dbdesigner\" \\\n    && git clone https://github.com/akreienbring/dbdesigner /opt/dbdesigner \\\n    && cd /opt/dbdesigner && nodeenv --node=12.18.3 env && . env/bin/activate && npm install --save express \\\n    && rm /opt/dbdesigner/dist/startUp.js \\\n    && echo \"------------------------------------------------------ erd-go\" \\\n    && cd /tmp && wget https://github.com/kaishuu0123/erd-go/releases/download/v2.0.0/linux_amd64_erd-go \\\n    && chmod +x /tmp/linux_amd64_erd-go \\\n    && mv /tmp/linux_amd64_erd-go /usr/bin/erd-go \\\n    && cd /tmp && wget https://github.com/kaishuu0123/erd-go/releases/download/v2.0.0/linux_amd64_erd-go \\\n    && echo \"------------------------------------------------------ sqlfluff\" \\\n    && pip install --no-cache-dir sqlfluff==0.9.4 \\\n    && echo \"------------------------------------------------------ user\" \\\n    && mkdir /var/log/postgres && chown -R abc /var/log/postgres \\\n    && chown -R abc /var/log/postgresql \\\n    && mkdir /var/postgres && chown -R abc /var/postgres \\\n    && chmod 777 /var/run/postgresql \\\n    && chown -R abc /opt/dbdesigner \\\n    && chown -R abc /opt/pev2 \\\n    && mkdir /var/log/dbdesigner && chown -R abc /var/log/dbdesigner \\\n    && chown -R abc /opt/schemaspy \\\n    && chown -R abc /opt/pg_sample \\\n    && echo \"export PAGER='pspg -s 4 --interactive --no-mouse'\" >> ~/.zshrc \\\n    && chown -R abc /opt/theia \\\n    && mkdir -p /var/log/theia && chown -R abc /var/log/theia \\\n    && chown -R abc /home/docs \\\n    && chown -R abc /home/abc/utils \\\n    && chown -R abc /home/abc/installed-python-packages \\\n    && find /home -type d | xargs -I{} chown -R abc {} \\\n    && find /home -type f | xargs -I{} chown abc {} && npm cache clean --force; && rm -rf /var/lib/apt/lists/*;\n\nCOPY dbdesigner/startUp.js /opt/dbdesigner/dist/startUp.js\n\nUSER abc\n"
}