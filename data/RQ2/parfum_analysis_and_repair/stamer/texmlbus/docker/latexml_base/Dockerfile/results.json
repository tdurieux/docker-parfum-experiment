{
  "startTime": 1674255965257,
  "endTime": 1674255966475,
  "originalSmells": [
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 55,
        "lineEnd": 68,
        "columnStart": 4,
        "columnEnd": 15
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# This image is used as base image for LaTeXML.\n# It installs ghostscript, imagemagick and\n# the webserver and php to be run as worker.\nFROM alpine:3.12 as latexml_base\n\nARG TIMEOUT_SECONDS=\"1200\"\n\nRUN echo -e \\\n\" ############################################################\\n\" \\\n\"If the next command fails, you have not checked out LaTeXML.\\n\" \\\n\"Please enter: git submodule update --init --recursive\\n\" \\\n\"############################################################\\n\"\nCOPY LaTeXML/bin/latexml /dev/null\n\nRUN apk add --no-cache \\\n    db-dev \\\n    gcc \\\n    libc-dev \\\n    libgcrypt \\\n    libgcrypt-dev \\\n    libxml2 \\\n    libxml2-dev \\\n    libxslt \\\n    libxslt-dev \\\n    make \\\n    perl \\\n    perl-dev \\\n    perl-utils \\\n    wget \\\n    zlib \\\n    zlib-dev\n\n# Configure TeXLive Support\n# Set to \"no\" to disable, \"yes\" to enable\nARG WITH_TEXLIVE=\"yes\"\n\n# Install TeXLive if not disabled\nRUN [ \"$WITH_TEXLIVE\" == \"no\" ] || (\\\n           apk add --no-cache -U poppler harfbuzz-icu zziplib texlive-full \\\n        && ln -s /usr/bin/mktexlsr /usr/bin/mktexlsr.pl \\\n    )\n\n# Install cpanminus\nRUN apk add --no-cache -U perl-app-cpanminus\n\n\n\n# Install the dependencies\nRUN apk add --no-cache \\\n    ghostscript \\\n    git \\\n    imagemagick \\\n    imagemagick-perlmagick\n\n# Install packages fotr worker: apache2, php, make\nRUN apk add --no-cache \\\n    apache2 \\\n    apache2-proxy \\\n    make \\\n    openrc \\\n    php-cli \\\n    php-fpm \\\n    php-json \\\n    php-mysqli \\\n    php-pcntl \\\n    php-pdo \\\n    php-pdo_mysql \\\n    php-posix \\\n    php-sysvshm\n\n# configure apache\nRUN sed -i \"s#/var/www/localhost/htdocs#/srv/texmlbus/src/worker/htdocs#\" /etc/apache2/httpd.conf \\\n    && sed -i '/LoadModule rewrite_module/s/^#//g' /etc/apache2/httpd.conf \\\n    && sed -i \"s#^Timeout.*#Timeout ${TIMEOUT_SECONDS}#\" /etc/apache2/conf.d/default.conf \\\n    && printf \"\\n<Directory \\\"/srv/texmlbus/src/worker/htdocs\\\">\\nAllowOverride All\\nAddDefaultCharset utf-8\\n<FilesMatch \\\"\\\\.php\\$\\\">\\nSetHandler \\\"proxy:unix:/run/php-fpm.sock|fcgi://localhost\\\"\\n\" >> /etc/apache2/conf.d/default.conf \\\n    && printf \"</FilesMatch>\\n\" >> /etc/apache2/conf.d/default.conf \\\n    && printf \"</Directory>\\n\" >> /etc/apache2/conf.d/default.conf \\\n    && printf \"# Never use 'enablereuse=on' with unix domain sockets.\\n\"  >> /etc/apache2/conf.d/default.conf \\\n    && printf \"# php-fpm will get stuck with processes in finishing state.\\n\" >> /etc/apache2/conf.d/default.conf\\\n    && printf \"<Proxy \\\"fcgi://localhost/\\\" flushpackets=on max=10>\\n\" >> /etc/apache2/conf.d/default.conf \\\n    && printf \"</Proxy>\\n\" >> /etc/apache2/conf.d/default.conf \\\n    && printf \"# Enable 'status' and 'ping' page\\n\"  >> /etc/apache2/conf.d/default.conf \\\n    && printf \"<LocationMatch \\\"/(ping|status)\\\">\\n\" >> /etc/apache2/conf.d/default.conf \\\n    && printf \"SetHandler \\\"proxy:unix:/run/php-fpm.sock|fcgi://localhost\\\"\\n\" >> /etc/apache2/conf.d/default.conf \\\n    && printf \"</LocationMatch>\\n\" >> /etc/apache2/conf.d/default.conf \\\n    && printf \"# Enable *real-time* 'status' page\\n\"  >> /etc/apache2/conf.d/default.conf \\\n    && printf \"#<IfModule alias_module>\\n\"  >> /etc/apache2/conf.d/default.conf \\\n    && printf \"#Alias /realtime-status \\\"/var/lib/php7/fpm/status.html\\\"\\n\" >> /etc/apache2/conf.d/default.conf \\\n    && printf \"#</IfModule>\\n\" >> /etc/apache2/conf.d/default.conf\n\n\n# configure php-fpm\nRUN sed -i \"s#^user\\s*=\\s*nobody#user = dmake#\" /etc/php7/php-fpm.d/www.conf \\\n    && sed -i \"s#group\\s*=\\s*nobody#user = dmake#\" /etc/php7/php-fpm.d/www.conf \\\n    && sed -i \"s#^listen\\s*=.*#listen = /run/php-fpm.sock#\" /etc/php7/php-fpm.d/www.conf \\\n    && sed -i \"s#^;listen.owner\\s*=.*#listen.owner = dmake#\" /etc/php7/php-fpm.d/www.conf \\\n    && sed -i \"s#^;listen.group\\s*=.*#listen.group = dmake#\" /etc/php7/php-fpm.d/www.conf \\\n    && sed -i \"s#^;listen.mode\\s*=.*#listen.mode = 0666#\" /etc/php7/php-fpm.d/www.conf \\\n    && sed -i \"s#^pm.max_children\\s*=.*#pm.max_children = 15#\" /etc/php7/php-fpm.d/www.conf \\\n    && sed -i \"s#;catch_workers_output.*#catch_workers_output = yes#\" /etc/php7/php-fpm.d/www.conf \\\n    && sed -i 's#;pm.status_path#pm.status_path#' /etc/php7/php-fpm.d/www.conf\n"
}