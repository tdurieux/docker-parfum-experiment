{
  "startTime": 1674247929835,
  "endTime": 1674247931526,
  "originalSmells": [
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 5,
        "columnEnd": 78
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 5,
        "columnEnd": 57
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 5,
        "columnEnd": 78
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 5,
        "columnEnd": 57
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM openjdk:11-jre-slim-buster\n\nENV HEAPLAND_HOME=/opt\nENV USERNAME=heapland\nENV DB_USER=hextron\nENV DB_PASSWORD=hextron\nENV DB_URL='jdbc:postgresql://localhost:5432/heaplandb'\nENV RELEASE_VER=\"0.2.0\"\nENV INSTALL_DIR=${HEAPLAND_HOME}/heapland\nENV PACKAGE_NAME=heapland-server\nENV BIN_PATH=${INSTALL_DIR}/bin/heapctl\nENV DOWNLOAD_URL=https://github.com/heapland/heapland/releases/download/v${RELEASE_VER}/heapland-server-${RELEASE_VER}.tgz\n\n\nRUN apt-get update \\\n  && apt-get -y --no-install-recommends install bash sudo zip curl procps gnupg wget lsb-release nginx \\\n  && sh -c 'echo \"deb http://apt.postgresql.org/pub/repos/apt $(lsb_release -cs)-pgdg main\" > /etc/apt/sources.list.d/pgdg.list' \\\n  && wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - \\\n  && apt update \\\n  && apt install --no-install-recommends -y postgresql-13 gnupg postgresql-common \\\n  && /usr/share/postgresql-common/pgdg/apt.postgresql.org.sh -y && rm -rf /var/lib/apt/lists/*;\n\nRUN mkdir -p ${HEAPLAND_HOME}/heapland/logs mkdir -p ${HEAPLAND_HOME}/heapland/tmp \\\n  && mkdir -p ${INSTALL_DIR}/bin \\\n  && mkdir -p ${HEAPLAND_HOME}/heapland/images\n # && curl -fSL $DOWNLOAD_URL -o ${PACKAGE_NAME}-${RELEASE_VER}.tgz \\\nCOPY target/universal/heapland-server-${RELEASE_VER}.tgz /tmp\nRUN ls /tmp\nRUN tar -zxf /tmp/${PACKAGE_NAME}-${RELEASE_VER}.tgz --directory $INSTALL_DIR && rm /tmp/${PACKAGE_NAME}-${RELEASE_VER}.tgz\n\nRUN echo \":9080 { \\\n            \\n\\\n          \tencode gzip zstd \\\n               \\n                 \\\n          \t@back-end path /api/* /web/* /ws/* \\\n          \t\\n\\\n          \thandle @back-end { \\\n          \t    \\n\\\n          \t\treverse_proxy 127.0.0.1:9000 \\\n          \t\t\\n\\\n               } \\\n           \\n\\\n          \thandle { \\\n          \t\\n\\\n          \t\troot * $INSTALL_DIR/${PACKAGE_NAME}-${RELEASE_VER}/sbin/ui \\\n          \t\t\\n\\\n          \t\ttry_files {path} /index.html \\\n          \t\t\\n\\\n          \t\tfile_server \\\n          \t\t\\n\\\n          \t} \\n\\\n          }\"\\\n> $INSTALL_DIR/${PACKAGE_NAME}-${RELEASE_VER}/sbin/Caddyfile\n\n\nRUN rm /tmp/${PACKAGE_NAME}-${RELEASE_VER}.tgz \\\n&& chmod +x $INSTALL_DIR/${PACKAGE_NAME}-${RELEASE_VER}/sbin/Linux/heapctl \\\n&& chmod +x $INSTALL_DIR/${PACKAGE_NAME}-${RELEASE_VER}/sbin/Linux/caddy \\\n&& ln -sfn $INSTALL_DIR/${PACKAGE_NAME}-${RELEASE_VER}/sbin/Linux/heapctl $BIN_PATH\nCMD [\"/bin/bash\", \"-c\", \"$BIN_PATH start\"]\n"
}