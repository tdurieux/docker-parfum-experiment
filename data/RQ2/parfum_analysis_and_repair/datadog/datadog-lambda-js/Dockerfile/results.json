{
  "startTime": 1674249974108,
  "endTime": 1674249974883,
  "originalSmells": [
    {
      "rule": "yarnCacheCleanAfterInstall",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 16
      }
    },
    {
      "rule": "yarnCacheCleanAfterInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 34
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG image\nFROM $image\nARG image\n\n# Create the directory structure required for AWS Lambda Layer\nRUN mkdir -p /nodejs/node_modules/\n\n# Install dev dependencies\nCOPY . datadog-lambda-js\nWORKDIR /datadog-lambda-js\nRUN yarn install && yarn cache clean;\n\n# Build the lambda layer\nRUN yarn build\nRUN cp -r dist /nodejs/node_modules/datadog-lambda-js\nRUN cp ./src/runtime/module_importer.js /nodejs/node_modules/datadog-lambda-js/runtime\n\nRUN if [ \"$image\" = \"node:12.13-alpine\" ]; then cp ./src/handler.cjs /nodejs/node_modules/datadog-lambda-js/handler.js; else cp ./src/handler.mjs /nodejs/node_modules/datadog-lambda-js; fi\nRUN rm -rf node_modules\n\n# Move dd-trace from devDependencies to production dependencies\n# That way it is included in our layer, while keeping it an optional dependency for npm\nRUN node ./scripts/move_ddtrace_dependency.js \"$(cat package.json)\" > package.json\n# Install dependencies\nRUN yarn install --production=true && yarn cache clean;\n# Copy the dependencies to the modules folder\nRUN cp -rf node_modules/* /nodejs/node_modules\n\n# Remove the AWS SDK, which is installed in the lambda by default\nRUN rm -rf /nodejs/node_modules/aws-sdk\nRUN rm -rf /nodejs/node_modules/aws-xray-sdk-core/node_modules/aws-sdk\n\n# Remove heavy files from dd-trace which aren't used in a lambda environment\nRUN rm -rf /nodejs/node_modules/dd-trace/prebuilds\nRUN rm -rf /nodejs/node_modules/dd-trace/dist\nRUN rm -rf /nodejs/node_modules/@datadog/native-appsec\nRUN rm -rf /nodejs/node_modules/@datadog/native-metrics\nRUN rm -rf /nodejs/node_modules/@datadog/pprof\nRUN rm -rf /nodejs/node_modules/hdr-histogram-js/build\nRUN rm -rf /nodejs/node_modules/protobufjs/dist\nRUN rm -rf /nodejs/node_modules/protobufjs/cli\nRUN find /nodejs/node_modules -name \"*.d.ts\" -delete\nRUN find /nodejs/node_modules -name \"*.js.map\" -delete\nRUN find /nodejs/node_modules -name \"*.ts.map\" -delete\n\n\n"
}