{
  "startTime": 1674220321421,
  "endTime": 1674220321933,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 9,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 9,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 9,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 9,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 23
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG SOLANA_VERSION\nFROM solanalabs/solana:v${SOLANA_VERSION}\n\n# Redeclare SOLANA_VERSION in the new build stage.\n# Persist in env for docker run & inspect.\nARG SOLANA_VERSION\nENV SOLANA_VERSION=\"${SOLANA_VERSION}\"\n\nRUN apt-get update && apt-get install -y --no-install-recommends -qq \\\n  cmake \\\n  curl \\\n  g++ \\\n  gcc-multilib \\\n  git \\\n  libzstd1 \\\n  libzstd-dev \\\n  python3-pytest \\\n  python3-pytest-asyncio \\\n  python3-websockets \\\n  sudo \\\n  zlib1g \\\n  zlib1g-dev \\\n  qtbase5-dev \\\n  qtchooser \\\n  qt5-qmake \\\n  qtbase5-dev-tools \\\n  libqt5websockets5-dev && rm -rf /var/lib/apt/lists/*;\n\n# Install jcon-cpp library\nRUN git clone https://github.com/joncol/jcon-cpp.git /jcon-cpp && cd /jcon-cpp && git checkout 2235654e39c7af505d7158bf996e47e37a23d6e3 && mkdir build && cd build && cmake .. && make -j4 && make install\n\n# Grant sudo access to pyth user\nRUN echo \"pyth ALL=(ALL) NOPASSWD:ALL\" >> /etc/sudoers\nRUN useradd -m pyth\n\n# Fixes a bug in the solana docker image\n# https://github.com/solana-labs/solana/issues/20577\nRUN mkdir /usr/bin/sdk/bpf/dependencies \\\n    && chmod 777 /usr/bin/sdk/bpf/dependencies\n\n\nUSER pyth\nWORKDIR /home/pyth\n\nRUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs \\\n  | sh -s -- -y\n\n\nRUN echo \"\\n\\\nexport PATH=\\\"\\${PATH}:\\${HOME}/pyth-client/build:\\${HOME}/.cargo/bin\\\"\\n\\\nexport PYTHONPATH=\\\"\\${PYTHONPATH:+\\$PYTHONPATH:}\\${HOME}/pyth-client\\\"\\n\\\n\" >> .profile\n\nCOPY --chown=pyth:pyth . pyth-client/\n\n# Build off-chain binaries.\nRUN cd pyth-client && ./scripts/build.sh\n\n\n# Copy solana sdk and apply patch.\nRUN mkdir solana\nRUN cp -a /usr/bin/sdk solana\nRUN ./pyth-client/scripts/patch-solana.sh\n\n# Build and test the oracle program.\nRUN cd pyth-client && ./scripts/build-bpf.sh .\nRUN /bin/bash -l -c \"pytest-3 --pyargs pyth\"\n\nENTRYPOINT []\nCMD []\n"
}