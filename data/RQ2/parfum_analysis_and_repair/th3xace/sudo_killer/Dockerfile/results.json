{
  "startTime": 1674220105024,
  "endTime": 1674220106445,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 10,
        "lineEnd": 11,
        "columnStart": 4,
        "columnEnd": 33
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM debian:buster-slim\n\nMAINTAINER TH3XACE <BLALAA>\nLABEL description=\"This docker was created for testing the tool SUDO_KILLER available on github. The tool was developped to identify and exploit misconfigurations within sudo rules as well as vulnerable version of sudo itself. \\\nSeveral scenarios are included in the docker so as to illustrate some of the vulnerable configurations and a vulnerable version if sudo.\"\n\n# install debian stuff\nRUN apt-get update && \\\n    apt-get install --no-install-recommends -y git && \\\n    apt-get upgrade -y && \\\n    DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends install -y \\\n    wget vim build-essential curl \\\n    && apt-get clean && rm -rf /var/lib/apt/lists/*\n\n# configure vuln application\nRUN wget https://www.sudo.ws/dist/sudo-1.8.4.tar.gz -O /tmp/sudo.tar.gz && \\\n    tar xfz /tmp/sudo.tar.gz -C /tmp/ && \\\n    cd /tmp/sudo-1.8.4 && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" && \\\n    make && make install && rm /tmp/sudo.tar.gz\nRUN rm -rf /tmp/sudo*\n\n# create default user\nRUN useradd -d /home/user \\\n    -s /bin/bash \\\n    -ms /bin/bash user\n\n# create victim user\nRUN useradd -d /home/victim \\\n    -s /bin/bash \\\n    -ms /bin/bash victim\n\n# add sudoers entry\nRUN echo 'Defaults pwfeedback' >> /etc/sudoers && \\\n    echo 'Defaults env_reset' >> /etc/sudoers && \\\n    echo 'Defaults env_keep += LD_PRELOAD' >> /etc/sudoers && \\\n    echo 'Defaults env_keep += LD_LIBRARY_PATH' >> /etc/sudoers && \\\n    echo 'user ALL=NOPASSWD: sudoedit /home/*/*/esc.txt' >> /etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: /home/user/directory/user*/setup.sh' >> /etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: /bin/chown -hR * /home/user/directory/* ' >> /etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: /bin/chown -hR * *.txt' >> /etc/sudoers && \\  \n    echo 'user ALL=(root) NOPASSWD: /bin/chown -HR * *.txt' >> /etc/sudoers && \\   \n    echo 'user ALL=NOPASSWD: /home/user/support/start.sh, /home/user/support/stop.sh, /home/user/support/restart.sh, /usr/sbin/lsof' >> /etc/sudoers && \\  \n    echo 'user ALL=(root) NOPASSWD: /direc/*/user' >> /etc/sudoers && \\ \n    echo 'user ALL=(ALL, !root) NOPASSWD: /bin/bash' >> /etc/sudoers && \\\n    echo 'user ALL=(ALL, !root) NOPASSWD: /usr/bin/id' >> /etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: /usr/local/bin/sudoedit /etc/printcap' >> /etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: /bin/cp *' >> /etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: /bin/ping' >> /etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: /usr/bin/ping' >> /etc/sudoers && \\    \n    echo 'user ALL=(victim) NOPASSWD: /usr/bin/find *' >> /etc/sudoers && \\\n    echo 'user ALL=(victim) NOPASSWD: /usr/bin/cpan *' >> /etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: sudoedit /' >> /etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: /usr/sbin/start-stop-daemon *' >> /etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: /usr/bin/csvtool * --help' >> //etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: /usr/sbin/apache2' >> //etc/sudoers && \\\n    echo 'user ALL=(root) NOPASSWD: /bin/kill, /usr/bin/cat, /usr/bin/tail' >> /etc/sudoers\n\n# create vulnerable scripts\nRUN mkdir -p /home/user/support && \\  \n    cd /home/user/support && \\\n    touch restart.sh && \\\n    touch start.sh && \\\n    chmod u+rwx restart.sh && \\\n    chmod g+xr restart.sh && \\\n    chmod o+x restart.sh && \\\n    chown user:user start.sh && \\  \n    chmod u+rwx start.sh && \\\n    chmod g+xr start.sh && \\\n    chmod o+x start.sh && \\\n    cd ../ && \\\n    chown user:user support/\n\n#COPY exploit.sh /home/user/\nRUN cd /home/user/ && \\\n    git clone https://github.com/TH3xACE/SUDO_KILLER.git && \\\n    chown -R user:user SUDO_KILLER && \\\n    cd SUDO_KILLER && \\\n    chmod +x *.sh\n\n# run interactive shell\n# with user privileges\nCMD [\"su\", \"-\", \"user\"]\n"
}