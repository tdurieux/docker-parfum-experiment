{
  "startTime": 1674248583037,
  "endTime": 1674248584123,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 30,
        "lineEnd": 59,
        "columnStart": 22,
        "columnEnd": 8
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 30,
        "lineEnd": 59,
        "columnStart": 22,
        "columnEnd": 8
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# PLEASE NOTE THAT YOUR WORKING-DIRECTORY MUST BE THE ROOT OF THIS REPOSITORY\n# IN ORDER WO BUILD THIS CONTAINER-IMAGE!!!\n#\n# Build:\n#    docker build -f aecid-testsuite/Dockerfile -t aecid/logdata-anomaly-miner-testing:latest .\n#\n# Use:\n#    docker run -m=2G --rm aecid/logdata-anomaly-miner-testing runUnittests\n#\n# Run all tests:\n#    docker run -m=2G --rm aecid/logdata-anomaly-miner-testing ALL\n#\n# Run a shell inside the container:\n#    docker run -m=2G -it --rm aecid/logdata-anomaly-miner-testing SHELL\n#\n# See: https://github.com/ait-aecid/logdata-anomaly-miner/wiki/How-to-use-the-AECID-testsuite\n#\n\n# Pull base image.\nFROM debian:bullseye\n\n# Set local timezone\nENV TZ=Europe/Vienna\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone\n\nLABEL maintainer=\"wolfgang.hotwagner@ait.ac.at\"\n\n# Install necessary debian packages\nARG DEBIAN_FRONTEND=noninteractive\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n    python3 \\\n    python3-pip \\\n    python3-pip \\\n    python3-tz \\\n    python3-scipy \\\n    python3-pkg-resources \\\n    python3-setuptools \\\n    python3-dateutil \\\n    python3-six \\\n    python3-scipy \\\n    python3-kafka \\\n    python3-cerberus \\\n    python3-yaml \\\n    python3-pylibacl \\\n    python3-urllib3 \\\n    python3-statsmodels \\\n    libacl1-dev \\\n    postfix \\\n    procps \\\n    mailutils \\\n    sudo \\\n    curl \\\n    postfix \\\n    openjdk-11-jre \\\n    locales \\\n    locales-all \\\n    rsyslog \\\n    git \\\n    mypy && rm -rf /var/lib/apt/lists/*;\n\nRUN sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen && \\\n    sed -i -e 's/# de_AT ISO-8859-1/de_AT ISO-8859-1/' /etc/locale.gen && \\\n    dpkg-reconfigure --frontend=noninteractive locales && \\\n    update-locale LANG=en_US.UTF-8\n\nENV LANG en_US.UTF-8\nENV LANGUAGE en_US:en \nENV LC_ALL en_US.UTF-8\n\n\n# RUN pip3 install coverage\n\n# Copy logdata-anomaly-miner-sources\nADD source/root/usr/lib/logdata-anomaly-miner /usr/lib/logdata-anomaly-miner\n\n# copy these files instead as symlinks would need absolute paths.\nADD source/root/etc/aminer/conf-available/ait-lds/* /etc/aminer/conf-enabled/\nADD source/root/etc/aminer/conf-available/generic/* /etc/aminer/conf-enabled/\nADD source/root/etc/aminer/conf-available/ait-lds /etc/aminer/conf-available/ait-lds\nADD source/root/etc/aminer/conf-available/generic /etc/aminer/conf-available/generic\n\n# Entrypoint-wrapper\nADD scripts/aminerwrapper.sh /aminerwrapper.sh\n\n\n# Prepare the system and link all python-modules\nRUN ln -s /usr/lib/logdata-anomaly-miner/aminerremotecontrol.py /usr/bin/aminerremotecontrol \\\n\t&& ln -s /usr/lib/logdata-anomaly-miner/aminer.py /usr/bin/aminer \\\n\t&& chmod 0755 /usr/lib/logdata-anomaly-miner/aminer.py  \\\n\t&& chmod 0755 /usr/lib/logdata-anomaly-miner/aminerremotecontrol.py \\\n\t&& ln -s /usr/lib/python3/dist-packages/kafka /etc/aminer/conf-enabled/kafka \\\n\t&& ln -s /usr/lib/python3/dist-packages/cerberus /etc/aminer/conf-enabled/cerberus \\\n\t&& ln -s /usr/lib/python3/dist-packages/scipy /etc/aminer/conf-enabled/scipy \\\n\t&& ln -s /usr/lib/python3/dist-packages/numpy /etc/aminer/conf-enabled/numpy \\\n\t&& ln -s /usr/lib/python3/dist-packages/pkg_resources /etc/aminer/conf-enabled/pkg_resources \\\n\t&& ln -s /usr/lib/python3/dist-packages/yaml /etc/aminer/conf-enabled/yaml \\\n\t&& ln -s /usr/lib/python3/dist-packages/pytz /etc/aminer/conf-enabled/pytz \\\n\t&& ln -s /usr/lib/python3/dist-packages/dateutil /etc/aminer/conf-enabled/dateutil \\\n\t&& ln -s /usr/lib/python3/dist-packages/six.py /etc/aminer/conf-enabled/six.py \\\n\t&& ln -s /usr/lib/python3/dist-packages/urllib3 /etc/aminer/conf-enabled/urllib3 \\\n\t&& ln -s /usr/lib/python3/dist-packages/statsmodels /etc/aminer/conf-enabled/statsmodels \\\n\t&& useradd -ms /usr/sbin/nologin aminer && mkdir -p /var/lib/aminer/log && chmod 0755 /aminerwrapper.sh \\\n    && chown aminer.aminer -R /var/lib/aminer && chmod 0755 /etc/aminer\n\nRUN PACK=$(find /usr/lib/python3/dist-packages -name posix1e.cpython\\*.so) && FILE=$(echo $PACK | awk -F '/' '{print $NF}') ln -s $PACK /usr/lib/logdata-anomaly-miner/$FILE\n\n# Add config\nADD source/root/etc/aminer /etc/aminer\n\n# Copy the testsuite\nADD aecid-testsuite /home/aminer/aecid-testsuite\n\nRUN chown aminer.aminer -R /home/aminer \\\n    && ln -s /usr/lib/logdata-anomaly-miner/aminer /home/aminer/aecid-testsuite/aminer \\\n    && ln -s /etc/aminer/template_config.py /home/aminer/aecid-testsuite/demo/aminer/template_config.py \\\n    && ln -s /etc/aminer/template_config.yml /home/aminer/aecid-testsuite/demo/aminer/template_config.yml \\\n    && chmod +x /home/aminer/aecid-testsuite/*.sh \\\n    && echo \"aminer ALL=(ALL) NOPASSWD:ALL\" > /etc/sudoers.d/aminer\n\nADD scripts/testingwrapper.sh /testingwrapper.sh\nADD source /home/aminer/source\nADD docs /home/aminer/docs\n\nUSER aminer\nWORKDIR /home/aminer/aecid-testsuite\n\n# The following volumes can be mounted\nVOLUME [\"/etc/aminer\",\"/var/lib/aminer\",\"/logs\"]\n\nENTRYPOINT [\"/testingwrapper.sh\"]\n"
}