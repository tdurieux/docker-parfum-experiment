{
  "startTime": 1674220357851,
  "endTime": 1674220359538,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 44,
        "lineEnd": 63,
        "columnStart": 7,
        "columnEnd": 31
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM alpine:latest\nARG GIT_VER=\nENV VER=@VERSION@\nLABEL version=@VERSION@${GIT_VER}\nLABEL author=\"Alexandre Cassen <acassen@gmail.com>\"\nLABEL project=\"https://github.com/acassen/keepalived\"\nLABEL homepage=\"https://www.keepalived.org\"\n\n# add keepalived sources to /tmp/keepalived-@VERSION@\nADD keepalived-@VERSION@.tar.gz /tmp\n\n# Add keepalived default script user to make sure their IDs get assigned consistently,\n# regardless of whatever dependencies get added\nRUN addgroup -S keepalived_script && adduser -D -S -G keepalived_script keepalived_script\n\n# 1. install required libraries and tools\n# 2. compile and install keepalived\n# 3. remove keepalived sources and unnecessary libraries and tools\nRUN apk --no-cache add \\\n\tbinutils \\\n@MAGIC_TRUE@\tfile \\\n@MAGIC_TRUE@\tfile-dev \\\n\tgcc \\\n@WITH_DBUS_TRUE@\tglib \\\n@WITH_DBUS_TRUE@\tglib-dev \\\n@LIBIPSET_TRUE@\tipset \\\n@LIBIPSET_TRUE@\tipset-dev \\\n@IPTABLES_TRUE@\tiptables \\\n@IPTABLES_TRUE@\tiptables-dev \\\n@NFTABLES_TRUE@\tlibmnl-dev \\\n@NFTABLES_TRUE@\tlibnftnl-dev \\\n\tlibnl3 \\\n\tlibnl3-dev \\\n\tmake \\\n\tmusl-dev \\\n@SNMP_TRUE@\tnet-snmp-dev \\\n\topenssl \\\n\topenssl-dev \\\n@WITH_REGEX_TRUE@\tpcre2 \\\n@WITH_REGEX_TRUE@\tpcre2-dev \\\n\tautoconf \\\n\tautomake \\\n    && cd /tmp/keepalived-@VERSION@/ \\\n    && ./autogen.sh \\\n    && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" \\\n\t\t--disable-dynamic-linking \\\n\t\t--prefix=/usr \\\n\t\t--exec-prefix=/usr \\\n\t\t--bindir=/usr/bin \\\n\t\t--sbindir=/usr/sbin \\\n\t\t--sysconfdir=/etc \\\n\t\t--datadir=/usr/share \\\n\t\t--localstatedir=/var \\\n\t\t--mandir=/usr/share/man \\\n@WITH_DBUS_TRUE@ --with-dbus-data-dir=/usr/share \\\n\t\t--enable-bfd \\\n@WITH_DBUS_TRUE@ --enable-dbus \\\n@WITH_REGEX_TRUE@\t\t--enable-reg --enable-regex \\\n@SNMP_TRUE@ --enable-snmp \\\n@SNMP_TRUE@ --enable-snmp-rfc \\\n@NFTABLES_TRUE@\t\t--enable-nfta --enable-nftables \\\n@IPTABLES_FALSE@\t\t--disable-iptabl --disable-iptables \\\n@IPTABLES_TRUE@@LIBIPSET_FALSE@\t\t--d --disable-libipset \\\n@WITH_JSON_TRUE@\t\t--enable-json \\ --enable-json \\\n    && make && make install \\\n    && strip /usr/sbin/keepalived \\\n    && cd - \\\n    && rm -rf /tmp/keepalived-@VERSION@ \\\n    && apk --no-cache del \\\n\tbinutils \\\n@MAGIC_TRUE@\tfile-dev \\\n\tgcc \\\n@WITH_DBUS_TRUE@\tglib-dev \\\n@LIBIPSET_TRUE@\tipset-dev \\\n@IPTABLES_TRUE@\tiptables-dev \\\n@NFTABLES_TRUE@\tlibmnl-dev \\\n\tlibnl3-dev \\\n@NFTABLES_TRUE@\tlibnftnl-dev \\\n\tmake \\\n\tmusl-dev \\\n\topenssl-dev \\\n@WITH_REGEX_TRUE@\tpcre2-dev \\\n\tautoconf \\\n\tautomake\n\nADD docker/keepalived.conf /etc/keepalived/keepalived.conf\n\n# set keepalived as image entrypoint with --dont-fork and --log-console (to make it docker friendly)\n# define /etc/keepalived/keepalived.conf as the configuration file to use\nENTRYPOINT [\"/usr/sbin/keepalived\",\"--dont-fork\",\"--log-console\", \"-f\",\"/etc/keepalived/keepalived.conf\"]\n\n# example command to customise keepalived daemon:\n# CMD [\"--log-detail\",\"--dump-conf\"]\n"
}