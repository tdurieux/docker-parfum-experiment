{
  "startTime": 1674250994079,
  "endTime": 1674250995377,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 68,
        "lineEnd": 68,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "yarnCacheCleanAfterInstall",
      "position": {
        "lineStart": 76,
        "lineEnd": 76,
        "columnStart": 16,
        "columnEnd": 28
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 72
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 44,
        "lineEnd": 44,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 45,
        "lineEnd": 45,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 22,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 22,
        "columnEnd": 45
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 27
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 72
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 60
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 51
      }
    }
  ],
  "repairedDockerfile": "FROM ubuntu:18.04\n\nENV PYTHONUNBUFFERED 1\nENV PYTHONDONTWRITEBYTECODE 1\nENV DEBIAN_FRONTEND=noninteractive\n\n# Define packages to be installed\nARG PACKAGES=\"libpq-dev libxml2 libxslt1-dev libfreetype6 libjpeg-dev libmaxminddb-dev bash git tar gzip libmagic-dev build-essential python-dev libssl-dev python3.7-dev python3.7 libsecp256k1-dev libsodium-dev python3.7-distutils\"\nARG BUILD_DEPS=\"gcc g++ curl postgresql libxml2-dev libxslt-dev libfreetype6 libffi-dev libjpeg-dev autoconf automake libtool make dos2unix libvips libvips-dev\"\nARG CHROME_DEPS=\"fonts-liberation libasound2 libatk-bridge2.0-0 libatk1.0-0 libatspi2.0-0 libcairo2 libcups2 libcurl3-gnutls libdrm2 libexpat1 libgbm1 libglib2.0-0 libnspr4 libgtk-3-0 libpango-1.0-0 libx11-6 libxcb1 libxcomposite1 libxdamage1 libxext6 libxfixes3 libxkbcommon0 libxrandr2 libxshmfence1 xdg-utils\"\nARG CYPRESS_DEPS=\"libgtk2.0-0 libgbm-dev libnotify-dev libgconf-2-4 libnss3 libxss1 libxtst6 xauth xvfb\"\n\n# Install general dependencies.\nRUN apt-get update\nRUN apt-get install --no-install-recommends -y software-properties-common && rm -rf /var/lib/apt/lists/*;\nRUN add-apt-repository universe\nRUN apt-get update\nRUN apt-get install --no-install-recommends -y $PACKAGES && rm -rf /var/lib/apt/lists/*;\nRUN apt-get update --fix-missing\nRUN apt-get install --no-install-recommends -y $BUILD_DEPS --fix-missing && rm -rf /var/lib/apt/lists/*;\n\n\nRUN curl -f https://bootstrap.pypa.io/get-pip.py > /tmp/get-pip.py\nRUN python3.7 /tmp/get-pip.py\nRUN rm /tmp/get-pip.py\n\n# Install google chrome for cypress testing\nWORKDIR /usr/src\nRUN apt-get update && apt-get install --no-install-recommends -y wget && rm -rf /var/lib/apt/lists/*;\nRUN wget \"https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb\"\nRUN apt-get install --no-install-recommends -y $CHROME_DEPS && rm -rf /var/lib/apt/lists/*;\nRUN dpkg -i google-chrome-stable_current_amd64.deb\n\n# Install cypress dependencies\nRUN apt-get install --no-install-recommends -y $CYPRESS_DEPS && rm -rf /var/lib/apt/lists/*;\n\n# Move to /code dir and copy in working dir content\nWORKDIR /code\nCOPY dist/* ./\n\n# GeoIP2 Data Files\nRUN mkdir -p /usr/share/GeoIP/ && \\\n    gunzip GeoLite2-City.mmdb.tar.gz && \\\n    gunzip GeoLite2-Country.mmdb.tar.gz && \\\n    tar -xvf GeoLite2-City.mmdb.tar && \\\n    tar -xvf GeoLite2-Country.mmdb.tar && \\\n    mv GeoLite2-City_20200128/*.mmdb /usr/share/GeoIP/ && \\\n    mv GeoLite2-Country_20200128/*.mmdb /usr/share/GeoIP/ && rm GeoLite2-City.mmdb.tar\n\n# Upgrade package essentials.\nRUN pip3 install --no-cache-dir --upgrade pip==20.0.2 setuptools wheel dumb-init pipenv\n\n# Install pip packages\nCOPY requirements/ /code/\nRUN pip3 install --no-cache-dir --upgrade -r test.txt\n\n# Copy over docker-command (start-up script)\nCOPY bin/docker-command.bash /bin/docker-command.bash\nCOPY bin/review-env-initial-data.bash /bin/review-env-initial-data.bash\nCOPY bin/celery/worker/run.sh /bin/celery/worker/run.sh\n\nRUN dos2unix /bin/docker-command.bash\nRUN dos2unix /bin/review-env-initial-data.bash\n\n# Copy over code directory\nCOPY app/ /code/app/\n\n# Install yarn and set node version\nRUN curl -f -sS https://dl.yarnpkg.com/debian/pubkey.gpg | apt-key add -\nRUN echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | tee /etc/apt/sources.list.d/yarn.list\nRUN apt-get update\nRUN apt-get install --no-install-recommends -y yarn && rm -rf /var/lib/apt/lists/*;\nRUN yarn global add n\nRUN n stable\n\nCOPY package.json /code/\nRUN cd /code && yarn install && yarn cache clean;\n\n# Increase number of file watches (524288 is the max we can set this to)\nRUN echo fs.inotify.max_user_watches=524288 >> /etc/sysctl.conf\n\n# Init\nEXPOSE 9222\nENTRYPOINT [\"/usr/local/bin/dumb-init\", \"--\"]\nWORKDIR /code/app\nCMD [\"gunicorn\", \"-w\", \"1\", \"-b\", \"0.0.0.0:80\", \"--timeout\", \"120\", \"app.wsgi:application\", \"--max-requests=200\"]\n\n# Tag\nARG BUILD_DATETIME\nARG SHA1\nLABEL co.gitcoin.description=\"Gitcoin web application image\" \\\n    co.gitcoin.documentation=\"https://github.com/gitcoinco/web/blob/master/docs/RUNNING_LOCALLY_DOCKER.md\" \\\n    co.gitcoin.licenses=\"AGPL-3.0\" \\\n    co.gitcoin.image.revision=$SHA1 \\\n    co.gitcoin.image.vendor=\"Gitcoin\" \\\n    co.gitcoin.image.source=\"https://github.com/gitcoinco/web\" \\\n    co.gitcoin.image.title=\"Gitcoin Web\" \\\n    co.gitcoin.image.created=$BUILD_DATETIME\n\n"
}