{
  "startTime": 1674249475611,
  "endTime": 1674249476978,
  "originalSmells": [
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 66,
        "lineEnd": 66,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 67,
        "lineEnd": 67,
        "columnStart": 4,
        "columnEnd": 42
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM alpine:3.11 AS alpine\nLABEL maintainer=\"Qing Li <geding.lq@antgroup.com>\"\nRUN apk update && \\\n    apk --no-cache add openjdk11 openjdk8 --repository=http://dl-cdn.alpinelinux.org/alpine/edge/community\n\nFROM centos:8\n\nRUN sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-Linux-* &&\\\n    sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-Linux-*\n\nRUN yum upgrade -y\n\nLABEL maintainer=\"He Sun <bochang.sh@antgroup.com>\"\n\n#The default shell for the RUN instruction is [\"/bin/sh\", \"-c\"], which sometimes cause unexpected error\n#for example \"source a_file\". Use bash as default shell instead.\nSHELL [\"/bin/bash\", \"-c\"]\n\n# since cmake is updated to 3.18.2-9.el8, it must work with libarchive.\nRUN yum install epel-release -y && \\\n    dnf clean all && rm -r /var/cache/dnf && \\\n    dnf group install 'Development Tools' -y && \\\n    dnf -y install dnf-plugins-core && \\\n    dnf -y install https://dl.fedoraproject.org/pub/epel/epel-release-latest-8.noarch.rpm && \\\n    dnf config-manager --set-enabled powertools && \\\n    dnf install -y \\\n    astyle \\\n    bison \\\n    boost-devel \\\n    clang \\\n    cmake \\\n    createrepo \\\n    curl-devel \\\n    expect \\\n    fuse-devel \\\n    fuse-libs \\\n    gawk \\\n    gmp-devel \\\n    golang \\\n    jq \\\n    libarchive \\\n    libcurl-devel \\\n    libmpc-devel \\\n    libxml2-devel \\\n    mod_ssl \\\n    mpfr-devel \\\n    nano \\\n    ocaml \\\n    ocaml-ocamlbuild \\\n    openssl \\\n    openssl-devel \\\n    perl \\\n    protobuf-devel \\\n    python2 \\\n    python3 \\\n    sudo \\\n    wget \\\n    uuid-devel \\\n    vim \\\n    yum-utils \\\n    rsync \\\n    http://downloads.sourceforge.net/ltp/lcov-1.14-1.noarch.rpm && \\\n    alternatives --set python /usr/bin/python2 && rm -rf /var/cache/yum\n\n# Install cpuid tool for tests\nWORKDIR /tmp\nRUN wget https://www.etallen.com/cpuid/cpuid-20200211.x86_64.tar.gz && \\\n    tar -xf ./cpuid-20200211.x86_64.tar.gz && \\\n    cp ./cpuid-20200211/cpuid /usr/bin/ && \\\n    rm -rf /tmp/cpuid-20200211* && rm ./cpuid-20200211.x86_64.tar.gz\n\n# Install Rust\nENV PATH=\"/root/.cargo/bin:$PATH\"\nENV OCCLUM_RUST_VERSION=nightly-2021-11-01\nRUN curl https://sh.rustup.rs -sSf | \\\n        sh -s -- --default-toolchain ${OCCLUM_RUST_VERSION} -y && \\\n    rm -rf /root/.cargo/registry && rm -rf /root/.cargo/git && \\\n    cargo -V\n\n# Install SGX PSW\nWORKDIR /tmp\nRUN echo \"ca_directory=/etc/ssl/certs\" >> /etc/wgetrc && \\\n    wget https://download.01.org/intel-sgx/sgx-linux/2.15.1/distro/centos8.2-server/sgx_rpm_local_repo.tgz && \\\n    tar -xvf sgx_rpm_local_repo.tgz && \\\n    rm sgx_rpm_local_repo.tgz && \\\n    cd /tmp/sgx_rpm_local_repo && \\\n    rpm -ivh libsgx-ae-pce*.rpm \\\n    libsgx-headers*.rpm \\\n    libsgx-ae-qe3*.rpm \\\n    libsgx-ae-qve*.rpm \\\n    libsgx-enclave-common*.rpm \\\n    libsgx-quote-ex*.rpm \\\n    libsgx-urts*.rpm \\\n    libsgx-dcap-ql*.rpm \\\n    libsgx-qe3-logic*.rpm \\\n    libsgx-pce-logic*.rpm \\\n    libsgx-dcap-quote-verify*.rpm \\\n    libsgx-dcap-ql*.rpm \\\n    libsgx-dcap-ql-dev*.rpm \\\n    libsgx-dcap-default-qpl*.rpm \\\n    libsgx-dcap-default-qpl-dev*.rpm \\\n    libsgx-dcap-quote-verify-dev*.rpm \\\n    libsgx-uae-service*.rpm \\\n    libsgx-epid*.rpm \\\n    libsgx-launch*.rpm \\\n    libsgx-ae-le-*.rpm \\\n    libsgx-aesm-launch-plugin-*.rpm \\\n    sgx-aesm-service*.rpm && \\\n    rm -rf /tmp/sgx_rpm_local_repo\n\n# Install SGX SDK\nWORKDIR /tmp\nRUN git clone -b sgx_2.15.1_for_occlum https://github.com/occlum/linux-sgx && \\\n    cd linux-sgx && \\\n    make preparation && \\\n    ./compile_and_install.sh no_mitigation USE_OPT_LIBS=3 && \\\n    echo 'source /opt/intel/sgxsdk/environment' >> /root/.bashrc && \\\n    rm -rf /tmp/linux-sgx\n\n# Download the Occlum source\nARG OCCLUM_BRANCH\nWORKDIR /root\nRUN git clone -b $OCCLUM_BRANCH https://github.com/occlum/occlum && \\\n    cp -r /root/occlum/tools/toolchains/* /tmp/ && mkdir -p /opt/occlum/ && \\\n    cp /root/occlum/tools/docker/start_aesm.sh /opt/occlum/\n\n# Install Occlum toolchain\nWORKDIR /tmp\nRUN cd musl-gcc && ./build.sh && ./install_zlib.sh && rm -rf /tmp/musl-gcc\nENV PATH=\"/opt/occlum/build/bin:/usr/local/occlum/bin:$PATH\"\n\n# Install glibc\nWORKDIR /tmp\nRUN cd glibc && ./build.sh && rm -rf /tmp/glibc\n\n# Install Occlum Golang toolchain\nWORKDIR /tmp\nRUN cd golang && ./build.sh && rm -rf /tmp/golang\nENV PATH=\"/opt/occlum/toolchains/golang/bin:$PATH\"\n\n# Install Occlum Rust toolchain\nWORKDIR /tmp\nRUN cd rust && ./build.sh && rm -rf /tmp/rust\nENV PATH=\"/opt/occlum/toolchains/rust/bin:$PATH\"\nENV LD_LIBRARY_PATH=\"/opt/intel/sgxsdk/sdk_libs\"\n\n# Install Occlum bash\nWORKDIR /tmp\nRUN cd bash && ./build.sh && rm -rf /tmp/bash\n\n# Install Occlum busybox\nWORKDIR /tmp\nRUN cd busybox && ./build.sh && rm -rf /tmp/busybox\n\n# Install Occlum Java toolchain (JDK 11)\nARG JDK11_PATH=/opt/occlum/toolchains/jvm/java-11-openjdk\nCOPY --from=alpine /usr/lib/jvm/java-11-openjdk $JDK11_PATH\nRUN rm $JDK11_PATH/lib/security/cacerts\nCOPY --from=alpine /etc/ssl/certs/java/cacerts $JDK11_PATH/lib/security/cacerts\nWORKDIR /tmp\nRUN cd java && ./install_dragonwell.sh && rm -rf /tmp/java\nENV PATH=\"/opt/occlum/toolchains/jvm/bin:$PATH\"\n\n# Install OpenJDK 8\nARG JDK8_PATH=/opt/occlum/toolchains/jvm/java-1.8-openjdk\nCOPY --from=alpine /usr/lib/jvm/java-1.8-openjdk $JDK8_PATH\nRUN rm $JDK8_PATH/jre/lib/security/cacerts\nCOPY --from=alpine /etc/ssl/certs/java/cacerts $JDK8_PATH/jre/lib/security/cacerts\n\n# Build and install Occlum\nWORKDIR /root\nRUN cd occlum && \\\n    source /opt/intel/sgxsdk/environment && \\\n    make submodule && \\\n    OCCLUM_RELEASE_BUILD=1 make && \\\n    make install && \\\n    cp -r demos /root/demos && \\\n    rm -rf /root/occlum\n\n# Start AESM service automatically\n#\n# To do so, we add the script to ~/.bashrc. We cannot use systemd to run AESM\n# as a \"real\" service since the pid 1 is not systemd in Docker. So we start\n# up AESM service when an user login with an interative shell.\nRUN mkdir -p /var/run/aesmd && echo '/opt/occlum/start_aesm.sh' >> /root/.bashrc\n\nWORKDIR /root\n"
}