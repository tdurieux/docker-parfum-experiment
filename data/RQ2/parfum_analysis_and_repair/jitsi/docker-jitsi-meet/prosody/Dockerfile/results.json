{
  "startTime": 1674217976524,
  "endTime": 1674217977477,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 24,
        "columnEnd": 35
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG JITSI_REPO=jitsi\nARG BASE_TAG=latest\n\nFROM ${JITSI_REPO}/base:${BASE_TAG} as builder\n\nRUN apt-dpkg-wrap apt-get update && \\\n    apt-dpkg-wrap apt-get install -y \\\n      build-essential \\\n      lua5.4 \\\n      liblua5.4-dev \\\n      libsasl2-dev \\\n      libssl-dev \\\n      libreadline-dev \\\n      git \\\n      unzip \\\n      wget && \\\n    mkdir /tmp/luarocks && \\\n    wget -qO - https://luarocks.github.io/luarocks/releases/luarocks-3.8.0.tar.gz | tar xfz - --strip-components 1 -C /tmp/luarocks && \\\n    cd /tmp/luarocks && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" && make && make install && cd - && \\\n    luarocks install cyrussasl 1.1.0-1 && \\\n    luarocks install net-url 0.9-1 && \\\n    luarocks install luajwtjitsi 3.0-0\n\nFROM ${JITSI_REPO}/base:${BASE_TAG}\n\nLABEL org.opencontainers.image.title=\"Prosody IM\"\nLABEL org.opencontainers.image.description=\"XMPP server used for signalling.\"\nLABEL org.opencontainers.image.url=\"https://prosody.im/\"\nLABEL org.opencontainers.image.source=\"https://github.com/jitsi/docker-jitsi-meet\"\nLABEL org.opencontainers.image.documentation=\"https://jitsi.github.io/handbook/\"\n\nARG VERSION_MATRIX_USER_VERIFICATION_SERVICE_PLUGIN=\"1.7.0\"\n\nRUN wget -qO /etc/apt/trusted.gpg.d/prosody.gpg https://prosody.im/files/prosody-debian-packages.key && \\\n    echo \"deb http://packages.prosody.im/debian bullseye main\" > /etc/apt/sources.list.d/prosody.list && \\\n    apt-dpkg-wrap apt-get update && \\\n    apt-dpkg-wrap apt-get install -y \\\n      lua5.4 \\\n      prosody \\\n      libssl1.1 \\\n      libldap-common \\\n      sasl2-bin \\\n      libsasl2-modules-ldap \\\n      lua-basexx \\\n      lua-ldap \\\n      lua-sec \\\n      lua-unbound && \\\n    apt-dpkg-wrap apt-get -d install -y jitsi-meet-prosody && \\\n    dpkg -x /var/cache/apt/archives/jitsi-meet-prosody*.deb /tmp/pkg && \\\n    mv /tmp/pkg/usr/share/jitsi-meet/prosody-plugins /prosody-plugins && \\\n    rm -f /prosody-plugins/token/util.lib.lua && \\\n    wget -qO /prosody-plugins/token/util.lib.lua https://raw.githubusercontent.com/jitsi/jitsi-meet/46dd88c91b63988f516114daee65ff8995c74c56/resources/prosody-plugins/token/util.lib.lua && \\\n    wget -qO /prosody-plugins/mod_auth_cyrus.lua https://hg.prosody.im/prosody-modules/raw-file/65438e4ba563/mod_auth_cyrus/mod_auth_cyrus.lua && \\\n    wget -qO /prosody-plugins/sasl_cyrus.lua https://hg.prosody.im/prosody-modules/raw-file/65438e4ba563/mod_auth_cyrus/sasl_cyrus.lua  && \\\n    apt-cleanup && \\\n    rm -rf /tmp/pkg /var/cache/apt && \\\n    rm -rf /etc/prosody && \\\n    wget https://github.com/matrix-org/prosody-mod-auth-matrix-user-verification/archive/refs/tags/v$VERSION_MATRIX_USER_VERIFICATION_SERVICE_PLUGIN.tar.gz && \\\n    tar -xf v$VERSION_MATRIX_USER_VERIFICATION_SERVICE_PLUGIN.tar.gz && \\\n    mv prosody-mod-auth-matrix-user-verification-$VERSION_MATRIX_USER_VERIFICATION_SERVICE_PLUGIN/mod_auth_matrix_user_verification.lua /prosody-plugins && \\\n    mv prosody-mod-auth-matrix-user-verification-$VERSION_MATRIX_USER_VERIFICATION_SERVICE_PLUGIN/mod_matrix_power_sync.lua /prosody-plugins && \\\n    rm -rf prosody-mod-auth-matrix-user-verification-$VERSION_MATRIX_USER_VERIFICATION_SERVICE_PLUGIN v$VERSION_MATRIX_USER_VERIFICATION_SERVICE_PLUGIN.tar.gz\n\nCOPY rootfs/ /\n\nCOPY --from=builder /usr/local/lib/lua /usr/local/lib/lua\nCOPY --from=builder /usr/local/share/lua /usr/local/share/lua\n\nEXPOSE 5222 5280\n\nVOLUME [\"/config\", \"/prosody-plugins-custom\"]\n"
}