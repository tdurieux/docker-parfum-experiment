{
  "startTime": 1674249768898,
  "endTime": 1674249769994,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 75,
        "lineEnd": 75,
        "columnStart": 8,
        "columnEnd": 36
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# SPDX-License-Identifier: GPL-3.0-or-later\n# author  : paulfantom\n\n# Cross-arch building is achieved by specifying ARCH as a build parameter with `--build-arg` option.\n# It is automated in `build.sh` script\nARG ARCH=amd64-v3.8\nFROM multiarch/alpine:${ARCH} as builder\n\nARG OUTPUT=\"/dev/stdout\"\n# Install prerequisites\nRUN apk --no-cache add alpine-sdk \\\n                       autoconf \\\n                       automake \\\n                       bash \\\n                       build-base \\\n                       curl \\\n                       jq \\\n                       libmnl-dev \\\n                       libuuid \\\n                       lm_sensors \\\n                       netcat-openbsd \\\n                       nodejs \\\n                       pkgconfig \\\n                       py-mysqldb \\\n                       py-psycopg2 \\\n                       py-yaml \\\n                       python \\\n                       util-linux-dev \\\n                       zlib-dev\n\n# Copy source\nCOPY . /opt/netdata.git\nWORKDIR /opt/netdata.git\n\n# Install from source\nRUN chmod +x netdata-installer.sh && \\\n    ./netdata-installer.sh --dont-wait --dont-start-it &>${OUTPUT}\n\n# files to one directory\nRUN mkdir -p /app/usr/sbin/ \\\n             /app/usr/share \\\n             /app/usr/libexec \\\n             /app/usr/lib \\\n             /app/var/cache \\\n             /app/var/lib \\\n             /app/etc && \\\n    mv /usr/share/netdata   /app/usr/share/ && \\\n    mv /usr/libexec/netdata /app/usr/libexec/ && \\\n    mv /usr/lib/netdata     /app/usr/lib/ && \\\n    mv /var/cache/netdata   /app/var/cache/ && \\\n    mv /var/lib/netdata     /app/var/lib/ && \\\n    mv /etc/netdata         /app/etc/ && \\\n    mv /usr/sbin/netdata    /app/usr/sbin/ && \\\n    mv packaging/docker/run.sh        /app/usr/sbin/ && \\\n    chmod +x /app/usr/sbin/run.sh\n\n#####################################################################\nARG ARCH\nFROM multiarch/alpine:${ARCH}\n\n# Install some prerequisites\nRUN apk --no-cache add curl \\\n                       fping \\\n                       jq \\\n                       libuuid \\\n                       lm_sensors \\\n                       netcat-openbsd \\\n                       nodejs \\\n                       py-mysqldb \\\n                       py-psycopg2 \\\n                       py-yaml \\\n                       python\n\n# Conditional subscribiton to Polyverse's Polymorphic Linux repositories\nRUN if [ \"$(uname -m)\" == \"x86_64\" ]; then \\\n        curl -f https://sh.polyverse.io | sh -s install gcxce5byVQbtRz0iwfGkozZwy support+netdata@polyverse.io; \\\n        apk update; \\\n        apk upgrade --available --no-cache; \\\n        sed -in 's/^#//g' /etc/apk/repositories; \\\n    fi\n\n\n# Copy files over\nCOPY --from=builder /app /\n\n# Configure system\nARG NETDATA_UID=201\nARG NETDATA_GID=201\nRUN \\\n    # fping from alpine apk is on a different location. Moving it.\n    mv /usr/sbin/fping /usr/local/bin/fping && \\\n    chmod 4755 /usr/local/bin/fping && \\\n    mkdir -p /var/log/netdata && \\\n    # Add netdata user\n    addgroup -g ${NETDATA_GID} -S netdata && \\\n    adduser -S -H -s /usr/sbin/nologin -u ${NETDATA_GID} -h /etc/netdata -G netdata netdata && \\\n    # Apply the permissions as described in\n    # https://github.com/netdata/netdata/wiki/netdata-security#netdata-directories\n    chown -R root:netdata /etc/netdata && \\\n    chown -R netdata:netdata /var/cache/netdata /var/lib/netdata /usr/share/netdata && \\\n    chown -R root:netdata /usr/lib/netdata && \\\n    chown -R root:netdata /usr/libexec/netdata/plugins.d/apps.plugin /usr/libexec/netdata/plugins.d/cgroup-network && \\\n    chmod 4750 /usr/libexec/netdata/plugins.d/cgroup-network /usr/libexec/netdata/plugins.d/apps.plugin && \\\n    chmod 0750 /var/lib/netdata /var/cache/netdata && \\\n    # Link log files to stdout\n    ln -sf /dev/stdout /var/log/netdata/access.log && \\\n    ln -sf /dev/stdout /var/log/netdata/debug.log && \\\n    ln -sf /dev/stderr /var/log/netdata/error.log\n\nENV NETDATA_PORT 19999\nEXPOSE $NETDATA_PORT\n\nENTRYPOINT [\"/usr/sbin/run.sh\"]\n"
}