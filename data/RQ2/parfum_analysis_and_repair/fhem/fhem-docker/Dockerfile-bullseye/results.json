{
  "startTime": 1674254979722,
  "endTime": 1674254982698,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 458,
        "lineEnd": 459,
        "columnStart": 9,
        "columnEnd": 13
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 461,
        "lineEnd": 463,
        "columnStart": 10,
        "columnEnd": 10
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 465,
        "lineEnd": 472,
        "columnStart": 11,
        "columnEnd": 9
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 427,
        "lineEnd": 429,
        "columnStart": 11,
        "columnEnd": 10
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 452,
        "lineEnd": 453,
        "columnStart": 9,
        "columnEnd": 21
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 455,
        "lineEnd": 457,
        "columnStart": 11,
        "columnEnd": 7
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 452,
        "lineEnd": 453,
        "columnStart": 9,
        "columnEnd": 21
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 455,
        "lineEnd": 457,
        "columnStart": 11,
        "columnEnd": 7
      }
    }
  ],
  "repairedDockerfile": "ARG BASE_IMAGE=\"debian\"\nARG BASE_IMAGE_TAG=\"bullseye\"\nFROM debian:bullseye-20220622-slim\n\n\nARG TARGETPLATFORM\n\nENV LANG=en_US.UTF-8 \\\n   LANGUAGE=en_US:en \\\n   LC_ADDRESS=de_DE.UTF-8 \\\n   LC_MEASUREMENT=de_DE.UTF-8 \\\n   LC_MESSAGES=en_DK.UTF-8 \\\n   LC_MONETARY=de_DE.UTF-8 \\\n   LC_NAME=de_DE.UTF-8 \\\n   LC_NUMERIC=de_DE.UTF-8 \\\n   LC_PAPER=de_DE.UTF-8 \\\n   LC_TELEPHONE=de_DE.UTF-8 \\\n   LC_TIME=de_DE.UTF-8 \\\n   TERM=xterm \\\n   TZ=Europe/Berlin \\\n   LOGFILE=./log/fhem-%Y-%m-%d.log \\\n   TELNETPORT=7072 \\\n   FHEM_UID=6061 \\\n   FHEM_GID=6061 \\\n   FHEM_PERM_DIR=0750 \\\n   FHEM_PERM_FILE=0640 \\\n   UMASK=0037 \\\n   BLUETOOTH_GID=6001 \\\n   GPIO_GID=6002 \\\n   I2C_GID=6003 \\\n   TIMEOUT=10 \\\n   CONFIGTYPE=fhem.cfg\n\n# Install base environment, cache is invalidated here, because we set a BUILD_DATE Variable which changes every run.\nCOPY src/entry.sh src/health-check.sh src/ssh_known_hosts.txt /\nCOPY src/find-* /usr/local/bin/\n\n# Custom installation packages\nARG APT_PKGS=\"\"\n\nRUN chmod 755 /*.sh /usr/local/bin/* \\\n    && sed -i \"s/bullseye main/bullseye main contrib non-free/g\" /etc/apt/sources.list \\\n    && sed -i \"s/bullseye-updates main/bullseye-updates main contrib non-free/g\" /etc/apt/sources.list \\\n    && sed -i \"s/bullseye\\/updates main/bullseye\\/updates main contrib non-free/g\" /etc/apt/sources.list \\\n    && LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get update \\\n    && LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get install -qqy --no-install-recommends \\\n        apt-utils \\\n        ca-certificates \\\n        gnupg \\\n        locales \\\n    && LC_ALL=C c_rehash \\\n    && LC_ALL=C DEBIAN_FRONTEND=noninteractive dpkg-reconfigure locales \\\n    && echo 'de_DE@euro ISO-8859-15\\nde_DE ISO-8859-1\\nde_DE.UTF-8 UTF-8\\nen_DK ISO-8859-1\\nen_DK.ISO-8859-15 ISO-8859-15\\nen_DK.UTF-8 UTF-8\\nen_GB ISO-8859-1\\nen_GB.ISO-8859-15 ISO-8859-15\\nen_GB.UTF-8 UTF-8\\nen_IE ISO-8859-1\\nen_IE.ISO-8859-15 ISO-8859-15\\nen_IE.UTF-8 UTF-8\\nen_US ISO-8859-1\\nen_US.ISO-8859-15 ISO-8859-15\\nen_US.UTF-8 UTF-8\\nes_ES@euro ISO-8859-15\\nes_ES ISO-8859-1\\nes_ES.UTF-8 UTF-8\\nfr_FR@euro ISO-8859-15\\nfr_FR ISO-8859-1\\nfr_FR.UTF-8 UTF-8\\nit_IT@euro ISO-8859-15\\nit_IT ISO-8859-1\\nit_IT.UTF-8 UTF-8\\nnl_NL@euro ISO-8859-15\\nnl_NL ISO-8859-1\\nnl_NL.UTF-8 UTF-8\\npl_PL ISO-8859-2\\npl_PL.UTF-8 UTF-8' >/etc/locale.gen \\\n    && LC_ALL=C locale-gen \\\n    \\\n    && ln -sf /usr/share/zoneinfo/Europe/Berlin /etc/localtime \\\n    && echo \"Europe/Berlin\" > /etc/timezone \\\n    && LC_ALL=C DEBIAN_FRONTEND=noninteractive dpkg-reconfigure tzdata \\\n    \\\n#    && sed -i \"s,http://deb.debian.org,https://cdn-aws.deb.debian.org,g\" /etc/apt/sources.list \\\n#    && sed -i \"s,http://security.debian.org,https://cdn-aws.deb.debian.org,g\" /etc/apt/sources.list \\\n#    && LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get update \\\n    && LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get install -qqy --no-install-recommends \\\n        adb \\\n        android-libadb \\\n        avahi-daemon \\\n        avrdude \\\n        bluez \\\n        curl \\\n        dnsutils \\\n        etherwake \\\n        fonts-liberation \\\n        i2c-tools \\\n        inetutils-ping \\\n        jq \\\n        libcap-ng-utils \\\n        libcap2-bin \\\n        lsb-release \\\n        mariadb-client \\\n        net-tools \\\n        netcat \\\n        openssh-client \\\n        procps \\\n        sendemail \\\n        sqlite3 \\\n        subversion \\\n        sudo \\\n        telnet \\\n        unzip \\\n        usbutils \\\n        wget \\\n        ${APT_PKGS} \\\n    && LC_ALL=C apt-get autoremove -qqy && LC_ALL=C apt-get clean \\\n    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* ~/.[^.] ~/.??* ~/*\n\n# Add Perl basic app layer for pre-compiled packages\nRUN LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get update \\\n    && LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get install -qqy --no-install-recommends \\\n        libarchive-extract-perl \\\n        libarchive-zip-perl \\\n        libcgi-pm-perl \\\n        libcpanel-json-xs-perl \\\n        libdbd-mariadb-perl \\\n        libdbd-mysql-perl \\\n        libdbd-pg-perl \\\n        libdbd-pgsql \\\n        libdbd-sqlite3 \\\n        libdbd-sqlite3-perl \\\n        libdbi-perl \\\n        libdevice-serialport-perl \\\n        libdevice-usb-perl \\\n        libgd-graph-perl \\\n        libgd-text-perl \\\n        libimage-imlib2-perl \\\n        libimage-info-perl \\\n        libimage-librsvg-perl \\\n        libio-all-perl \\\n        libio-file-withpath-perl \\\n        libio-interface-perl \\\n        libio-socket-inet6-perl \\\n        libjson-perl \\\n        libjson-pp-perl \\\n        libjson-xs-perl \\\n        liblist-moreutils-perl \\\n        libmail-gnupg-perl \\\n        libmail-imapclient-perl \\\n        libmail-sendmail-perl \\\n        libmime-base64-perl \\\n        libmime-lite-perl \\\n        libnet-server-perl \\\n        libsocket6-perl \\\n        libterm-readline-perl-perl \\\n        libtext-csv-perl \\\n        libtext-diff-perl \\\n        libtext-iconv-perl \\\n        libtimedate-perl \\\n        libutf8-all-perl \\\n        libwww-curl-perl \\\n        libwww-perl \\\n        libxml-libxml-perl \\\n        libxml-parser-lite-perl \\\n        libxml-parser-perl \\\n        libxml-simple-perl \\\n        libxml-stream-perl \\\n        libxml-treebuilder-perl \\\n        libxml-xpath-perl \\\n        libxml-xpathengine-perl \\\n        libyaml-libyaml-perl \\\n        libyaml-perl \\\n        perl-base \\\n    && LC_ALL=C apt-get autoremove -qqy && LC_ALL=C apt-get clean \\\n    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* ~/.[^.] ~/.??* ~/*\n\n# Custom image layers options:\nARG IMAGE_LAYER_SYS_EXT=\"1\"\n\n# Add extended system layer\nRUN if [ \"${IMAGE_LAYER_SYS_EXT}\" != \"0\" ]; then \\\n      LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get update \\\n      && LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get install -qqy --no-install-recommends \\\n        alsa-utils \\\n        dfu-programmer \\\n        espeak \\\n        ffmpeg \\\n        lame \\\n        libnmap-parser-perl \\\n        libttspico-utils \\\n        mp3wrap \\\n        mpg123 \\\n        mplayer \\\n        nmap \\\n        normalize-audio \\\n        snmp \\\n        snmp-mibs-downloader \\\n        sox \\\n        vorbis-tools \\\n      && LC_ALL=C apt-get autoremove -qqy && LC_ALL=C apt-get clean \\\n      && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* ~/.[^.] ~/.??* ~/* \\\n    ; fi\n\n\n# Custom image layers options:\nARG IMAGE_LAYER_PERL_EXT=\"1\"\n\n# Add Perl extended app layer for pre-compiled packages\nRUN if [ \"${IMAGE_LAYER_PERL_EXT}\" != \"0\" ]; then \\\n      LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get update \\\n      && LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get install -qqy --no-install-recommends \\\n        libalgorithm-merge-perl \\\n        libauthen-bitcard-perl \\\n        libauthen-captcha-perl \\\n        libauthen-cas-client-perl \\\n        libauthen-dechpwd-perl \\\n        libauthen-htpasswd-perl \\\n        libauthen-krb5-admin-perl \\\n        libauthen-krb5-perl \\\n        libauthen-krb5-simple-perl \\\n        libauthen-libwrap-perl \\\n        libauthen-ntlm-perl \\\n        libauthen-oath-perl \\\n        libauthen-pam-perl \\\n        libauthen-passphrase-perl \\\n        libauthen-radius-perl \\\n        libauthen-sasl-cyrus-perl \\\n        libauthen-sasl-perl \\\n        libauthen-sasl-saslprep-perl \\\n        libauthen-scram-perl \\\n        libauthen-simple-cdbi-perl \\\n        libauthen-simple-dbi-perl \\\n        libauthen-simple-dbm-perl \\\n        libauthen-simple-http-perl \\\n        libauthen-simple-kerberos-perl \\\n        libauthen-simple-ldap-perl \\\n        libauthen-simple-net-perl \\\n        libauthen-simple-pam-perl \\\n        libauthen-simple-passwd-perl \\\n        libauthen-simple-perl \\\n        libauthen-simple-radius-perl \\\n        libauthen-simple-smb-perl \\\n        libauthen-smb-perl \\\n        libauthen-tacacsplus-perl \\\n        libauthen-u2f-perl \\\n        libauthen-u2f-tester-perl \\\n        libclass-dbi-mysql-perl \\\n        libclass-isa-perl \\\n        libclass-loader-perl \\\n        libcommon-sense-perl \\\n        libconvert-base32-perl \\\n        libcpan-meta-yaml-perl \\\n        libcrypt-blowfish-perl \\\n        libcrypt-cast5-perl \\\n        libcrypt-cbc-perl \\\n        libcrypt-ciphersaber-perl \\\n        libcrypt-cracklib-perl \\\n        libcrypt-des-ede3-perl \\\n        libcrypt-des-perl \\\n        libcrypt-dh-gmp-perl \\\n        libcrypt-dh-perl \\\n        libcrypt-dsa-perl \\\n        libcrypt-ecb-perl \\\n        libcrypt-eksblowfish-perl \\\n        libcrypt-format-perl \\\n        libcrypt-gcrypt-perl \\\n        libcrypt-generatepassword-perl \\\n        libcrypt-hcesha-perl \\\n        libcrypt-jwt-perl \\\n        libcrypt-mysql-perl \\\n        libcrypt-openssl-bignum-perl \\\n        libcrypt-openssl-dsa-perl \\\n        libcrypt-openssl-ec-perl \\\n        libcrypt-openssl-pkcs10-perl \\\n        libcrypt-openssl-pkcs12-perl \\\n        libcrypt-openssl-random-perl \\\n        libcrypt-openssl-rsa-perl \\\n        libcrypt-openssl-x509-perl \\\n        libcrypt-passwdmd5-perl \\\n        libcrypt-pbkdf2-perl \\\n        libcrypt-random-seed-perl \\\n        libcrypt-random-source-perl \\\n        libcrypt-rc4-perl \\\n        libcrypt-rijndael-perl \\\n        libcrypt-rsa-parse-perl \\\n        libcrypt-saltedhash-perl \\\n        libcrypt-simple-perl \\\n        libcrypt-smbhash-perl \\\n        libcrypt-smime-perl \\\n        libcrypt-ssleay-perl \\\n        libcrypt-twofish-perl \\\n        libcrypt-u2f-server-perl \\\n        libcrypt-unixcrypt-perl \\\n        libcrypt-unixcrypt-xs-perl \\\n        libcrypt-urandom-perl \\\n        libcrypt-util-perl \\\n        libcrypt-x509-perl \\\n        libcryptx-perl \\\n        libdata-dump-perl \\\n        libdatetime-format-strptime-perl \\\n        libdatetime-perl \\\n        libdevel-size-perl \\\n        libdigest-bcrypt-perl \\\n        libdigest-bubblebabble-perl \\\n        libdigest-crc-perl \\\n        libdigest-elf-perl \\\n        libdigest-hmac-perl \\\n        libdigest-jhash-perl \\\n        libdigest-md2-perl \\\n        libdigest-md4-perl \\\n        libdigest-md5-file-perl \\\n        libdigest-perl-md5-perl \\\n        libdigest-sha-perl \\\n        libdigest-sha3-perl \\\n        libdigest-ssdeep-perl \\\n        libdigest-whirlpool-perl \\\n        libdpkg-perl \\\n        libencode-perl \\\n        liberror-perl \\\n        libev-perl \\\n        libextutils-makemaker-cpanfile-perl \\\n        libfile-copy-recursive-perl \\\n        libfile-fcntllock-perl \\\n        libfinance-quote-perl \\\n        libgnupg-interface-perl \\\n        libhtml-strip-perl \\\n        libhtml-treebuilder-xpath-perl \\\n        libio-socket-inet6-perl \\\n        libio-socket-ip-perl \\\n        libio-socket-multicast-perl \\\n        libio-socket-portstate-perl \\\n        libio-socket-socks-perl \\\n        libio-socket-ssl-perl \\\n        libio-socket-timeout-perl \\\n        liblinux-inotify2-perl \\\n        libmath-round-perl \\\n        libmodule-pluggable-perl \\\n        libmojolicious-perl \\\n        libmoose-perl \\\n        libmoox-late-perl \\\n        libmp3-info-perl \\\n        libmp3-tag-perl \\\n        libnet-address-ip-local-perl \\\n        libnet-bonjour-perl \\\n        libnet-jabber-perl \\\n        libnet-oauth-perl \\\n        libnet-oauth2-perl \\\n        libnet-sip-perl \\\n        libnet-snmp-perl \\\n        libnet-ssleay-perl \\\n        libnet-telnet-perl \\\n        libnet-xmpp-perl \\\n        libnmap-parser-perl \\\n        librivescript-perl \\\n        librpc-xml-perl \\\n        libsnmp-perl \\\n        libsnmp-session-perl \\\n        libsoap-lite-perl \\\n        libsocket-perl \\\n        libswitch-perl \\\n        libsys-hostname-long-perl \\\n        libsys-statistics-linux-perl \\\n        libterm-readkey-perl \\\n        libterm-readline-perl-perl \\\n        libtime-period-perl \\\n        libtypes-path-tiny-perl \\\n        liburi-escape-xs-perl \\\n        perl \\\n      && LC_ALL=C apt-get autoremove -qqy && LC_ALL=C apt-get clean \\\n      && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* ~/.[^.] ~/.??* ~/* \\\n    ; fi\n\n# Custom image layers options:\nARG IMAGE_LAYER_DEV=\"1\"\n\n# Add development/compilation layer\nRUN if [ \"${IMAGE_LAYER_DEV}\" != \"0\" ] || [ \"${IMAGE_LAYER_PERL_CPAN}\" != \"0\" ] || [ \"${IMAGE_LAYER_PERL_CPAN_EXT}\" != \"0\" ] || [ \"${IMAGE_LAYER_PYTHON}\" != \"0\" ] || [ \"${IMAGE_LAYER_PYTHON_EXT}\" != \"0\" ] || [ \"${IMAGE_LAYER_NODEJS}\" != \"0\" ] || [ \"${IMAGE_LAYER_NODEJS_EXT}\" != \"0\" ]; then \\\n      LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get update \\\n      && LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get install -qqy --no-install-recommends \\\n        autoconf \\\n        automake \\\n        build-essential \\\n        libavahi-compat-libdnssd-dev \\\n        libdb-dev \\\n        libsodium-dev \\\n        libssl-dev \\\n        libtool \\\n        libusb-1.0-0-dev \\\n        patch \\\n      && LC_ALL=C apt-get autoremove -qqy && LC_ALL=C apt-get clean \\\n      && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* ~/.[^.] ~/.??* ~/* \\\n    ; fi\n\n\n# Custom image layers options:\nARG IMAGE_LAYER_PERL_CPAN=\"1\"\nARG IMAGE_LAYER_PERL_CPAN_EXT=\"1\"\n\n# Custom installation packages\nARG CPAN_PKGS=\"\"\n\n# Add Perl app layer for self-compiled modules\n#  * exclude any ARM platforms due to long build time\n#  * manually pre-compiled ARM packages may be applied here\nRUN if [ \"${CPAN_PKGS}\" != \"\" ] || [ \"${PIP_PKGS}\" != \"\" ] || [ \"${IMAGE_LAYER_PERL_CPAN}\" != \"0\" ] || [ \"${IMAGE_LAYER_PERL_CPAN_EXT}\" != \"0\" ] || [ \"${IMAGE_LAYER_PYTHON}\" != \"0\" ] || [ \"${IMAGE_LAYER_PYTHON_EXT}\" != \"0\" ]; then \\\n      curl --retry 3 --retry-connrefused --retry-delay 2 -fsSL https://git.io/cpanm | perl - App::cpanminus \\\n      && cpanm --notest \\\n          App::cpanoutdated \\\n          CPAN::Plugin::Sysdeps \\\n          Perl::PrereqScanner::NotQuiteLite \\\n      && if [ \"${CPAN_PKGS}\" != \"\" ]; then \\\n          cpanm \\\n           ${CPAN_PKGS} \\\n         ; fi \\\n      && if [ \"${IMAGE_LAYER_PERL_CPAN_EXT}\" != \"0\" ]; then \\\n           if [ \"${TARGETPLATFORM}\" = \"linux/amd64\" ] || [ \"${TARGETPLATFORM}\" = \"linux/i386\" ]; then \\\n             cpanm --notest \\\n              Alien::Base::ModuleBuild \\\n              Alien::Sodium \\\n              Crypt::Argon2 \\\n              Crypt::OpenSSL::AES \\\n              Device::SMBus \\\n              Net::MQTT::Constants \\\n              Net::MQTT::Simple \\\n              Net::WebSocket::Server \\\n              Device::Firmata \\\n             ; fi \\\n         ; fi \\\n      && rm -rf /root/.cpanm \\\n      && LC_ALL=C apt-get autoremove -qqy && LC_ALL=C apt-get clean \\\n      && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* ~/.[^.] ~/.??* ~/* \\\n    ; fi\n\n# Custom image layers options:\nARG IMAGE_LAYER_PYTHON=\"1\"\nARG IMAGE_LAYER_PYTHON_EXT=\"1\"\n\n# Custom installation packages\nARG PIP_PKGS=\"\"\n\n# Add Python app layer\nRUN if [ \"${PIP_PKGS}\" != \"\" ] || [ \"${IMAGE_LAYER_PYTHON}\" != \"0\" ] || [ \"${IMAGE_LAYER_PYTHON_EXT}\" != \"0\" ]; then \\\n      LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get update \\\n      && LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get install -qqy --no-install-recommends \\\n        python3 \\\n        python3-dev \\\n        python3-pip \\\n        python3-setuptools \\\n        python3-wheel \\\n      && if [ \"${PIP_PKGS}\" != \"\" ]; then \\\n           pip3 install --no-cache-dir \\\n            ${PIP_PKGS} \\\n         ; fi \\\n      && if [ \"${IMAGE_LAYER_PYTHON_EXT}\" != \"0\" ]; then \\\n           LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get install -qqy --no-install-recommends \\\n                python3-pychromecast \\\n                speedtest-cli \\\n                youtube-dl \\\n             && ln -s ../../bin/speedtest-cli /usr/local/bin/speedtest-cli \\\n        ; fi \\\n      && rm -rf /root/.cpanm \\\n      && LC_ALL=C apt-get autoremove -qqy && LC_ALL=C apt-get clean \\\n      && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* ~/.[^.] ~/.??* ~/* \\\n    ; fi\n\n# Custom installation packages\nARG NPM_PKGS=\"\"\n\n# Custom image layers options:\nARG IMAGE_LAYER_NODEJS=\"1\"\nARG IMAGE_LAYER_NODEJS_EXT=\"1\"\n\n# Add nodejs app layer\nRUN if ( [ \"${NPM_PKGS}\" != \"\" ] || [ \"${IMAGE_LAYER_NODEJS}\" != \"0\" ] || [ \"${IMAGE_LAYER_NODEJS_EXT}\" != \"0\" ] ) ; then \\\n      LC_ALL=C curl --retry 3 --retry-connrefused --retry-delay 2 -fsSL https://deb.nodesource.com/setup_14.x | LC_ALL=C bash - \\\n      && LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get install -qqy --no-install-recommends \\\n          nodejs=14.* \\\n      && if [ ! -e /usr/bin/npm ]; then \\\n           LC_ALL=C DEBIAN_FRONTEND=noninteractive apt-get install -qqy --no-install-recommends \\\n             npm=5.* \\\n      ; fi \\\n      && npm install -g --unsafe-perm --production \\\n          npm \\\n      && if [ \"${NPM_PKGS}\" != \"\" ]; then \\\n          npm install -g --unsafe-perm --production \\\n           ${NPM_PKGS} \\\n         ; fi \\\n      && if [ \"${IMAGE_LAYER_NODEJS_EXT}\" != \"0\" ]; then \\\n           npm install -g --unsafe-perm --production \\\n            alexa-cookie2 \\\n            alexa-fhem \\\n            gassistant-fhem \\\n            homebridge \\\n            homebridge-fhem \\\n            tradfri-fhem \\\n        ; fi \\\n      && LC_ALL=C apt-get autoremove -qqy && LC_ALL=C apt-get clean \\\n      && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* ~/.[^.] ~/.??* ~/* \\\n    ; npm cache clean --force; fi\n\n# Add FHEM app layer\n# Note: Manual checkout is required if build is not run by Github Actions workflow:\n#   svn co https://svn.fhem.de/fhem/trunk ./src/fhem/trunk\n\nCOPY src/fhem/trunk/fhem/ /fhem/\nCOPY src/FHEM/ /fhem/FHEM\n\n# Moved AGS to the end, because it changes every run and invalidates the cache for all following steps  https://github.com/moby/moby/issues/20136\n# Arguments to instantiate as variables\nARG PLATFORM=\"linux\"\nARG TAG=\"\"\nARG IMAGE_VCS_REF=\"\"\nARG VCS_REF=\"\"\nARG FHEM_VERSION=\"\"\nARG IMAGE_VERSION=\"\"\nARG BUILD_DATE=\"\"\n\n# Re-usable variables during build\nARG L_AUTHORS=\"Julian Pawlowski (Forum.fhem.de:@loredo, Twitter:@loredo)\"\nARG L_URL=\"https://hub.docker.com/r/fhem/fhem-${TARGETPLATFORM}\"\nARG L_USAGE=\"https://github.com/fhem/fhem-docker/blob/${IMAGE_VCS_REF}/README.md\"\nARG L_VCS_URL=\"https://github.com/fhem/fhem-docker/\"\nARG L_VENDOR=\"Julian Pawlowski\"\nARG L_LICENSES=\"MIT\"\nARG L_TITLE=\"fhem-${TARGETPLATFORM}\"\nARG L_DESCR=\"A basic Docker image for FHEM house automation system, based on Debian Bullseye.\"\n\nARG L_AUTHORS_FHEM=\"https://fhem.de/MAINTAINER.txt\"\nARG L_URL_FHEM=\"https://fhem.de/\"\nARG L_USAGE_FHEM=\"https://fhem.de/#Documentation\"\nARG L_VCS_URL_FHEM=\"https://svn.fhem.de/\"\nARG L_VENDOR_FHEM=\"FHEM e.V.\"\nARG L_LICENSES_FHEM=\"GPL-2.0\"\nARG L_DESCR_FHEM=\"FHEM (TM) is a GPL'd perl server for house automation. It is used to automate some common tasks in the household like switching lamps / shutters / heating / etc. and to log events like temperature / humidity / power consumption.\"\n\n\n# non-standard labels\nLABEL org.fhem.authors=${L_AUTHORS_FHEM} \\\n   org.fhem.url=${L_URL_FHEM} \\\n   org.fhem.documentation=${L_USAGE_FHEM} \\\n   org.fhem.source=${L_VCS_URL_FHEM} \\\n   org.fhem.version=${FHEM_VERSION} \\\n   org.fhem.revision=${VCS_REF} \\\n   org.fhem.vendor=${L_VENDOR_FHEM} \\\n   org.fhem.licenses=${L_LICENSES_FHEM} \\\n   org.fhem.description=${L_DESCR_FHEM}\n\n# annotation labels according to\n# https://github.com/opencontainers/image-spec/blob/v1.0.1/annotations.md#pre-defined-annotation-keys\nLABEL org.opencontainers.image.created=${BUILD_DATE} \\\n   org.opencontainers.image.authors=${L_AUTHORS} \\\n   org.opencontainers.image.url=${L_URL} \\\n   org.opencontainers.image.documentation=${L_USAGE} \\\n   org.opencontainers.image.source=${L_VCS_URL} \\\n   org.opencontainers.image.version=${IMAGE_VERSION} \\\n   org.opencontainers.image.revision=${IMAGE_VCS_REF} \\\n   org.opencontainers.image.vendor=${L_VENDOR} \\\n   org.opencontainers.image.licenses=${L_LICENSES} \\\n   org.opencontainers.image.title=${L_TITLE} \\\n   org.opencontainers.image.description=${L_DESCR}\n\nRUN echo \"org.opencontainers.image.created=${BUILD_DATE}\\norg.opencontainers.image.authors=${L_AUTHORS}\\norg.opencontainers.image.url=${L_URL}\\norg.opencontainers.image.documentation=${L_USAGE}\\norg.opencontainers.image.source=${L_VCS_URL}\\norg.opencontainers.image.version=${IMAGE_VERSION}\\norg.opencontainers.image.revision=${IMAGE_VCS_REF}\\norg.opencontainers.image.vendor=${L_VENDOR}\\norg.opencontainers.image.licenses=${L_LICENSES}\\norg.opencontainers.image.title=${L_TITLE}\\norg.opencontainers.image.description=${L_DESCR}\\norg.fhem.authors=${L_AUTHORS_FHEM}\\norg.fhem.url=${L_URL_FHEM}\\norg.fhem.documentation=${L_USAGE_FHEM}\\norg.fhem.source=${L_VCS_URL_FHEM}\\norg.fhem.version=${FHEM_VERSION}\\norg.fhem.revision=${VCS_REF}\\norg.fhem.vendor=${L_VENDOR_FHEM}\\norg.fhem.licenses=${L_LICENSES_FHEM}\\norg.fhem.description=${L_DESCR_FHEM}\" > /image_info\n\nVOLUME [ \"/opt/fhem\" ]\n\nEXPOSE 8083\n\nHEALTHCHECK --interval=20s --timeout=10s --start-period=60s --retries=5 CMD /health-check.sh\n\nWORKDIR \"/opt/fhem\"\nENTRYPOINT [ \"/entry.sh\" ]\nCMD [ \"start\" ]\n"
}