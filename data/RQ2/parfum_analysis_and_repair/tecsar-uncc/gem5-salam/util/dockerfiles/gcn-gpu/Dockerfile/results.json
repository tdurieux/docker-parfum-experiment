{
  "startTime": 1674249779778,
  "endTime": 1674249780791,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 111,
        "lineEnd": 111,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 29,
        "lineEnd": 32,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 22,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 60,
        "lineEnd": 60,
        "columnStart": 4,
        "columnEnd": 78
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 84,
        "lineEnd": 84,
        "columnStart": 4,
        "columnEnd": 82
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 111,
        "lineEnd": 111,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 29,
        "lineEnd": 32,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 60,
        "lineEnd": 60,
        "columnStart": 4,
        "columnEnd": 78
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 84,
        "lineEnd": 84,
        "columnStart": 4,
        "columnEnd": 82
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 111,
        "lineEnd": 111,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 29,
        "lineEnd": 32,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 22,
        "columnEnd": 64
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 60,
        "lineEnd": 60,
        "columnStart": 4,
        "columnEnd": 78
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 84,
        "lineEnd": 84,
        "columnStart": 4,
        "columnEnd": 82
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 111,
        "lineEnd": 111,
        "columnStart": 4,
        "columnEnd": 52
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 29,
        "lineEnd": 32,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 97
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 4,
        "columnEnd": 62
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 60,
        "lineEnd": 60,
        "columnStart": 4,
        "columnEnd": 102
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 84,
        "lineEnd": 84,
        "columnStart": 4,
        "columnEnd": 106
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 76
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 111,
        "lineEnd": 111,
        "columnStart": 4,
        "columnEnd": 79
      }
    }
  ],
  "repairedDockerfile": "# Copyright (c) 2021 Kyle Roarty\n# All Rights Reserved.\n#\n# Redistribution and use in source and binary forms, with or without\n# modification, are permitted provided that the following conditions are\n# met: redistributions of source code must retain the above copyright\n# notice, this list of conditions and the following disclaimer;\n# redistributions in binary form must reproduce the above copyright\n# notice, this list of conditions and the following disclaimer in the\n# documentation and/or other materials provided with the distribution;\n# neither the name of the copyright holders nor the names of its\n# contributors may be used to endorse or promote products derived from\n# this software without specific prior written permission.\n#\n# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n# \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n# LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n# A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n# OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n# SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n# LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n# DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n# THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\nFROM ubuntu:20.04\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt -y update\nRUN apt -y upgrade\nRUN apt -y --no-install-recommends install build-essential git m4 scons zlib1g zlib1g-dev \\\n    libprotobuf-dev protobuf-compiler libprotoc-dev libgoogle-perftools-dev \\\n    python3-dev python3-six python-is-python3 doxygen libboost-all-dev \\\n    libhdf5-serial-dev python3-pydot libpng-dev libelf-dev pkg-config && rm -rf /var/lib/apt/lists/*;\n\n# Requirements for ROCm\nRUN apt -y --no-install-recommends install cmake mesa-common-dev libgflags-dev libgoogle-glog-dev && rm -rf /var/lib/apt/lists/*;\n\n# Needed to get ROCm repo, build packages\nRUN apt -y --no-install-recommends install wget gnupg2 rpm && rm -rf /var/lib/apt/lists/*;\n\nRUN wget -q -O - https://repo.radeon.com/rocm/rocm.gpg.key | apt-key add -\n\n# ROCm webpage says to use debian main, but the individual versions\n# only have xenial\nRUN echo 'deb [arch=amd64] https://repo.radeon.com/rocm/apt/4.0.1/ xenial main' | tee /etc/apt/sources.list.d/rocm.list\n\nRUN apt-get update && apt -y --no-install-recommends install hsakmt-roct hsakmt-roct-dev && rm -rf /var/lib/apt/lists/*;\nRUN ln -s /opt/rocm-4.0.1 /opt/rocm\n\nRUN git clone -b rocm-4.0.0 https://github.com/RadeonOpenCompute/ROCR-Runtime.git && \\\n    mkdir -p /ROCR-Runtime/src/build\n\nWORKDIR /ROCR-Runtime/src/build\n# need MEMFD_CREATE=OFF as MEMFD_CREATE syscall isn't implemented\nRUN cmake -DIMAGE_SUPPORT=OFF -DHAVE_MEMFD_CREATE=OFF \\\n    -DCMAKE_BUILD_TYPE=Release .. && make -j$(nproc) && make package\nRUN apt -y --no-install-recommends install ./hsa-rocr-dev*.deb && rm -rf /var/lib/apt/lists/*;\nWORKDIR /\n\n# Dependencies for ROCclr\nRUN apt -y --no-install-recommends install llvm-amdgpu libncurses5 libtinfo-dev rocm-device-libs comgr && rm -rf /var/lib/apt/lists/*;\n\nRUN git clone -b rocm-4.0.0 \\\n    https://github.com/ROCm-Developer-Tools/ROCclr.git && \\\n    mkdir -p ROCclr/build\n\nRUN git clone -b rocm-4.0.0 \\\n    https://github.com/RadeonOpenCompute/ROCm-OpenCL-Runtime.git && \\\n    mkdir -p ROCm-OpenCL-Runtime/build\n\nWORKDIR /ROCclr\n# The patch allows us to avoid building blit kernels on-the-fly in gem5\nRUN wget -q -O - dist.gem5.org/dist/v21-1/rocm_patches/ROCclr.patch | git apply -v\n\nWORKDIR /ROCclr/build\nRUN cmake -DOPENCL_DIR=\"/ROCm-OpenCL-Runtime\" \\\n    -DCMAKE_BUILD_TYPE=Release .. && \\\n    make -j$(nproc) && make install\nWORKDIR /\n\nWORKDIR ROCm-OpenCL-Runtime/build\nRUN cmake -DUSE_COMGR_LIBRARY=ON -DCMAKE_PREFIX_PATH=\"/opt/rocm\" \\\n    -DCMAKE_BUILD_TYPE=Release .. && \\\n    make -j$(nproc) && make package\nRUN apt -y --no-install-recommends install ./rocm-opencl-2.0.0-amd64.deb ./rocm-opencl-dev-2.0.0-amd64.deb && rm -rf /var/lib/apt/lists/*;\nWORKDIR /\n\nRUN git clone -b rocm-4.0.0 \\\n    https://github.com/ROCm-Developer-Tools/HIP.git && mkdir -p HIP/build\n\nWORKDIR HIP/build\nRUN cmake -DCMAKE_BUILD_TYPE=Release -DHSA_PATH=/usr/hsa \\\n    -DHIP_COMPILER=clang -DHIP_PLATFORM=rocclr -DCMAKE_PREFIX_PATH=\"/opt/rocm\"\\\n    .. && make -j$(nproc) && make package\nRUN apt -y --no-install-recommends install ./hip-base*.deb ./hip-rocclr*.deb && rm -rf /var/lib/apt/lists/*;\n# These files here are needed but don't get installed through the .deb file,\n# even though they seem to be included in the packaging, so symlink them\nRUN ln -s /HIP/build/rocclr/CMakeFiles/Export/_opt/rocm/hip/lib/cmake/hip/* /opt/rocm/hip/lib/cmake/hip/\nWORKDIR /\n\nRUN git clone -b rocm-4.0.0 \\\n    https://github.com/ROCmSoftwarePlatform/rocBLAS.git && mkdir rocBLAS/build\n\nENV HCC_AMDGPU_TARGET=gfx801\nWORKDIR rocBLAS\n# rocBLAS needs to be built from source otherwise gfx801 gets an error in HIP\n# about there being no GPU binary available\nRUN ./install.sh -d -a all -i\nWORKDIR /\n\n# MIOpen dependencies + MIOpen\nRUN apt install -y --no-install-recommends rocm-cmake rocm-clang-ocl miopen-hip && rm -rf /var/lib/apt/lists/*;\n\n# Clone MIOpen repo so that we have the kernel sources available\nRUN git clone -b rocm-4.0.1 https://github.com/ROCmSoftwarePlatform/MIOpen.git\n\n# Make the MIOpen cache dir ahead of time and symlink for easier access\n# when linking in the database file\nRUN mkdir -p /root/.cache/miopen/2.9.0.8252-rocm-rel-4.0-26-64506314 && \\\n    ln -s /root/.cache/miopen/2.9.0.8252-rocm-rel-4.0-26-64506314 /root/.cache/miopen/2.9.0\n"
}