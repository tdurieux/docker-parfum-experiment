{
  "startTime": 1674248014207,
  "endTime": 1674248014601,
  "originalSmells": [
    {
      "rule": "yarnCacheCleanAfterInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 28
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG PYTHON_RUNTIME_REPO=python\nARG PYTHON_RUNTIME_VERSION=3.9.5\n\nARG NODEJS_BUILD_REPO=node\nARG NODEJS_BUILD_VERSION=16.15.1\n\nFROM ${PYTHON_RUNTIME_REPO}:${PYTHON_RUNTIME_VERSION} as core-image\n\n# Create maestro user\nRUN useradd -ms /bin/bash maestro\nUSER maestro\nRUN mkdir /home/maestro/app\nWORKDIR /home/maestro/app\n\nENV PATH=\"/home/maestro/.local/bin:${PATH}\"\n\nRUN python -m pip install --upgrade pip==22.0.4\nRUN python -m pip install pipenv==2022.3.23\n\nCOPY --chown=maestro:maestro api .\nRUN rm -rf frontend\n\n# PYTHON BUILD\nFROM core-image as build\n\nCOPY --chown=maestro:maestro --from=core-image /home/maestro/app /home/maestro/app\n\nRUN python -m pipenv install --system --dev\n\n# FRONTEND BUILD\nFROM ${NODEJS_BUILD_REPO}:${NODEJS_BUILD_VERSION} as frontend-build\n\n# Create maestro user\nRUN useradd -ms /bin/bash maestro\nUSER maestro\nRUN mkdir /home/maestro/app\nWORKDIR /home/maestro/app\n\nCOPY --chown=maestro:maestro frontend .\n\nRUN yarn install --immutable && yarn cache clean;\n\nRUN yarn build\n\n\n# RUNTIME PYTHON IMAGE\nFROM core-image as runtime-image\n\nCOPY --chown=maestro:maestro --from=core-image /home/maestro/app /home/maestro/app\n\nRUN mkdir /home/maestro/app/frontend_build\nCOPY --chown=maestro:maestro --from=frontend-build /home/maestro/app/build /home/maestro/app/frontend_build\n\nRUN python -m pipenv install --system --deploy\n\nENTRYPOINT [\"bash\",\"docker-entrypoint.sh\"]\n\n"
}