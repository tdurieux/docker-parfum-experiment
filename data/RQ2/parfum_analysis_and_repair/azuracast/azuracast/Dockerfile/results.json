{
  "startTime": 1674220341966,
  "endTime": 1674220343213,
  "originalSmells": [
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 7,
        "columnEnd": 61
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# Icecast build stage (for later copy)\n#\nFROM ghcr.io/azuracast/icecast-kh-ac:2.4.0-kh15-ac2 AS icecast\n\n#\n# MariaDB stage (for later copy)\n#\nFROM mariadb:10.7-focal AS mariadb\n\n#\n# Golang dependencies build step\n#\nFROM golang:1.17-buster AS dockerize\n\nRUN apt-get update \\\n    && apt-get install -y --no-install-recommends openssl git && rm -rf /var/lib/apt/lists/*;\n\nRUN go install github.com/jwilder/dockerize@latest\n\n#\n# Final build image\n#\nFROM ubuntu:focal\n\nENV TZ=\"UTC\"\n\n# Add Dockerize\nCOPY --from=dockerize /go/bin/dockerize /usr/local/bin\n\n# Import Icecast-KH from build container\nCOPY --from=icecast /usr/local/bin/icecast /usr/local/bin/icecast\nCOPY --from=icecast /usr/local/share/icecast /usr/local/share/icecast\n\n# Import MariaDB scripts.\nCOPY --from=mariadb /usr/local/bin/healthcheck.sh /usr/local/bin/db_healthcheck.sh\nCOPY --from=mariadb /usr/local/bin/docker-entrypoint.sh /usr/local/bin/db_entrypoint.sh\n\n# Run base build process\nCOPY ./util/docker/common /bd_build/\nRUN chmod a+x /bd_build/*.sh \\\n    && /bd_build/prepare.sh \\\n    && /bd_build/add_user.sh \\\n    && /bd_build/cleanup.sh \\\n    && rm -rf /bd_build\n\n# Build each set of dependencies in their own step for cacheability.\nARG ARM_FULL_BUILD\n\nCOPY ./util/docker/supervisor /bd_build/supervisor/\nRUN bash /bd_build/supervisor/setup.sh \\\n    && rm -rf /bd_build/supervisor\n\nCOPY ./util/docker/stations /bd_build/stations/\nRUN bash /bd_build/stations/setup.sh \\\n    && rm -rf /bd_build/stations\n\nCOPY ./util/docker/web /bd_build/web/\nRUN bash /bd_build/web/setup.sh \\\n    && rm -rf /bd_build/web\n\nCOPY ./util/docker/mariadb /bd_build/mariadb/\nRUN bash /bd_build/mariadb/setup.sh \\\n    && rm -rf /bd_build/mariadb\n\nCOPY ./util/docker/redis /bd_build/redis/\nRUN bash /bd_build/redis/setup.sh \\\n    && rm -rf /bd_build/redis\n\n#\n# START Operations as `azuracast` user\n#\nUSER azuracast\n\nWORKDIR /var/azuracast/www\n\nCOPY --chown=azuracast:azuracast ./composer.json ./composer.lock ./\nRUN composer install \\\n    --no-dev \\\n    --no-ansi \\\n    --no-autoloader \\\n    --no-interaction\n\nCOPY --chown=azuracast:azuracast . .\n\nRUN composer dump-autoload --optimize --classmap-authoritative \\\n    && touch /var/azuracast/.docker\n\nVOLUME [\"/var/azuracast/stations\", \"/var/azuracast/uploads\", \"/var/azuracast/backups\", \"/var/azuracast/sftpgo/persist\", \"/var/azuracast/servers/shoutcast2\"]\nENV PATH=\"${PATH}:/var/azuracast/servers/shoutcast2\"\n\n#\n# END Operations as `azuracast` user\n#\nUSER root\n\nEXPOSE 80 2022\nEXPOSE 8000-8999\n\n# Sensible default environment variables.\nENV LANG=\"en_US.UTF-8\" \\\n    DOCKER_IS_STANDALONE=\"true\" \\\n    APPLICATION_ENV=\"production\" \\\n    MARIADB_AUTO_UPGRADE=1 \\\n    MYSQL_HOST=\"localhost\" \\\n    MYSQL_PORT=3306 \\\n    MYSQL_USER=\"azuracast\" \\\n    MYSQL_PASSWORD=\"azur4c457\" \\\n    MYSQL_DATABASE=\"azuracast\" \\\n    ENABLE_REDIS=\"true\" \\\n    REDIS_HOST=\"localhost\" \\\n    REDIS_PORT=6379 \\\n    REDIS_DB=1 \\\n    NGINX_RADIO_PORTS=\"default\" \\\n    NGINX_WEBDJ_PORTS=\"default\" \\\n    PREFER_RELEASE_BUILDS=\"false\" \\\n    COMPOSER_PLUGIN_MODE=\"false\" \\\n    ADDITIONAL_MEDIA_SYNC_WORKER_COUNT=0 \\\n    PROFILING_EXTENSION_ENABLED=0 \\\n    PROFILING_EXTENSION_ALWAYS_ON=0 \\\n    PROFILING_EXTENSION_HTTP_KEY=dev \\\n    PROFILING_EXTENSION_HTTP_IP_WHITELIST=*\n\n# Entrypoint and default command\nENTRYPOINT [\"tini\", \"--\", \"/usr/local/bin/my_init\"]\nCMD [\"--no-main-command\"]\n"
}