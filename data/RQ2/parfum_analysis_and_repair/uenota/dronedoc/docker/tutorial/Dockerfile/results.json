{
  "startTime": 1674254252852,
  "endTime": 1674254254379,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 107
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 118
      }
    },
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 20
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 32,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 34,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 20
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 81,
        "lineEnd": 81,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 99
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 87,
        "lineEnd": 87,
        "columnStart": 4,
        "columnEnd": 127
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 106,
        "lineEnd": 121,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 122,
        "lineEnd": 122,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 123,
        "lineEnd": 123,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 127,
        "lineEnd": 127,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 128,
        "lineEnd": 128,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 129,
        "lineEnd": 130,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 131,
        "lineEnd": 131,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 170,
        "lineEnd": 170,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 32,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 20
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 81,
        "lineEnd": 81,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 99
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 87,
        "lineEnd": 87,
        "columnStart": 4,
        "columnEnd": 127
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 106,
        "lineEnd": 121,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 122,
        "lineEnd": 122,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 123,
        "lineEnd": 123,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 127,
        "lineEnd": 127,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 128,
        "lineEnd": 128,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 129,
        "lineEnd": 130,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 131,
        "lineEnd": 131,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 170,
        "lineEnd": 170,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 32,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 34,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 20
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 81,
        "lineEnd": 81,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 99
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 87,
        "lineEnd": 87,
        "columnStart": 4,
        "columnEnd": 127
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 106,
        "lineEnd": 121,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 122,
        "lineEnd": 122,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 123,
        "lineEnd": 123,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 127,
        "lineEnd": 127,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 128,
        "lineEnd": 128,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 129,
        "lineEnd": 130,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 131,
        "lineEnd": 131,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 170,
        "lineEnd": 170,
        "columnStart": 4,
        "columnEnd": 27
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 32,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 81,
        "lineEnd": 81,
        "columnStart": 4,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 123
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 87,
        "lineEnd": 87,
        "columnStart": 4,
        "columnEnd": 151
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 82
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 106,
        "lineEnd": 121,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 122,
        "lineEnd": 122,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 123,
        "lineEnd": 123,
        "columnStart": 4,
        "columnEnd": 70
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 127,
        "lineEnd": 127,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 128,
        "lineEnd": 128,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 129,
        "lineEnd": 130,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 131,
        "lineEnd": 131,
        "columnStart": 4,
        "columnEnd": 70
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 170,
        "lineEnd": 170,
        "columnStart": 4,
        "columnEnd": 51
      }
    }
  ],
  "repairedDockerfile": "FROM nvidia/opengl:1.0-glvnd-runtime-ubuntu16.04\n\nLABEL maintainer \"Takaki Ueno <ueknot@gmail.com>\"\n\nARG username\nARG userid\nARG groupid\n\n#Add new sudo user\nRUN useradd -m $username && \\\n        echo \"$username:$username\" | chpasswd && \\\n        usermod --shell /bin/bash $username && \\\n        usermod -aG sudo $username && \\\n        mkdir -p /etc/sudoers.d && \\\n        echo \"$username ALL=(ALL) NOPASSWD:ALL\" >> /etc/sudoers.d/$username && \\\n        chmod 0440 /etc/sudoers.d/$username && \\\n        usermod  --uid $userid $username && \\\n        groupmod --gid $groupid $username\n\n# add user to dialout group\nRUN usermod -a -G dialout $username\n\n# upgrade packages\nRUN apt update && apt upgrade -y\nRUN apt install --no-install-recommends -y lsb-release && rm -rf /var/lib/apt/lists/*;\n\n# setup ROS repository key\nRUN sh -c 'echo \"deb http://packages.ros.org/ros/ubuntu $(lsb_release -sc) main\" > /etc/apt/sources.list.d/ros-latest.list'\nRUN apt-key adv --keyserver 'hkp://keyserver.ubuntu.com:80' --recv-key C1CF6E31E6BADE8868B172B4F42ED6FBAB17C654\n\n# install ROS kinetic\nRUN apt update\nRUN apt install --no-install-recommends -y ros-kinetic-desktop-full \\\n                   python-rosinstall && rm -rf /var/lib/apt/lists/*;\nRUN apt install --no-install-recommends -y python-wstool \\\n                   python-rosinstall-generator \\\n                   python-catkin-tools && rm -rf /var/lib/apt/lists/*;\n\n# install common deps\nRUN curl -f -sSL https://raw.githubusercontent.com/PX4/Devguide/v1.8.0/build_scripts/ubuntu_sim_common_deps.sh | bash\n\n# update rosdep\nRUN rm -rf /etc/ros/rosdep/sources.list.d/20-default.list\nRUN rosdep init\nRUN rosdep update\n\n# switch user not to run rosdep update with root privilege\nUSER ${username}\nRUN rosdep update\n\nRUN mkdir -p /home/${username}/catkin_ws/src\nWORKDIR /home/${username}/catkin_ws\n\nRUN wstool init /home/${username}/catkin_ws/src\n\nRUN rosinstall_generator --rosdistro kinetic --upstream mavros | tee /tmp/mavros.rosinstall\nRUN rosinstall_generator --rosdistro kinetic mavlink | tee -a /tmp/mavros.rosinstall\nRUN wstool merge -t src /tmp/mavros.rosinstall\nRUN wstool update -t src\n\n# install dependencies\nUSER root\nRUN rosdep install --from-paths src --ignore-src --rosdistro kinetic -y --os ubuntu:xenial\n\n# build catkin workspace\nUSER ${username}\nRUN bash -c \"source /opt/ros/kinetic/setup.bash && catkin build\"\nRUN echo \"source /home/${username}/catkin_ws/devel/setup.bash\" >> /home/${username}/.bashrc\n\n# install geographiclib\nUSER root\nRUN curl -f -sSL https://raw.githubusercontent.com/mavlink/mavros/master/mavros/scripts/install_geographiclib_datasets.sh | bash\n\n# update gazebo so that gazebo is newer than 7.4\nRUN apt purge gazebo* libgazebo* -y\nRUN sh -c 'echo \"deb http://packages.osrfoundation.org/gazebo/ubuntu-stable `lsb_release -cs` main\" > /etc/apt/sources.list.d/gazebo-stable.list'\n\nRUN apt install -y --no-install-recommends wget && rm -rf /var/lib/apt/lists/*;\nRUN wget https://packages.osrfoundation.org/gazebo.key -O - | sudo apt-key add -\n\nRUN apt update\nRUN apt install --no-install-recommends gazebo7 libgazebo7-dev -y && rm -rf /var/lib/apt/lists/*;\n\n# install opencv dependencies\nWORKDIR /home/${username}\nRUN apt install --no-install-recommends build-essential -y && rm -rf /var/lib/apt/lists/*;\nRUN apt install --no-install-recommends cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev -y && rm -rf /var/lib/apt/lists/*;\nRUN apt install --no-install-recommends python-dev python-numpy libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libjasper-dev libdc1394-22-dev -y && rm -rf /var/lib/apt/lists/*;\n\n# clone opencv 3.4.12\nUSER ${username}\nRUN git clone https://github.com/opencv/opencv.git -b 3.4.12\nRUN git clone https://github.com/opencv/opencv_contrib.git -b 3.4.12\n\n# build and install opnecv\nWORKDIR /home/${username}/opencv\nRUN mkdir build\n\nWORKDIR /home/${username}/opencv/build\nRUN cmake -D CMAKE_BUILD_TYPE=Release -D CMAKE_INSTALL_PREFIX=/usr/local ..\n\nUSER root\nRUN make clean && make && make install\n\n# install dronedoc dependencies\nRUN apt install --no-install-recommends protobuf-compiler libignition-math2-dev -y && rm -rf /var/lib/apt/lists/*;\nRUN apt install --no-install-recommends ros-kinetic-amcl \\\n                ros-kinetic-base-local-planner \\\n                ros-kinetic-carrot-planner \\\n                ros-kinetic-clear-costmap-recovery \\\n                ros-kinetic-costmap-2d \\\n                ros-kinetic-dwa-local-planner \\\n                ros-kinetic-fake-localization \\\n                ros-kinetic-global-planner \\\n                ros-kinetic-map-server \\\n                ros-kinetic-move-base \\\n                ros-kinetic-move-base-msgs \\\n                ros-kinetic-move-slow-and-clear \\\n                ros-kinetic-nav-core \\\n                ros-kinetic-navfn \\\n                ros-kinetic-rotate-recovery \\\n                ros-kinetic-voxel-grid -y && rm -rf /var/lib/apt/lists/*;\nRUN apt install --no-install-recommends ros-kinetic-hector-slam -y && rm -rf /var/lib/apt/lists/*;\nRUN apt install --no-install-recommends ros-kinetic-octomap-mapping -y && rm -rf /var/lib/apt/lists/*;\n# RUN apt install ros-kinetic-turtlebot-teleop \\\n#                 ros-kinetic-turtlebot-gazebo \\\n#                 ros-kinetic-turtlebot-bringup -y\nRUN apt install --no-install-recommends ros-kinetic-moveit-* -y && rm -rf /var/lib/apt/lists/*;\nRUN apt install --no-install-recommends ros-kinetic-ompl -y && rm -rf /var/lib/apt/lists/*;\nRUN apt install --no-install-recommends ros-kinetic-eband-local-planner \\\n                ros-kinetic-teb-local-planner -y && rm -rf /var/lib/apt/lists/*;\nRUN apt install --no-install-recommends ros-kinetic-gazebo-ros-pkgs -y && rm -rf /var/lib/apt/lists/*;\n\n# clone dronedoc and build\nUSER ${username}\nWORKDIR /home/${username}/catkin_ws/src\nRUN git clone https://github.com/uenota/dronedoc.git\nRUN catkin build\n\n# clone PX4/Firmware\nWORKDIR /home/${username}\nRUN rm -rf src/Firmware\nRUN mkdir -p src\n\nWORKDIR /home/${username}/src\nRUN git clone https://github.com/PX4/Firmware.git -b v1.8.0\n\n# build PX4 firmware\nWORKDIR /home/${username}/src/Firmware\nRUN make rostest\n\n# make bash to run setup script for PX4 Firmware every time .bashrc is loaded\nRUN echo 'source $HOME/src/Firmware/Tools/setup_gazebo.bash $HOME/src/Firmware $HOME/src/Firmware/build/posix_sitl_default > /dev/null' >> /home/${username}/.bashrc\n\n# add PX4 Firmware path to ROS package path\nRUN echo 'ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:$HOME/src/Firmware' >> /home/${username}/.bashrc\nRUN echo 'ROS_PACKAGE_PATH=$ROS_PACKAGE_PATH:$HOME/src/Firmware/Tools/sitl_gazebo' >> /home/${username}/.bashrc\n\n# add Gazebo models from PX4 Firmware and dronedoc to Gazebo model path\nRUN echo 'export GAZEBO_MODEL_PATH=$HOME/src/Firmware/Tools/sitl_gazebo/models:$GAZEBO_MODEL_PATH' >> /home/${username}/.bashrc\nRUN echo 'export GAZEBO_MODEL_PATH=$HOME/catkin_ws/src/dronedoc/models:$GAZEBO_MODEL_PATH' >> /home/${username}/.bashrc\n\n# nvidia-container-runtime\nENV NVIDIA_VISIBLE_DEVICES \\\n    ${NVIDIA_VISIBLE_DEVICES:-all}\nENV NVIDIA_DRIVER_CAPABILITIES \\\n    ${NVIDIA_DRIVER_CAPABILITIES:+$NVIDIA_DRIVER_CAPABILITIES,}graphics\n\n# install packages for test and development\nUSER root\nRUN apt install --no-install-recommends vim tmux -y && rm -rf /var/lib/apt/lists/*;\n\nCMD [\"bash\"]\n"
}