FROM python:3

ENV VERSION="0.8"

RUN apt-get update && apt-get install -y --no-install-recommends tcpdump && rm -rf /var/lib/apt/lists/*

WORKDIR /usr/src/app
VOLUME [ "/usr/src/app/logs" ]
VOLUME [ "/usr/src/app/attacks" ]

COPY requirements.txt ./
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

ARG BROADCAST_IP='224.0.0.252'
ENV BROADCAST_IP="${BROADCAST_IP}"
ARG NBNS_SLEEP=30
ENV NBNS_SLEEP="${NBNS_SLEEP}"
ARG LLMNR_SLEEP=30
ENV LLMNR_SLEEP="${LLMNR_SLEEP}"
ARG MDNS_SLEEP=30
ENV MDNS_SLEEP="${MDNS_SLEEP}"
ARG DHCPV6_SLEEP=30
ENV DHCPV6_SLEEP="${DHCPV6_SLEEP}"
ARG PORTSCAN_TCP_PORTS='21, 25, 80, 110, 143, 443, 445, 465, 3389'
ENV PORTSCAN_TCP_PORTS="${PORTSCAN_TCP_PORTS}"
ARG CONSOLE_LOG_LEVEL="warning"
ENV CONSOLE_LOG_LEVEL="${CONSOLE_LOG_LEVEL}"
ARG FILE_LOG_LEVEL="warning"
ENV FILE_LOG_LEVEL="${FILE_LOG_LEVEL}"
ARG FILE_LOG_RETENTION=30
ENV FILE_LOG_RETENTION="${FILE_LOG_RETENTION}"
ARG DISABLE_NBNS_SCANNING='F'
ENV DISABLE_NBNS_SCANNING="${DISABLE_NBNS_SCANNING}"
ARG DISABLE_LLMNR_SCANNING='F'
ENV DISABLE_LLMNR_SCANNING="${DISABLE_LLMNR_SCANNING}"
ARG DISABLE_MDNS_SCANNING='F'
ENV DISABLE_MDNS_SCANNING="${DISABLE_MDNS_SCANNING}"
ARG DISABLE_PORTSCAN_DETECTION='F'
ENV DISABLE_PORTSCAN_DETECTION="${DISABLE_PORTSCAN_DETECTION}"
ARG DISABLE_DHCPV6_DETECTION='F'
ENV DISABLE_DHCPV6_DETECTION="${DISABLE_DHCPV6_DETECTION}"
ARG DHCPV6_WHITELIST=''
ENV DHCPV6_WHITELIST="${DHCPV6_WHITELIST}"
ARG ENABLE_EMAIL_ALERTS='T'
ENV ENABLE_EMAIL_ALERTS="${ENABLE_EMAIL_ALERTS}"
ARG ENABLE_EMAIL_STARTUP_TEST='T'
ENV ENABLE_EMAIL_STARTUP_TEST="${ENABLE_EMAIL_STARTUP_TEST}"
ARG ENABLE_EMAIL_SERVER_AUTHENTICATION='T'
ENV ENABLE_EMAIL_SERVER_AUTHENTICATION="${ENABLE_EMAIL_SERVER_AUTHENTICATION}"
ARG EMAIL_RECIPIENT=''
ENV EMAIL_RECIPIENT="${EMAIL_RECIPIENT}"
ARG EMAIL_SENDER=''
ENV EMAIL_SENDER="${EMAIL_SENDER}"
ARG EMAIL_SENDER_PASSWORD=''
ENV EMAIL_SENDER_PASSWORD="${EMAIL_SENDER_PASSWORD}"
ARG EMAIL_SERVER_ADDRESS='smtp.gmail.com'
ENV EMAIL_SERVER_ADDRESS="${EMAIL_SERVER_ADDRESS}"
ARG EMAIL_SERVER_PORT=587
ENV EMAIL_SERVER_PORT="${EMAIL_SERVER_PORT}"
ARG EMAIL_SERVER_STARTTLS='T'
ENV EMAIL_SERVER_STARTTLS="${EMAIL_SERVER_STARTTLS}"
ARG ATTACK_TIMEOUT_DURATION=600
ENV ATTACK_TIMEOUT_DURATION="${ATTACK_TIMEOUT_DURATION}"
ARG SYSLOG_ENABLED='F'
ENV SYSLOG_ENABLED="${SYSLOG_ENABLED}"
ARG SYSLOG_ADDRESS=''
ENV SYSLOG_ADDRESS="${SYSLOG_ADDRESS}"
ARG SYSLOG_PORT=514
ENV SYSLOG_PORT="${SYSLOG_PORT}"
ARG SYSLOG_TCP='F'
ENV SYSLOG_TCP="${SYSLOG_TCP}"
ARG SYSLOG_LOG_LEVEL='warning'
ENV SYSLOG_LOG_LEVEL="${SYSLOG_LOG_LEVEL}"

CMD [ "python", "./main.py" ]