{
  "startTime": 1674250502172,
  "endTime": 1674250502835,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 55
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 49
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 79
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 4,
        "columnEnd": 70
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 73
      }
    }
  ],
  "repairedDockerfile": "# CUDA 10.1 moved the libcublas libraries from /usr/local/cuda to /usr/lib/x86_64-linux-gnu,\n# which screws up the tensorflow build system.\n#\n# Add symlink to libcublas from /usr/local/cuda to make tensorflow happy.\n#\n# https://github.com/tensorflow/tensorflow/issues/26150\n# https://github.com/tensorflow/tensorflow/issues/26150#issuecomment-499934800\n\n# This removes:\n# cuda-libraries-10-1 libcublas10 libnvinfer5\nRUN apt-get remove -y libcublas10\n# libcublas10-dev\n\nRUN apt-get install --no-install-recommends -y 'libcublas10=10.1*' && rm -rf /var/lib/apt/lists/*;\nRUN apt-mark hold libcublas10\nRUN apt-get install --no-install-recommends -y 'libcublas-dev=10.1*' && rm -rf /var/lib/apt/lists/*;\nRUN apt-mark hold libcublas-dev\nRUN echo \"> WORK-AROUND: until CUDA fixes their repos and to ensure only CUDA 10.1 packages are installed and NOT CUDA 10.2 packages, we will use apt to 'hold' the libcublas package. \" && \\\n    echo \"Held packages (these packages cannot be upgraded/removed; lookup \"apt-mark hold\" for details):\" && \\\n    dpkg -l | grep '^hi'\n# NOTE: If this command FAILS, then libcublas 10.2 is installed and\n# will cause the TensorFlow build system to complain.\nRUN dpkg-query -Wf '${Version}' libcublas10 | grep -v '10\\.2'\n\nRUN apt-get install --no-install-recommends -y 'cuda-libraries-10-1=10.1.105-1' && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends -y 'libnvinfer5=*cuda10.1' && rm -rf /var/lib/apt/lists/*;\n# This will fail unless we install the libcublas-dev=10.1* package (above).\nRUN apt-get install --no-install-recommends -y 'libnvinfer-dev=*cuda10.1' && rm -rf /var/lib/apt/lists/*;\n\n# Add libcublas symlinks as described at top of this file.\nRUN cp --no-dereference --no-clobber /usr/lib/x86_64-linux-gnu/libcublas* /usr/local/cuda/lib64\n\n# These CUDA include files are inside system-paths, tensorflow expects them to be\n# inside /usr/local/cuda/include in its #include statements.\n# RUN cp --no-dereference --no-clobber /usr/include/cublas*.h /usr/local/cuda/include\nRUN mv --no-clobber /usr/include/cublas*.h /usr/local/cuda/include\n# RUN cp --no-dereference --no-clobber /usr/include/cudnn.h /usr/local/cuda/include\n\n# libcublas.10.1 symlink is missing.\n# Same for all the other libraries.\nRUN for lib in cublas cublasLt cuart cufft cufftw cuinj64 curand cusolver cusparse; do \\\n        if [ ! -e /usr/local/cuda/lib64/lib${lib}.so.10.1 ]; then \\\n            ln -s /usr/local/cuda/lib64/lib${lib}.so.10.1.* /usr/local/cuda/lib64/lib${lib}.so.10.1; \\\n        fi; \\\n    done;\n\n# NOTE: belongs in dockerfiles/partials/ubuntu/nvidia_rtx_2070_env.partial.Dockerfile\nENV TF_CUDA_COMPUTE_CAPABILITIES=7.5,6.1\n\n# For some reason, TensorFlow is unable to load libcublas.so.10.1 unless we stick\n# /usr/local/cuda/lib64 on LD_LIBRARY_PATH, so we do:\nENV LD_LIBRARY_PATH=\"/usr/local/cuda/lib64:${LD_LIBRARY_PATH}\"\n"
}