{
  "startTime": 1674249202677,
  "endTime": 1674249203740,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 92,
        "lineEnd": 99,
        "columnStart": 50,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 92,
        "lineEnd": 99,
        "columnStart": 50,
        "columnEnd": 32
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "##################################################### BUILD STAGE ######################################################\nFROM photoprism/develop:armv7 as build\n\nARG TARGETARCH\nARG BUILD_TAG\n\n# set up project directory\nWORKDIR \"/go/src/github.com/photoprism/photoprism\"\nCOPY . .\n\n# build and install dist files for prod env\nRUN make all install DESTDIR=/opt/photoprism\n\n################################################## PRODUCTION STAGE ####################################################\n#### Base Image: Debian 12, Codename \"Bookworm\"\nFROM debian:bookworm-slim\n\nLABEL maintainer=\"Michael Mayer <hello@photoprism.app>\"\n\nARG TARGETARCH\nARG BUILD_TAG\n\n# set environment variables, see https://docs.photoprism.app/getting-started/config-options/\nENV PHOTOPRISM_ARCH=$TARGETARCH \\\n    DOCKER_TAG=$BUILD_TAG \\\n    DOCKER_ENV=\"prod\" \\\n    PS1=\"\\u@$DOCKER_TAG:\\w\\$ \" \\\n    PATH=\"/usr/local/sbin:/usr/sbin:/sbin:/usr/local/bin:/usr/bin:/bin:/scripts:/opt/photoprism/bin\" \\\n    LD_LIBRARY_PATH=\"/usr/local/lib:/usr/lib\" \\\n    TMPDIR=\"/tmp\" \\\n    DEBIAN_FRONTEND=\"noninteractive\" \\\n    TF_CPP_MIN_LOG_LEVEL=\"2\" \\\n    PROG=\"photoprism\" \\\n    PHOTOPRISM_ASSETS_PATH=\"/opt/photoprism/assets\" \\\n    PHOTOPRISM_IMPORT_PATH=\"/photoprism/import\" \\\n    PHOTOPRISM_ORIGINALS_PATH=\"/photoprism/originals\" \\\n    PHOTOPRISM_STORAGE_PATH=\"/photoprism/storage\" \\\n    PHOTOPRISM_BACKUP_PATH=\"/photoprism/storage/backups\" \\\n    PHOTOPRISM_LOG_FILENAME=\"/photoprism/storage/photoprism.log\" \\\n    PHOTOPRISM_PID_FILENAME=\"/photoprism/storage/photoprism.pid\" \\\n    PHOTOPRISM_DEBUG=\"false\" \\\n    PHOTOPRISM_PUBLIC=\"false\" \\\n    PHOTOPRISM_READONLY=\"false\" \\\n    PHOTOPRISM_UPLOAD_NSFW=\"true\" \\\n    PHOTOPRISM_DETECT_NSFW=\"false\" \\\n    PHOTOPRISM_EXPERIMENTAL=\"false\" \\\n    PHOTOPRISM_SITE_URL=\"http://localhost:2342/\" \\\n    PHOTOPRISM_SITE_CAPTION=\"AI-Powered Photos App\" \\\n    PHOTOPRISM_SITE_DESCRIPTION=\"\" \\\n    PHOTOPRISM_SITE_AUTHOR=\"\" \\\n    PHOTOPRISM_HTTP_HOST=\"0.0.0.0\" \\\n    PHOTOPRISM_HTTP_PORT=2342 \\\n    PHOTOPRISM_DATABASE_DRIVER=\"sqlite\" \\\n    PHOTOPRISM_DATABASE_SERVER=\"\" \\\n    PHOTOPRISM_DATABASE_NAME=\"photoprism\" \\\n    PHOTOPRISM_DATABASE_USER=\"photoprism\" \\\n    PHOTOPRISM_DATABASE_PASSWORD=\"\" \\\n    PHOTOPRISM_DISABLE_CHOWN=\"false\" \\\n    PHOTOPRISM_DISABLE_WEBDAV=\"false\" \\\n    PHOTOPRISM_DISABLE_SETTINGS=\"false\" \\\n    PHOTOPRISM_DISABLE_BACKUPS=\"false\" \\\n    PHOTOPRISM_DISABLE_EXIFTOOL=\"false\" \\\n    PHOTOPRISM_DISABLE_PLACES=\"false\" \\\n    PHOTOPRISM_DISABLE_TENSORFLOW=\"false\" \\\n    PHOTOPRISM_DISABLE_FACES=\"false\" \\\n    PHOTOPRISM_DISABLE_CLASSIFICATION=\"false\" \\\n    PHOTOPRISM_RAW_PRESETS=\"false\" \\\n    PHOTOPRISM_THUMB_FILTER=\"lanczos\" \\\n    PHOTOPRISM_THUMB_UNCACHED=\"false\" \\\n    PHOTOPRISM_THUMB_SIZE=2048 \\\n    PHOTOPRISM_THUMB_SIZE_UNCACHED=7680 \\\n    PHOTOPRISM_JPEG_SIZE=7680 \\\n    PHOTOPRISM_JPEG_QUALITY=85 \\\n    PHOTOPRISM_WORKERS=0 \\\n    PHOTOPRISM_WAKEUP_INTERVAL=900 \\\n    PHOTOPRISM_AUTO_INDEX=300 \\\n    PHOTOPRISM_AUTO_IMPORT=300\n\n# copy dist files, scripts, and debian backports sources list\nCOPY --from=build /opt/photoprism/ /opt/photoprism\nCOPY --chown=root:root --chmod=755 /scripts/dist/* /scripts/\nCOPY /docker/develop/bookworm/sources.list /etc/apt/sources.list.d/bookworm.list\n\n# install additional distribution packages\nRUN echo 'APT::Acquire::Retries \"3\";' > /etc/apt/apt.conf.d/80retries && \\\n    echo 'APT::Install-Recommends \"false\";' > /etc/apt/apt.conf.d/80recommends && \\\n    echo 'APT::Install-Suggests \"false\";' > /etc/apt/apt.conf.d/80suggests && \\\n    echo 'APT::Get::Assume-Yes \"true\";' > /etc/apt/apt.conf.d/80forceyes && \\\n    echo 'APT::Get::Fix-Missing \"true\";' > /etc/apt/apt.conf.d/80fixmissing && \\\n    mv /opt/photoprism/sbin/gosu /usr/local/sbin/gosu && \\\n    chown root:root /usr/local/sbin/gosu && \\\n    chmod 755 /usr/local/sbin/gosu && \\\n    apt-get update && apt-get -qq dist-upgrade && apt-get -qq -y install --no-install-recommends \\\n      libc6 ca-certificates sudo bash tzdata \\\n      gpg zip unzip wget curl rsync make nano \\\n      jq lsof lshw sqlite3 mariadb-client imagemagick \\\n      exiftool rawtherapee libheif-examples librsvg2-bin \\\n      ffmpeg ffmpegthumbnailer libavcodec-extra \\\n      libmatroska7 libdvdread8 libebml5 libgav1-0 libatomic1 \\\n      x264 x265 libvpx7 libwebm1 \\\n    && \\\n    echo 'alias ll=\"ls -alh\"' >> /etc/skel/.bashrc && \\\n    echo 'export PS1=\"\\u@$DOCKER_TAG:\\w\\$ \"' >> /etc/skel/.bashrc && \\\n    echo \"ALL ALL=(ALL) NOPASSWD:SETENV: /scripts/entrypoint-init.sh\" >> /etc/sudoers.d/init && \\\n    cp /etc/skel/.bashrc /root/.bashrc && \\\n    /scripts/create-users.sh && \\\n    /scripts/cleanup.sh && \\\n    cp /scripts/heif-convert.sh /usr/local/bin/heif-convert && \\\n    install -d -m 0777 -o 1000 -g 1000 \\\n      /var/lib/photoprism \\\n      /tmp/photoprism \\\n      /photoprism/originals \\\n      /photoprism/import \\\n      /photoprism/storage \\\n      /photoprism/storage/sidecar \\\n      /photoprism/storage/albums \\\n      /photoprism/storage/backups \\\n      /photoprism/storage/config \\\n      /photoprism/storage/cache && rm -rf /var/lib/apt/lists/*;\n\n\n# define default directory and user\nWORKDIR /photoprism\n\n# expose default http port 2342\nEXPOSE 2342\n\n# set container entrypoint script\nENTRYPOINT [\"/scripts/entrypoint.sh\"]\n\n# start app server\nCMD [\"/opt/photoprism/bin/photoprism\", \"start\"]\n"
}