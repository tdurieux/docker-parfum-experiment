{
  "startTime": 1674254518557,
  "endTime": 1674254519321,
  "originalSmells": [
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 22
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM alpine:3.14\nLABEL Description=\"Fluentd docker image\" Vendor=\"Banzai Cloud\" Version=\"1.13.3\"\n\n# Do not split this into multiple RUN!\n# Docker creates a layer for every RUN-Statement\n# therefore an 'apk delete' has no effect\nRUN apk update \\\n && apk add --no-cache \\\n        ca-certificates \\\n        ruby ruby-irb ruby-etc \\\n        tini libmaxminddb geoip \\\n && buildDeps=\" \\\n      make gcc g++ libc-dev \\\n      wget bzip2 zlib-dev git linux-headers \\\n      automake autoconf libtool build-base \\\n      ruby-dev libc6-compat geoip-dev \\\n    \" \\\n && apk add --no-cache --virtual .build-deps \\\n        build-base \\\n        ruby-dev gnupg \\\n && apk add --no-cache $buildDeps \\\n && echo 'gem: --no-document' >> /etc/gemrc \\\n && gem install oj -v 3.11.6 \\\n && gem install http_parser.rb -v 0.5.3 \\\n && gem install tzinfo -v 1.2.7 \\\n && gem install resolv -v 0.2.1 \\\n && gem install json -v 2.5.1 \\\n && gem install async-http -v 0.56.3 \\\n && gem install ext_monitor -v 0.1.2 \\\n && gem install fluentd -v 1.13.3 \\\n && gem install prometheus-client -v 2.1.0 \\\n && gem install bigdecimal -v 1.4.4 \\\n && gem install webrick \\\n && gem install gelf -v 3.0.0 \\\n # Pin the elasticsearch-ruby library < 7.14.\n # See https://github.com/uken/fluent-plugin-elasticsearch/issues/912\n && gem install elasticsearch -v 7.13.3 \\\n && gem install elasticsearch-xpack -v 7.13.3 \\\n && gem install fluent-plugin-detect-exceptions -v 0.0.14 \\\n # FMI https://github.com/banzaicloud/logging-operator/issues/887 \\\n && find /usr/lib/ruby/gems/2.*/gems/fluent-plugin-detect-exceptions-* -type f -print0 | xargs -0 chmod 644 \\\n && gem install \\\n         specific_install \\\n         fluent-plugin-remote-syslog \\\n         fluent-plugin-webhdfs \\\n         fluent-plugin-prometheus \\\n         fluent-plugin-s3 \\\n         fluent-plugin-rewrite-tag-filter \\\n         fluent-plugin-azure-storage-append-blob \\\n         fluent-plugin-oss \\\n         fluent-plugin-dedot_filter \\\n         fluent-plugin-sumologic_output \\\n         fluent-plugin-kafka \\\n         fluent-plugin-geoip \\\n         fluent-plugin-label-router \\\n         fluent-plugin-tag-normaliser \\\n         fluent-plugin-grafana-loki \\\n         fluent-plugin-concat \\\n         fluent-plugin-kinesis \\\n         fluent-plugin-parser-logfmt \\\n         fluent-plugin-multi-format-parser \\\n         fluent-plugin-record-modifier \\\n         fluent-plugin-splunk-hec \\\n         fluent-plugin-newrelic \\\n         fluent-plugin-elasticsearch \\\n         fluent-plugin-cloudwatch-logs \\\n         fluent-plugin-throttle \\\n         fluent-plugin-logdna \\\n         fluent-plugin-datadog \\\n         fluent-plugin-aws-elasticsearch-service \\\n         fluent-plugin-redis \\\n         fluent-plugin-gelf-hs \\\n         fluent-plugin-sqs \\\n         fluent-plugin-kube-events-timestamp \\\n         fluent-plugin-grok-parser \\\n && gem specific_install -l https://github.com/tarokkk/fluent-plugin-logzio.git \\\n && gem specific_install -l https://github.com/cloudfoundry/fluent-plugin-syslog_rfc5424.git \\\n && gem specific_install -l https://github.com/banzaicloud/fluent-plugin-gcs.git \\\n && gem specific_install -l https://github.com/SumoLogic/sumologic-kubernetes-fluentd.git -d fluent-plugin-kubernetes-metadata-filter \\\n && gem specific_install -l https://github.com/SumoLogic/sumologic-kubernetes-fluentd.git -d fluent-plugin-enhance-k8s-metadata \\\n && gem specific_install -l https://github.com/SumoLogic/sumologic-kubernetes-fluentd.git -d fluent-plugin-kubernetes-sumologic \\\n # https://github.com/SumoLogic/sumologic-kubernetes-fluentd/blob/main/Dockerfile#L27\n && gem specific_install https://github.com/abonas/kubeclient --ref 3267dc3fd02c49e3b19f1210ff7cb84c3b2a4478 \\\n && apk del .build-deps $buildDeps \\\n && rm -rf /tmp/* /var/tmp/* /usr/lib/ruby/gems/*/cache/*.gem /usr/lib/ruby/gems/2.*/gems/fluentd-*/test\n\nRUN addgroup -S fluent && adduser -S -G fluent fluent \\\n    # for log storage (maybe shared with host)\n    && mkdir -p /fluentd/log \\\n    # configuration/plugins path (default: copied from .)\n    && mkdir -p /fluentd/etc /fluentd/plugins \\\n    && chown -R fluent /fluentd && chgrp -R fluent /fluentd \\\n    && mkdir -p /buffers && chown -R fluent /buffers\n\n\nCOPY fluent.conf /fluentd/etc/\nCOPY entrypoint.sh /bin/\nCOPY healthy.sh /bin/\n\n\nENV FLUENTD_CONF=\"fluent.conf\"\nENV RUBYLIB=\"/usr/lib/ruby/gems/2.7.0/gems/resolv-0.2.1/lib\"\n\nENV LD_PRELOAD=\"\"\nEXPOSE 24224 5140\n\nUSER fluent\nENTRYPOINT [\"tini\",  \"--\", \"/bin/entrypoint.sh\"]\nCMD [\"fluentd\"]\n"
}