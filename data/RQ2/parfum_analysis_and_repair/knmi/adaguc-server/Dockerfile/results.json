{
  "startTime": 1674254551460,
  "endTime": 1674254552805,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 88,
        "lineEnd": 88,
        "columnStart": 4,
        "columnEnd": 42
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM centos/devtoolset-7-toolchain-centos7:7\nUSER root\n\nLABEL maintainer=\"adaguc@knmi.nl\"\n\n# Version should be same as in Definitions.h\nLABEL version=\"2.7.6\"\n\n######### First stage (build) ############\n\n# production packages, same as stage two\nRUN yum update -y && \\\n    yum install -y epel-release deltarpm && \\\n    yum install -y cairo \\\n    curl \\\n    python3 \\\n    gd \\\n    gdal \\\n    hdf5 \\\n    libxml2 \\\n    proj \\\n    udunits2 \\\n    openssl \\\n    netcdf \\\n    libwebp-devel \\\n    # building / development packages\n    yum install -y centos-release-scl && \\\n    yum install -y devtoolset-7-gcc-c++ && \\\n    source /opt/rh/devtoolset-7/enable && \\\n    yum install -y cmake3 cairo-devel \\\n    gd-devel \\\n    gdal-devel \\\n    hdf5-devel \\\n    libxml2-devel \\\n    make \\\n    netcdf-devel \\\n    openssl \\\n    postgresql-devel \\\n    proj-devel \\\n    sqlite-devel \\\n    udunits2-devel && \\\n    yum clean all && \\\n    rm -rf /var/cache/yum\n\n# Install adaguc-server from context\nCOPY . /adaguc/adaguc-server-master\n\nWORKDIR /adaguc/adaguc-server-master\n\n# Force to use Python 3\nRUN ln -sf /usr/bin/python3 /usr/bin/python\nRUN ln -sf /usr/bin/cmake3 /usr/bin/cmake\nRUN ln -sf /usr/bin/ctest3 /usr/bin/ctest\nRUN cp -r /usr/include/udunits2/* /usr/include/\n\nRUN bash compile.sh\n\n\n######### Second stage (production) ############\nFROM centos:7\nUSER root\n\n# production packages, same as stage one\nRUN yum update -y && \\\n    yum install -y epel-release deltarpm && \\\n    yum install -y cairo \\\n    curl \\\n    gd \\\n    gdal \\\n    hdf5 \\\n    libxml2 \\\n    proj \\\n    python3 \\\n    python3-lxml \\\n    postgresql \\\n    udunits2 \\\n    openssl \\\n    netcdf \\\n    libwebp \\\n    python36-numpy \\\n    python36-netcdf4 \\\n    python36-six \\\n    python36-requests \\\n    python36-pillow \\\n    python36-lxml && \\\n    yum clean all && \\\n    rm -rf /var/cache/yum\n\nRUN pip3 install --no-cache-dir flask flask-cors gunicorn\n\nWORKDIR /adaguc/adaguc-server-master\n\n# Install compiled adaguc binaries from stage one\nCOPY --from=0 /adaguc/adaguc-server-master/bin /adaguc/adaguc-server-master/bin\nCOPY --from=0 /adaguc/adaguc-server-master/data /adaguc/adaguc-server-master/data\nCOPY --from=0 /adaguc/adaguc-server-master/python /adaguc/adaguc-server-master/python\nCOPY --from=0 /adaguc/adaguc-server-master/tests /adaguc/adaguc-server-master/tests\nCOPY --from=0 /adaguc/adaguc-server-master/runtests.sh /adaguc/adaguc-server-master/runtests.sh\n\n# Run adaguc-server functional and regression tests\nRUN  bash runtests.sh\n\n    # Set same uid as vivid\nRUN useradd -m adaguc -u 1000 && \\\n    # Setup directories\n    mkdir -p /data/adaguc-autowms && \\\n    mkdir -p /data/adaguc-datasets && \\\n    mkdir -p /data/adaguc-data && \\\n    mkdir -p /adaguc/userworkspace && \\\n    mkdir -p /adaguc/adaguc-datasets-internal\n\n# Configure\nCOPY ./Docker/adaguc-server-config-python-postgres.xml /adaguc/adaguc-server-config.xml\nCOPY ./Docker/start.sh /adaguc/\nCOPY ./Docker/adaguc-server-*.sh /adaguc/\nCOPY ./Docker/baselayers.xml /adaguc/adaguc-datasets-internal/baselayers.xml\nRUN  chmod +x /adaguc/adaguc-server-*.sh && \\\n    chmod +x /adaguc/start.sh && \\\n    chown -R adaguc:adaguc /data/adaguc* /adaguc /adaguc/*\n\nENV ADAGUC_PATH=/adaguc/adaguc-server-master\n\nENV PYTHONPATH=${ADAGUC_PATH}/python/python-adaguc-server\n\n# Build and test adaguc python support\nWORKDIR /adaguc/adaguc-server-master/python/lib/\nRUN python3 setup.py install\nRUN bash -c \"python3 /adaguc/adaguc-server-master/python/examples/runautowms/run.py && ls result.png\"\nWORKDIR /adaguc/adaguc-server-master\n\nUSER adaguc\n\n# For HTTP\nEXPOSE 8080\n\n\nENTRYPOINT [\"sh\", \"/adaguc/start.sh\"]\n"
}