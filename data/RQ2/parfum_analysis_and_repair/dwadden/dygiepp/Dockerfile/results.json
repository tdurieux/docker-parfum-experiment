{
  "startTime": 1674250564340,
  "endTime": 1674250565332,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 119
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 58,
        "lineEnd": 58,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 58,
        "lineEnd": 58,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 58,
        "lineEnd": 58,
        "columnStart": 4,
        "columnEnd": 27
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 85
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 58,
        "lineEnd": 58,
        "columnStart": 4,
        "columnEnd": 51
      }
    }
  ],
  "repairedDockerfile": "# Set-up docker image for DYGIE++.\nFROM pytorch/pytorch:1.6.0-cuda10.1-cudnn7-devel\n\n# Datasets will be downloaded to the /dygiepp root directory in image.\n# Please mount source code project dir at /dygiepp for using default paths.\nRUN mkdir /dygiepp\n\n# Required-base: set-up shared DYGIE++ modeling environment.\n# GCC and make needed to compile python deps. SQLite3 for Optuna hyperparameter optimization.\nRUN apt-get update && \\\n    apt-get -y --no-install-recommends install gcc make sqlite3 && rm -rf /var/lib/apt/lists/*;\nRUN conda create --name dygiepp python=3.7 -y\nSHELL [\"conda\", \"run\", \"-n\", \"dygiepp\", \"/bin/bash\", \"-c\"]\n# jsonnet has a conflict when installed with pip for now, install from conda.\nRUN conda install -c conda-forge jsonnet -y\nCOPY requirements.txt /tmp/requirements.txt\nRUN pip install --no-cache-dir -r /tmp/requirements.txt\n\n# ACE05-EVENT: set-up environment for pre-processing.\nSHELL [\"/bin/bash\", \"-c\"]\nRUN conda create --name ace-event-preprocess python=3.7 -y\nSHELL [\"conda\", \"run\", \"-n\", \"ace-event-preprocess\", \"/bin/bash\", \"-c\"]\nCOPY scripts/data/ace-event/requirements.txt /tmp/ace-prep-requirements.txt\nRUN pip install --no-cache-dir -r /tmp/ace-prep-requirements.txt\nRUN python -m spacy download en\n\n# ACE05 dataset creation: Install CoreNLP (requires Java 1.8+) and zsh.\nSHELL [\"/bin/bash\", \"-c\"]\nRUN apt-get install --no-install-recommends openjdk-8-jdk openjdk-8-jre wget unzip -y && rm -rf /var/lib/apt/lists/*;\nCOPY scripts/data/ace05/get_corenlp.sh /tmp/get_corenlp.sh\nRUN cd /dygiepp/ && bash /tmp/get_corenlp.sh\nRUN conda install -c conda-forge zsh -y\n\n# SciERC, GENIA, ChemProt: Download data.\n# Downloader scripts require wget, unzip, and shared parsing code.\nRUN apt-get install --no-install-recommends unzip wget -y && rm -rf /var/lib/apt/lists/*;\nCOPY scripts/data/shared /dygiepp/scripts/data/shared\n# SciERC\nCOPY scripts/data/get_scierc.sh /tmp/get_scierc.sh\nCOPY dygie /dygiepp/dygie\nENV PYTHONPATH=\"${PYTHONPATH}:/dygiepp\"\nSHELL [\"conda\", \"run\", \"-n\", \"dygiepp\", \"/bin/bash\", \"-c\"]\nRUN cd /dygiepp && bash /tmp/get_scierc.sh\n# GENIA\nCOPY scripts/data/get_genia.sh /tmp/get_genia.sh\nCOPY scripts/data/genia /dygiepp/scripts/data/genia\nENV PYTHONPATH=\"${PYTHONPATH}:/dygiepp\"\nSHELL [\"conda\", \"run\", \"-n\", \"dygiepp\", \"/bin/bash\", \"-c\"]\nRUN cd /dygiepp && bash /tmp/get_genia.sh\n# ChemPROT\nCOPY scripts/data/get_chemprot.sh /tmp/get_chemprot.sh\nCOPY scripts/data/chemprot /dygiepp/scripts/data/chemprot\nENV PYTHONPATH=\"${PYTHONPATH}:/dygiepp\"\nSHELL [\"conda\", \"run\", \"-n\", \"dygiepp\", \"/bin/bash\", \"-c\"]\nRUN pip install --no-cache-dir scispacy https://s3-us-west-2.amazonaws.com/ai2-s2-scispacy/releases/v0.2.5/en_core_sci_sm-0.2.5.tar.gz\nRUN cd /dygiepp && bash /tmp/get_chemprot.sh\n\n# Pretrained-models-all-DYGIEPP: Download pre-trained models for all DYGIEPP tasks.\nRUN apt-get install --no-install-recommends wget -y && rm -rf /var/lib/apt/lists/*;\nCOPY scripts/pretrained/get_dygiepp_pretrained.sh /tmp/get_dygiepp_pretrained.sh\nRUN cd /dygiepp && bash /tmp/get_dygiepp_pretrained.sh\n\n# Required-base: cleanup.\nRUN rm -rf /tmp /dygiepp/{scripts,dygie}\n\n# Required-base: on run, ensure conda env is activated and /dygiepp is workdir.\nWORKDIR /dygiepp/\nSHELL [\"/bin/bash\", \"-c\"]\nRUN conda init bash\nRUN echo \"conda activate dygiepp\" >> ~/.bashrc\nENV PATH /opt/conda/envs/dygiepp/bin:$PATH\nENV CONDA_DEFAULT_ENV dygiepp\n"
}