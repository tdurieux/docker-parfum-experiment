{
  "startTime": 1674251716234,
  "endTime": 1674251718040,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 32,
        "lineEnd": 32,
        "columnStart": 22,
        "columnEnd": 44
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Multi-stage build\n# Dockerfile.hvd-apex\n\nARG PTH_VERSION\n\n# 1/Building apex with pytorch:*-devel\nFROM pytorch/pytorch:${PTH_VERSION}-devel AS apex-hvd-builder\n\nARG ARG_TORCH_CUDA_ARCH_LIST=\"3.5 5.2 6.0 6.1 7.0+PTX 8.0\"\nENV TORCH_CUDA_ARCH_LIST=$ARG_TORCH_CUDA_ARCH_LIST\n\n# Renew nvidia signing key\n# https://developer.nvidia.com/blog/updating-the-cuda-linux-gpg-repository-key/\nRUN apt-key del 7fa2af80 && \\\n    rm /etc/apt/sources.list.d/nvidia-ml.list && \\\n    apt-key adv --fetch-keys https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/3bf863cc.pub\n\n# Install git\nRUN apt-get update && apt-get install -y --no-install-recommends git && \\\n     rm -rf /var/lib/apt/lists/*\n\n# Build apex\nRUN echo \"Setup NVIDIA Apex\" && \\\n    tmp_apex_path=\"/tmp/apex\" && \\\n    rm -rf $tmp_apex_path && \\\n    git clone https://github.com/NVIDIA/apex $tmp_apex_path && \\\n    cd $tmp_apex_path && \\\n    pip wheel --no-cache-dir --global-option=\"--cpp_ext\" --global-option=\"--cuda_ext\" .\n\nARG HVD_VERSION\n\n# Build Horovod\nRUN apt-get update && apt-get install --no-install-recommends -y git && \\\n        git clone --recursive --depth 1 --branch ${HVD_VERSION} https://github.com/horovod/horovod.git /horovod && \\\n        conda install -y cmake nccl=2.11 -c conda-forge && \\\n        cd /horovod && \\\n        HOROVOD_GPU_OPERATIONS=NCCL HOROVOD_NCCL_LINK=SHARED HOROVOD_WITHOUT_MPI=1 HOROVOD_WITH_PYTORCH=1 pip wheel --no-cache-dir . && \\\n        rm -rf /var/lib/apt/lists/*\n\n# Build runtime image\nFROM pytorch/pytorch:${PTH_VERSION}-runtime\n\n# Apex\nCOPY --from=apex-hvd-builder /tmp/apex/apex-*.whl /tmp/apex/\nRUN pip install --no-cache-dir /tmp/apex/apex-*.whl && \\\n    rm -fr /tmp/apex\n\n# Install tzdata / git\nRUN apt-get update && \\\n    ln -fs /usr/share/zoneinfo/Europe/Paris /etc/localtime && \\\n    apt-get -y install --no-install-recommends tzdata git && \\\n    dpkg-reconfigure --frontend noninteractive tzdata && \\\n    apt-get autoremove -y && \\\n    apt-get clean -y && \\\n    rm -rf /var/lib/apt/lists/*\n\n# Ignite main dependencies\nRUN pip install --upgrade --no-cache-dir pytorch-ignite \\\n                                         tensorboard \\\n                                         tqdm \\\n                                         fire\n\n# Replace pillow with pillow-simd\nRUN apt-get update && apt-get -y install --no-install-recommends g++ && \\\n    pip uninstall -y pillow && \\\n    CC=\"cc -mavx2\" pip install --upgrade --no-cache-dir --force-reinstall pillow-simd && \\\n    apt-get remove -y g++ && \\\n    apt-get autoremove -y && \\\n    rm -rf /var/lib/apt/lists/*\n\n# Checkout Ignite examples only\nRUN mkdir -p pytorch-ignite-examples && \\\n    cd pytorch-ignite-examples && \\\n    git init && \\\n    git config core.sparsecheckout true && \\\n    echo examples >> .git/info/sparse-checkout && \\\n    git remote add -f origin https://github.com/pytorch/ignite.git && \\\n    git pull origin master && \\\n    # rm very large .git folder\n    rm -rf .git\n\n# Horovod\nRUN conda install -y nccl=2.11 -c conda-forge\n\nENV LD_LIBRARY_PATH=/opt/conda/lib:$LD_LIBRARY_PATH\n\nCOPY --from=apex-hvd-builder /horovod/horovod-*.whl /horovod/\n\nRUN cd /horovod && \\\n    pip install --no-cache-dir horovod-*.whl && \\\n    rm -fr /horovod"
}