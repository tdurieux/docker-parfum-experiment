{
  "startTime": 1674218476906,
  "endTime": 1674218478044,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 33
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM debian:stable-slim AS domserver-build\nLABEL org.opencontainers.image.authors=\"DOMjudge team <team@domjudge.org>\"\n\nENV DEBIAN_FRONTEND=noninteractive\n\n# Install required packages for build of domserver\nRUN apt update \\\n\t&& apt install --no-install-recommends --no-install-suggests -y \\\n\tautoconf automake git \\\n\tgcc g++ make acl zip unzip \\\n\tphp-cli php-zip \\\n\tphp-gd php-curl php-mysql php-json php-intl \\\n\tphp-gmp php-xml php-mbstring \\\n\tsudo bsdmainutils ntp libcgroup-dev procps \\\n\tpython3-sphinx python3-sphinx-rtd-theme python3-pip fontconfig python3-yaml \\\n\ttexlive-latex-recommended texlive-latex-extra \\\n\ttexlive-fonts-recommended texlive-lang-european latexmk \\\n\tlibcurl4-gnutls-dev libjsoncpp-dev libmagic-dev \\\n\tenscript lpr ca-certificates \\\n\t&& rm -rf /var/lib/apt/lists/*\n\n# Needed for building the docs\nRUN pip3 install --no-cache-dir pygments rst2pdf\n\n# Set up user\nRUN useradd -m domjudge\n\n# Install composer\nRUN php -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\" \\\n\t&& php composer-setup.php \\\n\t&& mv /composer.phar /usr/local/bin/composer\n\n# Add DOMjudge source code and build script\nADD domjudge.tar.gz /domjudge-src\nCOPY domserver/build.sh /domjudge-src/build.sh\n\n# Build and install domserver\nRUN /domjudge-src/build.sh\n\n# Now create an image with the actual build in it\nFROM debian:stable-slim\nLABEL org.opencontainers.image.authors=\"DOMjudge team <team@domjudge.org>\"\n\nENV DEBIAN_FRONTEND=noninteractive \\\n\tCONTAINER_TIMEZONE=Europe/Amsterdam \\\n\tMYSQL_HOST=mariadb \\\n\tMYSQL_USER=domjudge \\\n\tMYSQL_DATABASE=domjudge \\\n\tMYSQL_PASSWORD=domjudge \\\n\tMYSQL_ROOT_PASSWORD=domjudge \\\n\tFPM_MAX_CHILDREN=40 \\\n\tDJ_DB_INSTALL_BARE=0\n\n# Install required packages for running of domserver\nRUN apt update \\\n\t&& apt install --no-install-recommends --no-install-suggests -y \\\n\tacl curl zip unzip supervisor mariadb-client apache2-utils \\\n\tnginx php-cli php-fpm php-zip \\\n\tphp-gd php-curl php-mysql php-json php-intl \\\n\tphp-gmp php-xml php-mbstring php-ldap \\\n\tenscript lpr \\\n\tca-certificates python3-yaml \\\n\t&& rm -rf /var/lib/apt/lists/*\n\n# Install composer\nRUN php -r \"copy('https://getcomposer.org/installer', 'composer-setup.php');\" \\\n\t&& php composer-setup.php \\\n\t&& mv /composer.phar /usr/local/bin/composer\n\n# Copy domserver\nCOPY --from=domserver-build /opt/domjudge/domserver /opt/domjudge/domserver\nCOPY --from=domserver-build /opt/domjudge/doc /opt/domjudge/doc\n\n# Copy scripts\nCOPY domserver/scripts /scripts/\nCOPY domserver/supervisor /etc/supervisor/conf.d/\n\n# Make the scripts available to the root user\nENV PATH=\"$PATH:/opt/domjudge/domserver/bin\"\n\n# Run customizations\nCOPY domserver/configure.sh /configure.sh\nRUN chmod 700 /configure.sh && /configure.sh && rm -f /configure.sh\n\n# Expose HTTP port\nEXPOSE 80\n\n# Healthchecking script\nHEALTHCHECK --interval=10s --timeout=10s --start-period=30s --retries=3 CMD [ \"/scripts/bin/healthcheck\" ]\n\nCMD [\"/scripts/start.sh\"]\n"
}