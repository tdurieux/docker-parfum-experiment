{
  "startTime": 1674220170377,
  "endTime": 1674220171961,
  "originalSmells": [
    {
      "rule": "rmRecursiveAfterMktempD",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 17,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 7,
        "columnEnd": 41
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 7,
        "columnEnd": 41
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Copyright 2020 Telstra Open Source\n#\n#   Licensed under the Apache License, Version 2.0 (the \"License\");\n#   you may not use this file except in compliance with the License.\n#   You may obtain a copy of the License at\n#\n#       http://www.apache.org/licenses/LICENSE-2.0\n#\n#   Unless required by applicable law or agreed to in writing, software\n#   distributed under the License is distributed on an \"AS IS\" BASIS,\n#   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n#   See the License for the specific language governing permissions and\n#   limitations under the License.\n#\n\n# Can't use official lisquibase image, because it's minimal version is 3.10.x, while\n# liquebase-orientdb(https://github.com/unbroken-dome/liquibase-orientdb) plugin\n# can work up to version 3.5.3\n\nFROM openjdk:11-jre-slim-buster\n\n# Install GPG for package vefification\nRUN apt-get update \\\n    && apt-get -y --no-install-recommends install gnupg wget curl && rm -rf /var/lib/apt/lists/*;\n\n# Add the liquibase user and step in the directory\nRUN addgroup --gid 1001 liquibase\nRUN adduser --disabled-password --uid 1001 --ingroup liquibase liquibase\n\n# Make /liquibase directory and change owner to liquibase\nRUN mkdir /liquibase && chown liquibase /liquibase\nWORKDIR /liquibase\n\n# Change to the liquibase user\nUSER liquibase\n\n# Latest Liquibase Release Version\nARG LIQUIBASE_VERSION=3.5.5\n\n# Download, verify, extract\nARG LB_SHA256=da0df7f6ea7694fb62b1448c3c734644d8d49795ff9bb7417db18bb1da5ff2c6\nRUN set -x \\\n  && wget -O liquibase-${LIQUIBASE_VERSION}.tar.gz \"https://github.com/liquibase/liquibase/releases/download/liquibase-parent-${LIQUIBASE_VERSION}/liquibase-${LIQUIBASE_VERSION}-bin.tar.gz\" \\\n  && echo \"$LB_SHA256  liquibase-${LIQUIBASE_VERSION}.tar.gz\" | sha256sum -c - \\\n  && tar -xzf liquibase-${LIQUIBASE_VERSION}.tar.gz \\\n  && rm liquibase-${LIQUIBASE_VERSION}.tar.gz\n\n# Setup GPG\nRUN GNUPGHOME=\"$(mktemp -d)\" && rm -rf -d\n\n# Download JDBC libraries and plugins\n\nRUN set -x \\\n  && mkdir -p /liquibase/lib/ \\\n  && wget -O /liquibase/lib/orientdb-jdbc-3.0.34-all.jar \\\n             \"https://repo1.maven.org/maven2/com/orientechnologies/orientdb-jdbc/3.0.34/orientdb-jdbc-3.0.34-all.jar\"  \\\n  # && wget -O /liquibase/lib/liquibase-orientdb-0.3.0.jar \\\n  #            \"https://dl.bintray.com/till-krullmann/tools/org/unbroken-dome/liquibase-orientdb/liquibase-orientdb/0.3.0/liquibase-orientdb-0.3.0.jar\"  \\\n  # black magic satisfying dependencies of `liquibase-orientdb-0.3.0.jar`\n  && wget -O /liquibase/lib/commons-lang3-3.6.jar \\\n             \"https://repo1.maven.org/maven2/org/apache/commons/commons-lang3/3.6/commons-lang3-3.6.jar\" \\\n  && wget -O /liquibase/lib/commons-beanutils-1.9.2.jar \\\n             \"https://repo1.maven.org/maven2/commons-beanutils/commons-beanutils/1.9.2/commons-beanutils-1.9.2.jar\" \\\n  && wget -O /liquibase/lib/guava-23.3-jre.jar \\\n             \"https://repo1.maven.org/maven2/com/google/guava/guava/23.3-jre/guava-23.3-jre.jar\" \\\n  && wget -O /liquibase/lib/validation-api-1.1.0.Final.jar \\\n             \"https://repo1.maven.org/maven2/javax/validation/validation-api/1.1.0.Final/validation-api-1.1.0.Final.jar\" \\\n  && wget -O /liquibase/lib/hibernate-validator-5.2.4.Final.jar \\\n             \"https://repo1.maven.org/maven2/org/hibernate/hibernate-validator/5.2.4.Final/hibernate-validator-5.2.4.Final.jar\" \\\n  && wget -O /liquibase/lib/jackson-databind-2.6.7.jar \\\n             \"https://repo1.maven.org/maven2/com/fasterxml/jackson/core/jackson-databind/2.6.7/jackson-databind-2.6.7.jar\" \\\n  && wget -O /liquibase/lib/jboss-logging-3.2.1.Final.jar \\\n             \"https://repo1.maven.org/maven2/org/jboss/logging/jboss-logging/3.2.1.Final/jboss-logging-3.2.1.Final.jar\" \\\n  && wget -O /liquibase/lib/classmate-1.1.0.jar \\\n             \"https://repo1.maven.org/maven2/com/fasterxml/classmate/1.1.0/classmate-1.1.0.jar\" \\\n  && chown -R liquibase:liquibase /liquibase/lib/\n\nCOPY --chown=liquibase:liquibase lib/liquibase-orientdb-0.3.0.jar /liquibase/lib/liquibase-orientdb-0.3.0.jar\n\nENV KILDA_ORIENTDB_USER=kilda\nENV KILDA_ORIENTDB_PASSWORD=kilda\nENV KILDA_ORIENTDB_HOST=odb1.pendev\nENV KILDA_ORIENTDB_DB_NAME=kilda\n\nUSER root\n\nCOPY migrate.sh migrate-develop.sh apply-prehistory-migrations.sh /kilda/\nRUN install install -g liquibase -o liquibase -d /kilda/flag\nCOPY migrations /liquibase/migrations\n\nUSER liquibase\n\nCMD /kilda/migrate.sh\n"
}