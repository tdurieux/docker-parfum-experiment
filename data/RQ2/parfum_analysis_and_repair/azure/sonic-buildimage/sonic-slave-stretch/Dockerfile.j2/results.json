{
  "startTime": 1674246110748,
  "endTime": 1674246114390,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 455,
        "lineEnd": 455,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 307,
        "lineEnd": 307,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 308,
        "lineEnd": 308,
        "columnStart": 4,
        "columnEnd": 25
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 337,
        "lineEnd": 337,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 338,
        "lineEnd": 338,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 342,
        "lineEnd": 344,
        "columnStart": 4,
        "columnEnd": 14
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 347,
        "lineEnd": 347,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 353,
        "lineEnd": 353,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 357,
        "lineEnd": 357,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 360,
        "lineEnd": 360,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 361,
        "lineEnd": 361,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 364,
        "lineEnd": 364,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 365,
        "lineEnd": 365,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 366,
        "lineEnd": 366,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 367,
        "lineEnd": 367,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 371,
        "lineEnd": 371,
        "columnStart": 4,
        "columnEnd": 22
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 374,
        "lineEnd": 374,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 377,
        "lineEnd": 377,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 378,
        "lineEnd": 378,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 379,
        "lineEnd": 379,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 380,
        "lineEnd": 380,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 383,
        "lineEnd": 383,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 386,
        "lineEnd": 386,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 389,
        "lineEnd": 389,
        "columnStart": 4,
        "columnEnd": 21
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 448,
        "lineEnd": 448,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 451,
        "lineEnd": 451,
        "columnStart": 4,
        "columnEnd": 109
      }
    },
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 406,
        "lineEnd": 406,
        "columnStart": 50,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 409,
        "lineEnd": 409,
        "columnStart": 47,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 412,
        "lineEnd": 412,
        "columnStart": 47,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 415,
        "lineEnd": 415,
        "columnStart": 47,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 50,
        "lineEnd": 172,
        "columnStart": 22,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 304,
        "lineEnd": 304,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 395,
        "lineEnd": 395,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 398,
        "lineEnd": 398,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 400,
        "lineEnd": 400,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 401,
        "lineEnd": 401,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 402,
        "lineEnd": 402,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 428,
        "lineEnd": 433,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 441,
        "lineEnd": 441,
        "columnStart": 4,
        "columnEnd": 104
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 443,
        "lineEnd": 443,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 456,
        "lineEnd": 456,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 304,
        "lineEnd": 304,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 395,
        "lineEnd": 395,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 398,
        "lineEnd": 398,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 400,
        "lineEnd": 400,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 401,
        "lineEnd": 401,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 402,
        "lineEnd": 402,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 406,
        "lineEnd": 406,
        "columnStart": 50,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 409,
        "lineEnd": 409,
        "columnStart": 47,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 412,
        "lineEnd": 412,
        "columnStart": 47,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 415,
        "lineEnd": 415,
        "columnStart": 47,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 428,
        "lineEnd": 433,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 441,
        "lineEnd": 441,
        "columnStart": 4,
        "columnEnd": 104
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 443,
        "lineEnd": 443,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 456,
        "lineEnd": 456,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 50,
        "lineEnd": 172,
        "columnStart": 22,
        "columnEnd": 36
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 304,
        "lineEnd": 304,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 395,
        "lineEnd": 395,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 398,
        "lineEnd": 398,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 400,
        "lineEnd": 400,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 401,
        "lineEnd": 401,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 402,
        "lineEnd": 402,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 428,
        "lineEnd": 433,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 441,
        "lineEnd": 441,
        "columnStart": 4,
        "columnEnd": 104
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 443,
        "lineEnd": 443,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 456,
        "lineEnd": 456,
        "columnStart": 4,
        "columnEnd": 29
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 304,
        "lineEnd": 304,
        "columnStart": 4,
        "columnEnd": 80
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 395,
        "lineEnd": 395,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 398,
        "lineEnd": 398,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 400,
        "lineEnd": 400,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 401,
        "lineEnd": 401,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 402,
        "lineEnd": 402,
        "columnStart": 4,
        "columnEnd": 74
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 406,
        "lineEnd": 406,
        "columnStart": 50,
        "columnEnd": 71
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 409,
        "lineEnd": 409,
        "columnStart": 47,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 412,
        "lineEnd": 412,
        "columnStart": 47,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 415,
        "lineEnd": 415,
        "columnStart": 47,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 428,
        "lineEnd": 433,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 441,
        "lineEnd": 441,
        "columnStart": 4,
        "columnEnd": 128
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 443,
        "lineEnd": 443,
        "columnStart": 4,
        "columnEnd": 78
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 456,
        "lineEnd": 456,
        "columnStart": 4,
        "columnEnd": 53
      }
    }
  ],
  "repairedDockerfile": "{% set prefix = DEFAULT_CONTAINER_REGISTRY %}\n{%- if CONFIGURED_ARCH == \"armhf\" and MULTIARCH_QEMU_ENVIRON == \"y\" %}\nFROM {{ prefix }}multiarch/debian-debootstrap:armhf-stretch\n{%- elif CONFIGURED_ARCH == \"arm64\" and MULTIARCH_QEMU_ENVIRON == \"y\" %}\nFROM {{ prefix }}multiarch/debian-debootstrap:arm64-stretch\n{%- else -%}\nFROM {{ prefix }}debian:stretch\n{%- endif %}\n\nMAINTAINER gulv@microsoft.com\n\nCOPY [\"no-check-valid-until\", \"/etc/apt/apt.conf.d/\"]\n\nRUN echo \"deb [arch=amd64] http://debian-archive.trafficmanager.net/debian/ stretch main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=amd64] http://debian-archive.trafficmanager.net/debian/ stretch main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=amd64] http://debian-archive.trafficmanager.net/debian-security/ stretch/updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=amd64] http://debian-archive.trafficmanager.net/debian-security/ stretch/updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=amd64] http://debian-archive.trafficmanager.net/debian stretch-backports main\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=amd64] http://packages.trafficmanager.net/debian/debian stretch main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=amd64] http://packages.trafficmanager.net/debian/debian stretch-updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=amd64] http://packages.trafficmanager.net/debian/debian-security stretch_updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=amd64] http://packages.microsoft.com/debian/9/prod stretch main\" >> /etc/apt/sources.list\n\n{%- if CONFIGURED_ARCH == \"armhf\" %}\nRUN echo \"deb [arch=armhf] http://deb.debian.org/debian stretch main contrib non-free\" > /etc/apt/sources.list && \\\n        echo \"deb-src [arch=armhf] http://deb.debian.org/debian stretch main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=armhf] http://deb.debian.org/debian stretch-updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=armhf] http://deb.debian.org/debian stretch-updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=armhf] http://security.debian.org stretch/updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=armhf] http://security.debian.org stretch/updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo 'deb [arch=armhf] http://ftp.debian.org/debian stretch-backports main' >> /etc/apt/sources.list && \\\n        echo \"deb [arch=armhf] http://packages.trafficmanager.net/debian/debian stretch main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=armhf] http://packages.trafficmanager.net/debian/debian stretch-updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=armhf] http://packages.trafficmanager.net/debian/debian-security stretch_updates main contrib non-free\" >> /etc/apt/sources.list\n{%- elif CONFIGURED_ARCH == \"arm64\" %}\nRUN echo \"deb [arch=arm64] http://deb.debian.org/debian stretch main contrib non-free\" > /etc/apt/sources.list && \\\n        echo \"deb-src [arch=arm64] http://deb.debian.org/debian stretch main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=arm64] http://deb.debian.org/debian stretch-updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=arm64] http://deb.debian.org/debian stretch-updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=arm64] http://security.debian.org stretch/updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=arm64] http://security.debian.org stretch/updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo 'deb [arch=arm64] http://ftp.debian.org/debian stretch-backports main' >> /etc/apt/sources.list && \\\n        echo \"deb [arch=arm64] http://packages.trafficmanager.net/debian/debian stretch main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=arm64] http://packages.trafficmanager.net/debian/debian stretch-updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=arm64] http://packages.trafficmanager.net/debian/debian-security stretch_updates main contrib non-free\" >> /etc/apt/sources.list\n{%- endif %}\n\n## Make apt-get non-interactive\nENV DEBIAN_FRONTEND=noninteractive\n\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n        apt-utils \\\n        default-jre-headless \\\n        openssh-server \\\n        curl \\\n        wget \\\n        unzip \\\n        git \\\n        build-essential \\\n        libtool \\\n        lintian \\\n        sudo \\\n        dh-make \\\n        dh-exec \\\n        kmod \\\n        libtinyxml2-4 \\\n        libboost-program-options1.62-dev \\\n        libtinyxml2-dev \\\n        python \\\n        python-pip \\\n        python3-pip \\\n        libncurses5-dev \\\n        texinfo \\\n        dh-autoreconf \\\n        doxygen \\\n        devscripts \\\n        git-buildpackage \\\n        perl-modules \\\n        libswitch-perl \\\n        dh-systemd \\\n        libzmq5 \\\n        libzmq3-dev \\\n        jq \\\n\n        libreadline-dev \\\n        texlive-latex-base \\\n        texlive-generic-recommended \\\n        texlive-fonts-recommended \\\n        libpam0g-dev \\\n        libpam-dev \\\n        libcap-dev \\\n        imagemagick \\\n        ghostscript \\\n        groff \\\n        libpcre3-dev \\\n        gawk \\\n        chrpath \\\n\n        libc-ares-dev \\\n        libsnmp-dev \\\n        libjson-c3 \\\n        libjson-c-dev \\\n        libsystemd-dev \\\n        python-ipaddr \\\n        libcmocka-dev \\\n        python3-all-dev \\\n        python3-all-dbg \\\n        install-info \\\n        logrotate \\\n\n        cdbs \\\n\n        libxml-simple-perl \\\n        graphviz \\\n        aspell \\\n\n        bc \\\n        fakeroot \\\n        build-essential \\\n        devscripts \\\n        quilt \\\n        stgit \\\n\n        module-assistant \\\n\n        gem2deb \\\n        libboost-all-dev \\\n        libevent-dev \\\n        libglib2.0-dev \\\n        libqt4-dev \\\n        python-all-dev \\\n        python-twisted \\\n        phpunit \\\n        libbit-vector-perl \\\n        openjdk-8-jdk \\\n        javahelper \\\n        maven-debian-helper \\\n        ant \\\n        libmaven-ant-tasks-java \\\n        libhttpclient-java \\\n        libslf4j-java \\\n        libservlet3.1-java \\\n        qt5-default \\\n        pkg-php-tools \\\n\n        libpcre3 \\\n        libpcre3-dev \\\n        byacc \\\n        flex \\\n        libglib2.0-dev \\\n        bison \\\n        expat \\\n        libexpat1-dev \\\n        dpatch \\\n        libdb-dev \\\n        iptables-dev \\\n        ctags \\\n\n        libtool-bin \\\n        libxml2-dev \\\n\n        libusb-1.0-0-dev \\\n        libcurl3-nss-dev \\\n        libunwind8-dev \\\n        telnet \\\n        libc-ares2 \\\n        libgoogle-perftools4 \\\n\n        cpio \\\n        squashfs-tools \\\n        zip \\\n\n{%- if CONFIGURED_ARCH == \"amd64\" %} && rm -rf /var/lib/apt/lists/*;\n        linux-compiler-gcc-6-x86 \\\n{%- endif %}\n{%- if CONFIGURED_ARCH == \"armhf\" %}\n        linux-compiler-gcc-6-arm \\\n{%- endif %}\n        linux-kbuild-4.9 \\\n# teamd build\n        libdaemon-dev \\\n        libdbus-1-dev \\\n        libjansson-dev \\\n# For cavium sdk build\n        libpcap-dev \\\n        dnsutils \\\n        libusb-dev \\\n# For debian image reconfiguration\n        augeas-tools \\\n# For p4 build\n        libyaml-dev \\\n        libevent-dev \\\n        libjudy-dev \\\n        libedit-dev \\\n        libnanomsg-dev \\\n        python-stdeb \\\n# For redis build\n        libjemalloc-dev \\\n        liblua5.1-0-dev \\\n        lua-bitop-dev  \\\n        lua-cjson-dev \\\n# For mft kernel module build\n        dkms \\\n# For Jenkins static analysis, unit testing and code coverage\n        cppcheck \\\n        clang \\\n        pylint \\\n        python-pytest \\\n        gcovr \\\n        python-pytest-cov \\\n        python-parse \\\n# For snmpd\n        default-libmysqlclient-dev \\\n        libssl1.0-dev \\\n        libperl-dev \\\n        libpci-dev \\\n        libpci3 \\\n        libsensors4 \\\n        libsensors4-dev \\\n        libwrap0-dev \\\n# For lldpd\n\tdebhelper \\\n        autotools-dev \\\n        libbsd-dev \\\n        pkg-config \\\n        check \\\n# For mpdecimal\n        docutils-common \\\n        libjs-sphinxdoc \\\n        libjs-underscore \\\n        python-docutils \\\n        python-jinja2 \\\n        python-markupsafe \\\n        python-pygments \\\n        python-roman \\\n        python-sphinx \\\n        sphinx-common \\\n        python3-sphinx \\\n# For sonic config engine testing\n        python-dev \\\n{%- if CONFIGURED_ARCH == \"armhf\" or CONFIGURED_ARCH == \"arm64\" %}\n        libxslt-dev \\\n{%- endif %}\n# For lockfile\n        procmail \\\n# For pam_tacplus build\n        autoconf-archive \\\n# For iproute2\n        cm-super-minimal \\\n        libatm1-dev \\\n        libelf-dev \\\n        libmnl-dev \\\n        libselinux1-dev \\\n        linuxdoc-tools \\\n        lynx \\\n        texlive-latex-extra \\\n        texlive-latex-recommended \\\n        iproute2 \\\n# For bash\n        texi2html \\\n        sharutils \\\n        locales \\\n        time \\\n        man2html-base \\\n        libcunit1 \\\n        libcunit1-dev \\\n# For initramfs\n        bash-completion \\\n{%- if CONFIGURED_ARCH == \"amd64\" %}\n# For sonic vs image build\n        dosfstools \\\n        qemu-kvm \\\n        libvirt-clients \\\n{%- endif %}\n# For lm-sensors\n        librrd8 \\\n        librrd-dev \\\n        rrdtool \\\n# For kdump-tools\n        liblzo2-dev \\\n# For iptables\n        libnetfilter-conntrack-dev \\\n        libnftnl-dev \\\n# For SAI3.7\n        protobuf-compiler \\\n        libprotobuf-dev \\\n        xxd \\\n# For DHCP Monitor tool\n        libexplain-dev \\\n        libevent-dev \\\n# For libyang\n        swig \\\n# For sonic-mgmt-framework\n        autoconf \\\n        m4 \\\n        libxml2-utils \\\n        xsltproc \\\n        python-lxml \\\n        libexpat1-dev \\\n# For audisp-tacplus\n        libauparse-dev \\\n        auditd\n\n# For gmock\nRUN apt-get install --no-install-recommends -y libgmock-dev -t stretch-backports && rm -rf /var/lib/apt/lists/*;\n\n# Install dependencies for dhcp relay test\nRUN pip3 install --no-cache-dir parameterized==0.8.1\nRUN pip3 install --no-cache-dir pyfakefs\n\n## Config dpkg\n## install the configuration file if itâ€™s currently missing\nRUN sudo augtool --autosave \"set /files/etc/dpkg/dpkg.cfg/force-confmiss\"\n## combined with confold: overwrite configuration files that you have not modified\nRUN sudo augtool --autosave \"set /files/etc/dpkg/dpkg.cfg/force-confdef\"\n## do not modify the current configuration file, the new version is installed with a .dpkg-dist suffix\nRUN sudo augtool --autosave \"set /files/etc/dpkg/dpkg.cfg/force-confold\"\n\n# For linux build\nRUN apt-get -y build-dep linux\n\n# For gobgp and telemetry build\nRUN export VERSION=1.14.2 \\\n{%- if CONFIGURED_ARCH == \"armhf\" %}\n && wget https://storage.googleapis.com/golang/go$VERSION.linux-armv6l.tar.gz \\\n && tar -C /usr/local -xzf go$VERSION.linux-armv6l.tar.gz \\\n{%- elif CONFIGURED_ARCH == \"arm64\" %}\n && wget https://storage.googleapis.com/golang/go$VERSION.linux-arm64.tar.gz \\\n && tar -C /usr/local -xzf go$VERSION.linux-arm64.tar.gz \\\n{%- else %}\n && wget https://storage.googleapis.com/golang/go$VERSION.linux-amd64.tar.gz \\\n && tar -C /usr/local -xzf go$VERSION.linux-amd64.tar.gz \\\n{%- endif %}\n && echo 'export GOROOT=/usr/local/go' >> /etc/bash.bashrc \\\n && echo 'export PATH=$PATH:$GOROOT/bin' >> /etc/bash.bashrc \\\n && rm go$VERSION.linux-*.tar.gz\n\nRUN pip3 install --no-cache-dir --upgrade pip\nRUN pip2 install --no-cache-dir --upgrade 'pip<21'\nRUN apt-get purge -y python-pip python3-pip\n\n# For p4 build\nRUN pip2 install --no-cache-dir \\\n         ctypesgen==0.r125 \\\n         crc16\n\n# Note: Stick with Jinja2 2.x branch as the 3.x dropped support for Python 2.7\nRUN pip2 install --no-cache-dir --force-reinstall --upgrade \"Jinja2<3.0.0\"\n\n# For sonic config engine testing\n# Install pyangbind here, outside sonic-config-engine dependencies, as pyangbind causes enum34 to be installed.\n# enum34 causes Python 're' package to not work properly as it redefines an incompatible enum.py module\n# https://github.com/robshakir/pyangbind/issues/232\nRUN pip3 install --no-cache-dir pyangbind==0.8.1\nRUN pip3 uninstall -y enum34\n\n# For templating\nRUN pip2 install --no-cache-dir j2cli==0.3.10\n\n# For sonic snmpagent mock testing\nRUN pip3 install --no-cache-dir nose==1.3.7\nRUN pip3 install --no-cache-dir mockredispy==2.9.3\n\n# For sonic-mgmt-framework\nRUN pip2 install --no-cache-dir \"PyYAML==5.3.1\"\nRUN pip3 install --no-cache-dir \"PyYAML==5.3.1\"\nRUN pip2 install --no-cache-dir \"lxml==4.6.5\"\nRUN pip3 install --no-cache-dir \"lxml==4.6.5\"\n\n\n# For sonic-platform-common testing\nRUN pip3 install --no-cache-dir redis\n\n# For vs image build\nRUN pip2 install --no-cache-dir pexpect==4.6.0\n\n# For sonic-utilities build\nRUN pip2 install --no-cache-dir nose==1.3.7\nRUN pip2 install --no-cache-dir mockredispy==2.9.3\nRUN pip2 install --no-cache-dir pytest-runner==4.4\nRUN pip2 install --no-cache-dir setuptools==40.8.0\n\n# For sonic-swss-common testing\nRUN pip2 install --no-cache-dir Pympler==0.8\n\n# For sonic_yang_model build\nRUN pip3 install --no-cache-dir pyang==2.4.0\n\n# For mgmt-framework build\nRUN pip2 install --no-cache-dir mmh3\n\n# Install dependencies for isc-dhcp-relay build\nRUN apt-get -y build-dep isc-dhcp\n\n# Install vim\nRUN apt-get install --no-install-recommends -y vim && rm -rf /var/lib/apt/lists/*;\n\n# Install rsyslog\nRUN apt-get install --no-install-recommends -y rsyslog && rm -rf /var/lib/apt/lists/*;\n\nRUN apt-get install --no-install-recommends -y libgtest-dev && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends -y libarchive13 librhash0 && rm -rf /var/lib/apt/lists/*;\nRUN apt-get -t stretch-backports --no-install-recommends install -y libuv1 && rm -rf /var/lib/apt/lists/*;\n# Install cmake/cmake-data 3.13.2-1_bpo9+1\n# latest cmake 3.16.3 break the build libyang 1.0.73\nRUN wget -O cmake-data_3.13.2-1_bpo9+1_all.deb \"https://sonicstorage.blob.core.windows.net/packages/cmake/cmake-data_3.13.2-1_bpo9%2B1_all.deb?st=2020-03-27T02%3A22%3A24Z&se=2100-03-26T19%3A00%3A00Z&sp=rl&sv=2018-03-28&sr=b&sig=Xby%2Bm3OZOjPB%2FSlDbHD65yDcPzAgoys%2FA3vK8RB4BzA%3D\"\nRUN dpkg -i cmake-data_3.13.2-1_bpo9+1_all.deb || apt-get install -y -f\n{% if CONFIGURED_ARCH == \"armhf\" %}\nRUN wget -O cmake_3.13.2-1_bpo9+1_armhf.deb \"https://sonicstorage.blob.core.windows.net/packages/cmake/cmake_3.13.2-1_bpo9%2B1_armhf.deb?st=2020-03-27T02%3A29%3A41Z&se=2100-03-26T19%3A00%3A00Z&sp=rl&sv=2018-03-28&sr=b&sig=sWt7kxrFumn020d2GeutGJ716cuQsFwmAmgU%2BJ0kqnk%3D\"\nRUN dpkg -i cmake_3.13.2-1_bpo9+1_armhf.deb || apt-get install -y -f\n{% elif CONFIGURED_ARCH == \"arm64\" %}\nRUN wget -O cmake_3.13.2-1_bpo9+1_arm64.deb \"https://sonicstorage.blob.core.windows.net/packages/cmake/cmake_3.13.2-1_bpo9%2B1_arm64.deb?st=2020-03-27T02%3A28%3A38Z&se=2100-03-26T19%3A00%3A00Z&sp=rl&sv=2018-03-28&sr=b&sig=rrHMkLi29aI8yH6s52ILCY8VcEbNFrzYT2DmC5RwOgs%3D\"\nRUN dpkg -i cmake_3.13.2-1_bpo9+1_arm64.deb || apt-get install -y -f\n{% else %}\nRUN wget -O cmake_3.13.2-1_bpo9+1_amd64.deb \"https://sonicstorage.blob.core.windows.net/packages/cmake/cmake_3.13.2-1_bpo9%2B1_amd64.deb?st=2020-03-27T02%3A27%3A21Z&se=2100-03-26T19%3A00%3A00Z&sp=rl&sv=2018-03-28&sr=b&sig=4MvmmDBQuicFEJYakLm7xCNU19yJ8GIP4ankFSnITKY%3D\"\nRUN dpkg -i cmake_3.13.2-1_bpo9+1_amd64.deb || apt-get install -y -f\n{% endif %}\nRUN cd /usr/src/gtest && cmake . && make -C /usr/src/gtest\n\nRUN mkdir /var/run/sshd\nEXPOSE 22\n\n# Install depot-tools (for git-retry)\nRUN git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git /usr/share/depot_tools\nENV PATH /usr/share/depot_tools:$PATH\n\n# Install docker engine 17.03.2~ce-0 inside docker and enable experimental feature\nRUN apt-get update\nRUN apt-get install --no-install-recommends -y \\\n           apt-transport-https \\\n           ca-certificates \\\n           curl \\\n           gnupg2 \\\n           software-properties-common && rm -rf /var/lib/apt/lists/*;\nRUN curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -\nRUN add-apt-repository \\\n           \"deb [arch={{ CONFIGURED_ARCH }}] https://download.docker.com/linux/debian \\\n           $(lsb_release -cs) \\\n           stable\"\nRUN apt-get update\n{%- if CONFIGURED_ARCH == \"amd64\" %}\nRUN apt-get install --no-install-recommends -y docker-ce=5:18.09.5~3-0~debian-stretch docker-ce-cli=5:18.09.5~3-0~debian-stretch && rm -rf /var/lib/apt/lists/*;\n{%- else %}\nRUN apt-get install --no-install-recommends -y docker-ce=18.06.3~ce~3-0~debian && rm -rf /var/lib/apt/lists/*;\n{%- endif %}\nRUN echo \"DOCKER_OPTS=\\\"--experimental --storage-driver=vfs {{ DOCKER_EXTRA_OPTS }}\\\"\" >> /etc/default/docker\n\n# Install m2crypto package, needed by SWI tools\nRUN pip install --no-cache-dir m2crypto==0.36.0\n\n# Install swi tools\nRUN pip2 install --no-cache-dir git+https://github.com/aristanetworks/swi-tools.git@d51761ec0bb93c73039233f3c01ed48235ffad00\n\n{% if CONFIGURED_ARCH != \"amd64\" -%}\n# Install node.js for azure pipeline\nRUN curl -f -sL https://deb.nodesource.com/setup_10.x | bash -\nRUN apt-get install --no-install-recommends -y nodejs && rm -rf /var/lib/apt/lists/*;\n\n# Tell azure pipeline to use node.js in the docker\nLABEL \"com.azure.dev.pipelines.agent.handler.node.path\"=\"/usr/bin/node\"\n{% endif -%}\n\n# Install Bazel build system (amd64 and arm64 architectures are supported using this method)\n# TODO(PINS): Remove once pre-build Bazel binaries are available for armhf (armv7l)\n{%- if CONFIGURED_ARCH == \"amd64\" or CONFIGURED_ARCH == \"arm64\" %}\nARG bazelisk_url=https://github.com/bazelbuild/bazelisk/releases/latest/download/bazelisk-linux-{{ CONFIGURED_ARCH }}\nRUN curl -fsSL -o /usr/local/bin/bazel ${bazelisk_url} && chmod 755 /usr/local/bin/bazel\n{% endif -%}\n"
}