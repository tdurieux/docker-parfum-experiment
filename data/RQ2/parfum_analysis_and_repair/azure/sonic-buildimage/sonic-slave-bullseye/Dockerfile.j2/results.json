{
  "startTime": 1674251743495,
  "endTime": 1674251745639,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 519,
        "lineEnd": 519,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 415,
        "lineEnd": 415,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 419,
        "lineEnd": 419,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 420,
        "lineEnd": 420,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 423,
        "lineEnd": 423,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 426,
        "lineEnd": 426,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 427,
        "lineEnd": 427,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 428,
        "lineEnd": 428,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 431,
        "lineEnd": 433,
        "columnStart": 4,
        "columnEnd": 14
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 439,
        "lineEnd": 439,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 443,
        "lineEnd": 443,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 446,
        "lineEnd": 446,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 447,
        "lineEnd": 447,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 450,
        "lineEnd": 450,
        "columnStart": 4,
        "columnEnd": 22
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 453,
        "lineEnd": 453,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 456,
        "lineEnd": 456,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 459,
        "lineEnd": 459,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 462,
        "lineEnd": 462,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 464,
        "lineEnd": 464,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 487,
        "lineEnd": 487,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 488,
        "lineEnd": 488,
        "columnStart": 4,
        "columnEnd": 25
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 512,
        "lineEnd": 512,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 515,
        "lineEnd": 515,
        "columnStart": 4,
        "columnEnd": 109
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 54,
        "lineEnd": 173,
        "columnStart": 22,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 373,
        "lineEnd": 374,
        "columnStart": 11,
        "columnEnd": 84
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 387,
        "lineEnd": 387,
        "columnStart": 11,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 406,
        "lineEnd": 406,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 466,
        "lineEnd": 466,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 472,
        "lineEnd": 472,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 475,
        "lineEnd": 475,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 492,
        "lineEnd": 497,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 507,
        "lineEnd": 507,
        "columnStart": 4,
        "columnEnd": 131
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 520,
        "lineEnd": 520,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 533,
        "lineEnd": 533,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 373,
        "lineEnd": 374,
        "columnStart": 11,
        "columnEnd": 84
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 387,
        "lineEnd": 387,
        "columnStart": 11,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 406,
        "lineEnd": 406,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 466,
        "lineEnd": 466,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 472,
        "lineEnd": 472,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 475,
        "lineEnd": 475,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 492,
        "lineEnd": 497,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 507,
        "lineEnd": 507,
        "columnStart": 4,
        "columnEnd": 131
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 520,
        "lineEnd": 520,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 533,
        "lineEnd": 533,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 54,
        "lineEnd": 173,
        "columnStart": 22,
        "columnEnd": 36
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 373,
        "lineEnd": 374,
        "columnStart": 11,
        "columnEnd": 84
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 387,
        "lineEnd": 387,
        "columnStart": 11,
        "columnEnd": 51
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 406,
        "lineEnd": 406,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 466,
        "lineEnd": 466,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 472,
        "lineEnd": 472,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 475,
        "lineEnd": 475,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 492,
        "lineEnd": 497,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 507,
        "lineEnd": 507,
        "columnStart": 4,
        "columnEnd": 131
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 520,
        "lineEnd": 520,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 533,
        "lineEnd": 533,
        "columnStart": 4,
        "columnEnd": 36
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 373,
        "lineEnd": 374,
        "columnStart": 11,
        "columnEnd": 84
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 387,
        "lineEnd": 387,
        "columnStart": 11,
        "columnEnd": 75
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 406,
        "lineEnd": 406,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 466,
        "lineEnd": 466,
        "columnStart": 4,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 472,
        "lineEnd": 472,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 475,
        "lineEnd": 475,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 492,
        "lineEnd": 497,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 507,
        "lineEnd": 507,
        "columnStart": 4,
        "columnEnd": 155
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 520,
        "lineEnd": 520,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 533,
        "lineEnd": 533,
        "columnStart": 4,
        "columnEnd": 60
      }
    }
  ],
  "repairedDockerfile": "{% set prefix = DEFAULT_CONTAINER_REGISTRY %}\n{%- if CONFIGURED_ARCH == \"armhf\" and MULTIARCH_QEMU_ENVIRON == \"y\" %}\nFROM {{ prefix }}multiarch/qemu-user-static:x86_64-arm-6.1.0-8 as qemu\nFROM {{ prefix }}multiarch/debian-debootstrap:armhf-bullseye\nCOPY --from=qemu /usr/bin/qemu-arm-static /usr/bin\n{%- elif CONFIGURED_ARCH == \"arm64\" and MULTIARCH_QEMU_ENVIRON == \"y\" %}\nFROM {{ prefix }}multiarch/qemu-user-static:x86_64-aarch64-6.1.0-8 as qemu\nFROM {{ prefix }}multiarch/debian-debootstrap:arm64-bullseye\nCOPY --from=qemu /usr/bin/qemu-aarch64-static /usr/bin\n{%- else -%}\nFROM {{ prefix }}debian:bullseye\n{%- endif %}\n\nMAINTAINER gulv@microsoft.com\n\nCOPY [\"no-check-valid-until\", \"/etc/apt/apt.conf.d/\"]\n\n## TODO: Re-add in any necessary mirror URLs here as they become available\nRUN echo \"deb [arch=amd64] http://debian-archive.trafficmanager.net/debian/ bullseye main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=amd64] http://debian-archive.trafficmanager.net/debian/ bullseye main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=amd64] http://debian-archive.trafficmanager.net/debian-security/ bullseye-security main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=amd64] http://debian-archive.trafficmanager.net/debian-security/ bullseye-security main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=amd64] http://debian-archive.trafficmanager.net/debian bullseye-backports main\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=amd64] http://packages.trafficmanager.net/debian/debian-security bullseye-security main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=amd64] http://packages.trafficmanager.net/debian/debian bullseye main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=amd64] http://packages.trafficmanager.net/debian/debian bullseye-updates main contrib non-free\" >> /etc/apt/sources.list\n\n{%- if CONFIGURED_ARCH == \"armhf\" %}\nRUN echo \"deb [arch=armhf] http://deb.debian.org/debian bullseye main contrib non-free\" > /etc/apt/sources.list && \\\n        echo \"deb-src [arch=armhf] http://deb.debian.org/debian bullseye main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=armhf] http://deb.debian.org/debian bullseye-updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=armhf] http://deb.debian.org/debian bullseye-updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=armhf] http://security.debian.org bullseye-security main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=armhf] http://security.debian.org bullseye-security main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo 'deb [arch=armhf] http://ftp.debian.org/debian bullseye-backports main' >> /etc/apt/sources.list && \\\n        echo \"deb [arch=armhf] http://packages.trafficmanager.net/debian/debian-security bullseye-security main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=armhf] http://packages.trafficmanager.net/debian/debian bullseye main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=armhf] http://packages.trafficmanager.net/debian/debian bullseye-updates main contrib non-free\" >> /etc/apt/sources.list\n{%- elif CONFIGURED_ARCH == \"arm64\" %}\nRUN echo \"deb [arch=arm64] http://deb.debian.org/debian bullseye main contrib non-free\" > /etc/apt/sources.list && \\\n        echo \"deb-src [arch=arm64] http://deb.debian.org/debian bullseye main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=arm64] http://deb.debian.org/debian bullseye-updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=arm64] http://deb.debian.org/debian bullseye-updates main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=arm64] http://security.debian.org bullseye-security main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb-src [arch=arm64] http://security.debian.org bullseye-security main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=arm64] http://packages.trafficmanager.net/debian/debian-security bullseye-security main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo 'deb [arch=arm64] http://ftp.debian.org/debian bullseye-backports main' >> /etc/apt/sources.list && \\\n        echo \"deb [arch=arm64] http://packages.trafficmanager.net/debian/debian bullseye main contrib non-free\" >> /etc/apt/sources.list && \\\n        echo \"deb [arch=arm64] http://packages.trafficmanager.net/debian/debian bullseye-updates main contrib non-free\" >> /etc/apt/sources.list\n{%- endif %}\n\n## Make apt-get non-interactive\nENV DEBIAN_FRONTEND=noninteractive\n\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n        apt-utils \\\n        default-jre-headless \\\n        openssh-server \\\n        curl \\\n        wget \\\n        unzip \\\n        git \\\n        build-essential \\\n        libtool \\\n        lintian \\\n        sudo \\\n        dh-make \\\n        dh-exec \\\n        kmod \\\n        libtinyxml2-dev \\\n        python-all \\\n        python-dev \\\n        python-setuptools \\\n        python3 \\\n        python3-pip \\\n        libncurses5-dev \\\n        texinfo \\\n        dh-autoreconf \\\n        doxygen \\\n        devscripts \\\n        git-buildpackage \\\n        perl-modules \\\n        libclass-accessor-perl \\\n        libswitch-perl \\\n        libzmq5 \\\n        libzmq3-dev \\\n        jq \\\n        cron \\\n\n        libreadline-dev \\\n        texlive-latex-base \\\n        texlive-plain-generic \\\n        texlive-fonts-recommended \\\n        libpam0g-dev \\\n        libpam-dev \\\n        libcap-dev \\\n        imagemagick \\\n        ghostscript \\\n        groff \\\n        libpcre3-dev \\\n        gawk \\\n        chrpath \\\n\n        libc-ares-dev \\\n        libsnmp-dev \\\n        libjson-c-dev \\\n        libsystemd-dev \\\n        python3-ipaddr \\\n        libcmocka-dev \\\n        python3-all-dev \\\n        python3-all-dbg \\\n        install-info \\\n        logrotate \\\n\n        cdbs \\\n\n        libxml-simple-perl \\\n        graphviz \\\n        aspell \\\n\n        bc \\\n        fakeroot \\\n        build-essential \\\n        devscripts \\\n        quilt \\\n        stgit \\\n        sbsigntool \\\n\n        module-assistant \\\n\n        gem2deb \\\n        libevent-dev \\\n        libglib2.0-dev \\\n        python3-all-dev \\\n        python3-twisted \\\n        phpunit \\\n        libbit-vector-perl \\\n        openjdk-11-jdk \\\n        javahelper \\\n        maven-debian-helper \\\n        ant \\\n        libhttpclient-java \\\n        libslf4j-java \\\n        libservlet3.1-java \\\n        pkg-php-tools \\\n\n        libpcre3 \\\n        libpcre3-dev \\\n        byacc \\\n        flex \\\n        libglib2.0-dev \\\n        bison \\\n        expat \\\n        libexpat1-dev \\\n        dpatch \\\n        libdb-dev \\\n        libiptc-dev \\\n        libxtables-dev \\\n\n        libtool-bin \\\n        libxml2-dev \\\n\n        libusb-1.0-0-dev \\\n        libcurl3-nss-dev \\\n        libunwind8-dev \\\n        telnet \\\n        libc-ares2 \\\n        libgoogle-perftools4 \\\n\n        cpio \\\n        squashfs-tools \\\n        zip \\\n\n{%- if CONFIGURED_ARCH == \"amd64\" %} && rm -rf /var/lib/apt/lists/*;\n        linux-compiler-gcc-10-x86 \\\n{%- endif %}\n{%- if CONFIGURED_ARCH == \"armhf\" %}\n        linux-compiler-gcc-10-arm \\\n{%- endif %}\n        linux-kbuild-5.10 \\\n# teamd build\n        libdaemon-dev \\\n        libdbus-1-dev \\\n        libjansson-dev \\\n# For cavium sdk build\n        libpcap-dev \\\n        dnsutils \\\n        libusb-dev \\\n# For debian image reconfiguration\n        augeas-tools \\\n# For p4 build\n        libyaml-dev \\\n        libevent-dev \\\n        libjudy-dev \\\n        libedit-dev \\\n        libnanomsg-dev \\\n        python3-stdeb \\\n# For redis build\n        libjemalloc-dev \\\n        liblua5.1-0-dev \\\n        lua-bitop-dev  \\\n        lua-cjson-dev \\\n# For mft kernel module build\n        dkms \\\n# For Jenkins static analysis, unit testing and code coverage\n        cppcheck \\\n        clang \\\n        pylint \\\n        python3-pytest \\\n        python3-venv \\\n        gcovr \\\n        python3-pytest-cov \\\n        python3-pytest-cov \\\n        python3-parse \\\n# For snmpd\n        default-libmysqlclient-dev \\\n        libssl-dev \\\n        libperl-dev \\\n        libpci-dev \\\n        libpci3 \\\n        libsensors5 \\\n        libsensors4-dev \\\n        libwrap0-dev \\\n# For lldpd\n\tdebhelper \\\n        autotools-dev \\\n        libbsd-dev \\\n        pkg-config \\\n        check \\\n# For mpdecimal\n        docutils-common \\\n        libjs-sphinxdoc \\\n        libjs-underscore \\\n        python3-docutils \\\n        python3-jinja2 \\\n        python3-markupsafe \\\n        python3-pygments \\\n        python3-roman \\\n        python3-sphinx \\\n        sphinx-common \\\n        python3-sphinx \\\n# For sonic config engine testing\n        python3-dev \\\n{%- if CONFIGURED_ARCH == \"armhf\" or CONFIGURED_ARCH == \"arm64\" %}\n        libxslt-dev \\\n{%- endif %}\n# For lockfile\n        procmail \\\n# For gtest\n        libgtest-dev \\\n        cmake \\\n# For gmock\n        libgmock-dev \\\n# For pam_tacplus build\n        autoconf-archive \\\n# For iproute2\n        cm-super-minimal \\\n        libatm1-dev \\\n        libelf-dev \\\n        libmnl-dev \\\n        libselinux1-dev \\\n        linuxdoc-tools \\\n        lynx \\\n        texlive-latex-extra \\\n        texlive-latex-recommended \\\n        iproute2 \\\n# For bash\n        texi2html \\\n        sharutils \\\n        locales \\\n        time \\\n        man2html-base \\\n        libcunit1 \\\n        libcunit1-dev \\\n# For initramfs\n        shellcheck \\\n        bash-completion \\\n{%- if CONFIGURED_ARCH == \"amd64\" %}\n# For sonic vs image build\n        dosfstools \\\n        qemu-kvm \\\n        libvirt-clients \\\n{%- endif %}\n# For ntp\n        autogen \\\n        libopts25-dev \\\n        pps-tools \\\n        dh-apparmor \\\n# For lm-sensors\n        librrd8 \\\n        librrd-dev \\\n        rrdtool \\\n# For kdump-tools\n        liblzo2-dev \\\n# For iptables\n        libnetfilter-conntrack-dev \\\n        libnftnl-dev \\\n# For SAI3.7\n        protobuf-compiler \\\n        libprotobuf-dev \\\n        xxd \\\n# For DHCP Monitor tool\n        libexplain-dev \\\n        libevent-dev \\\n# For libyang\n        swig \\\n# For build dtb\n        device-tree-compiler \\\n# For sonic-mgmt-framework\n        autoconf \\\n        m4 \\\n        libxml2-utils \\\n        xsltproc \\\n        python3-lxml \\\n        libexpat1-dev \\\n        libcurl3-gnutls \\\n        libcjson-dev \\\n# For WPA supplication\n        qtbase5-dev          \\\n        aspell-en            \\\n        libssl-dev           \\\n        dbus                 \\\n        libdbus-1-dev        \\\n        libdbus-glib-1-2     \\\n        libdbus-glib-1-dev   \\\n        libreadline-dev      \\\n        libncurses5-dev      \\\n        libpcsclite-dev      \\\n        docbook-to-man       \\\n        docbook-utils        \\\n# For kdump-tools\n        libbz2-dev \\\n# For linkmgrd\n        libboost-dev \\\n        libboost-program-options-dev \\\n        libboost-system-dev \\\n        libboost-thread-dev \\\n        libboost-atomic-dev \\\n        libboost-chrono-dev \\\n        libboost-container-dev \\\n        libboost-context-dev \\\n        libboost-contract-dev \\\n        libboost-coroutine-dev \\\n        libboost-date-time-dev \\\n        libboost-fiber-dev \\\n        libboost-filesystem-dev \\\n        libboost-graph-parallel-dev \\\n        libboost-log-dev \\\n        libboost-regex-dev \\\n        googletest \\\n        libgtest-dev \\\n        libgmock-dev \\\n        libgcc-10-dev \\\n# For sonic-host-services build\n        libcairo2-dev \\\n        libdbus-1-dev \\\n        libgirepository1.0-dev \\\n        libsystemd-dev \\\n        pkg-config \\\n# For audisp-tacplus\n        libauparse-dev \\\n        auditd\n\nRUN apt-get -y build-dep openssh\n\n# Build fix for ARM64 and ARMHF /etc/debian_version\n{%- if CONFIGURED_ARCH == \"armhf\" or CONFIGURED_ARCH == \"arm64\" %}\nRUN apt upgrade -y base-files\n{%- endif %}\n\n# Build fix for ARMHF bullseye libsairedis\n{%- if CONFIGURED_ARCH == \"armhf\" %}\n       # Install doxygen build dependency packages\n       RUN apt install --no-install-recommends -y libxapian-dev yui-compressor texlive-extra-utils \\\n           texlive-font-utils rdfind llvm-11-dev libclang-11-dev sassc faketime mat2 && rm -rf /var/lib/apt/lists/*;\n\n       # Update doxygen with 64bit file offset patch\n       RUN dget -u http://deb.debian.org/debian/pool/main/d/doxygen/doxygen_1.9.1-2.dsc && \\\n           cd doxygen-1.9.1 && \\\n           sed -i '56 a add_definitions(-D_FILE_OFFSET_BITS=64)' CMakeLists.txt && \\\n           DEB_BUILD_OPTIONS=nocheck dpkg-buildpackage -us -uc -b && \\\n           cd .. && \\\n           dpkg -i ./doxygen_1.9.1-2_armhf.deb && \\\n           rm -fr doxygen*\n\n       # Aspell is unable to locate the language dictionaries.\n       # Re-installing aspell-en dictionary to fix it.\n       RUN apt-get install --no-install-recommends --reinstall -y aspell-en && rm -rf /var/lib/apt/lists/*;\n\n       # workaround because of https://bugs.launchpad.net/qemu/+bug/1805913, just disable aspell\n       # Issue now being tracked here - https://gitlab.com/qemu-project/qemu/-/issues/263\n       RUN cp /bin/true /usr/bin/aspell\n{%- endif %}\n\n## Config dpkg\n## install the configuration file if it’s currently missing\nRUN sudo augtool --autosave \"set /files/etc/dpkg/dpkg.cfg/force-confmiss\"\n## combined with confold: overwrite configuration files that you have not modified\nRUN sudo augtool --autosave \"set /files/etc/dpkg/dpkg.cfg/force-confdef\"\n## do not modify the current configuration file, the new version is installed with a .dpkg-dist suffix\nRUN sudo augtool --autosave \"set /files/etc/dpkg/dpkg.cfg/force-confold\"\n\n# For linux build\nRUN apt-get -y build-dep linux\n\n# For gobgp and telemetry build\nRUN apt-get install --no-install-recommends -y golang-1.15 && ln -s /usr/lib/go-1.15 /usr/local/go && rm -rf /var/lib/apt/lists/*;\n{%- if ENABLE_FIPS_FEATURE == \"y\" %}\nRUN wget -O golang-go.deb 'https://sonicstorage.blob.core.windows.net/public/fips/bullseye/0.1/{{ CONFIGURED_ARCH }}/golang-1.15-go_1.15.15-1~deb11u4%2Bfips_{{ CONFIGURED_ARCH }}.deb' \\\n && wget -O golang-src.deb 'https://sonicstorage.blob.core.windows.net/public/fips/bullseye/0.1/{{ CONFIGURED_ARCH }}/golang-1.15-src_1.15.15-1~deb11u4%2Bfips_{{ CONFIGURED_ARCH }}.deb' \\\n && dpkg -i golang-go.deb golang-src.deb \\\n && ln -sf /usr/lib/go-1.15 /usr/local/go \\\n && rm golang-go.deb golang-src.deb\n{%- endif %}\n\nRUN pip3 install --no-cache-dir --upgrade pip\nRUN apt-get purge -y python3-pip python3-yaml\n\n# For building Python packages\nRUN pip3 install --no-cache-dir setuptools==49.6.00\nRUN pip3 install --no-cache-dir wheel==0.35.1\n\n# For building sonic-utilities\nRUN pip3 install --no-cache-dir fastentrypoints mock\n\n# For running Python unit tests\nRUN pip3 install --no-cache-dir pytest-runner==5.2\nRUN pip3 install --no-cache-dir nose==1.3.7\nRUN pip3 install --no-cache-dir mockredispy==2.9.3\n\n# For p4 build\nRUN pip3 install --no-cache-dir \\\n         ctypesgen==1.0.2 \\\n         crc16\n\n# For sonic config engine testing\n# Install pyangbind here, outside sonic-config-engine dependencies, as pyangbind causes enum34 to be installed.\n# enum34 causes Python 're' package to not work properly as it redefines an incompatible enum.py module\n# https://github.com/robshakir/pyangbind/issues/232\nRUN pip3 install --no-cache-dir pyangbind==0.8.1\nRUN pip3 uninstall -y enum34\n\n# For templating\nRUN pip3 install --no-cache-dir j2cli==0.3.10\n\n# For sonic-mgmt-framework\nRUN pip3 install --no-cache-dir \"PyYAML==5.4.1\"\nRUN pip3 install --no-cache-dir \"lxml==4.6.2\"\n\n# For sonic-platform-common testing\nRUN pip3 install --no-cache-dir redis\n\n# For vs image build\nRUN pip3 install --no-cache-dir pexpect==4.8.0\n\n# For sonic-swss-common testing\nRUN pip3 install --no-cache-dir Pympler==0.8\n\n# For sonic_yang_model build\nRUN pip3 install --no-cache-dir pyang==2.4.0\n\n# For mgmt-framework build\nRUN pip3 install --no-cache-dir mmh3==2.5.1\n\nRUN pip3 install --no-cache-dir parameterized==0.8.1\n\nRUN apt-get install --no-install-recommends -y xsltproc && rm -rf /var/lib/apt/lists/*;\n\n# Install dependencies for isc-dhcp-relay build\nRUN apt-get -y build-dep isc-dhcp\n\n# Install vim\nRUN apt-get install --no-install-recommends -y vim && rm -rf /var/lib/apt/lists/*;\n\n# Install rsyslog\nRUN apt-get install --no-install-recommends -y rsyslog && rm -rf /var/lib/apt/lists/*;\n\nRUN cd /usr/src/gtest && cmake . && make -C /usr/src/gtest\n\nRUN mkdir /var/run/sshd\nEXPOSE 22\n\n# Install depot-tools (for git-retry)\nRUN git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git /usr/share/depot_tools\nENV PATH /usr/share/depot_tools:$PATH\n\n# Install dependencies for dhcp relay test\nRUN pip3 install --no-cache-dir parameterized==0.8.1\nRUN pip3 install --no-cache-dir pyfakefs\n\n# Install docker engine 20.10 inside docker and enable experimental feature\nRUN apt-get update\nRUN apt-get install --no-install-recommends -y \\\n           apt-transport-https \\\n           ca-certificates \\\n           curl \\\n           gnupg2 \\\n           software-properties-common && rm -rf /var/lib/apt/lists/*;\n{%- if CONFIGURED_ARCH == \"armhf\" %}\n    RUN update-ca-certificates --fresh\n{%- endif %}\nRUN curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -\nRUN add-apt-repository \\\n           \"deb [arch={{ CONFIGURED_ARCH }}] https://download.docker.com/linux/debian \\\n           $(lsb_release -cs) \\\n           stable\"\nRUN apt-get update\nRUN apt-get install --no-install-recommends -y docker-ce=5:20.10.14~3-0~debian-bullseye docker-ce-cli=5:20.10.14~3-0~debian-bullseye containerd.io=1.5.11-1 && rm -rf /var/lib/apt/lists/*;\nRUN echo \"DOCKER_OPTS=\\\"--experimental --storage-driver=vfs {{ DOCKER_EXTRA_OPTS }}\\\"\" >> /etc/default/docker\nRUN update-alternatives --set iptables /usr/sbin/iptables-legacy\n\n# Install m2crypto package, needed by SWI tools\nRUN pip3 install --no-cache-dir m2crypto==0.36.0\n\n# Install swi tools\nRUN pip3 install --no-cache-dir git+https://github.com/aristanetworks/swi-tools.git@bead66bf261770237f7dd21ace3774ba04a017e9\n\n{% if CONFIGURED_ARCH != \"amd64\" -%}\n# Install node.js for azure pipeline\nRUN curl -f -sL https://deb.nodesource.com/setup_14.x | bash -\nRUN apt-get install --no-install-recommends -y nodejs && rm -rf /var/lib/apt/lists/*;\n\n# Tell azure pipeline to use node.js in the docker\nLABEL \"com.azure.dev.pipelines.agent.handler.node.path\"=\"/usr/bin/node\"\n{% endif -%}\n\n# Install Bazel build system (amd64 and arm64 architectures are supported using this method)\n# TODO(PINS): Remove once pre-build Bazel binaries are available for armhf (armv7l)\n{%- if CONFIGURED_ARCH == \"amd64\" or CONFIGURED_ARCH == \"arm64\" %}\nARG bazelisk_url=https://github.com/bazelbuild/bazelisk/releases/latest/download/bazelisk-linux-{{ CONFIGURED_ARCH }}\nRUN curl -fsSL -o /usr/local/bin/bazel ${bazelisk_url} && chmod 755 /usr/local/bin/bazel\n# Bazel requires \"python\"\n# TODO(PINS): remove when Bazel is okay with \"python3\" binary name\nRUN apt install --no-install-recommends -y python-is-python3 && rm -rf /var/lib/apt/lists/*;\n{% endif -%}\n"
}