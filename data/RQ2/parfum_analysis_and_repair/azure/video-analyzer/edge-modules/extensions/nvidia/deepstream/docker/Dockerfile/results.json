{
  "startTime": 1674248344138,
  "endTime": 1674248345501,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 62
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 41
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 62
      }
    }
  ],
  "repairedDockerfile": "FROM nvcr.io/nvidia/deepstream:5.1-21.02-samples\n\nUSER root\n\n# Copy AVA extension specific files\nRUN mkdir /app\nCOPY ./app/*.py /app/\nCOPY ./app/grpc-autogen/*.py /app/\nCOPY ./app/gst-extension/*.* /app/\nCOPY ./app/config/*.* /app/\n\n# Install gstreamer-1.0-dev\nRUN apt-get update -y && \\\n    apt-get -y --no-install-recommends install cmake && \\\n    apt-get install -y --no-install-recommends build-essential && \\\n    apt-get install -y --no-install-recommends libgstreamer1.0-dev && \\\n    apt-get install --no-install-recommends -y python3-pip && rm -rf /var/lib/apt/lists/*;\n\n# Build AVA GST library\nRUN mkdir -p /app/build && \\\n    cd /app/build && \\\n    cmake .. && \\\n    make\n\nRUN apt-get -y --no-install-recommends install python3-gst-1.0 && rm -rf /var/lib/apt/lists/*;\n\n# Install required python packages\nRUN pip3 install --no-cache-dir requests pyyaml protobuf grpcio && \\\n    apt-get clean\n\n# Install additional python packages\nRUN pip3 install --no-cache-dir numpy flask pillow gunicorn && \\\n    apt-get clean\n\n# Install runit, nginx\nRUN apt-get update -y && \\\n    apt-get install --no-install-recommends -y wget runit nginx && rm -rf /var/lib/apt/lists/*;\n\n# Install Nchan module. For details goto http://nchan.io\nRUN apt-get update -y && \\\n    apt-get install --no-install-recommends -y libnginx-mod-nchan && rm -rf /var/lib/apt/lists/*;\n\n# Copy nginx config file\nCOPY ./app/nginx/grpc_app.conf /etc/nginx/sites-available\n\n# Copy flask app\nCOPY ./app/nginx/grpc_app.py /app\n\n# Setup runit file for nginx and gunicorn\nRUN mkdir /var/runit && \\\n    mkdir /var/runit/nginx && \\\n    /bin/bash -c \"echo -e '\"'#!/bin/bash\\nexec nginx -g \"daemon off;\"\\n'\"' > /var/runit/nginx/run\" && \\\n    chmod +x /var/runit/nginx/run && \\\n    ln -s /etc/nginx/sites-available/grpc_app.conf /etc/nginx/sites-enabled/ && \\\n    rm -rf /etc/nginx/sites-enabled/default && \\\n    mkdir /var/runit/gunicorn && \\\n    /bin/bash -c \"echo -e '\"'#!/bin/bash\\nexec gunicorn -b 127.0.0.1:8000 --chdir /app grpc_app:app\\n'\"' > /var/runit/gunicorn/run\" && \\\n    chmod +x /var/runit/gunicorn/run\n\nEXPOSE 80\nEXPOSE 5001\n\n# Starts the AVA gRPC extension server\nWORKDIR /app\nCOPY ./app/start.sh /app\nRUN chmod +x /app/start.sh\nCMD exec /app/start.sh"
}