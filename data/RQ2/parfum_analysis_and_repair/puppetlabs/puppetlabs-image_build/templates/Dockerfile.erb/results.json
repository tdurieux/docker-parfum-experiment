{
  "startTime": 1674255567592,
  "endTime": 1674255568158,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 4,
        "columnEnd": 22
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "<% if from %>FROM <%= from %><% end %>\n<% if maintainer %>MAINTAINER <%= maintainer %><% end %>\n\n<% if image_user && !image_user.empty? %>USER root<% end %>\n\n<% if environment %>ENV <% environment.each do |name, value| %><%= name.upcase %>=\"<%= value %>\" <% end %><% end %>\n\n<% if rocker %>MOUNT /opt/puppetlabs /etc/puppetlabs /root/.gem<% end %>\n\n<% if labels && !labels.empty? %>LABEL <%= labels.map { |g| g.split('=') }.map { |k,v| \"#{k}=\\\"#{v}\\\"\" }.join(' ') %><% end %>\n\n<% if apt_proxy %>ARG APT_PROXY<% end %>\n\n<% unless skip_puppet_install %>\n<% if os %>\n<% if os == 'ubuntu' or os == 'debian' %>\nRUN <% if apt_proxy %>echo \"Acquire::HTTP::Proxy \\\"$APT_PROXY\\\";\" >> /etc/apt/apt.conf.d/01proxy && echo 'Acquire::HTTPS::Proxy \"false\";' >> /etc/apt/apt.conf.d/01proxy && <% end %>apt-get update && \\\n    apt-get install --no-install-recommends -y lsb-release wget ca-certificates && \\\n    wget <%= package_address %> && \\\n    dpkg -i <%= package_name %> && \\\n    rm <%= package_name %> && \\\n    apt-get update && \\\n    apt-get install --no-install-recommends -y puppet-agent=\"$PUPPET_AGENT_VERSION\"-1\"$CODENAME\" && \\\n    apt-get remove --purge -y wget && \\\n    apt-get autoremove -y && \\\n    apt-get clean && \\\n    mkdir -p /etc/puppetlabs/facter/facts.d/ && \\\n    rm -rf /var/lib/apt/lists/* <% if apt_proxy %>&& rm -f /etc/apt/apt.conf.d/01proxy<% end %>\n<% elsif os == 'centos' %>\nRUN rpm -Uvh <%= package_address %> && \\\n    yum upgrade -y && \\\n    yum update -y && \\\n    yum install -y puppet-agent-\"$PUPPET_AGENT_VERSION\" && \\\n    mkdir -p /etc/puppetlabs/facter/facts.d/ && \\\n    yum clean all\n<% elsif os == 'alpine' %>\nRUN apk add --update \\\n      ca-certificates \\\n      pciutils \\\n      ruby \\\n      ruby-irb \\\n      ruby-rdoc \\\n      && \\\n    echo http://dl-4.alpinelinux.org/alpine/edge/testing/ >> /etc/apk/repositories && \\\n    apk add --update shadow && \\\n    rm -rf /var/cache/apk/* && \\\n    gem install puppet:\"$PUPPET_VERSION\" facter:\"$FACTER_VERSION\" && \\\n    <%= puppet_path %> module install puppetlabs-apk\n\n# Workaround for https://tickets.puppetlabs.com/browse/FACT-1351\nRUN rm /usr/lib/ruby/gems/2.3.0/gems/facter-\"$FACTER_VERSION\"/lib/facter/blockdevices.rb\n<% end %>\n<% end %>\n<% end %>\n\n<% if use_factfile %>\n    COPY <%= factfile %> /etc/puppetlabs/facter/facts.d/custom_facts.txt\n<% end %>\n\n<% if use_puppetfile && !master %>\n<% if os == 'ubuntu' or os == 'debian' %>\nRUN <% if apt_proxy %>echo \"Acquire::HTTP::Proxy \\\"$APT_PROXY\\\";\" >> /etc/apt/apt.conf.d/01proxy && echo 'Acquire::HTTPS::Proxy \"false\";' >> /etc/apt/apt.conf.d/01proxy && <% end %>apt-get update && \\\n    apt-get install --no-install-recommends -y git-core && \\\n    <%= gem_path %> install r10k:\"$R10K_VERSION\" --no-ri --no-rdoc && \\\n    apt-get autoremove -y && \\\n    apt-get clean && \\\n    rm -rf /var/lib/apt/lists/* <% if apt_proxy %>&& rm -f /etc/apt/apt.conf.d/01proxy<% end %>\n<% elsif os == 'centos' %>\nRUN yum update -y && \\\n    yum install -y git && \\\n    <%= gem_path %> install r10k:\"$R10K_VERSION\" --no-ri --no-rdoc && \\\n    yum clean all && rm -rf /var/cache/yum\n<% elsif os == 'alpine' %>\nRUN apk add --update git && \\\n    <%= gem_path %> install r10k:\"$R10K_VERSION\" --no-ri --no-rdoc && \\\n    rm -rf /var/cache/apk/*\n<% end %>\n<% if r10k_yaml %>\nCOPY r10k.yaml /r10k.yaml\n<% end %>\nCOPY <%= puppetfile %> /Puppetfile\nRUN <%= r10k_path %> puppetfile install --moduledir /etc/puppetlabs/code/modules\n<% end %>\n\n<% if module_path && !master %>\nCOPY <%= module_path %> /etc/puppetlabs/code/modules/\n<% end %>\n\n<% if manifest && !master %>\nCOPY <%= File.dirname(manifest) %> /<%= File.dirname(manifest) %>\n<% end %>\n\n<% if use_hiera && !master %>\nCOPY <%= hiera_config %> /hiera.yaml\nCOPY <%= hiera_data %> /hieradata\n<% end %>\n\n<% if autosign_token %>ARG AUTOSIGN_TOKEN<% end %>\n\n<% if os %>\n  <% if master %>\n    <% if os == 'ubuntu' or os == 'debian' %>\nRUN <% if apt_proxy %>echo \"Acquire::HTTP::Proxy \\\"$APT_PROXY\\\";\" >> /etc/apt/apt.conf.d/01proxy && echo 'Acquire::HTTPS::Proxy \"false\";' >> /etc/apt/apt.conf.d/01proxy && <% end %>apt-get update && \\\n<% if autosign_token %>printf 'custom_attributes:\\n    challengePassword: \"%s\"\\n' $AUTOSIGN_TOKEN >> /etc/puppetlabs/puppet/csr_attributes.yaml && <% end %><% if master_is_ip %>echo <%= master_host %> puppet >> /etc/hosts && <% end %>FACTER_hostname=<%= hostname %>.<%= DateTime.now.rfc3339.gsub(/[^0-9a-z]/i, '') %>.dockerbuilder <%= puppet_path %> agent --server <% if master_is_ip %>puppet<% else %><%= master_host %><% end %><% if master_port %> --masterport <%= master_port %><% end %> --verbose <% if puppet_debug %>--debug <% end %>--onetime --no-daemonize <% if show_diff %>--show_diff <% end %>--summarize<% if autosign_token %> && rm /etc/puppetlabs/puppet/csr_attributes.yaml<% end %> && \\\n    apt-get autoremove -y && \\\n    apt-get clean && \\\n    rm -rf /var/lib/apt/lists/* <% if apt_proxy %>&& rm -f /etc/apt/apt.conf.d/01proxy<% end %>\n    <% elsif os == 'centos' %>\nRUN yum update -y && \\\n    <% if autosign_token %>printf 'custom_attributes:\\n    challengePassword: \"%s\"\\n' $AUTOSIGN_TOKEN >> /etc/puppetlabs/puppet/csr_attributes.yaml && <% end %><% if master_is_ip %>echo <%= master_host %> puppet >> /etc/hosts && <% end %>FACTER_hostname=<%= hostname %>.<%= DateTime.now.rfc3339.gsub(/[^0-9a-z]/i, '') %>.dockerbuilder <%= puppet_path %> agent --server <% if master_is_ip %>puppet<% else %><%= master_host %><% end %><% if master_port %> --masterport <%= master_port %><% end %> --verbose <% if puppet_debug %>--debug <% end %>--onetime --no-daemonize <% if show_diff %>--show_diff <% end %>--summarize<% if autosign_token %> && rm /etc/puppetlabs/puppet/csr_attributes.yaml<% end %> && \\\n    yum clean all\n    <% elsif os == 'alpine' %>\nRUN apk update && \\\n    <% if autosign_token %>printf 'custom_attributes:\\n    challengePassword: \"%s\"\\n' $AUTOSIGN_TOKEN >> /etc/puppetlabs/puppet/csr_attributes.yaml && <% end %><% if master_is_ip %>echo <%= master_host %> puppet >> /etc/hosts && <% end %>FACTER_hostname=<%= hostname %>.<%= DateTime.now.rfc3339.gsub(/[^0-9a-z]/i, '') %>.dockerbuilder <%= puppet_path %> agent --server <% if master_is_ip %>puppet<% else %><%= master_host %><% end %><% if master_port %> --masterport <%= master_port %><% end %> --verbose <% if puppet_debug %>--debug <% end %>--onetime --no-daemonize <% if show_diff %>--show_diff <% end %>--summarize<% if autosign_token %> && rm /etc/puppetlabs/puppet/csr_attributes.yaml<% end %> && \\\n    rm -rf /var/cache/apk/*\n    <% end %>\n  <% else %>\n    <% if os == 'ubuntu' or os == 'debian' %>\nRUN <% if apt_proxy %>echo \"Acquire::HTTP::Proxy \\\"$APT_PROXY\\\";\" >> /etc/apt/apt.conf.d/01proxy && echo 'Acquire::HTTPS::Proxy \"false\";' >> /etc/apt/apt.conf.d/01proxy && <% end %>apt-get update && \\\n    FACTER_hostname=<%= hostname %> <%= puppet_path %> apply <%= manifest %> --detailed-exitcodes --verbose <% if puppet_debug %>--debug <% end %><% if show_diff %>--show_diff <% end %>--summarize <% if use_hiera %>--hiera_config=/hiera.yaml<% end %> --app_management ; \\\n    rc=$?; if [ $rc -ne 0 ] && [ $rc -ne 2 ]; then exit 1; fi && \\\n    apt-get autoremove -y && \\\n    apt-get clean && \\\n    rm -rf /var/lib/apt/lists/* <% if apt_proxy %>&& rm -f /etc/apt/apt.conf.d/01proxy<% end %>\n    <% elsif os == 'centos' %>\nRUN yum update -y && \\\n    FACTER_hostname=<%= hostname %> <%= puppet_path %> apply <%= manifest %> --verbose <% if puppet_debug %>--debug <% end %><% if show_diff %>--show_diff <% end %>--summarize <% if use_hiera %>--hiera_config=/hiera.yaml<% end %> --app_management && \\\n    yum clean all\n    <% elsif os == 'alpine' %>\nRUN apk update && \\\n    FACTER_hostname=<%= hostname %> <%= puppet_path %> apply <%= manifest %> --verbose <% if puppet_debug %>--debug <% end %><% if show_diff %>--show_diff <% end %>--summarize <% if use_hiera %>--hiera_config=/hiera.yaml<% end %> --app_management && \\\n    rm -rf /var/cache/apk/*\n    <% end %>\n  <% end %>\n<% end %>\n\n<% if inventory %>\nLABEL com.puppet.inventory=\"/inventory.json\"\nRUN <%= puppet_path %> module install puppetlabs-inventory && \\\n    <%= puppet_path %> inventory all > /inventory.json\n<% end %>\n\n<% if expose && !expose.empty? %>EXPOSE <%= expose.join(' ') %><% end %>\n<% if volume && !volume.empty? %>VOLUME <%= volume.join(' ') %><% end %>\n\n<% if entrypoint && !entrypoint.empty? %>ENTRYPOINT <%= entrypoint.to_s %><% end %>\n<% if cmd && !cmd.empty? %>CMD <%= cmd.to_s %><% end %>\n\n<% if image_user && !image_user.empty? %>USER <%= image_user.to_s %><% end %>\n\n<% if rocker %>TAG <%= image_name %><% end %>\n"
}