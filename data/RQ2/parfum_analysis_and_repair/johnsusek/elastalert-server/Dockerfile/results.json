{
  "startTime": 1674248173000,
  "endTime": 1674248174062,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 36
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM python:3.10-alpine3.16 as ea2\nARG ELASTALERT_VERSION=2.5.1\nENV ELASTALERT_VERSION=${ELASTALERT_VERSION}\nARG ELASTALERT_URL=https://github.com/jertel/elastalert2/archive/refs/tags/$ELASTALERT_VERSION.zip\nENV ELASTALERT_URL=${ELASTALERT_URL}\nENV ELASTALERT_HOME /opt/elastalert\n\nWORKDIR /opt\n\nRUN apk add --update --no-cache wget && \\\n    wget -O elastalert.zip \"${ELASTALERT_URL}\" && \\\n    unzip elastalert.zip && \\\n    rm elastalert.zip && \\\n    mv e* \"${ELASTALERT_HOME}\"\n\nFROM node:16.15-alpine3.16 as install\nENV PATH /home/node/.local/bin:$PATH\n\nRUN apk add --update --no-cache \\\n    ca-certificates \\\n    cargo \\\n    curl \\\n    gcc \\\n    libffi-dev \\\n    libmagic \\\n    make \\\n    musl-dev \\\n    openssl \\\n    openssl-dev \\\n    py3-pip \\\n    py3-wheel \\\n    python3 \\\n    python3-dev \\\n    tzdata\n\nCOPY --from=ea2 /opt/elastalert /opt/elastalert\n\nWORKDIR /opt/elastalert-server\nCOPY . /opt/elastalert-server\n\nRUN npm install --production --quiet && npm cache clean --force;\n\nRUN pip3 install --no-cache-dir --upgrade pip==22.1.2\n\nUSER node\n\nWORKDIR /opt/elastalert\n\nRUN pip3 install --no-cache-dir cryptography --user\nRUN pip3 install --no-cache-dir -r requirements.txt --user\n\nFROM node:16.15-alpine3.16\nLABEL maintainer=\"John Susek <john@johnsolo.net>\"\nENV TZ Etc/UTC\nENV PATH /home/node/.local/bin:$PATH\n\nRUN apk add --update --no-cache \\\n    ca-certificates \\\n    cargo \\\n    curl \\\n    gcc \\\n    libffi-dev \\\n    libmagic \\\n    make \\\n    musl-dev \\\n    openssl \\\n    openssl-dev \\\n    py3-pip \\\n    python3 \\\n    python3-dev \\\n    tzdata\n\nCOPY --from=install /opt/elastalert /opt/elastalert\nCOPY --from=install /home/node/.local/lib/python3.10/site-packages /home/node/.local/lib/python3.10/site-packages\n\nWORKDIR /opt/elastalert-server\n\nCOPY --from=install /opt/elastalert-server ./\n\nCOPY config/elastalert.yaml /opt/elastalert/config.yaml\nCOPY config/config.json config/config.json\nCOPY rule_templates/ /opt/elastalert/rule_templates\nCOPY elastalert_modules/ /opt/elastalert/elastalert_modules\n\n# Add default rules directory\n# Set permission as unpriviledged user (1000:1000), compatible with Kubernetes\nRUN mkdir -p /opt/elastalert/rules/ /opt/elastalert/server_data/tests/ \\\n    && chown -R node:node /opt\n\nUSER node\n\nEXPOSE 3030\n\nWORKDIR /opt/elastalert-server\n\nENTRYPOINT [\"npm\", \"start\"]\n"
}