FROM ubuntu:latest

RUN dpkg --add-architecture i386

RUN apt-get update \
    && apt-get install --no-install-recommends -y socat libc6-i386 \
    && apt-get install --no-install-recommends -y libseccomp2:i386 \
    && apt-get clean -y && rm -rf /var/lib/apt/lists/*;

RUN useradd -d /home/challenge -m -s /bin/bash challenge

WORKDIR /home/challenge

COPY writeead .
COPY flag.txt .

RUN chmod -R 755 /home/challenge
RUN chmod 444 flag.txt
RUN chmod 111 writeead

RUN chown -R root:root /home/challenge

USER root
CMD ["socat", "TCP-LISTEN:9999,reuseaddr,fork", "EXEC:./writeead,stderr"]
EXPOSE 9999
