{
  "startTime": 1674251486314,
  "endTime": 1674251487518,
  "originalSmells": [
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 8,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 24
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ubuntu:18.04\nLABEL org.label-schema.schema-version = \"1.0.0-rc.1\"   \\\n      org.label-schema.name           = \"Asqtasun SNAPSHOT - WebApp (Ubuntu 18.04 - Java 8)\"\n          # ----> documentation  http://label-schema.org/\n################################################################################################################\n\n# System prerequisites\nRUN apt-get update && \\\n    apt-get -y --no-install-recommends   \\\n            install openjdk-8-jre        \\\n                    libgtk-3-0           \\\n                    libdbus-glib-1-2     \\\n                    wget                 \\\n                    curl && rm -rf /var/lib/apt/lists/*;\n\n################################################################################################################\n\n# Environment variables\nENV    WWWPORT=\"8080\"                               \\\n       WEBAPP_URL=\"http://localhost:8080/\"          \\\n       DB_PORT=\"3306\"                               \\\n       DB_HOST=\"asqatasun-db_dev\"                   \\\n       DB_DRIVER=\"mysql\"                            \\\n       DB_DATABASE=\"asqatasun\"                      \\\n       DB_USER=\"asqatasunDatabaseUserLogin\"         \\\n       DB_PASSWORD=\"asqatasunDatabaseUserP4ssword\"  \\\n       SMTP_DEBUG=\"false\"                           \\\n       SMTP_FROM=\"\"                                 \\\n       SMTP_HOST=\"localhost\"                        \\\n       SMTP_PORT=\"-1\"                               \\\n       SMTP_USER=\"\"                                 \\\n       SMTP_PASSWORD=\"\"                             \\\n       SMTP_STARTLS_ENABLE=\"false\"                  \\\n       SMTP_SSL_ENABLE=\"false\"                      \\\n       SMTP_SSL_PROTOCOLS=\"TLSv1.2\"                 \\\n       ASQA_RELEASE=\"5-SNAPSHOT\"                    \\\n       LOG_DIR=\"/var/log/asqatasun/\"                \\\n       FIREFOX_VERSION=\"78.2.0esr\"                  \\\n       GECKODRIVER_VERSION=\"v0.26.0\"                \\\n       FIREFOX_URL_PREFIX=\"https://download-installer.cdn.mozilla.net/pub/firefox/releases/\"  \\\n       GECKODRIVER_URL_PREFIX=\"https://github.com/mozilla/geckodriver/releases/download/\"\nENV    ASQA_URL=\"http://localhost:${WWWPORT}/\"\nEXPOSE ${WWWPORT}\n\n# Build variables\nARG FIREFOX_URL=\"${FIREFOX_URL_PREFIX}${FIREFOX_VERSION}/linux-x86_64/en-US/firefox-${FIREFOX_VERSION}.tar.bz2\"\nARG FIREFOX_FILE=\"firefox-${FIREFOX_VERSION}.tar.bz2\"\nARG GECKODRIVER_URL=\"${GECKODRIVER_URL_PREFIX}${GECKODRIVER_VERSION}/geckodriver-${GECKODRIVER_VERSION}-linux64.tar.gz\"\nARG GECKODRIVER_FILE=\"geckodriver-${GECKODRIVER_VERSION}-linux64.tar.gz\"\nARG WAR_FILE=\"asqatasun-web-app-${ASQA_RELEASE}.war\"\n\n################################################################################################################\n\n# Asqatasun prerequisites\nADD shared_download/ /opt\nRUN cd /opt                                                     && \\\n    echo ${FIREFOX_URL}                                         && \\\n    echo ${GECKODRIVER_URL}                                     && \\\n    ls | grep \"${FIREFOX_FILE}\"     || wget ${FIREFOX_URL}      && \\\n    ls | grep \"${GECKODRIVER_FILE}\" || wget ${GECKODRIVER_URL}  && \\\n    tar xf \"${FIREFOX_FILE}\"                                    && \\\n    tar xf \"${GECKODRIVER_FILE}\"                                && \\\n    rm -v \"${FIREFOX_FILE}\" && rm -v \"${GECKODRIVER_FILE}\"      && \\\n    mkdir -v \"/etc/asqatasun\"                                   && \\\n    mv -v \"ESAPI.properties\" \"/etc/asqatasun\"\n\n# Add a new Linux user\nRUN adduser asqatasun\n#RUN addgroup --system asqatasun && adduser --system asqatasun --group\n\n# Create log folder\nRUN mkdir \"${LOG_DIR}\"                     && \\\n    chown asqatasun:asqatasun \"${LOG_DIR}\"\n\n# Add WAR file\nUSER asqatasun:asqatasun\nADD \"./${WAR_FILE}\" \"/home/asqatasun/app.war\"\n\n# Health Check of the Docker Container\nHEALTHCHECK --timeout=3s    \\\n            --interval=10s  \\\n            CMD curl --fail ${ASQA_URL} || exit 1\n            ######################################################################\n            # doc: https://docs.docker.com/engine/reference/builder/#healthcheck\n            # options:  --interval=DURATION (default: 30s)\n            #           --timeout=DURATION (default: 30s)\n            #           --retries=N (default: 3)\n            # can be overridden at the command line 'docker run --health-cmd (...)'\n            ######################################################################\n\n################################################################################################################\nCMD echo \"WEBAPP ---> [DB_USER=${DB_USER}][DB_PASSWORD=${DB_PASSWORD}] <-------\"                   && \\\n    echo \"WEBAPP ---> [DB_URL=jdbc:${DB_DRIVER}://${DB_HOST}:${DB_PORT}/${DB_DATABASE}] <-------\"  && \\\n    echo \"WEBAPP ---> [URL=${WEBAPP_URL}] <-------\"  && \\\n    /usr/bin/java                                                            \\\n    -Dwebdriver.firefox.bin=/opt/firefox/firefox                             \\\n    -Dwebdriver.gecko.driver=/opt/geckodriver                                \\\n    -Dapp.logging.path=\"${LOG_DIR}\"                                          \\\n    -Dapp.emailSender.smtp.debug=\"${SMTP_DEBUG}\"                             \\\n    -Dapp.emailSender.smtp.from=\"${SMTP_FROM}\"                               \\\n    -Dapp.emailSender.smtp.host=\"${SMTP_HOST}\"                               \\\n    -Dapp.emailSender.smtp.port=\"${SMTP_PORT}\"                               \\\n    -Dapp.emailSender.smtp.user=\"${SMTP_USER}\"                               \\\n    -Dapp.emailSender.smtp.password=\"${SMTP_PASSWORD}\"                       \\\n    -Dapp.emailSender.smtp.starttls.enable=\"${SMTP_STARTLS_ENABLE}\"          \\\n    -Dapp.emailSender.smtp.ssl.enable=\"${SMTP_SSL_ENABLE}\"                   \\\n    -Dapp.emailSender.smtp.ssl.protocols=\"${SMTP_SSL_PROTOCOLS}\"             \\\n    -Dapp.webapp.ui.config.webAppUrl=\"${WEBAPP_URL}\"                         \\\n    -Djdbc.url=\"jdbc:${DB_DRIVER}://${DB_HOST}:${DB_PORT}/${DB_DATABASE}\"    \\\n    -Djdbc.user=\"${DB_USER}\"                                                 \\\n    -Djdbc.password=\"${DB_PASSWORD}\"                                         \\\n    -jar /home/asqatasun/app.war                                             \\\n    --server.port=\"${WWWPORT}\"\n"
}