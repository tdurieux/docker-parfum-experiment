{
  "startTime": 1674249370997,
  "endTime": 1674249372819,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 44,
        "lineEnd": 44,
        "columnStart": 4,
        "columnEnd": 164
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 70
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 1,
        "columnEnd": 85
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 96,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 29,
        "lineEnd": 29,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 33,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 112,
        "lineEnd": 112,
        "columnStart": 4,
        "columnEnd": 82
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 29,
        "lineEnd": 29,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 33,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 112,
        "lineEnd": 112,
        "columnStart": 4,
        "columnEnd": 82
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 111
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 112,
        "lineEnd": 112,
        "columnStart": 4,
        "columnEnd": 82
      }
    }
  ],
  "repairedDockerfile": "FROM flaviostutz/asterisk:16.18.0.1\n\nENV RTP_START '18000'\nENV RTP_FINISH '18100'\nENV ADMIN_PASSWORD ''\nENV USE_CHAN_SIP 'false'\nENV ENABLE_AUTO_RESTORE 'true'\nENV BACKUP_TIMER '3600'\nENV FAIL2BAN_ENABLE 'true'\nENV FAIL2BAN_FINDTIME '600'\nENV FAIL2BAN_MAXRETRY '15'\nENV FAIL2BAN_BANTIME '259200'\nENV FAIL2BAN_WHITELIST ''\nENV ENABLE_DELETE_OLD_RECORDINGS 'true'\nENV DISABLE_SIGNATURE_CHECK 'false'\nENV MARIADB_REMOTE_ROOT_PASSWORD ''\nENV SIP_NAT_IP ''\nENV CERTIFICATE_DOMAIN ''\n\nARG FREEPBX_VERSION=15.0-latest\nARG MARIAODBC_VERSION=2.0.19\n\n# Pin libxml2 packages to Debian repositories\nRUN echo \"Package: libxml2*\" > /etc/apt/preferences.d/libxml2 && \\\n    echo \"Pin: release o=Debian,n=buster\" >> /etc/apt/preferences.d/libxml2 && \\\n    echo \"Pin-Priority: 501\" >> /etc/apt/preferences.d/libxml2\n\n# PHP 5.6\nRUN apt-get update && \\\n    apt-get install --no-install-recommends -y curl wget sox lsb-release && \\\n    curl -f https://packages.sury.org/php/apt.gpg | apt-key add - && \\\n    echo \"deb https://packages.sury.org/php/ buster main\" > /etc/apt/sources.list.d/deb.sury.org.list && \\\n    apt-get update && \\\n    apt-get install --no-install-recommends -y php5.6 php5.6-curl php5.6-cli php5.6-mysql php-pear php5.6-gd \\\n                       php5.6-xml php5.6-mbstring && \\\n    apt-get install --no-install-recommends -y libodbc1 odbcinst odbcinst1debian2 && \\\n    apt-get update && \\\n    apt-get -o Dpkg::Options::=\"--force-confold\" upgrade -y && rm -rf /var/lib/apt/lists/*;\n\nRUN apt-get install --no-install-recommends -y build-essential apache2 mariadb-server mariadb-client bison flex && rm -rf /var/lib/apt/lists/*;\n\n# MariaDB ODBC connector\nRUN cd /usr/src && \\\n    mkdir -p mariadb-connector && \\\n    curl -f -sSL https://downloads.mariadb.com/Connectors/odbc/connector-odbc-${MARIAODBC_VERSION}/mariadb-connector-odbc-${MARIAODBC_VERSION}-ga-debian-x86_64.tar.gz | tar xvfz - -C /usr/src/mariadb-connector && \\\n    mkdir -p /usr/lib/x86_64-linux-gnu/odbc/ && \\\n    cp mariadb-connector/lib/libmaodbc.so /usr/lib/x86_64-linux-gnu/odbc/ && \\\n    rm -rf mariadb-connector\n\n# MariaDB bind config\nRUN rm /etc/mysql/mariadb.conf.d/50-mysqld_safe.cnf && \\\n    sed -i 's/bind-address/#bind-address/' /etc/mysql/mariadb.conf.d/50-server.cnf\n\n# FreePBX\nRUN cd /usr/src && \\\n\twget https://mirror.freepbx.org/modules/packages/freepbx/freepbx-$FREEPBX_VERSION.tgz && \\\n\ttar xfz freepbx-$FREEPBX_VERSION.tgz && \\\n\trm -f freepbx-$FREEPBX_VERSION.tgz\n\nADD odbc.ini /etc/\nADD odbcinst.ini /etc/\n\n# FreePBX Hacks\nRUN    sed -i -e \"s/memory_limit = 128M/memory_limit = 256M/g\" /etc/php/5.6/apache2/php.ini && \\\n    sed -i 's/\\(^upload_max_filesize = \\).*/\\120M/' /etc/php/5.6/apache2/php.ini && \\\n    a2disconf other-vhosts-access-log.conf && \\\n    a2enmod rewrite && \\\n    a2enmod headers && \\\n    rm -rf /var/log/* && \\\n    mkdir -p /var/log/asterisk && \\\n    mkdir -p /var/log/apache2 && \\\n    mkdir -p /var/log/httpd\n\n# FreePBX dependencies\nRUN curl -f --silent https://deb.nodesource.com/gpgkey/nodesource.gpg.key | apt-key add - && \\\n    echo 'deb https://deb.nodesource.com/node_10.x buster main' > /etc/apt/sources.list.d/nodesource.list && \\\n    echo 'deb-src https://deb.nodesource.com/node_10.x buster main' >> /etc/apt/sources.list.d/nodesource.list && \\\n    apt-get update && \\\n    apt-get install --no-install-recommends -y pkgconf && \\\n    apt-get install --no-install-recommends -y nodejs yarn cron gettext libicu-dev pkg-config && rm -rf /var/lib/apt/lists/*;\n\n# FreePBX\nRUN /etc/init.d/mysql start && \\\n    cd /usr/src/freepbx && \\\n    echo \"Starting Asterisk...\" && \\\n    cp /etc/odbc.ini /usr/src/freepbx/installlib/files/odbc.ini && \\\n    ./start_asterisk start && \\\n    sleep 3 && \\\n    echo \"Installing FreePBX...\" && \\\n    ./install -n && \\\n    echo \"Updating FreePBX modules...\" && \\\n    fwconsole chown && \\\n    fwconsole ma upgradeall && \\\n    fwconsole ma downloadinstall backup bulkhandler ringgroups timeconditions ivr restapi cel configedit asteriskinfo certman ucp webrtc && \\\n    # mysqldump -uroot -d -A -B --skip-add-drop-table > /mysql-freepbx.sql && \\\n    /etc/init.d/mysql stop && \\\n    gpg --batch --refresh-keys --keyserver hkp://keyserver.ubuntu.com:80 && \\\n    gpg --batch --import /var/www/html/admin/libraries/BMO/9F9169F4B33B4659.key && \\\n    gpg --batch --import /var/www/html/admin/libraries/BMO/3DDB2122FE6D84F7.key && \\\n    gpg --batch --import /var/www/html/admin/libraries/BMO/86CE877469D2EAD9.key && \\\n    gpg --batch --import /var/www/html/admin/libraries/BMO/1588A7366BD35B34.key && \\\n    chown asterisk:asterisk -R /var/www/html && \\\n    sed -i 's/www-data/asterisk/g' /etc/apache2/envvars && \\\n\trm -rf /usr/src/freepbx*\n\n# Fail2Ban\nRUN apt-get install --no-install-recommends -y fail2ban && rm -rf /var/lib/apt/lists/*;\nADD fail2ban-jail.conf /etc/fail2ban/jail.d/\nADD jail.local /etc/fail2ban/\nRUN rm /etc/fail2ban/jail.d/defaults-debian.conf\n\n# Optional tools\nRUN apt-get install --no-install-recommends -y tcpdump tcpflow whois sipsak sngrep && rm -rf /var/lib/apt/lists/*;\n\n# Cleanup\nRUN apt-get clean && \\\n    apt-get autoremove -y && \\\n    rm -rf /var/lib/apt/lists/*\n\nADD startup.sh /\nADD apply-initial-configs.sh /\nADD backup.sh /\nADD delete-old-recordings.sh /\nCOPY basic-config.tar.gz /\nADD generate-sha1.php /\n\nADD index.html /var/www/html/\n\n#avoid taking too much to start by setting permissions (in container, no one will change files...)\nADD freepbx_chown.conf /etc/asterisk/\n\n#enable https in admin\nRUN a2ensite default-ssl && \\\n    a2enmod ssl\n\nRUN sed -i 's/AllowOverride None/AllowOverride All/g' /etc/apache2/apache2.conf\n\nCMD [ \"/startup.sh\" ]\n\nEXPOSE 80 3306 5060/udp 5061/udp 5160/udp 5161/udp 10000-40000/udp\n\n#recordings data\nVOLUME [ \"/var/spool/asterisk/monitor\" ]\n\n#automatic backup\nVOLUME [ \"/backup\" ]\n\n#lets encrypt and other certificate storage\nVOLUME [ \"/etc/asterisk/keys\" ]\n"
}