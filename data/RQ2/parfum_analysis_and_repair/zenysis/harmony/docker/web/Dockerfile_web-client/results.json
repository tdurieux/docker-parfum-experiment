{
  "startTime": 1674253715856,
  "endTime": 1674253717067,
  "originalSmells": [
    {
      "rule": "yarnCacheCleanAfterInstall",
      "position": {
        "lineStart": 18,
        "lineEnd": 22,
        "columnStart": 2,
        "columnEnd": 22
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM node:14\n\n# Separate directories for storing build files so that the post-build results\n# can be easily copied out.\nENV BUILD_PATH /build\nENV INSTALL_PATH /client\nENV NODE_ENV 'production'\n\n# Build the parent directories needed in the build and install locations.\nRUN mkdir -p ${BUILD_PATH}/web/public\nRUN mkdir -p ${INSTALL_PATH}/js/vendor/min\n\nWORKDIR ${BUILD_PATH}\n\nCOPY package.json package.json\nCOPY yarn.lock yarn.lock\n\nRUN \\\n  yarn install \\\n    --cache-folder /yarn.cache \\\n    --frozen-lockfile \\\n    --pure-lockfile \\\n    --production=false && yarn cache clean;\n\n# Copy in files that affect the webpack build.\n# NOTE(stephen): Images is only needed for a small subset of files that are\n# referenced by scss. Maybe we should move them into a specific subdirectory to\n# make copying and diffing easier.\nCOPY web/webpack.prod.config.js web/webpack.prod.config.js\nCOPY web/public/fonts web/public/fonts\nCOPY web/public/images web/public/images\nCOPY web/public/scss web/public/scss\nCOPY web/client web/client\n\n# Build the compiled JS files with webpack and store the current epoch timestamp\n# as a version number to make logging easier.\n# TODO(stephen): It might be nice to have the commit sha that triggered this\n# rebuild. It's a little harder to test though.\nRUN \\\n  yarn run build && \\\n  echo $(date +%s) > web/public/build/version.txt\n\n# Copy build results inside the container into the install directory.\n# NOTE(stephen): Issuing a RUN command here since we are copying *within* the\n# image, not from the host system.\nRUN \\\n  cp -r web/public/build ${INSTALL_PATH} && \\\n  cp -r web/public/images ${INSTALL_PATH}\n\n# Copy files that are not part of the webpack build.\nCOPY web/public/robots.txt ${INSTALL_PATH}/robots.txt\nCOPY web/public/js/*.js ${INSTALL_PATH}/js/\nCOPY web/public/js/vendor/min/*.js ${INSTALL_PATH}/js/vendor/min/\n\n# Copy in some useful dev files so that we can use this container to run\n# dev-only services\nCOPY web/webpack.config.js web/webpack.config.js\n\nWORKDIR ${INSTALL_PATH}\n\n# TODO(stephen): Copy files into an nginx build maybe? Then it won't need to be\n# part of the entrypoint and we can deploy web-client separately from\n# web-server.\n\n# Expose the styleguide port.\nEXPOSE 6060\n"
}