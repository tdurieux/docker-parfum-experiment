{
  "startTime": 1674254945982,
  "endTime": 1674254947081,
  "originalSmells": [
    {
      "rule": "sha256sumEchoOneSpaces",
      "position": {
        "lineStart": 52,
        "lineEnd": 52,
        "columnStart": 1,
        "columnEnd": 66
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ruby:%%RUBY_VERSION%%-slim-bullseye\n\n# explicitly set uid/gid to guarantee that it won't change in the future\n# the values 999:999 are identical to the current user/group id assigned\nRUN groupadd -r -g 999 redmine && useradd -r -g redmine -u 999 redmine\n\nRUN set -eux; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends \\\n\t\tca-certificates \\\n\t\tcurl \\\n\t\twget \\\n\t\t\\\n\t\tbzr \\\n\t\tgit \\\n\t\tmercurial \\\n\t\topenssh-client \\\n\t\tsubversion \\\n\t\t\\\n# we need \"gsfonts\" for generating PNGs of Gantt charts\n# and \"ghostscript\" for creating PDF thumbnails (in 4.1+)\n\t\tghostscript \\\n\t\tgsfonts \\\n\t\timagemagick \\\n# grab gosu for easy step-down from root\n\t\tgosu \\\n# grab tini for signal processing and zombie killing\n\t\ttini \\\n\t; \\\n# allow imagemagick to use ghostscript for PDF -> PNG thumbnail conversion (4.1+)\n\tsed -ri 's/(rights)=\"none\" (pattern=\"PDF\")/\\1=\"read\" \\2/' /etc/ImageMagick-6/policy.xml; \\\n\trm -rf /var/lib/apt/lists/*\n\nENV RAILS_ENV production\nWORKDIR /usr/src/redmine\n\n# https://github.com/docker-library/redmine/issues/138#issuecomment-438834176\n# (bundler needs this for running as an arbitrary user)\nENV HOME /home/redmine\nRUN set -eux; \\\n\t[ ! -d \"$HOME\" ]; \\\n\tmkdir -p \"$HOME\"; \\\n\tchown redmine:redmine \"$HOME\"; \\\n\tchmod 1777 \"$HOME\"\n\nENV REDMINE_VERSION %%REDMINE_VERSION%%\nENV REDMINE_DOWNLOAD_URL %%REDMINE_DOWNLOAD_URL%%\nENV REDMINE_DOWNLOAD_SHA256 %%REDMINE_DOWNLOAD_SHA256%%\n\nRUN set -eux; \\\n# if we use wget here, we get certificate issues (https://github.com/docker-library/redmine/pull/249#issuecomment-984176479)\n\tcurl -fL -o redmine.tar.gz \"$REDMINE_DOWNLOAD_URL\"; \\\n\techo \"$REDMINE_DOWNLOAD_SHA256  *redmine.tar.gz\" | sha256sum -c -; \\\n\ttar -xf redmine.tar.gz --strip-components=1; \\\n\trm redmine.tar.gz files/delete.me log/delete.me; \\\n\tmkdir -p log public/plugin_assets sqlite tmp/pdf tmp/pids; \\\n\tchown -R redmine:redmine ./; \\\n# log to STDOUT (https://github.com/docker-library/redmine/issues/108)\n\techo 'config.logger = Logger.new(STDOUT)' > config/additional_environment.rb; \\\n# fix permissions for running as an arbitrary user\n\tchmod -R ugo=rwX config db sqlite; \\\n\tfind log tmp -type d -exec chmod 1777 '{}' +\n\nRUN set -eux; \\\n\t\\\n\tsavedAptMark=\"$(apt-mark showmanual)\"; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends \\\n\t\tdefault-libmysqlclient-dev \\\n\t\tfreetds-dev \\\n\t\tgcc \\\n\t\tlibpq-dev \\\n\t\tlibsqlite3-dev \\\n\t\tmake \\\n\t\tpatch \\\n\t\txz-utils \\\n\t; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\t\\\n\tgosu redmine bundle config --local without 'development test'; \\\n# https://github.com/redmine/redmine/commit/23dc108e70a0794f444803ac827a690085dcd557\n# (\"gem puma\" already exists in the Gemfile, but under \"group :test\" and we want it all the time)\n\tpuma=\"$(grep -E \"^[[:space:]]*gem [:'\\\"]puma['\\\",[:space:]].*\\$\" Gemfile)\"; \\\n\t{ echo; echo \"$puma\"; } | sed -re 's/^[[:space:]]+//' >> Gemfile; \\\n# fill up \"database.yml\" with bogus entries so the redmine Gemfile will pre-install all database adapter dependencies\n# https://github.com/redmine/redmine/blob/e9f9767089a4e3efbd73c35fc55c5c7eb85dd7d3/Gemfile#L50-L79\n\techo '# the following entries only exist to force `bundle install` to pre-install all database adapter dependencies -- they can be safely removed/ignored' > ./config/database.yml; \\\n\tfor adapter in mysql2 postgresql sqlserver sqlite3; do \\\n\t\techo \"$adapter:\" >> ./config/database.yml; \\\n\t\techo \"  adapter: $adapter\" >> ./config/database.yml; \\\n\tdone; \\\n\tgosu redmine bundle install --jobs \"$(nproc)\"; \\\n\trm ./config/database.yml; \\\n# fix permissions for running as an arbitrary user\n\tchmod -R ugo=rwX Gemfile.lock \"$GEM_HOME\"; \\\n\trm -rf ~redmine/.bundle; \\\n\t\\\n# reset apt-mark's \"manual\" list so that \"purge --auto-remove\" will remove all build dependencies\n\tapt-mark auto '.*' > /dev/null; \\\n\t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark; \\\n\tfind /usr/local -type f -executable -exec ldd '{}' ';' \\\n\t\t| awk '/=>/ { print $(NF-1) }' \\\n\t\t| sort -u \\\n\t\t| grep -v '^/usr/local/' \\\n\t\t| xargs -r dpkg-query --search \\\n\t\t| cut -d: -f1 \\\n\t\t| sort -u \\\n\t\t| xargs -r apt-mark manual \\\n\t; \\\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false\n\nVOLUME /usr/src/redmine/files\n\nCOPY docker-entrypoint.sh /\nENTRYPOINT [\"/docker-entrypoint.sh\"]\n\nEXPOSE 3000\nCMD [\"rails\", \"server\", \"-b\", \"0.0.0.0\"]\n"
}