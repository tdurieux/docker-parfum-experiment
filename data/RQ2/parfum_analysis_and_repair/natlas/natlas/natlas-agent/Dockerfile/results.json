{
  "startTime": 1674219650207,
  "endTime": 1674219651386,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 22
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 5,
        "lineEnd": 5,
        "columnStart": 4,
        "columnEnd": 59
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM python:3.6 as build\n\nRUN export DEBIAN_FRONTEND=noninteractive \\\n\texport BUILD_PKGS=\"unzip\" \\\n\t&& apt-get update \\\n\t&& apt-get install --no-install-recommends -qy $BUILD_PKGS && rm -rf /var/lib/apt/lists/*;\n\nRUN export AQUATONEURL='https://github.com/michenriksen/aquatone/releases/download/v1.7.0/aquatone_linux_amd64_1.7.0.zip' \\\n\t&& wget $AQUATONEURL -O /tmp/aquatone.zip -q \\\n\t&& unzip /tmp/aquatone.zip -d /tmp/aquatone \\\n\t&& export DUMBINITURL='https://github.com/Yelp/dumb-init/releases/download/v1.2.2/dumb-init_1.2.2_amd64' \\\n\t&& wget -O /tmp/dumb-init $DUMBINITURL \\\n\t&& chmod +x /tmp/dumb-init\n\nCOPY Pipfile .\nCOPY Pipfile.lock .\n\nRUN pip install --no-cache-dir pipenv\nRUN PIPENV_VENV_IN_PROJECT=1 pipenv install --deploy \\\n\t&& rm -rf Pipfile Pipfile.lock deployment\n\nCOPY . /opt/natlas/natlas-agent\n\nWORKDIR /opt/natlas/natlas-agent\n\nRUN python3 -m compileall .\n\n# Build final image\nFROM ubuntu:18.04\n\nRUN export DEBIAN_FRONTEND=noninteractive \\\n\t&& apt-get update \\\n\t&& apt-get install --no-install-recommends -qy python3 python3-pkg-resources chromium-browser nmap xvfb vncsnapshot libcap2-bin \\\n\t&& setcap cap_net_raw,cap_net_admin,cap_net_bind_service+eip /usr/bin/nmap \\\n\t&& rm -rf /var/cache/* /root /var/lib/apt/info/* /var/lib/apt/lists/* /var/lib/ghc /var/lib/dpkg /var/lib/log/*\n\nCOPY --from=build /tmp/dumb-init /usr/bin/dumb-init\nCOPY --from=build /tmp/aquatone/aquatone /usr/bin/aquatone\nCOPY --from=build /opt/natlas /opt/natlas\n\nRUN bash -c 'mkdir -p /data/{scans,conf,logs} \\\n\t&& chown -R www-data:www-data /data'\n\n# We have to copy packages like this because the python directory is different between python images and ubuntu images\n# So the /.venv/bin/python3 symlink ends point pointing to something that doesn't exist\nCOPY --from=build /.venv/lib/python3.6/site-packages /usr/local/lib/python3.6/dist-packages\nWORKDIR /opt/natlas/natlas-agent\nUSER www-data\nENV LC_ALL='C.UTF-8'\nENTRYPOINT [\"/usr/bin/dumb-init\", \"--\"]\n\nCMD [\"python3\", \"/opt/natlas/natlas-agent/natlas-agent.py\"]\n"
}