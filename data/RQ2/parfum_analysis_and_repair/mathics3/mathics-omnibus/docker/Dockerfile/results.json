{
  "startTime": 1674248972916,
  "endTime": 1674248974161,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 30,
        "columnEnd": 41
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 72,
        "lineEnd": 72,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 75,
        "lineEnd": 75,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "mkdirUsrSrcThenRemove",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 47,
        "columnEnd": 72
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 416
      }
    },
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 116
      }
    },
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 147
      }
    },
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 211
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 416
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 116
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 147
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 211
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 416
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 116
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 147
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 211
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 416
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 116
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 147
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 211
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 60
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 443
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 143
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 174
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 238
      }
    }
  ],
  "repairedDockerfile": "FROM ubuntu:focal\n\nENV MATHICS_HOME=/usr/src/app\n\n###  The Asymptote mess ###\n# asymptote version 2.78 is known into work inside docker for mathicsscript while 2.79\n# does not. Asymptote is also used in PDF generation and here newer versions are generally\n# better for that.\nENV ASY_VERSION=asymptote-2.78\n\nENV ENTRYPOINT_COMMAND=\"docker run -it {MATHICS_IMAGE}\"\nENV PYTHON=python3\n\nWORKDIR $MATHICS_HOME\n\nCOPY entrypoint.sh /\nRUN chmod +x /entrypoint.sh\n\nCOPY requirements.txt ./\nRUN apt-get update\nRUN apt-get install -y --no-install-recommends -qq apt-utils && rm -rf /var/lib/apt/lists/*;\n\n# we need libsqlite3-dev now if ubuntu doesn't come with that, we'll need\n# to build our own Python\n# Leave out inkscape  for now.\n\n# inxi and mesa-utils might be optional\n# npm pulls in nodejs, but we'll be explicit.\n\n# Install lots of packages\nRUN DEBIAN_FRONTEND=\"noninteractive\" apt-get -y --no-install-recommends install -qq liblapack-dev llvm-12 llvm-12-dev llvm-11 llvm-11-dev gfortran maria libmysqlclient-dev sqlite3 python3-pip python3-setuptools git python3-numpy python3-matplotlib python-matplotlib-data x11-apps latexmk texlive-xetex lmodern texlive-latex-extra texlive-fonts-recommended nodejs npm xserver-xorg-video-all libgl1-mesa-glx libgl1-mesa-dri mesa-utils evince gyp && rm -rf /var/lib/apt/lists/*;\n\nRUN pip install --no-cache-dir -r requirements.txt\nCOPY requirements-mathicsscript.txt ./\nRUN pip install --no-cache-dir -r requirements-mathicsscript.txt\nCOPY ubuntu-dpkg/*.deb /tmp/\n\n################\n# Mathics core #\n################\nRUN pip install --no-cache-dir \"Mathics3[full]>=4.0.0\"\n# RUN pip install git+https://github.com/Mathics3/mathics-core.git#egg=Mathics3[full]\n\nRUN DEBIAN_FRONTEND=\"noninteractive\" apt-get -y --no-install-recommends install -qq librsvg2-bin python3-cson python3-pyqt5 python3-pyqt5.qtsvg && rm -rf /var/lib/apt/lists/*;\n\n# We need newer versions of Asymptote and GhostScript for bulding the PDF\nRUN dpkg --install /tmp/libgc1_8.0.4-3_amd64.deb /tmp/libgsl25_2.6+dfsg-2_amd64.deb /tmp/libgslcblas0_2.6+dfsg-2_amd64.deb\nRUN DEBIAN_FRONTEND=\"noninteractive\" apt-get -y --no-install-recommends install -qq freeglut3 libfftw3-double3 libglew2.1 libsigsegv2 ghostscript imagemagick texlive-pstricks && rm -rf /var/lib/apt/lists/*;\nCOPY ubuntu-bin/gs /usr/local/bin/\n\n#--\n# build new version of Asymptote for our docs and for inside mathicsscript. The Ubuntu-distributed asymptote has bugs.\n#--\nRUN DEBIAN_FRONTEND=\"noninteractive\" apt-get -y --no-install-recommends install -qq autoconf libgc-dev bison flex libreadline-dev libcurl4 texinfo libsigsegv2 libcurl4 libcurl3-gnutls libcurl4-gnutls-dev libgl-dev freeglut3-dev libglm-dev && rm -rf /var/lib/apt/lists/*;\nCOPY src/${ASY_VERSION}.src.tgz .\nRUN tar -xpf ${ASY_VERSION}.src.tgz && rm ${ASY_VERSION}.src.tgz\nRUN ( cd ${ASY_VERSION} && bash ./autogen.sh && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --disable-lsp && make -j3 all && make -j3 install)\n\nRUN git clone https://github.com/Mathics3/mathics-core.git\nENV DATA_DIR=/usr/src/app/mathics-core/mathics/doc/tex/\nENV DOC_USER_TEX_DATA_PATH=/usr/src/app/mathics-core/mathics/doc/tex/doc_tex_data.pcl\nENV DOC_USER_HTML_DATA_PATH=/usr/src/app/mathics-core/mathics/doc/tex/doc_html_data.pcl\n\nCOPY tex-images/*.pdf mathics-core/mathics/doc/tex/\nENV DOC_LATEX_FILE=/usr/src/app/mathics-core/mathics/doc/tex/documentation.tex\nRUN (cd mathics-core && ${PYTHON} ./setup.py develop)\nRUN (cd mathics-core && make texdoc || /bin/true)\n\n#####################\n# Mathics Pymathics #\n#####################\n\nRUN pip install --no-cache-dir pymathics-graph\n\n# natlang installs spacy so this should come first\nRUN pip install --no-cache-dir pymathics-natlang\nRUN ${PYTHON} -m spacy download en\nRUN ${PYTHON} -m nltk.downloader wordnet omw\n\n##################\n# Mathicsscript  #\n##################\n\n# prompt toolkit needs an IPython that is newer than what got\n# implicitly installed above\nRUN ${PYTHON} -m pip install 'ipython>=7.23.1'\n\nRUN ${PYTHON} -m pip install mathicsscript[full]\n# RUN ${PYTHON} -m pip install -e git+https://github.com/Mathics3/mathicsscript#egg=mathicsscript[full]\nRUN (cd src/mathicsscript && make)\n\n##################\n# Mathics Django #\n##################\nRUN ${PYTHON} -m pip install Mathics-Django[full]\n# RUN ${PYTHON} -m pip install -e git+https://github.com/Mathics3/mathics-django#egg=Mathics-Django[full]\n\nRUN ( cd src/mathics-django && npm install && make) && npm cache clean --force;\nRUN (cd src/mathics-django && ${PYTHON} mathics_django/docpipeline.py -ok) || true\nRUN mkdir -p /usr/src/app/.local/var/mathics && cp -v $DOC_USER_HTML_DATA_PATH /usr/src/app/.local/var/mathics/doc_data.pcl && rm -rf /usr/src/app/.local/var/mathics\n\n##################\n# debug stuff    #\n##################\n# RUN apt-get install -qq emacs\n# RUN pip install trepan3k\n\n##################\n# Finish up      #\n##################\nEXPOSE 8000\n\nRUN groupadd mathics && \\\n    useradd -d $MATHICS_HOME -g mathics -m -s /bin/bash mathics && \\\n    mkdir -p $MATHICS_HOME/data && \\\n    chown -R mathics:mathics $MATHICS_HOME\n\nUSER mathics\nCOPY django-db/mathics.sqlite /usr/src/app/.local/var/mathics/mathics.sqlite\n\nENTRYPOINT [\"/entrypoint.sh\"]\n\nCMD [\"--help\"]\n"
}