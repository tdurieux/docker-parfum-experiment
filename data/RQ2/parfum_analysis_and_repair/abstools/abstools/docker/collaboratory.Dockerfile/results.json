{
  "startTime": 1674216211352,
  "endTime": 1674216212247,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 112,
        "lineEnd": 112,
        "columnStart": 4,
        "columnEnd": 60
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 122,
        "lineEnd": 122,
        "columnStart": 4,
        "columnEnd": 34
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM jojomi/hugo AS abs-models-site\nRUN <<EOF\napk --update add git\ngit clone https://github.com/abstools/abs-models.org.git /abs-models.org\nEOF\nWORKDIR /abs-models.org\nRUN hugo -e collaboratory\n\nFROM erlang:24-alpine AS jdk-erlang\nRUN <<EOF\napk --update add bash nss openjdk11-jdk gcc libc-dev git\nrm -rf /var/cache/apk/*\nEOF\n\nFROM jdk-erlang AS builder\nCOPY ./ /appSrc/\nWORKDIR /appSrc\nRUN <<EOF\nchmod +x gradlew\n./gradlew --no-daemon frontend:assemble\nEOF\n\nFROM php:7.4-apache-buster\n# docker build -t abslang/collaboratory -f docker/collaboratory.Dockerfile ..\n# docker run -d -p 8080:80 --name easyinterface abslang/collaboratory\n\nCOPY <<EASYINTERFACE_SITE_CONF /etc/apache2/sites-available/easyinterface-site.conf\nAlias /ei \"/var/www/easyinterface\"\n\n<Directory \"/var/www/easyinterface\">\n   Options FollowSymlinks MultiViews Indexes IncludesNoExec\n   AllowOverride All\n   Require all granted\n</Directory>\n\nAlias /absexamples \"/var/www/absexamples\"\n\n<Directory \"/var/www/absexamples\">\n   Options FollowSymlinks MultiViews Indexes IncludesNoExec\n   AllowOverride All\n   Require all granted\n    </Directory>\nEASYINTERFACE_SITE_CONF\n# The mkdir below due to https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=863199\nRUN <<EOF\napt-get -y update\napt-get -y install gnupg\nrm -rf /var/lib/apt/lists/*\ncurl https://packages.erlang-solutions.com/erlang-solutions_1.0_all.deb -\\# -o erlang-solutions_1.0_all.deb\ndpkg -i erlang-solutions_1.0_all.deb\nrm erlang-solutions_1.0_all.deb\napt-get -y update\nmkdir -p /usr/share/man/man1\napt-get -y install apt-utils default-jre-headless erlang-base erlang-nox gawk git graphviz libgl1 netcat-openbsd python-dev python-pip unzip wget\nrm -rf /var/lib/apt/lists/*\ngit clone https://github.com/abstools/absexamples.git /var/www/absexamples\nchmod -R 755 /var/www/absexamples\ngit clone https://github.com/abstools/easyinterface.git /var/www/easyinterface\nbash /var/www/easyinterface/server/config/envisage/offlineabsexamples.sh /var/www/absexamples > /var/www/easyinterface/server/config/envisage/examples.cfg\ncp /var/www/easyinterface/server/config/envisage.cfg /var/www/easyinterface/server/config/eiserver.cfg\ncp /var/www/easyinterface/clients/web/envisage.cfg /var/www/easyinterface/clients/web/webclient.cfg\nchmod -R 755 /var/www/easyinterface\na2ensite easyinterface-site\na2enmod headers\nEOF\nCOPY <<ENVISAGE_CONFIG_FILE /var/www/easyinterface/server/bin/envisage/ENVISAGE_CONFIG\n# path to saco\nEC_SACOHOME=\"/usr/local/lib/saco/\"\n# path to abs tools - will look for absfrontend.jar in frontend/dist/\nEC_ABSTOOLSHOME=\"/usr/local/lib/\"\n# path to COFLOCO\nEC_COFLOCOHOME=\"/usr/local/lib/cofloco/\"\n# path to SRA jar\nEC_SRAHOME=\"/usr/local/lib/sra/\"\n# path to aPET\nEC_APETHOME=\"/usr/local/lib/apet\"\n# path to SYCO\nEC_SYCOHOME=\"/usr/local/lib/apet\"\nENVISAGE_CONFIG_FILE\nCOPY --from=abs-models-site /abs-models.org/collaboratory/ /var/www/html/\nRUN <<EOF\ncurl http://costa.fdi.ucm.es/download/saco.colab.zip -\\# -o saco.colab.zip\nunzip saco.colab.zip -d /usr/local/lib\nrm saco.colab.zip\ncurl http://costa.fdi.ucm.es/download/cofloco.colab.zip -\\# -o cofloco.colab.zip\nunzip cofloco.colab.zip -d /usr/local/lib\nrm cofloco.colab.zip\ncurl http://costa.fdi.ucm.es/download/sra.colab.zip -\\# -o sra.colab.zip\nunzip sra.colab.zip -d /usr/local/lib\nrm sra.colab.zip\ncurl http://costa.fdi.ucm.es/download/apet.colab.zip -\\# -o apet.colab.zip\nunzip apet.colab.zip -d /usr/local/lib\nrm apet.colab.zip\n# patch scripts until fixed upstream\nsed -i 's/ -outline / --outline /g' /var/www/easyinterface/server/bin/envisage/outline/absoutline.sh\nsed -i 's/ -erlang / --erlang /g' /var/www/easyinterface/server/bin/envisage/simulator/erlangbackend.sh\nsed -i 's/java -cp $ABSFRONTEND abs.backend.prolog.PrologBackend/java -jar $ABSFRONTEND --prolog/g' /usr/local/lib/saco/bin/generateProlog\nsed -i 's/java -cp $ABSFRONTEND abs.backend.prolog.PrologBackend/java -jar $ABSFRONTEND --prolog/g' /usr/local/lib/apet/bin/generateProlog\nmkdir -p /usr/local/lib/frontend\nEOF\nCOPY --from=builder /appSrc/frontend/bin/ /usr/local/lib/frontend/bin\nCOPY --from=builder /appSrc/frontend/dist/absfrontend.jar /usr/local/lib/frontend/dist/absfrontend.jar\nRUN <<EOF\nchmod -R a+r /usr/local/lib/frontend\nchmod -R a+x /usr/local/lib/frontend/bin\nEOF\n\n\n###############\n# SmartDeployer installation\n###############\nRUN pip install --no-cache-dir antlr4-python2-runtime toposort psutil click\nCOPY --from=jacopomauro/abs_deployer:v0.4.1 /tool /tool\nENV PATH \"$PATH:/tool/MiniZincIDE/bin\"\nENV LD_LIBRARY_PATH \"$LD_LIBRARY_PATH:/tool/MiniZincIDE/lib\"\nENV PYTHONPATH \"$PYTHONPATH:/tool/z3/install/lib/python-2/site-packages\"\nENV PATH \"$PATH:/tool/z3/install/bin\"\nENV CLASSPATH \"$CLASSPATH:/tool/fzn2smt:/tool/fzn2smt/antlr-runtime-3.2.jar\"\nENV PATH \"$PATH:/tool/or-tools/bin\"\nENV PATH \"/tool/abs_deployer:$PATH\"\nENV CLASSPATH \"/usr/local/lib/frontend/dist/absfrontend.jar:$CLASSPATH\"\nRUN pip install --no-cache-dir -e /tool/zephyrus2\n\nRUN echo \"\\\n# set corresponding paths in easyinterface\\n\\\n#\\n\\\n# path to SmartDeployer\\n\\\nEC_SMARTDEPLOYERHOME=\\\"/tool\\\"\\n\\\n# path to minizinc\\n\\\n#\\n\\\nEC_PATH=\\\"\\$EC_PATH::/tool/MiniZincIDE/bin\\\"\\n\" >> /var/www/easyinterface/server/bin/envisage/ENVISAGE_CONFIG\n\n\n\n\n#######\n# HABS\n#######\n\n# RUN echo \"deb http://ppa.launchpad.net/hvr/ghc/ubuntu trusty main\" >> /etc/apt/sources.list\n# RUN apt-get update -y -q\n# RUN apt-get install -y --force-yes -q ghc-8.0.1 cabal-install-1.24 happy-1.19.5 zlib1g-dev\n# RUN git clone https://github.com/abstools/habs /usr/local/lib/habs && \\\n#     cd /usr/local/lib/habs && \\\n#     git submodule update --init\n# ENV PATH=$PATH:/opt/ghc/8.0.1/bin:/opt/cabal/1.24/bin:/opt/happy/1.19.5/bin\n# RUN cd /usr/local/lib/habs && \\\n#     unset GHC_PACKAGE_PATH && \\\n#     cabal sandbox init && \\\n#     cabal update && \\\n#     cabal sandbox add-source habs-parser && \\\n#     cabal sandbox add-source habs-runtime && \\\n#     cabal sandbox add-source habs-stdlib && \\\n#     cabal install -j1 habs-runtime -fwait-all-cogs && \\\n#     cabal install -j1\n# RUN chmod -R a+xr /usr/local/lib/habs\n# RUN echo \"\\\n# # set corresponding HABS paths in easyinterface\\n\\\n# #\\n\\\n# # path to HABS\\n\\\n# EC_HABSHOME=\\\"/usr/local/lib/habs\\\"\\n\\\n# # path to CABAL and HASKELL\\n\\\n# #\\n\\\n# EC_PATH=\\\"\\$EC_PATH:/opt/ghc/8.0.1/bin:/opt/cabal/1.24/bin:/opt/happy/1.19.5/bin\\\"\\n\" >> /var/www/easyinterface/server/bin/envisage/ENVISAGE_CONFIG\n\n"
}