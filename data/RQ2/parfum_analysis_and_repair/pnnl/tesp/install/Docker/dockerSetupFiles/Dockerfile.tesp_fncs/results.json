{
  "startTime": 1674253777067,
  "endTime": 1674253778516,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 78,
        "lineEnd": 80,
        "columnStart": 4,
        "columnEnd": 109
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 73
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Copyright (C) 2021-2022 Battelle Memorial Institute\n# file: Dockerfile.tesp_fncs\n\nARG DOCKER_IMG=laurmarinovici/tesp\nARG DOCKER_IMG_VERSION=:base\n\nFROM ${DOCKER_IMG}${DOCKER_IMG_VERSION} AS tesp-fncs-builder\n# -----------------------------------------------------\n# Environment variables giving the location where TESP\n# related software will be installed on the Docker container.\n# -----------------------------------------------------\nENV TESP=${WORK_DIR}/tesp-platform\nENV FNCS_INSTALL=${TESP}/FNCSInstall\nENV GLD_INSTALL=${TESP}/GridLABDInstall\nENV EPLUS_INSTALL=${TESP}/EnergyPlusInstall\nENV EPLUSJSON_INSTALL=${TESP}/EPlusJSONInstall\n\n# ----------------------------------------------------\n# Because I want to use the software versions I already have\n# installed on the current VM, I am going to use\n# directly the downloads and repositories I have, letting aside\n# the commands that are performing the actual downloads, and\n# repository cloning.\n# Hence, from the context of the folder where I have all my downloads\n# and clones, I only add the needed ones.\n# I am running the image building script from inside the folder where\n# all repositories have been already cloned in the source folders below.\n# --------------------------------------------------------------\n# FNCS branch = develop\nENV FNCS_SOURCE=\"fncs\"\n# -------------------------------\n# GridLAB-D branch = feature/1146\nENV GLD_SOURCE=\"gridlab-d\"\n# -------------------------------\n# Energy Plus branch = fncs-v8.3.0\nENV EPLUS_SOURCE=\"EnergyPlus\"\n# EnergyPlusJSON copied from TESP sources to the context first\nENV EPLUSJSON_SOURCE=\"EnergyPlusJSON\"\n# -------------------------------\n# The folder on the image where all source files will be copied to,\n# so that installation can proceed.\nENV SOURCE_DIR=\"${WORK_DIR}/sources/\"\n\n# --------------------------------------------------------------\n# Environment variables needed for the package installation\n# --------------------------------------------------------------\nENV LD_LIBRARY_PATH=$LD_LIBRARY_PATH:${FNCS_INSTALL}/lib\nENV FNCS_LIBRARY=${FNCS_INSTALL}/lib\nENV FNCS_INCLUDE_DIR=${FNCS_INSTALL}/include\nENV PATH=${PATH}:${FNCS_INSTALL}/bin:${GLD_INSTALL}/bin:${EPLUS_INSTALL}:${EPLUS_INSTALL}/PreProcess:${EPLUS_INSTALL}/PostProcess:${EPLUSJSON_INSTALL}/bin\nENV GLPATH=\"${GLD_INSTALL}/lib/gridlabd:${GLD_INSTALL}/share/gridlabd\"\n# default values\nENV FNCS_LOG_FILE=no\nENV FNCS_LOG_STDOUT=no\nENV FNCS_LOG_TRACE=no\nENV FNCS_LOG_LEVEL=DEBUG4\n\n# ------------------------------------------------------------------\n# Adding the host source folders to the Docker image source folders\n# ------------------------------------------------------------------\nCOPY --chown=tesp-user:tesp-user ./ ${SOURCE_DIR}\n\nRUN mkdir -p ${SOURCE_DIR} && \\\n    mkdir -p ${TESP} && \\\n# ----------------------------------------------------\n# INSTALL FNCS\n# ----------------------------------------------------\n    cd ${SOURCE_DIR}/${FNCS_SOURCE} && \\\n    autoreconf -if && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=${FNCS_INSTALL} && \\\n    make && \\\n    make install && \\\n    /bin/rm -r ${SOURCE_DIR}/${FNCS_SOURCE} && \\\n# ----------------------------------------------------\n# INSTALL GridLAB-D\n# ----------------------------------------------------\n    cd ${SOURCE_DIR}${GLD_SOURCE} && \\\n    autoreconf -isf && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=${GLD_INSTALL} --with-fncs=${FNCS_INSTALL} --enable-silent-rules \\\n    'CPP=gcc -E' 'CXXPP=g++ -E' 'CC=gcc' 'CXX=g++' \\ 'CXXPP=g++ -E' 'CC=gcc' 'CXX=g++' \\\n    'CFLAGS=-w -O3 -fno-inline-functions' 'CXXFLAGS=-w -O3 -fno-inline-functions -std=c++14' 'LDFLAGS=-w -O3' && \\\n    make && \\\n    make install && \\\n    /bin/rm -r ${SOURCE_DIR}${GLD_SOURCE} && \\\n# ----------------------------------------------------\n# INSTALL Energy Plus\n# ----------------------------------------------------\n    cd ${SOURCE_DIR}/${EPLUS_SOURCE} && \\\n    mkdir build && \\\n    cd ./build && \\\n    cmake -DCMAKE_INSTALL_PREFIX:PATH=${EPLUS_INSTALL} \\\n          -DCMAKE_PREFIX_PATH=${FNCS_INSTALL} \\\n          -DBUILD_FORTRAN=ON -DBUILD_PACKAGE=ON -DENABLE_INSTALL_REMOTE=OFF \\\n          ${SOURCE_DIR}/${EPLUS_SOURCE} && \\\n    make -j 4 && \\\n    make install && \\\n    /bin/rm -r ${SOURCE_DIR}/${EPLUS_SOURCE} && \\\n# ----------------------------------------------------\n# INSTALL Energy Plus JSON\n# ----------------------------------------------------\n    cd ${SOURCE_DIR}/${EPLUSJSON_SOURCE} && \\\n    autoheader && \\\n    aclocal && \\\n    automake --add-missing && \\\n    autoreconf -if && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=${EPLUSJSON_INSTALL} --with-fncs=${FNCS_INSTALL} && \\\n    make && \\\n    make install && \\\n    /bin/rm -r ${SOURCE_DIR}/${EPLUSJSON_SOURCE} && \\\n    /bin/rm -r ${SOURCE_DIR}\n\nFROM ${DOCKER_IMG}${DOCKER_IMG_VERSION} AS tesp-fncs-production\n# -----------------------------------------------------\n# Environment variables giving the location where TESP\n# related software will be installed on the Docker container.\n# -----------------------------------------------------\nENV TESP=${WORK_DIR}/tesp-platform\nENV FNCS_INSTALL=${TESP}/FNCSInstall\nENV GLD_INSTALL=${TESP}/GridLABDInstall\nENV EPLUS_INSTALL=${TESP}/EnergyPlusInstall\nENV EPLUSJSON_INSTALL=${TESP}/EPlusJSONInstall\n# --------------------------------------------------------------\n# Environment variables needed for the package installation\n# --------------------------------------------------------------\nENV LD_LIBRARY_PATH=$LD_LIBRARY_PATH:${FNCS_INSTALL}/lib\nENV FNCS_LIBRARY=${FNCS_INSTALL}/lib\nENV FNCS_INCLUDE_DIR=${FNCS_INSTALL}/include\nENV PATH=${PATH}:${FNCS_INSTALL}/bin:${GLD_INSTALL}/bin:${EPLUS_INSTALL}:${EPLUS_INSTALL}/PreProcess:${EPLUS_INSTALL}/PostProcess:${EPLUSJSON_INSTALL}/bin\nENV GLPATH=${GLD_INSTALL}/lib/gridlabd:${GLD_INSTALL}/share/gridlabd\nCOPY --from=tesp-fncs-builder --chown=tesp-user ${WORK_DIR} ${WORK_DIR}"
}