{
  "startTime": 1674251102267,
  "endTime": 1674251103762,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 4,
        "lineEnd": 4,
        "columnStart": 4,
        "columnEnd": 67
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 5,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 15
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM centos:7\n\nARG DBSERVER\n\nRUN yum -y install gcc epel-release httpd mod_ssl ipa-pgothic-fonts && \\\n    yum -y install cpan \\\n     ImageMagick-perl \\\n     perl-GD \\\n     perl-CGI \\\n     perl-DBI \\\n     perl-DBD-MySQL \\\n     perl-Test-Simple \\\n     perl-Archive-Zip \\\n     perl-Net-Telnet \\\n     perl-JSON \\\n     perl-ExtUtils-MakeMaker \\\n     perl-Digest-MD5 \\\n     perl-Text-Diff \\\n     perl-Mail-Sendmail \\\n     perl-Net-OpenSSH \\\n     perl-TermReadKey \\\n     perl-Thread-Queue \\\n     perl-Data-UUID \\\n     perl-Data-Dumper-Concise \\\n     perl-Clone && \\\n    yum clean all && \\\n    echo q | /usr/bin/perl -MCPAN -e shell && \\\n    cpan -f GD::SecurityImage && \\\n    cpan -f GD::SecurityImage::AC && \\\n    cpan -f URI::Escape::JavaScript && \\\n    cpan -f IO::Pty && \\\n    cpan -f Net::Ping::External && \\\n    rm -rf /root/.cpan && \\\n    \\cp -f /usr/share/zoneinfo/Asia/Tokyo /etc/localtime && \\\n    /usr/sbin/adduser -u 2323 -g root telnetman && \\\n    echo telnetman:tcpport23 | chpasswd && \\\n    sed -i -e 's/Options Indexes FollowSymLinks/Options MultiViews FollowSymLinks/' /etc/httpd/conf/httpd.conf && \\\n    sed -i -e 's/Options None/Options ExecCGI/' /etc/httpd/conf/httpd.conf && \\\n    sed -i -e 's/#AddHandler cgi-script \\.cgi/AddHandler cgi-script .cgi/' /etc/httpd/conf/httpd.conf && \\\n    sed -i -e 's/DirectoryIndex index\\.html/DirectoryIndex index.html index.cgi/' /etc/httpd/conf/httpd.conf && \\\n    sed -i -e 's/80/8080/g' /etc/httpd/conf/httpd.conf && \\\n    sed -i -e '/ErrorDocument 403/s/^/#/' /etc/httpd/conf.d/welcome.conf && \\\n    sed -i -e \"\\$a[SAN]\\nsubjectAltName='DNS:telnetman\" /etc/pki/tls/openssl.cnf && \\\n    sed -i -e 's/<Directory \"\\/var\\/www\\/html\">/<Directory \"\\/var\\/www\\/html\">\\n    RewriteEngine on\\n    RewriteBase \\/\\n    RewriteRule ^$ Telnetman2\\/index.html [L]\\n    RewriteCond %{REQUEST_FILENAME} !-f\\n    RewriteCond %{REQUEST_FILENAME} !-d\\n    RewriteRule ^(.+)$ Telnetman2\\/$1 [L]\\n/' /etc/httpd/conf/httpd.conf && \\\n    sed -i -e 's/User apache/User telnetman/' /etc/httpd/conf/httpd.conf && \\\n    sed -i -e 's/Group apache/Group root/' /etc/httpd/conf/httpd.conf && \\\n    openssl req \\\n     -newkey rsa:2048 \\\n     -days 3650 \\\n     -nodes \\\n     -x509 \\\n     -subj \"/C=JP/ST=/L=/O=/OU=/CN=telnetman\" \\\n     -extensions SAN \\\n     -reqexts SAN \\\n     -config /etc/pki/tls/openssl.cnf \\\n     -keyout /etc/pki/tls/private/server.key \\\n     -out /etc/pki/tls/certs/server.crt && \\\n    chmod 644 /etc/pki/tls/private/server.key && \\\n    chmod 644 /etc/pki/tls/certs/server.crt && \\\n    sed -i -e 's/localhost\\.key/server.key/' /etc/httpd/conf.d/ssl.conf && \\\n    sed -i -e 's/localhost\\.crt/server.crt/' /etc/httpd/conf.d/ssl.conf && \\\n    sed -i -e 's/443/8443/g' /etc/httpd/conf.d/ssl.conf && \\\n    mkdir /usr/local/Telnetman2 && \\\n    mkdir /usr/local/Telnetman2/lib && \\\n    mkdir /usr/local/Telnetman2/pl && \\\n    mkdir /var/www/html/Telnetman2 && \\\n    mkdir /var/www/html/Telnetman2/img && \\\n    mkdir /var/www/html/Telnetman2/img/help && \\\n    mkdir /var/www/html/Telnetman2/img/training && \\\n    mkdir /var/www/html/Telnetman2/css && \\\n    mkdir /var/www/html/Telnetman2/js && \\\n    mkdir /var/www/cgi-bin/Telnetman2 && \\\n    mkdir /var/Telnetman2 && rm -rf /var/cache/yum\n\nADD ./lib/*          /usr/local/Telnetman2/lib/\nADD ./pl/*           /usr/local/Telnetman2/pl/\nADD ./html/*         /var/www/html/Telnetman2/\nADD ./js/*           /var/www/html/Telnetman2/js/\nADD ./css/*          /var/www/html/Telnetman2/css/\nADD ./img/*png       /var/www/html/Telnetman2/img/\nADD ./img/*gif       /var/www/html/Telnetman2/img/\nADD ./img/*ico       /var/www/html/Telnetman2/img/\nADD ./img/help/*     /var/www/html/Telnetman2/img/help/\nADD ./img/training/* /var/www/html/Telnetman2/img/training/\nADD ./cgi/*          /var/www/cgi-bin/Telnetman2/\n\nRUN sed -i -e \"s/localhost/$DBSERVER/\" /usr/local/Telnetman2/lib/Common_system.pm && \\\n    sed -i -e \"s/'telnetman', 'tcpport23'/'root', ''/\" /usr/local/Telnetman2/lib/Common_system.pm && \\\n    chown -R telnetman:root /var/Telnetman2 && \\\n    chmod -R 775 /var/Telnetman2 && \\\n    chmod 644 /usr/local/Telnetman2/lib/* && \\\n    chmod 644 /usr/local/Telnetman2/pl/* && \\\n    chmod 644 /var/www/html/Telnetman2/*html && \\\n    chmod 644 /var/www/html/Telnetman2/js/* && \\\n    chmod 644 /var/www/html/Telnetman2/css/* && \\\n    chmod 644 /var/www/html/Telnetman2/img/*png && \\\n    chmod 644 /var/www/html/Telnetman2/img/*gif && \\\n    chmod 644 /var/www/html/Telnetman2/img/*ico && \\\n    chmod 644 /var/www/html/Telnetman2/img/help/* && \\\n    chmod 644 /var/www/html/Telnetman2/img/training/* && \\\n    chmod 755 /var/www/cgi-bin/Telnetman2/* && \\\n    chgrp -R 0   /run/httpd && \\\n    chmod -R g=u /run/httpd && \\\n    chgrp -R 0   /var/log/httpd && \\\n    chmod -R g=u /var/log/httpd\n\nADD ./install/start-web.sh /sbin/start.sh\n\nEXPOSE 8443\n\nUSER telnetman\n\nCMD [\"sh\", \"/sbin/start.sh\"]\n"
}