{
  "startTime": 1674250621153,
  "endTime": 1674250622478,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 91,
        "lineEnd": 91,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 3,
        "lineEnd": 3,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 4,
        "columnEnd": 53
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# DO NOT EDIT THIS FILE : Make yours changes in /utils/Dockerfile.*.blueprint)\nFROM ubuntu:20.04\n\nLABEL authors=\"Julien Neuhart <j.neuhart@thecodingmachine.com>, David NÃ©grier <d.negrier@thecodingmachine.com>\"\n\n# Fixes some weird terminal issues such as broken clear / CTRL+L\n#ENV TERM=linux\n\n# Ensure apt doesn't ask questions when installing stuff\nENV DEBIAN_FRONTEND=noninteractive\n\nARG PHP_VERSION\nENV PHP_VERSION=$PHP_VERSION\n\n# |--------------------------------------------------------------------------\n# | Main PHP extensions\n# |--------------------------------------------------------------------------\n# |\n# | Installs the main PHP extensions\n# |\n\n# Install php an other packages\nRUN apt-get update \\\n    && apt-get install -y --no-install-recommends gnupg \\\n    && echo \"deb http://ppa.launchpad.net/ondrej/php/ubuntu focal main\" > /etc/apt/sources.list.d/ondrej-php.list \\\n    && apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 4F4EA0AAE5267A6C \\\n    && apt-get update \\\n    && apt-get upgrade -y \\\n    && apt-get install -y --no-install-recommends \\\n        git \\\n        nano \\\n        sudo \\\n        iproute2 \\\n        openssh-client \\\n        procps \\\n        unzip \\\n        ca-certificates \\\n        curl \\\n        php${PHP_VERSION}-cli \\\n        php${PHP_VERSION}-curl \\\n        php${PHP_VERSION}-mbstring \\\n        php${PHP_VERSION}-opcache \\\n        php${PHP_VERSION}-readline \\\n        php${PHP_VERSION}-xml \\\n        php${PHP_VERSION}-zip \\\n    && if [[ \"${PHP_VERSION}\" =~ ^7 ]]; then apt-get install -y --no-install-recommends php${PHP_VERSION}-json; fi \\\n    && if [[ \"${PHP_VERSION}\" =~ ^8 ]]; then apt-get install -y --no-install-recommends php${PHP_VERSION}-json; fi \\\n    && apt-get clean \\\n    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /usr/share/doc/*\n\n# |--------------------------------------------------------------------------\n# | User\n# |--------------------------------------------------------------------------\n# |\n# | Define a default user with sudo rights.\n# |\n\nRUN useradd -ms /bin/bash docker && adduser docker sudo\n# Users in the sudoers group can sudo as root without password.\nRUN echo '%sudo ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers\n\n# |--------------------------------------------------------------------------\n# | Default php.ini file\n# |--------------------------------------------------------------------------\n# |\n# | For some reasons, the official image has a php.ini-production.cli file\n# | but no php.ini-development.cli file. Let's create this one.\n# |\n\nRUN cp /usr/lib/php/${PHP_VERSION}/php.ini-development /usr/lib/php/${PHP_VERSION}/php.ini-development.cli && \\\n    sed -i 's/^disable_functions/;disable_functions/g' /usr/lib/php/${PHP_VERSION}/php.ini-development.cli && \\\n    sed -i 's/^memory_limit = .*/memory_limit = -1/g' /usr/lib/php/${PHP_VERSION}/php.ini-development.cli\n\n#ADD https://raw.githubusercontent.com/php/php-src/PHP-${PHP_VERSION}/php.ini-production /usr/local/etc/php/php.ini-production\n#ADD https://raw.githubusercontent.com/php/php-src/PHP-${PHP_VERSION}/php.ini-development /usr/local/etc/php/php.ini-development\n#RUN chmod 644 /usr/local/etc/php/php.ini-*\n\nENV TEMPLATE_PHP_INI=development\n\n# Let's remove the default CLI php.ini file (it will be copied from TEMPLATE_PHP_INI)\nRUN rm /etc/php/${PHP_VERSION}/cli/php.ini\n\n# |--------------------------------------------------------------------------\n# | Composer\n# |--------------------------------------------------------------------------\n# |\n# | Installs Composer to easily manage your PHP dependencies.\n# |\n\n#ENV COMPOSER_ALLOW_SUPERUSER 1\n\nRUN curl -f -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer && \\\n    chmod +x /usr/local/bin/composer\n\n# TODO: utils.php in /usr/local/bin... bof!\nCOPY utils/utils.php /usr/local/bin/utils.php\nRUN mv /usr/bin/php /usr/bin/real_php\nCOPY utils/php_proxy.sh /usr/bin/php\nCOPY utils/check_php_env_var_changes.php /usr/local/bin/check_php_env_var_changes.php\nCOPY utils/php_env_var_cache.php /opt/php_env_var_cache.php\nCOPY utils/generate_conf.php /usr/local/bin/generate_conf.php\nCOPY utils/setup_extensions.php /usr/local/bin/setup_extensions.php\n\n# |--------------------------------------------------------------------------\n# | Default PHP extensions to be enabled\n# | By default, enable all the extensions that are enabled on a base Ubuntu install\n# |--------------------------------------------------------------------------\nENV PHP_EXTENSION_CALENDAR=1 \\\n    PHP_EXTENSION_CTYPE=1 \\\n    PHP_EXTENSION_CURL=1 \\\n    PHP_EXTENSION_DOM=1 \\\n    PHP_EXTENSION_EXIF=1 \\\n    PHP_EXTENSION_FILEINFO=1 \\\n    PHP_EXTENSION_FTP=1 \\\n    PHP_EXTENSION_GETTEXT=1 \\\n    PHP_EXTENSION_ICONV=1 \\\n    PHP_EXTENSION_JSON=1 \\\n    PHP_EXTENSION_MBSTRING=1 \\\n    PHP_EXTENSION_OPCACHE=1 \\\n    PHP_EXTENSION_PDO=1 \\\n    PHP_EXTENSION_PHAR=1 \\\n    PHP_EXTENSION_POSIX=1 \\\n    PHP_EXTENSION_READLINE=1 \\\n    PHP_EXTENSION_SHMOP=1 \\\n    PHP_EXTENSION_SIMPLEXML=1 \\\n    PHP_EXTENSION_SOCKETS=1 \\\n    PHP_EXTENSION_SYSVMSG=1 \\\n    PHP_EXTENSION_SYSVSEM=1 \\\n    PHP_EXTENSION_SYSVSHM=1 \\\n    PHP_EXTENSION_TOKENIZER=1 \\\n    PHP_EXTENSION_WDDX=1 \\\n    PHP_EXTENSION_XML=1 \\\n    PHP_EXTENSION_XMLREADER=1 \\\n    PHP_EXTENSION_XMLWRITER=1 \\\n    PHP_EXTENSION_XSL=1 \\\n    PHP_EXTENSION_ZIP=1\n\nUSER docker\nRUN composer global require bamarni/symfony-console-autocomplete && \\\n    rm -rf ~/.composer/cache\n\nUSER root\n\n\nENV APACHE_CONFDIR /etc/apache2\nENV APACHE_ENVVARS $APACHE_CONFDIR/envvars\n\nRUN set -eux; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends apache2 libapache2-mod-php${PHP_VERSION}; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\t\\\n# generically convert lines like\n#   export APACHE_RUN_USER=www-data\n# into\n#   : ${APACHE_RUN_USER:=www-data}\n#   export APACHE_RUN_USER\n# so that they can be overridden at runtime (\"-e APACHE_RUN_USER=...\")\n\tsed -ri 's/^export ([^=]+)=(.*)$/: ${\\1:=\\2}\\nexport \\1/' \"$APACHE_ENVVARS\"; \\\n\t\\\n# setup directories and permissions\n\t. \"$APACHE_ENVVARS\"; \\\n\tfor dir in \\\n\t\t\"$APACHE_LOCK_DIR\" \\\n\t\t\"$APACHE_RUN_DIR\" \\\n\t\t\"$APACHE_LOG_DIR\" \\\n\t; do \\\n\t\trm -rvf \"$dir\"; \\\n\t\tmkdir -p \"$dir\"; \\\n\t\tchown \"$APACHE_RUN_USER:$APACHE_RUN_GROUP\" \"$dir\"; \\\n# allow running as an arbitrary user (https://github.com/docker-library/php/issues/743)\n\t\tchmod 777 \"$dir\"; \\\n\tdone; \\\n\t\\\n# delete the \"index.html\" that installing Apache drops in here\n\trm -rvf /var/www/html/*; \\\n\t\\\n# logs should go to stdout / stderr\n\tln -sfT /dev/stderr \"$APACHE_LOG_DIR/error.log\"; \\\n\tln -sfT /dev/stdout \"$APACHE_LOG_DIR/access.log\"; \\\n\tln -sfT /dev/stdout \"$APACHE_LOG_DIR/other_vhosts_access.log\"; \\\n\tchown -R --no-dereference \"$APACHE_RUN_USER:$APACHE_RUN_GROUP\" \"$APACHE_LOG_DIR\"\n\n# Apache + PHP requires preforking Apache for best results\nRUN a2dismod mpm_event && a2enmod mpm_prefork\n\n# PHP files should be handled by PHP, and should be preferred over any other file type\nCOPY utils/apache-docker-php.conf /etc/apache2/conf-available/docker-php.conf\n\nRUN a2enconf docker-php\n\nENV PHP_EXTRA_BUILD_DEPS apache2-dev\nENV PHP_EXTRA_CONFIGURE_ARGS --with-apxs2 --disable-cgi\n\n# https://httpd.apache.org/docs/2.4/stopping.html#gracefulstop\nSTOPSIGNAL SIGWINCH\n\nCOPY utils/apache2-foreground /usr/local/bin/\n\nEXPOSE 80\n\nENV APACHE_DOCUMENT_ROOT=\n\nRUN sed -ri -e 's!/var/www/html!${ABSOLUTE_APACHE_DOCUMENT_ROOT}!g' /etc/apache2/sites-available/*.conf\nRUN sed -ri -e 's!/var/www/!${ABSOLUTE_APACHE_DOCUMENT_ROOT}!g' /etc/apache2/apache2.conf /etc/apache2/conf-available/*.conf\n\n# Let's remove the default Apache php.ini file (it will be copied from TEMPLATE_PHP_INI)\nRUN rm /etc/php/${PHP_VERSION}/apache2/php.ini\n\n# |--------------------------------------------------------------------------\n# | Apache mod_rewrite\n# |--------------------------------------------------------------------------\n# |\n# | Enables Apache mod_rewrite.\n# |\n\nRUN a2enmod rewrite\n\n\n\n\n\n\n\n\nRUN chown docker:docker /var/www/html\nWORKDIR /var/www/html\n\n\n# |--------------------------------------------------------------------------\n# | PATH updating\n# |--------------------------------------------------------------------------\n# |\n# | Let's add ./vendor/bin to the PATH (utility function to use Composer bin easily)\n# |\nENV PATH=\"$PATH:./vendor/bin:~/.composer/vendor/bin\"\nRUN sed -i 's#/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin#/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:./vendor/bin:~/.composer/vendor/bin#g' /etc/sudoers\n\nUSER docker\n# |--------------------------------------------------------------------------\n# | SSH client\n# |--------------------------------------------------------------------------\n# |\n# | Let's set-up the SSH client (for connections to private git repositories)\n# | We create an empty known_host file and we launch the ssh-agent\n# |\n\nRUN mkdir ~/.ssh && touch ~/.ssh/known_hosts && chmod 644 ~/.ssh/known_hosts && eval $(ssh-agent -s)\n\n\n# |--------------------------------------------------------------------------\n# | .bashrc updating\n# |--------------------------------------------------------------------------\n# |\n# | Let's update the .bashrc to add nice aliases\n# |\n\nRUN echo 'eval \"$(symfony-autocomplete)\"' > ~/.bash_profile\n\nRUN { \\\n        echo \"alias ls='ls --color=auto'\"; \\\n        echo \"alias ll='ls --color=auto -alF'\"; \\\n        echo \"alias la='ls --color=auto -A'\"; \\\n        echo \"alias l='ls --color=auto -CF'\"; \\\n    } >> ~/.bashrc\n\nUSER root\n\n# |--------------------------------------------------------------------------\n# | NodeJS\n# |--------------------------------------------------------------------------\n# |\n# | NodeJS path registration (if we install NodeJS, this is useful).\n# |\nENV PATH=\"$PATH:./node_modules/.bin\"\nRUN sed -i 's#/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin#/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:./node_modules/.bin#g' /etc/sudoers\n\n# |--------------------------------------------------------------------------\n# | Entrypoint\n# |--------------------------------------------------------------------------\n# |\n# | Defines the entrypoint.\n# |\n\nENV IMAGE_VARIANT=apache\n\n# Add Tini (to be able to stop the container with ctrl-c).\n# See: https://github.com/krallin/tini\nENV TINI_VERSION v0.16.1\nADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini /tini\nRUN chmod +x /tini\n\nCOPY utils/generate_cron.php /usr/local/bin/generate_cron.php\nCOPY utils/startup_commands.php /usr/local/bin/startup_commands.php\n\nCOPY utils/enable_apache_mods.php /usr/local/bin/enable_apache_mods.php\nCOPY utils/apache-expose-envvars.sh /usr/local/bin/apache-expose-envvars.sh\n\nCOPY utils/docker-entrypoint.sh /usr/local/bin/docker-entrypoint.sh\nCOPY utils/docker-entrypoint-as-root.sh /usr/local/bin/docker-entrypoint-as-root.sh\n\nCOPY extensions/ /usr/local/lib/thecodingmachine-php/extensions\nRUN ln -s ${PHP_VERSION} /usr/local/lib/thecodingmachine-php/extensions/current\n\nENTRYPOINT [\"/usr/local/bin/docker-entrypoint.sh\"]\n\n\n# Let's register a servername to remove the message \"apache2: Could not reliably determine the server's fully qualified domain name, using 172.17.0.2. Set the 'ServerName' directive globally to suppress this message\"\nRUN echo \"ServerName localhost\" > /etc/apache2/conf-available/servername.conf\nRUN a2enconf servername\n\nCMD [\"apache2-foreground\"]\n\n# |--------------------------------------------------------------------------\n# | Entrypoint\n# |--------------------------------------------------------------------------\n# |\n# | Defines Apache user. By default, we switch this to \"docker\" user.\n# | This way, no problem to write from Apache in the current working directory.\n# | Important! This should be changed back to www-data in production.\n# |\n\nENV APACHE_RUN_USER=docker \\\n    APACHE_RUN_GROUP=docker\n\n\n\n\nRUN touch /etc/php/${PHP_VERSION}/mods-available/generated_conf.ini && ln -s /etc/php/${PHP_VERSION}/mods-available/generated_conf.ini /etc/php/${PHP_VERSION}/cli/conf.d/generated_conf.ini\n\n\nRUN ln -s /etc/php/${PHP_VERSION}/mods-available/generated_conf.ini /etc/php/${PHP_VERSION}/apache2/conf.d/generated_conf.ini\n\n\n\nUSER docker\n\nCOPY utils/install_selected_extensions.php /usr/local/bin/install_selected_extensions.php\nCOPY utils/install_selected_extensions.sh /usr/local/bin/install_selected_extensions.sh\n\nONBUILD ARG PHP_EXTENSIONS\nONBUILD ENV PHP_EXTENSIONS=\"$PHP_EXTENSIONS\"\nONBUILD RUN sudo -E PHP_EXTENSIONS=\"$PHP_EXTENSIONS\" /usr/local/bin/install_selected_extensions.sh\n\n# |--------------------------------------------------------------------------\n# | Supercronic\n# |--------------------------------------------------------------------------\n# |\n# | Supercronic is a drop-in replacement for cron (for containers).\n# |\nENV SUPERCRONIC_OPTIONS=\n\nONBUILD ARG INSTALL_CRON\nONBUILD RUN if [ -n \"$INSTALL_CRON\" ]; then \\\n SUPERCRONIC_URL=https://github.com/aptible/supercronic/releases/download/v0.1.9/supercronic-linux-amd64 \\\n && SUPERCRONIC=supercronic-linux-amd64 \\\n && SUPERCRONIC_SHA1SUM=5ddf8ea26b56d4a7ff6faecdd8966610d5cb9d85 \\\n && curl -fsSLO \"$SUPERCRONIC_URL\" \\\n && echo \"${SUPERCRONIC_SHA1SUM}  ${SUPERCRONIC}\" | sha1sum -c - \\\n && chmod +x \"$SUPERCRONIC\" \\\n && sudo mv \"$SUPERCRONIC\" \"/usr/local/bin/${SUPERCRONIC}\" \\\n && sudo ln -s \"/usr/local/bin/${SUPERCRONIC}\" /usr/local/bin/supercronic; \\\n fi;\n\n\n# |--------------------------------------------------------------------------\n# | NodeJS\n# |--------------------------------------------------------------------------\n# |\n# | Installs NodeJS and npm. The later will allow you to easily manage\n# | your frontend dependencies.\n# | Also installs yarn. It provides some nice improvements over npm.\n# |\nONBUILD ARG NODE_VERSION\n \\\nRUN if [ -n \"$NODE_VERSION\" ]; then \\\n    sudo apt-get update && \\\n    sudo apt-get install -y --no-install-recommends gnupg && \\\n    curl -f -sL https://deb.nodesource.com/setup_${NODE_VERSION}.x | sudo bash - && \\\n    sudo apt-get update && \\\n    sudo apt-get install -y --no-install-recommends nodejs && \\\n    curl -f -sS https://dl.yarnpkg.com/debian/pubkey.gpg | sudo apt-key add - && \\\n    echo \"deb https://dl.yarnpkg.com/debian/ stable main\" | sudo tee /etc/apt/sources.list.d/yarn.list && \\\n    sudo apt-get update && \\\n    sudo apt-get install -y --no-install-recommends yarn && \\\n    sudo apt-get clean && \\\n    sudo rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /usr/share/doc/*; \\\n    fi; ONBUILD\n\n\n\n\n\n\n\n\n\n\n\n\n"
}