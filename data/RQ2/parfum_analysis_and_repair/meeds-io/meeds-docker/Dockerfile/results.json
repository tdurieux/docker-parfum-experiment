{
  "startTime": 1674254090947,
  "endTime": 1674254091867,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 47,
        "columnEnd": 112
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 7,
        "columnEnd": 52
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# This file is part of the Meeds project (https://meeds.io/).\n# Copyright (C) 2020 Meeds Association\n# contact@meeds.io\n# This program is free software; you can redistribute it and/or\n# modify it under the terms of the GNU Lesser General Public\n# License as published by the Free Software Foundation; either\n# version 3 of the License, or (at your option) any later version.\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n# Lesser General Public License for more details.\n# You should have received a copy of the GNU Lesser General Public License\n# along with this program; if not, write to the Free Software Foundation,\n# Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n#\n# Dockerizing base image for Meeds with:\n#\n# - Libre Office\n# - Meeds\n\n# Build:    docker build -t meeds-io/meeds .\n#\n# Run:      docker run -p 8080:8080 meeds-io/meeds\n#           docker run -d -p 8080:8080 meeds-io/meeds\n#           docker run -d --rm -p 8080:8080 -v meeds_data:/srv/meeds meeds-io/meeds\n#           docker run -d -p 8080:8080 -v $(pwd)/setenv-customize.sh:/opt/meeds/bin/setenv-customize.sh:ro meeds-io/meeds\n\nFROM    exoplatform/jdk:openjdk-11-ubuntu-2004\nLABEL   maintainer=\"Meeds <docker@exoplatform.com>\"\n\n# Install the needed packages\nRUN apt-get update \\\n    && apt-get -y upgrade ${_APT_OPTIONS} \\\n    && apt-get -y --no-install-recommends install ${_APT_OPTIONS} xmlstarlet \\\n    && apt-get -y autoremove \\\n    && apt-get -y clean \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Build Arguments and environment variables\nARG MEEDS_VERSION=1.4.0-M07\n\n# this allow to specify a Meeds download url\nARG DOWNLOAD_URL\n# this allow to specifiy a user to download a protected binary\nARG DOWNLOAD_USER\n# allow to override the list of addons to package by default\nARG ADDONS=\"meeds-jdbc-driver-mysql:2.0.3 meeds-jdbc-driver-postgresql:2.1.0\"\n# Default base directory on the plf archive\nARG ARCHIVE_BASE_DIR=meeds-community-${MEEDS_VERSION}\nARG ARCHIVE_DOWNLOAD_PATH=/srv/downloads/meeds-${MEEDS_VERSION}.zip\n\nENV MEEDS_APP_DIR   /opt/meeds\nENV MEEDS_CONF_DIR  /etc/meeds\nENV MEEDS_DATA_DIR  /srv/meeds\nENV MEEDS_LOG_DIR   /var/log/meeds\nENV MEEDS_TMP_DIR   /tmp/meeds-tmp\n\nENV MEEDS_USER meeds\nENV MEEDS_GROUP ${MEEDS_USER}\n\n# Customise system\n\n# add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\n# giving all rights to 'meeds' user\n# (we use 999 as uid like in official Docker images)\nRUN useradd --create-home -u 999 --user-group --shell /bin/bash ${MEEDS_USER}\n\n# Create needed directories\nRUN mkdir -p ${MEEDS_DATA_DIR}   && chown ${MEEDS_USER}:${MEEDS_GROUP} ${MEEDS_DATA_DIR} \\\n    && mkdir -p ${MEEDS_TMP_DIR} && chown ${MEEDS_USER}:${MEEDS_GROUP} ${MEEDS_TMP_DIR} \\\n    && mkdir -p ${MEEDS_LOG_DIR} && chown ${MEEDS_USER}:${MEEDS_GROUP} ${MEEDS_LOG_DIR}\n\nRUN if [ -n \"${DOWNLOAD_USER}\" ]; then PARAMS=\"-u ${DOWNLOAD_USER}\"; fi && \\\n  echo \"Building an image with Meeds version : ${MEEDS_VERSION}\" && \\\n  if [ ! -n \"${DOWNLOAD_URL}\" ]; then \\\n  DOWNLOAD_URL=\"https://repository.exoplatform.org/service/local/artifact/maven/redirect?r=public&g=io.meeds.distribution&a=plf-community-tomcat-standalone&v=${MEEDS_VERSION}&p=zip\"; \\\n  fi && \\\n  echo \"Downloading Meeds server distribution version : ${MEEDS_VERSION} ...\" && \\\n  if [ ! -f \"${ARCHIVE_DOWNLOAD_PATH}\" ]; then \\\n  curl -f ${PARAMS} -S -L -o ${ARCHIVE_DOWNLOAD_PATH} ${DOWNLOAD_URL}; fi && \\\n  rm -rf /srv/downloads/${ARCHIVE_BASE_DIR} && \\\n  echo \"Unpacking Downloaded Meeds server\" && \\\n  unzip -q ${ARCHIVE_DOWNLOAD_PATH} -d /srv/downloads/ && \\\n  rm -rf ${MEEDS_APP_DIR} && \\\n  mv /srv/downloads/${ARCHIVE_BASE_DIR} ${MEEDS_APP_DIR} && \\\n  chown -R ${MEEDS_USER}:${MEEDS_GROUP} ${MEEDS_APP_DIR} && \\\n  ln -s ${MEEDS_APP_DIR}/gatein/conf /etc/meeds && \\\n  rm -rf ${MEEDS_APP_DIR}/logs && ln -s ${MEEDS_LOG_DIR} ${MEEDS_APP_DIR}/logs && \\\n  rm -f ${ARCHIVE_DOWNLOAD_PATH}\n\n# Install Docker customization file\nADD scripts/setenv-docker-customize.sh ${MEEDS_APP_DIR}/bin/setenv-docker-customize.sh\nRUN chmod 755 ${MEEDS_APP_DIR}/bin/setenv-docker-customize.sh && \\\n  chown ${MEEDS_USER}:${MEEDS_GROUP} ${MEEDS_APP_DIR}/bin/setenv-docker-customize.sh && \\\n  sed -i '/# Load custom settings/i \\\n  \\# Load custom settings for docker environment\\n\\\n  [ -r \"$CATALINA_BASE/bin/setenv-docker-customize.sh\" ] \\\n  && . \"$CATALINA_BASE/bin/setenv-docker-customize.sh\" \\\n  || echo \"No Docker Meeds customization file : $CATALINA_BASE/bin/setenv-docker-customize.sh\"\\n\\\n  ' ${MEEDS_APP_DIR}/bin/setenv.sh && \\\n  grep 'setenv-docker-customize.sh' ${MEEDS_APP_DIR}/bin/setenv.sh\n\nUSER ${MEEDS_USER}\nEXPOSE 8080\nVOLUME [\"/srv/meeds\"]\n\n# INSTALLING Meeds addons\nRUN for a in ${ADDONS}; do echo \"Installing addon $a\"; /opt/meeds/addon install $a; done\n\nWORKDIR ${MEEDS_LOG_DIR}\nENTRYPOINT [\"/usr/local/bin/tini\", \"--\"]\n# Health Check\nHEALTHCHECK CMD curl --fail http://localhost:8080/ || exit 1\nCMD [ \"/opt/meeds/start_eXo.sh\" ]\n"
}