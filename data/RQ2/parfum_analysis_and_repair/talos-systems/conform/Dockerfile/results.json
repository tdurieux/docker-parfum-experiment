{
  "startTime": 1674248759333,
  "endTime": 1674248760785,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 34
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# THIS FILE WAS AUTOMATICALLY GENERATED, PLEASE DO NOT EDIT.\n#\n# Generated on 2022-06-03T19:43:01Z by kres 65530e7.\n\nARG TOOLCHAIN\n\n# cleaned up specs and compiled versions\nFROM scratch AS generate\n\nFROM ghcr.io/siderolabs/ca-certificates:v1.0.0 AS image-ca-certificates\n\nFROM ghcr.io/siderolabs/fhs:v1.0.0 AS image-fhs\n\n# runs markdownlint\nFROM node:18.2.0-alpine AS lint-markdown\nWORKDIR /src\nRUN npm i -g markdownlint-cli@0.31.1 && npm cache clean --force;\nRUN npm i sentences-per-line@0.2.1 && npm cache clean --force;\nCOPY .markdownlint.json .\nCOPY ./CHANGELOG.md ./CHANGELOG.md\nCOPY ./README.md ./README.md\nRUN markdownlint --ignore \"CHANGELOG.md\" --ignore \"**/node_modules/**\" --ignore '**/hack/chglog/**' --rules node_modules/sentences-per-line/index.js .\n\n# base toolchain image\nFROM ${TOOLCHAIN} AS toolchain\nRUN apk --update --no-cache add bash curl build-base protoc protobuf-dev git\n\n# build tools\nFROM toolchain AS tools\nENV GO111MODULE on\nENV CGO_ENABLED 0\nENV GOPATH /go\nARG GOLANGCILINT_VERSION\nRUN curl -sfL https://raw.githubusercontent.com/golangci/golangci-lint/${GOLANGCILINT_VERSION}/install.sh | bash -s -- -b /bin ${GOLANGCILINT_VERSION}\nARG GOFUMPT_VERSION\nRUN go install mvdan.cc/gofumpt@${GOFUMPT_VERSION} \\\n\t&& mv /go/bin/gofumpt /bin/gofumpt\nARG GOIMPORTS_VERSION\nRUN go install golang.org/x/tools/cmd/goimports@${GOIMPORTS_VERSION} \\\n\t&& mv /go/bin/goimports /bin/goimports\nARG DEEPCOPY_VERSION\nRUN go install github.com/siderolabs/deep-copy@${DEEPCOPY_VERSION} \\\n\t&& mv /go/bin/deep-copy /bin/deep-copy\n\n# tools and sources\nFROM tools AS base\nWORKDIR /src\nCOPY ./go.mod .\nCOPY ./go.sum .\nRUN --mount=type=cache,target=/go/pkg go mod download\nRUN --mount=type=cache,target=/go/pkg go mod verify\nCOPY ./cmd ./cmd\nCOPY ./internal ./internal\nRUN --mount=type=cache,target=/go/pkg go list -mod=readonly all >/dev/null\n\n# builds conform-darwin-amd64\nFROM base AS conform-darwin-amd64-build\nCOPY --from=generate / /\nWORKDIR /src/cmd/conform\nARG VERSION_PKG=\"github.com/siderolabs/conform/internal/version\"\nARG SHA\nARG TAG\nRUN --mount=type=cache,target=/root/.cache/go-build --mount=type=cache,target=/go/pkg GOARCH=amd64 GOOS=darwin go build -ldflags \"-s -w -X ${VERSION_PKG}.Name=conform -X ${VERSION_PKG}.SHA=${SHA} -X ${VERSION_PKG}.Tag=${TAG}\" -o /conform-darwin-amd64\n\n# builds conform-darwin-arm64\nFROM base AS conform-darwin-arm64-build\nCOPY --from=generate / /\nWORKDIR /src/cmd/conform\nARG VERSION_PKG=\"github.com/siderolabs/conform/internal/version\"\nARG SHA\nARG TAG\nRUN --mount=type=cache,target=/root/.cache/go-build --mount=type=cache,target=/go/pkg GOARCH=arm64 GOOS=darwin go build -ldflags \"-s -w -X ${VERSION_PKG}.Name=conform -X ${VERSION_PKG}.SHA=${SHA} -X ${VERSION_PKG}.Tag=${TAG}\" -o /conform-darwin-arm64\n\n# builds conform-linux-amd64\nFROM base AS conform-linux-amd64-build\nCOPY --from=generate / /\nWORKDIR /src/cmd/conform\nARG VERSION_PKG=\"github.com/siderolabs/conform/internal/version\"\nARG SHA\nARG TAG\nRUN --mount=type=cache,target=/root/.cache/go-build --mount=type=cache,target=/go/pkg GOARCH=amd64 GOOS=linux go build -ldflags \"-s -w -X ${VERSION_PKG}.Name=conform -X ${VERSION_PKG}.SHA=${SHA} -X ${VERSION_PKG}.Tag=${TAG}\" -o /conform-linux-amd64\n\n# builds conform-linux-arm64\nFROM base AS conform-linux-arm64-build\nCOPY --from=generate / /\nWORKDIR /src/cmd/conform\nARG VERSION_PKG=\"github.com/siderolabs/conform/internal/version\"\nARG SHA\nARG TAG\nRUN --mount=type=cache,target=/root/.cache/go-build --mount=type=cache,target=/go/pkg GOARCH=arm64 GOOS=linux go build -ldflags \"-s -w -X ${VERSION_PKG}.Name=conform -X ${VERSION_PKG}.SHA=${SHA} -X ${VERSION_PKG}.Tag=${TAG}\" -o /conform-linux-arm64\n\n# runs gofumpt\nFROM base AS lint-gofumpt\nRUN FILES=\"$(gofumpt -l .)\" && test -z \"${FILES}\" || (echo -e \"Source code is not formatted with 'gofumpt -w .':\\n${FILES}\"; exit 1)\n\n# runs goimports\nFROM base AS lint-goimports\nRUN FILES=\"$(goimports -l -local github.com/siderolabs/conform .)\" && test -z \"${FILES}\" || (echo -e \"Source code is not formatted with 'goimports -w -local github.com/siderolabs/conform .':\\n${FILES}\"; exit 1)\n\n# runs golangci-lint\nFROM base AS lint-golangci-lint\nCOPY .golangci.yml .\nENV GOGC 50\nRUN --mount=type=cache,target=/root/.cache/go-build --mount=type=cache,target=/root/.cache/golangci-lint --mount=type=cache,target=/go/pkg golangci-lint run --config .golangci.yml\n\n# runs unit-tests with race detector\nFROM base AS unit-tests-race\nARG TESTPKGS\nRUN --mount=type=cache,target=/root/.cache/go-build --mount=type=cache,target=/go/pkg --mount=type=cache,target=/tmp CGO_ENABLED=1 go test -v -race -count 1 ${TESTPKGS}\n\n# runs unit-tests\nFROM base AS unit-tests-run\nARG TESTPKGS\nRUN --mount=type=cache,target=/root/.cache/go-build --mount=type=cache,target=/go/pkg --mount=type=cache,target=/tmp go test -v -covermode=atomic -coverprofile=coverage.txt -coverpkg=${TESTPKGS} -count 1 ${TESTPKGS}\n\nFROM scratch AS conform-darwin-amd64\nCOPY --from=conform-darwin-amd64-build /conform-darwin-amd64 /conform-darwin-amd64\n\nFROM scratch AS conform-darwin-arm64\nCOPY --from=conform-darwin-arm64-build /conform-darwin-arm64 /conform-darwin-arm64\n\nFROM scratch AS conform-linux-amd64\nCOPY --from=conform-linux-amd64-build /conform-linux-amd64 /conform-linux-amd64\n\nFROM scratch AS conform-linux-arm64\nCOPY --from=conform-linux-arm64-build /conform-linux-arm64 /conform-linux-arm64\n\nFROM scratch AS unit-tests\nCOPY --from=unit-tests-run /src/coverage.txt /coverage.txt\n\nFROM conform-linux-${TARGETARCH} AS conform\n\nFROM scratch AS image-conform\nARG TARGETARCH\nCOPY --from=conform conform-linux-${TARGETARCH} /conform\nCOPY --from=image-fhs / /\nCOPY --from=image-ca-certificates / /\nLABEL org.opencontainers.image.source https://github.com/siderolabs/conform\nENTRYPOINT [\"/conform\"]\n\n"
}