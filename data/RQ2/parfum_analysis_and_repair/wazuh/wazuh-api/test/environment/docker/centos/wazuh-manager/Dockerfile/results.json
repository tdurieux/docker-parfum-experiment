{
  "startTime": 1674251798869,
  "endTime": 1674251799548,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 125,
        "columnEnd": 152
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 156,
        "columnEnd": 222
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 29,
        "lineEnd": 29,
        "columnStart": 4,
        "columnEnd": 115
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 7,
        "lineEnd": 7,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 22
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM centos:latest\n\nARG wazuh_branch\nARG wazuh_api_branch\nARG wazuh_doc_branch\n\n# enable SSH\nRUN yum install openssl openssh-server -y && rm -rf /var/cache/yum\nRUN sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config\nRUN echo 'root:wazuh_admin' | chpasswd\nRUN ssh-keygen -A\n\nEXPOSE 22\n\n# install dependencies\nRUN dnf install make gcc automake autoconf libtool git which sudo wget sqlite -y\n\n# install Python 3\nRUN dnf install python3 -y\n\n# install Wazuh\nRUN git clone https://github.com/wazuh/wazuh && cd /wazuh && git checkout ${wazuh_branch}\n# build Python dependencies\nRUN sed -i 's!--index-url=file://${ROUTE_PATH}/${EXTERNAL_CPYTHON}/Dependencies/simple!!' /wazuh/src/Makefile\nCOPY preloaded-vars.conf /wazuh/etc/preloaded-vars.conf\nRUN /wazuh/install.sh\n\n# wazuh-documentation and dependencies\nRUN git clone https://github.com/wazuh/wazuh-documentation && cd /wazuh-documentation && git checkout ${wazuh_doc_branch}\nRUN pip3 install --no-cache-dir Sphinx==1.6.5 sphinx-rtd-theme==0.2.4 sphinxcontrib-images==0.7.0 sphinxprettysearchresults==0.3.5\n\n# install pip libraries for development\nRUN /var/ossec/framework/python/bin/pip3 install pytest ipython defusedxml ptvsd pydevd-pycharm~=191.6605.12 freezegun\n\n# install and configure Wazuh API\nRUN dnf install nodejs -y && npm config set user 0\nRUN git clone https://github.com/wazuh/wazuh-api && cd /wazuh-api && git checkout ${wazuh_api_branch} && ./install_api.sh && npm install mocha apidoc -g && npm install glob supertest mocha should moment mochawesome sqlite3 && npm cache clean --force;\n\n# install ZSH\nRUN yum install zsh -y && rm -rf /var/cache/yum\nRUN cd /root && sh -c \"$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)\"\n\n# copy script for running mocha tests\nCOPY run_mocha_tests.sh /wazuh-api\n\n# copy script for generating Wazuh API reference\nCOPY generate_api_doc.sh /wazuh-api/doc/generate_api_doc.sh\n\n# copy entrypoint and configuration files\nCOPY entrypoint.sh /scripts/entrypoint.sh\nCOPY master-ossec.conf /scripts/master-ossec.conf\nCOPY worker-ossec.conf /scripts/worker-ossec.conf\n"
}