{
  "startTime": 1674251178220,
  "endTime": 1674251179435,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 26,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 44
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ubuntu:22.04\nLABEL maintainer=\"Frank Denis\"\nSHELL [\"/bin/sh\", \"-x\", \"-c\"]\nENV SERIAL 10\n\nENV CFLAGS=-Ofast\nENV BUILD_DEPS   curl make build-essential git libevent-dev libexpat1-dev autoconf file libssl-dev byacc\nENV RUNTIME_DEPS bash util-linux coreutils findutils grep libssl3 ldnsutils libevent-2.1 expat ca-certificates runit runit-helper jed\n\nRUN apt-get update && apt-get -qy dist-upgrade && apt-get -qy clean && \\\n    apt-get install -qy --no-install-recommends $RUNTIME_DEPS && \\\n    rm -fr /tmp/* /var/tmp/* /var/cache/apt/* /var/lib/apt/lists/* /var/log/apt/* /var/log/*.log\n\nRUN update-ca-certificates 2> /dev/null || true\n\nENV UNBOUND_GIT_URL https://github.com/NLnetLabs/unbound.git\nENV UNBOUND_GIT_REVISION 3bade62c8a4b5f4ecc2ba69de67a752891ae77ee\n\nWORKDIR /tmp\n\nRUN apt-get update && apt-get install -qy --no-install-recommends $BUILD_DEPS && \\\n    git clone --depth=1000 \"$UNBOUND_GIT_URL\" && \\\n    cd unbound && \\\n    git checkout \"$UNBOUND_GIT_REVISION\" && \\\n    groupadd _unbound && \\\n    useradd -g _unbound -s /etc -d /dev/null _unbound && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=/opt/unbound --with-pthreads \\\n    --with-username=_unbound --with-libevent && \\\n    make -j\"$(getconf _NPROCESSORS_ONLN)\" install && \\\n    mv /opt/unbound/etc/unbound/unbound.conf /opt/unbound/etc/unbound/unbound.conf.example && \\\n    apt-get -qy purge $BUILD_DEPS && apt-get -qy autoremove && \\\n    rm -fr /opt/unbound/share/man && \\\n    rm -fr /tmp/* /var/tmp/* /var/cache/apt/* /var/lib/apt/lists/* /var/log/apt/* /var/log/*.log\n\nENV RUSTFLAGS \"-C link-arg=-s\"\n\nRUN apt-get update && apt-get install -qy --no-install-recommends $BUILD_DEPS && \\\n    curl -sSf https://sh.rustup.rs | bash -s -- -y --default-toolchain stable && \\\n    export PATH=\"$HOME/.cargo/bin:$PATH\" && \\\n    echo \"Compiling encrypted-dns\" && \\\n    cargo install encrypted-dns && \\\n    mkdir -p /opt/encrypted-dns/sbin && \\\n    mv ~/.cargo/bin/encrypted-dns /opt/encrypted-dns/sbin/ && \\\n    strip --strip-all /opt/encrypted-dns/sbin/encrypted-dns && \\\n    apt-get -qy purge $BUILD_DEPS && apt-get -qy autoremove && \\\n    rm -fr ~/.cargo ~/.rustup && \\\n    rm -fr /tmp/* /var/tmp/* /var/cache/apt/* /var/lib/apt/lists/* /var/log/apt/* /var/log/*.log\n\nRUN groupadd _encrypted-dns && \\\n    mkdir -p /opt/encrypted-dns/empty && \\\n    useradd -g _encrypted-dns -s /etc -d /opt/encrypted-dns/empty _encrypted-dns && \\\n    mkdir -m 700 -p /opt/encrypted-dns/etc/keys && \\\n    mkdir -m 700 -p /opt/encrypted-dns/etc/lists && \\\n    chown _encrypted-dns:_encrypted-dns /opt/encrypted-dns/etc/keys && \\\n    mkdir -m 700 -p /opt/dnscrypt-wrapper/etc/keys && \\\n    mkdir -m 700 -p /opt/dnscrypt-wrapper/etc/lists && \\\n    chown _encrypted-dns:_encrypted-dns /opt/dnscrypt-wrapper/etc/keys\n\nRUN mkdir -p \\\n    /var/svc/unbound \\\n    /var/svc/encrypted-dns \\\n    /var/svc/watchdog\n\nCOPY encrypted-dns.toml.in /opt/encrypted-dns/etc/\nCOPY undelegated.txt /opt/encrypted-dns/etc/\n\nCOPY entrypoint.sh /\n\nCOPY unbound.sh /var/svc/unbound/run\nCOPY unbound-check.sh /var/svc/unbound/check\n\nCOPY encrypted-dns.sh /var/svc/encrypted-dns/run\n\nCOPY watchdog.sh /var/svc/watchdog/run\n\nRUN ln -sf /opt/encrypted-dns/etc/keys/encrypted-dns.toml /opt/encrypted-dns/etc/encrypted-dns.toml\n\nVOLUME [\"/opt/encrypted-dns/etc/keys\"]\n\nEXPOSE 443/udp 443/tcp 9100/tcp\n\nCMD [\"/entrypoint.sh\", \"start\"]\n\nENTRYPOINT [\"/entrypoint.sh\"]\n"
}