{
  "startTime": 1674220246404,
  "endTime": 1674220247865,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 80,
        "lineEnd": 80,
        "columnStart": 4,
        "columnEnd": 145
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 8,
        "columnEnd": 23
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG UBUNTU_VERSION=18.04\nARG CUDA_VERSION=10.2\nARG IMAGE_DIGEST=218afa9c2002be9c4629406c07ae4daaf72a3d65eb3c5a5614d9d7110840a46e\n\nFROM nvidia/cuda:${CUDA_VERSION}-base-ubuntu${UBUNTU_VERSION}@sha256:${IMAGE_DIGEST}\n\nARG MINICONDA_VERSION=4.9.2\nARG CONDA_PY_VERSION=39\nARG CONDA_CHECKSUM=\"b4e46fcc8029e2cfa731b788f25b1d36\"\nARG CONDA_PKG_VERSION=4.10.1\nARG PYTHON_VERSION=3.8.13\nARG PYARROW_VERSION=1.0\nARG MLIO_VERSION=0.7.0\nARG XGBOOST_VERSION=1.5.2\n\nENV DEBIAN_FRONTEND=noninteractive\nENV LANG=C.UTF-8\nENV LC_ALL=C.UTF-8\n\n# Python wonâ€™t try to write .pyc or .pyo files on the import of source modules\n# Force stdin, stdout and stderr to be totally unbuffered. Good for logging\nENV PYTHONDONTWRITEBYTECODE=1\nENV PYTHONUNBUFFERED=1\nENV PYTHONIOENCODING='utf-8'\n\nRUN rm /etc/apt/sources.list.d/cuda.list && \\\n        rm /etc/apt/sources.list.d/nvidia-ml.list && \\\n        apt-key del 7fa2af80 && \\\n        apt-get update && apt-get install -y --no-install-recommends wget && \\\n        wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/cuda-keyring_1.0-1_all.deb && \\\n        dpkg -i cuda-keyring_1.0-1_all.deb && \\\n        apt-get update && \\\n    apt-get -y upgrade && \\\n    apt-get -y install --no-install-recommends \\\n        build-essential \\\n        curl \\\n        git \\\n        jq \\\n        libatlas-base-dev \\\n        nginx \\\n        openjdk-8-jdk-headless \\\n        unzip \\\n        wget \\\n        && \\\n    # MLIO build dependencies\n    # Official Ubuntu APT repositories do not contain an up-to-date version of CMake required to build MLIO.\n    # Kitware contains the latest version of CMake.\n    apt-get -y install --no-install-recommends \\\n        apt-transport-https \\\n        ca-certificates \\\n        gnupg \\\n        software-properties-common \\\n        && \\\n    wget -O - https://apt.kitware.com/keys/kitware-archive-latest.asc 2>/dev/null | \\\n        gpg --batch --dearmor - | \\\n        tee /usr/share/keyrings/kitware-archive-keyring.gpg >/dev/null && \\\n    echo 'deb [signed-by=/usr/share/keyrings/kitware-archive-keyring.gpg] https://apt.kitware.com/ubuntu/ bionic main' | tee /etc/apt/sources.list.d/kitware.list >/dev/null && \\\n    apt-get update && \\\n    rm /usr/share/keyrings/kitware-archive-keyring.gpg && \\\n    apt-get install -y --no-install-recommends \\\n        autoconf \\\n        automake \\\n        build-essential \\\n        cmake=3.18.4-0kitware1 \\\n        cmake-data=3.18.4-0kitware1 \\\n        doxygen \\\n        kitware-archive-keyring \\\n        libcurl4-openssl-dev \\\n        libssl-dev \\\n        libtool \\\n        ninja-build \\\n        python3-dev \\\n        python3-distutils \\\n        python3-pip \\\n        zlib1g-dev \\\n        && \\\n    rm -rf /var/lib/apt/lists/*\n\n# Install conda\nRUN cd /tmp && \\\n    curl -f -L --output /tmp/Miniconda3.sh https://repo.anaconda.com/miniconda/Miniconda3-py${CONDA_PY_VERSION}_${MINICONDA_VERSION}-Linux-x86_64.sh && \\\n    echo \"${CONDA_CHECKSUM} /tmp/Miniconda3.sh\" | md5sum -c - && \\\n    bash /tmp/Miniconda3.sh -bfp /miniconda3 && \\\n    rm /tmp/Miniconda3.sh\n\nENV PATH=/miniconda3/bin:${PATH}\n\n# Install MLIO with Apache Arrow integration\n# We could install mlio-py from conda, but it comes  with extra support such as image reader that increases image size\n# which increases training time. We build from source to minimize the image size.\nRUN echo \"conda ${CONDA_PKG_VERSION}\" >> /miniconda3/conda-meta/pinned && \\\n    # Conda configuration see https://conda.io/projects/conda/en/latest/configuration.html\n    conda config --system --set auto_update_conda false && \\\n    conda config --system --set show_channel_urls true && \\\n    echo \"python ${PYTHON_VERSION}.*\" >> /miniconda3/conda-meta/pinned && \\\n    conda install -c conda-forge python=${PYTHON_VERSION} && \\\n    conda install conda=${CONDA_PKG_VERSION} && \\\n    conda update -y conda && \\\n    conda install -c conda-forge pyarrow=${PYARROW_VERSION} && \\\n    cd /tmp && \\\n    git clone --branch v${MLIO_VERSION} https://github.com/awslabs/ml-io.git mlio && \\\n    cd mlio && \\\n    build-tools/build-dependency build/third-party all && \\\n    mkdir -p build/release && \\\n    cd build/release && \\\n    cmake -GNinja -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_PREFIX_PATH=\"$(pwd)/../third-party\" ../.. && \\\n    cmake --build . && \\\n    cmake --build . --target install && \\\n    cmake -DMLIO_INCLUDE_PYTHON_EXTENSION=ON -DPYTHON_EXECUTABLE=\"/miniconda3/bin/python3\" \\\n        -DMLIO_INCLUDE_ARROW_INTEGRATION=ON ../.. && \\\n    cmake --build . --target mlio-py && \\\n    cmake --build . --target mlio-arrow && \\\n    cd ../../src/mlio-py && \\\n    python3 setup.py bdist_wheel && \\\n    python3 -m pip install typing && \\\n    python3 -m pip install --upgrade pip && \\\n    python3 -m pip install dist/*.whl && \\\n    cp -r /tmp/mlio/build/third-party/lib/intel64/gcc4.7/* /usr/local/lib/ && \\\n    ldconfig && \\\n    rm -rf /tmp/mlio\n\n# Install latest version of XGBoost\nRUN python3 -m pip install --no-cache -I xgboost==${XGBOOST_VERSION}\n"
}