{
  "startTime": 1674248122332,
  "endTime": 1674248123089,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 122,
        "lineEnd": 131,
        "columnStart": 4,
        "columnEnd": 25
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# ISSUE: https://gitlab.alpinelinux.org/alpine/aports/-/issues/12519\nFROM alpine:latest AS build-base\nRUN df\n#users\nRUN addgroup root abuild\n\nRUN apk add --no-cache alpine-sdk sudo su-exec\n\n#RUN set -xe \\\n#    ; mkdir -p /var/cache/distfiles \\\n#    ; chmod a+w /var/cache/distfiles \\\n#    ; chgrp abuild /var/cache/distfiles \\\n#    ; abuild-keygen -a -i\n\n\nRUN set -xe\nRUN mkdir -p /var/cache/distfiles\nRUN chmod a+w /var/cache/distfiles\nRUN chgrp abuild /var/cache/distfiles\nRUN adduser abuild -G abuild; \\\n    abuild-keygen -ai\n\n\nenv \\\n    PKGDEST=/root/packages/ \\\n    REPODEST=/root/packages/\nRUN mkdir -pv ${PKGDEST}\n\n####\nFROM build-base AS build-libsieve\nARG libsieve_APKBUILD=https://gitlab.alpinelinux.org/alpine/aports/-/raw/3.6-stable/unmaintained/libsieve/APKBUILD\nADD ${libsieve_APKBUILD} /build/APKBUILD\nWORKDIR /build\nRUN abuild -F deps\nRUN abuild -F fetch\nRUN abuild -F verify\nRUN abuild -F unpack\nRUN abuild -F prepare\nRUN abuild -F build\nRUN abuild -F rootpkg\nRUN abuild -F rootbld\nRUN abuild -F package\n\n####\nFROM build-base AS build-gmime\nARG gmime_APKBUILD=https://gitlab.alpinelinux.org/alpine/aports/-/raw/3.6-stable/main/gmime/APKBUILD\nADD ${gmime_APKBUILD} /build/APKBUILD\nWORKDIR /build\nRUN abuild -F deps\nRUN abuild -F fetch\nRUN abuild -F verify\nRUN abuild -F unpack\nRUN abuild -F prepare\nRUN abuild -F build\nRUN abuild -F rootpkg\nRUN abuild -F rootbld\nRUN abuild -F package\n\n####\nFROM build-base AS build-libzdb\nARG libzdb_APKBUILD=https://gitlab.alpinelinux.org/alpine/aports/-/raw/3.6-stable/main/libzdb/APKBUILD\nARG libzdb_PATCH=https://gitlab.alpinelinux.org/alpine/aports/-/raw/3.6-stable/main/libzdb/test-makefile.patch\nADD ${libzdb_APKBUILD} /build/APKBUILD\nADD ${libzdb_PATCH} /build/test-makefile.patch\nWORKDIR /build\nRUN abuild -F deps\nRUN abuild -F fetch\nRUN abuild -F verify\nRUN abuild -F unpack\nRUN abuild -F prepare\nRUN abuild -F build\nRUN abuild -F rootpkg\nRUN abuild -F rootbld\nRUN abuild -F package\n\n####\nFROM alpine:latest AS base-image\n\nADD . /app\nCOPY docker/etc/ /etc/\nWORKDIR /app\nRUN apk add --no-cache libc-dev libmhash libevent file\n# libzdb\n# libsieve\n# gmime=3.2\n\n\nCOPY --from=build-base /root/.abuild/ /root/.abuild/\n\nARG LIBSIEVE_VERSION=2.2.7-r1\nCOPY --from=build-libsieve /root/packages/x86_64/libsieve-${LIBSIEVE_VERSION}.apk /root/packages/x86_64/libsieve-${LIBSIEVE_VERSION}.apk\nRUN apk add --allow-untrusted --no-cache /root/packages/x86_64/libsieve-${LIBSIEVE_VERSION}.apk\n\nARG GMIME_VERSION=3.2.7-r2\nCOPY --from=build-gmime /root/packages/x86_64/gmime-${GMIME_VERSION}.apk /root/packages/x86_64/gmime-${GMIME_VERSION}.apk\nRUN apk add --allow-untrusted --no-cache /root/packages/x86_64/gmime-${GMIME_VERSION}.apk\n\nARG LIBZDB_VERSION=3.1-r1\nCOPY --from=build-libzdb /root/packages/x86_64/libzdb-${LIBZDB_VERSION}.apk /root/packages/x86_64/libzdb-${LIBZDB_VERSION}.apk\nRUN apk add --allow-untrusted --no-cache /root/packages/x86_64/libzdb-${LIBZDB_VERSION}.apk\n\n####\nFROM base-image AS build-image\nWORKDIR /app\nRUN apk add --no-cache libc-dev gcc curl make libmhash-dev libevent-dev bsd-compat-headers check-dev pkgconf libtool m4 automake autoconf build-base\n\nARG LIBSIEVE_VERSION=2.2.7-r1\nCOPY --from=build-libsieve /root/packages/x86_64/libsieve-dev-${LIBSIEVE_VERSION}.apk /root/packages/x86_64/libsieve-dev-${LIBSIEVE_VERSION}.apk\nRUN apk add --allow-untrusted --no-cache /root/packages/x86_64/libsieve-dev-${LIBSIEVE_VERSION}.apk\n\nARG GMIME_VERSION=3.2.7-r2\nCOPY --from=build-gmime /root/packages/x86_64/gmime-dev-${GMIME_VERSION}.apk /root/packages/x86_64/gmime-dev-${GMIME_VERSION}.apk\nRUN apk add --allow-untrusted --no-cache /root/packages/x86_64/gmime-dev-${GMIME_VERSION}.apk\n\nARG LIBZDB_VERSION=3.1-r1\nCOPY --from=build-libzdb /root/packages/x86_64/libzdb-dev-${LIBZDB_VERSION}.apk /root/packages/x86_64/libzdb-dev-${LIBZDB_VERSION}.apk\nRUN apk add --allow-untrusted --no-cache /root/packages/x86_64/libzdb-dev-${LIBZDB_VERSION}.apk\n\nRUN mkdir -p /etc/dbmail\nRUN chmod a+w -R /app\nRUN chgrp root /app\n\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" \\\n        --prefix=/root \\\n        --with-sieve=/usr \\\n        --sysconfdir=/etc/dbmail \\\n        --enable-static=no \\\n\t\t--enable-shared=yes \\\n\t\t--disable-libtool-lock \\\n\t\t--disable-dependency-tracking \\\n\t\t--disable-systemd \\\n        --with-check=/usr\n\nRUN make all\nARG CK_FORK=no\nRUN make check\nRUN make install\n\n####\nFROM base-image\nCOPY --from=build-image /root/sbin/dbmail* /usr/sbin/\nCOPY --from=build-image /root/lib/dbmail/ /usr/lib/dbmail/\n\nEXPOSE 24\nEXPOSE 143\nEXPOSE 110\nEXPOSE 2000\n\n\nCMD [\"sh\"]\n"
}