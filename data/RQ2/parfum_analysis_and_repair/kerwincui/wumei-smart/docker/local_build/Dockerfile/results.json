{
  "startTime": 1674247040565,
  "endTime": 1674247043404,
  "originalSmells": [
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 1,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 16,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 27,
        "lineEnd": 32,
        "columnStart": 15,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 1,
        "columnEnd": 48
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 16,
        "columnEnd": 34
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 1,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 1,
        "columnEnd": 56
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 27,
        "lineEnd": 32,
        "columnStart": 15,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 1,
        "columnEnd": 50
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM openjdk:8u322-jre-slim-buster\n\nENV VERSION     1.1\nENV AUTHOR      kerwincui\nENV INFO           wumei smart open source living iot platform\nENV SERVERS     nginx:1.14.2, redis-server:5.0.14, emqx:4.0, openjdk:8u322-jre-slim-buster\n\n# mysql环境变量\nENV DB_HOST             localhost\nENV DB_NAME           wumei\nENV DB_USER             root\nENV DB_PASSWORD   admin\n\nRUN apt-get update && \\\n\t# 安装网络工具和设置时区\n\tapt-get install wget -y --no-install-recommends && \\\n\tln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime && \\\n\t# 更换国内源\n\twget https://qiniu.xiwen.online/Debian10.list && \\\n\tmv Debian10.list /etc/apt/sources.list && \\\n\tapt update && apt upgrade -y && \\\n                # 安装压缩工具\n                apt install --no-install-recommends zip -y && \\\n\t# 安装nginx和redis\n\tapt-get install nginx -y --no-install-recommends && \\\n\tapt-get install redis-server -y --no-install-recommends && \\\n\t# 安装 emqx\n\tapt update && apt install --no-install-recommends -y \\\n      apt-transport-https \\\n      ca-certificates \\\n      curl \\\n      gnupg-agent \\\n      software-properties-common && \\\n\tcurl -fsSL https://repos.emqx.io/gpg.pub | apt-key add - && \\\n\tadd-apt-repository \\\n    \t\t\"deb [arch=amd64] https://repos.emqx.io/emqx-ce/deb/ubuntu/ \\\n    \t\t./bionic \\\n    \t\tstable\" && \\\n\tapt update && \\\n\tapt install emqx=4.0.0 -y --no-install-recommends && \\\n\t# 修改redis配置\n\tsed -i \"s/# requirepass foobared/requirepass wumei-smart/g\" /etc/redis/redis.conf && \\\n\tsed -i \"s/bind 127.0.0.1/# bind 127.0.0.1/g\" /etc/redis/redis.conf && rm -rf /var/lib/apt/lists/*;\n\n# 复制emqx和Nginx的配置文件\nCOPY ./emqx4.0/emqx.conf /etc/emqx/emqx.conf\nCOPY ./emqx4.0/emqx_auth_http.conf /etc/emqx/plugins/emqx_auth_http.conf\nCOPY ./emqx4.0/emqx_web_hook.conf /etc/emqx/plugins/emqx_web_hook.conf\nCOPY ./emqx4.0/loaded_plugins /var/lib/emqx/loaded_plugins\nCOPY ./nginx.conf /etc/nginx/nginx.conf\n# 拷贝前后端压缩文件到容器，容器内解压后删除\nCOPY ./wumei-smart.tar /var/\nRUN cd /var && tar -xvf wumei-smart.tar && rm wumei-smart.tar\n\n# 启动脚本\nCOPY docker-entrypoint.sh /\nENTRYPOINT [\"/docker-entrypoint.sh\"]\n\n# 映射端口\nEXPOSE 80 1883 8083\n\n"
}