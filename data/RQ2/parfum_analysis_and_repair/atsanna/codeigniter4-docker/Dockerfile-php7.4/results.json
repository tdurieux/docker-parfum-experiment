{
  "startTime": 1674253970643,
  "endTime": 1674253973179,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 145,
        "lineEnd": 145,
        "columnStart": 1,
        "columnEnd": 32
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 164,
        "lineEnd": 174,
        "columnStart": 1,
        "columnEnd": 20
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 143,
        "lineEnd": 143,
        "columnStart": 1,
        "columnEnd": 27
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 152,
        "lineEnd": 152,
        "columnStart": 1,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 46,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 91,
        "lineEnd": 91,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 96,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 119,
        "lineEnd": 119,
        "columnStart": 1,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 136,
        "lineEnd": 138,
        "columnStart": 1,
        "columnEnd": 8
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 157,
        "lineEnd": 157,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 213,
        "lineEnd": 213,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 215,
        "lineEnd": 215,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 217,
        "lineEnd": 222,
        "columnStart": 4,
        "columnEnd": 9
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 248,
        "lineEnd": 248,
        "columnStart": 23,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 254,
        "lineEnd": 254,
        "columnStart": 22,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 256,
        "lineEnd": 258,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 286,
        "lineEnd": 286,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 46,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 84,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 18
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 91,
        "lineEnd": 91,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 96,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 157,
        "lineEnd": 157,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 199,
        "lineEnd": 208,
        "columnStart": 4,
        "columnEnd": 13
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 213,
        "lineEnd": 213,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 214,
        "lineEnd": 214,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 215,
        "lineEnd": 215,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 217,
        "lineEnd": 222,
        "columnStart": 4,
        "columnEnd": 9
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 256,
        "lineEnd": 258,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 286,
        "lineEnd": 286,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 46,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 84,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 18
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 91,
        "lineEnd": 91,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 96,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 106,
        "lineEnd": 107,
        "columnStart": 22,
        "columnEnd": 45
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 119,
        "lineEnd": 119,
        "columnStart": 1,
        "columnEnd": 38
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 136,
        "lineEnd": 138,
        "columnStart": 1,
        "columnEnd": 8
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 157,
        "lineEnd": 157,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 199,
        "lineEnd": 208,
        "columnStart": 4,
        "columnEnd": 13
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 213,
        "lineEnd": 213,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 214,
        "lineEnd": 214,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 215,
        "lineEnd": 215,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 217,
        "lineEnd": 222,
        "columnStart": 4,
        "columnEnd": 9
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 248,
        "lineEnd": 248,
        "columnStart": 23,
        "columnEnd": 63
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 254,
        "lineEnd": 254,
        "columnStart": 22,
        "columnEnd": 55
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 256,
        "lineEnd": 258,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 286,
        "lineEnd": 286,
        "columnStart": 4,
        "columnEnd": 38
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 46,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 4,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 70
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 84,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 18
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 91,
        "lineEnd": 91,
        "columnStart": 4,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 96,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 80
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 157,
        "lineEnd": 157,
        "columnStart": 4,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 199,
        "lineEnd": 208,
        "columnStart": 4,
        "columnEnd": 13
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 213,
        "lineEnd": 213,
        "columnStart": 4,
        "columnEnd": 70
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 214,
        "lineEnd": 214,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 215,
        "lineEnd": 215,
        "columnStart": 4,
        "columnEnd": 80
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 217,
        "lineEnd": 222,
        "columnStart": 4,
        "columnEnd": 9
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 256,
        "lineEnd": 258,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 286,
        "lineEnd": 286,
        "columnStart": 4,
        "columnEnd": 62
      }
    }
  ],
  "repairedDockerfile": "FROM php:7.4.30-apache\n\n#====================================================================#\n#                         SET VERSION LABEL                          #\n#====================================================================#\nARG BUILD_DATE=\"June 17 2022\"\nARG PHP_VERSION=\"7.4\"\n\nENV BUILD_DATE=\"${BUILD_DATE}\"\nENV PHP_VERSION=\"${PHP_VERSION}\"\n\n#====================================================================#\n#                             SET LABELS                             #\n#====================================================================#\nLABEL build_version=\"PHP: ${PHP_VERSION}\"\nLABEL build_date=\"${BUILD_DATE}\"\nLABEL maintainer=\"Antonio Sanna <atsanna@tiscali.it>\"\n\n#====================================================================#\n#                         SET SERVER NAME                            #\n#====================================================================#\nARG SERVERNAME=\"localhost\"\nARG DOMAIN=\"example.com\"\nARG WWWDOMAIN=\"www.example.com\"\nARG TZ=\"Europe/Rome\"\n\nENV SERVERNAME=\"${SERVERNAME}\"\nENV DOMAIN=\"${DOMAIN}\"\nENV WWWDOMAIN=\"${WWWDOMAIN}\"\n\n#====================================================================#\n#                          SET USER NAME                             #\n#====================================================================#\nARG USER=\"gisadmin\"\n\n#====================================================================#\n#                          UPGRADE SYSTEM                            #\n#====================================================================#\nRUN \\\n\tDEBIAN_FRONTEND=noninteractive \\\n\tapt-get update && \\\n\tapt-get -y upgrade\n\n#====================================================================#\n#                          INSTALL UTILITY                           #\n#====================================================================#\nRUN apt-get -y --no-install-recommends install --fix-missing sudo \\\n\tgpg \\\n\tvim \\\n\twget \\\n\tgit \\\n\tsoftware-properties-common && rm -rf /var/lib/apt/lists/*;\n\n#====================================================================#\n#                          ADD REPOSITORY                            #\n#====================================================================#\nRUN sed -i -e \"s|# export LS_OPTIONS=|export LS_OPTIONS=|g\" -e \"s|# alias ls=|alias ls=|g\" -e \"s|# alias ll=|alias ll=|g\" -e \"s|# alias rm=|alias rm=|g\" ~/.bashrc \\\n\t&& ln -snf /usr/share/zoneinfo/$TZ /etc/localtime &&  echo $TZ > /etc/timezone \\\n\t&& echo \"deb http://deb.debian.org/debian buster-backports main contrib non-free\" > /etc/apt/sources.list.d/backports.list\n\n#====================================================================#\n#                          UPGRADE SYSTEM                            #\n#====================================================================#\nRUN apt-get update && \\\n\tapt-get -y upgrade\n\n#====================================================================#\n#                          INSTALL CURL                              #\n#====================================================================#\nRUN apt-get -y --no-install-recommends install --fix-missing curl && rm -rf /var/lib/apt/lists/*;\n\n#====================================================================#\n#                           INSTALL GIT                              #\n#====================================================================#\nRUN apt-get -y --no-install-recommends install --fix-missing git && rm -rf /var/lib/apt/lists/*;\n\n#====================================================================#\n#                       INSTALL ZIP - UNZIP                          #\n#====================================================================#\nRUN apt-get -y --no-install-recommends install --fix-missing zip unzip && rm -rf /var/lib/apt/lists/*;\n\n#====================================================================#\n#                        INSTALL DB CLIENT                           #\n#====================================================================#\nRUN apt-get -y install --fix-missing --no-install-recommends \\\n\tmariadb-client \\\n\tpostgresql-client && rm -rf /var/lib/apt/lists/*;\n\n#====================================================================#\n#                         INSTALL SENDMAIL                           #\n#====================================================================#\nRUN apt-get install --no-install-recommends -q -y ssmtp mailutils && rm -rf /var/lib/apt/lists/*;\n\nRUN line=$(head -n 1 /etc/hosts) \\\n\t&& line2=$(echo $line | awk '{print $2}') \\\n\t&& echo \"$line $line2.localdomain\" >> /etc/hosts \\\n\t&& apt install --no-install-recommends --fix-missing -y sendmail sendmail-cf m4 \\\n    && hostname >> /etc/mail/relay-domains \\\n    && m4 /etc/mail/sendmail.mc > /etc/mail/sendmail.cf \\\n    && sed -i -e \"s/Port=smtp,Addr=127.0.0.1, Name=MTA/Port=smtp, Name=MTA/g\" \\\n    /etc/mail/sendmail.mc \\\n\t&& sendmail -bd && rm -rf /var/lib/apt/lists/*;\n\n#====================================================================#\n#                        INSTALL PHP-IMAGIK                          #\n#====================================================================#\nRUN apt-get update && apt-get install --fix-missing -y \\\n    libmagickwand-dev --no-install-recommends \\\n    && pecl install imagick \\\n\t&& docker-php-ext-enable imagick && rm -rf /var/lib/apt/lists/*;\n\n#====================================================================#\n#                       INSTALL GIS LIBRARIES                        #\n#====================================================================#\n#gdal with ecw and libkml support\n## First remove gdal if it's already installed\nRUN apt remove -y gdal-bin gdal-data libgdal20 && \\\n\tapt -y autoremove && \\\n\tapt update && apt -y upgrade && \\\n\tapt install --no-install-recommends -y libpng-dev libgdal-dev && rm -rf /var/lib/apt/lists/*;\n\n## Unzip ECW libraries \"Desktop Read-Only Redistributable\"\nCOPY asset/ecw/hexagon.zip /root\nRUN cd /root && \\\n\tunzip hexagon.zip\n\n## Copy new libraries to system folder\n## Rename the newabi library as x64 and move necessary libraries to /usr/local/lib\nRUN cp -r /root/hexagon/ERDAS-ECW_JPEG_2000_SDK-5.5.0/Desktop_Read-Only /usr/local/hexagon && \\\n\trm -r /usr/local/hexagon/lib/x64 && \\\n\tmv /usr/local/hexagon/lib/cpp11abi/x64 /usr/local/hexagon/lib/x64 && \\\n\tcp /usr/local/hexagon/lib/x64/release/libNCSEcw* /usr/local/lib && \\\n\tldconfig /usr/local/hexagon\n\n## Install libspatialite\nRUN apt-get update -y && \\\n\tapt-get install --no-install-recommends --fix-missing -y \\\n\tlibspatialite-dev \\\n\tsqlite3 && rm -rf /var/lib/apt/lists/*;\n\n## Install PROJ 8\nCOPY asset/ecw/proj-8.2.0.tar.gz /root\nRUN cd /root && \\\n\ttar xfvz proj-8.2.0.tar.gz && \\\n\tcd proj-8.2.0 && \\\n\t./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix /usr/local && \\\n\tmake -j2 && \\\n\tmake install && rm proj-8.2.0.tar.gz\n\n## Install libkml\nCOPY asset/ecw/install-libkml-r864-64bit.tar.gz /root\nRUN cd /root && \\\n\ttar xzf install-libkml-r864-64bit.tar.gz && \\\n\tcp -r install-libkml/include/* /usr/local/include && \\\n\tcp -r install-libkml/lib/* /usr/local/lib && rm install-libkml-r864-64bit.tar.gz\n\n## Install libavif\nRUN apt install --no-install-recommends --fix-missing -y libavif-dev && rm -rf /var/lib/apt/lists/*;\n\n## Build GDAL with ECW and libkml support\nCOPY asset/ecw/gdal340.zip /root\nRUN cd /root && \\\n\tunzip gdal340.zip && \\\n\tcd gdal-3.4.0 && \\\n\t./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" \\\n\t--with-avif \\\n\t--with-ecw=/usr/local/hexagon \\\n#\t--with-libkml=/usr/local/lib \\\n\t--with-proj=/usr/local \\\n    --with-libtiff \\\n    --with-libz=internal \\\n    --with-png=internal \\\n\t--with-geotiff=internal \\\n    --with-threads \\\n    --without-libkml \\\n\t&& \\\n\tmake clean && \\\n\tmake && \\\n\tmake install\n\n## Check if it works\nRUN export PATH=/usr/local/bin:$PATH && \\\n\texport LD_LIBRARY_PATH=/usr/local/lib:$LD_LIBRARY_PATH && \\\n\tgdalinfo --version && \\\n\tgdalinfo --formats | grep ECW\n\n## Remove installation files\nRUN rm -rf /root/hexagon/ && \\\n\trm -rf /root/hexagon.zip && \\\n\trm -rf /root/proj-8.2.0/ && \\\n\trm -rf /root/proj-8.2.0.tar.gz && \\\n\trm -rf /root/install-libkml/ && \\\n\trm -rf /root/install-libkml-r864-64bit.tar.gz && \\\n\trm -rf /root/gdal-3.4.0/ && \\\n\trm -rf /root/gdal340.zip\n\n#====================================================================#\n#                          INSTALL MAPSERVER                         #\n#====================================================================#\nRUN apt-get -y install --fix-missing --no-install-recommends \\\n    libmapserver2 \\\n\tfontconfig \\\n\tcgi-mapserver \\\n\tmapserver-bin \\\n\tlibopenjp2-7-dev \\\n\txl2tpd \\\n\tstrongswan \\\n\tlibapache2-mod-fcgid \\\n\tlibfreetype6 && rm -rf /var/lib/apt/lists/*;\n\n## Check if it works\nRUN mapserv -v\n\nRUN apt-get install --no-install-recommends --fix-missing -y libpq-dev && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends -y libpq-dev && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends -y libxml2-dev libbz2-dev zlib1g-dev && rm -rf /var/lib/apt/lists/*;\n\nRUN apt-get install --no-install-recommends --fix-missing -y libsqlite3-dev \\\n\tlibsqlite3-0 \\\n\texif \\\n\tftp \\\n\tntp \\\n\tgdal-bin && rm -rf /var/lib/apt/lists/*;\n\nADD https://github.com/mlocati/docker-php-extension-installer/releases/latest/download/install-php-extensions /usr/local/bin/\nRUN chmod +x /usr/local/bin/install-php-extensions && \\\n    install-php-extensions amqp ast bcmath bz2 calendar csv dba decimal ds enchant ev event excimer exif ffi \\\n\tgeospatial gettext gd gmp gnupg grpc http igbinary imap intl inotify \\\n\tjson_post ldap lzf mailparse maxminddb mcrypt memcache memcached mongodb msgpack mysqli oauth oci8 odbc opcache opencensus \\\n\topenswoole pcov pdo_dblib pdo_firebird pdo_oci pdo_odbc pdo_mysql pdo_pgsql pdo_sqlsrv pcntl pgsql \\\n\tpspell raphf redis seaslog shmop smbclient snmp \\\n\tsoap sockets ssh2 sqlsrv uuid xmldiff xmlrpc xsl \\\n\tyac yaml yar zephir_parser zip zend_test zstd\n\n#====================================================================#\n#                           APACHE CONF                              #\n#====================================================================#\nCOPY asset/ssl.conf /etc/apache2/mods-available/ssl.conf\nCOPY asset/security.conf /etc/apache2/conf-available/security.conf\nCOPY asset/000-default.conf /etc/apache2/sites-enabled/000-default.conf\n\n#====================================================================#\n#                       INSTALL COMPOSER 2.0                         #\n#====================================================================#\nCOPY --from=composer:latest /usr/bin/composer /usr/bin/composer\nRUN composer self-update --2\n\n#ENV APACHE_DOCUMENT_ROOT /var/www/html/codeigniter4/public\nRUN apt-get update && apt-get install --no-install-recommends -y ca-certificates gnupg && rm -rf /var/lib/apt/lists/*;\nRUN curl -fsSL https://deb.nodesource.com/setup_16.x | bash -\n\n#RUN sed -ri -e 's!/var/www/html!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/sites-available/*.conf\n#RUN sed -ri -e 's!/var/www/!${APACHE_DOCUMENT_ROOT}!g' /etc/apache2/apache2.conf /etc/apache2/conf-available/*.conf\nRUN /usr/sbin/a2enmod rewrite && /usr/sbin/a2enmod headers && /usr/sbin/a2enmod expires\nRUN apt-get update && apt-get install --no-install-recommends -y libzip-dev zip && docker-php-ext-install zip && rm -rf /var/lib/apt/lists/*;\nRUN docker-php-ext-install pdo pdo_mysql mysqli\nRUN apt-get install --no-install-recommends -y libtidy-dev \\\n\nRUN curl -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer && rm -rf /var/lib/apt/lists/*;\nRUN pecl install xdebug\n\nRUN echo 'zend_extension=xdebug' >> /usr/local/etc/php/php.ini\nRUN echo 'xdebug.mode=develop,debug' >> /usr/local/etc/php/php.ini\nRUN echo 'xdebug.client_host=host.docker.internal' >> /usr/local/etc/php/php.ini\nRUN echo 'xdebug.start_with_request=trigger' >> /usr/local/etc/php/php.ini\nRUN echo 'xdebug.client_port=9003' >> /usr/local/etc/php/php.ini\nRUN echo 'session.save_path = \"/tmp\"' >> /usr/local/etc/php/php.ini\n\n#====================================================================#\n#                             ENABLE SSL                             #\n#====================================================================#\nRUN a2enmod ssl\n\n#====================================================================#\n#                           ENABLE MAPSERVER                         #\n#====================================================================#\nRUN\ta2enmod cgi\n\n#====================================================================#\n#                        ENABLE MODULE HEADERS                       #\n#====================================================================#\nRUN a2enmod headers proxy_http\n\n#====================================================================#\n#                             INSTALL FOR                            #\n#====================================================================#\nRUN apt install --no-install-recommends -y nano udev dmidecode \\\n\t&& echo \"www-data        ALL=(ALL) NOPASSWD: /usr/sbin/dmidecode\"  | sudo tee /etc/sudoers.d/dont-prompt-www-data-for-sudo-password \\\n\t&& echo \"www-data        ALL=(ALL) NOPASSWD: /etc/init.d/sendmail\" | sudo tee -a /etc/sudoers.d/dont-prompt-www-data-for-sudo-password && rm -rf /var/lib/apt/lists/*;\n\n#====================================================================#\n#                             START SCRIPT                           #\n#====================================================================#\nCOPY startScript.sh /startScript.sh\n\n#====================================================================#\n#                      CREATE GROUP AND USER                         #\n#====================================================================#\nRUN groupadd -r ${USER} && useradd -g ${USER} ${USER}\n\n#====================================================================#\n#                   SET OWNERCHIP AND PERMISSION                     #\n#====================================================================#\nRUN chown -R www-data:www-data /var/www/html\n\n#====================================================================#\n#                            CLEAN SYSTEM                            #\n#====================================================================#\nRUN apt-get clean && rm -r /var/lib/apt/lists/* \\\n\t&&  rm -rf \\\n\t\t/tmp/* \\\n\t\t/root/.cache\n\n#====================================================================#\n#                              LOGS                                  #\n#====================================================================#\nRUN ln -sf /proc/self/fd/1 \"/var/log/apache2/access.log\" \\\n\t&& ln -sf /proc/self/fd/2 \"/var/log/apache2/error.log\" \\\n\t&& ln -sfT /dev/stdout \"/var/log/apache2/access.log\" \\\n    && ln -sfT /dev/stderr \"/var/log/apache2/error.log\" \\\n\t&& chown -R --no-dereference \"www-data:www-data\" \"/var/log/apache2\"\n\n#====================================================================#\n#                         SWITH TO USER                              #\n#====================================================================#\n#USER ${USER}\nUSER root\n\n#====================================================================#\n#                          SET WORKDIR                               #\n#====================================================================#\nWORKDIR /var/www/html/codeigniter4\n\n#====================================================================#\n#                          EXPOSE PORTS                              #\n#====================================================================#\nEXPOSE 80\nEXPOSE 443\n\n#====================================================================#\n#                            VOLUMES                                 #\n#====================================================================#\n#VOLUME [\"/var/www/html\", \"/usr/lib/php/20190902\", \"/etc/apache2\", \"/etc/php\"]\n\n#====================================================================#\n#                           HEALTHCHECK                              #\n#====================================================================#\nHEALTHCHECK --interval=30s --timeout=3s --retries=5 CMD curl -f http://localhost/ || exit 1\n\n#====================================================================#\n#                            ENTRYPOINT                              #\n#====================================================================#\nCMD [\"bash\", \"/startScript.sh\"]\n"
}