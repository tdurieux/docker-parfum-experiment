{
  "startTime": 1674250926006,
  "endTime": 1674250927351,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 51
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM sha256:ad42391b9b4670e68a759d4cdb8780896071a1cb1ed519b474f901e597bf3b3d AS build-npm\n\nCOPY $REMOTE_SOURCE $REMOTE_SOURCE_DIR\nWORKDIR $REMOTE_SOURCE_DIR/app\n\nRUN INSTALL_PKGS=\"\\\n        nodejs \\\n    \" && \\\n    yum -y --setopt=tsflags=nodocs --setopt=skip_missing_names_on_install=False install $INSTALL_PKGS\n\nRUN cd source/config-tool/pkg/lib/editor && \\\n    npm config list && \\\n    npm install --ignore-engines --loglevel verbose && \\\n    npm run build && npm cache clean --force;\n\nRUN cd source/quay && \\\n    npm config list && \\\n    npm install --ignore-engines --loglevel verbose && \\\n    npm run build && npm cache clean --force;\n\n\nFROM sha256:320c4c36df196f57b67205292ec1514cce5d6c742cbdc01443f465d931d2bbd4 AS build-gomod\n\nCOPY --from=build-npm $REMOTE_SOURCE_DIR/app $REMOTE_SOURCE_DIR/app\nWORKDIR $REMOTE_SOURCE_DIR/app\n\nCOPY --from=build-npm $REMOTE_SOURCE_DIR/app/source/config-tool/pkg/lib/editor/static/build $REMOTE_SOURCE_DIR/app/source/config-tool/pkg/lib/editor/static/build\n\n# https://projects.engineering.redhat.com/browse/CLOUDBLD-1611\n# Until above is fixed, \"go mod vendor\" can't be run since the go.mod must be\n# in the root dir (ie. no multiples). Once fixed, add \"go mod vendor\" as a step\n# here and remove vendor dirs from quay-osbs repo\n#\nRUN cd source/config-tool && \\\n    go build ./cmd/config-tool\n\nRUN cd source/jwtproxy && \\\n    go build ./cmd/jwtproxy\n\nRUN cd source/pushgateway && \\\n    go build\n\n\nFROM sha256:ad42391b9b4670e68a759d4cdb8780896071a1cb1ed519b474f901e597bf3b3d\n\nLABEL com.redhat.component=\"quay-registry-container\"\nLABEL name=\"quay/quay-rhel8\"\nLABEL version=\"v3.5.6\"\nLABEL io.k8s.display-name=\"Red Hat Quay\"\nLABEL io.k8s.description=\"Red Hat Quay\"\nLABEL summary=\"Red Hat Quay\"\nLABEL maintainer=\"support@redhat.com\"\nLABEL io.openshift.tags=\"quay\"\n\nENV PYTHON_VERSION=3.8 \\\n    PYTHON_ROOT=/usr/local/lib/python3.8 \\\n    PATH=$HOME/.local/bin/:$PATH \\\n    PYTHONUNBUFFERED=1 \\\n    PYTHONIOENCODING=UTF-8 \\\n    LANG=en_US.utf8\n\nENV QUAYDIR=/quay-registry \\\n    QUAYCONF=/quay-registry/conf \\\n    QUAYPATH=\".\"\n\nRUN mkdir $QUAYDIR\nWORKDIR $QUAYDIR\n\nARG PIP_CERT\nCOPY --from=build-npm $REMOTE_SOURCE_DIR $REMOTE_SOURCE_DIR\nCOPY --from=build-npm $PIP_CERT $PIP_CERT\nRUN cp -Rp $REMOTE_SOURCE_DIR/app/source/quay/* $QUAYDIR\n\nCOPY --from=build-gomod $REMOTE_SOURCE_DIR/app/source/config-tool/config-tool /usr/local/bin/config-tool\nCOPY --from=build-gomod $REMOTE_SOURCE_DIR/app/source/jwtproxy/jwtproxy /usr/local/bin/jwtproxy\nCOPY --from=build-gomod $REMOTE_SOURCE_DIR/app/source/config-tool/pkg/lib/editor $QUAYDIR/config_app\nCOPY --from=build-gomod $REMOTE_SOURCE_DIR/app/source/pushgateway/pushgateway /usr/local/bin/pushgateway\n\nRUN INSTALL_PKGS=\"\\\n        python38 \\\n        nginx \\\n        openldap \\\n        postgresql \\\n        gcc-c++ git \\\n        openldap-devel \\\n        dnsmasq \\\n        memcached \\\n        openssl \\\n        skopeo \\\n        python38-devel \\\n        libffi-devel \\\n        openssl-devel \\\n        postgresql-devel \\\n        libjpeg-devel \\\n        \" && \\\n    yum -y --setopt=tsflags=nodocs --setopt=skip_missing_names_on_install=False install $INSTALL_PKGS && \\\n    yum -y update && \\\n    yum -y clean all\n\nRUN alternatives --set python /usr/bin/python3 && \\\n    python -m pip install --no-cache-dir --upgrade setuptools pip && \\\n    python -m pip install --no-cache-dir wheel && \\\n    python -m pip install --no-cache-dir -r requirements-osbs.txt --no-cache && \\\n    python -m pip freeze\n\nRUN ln -s $QUAYCONF /conf && \\\n    ln -sf /dev/stdout /var/log/nginx/access.log && \\\n    ln -sf /dev/stdout /var/log/nginx/error.log && \\\n    chmod -R a+rwx /var/log/nginx\n\n# Cleanup\nRUN UNINSTALL_PKGS=\"\\\n        gcc-c++ git \\\n        openldap-devel \\\n        python38-devel \\\n        libffi-devel \\\n        openssl-devel \\\n        postgresql-devel \\\n        libjpeg-devel \\\n        kernel-headers \\\n    \" && \\\n    yum remove -y $UNINSTALL_PKGS && \\\n    yum clean all && \\\n    rm -rf /var/cache/yum /tmp/* /var/tmp/* /root/.cache && \\\n    rm -rf $REMOTE_SOURCE_DIR\n\nEXPOSE 8080 8443 7443\n\nRUN chgrp -R 0 $QUAYDIR && \\\n    chmod -R g=u $QUAYDIR\n\nRUN mkdir /datastorage && chgrp 0 /datastorage && chmod g=u /datastorage && \\\n    mkdir -p /var/log/nginx && chgrp 0 /var/log/nginx && chmod g=u /var/log/nginx && \\\n    mkdir -p /conf/stack && chgrp 0 /conf/stack && chmod g=u /conf/stack && \\\n    mkdir -p /tmp && chgrp 0 /tmp && chmod g=u /tmp && \\\n    chmod g=u /etc/passwd\n\nRUN chgrp 0 /var/log/nginx && \\\n    chmod g=u /var/log/nginx && \\\n    chgrp -R 0 /etc/pki/ca-trust/extracted && \\\n    chmod -R g=u /etc/pki/ca-trust/extracted && \\\n    chgrp -R 0 /etc/pki/ca-trust/source/anchors && \\\n    chmod -R g=u /etc/pki/ca-trust/source/anchors && \\\n    chgrp -R 0 /usr/local/lib/python3.8/site-packages/certifi && \\\n    chmod -R g=u /usr/local/lib/python3.8/site-packages/certifi\n\nVOLUME [\"/var/log\", \"/datastorage\", \"/tmp\", \"/conf/stack\"]\n\nUSER 1001\n\nENTRYPOINT [\"dumb-init\", \"--\", \"/quay-registry/quay-entrypoint.sh\"]\nCMD [\"registry\"]\n\nADD quay-registry-container-v3.5.6-4.json /root/buildinfo/content_manifests/quay-registry-container-v3.5.6-4.json\nLABEL \"release\"=\"4\" \"com.redhat.license_terms\"=\"https://www.redhat.com/agreements\" \"distribution-scope\"=\"public\" \"vendor\"=\"Red Hat, Inc.\" \"build-date\"=\"2021-08-17T21:16:14.144538\" \"architecture\"=\"x86_64\" \"vcs-type\"=\"git\" \"vcs-ref\"=\"0e033c625b6a775f5be730ce5a938aa91cc46d29\" \"com.redhat.build-host\"=\"example.com\" \"description\"=\"Red Hat Quay\" \"url\"=\"https://access.redhat.com/containers/#/registry.access.redhat.com/quay/quay-rhel8/images/v3.5.6-4\"\n"
}