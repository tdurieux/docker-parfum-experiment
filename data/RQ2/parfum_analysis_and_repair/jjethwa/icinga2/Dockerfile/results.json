{
  "startTime": 1674252142162,
  "endTime": 1674252143395,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 7,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 68,
        "lineEnd": 79,
        "columnStart": 7,
        "columnEnd": 29
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Dockerfile for icinga2 with icingaweb2\n# https://github.com/jjethwa/icinga2\n\nFROM debian:bullseye\n\nENV APACHE2_HTTP=REDIRECT \\\n    ICINGA2_FEATURE_GRAPHITE=false \\\n    ICINGA2_FEATURE_GRAPHITE_HOST=graphite \\\n    ICINGA2_FEATURE_GRAPHITE_PORT=2003 \\\n    ICINGA2_FEATURE_GRAPHITE_URL=http://graphite \\\n    ICINGA2_FEATURE_GRAPHITE_SEND_THRESHOLDS=\"true\" \\\n    ICINGA2_FEATURE_GRAPHITE_SEND_METADATA=\"false\" \\\n    ICINGA2_USER_FULLNAME=\"Icinga2\" \\\n    ICINGA2_FEATURE_DIRECTOR=\"true\" \\\n    ICINGA2_FEATURE_DIRECTOR_KICKSTART=\"true\" \\\n    ICINGA2_FEATURE_DIRECTOR_USER=\"icinga2-director\" \\\n    MYSQL_ROOT_USER=root\n\nRUN export DEBIAN_FRONTEND=noninteractive \\\n    && apt-get update \\\n    && apt-get upgrade -y \\\n    && apt-get install -y --no-install-recommends \\\n    apache2 \\\n    bc \\\n    ca-certificates \\\n    curl \\\n    dnsutils \\\n    file \\\n    gnupg \\\n    jq \\\n    libdbd-mysql-perl \\\n    libdigest-hmac-perl \\\n    libnet-snmp-perl \\\n    locales \\\n    logrotate \\\n    lsb-release \\\n    bsd-mailx \\\n    mariadb-client \\\n    mariadb-server \\\n    netbase \\\n    openssh-client \\\n    openssl \\\n    php-curl \\\n    php-ldap \\\n    php-mysql \\\n    php-mbstring \\\n    php-gmp \\\n    procps \\\n    pwgen \\\n    python \\\n    snmp \\\n    msmtp \\\n    sudo \\\n    supervisor \\\n    telnet \\\n    unzip \\\n    wget \\\n    cron \\\n    && apt-get -y --purge remove exim4 exim4-base exim4-config exim4-daemon-light \\\n    && apt-get clean \\\n    && rm -rf /var/lib/apt/lists/*\n\nRUN export DEBIAN_FRONTEND=noninteractive \\\n    && curl -f -s https://packages.icinga.com/icinga.key \\\n    | apt-key add - \\\n    && echo \"deb http://packages.icinga.org/debian icinga-$(lsb_release -cs) main\" > /etc/apt/sources.list.d/icinga2.list \\\n    && echo \"deb http://deb.debian.org/debian $(lsb_release -cs)-backports main\" > /etc/apt/sources.list.d/$(lsb_release -cs)-backports.list \\\n    && apt-get update \\\n    && apt-get install --no-install-recommends -y --install-recommends \\\n    icinga2 \\\n    icinga2-ido-mysql \\\n    icingacli \\\n    icingaweb2 \\\n    icingaweb2-module-doc \\\n    icingaweb2-module-monitoring \\\n    monitoring-plugins \\\n    nagios-nrpe-plugin \\\n    nagios-plugins-contrib \\\n    nagios-snmp-plugins \\\n    libmonitoring-plugin-perl \\\n    && apt-get clean \\\n    && rm -rf /var/lib/apt/lists/*\n\nARG GITREF_MODGRAPHITE=master\nARG GITREF_MODAWS=master\nARG GITREF_REACTBUNDLE=v0.9.0\nARG GITREF_INCUBATOR=v0.16.0\nARG GITREF_IPL=v0.5.0\n\nRUN mkdir -p /usr/local/share/icingaweb2/modules/ \\\n    # Icinga Director\n    && mkdir -p /usr/local/share/icingaweb2/modules/director/ \\\n    && wget -q --no-cookies -O - \"https://github.com/Icinga/icingaweb2-module-director/archive/v1.9.1.tar.gz\" \\\n    | tar xz --strip-components=1 --directory=/usr/local/share/icingaweb2/modules/director --exclude=.gitignore -f - \\\n    # Icingaweb2 Graphite\n    && mkdir -p /usr/local/share/icingaweb2/modules/graphite \\\n    && wget -q --no-cookies -O - \"https://github.com/Icinga/icingaweb2-module-graphite/archive/v1.2.0.tar.gz\" \\\n    | tar xz --strip-components=1 --directory=/usr/local/share/icingaweb2/modules/graphite -f - \\\n    # Icingaweb2 AWS\n    && mkdir -p /usr/local/share/icingaweb2/modules/aws \\\n    && wget -q --no-cookies -O - \"https://github.com/Icinga/icingaweb2-module-aws/archive/v1.1.0.tar.gz\" \\\n    | tar xz --strip-components=1 --directory=/usr/local/share/icingaweb2/modules/aws -f - \\\n    && wget -q --no-cookies \"https://github.com/aws/aws-sdk-php/releases/download/3.222.8/aws.zip\" \\\n    && unzip -d /usr/local/share/icingaweb2/modules/aws/library/vendor/aws aws.zip \\\n    && rm aws.zip \\\n    # Module Reactbundle\n    && mkdir -p /usr/local/share/icingaweb2/modules/reactbundle/ \\\n    && wget -q --no-cookies -O - \"https://github.com/Icinga/icingaweb2-module-reactbundle/archive/v0.9.0.tar.gz\" \\\n    | tar xz --strip-components=1 --directory=/usr/local/share/icingaweb2/modules/reactbundle -f - \\\n    # Module Incubator\n    && mkdir -p /usr/local/share/icingaweb2/modules/incubator/ \\\n    && wget -q --no-cookies -O - \"https://github.com/Icinga/icingaweb2-module-incubator/archive/v0.16.0.tar.gz\" \\\n    | tar xz --strip-components=1 --directory=/usr/local/share/icingaweb2/modules/incubator -f - \\\n    # Module Ipl\n    && mkdir -p /usr/local/share/icingaweb2/modules/ipl/ \\\n    && wget -q --no-cookies -O - \"https://github.com/Icinga/icingaweb2-module-ipl/archive/v0.5.0.tar.gz\" \\\n    | tar xz --strip-components=1 --directory=/usr/local/share/icingaweb2/modules/ipl -f - \\\n    # Module x509\n    && mkdir -p /usr/local/share/icingaweb2/modules/x509/ \\\n    && wget -q --no-cookies \"https://github.com/Icinga/icingaweb2-module-x509/archive/v1.1.2.zip\" \\\n    && unzip -d /usr/local/share/icingaweb2/modules/x509 v1.1.2.zip \\\n    && mv /usr/local/share/icingaweb2/modules/x509/icingaweb2-module-x509-1.1.2/* /usr/local/share/icingaweb2/modules/x509/ \\\n    && rm -rf /usr/local/share/icingaweb2/modules/x509/icingaweb2-module-x509-1.1.2/ \\\n    && true\n\nADD content/ /\n\n# Final fixes\nRUN true \\\n    && sed -i 's/vars\\.os.*/vars.os = \"Docker\"/' /etc/icinga2/conf.d/hosts.conf \\\n    && mv /etc/icingaweb2/ /etc/icingaweb2.dist \\\n    && mv /etc/icinga2/ /etc/icinga2.dist \\\n    && mkdir -p /etc/icinga2 \\\n    && usermod -aG icingaweb2 www-data \\\n    && usermod -aG nagios www-data \\\n    && usermod -aG icingaweb2 nagios \\\n    && mkdir -p /var/log/icinga2 \\\n    && chmod 755 /var/log/icinga2 \\\n    && chown nagios:adm /var/log/icinga2 \\\n    && touch /var/log/cron.log \\\n    && rm -rf \\\n    /var/lib/mysql/* \\\n    && chmod u+s,g+s \\\n    /bin/ping \\\n    /bin/ping6 \\\n    /usr/lib/nagios/plugins/check_icmp \\\n    && /sbin/setcap cap_net_raw+p /bin/ping\n\nEXPOSE 80 443 5665\n\n# Initialize and run Supervisor\nENTRYPOINT [\"/opt/run\"]\n"
}