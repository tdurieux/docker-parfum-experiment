{
  "startTime": 1674249038451,
  "endTime": 1674249040352,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 22,
        "columnEnd": 45
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM carml/base:amd64-cpu-latest\nMAINTAINER Abdul Dakkak <dakkak@illinois.edu>\n\n# Build-time metadata as defined at http://label-schema.org\nARG BUILD_DATE\nARG VCS_REF\nARG VCS_URL\nARG VERSION\nARG ARCH\nARG FRAMEWORK_VERSION\nLABEL org.carml.go-pytorch.build-date=$BUILD_DATE \\\n  org.carml.go-pytorch.name=\"go-pytorch bindings for go\" \\\n  org.carml.go-pytorch.description=\"\" \\\n  org.carml.go-pytorch.url=\"https://www.mlmodelscope.org/\" \\\n  org.carml.go-pytorch.vcs-ref=$VCS_REF \\\n  org.carml.go-pytorch.vcs-url=$VCS_URL \\\n  org.carml.go-pytorch.vendor=\"MLModelScope\" \\\n  org.carml.go-pytorch.arch=$ARCH \\\n  org.carml.go-pytorch.version=$VERSION \\\n  org.carml.go-pytorch.framework_version=$FRAMEWORK_VERSION \\\n  org.carml.go-pytorch.schema-version=\"1.0\"\n\n\n########## DEPENDENCIES INSTALLATION ###################\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n  libgoogle-glog-dev \\\n  libboost-all-dev \\\n  libgtest-dev \\\n  libprotobuf-dev \\\n  protobuf-compiler \\\n  libgflags-dev \\\n  libiomp-dev \\\n  libleveldb-dev \\\n  liblmdb-dev \\\n  libopencv-dev \\\n  libopenmpi-dev \\\n  libsnappy-dev \\\n  openmpi-bin \\\n  openmpi-doc \\\n  libeigen3-dev \\\n  python-dev \\\n  python-pip \\\n  python-setuptools \\\n  python-yaml \\\n  tzdata && \\\n  rm -rf /var/lib/apt/lists/*\n\nRUN pip install --no-cache-dir numpy &&\\\n  pip install --no-cache-dir typing\n\nRUN ln -fs /usr/share/zoneinfo/America/Chicago /etc/localtime && \\\n  dpkg-reconfigure --frontend noninteractive tzdata\n\n########## LIBRARY INSTALLATION ###################\nWORKDIR /opt\n\nRUN apt-get update && apt-get install --no-install-recommends -y sudo && rm -rf /var/lib/apt/lists/*\n\n# SOURCE INSTALLATION\nENV PYTORCH_DIST_DIR /opt/libtorch\nARG BRANCH=v1.3.0\n\nRUN git clone --single-branch --depth=1 --recurse-submodules --branch=${BRANCH} https://github.com/pytorch/pytorch.git && cd pytorch && \\\n  git submodule update --init && \\\n  mkdir build && cd build && \\\n  cmake .. \\\n  -DCMAKE_INSTALL_PREFIX=$PYTORCH_DIST_DIR \\\n  -DBUILD_TORCH=ON \\\n  -DBUILD_SHARED_LIBS=ON \\\n  -DCMAKE_CXX_FLAGS=\"-D_GLIBCXX_USE_CXX11_ABI=1\" \\\n  -DUSE_OBSERVERS=ON \\\n  -DUSE_PROF=ON \\\n  -DBLAS=OpenBLAS \\\n  -DBUILD_CUSTOM_PROTOBUF=ON \\\n  -DBUILD_PYTHON=ON \\\n  -DUSE_NATIVE_ARCH=ON \\\n  -DUSE_NNPACK=ON \\\n  -DUSE_OPENCV=OFF \\\n  -DUSE_MKL=OFF \\\n  -DUSE_DISTRIBUTED=OFF \\\n  -DUSE_ROCKSDB=OFF \\\n  -DUSE_GLOO=OFF \\\n  -DUSE_NCCL=OFF \\\n  -DUSE_CUDA=OFF \\\n  && make -j$(nproc) install \\\n  && ldconfig \\\n  && make clean \\\n  && cd .. \\\n  && rm -rf build\n\n### Built-in method to build custom libtorch\n#RUN git clone --single-branch --depth=1 --recurse-submodules --branch=$FRAMEWORK_VERSION  https://github.com/pytorch/pytorch.git && cd pytorch && \\\n#  git submodule update --init && \\\n#  cd tools && \\\n#  ls -l && \\\n#  python build_libtorch.py && \\\n#  cd ../torch && \\\n#  ls -l && \\\n#  ls -l ./lib && \\\n\nRUN echo \"$PYTORCH_DIST_DIR/lib\" >> /etc/ld.so.conf.d/libtorch.conf && ldconfig\nENV LD_LIBRARY_PATH /opt/libtorch/lib:${LD_LIBRARY_PATH}\n\n########## GO BINDING INSTALLATION ###################\nENV PKG github.com/rai-project/go-pytorch\nWORKDIR $GOPATH/src/$PKG\n\nRUN git clone --depth=1 --single-branch --branch=master  https://${PKG}.git .\n\nRUN dep ensure -v -no-vendor -update \\\n    github.com/rai-project/dlframework && \\\n    dep ensure -v -vendor-only\n\nRUN go install -a -tags=nogpu -installsuffix cgo -ldflags \"-s -w -X ${PKG}/Version=${VERSION} -X ${PKG}/GitCommit=${VCS_REF} -X ${PKG}/BuildDate=${BUILD_DATE}\"&& \\\n  rm -fr vendor\n"
}