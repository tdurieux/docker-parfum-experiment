{
  "startTime": 1674219088818,
  "endTime": 1674219089803,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 22,
        "columnEnd": 45
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM carml/base:ppc64le-gpu-latest\nMAINTAINER Abdul Dakkak <dakkak@illinois.edu>\n\n# Build-time metadata as defined at http://label-schema.org\nARG BUILD_DATE\nARG VCS_REF\nARG VCS_URL\nARG VERSION\nARG ARCH\nARG FRAMEWORK_VERSION\nLABEL org.mlmodelscope.go-caffe2.build-date=$BUILD_DATE \\\n  org.mlmodelscope.go-caffe2.name=\"go-pytorch bindings for go\" \\\n  org.mlmodelscope.go-caffe2.description=\"\" \\\n  org.mlmodelscope.go-caffe2.url=\"https://www.mlmodelscope.org/\" \\\n  org.mlmodelscope.go-caffe2.vcs-ref=$VCS_REF \\\n  org.mlmodelscope.go-caffe2.vcs-url=$VCS_URL \\\n  org.mlmodelscope.go-caffe2.vendor=\"MLModelScope\" \\\n  org.mlmodelscope.go-caffe2.arch=$ARCH \\\n  org.mlmodelscope.go-caffe2.version=$VERSION \\\n  org.mlmodelscope.go-caffe2.framework_version=$FRAMEWORK_VERSION \\\n  org.mlmodelscope.go-caffe2.schema-version=\"1.0\"\n\n########## DEPENDENCIES INSTALLATION ###################\nENV DEBIAN_FRONTEND=noninteractive\nRUN apt-get update && apt-get install -y --no-install-recommends \\\n  libgoogle-glog-dev \\\n  libboost-all-dev \\\n  libgtest-dev \\\n  libprotobuf-dev \\\n  protobuf-compiler \\\n  libgflags-dev \\\n  libiomp-dev \\\n  libleveldb-dev \\\n  liblmdb-dev \\\n  libopencv-dev \\\n  libopenmpi-dev \\\n  libsnappy-dev \\\n  openmpi-bin \\\n  openmpi-doc \\\n  libeigen3-dev \\\n  python-dev \\\n  python-pip \\\n  python-setuptools \\\n  python-yaml  \\\n  tzdata && \\\n  rm -rf /var/lib/apt/lists/*\n\nRUN pip install --no-cache-dir numpy &&\\\n  pip install --no-cache-dir typing\n\nRUN ln -fs /usr/share/zoneinfo/America/Chicago /etc/localtime && \\\n  dpkg-reconfigure --frontend noninteractive tzdata\n\n########## LIBRARY INSTALLATION ###################\nWORKDIR /opt\n\nRUN apt-get update && apt-get install --no-install-recommends -y sudo && rm -rf /var/lib/apt/lists/*\n\n# SOURCE INSTALLATION\nENV PYTORCH_DIST_DIR /opt/libtorch\n\nRUN git clone --single-branch --depth=1 --recurse-submodules --branch=master https://github.com/pytorch/pytorch.git && cd pytorch && \\\n  git submodule update --init && \\\n  mkdir build && cd build && \\\n  cmake .. \\\n  -DCMAKE_INSTALL_PREFIX=$PYTORCH_DIST_DIR \\\n  -DBUILD_TORCH=ON \\\n  -DBUILD_SHARED_LIBS=ON \\\n  -DCMAKE_CXX_FLAGS=\"-D_GLIBCXX_USE_CXX11_ABI=0\" \\\n  -DUSE_OBSERVERS=ON \\\n  -DUSE_PROF=ON \\\n  -DBLAS=OpenBLAS \\\n  -DBUILD_CUSTOM_PROTOBUF=OFF \\\n  -DBUILD_PYTHON=ON \\\n  -DUSE_NNPACK=ON \\\n  -DUSE_OPENCV=OFF \\\n  -DUSE_MKL=OFF \\\n  -DUSE_DISTRIBUTED=OFF \\\n  -DUSE_ROCKSDB=OFF \\\n  -DUSE_GLOO=OFF \\\n  -DUSE_NCCL=OFF \\\n  -DUSE_CUDA=ON \\\n  -DUSE_CUDNN=ON \\\n  -DCUDA_ARCH_NAME=Manual \\\n  -DTORCH_CUDA_ARCH_LIST=\"3.0 3.5 3.7 5.0 5.2 5.3 6.0 6.1+PTX 7.0+PTX 7.5+PTX\" \\\n  -DPYTORCH_CUDA_ARCH_LIST=\"3.0 3.5 3.7 5.0 5.2 5.3 6.0 6.1+PTX 7.0+PTX 7.5+PTX\" \\\n  && make -j$(nproc) install \\\n  && ldconfig \\\n  && make clean \\\n  && cd .. \\\n  && rm -rf build\n\nRUN echo \"$PYTORCH_DIST_DIR/lib\" >> /etc/ld.so.conf.d/libtorch.conf && ldconfig\n\n########## GO BINDING INSTALLATION ###################\nENV PKG github.com/rai-project/go-pytorch\nWORKDIR $GOPATH/src/$PKG\n\nRUN git clone --depth=1 --single-branch --branch=master https://${PKG}.git . && \\\n  dep ensure -vendor-only && \\\n  go install -a -tags=nogpu -a -installsuffix cgo -ldflags \"-s -w -X ${PKG}/Version=${VERSION} -X ${PKG}/GitCommit=${VCS_REF} -X ${PKG}/BuildDate=${BUILD_DATE}\"&& \\\n  rm -fr vendor\n"
}