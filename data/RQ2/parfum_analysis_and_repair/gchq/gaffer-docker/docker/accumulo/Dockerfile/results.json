{
  "startTime": 1674247124696,
  "endTime": 1674247130914,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 40,
        "lineEnd": 44,
        "columnStart": 1,
        "columnEnd": 6
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 87,
        "lineEnd": 90,
        "columnStart": 1,
        "columnEnd": 12
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Copyright 2020 Crown Copyright\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\nARG BUILDER_IMAGE_NAME=debian\nARG BUILDER_IMAGE_TAG=stretch-20220125-slim\n\nARG BASE_IMAGE_NAME=debian\nARG BASE_IMAGE_TAG=stretch-20220125-slim\n\nARG ACCUMULO_VERSION=1.9.3\nARG HADOOP_VERSION=3.2.2\nARG ZOOKEEPER_VERSION=3.7.0\n\nFROM ${BUILDER_IMAGE_NAME}:${BUILDER_IMAGE_TAG} as builder\n\nARG ACCUMULO_VERSION\nARG HADOOP_VERSION\nARG ZOOKEEPER_VERSION\n\nARG HADOOP_DOWNLOAD_URL=\"https://www.apache.org/dyn/closer.cgi?action=download&filename=hadoop/common/hadoop-${HADOOP_VERSION}/hadoop-${HADOOP_VERSION}.tar.gz\"\nARG HADOOP_BACKUP_DOWNLOAD_URL=\"https://archive.apache.org/dist/hadoop/common/hadoop-${HADOOP_VERSION}/hadoop-${HADOOP_VERSION}.tar.gz\"\n\nARG ACCUMULO_DOWNLOAD_URL=\"https://www.apache.org/dyn/closer.cgi?action=download&filename=accumulo/${ACCUMULO_VERSION}/accumulo-${ACCUMULO_VERSION}-bin.tar.gz\"\nARG ACCUMULO_BACKUP_DOWNLOAD_URL=\"https://archive.apache.org/dist/accumulo/${ACCUMULO_VERSION}/accumulo-${ACCUMULO_VERSION}-bin.tar.gz\"\n\nARG ZOOKEEPER_DOWNLOAD_URL=\"https://www.apache.org/dyn/closer.cgi?action=download&filename=zookeeper/zookeeper-${ZOOKEEPER_VERSION}/apache-zookeeper-${ZOOKEEPER_VERSION}-bin.tar.gz\"\nARG ZOOKEEPER_BACKUP_DOWNLOAD_URL=\"https://archive.apache.org/dist/zookeeper/zookeeper-${ZOOKEEPER_VERSION}/apache-zookeeper-${ZOOKEEPER_VERSION}-bin.tar.gz\"\n\nRUN apt -qq update && \\\n\tapt -qq --no-install-recommends install -y \\\n\t\tg++ \\\n\t\tmake \\\n\t\topenjdk-8-jdk-headless \\\n\t\twget \\\n\t&& rm -rf /var/lib/apt/lists/*\n\nENV JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64/\n\n# Allow users to provide their own builds of Accumulo, ZooKeeper and Hadoop\nCOPY ./files/ .\n# Otherwise, download official distributions\nRUN if [ ! -f \"./accumulo-${ACCUMULO_VERSION}-bin.tar.gz\" ]; then \\\n\t\t(wget -nv -O ./accumulo-${ACCUMULO_VERSION}-bin.tar.gz ${ACCUMULO_DOWNLOAD_URL} || wget -nv -O ./accumulo-${ACCUMULO_VERSION}-bin.tar.gz ${ACCUMULO_BACKUP_DOWNLOAD_URL}); \\\n\tfi && \\\n\tif [ ! -f \"./hadoop-${HADOOP_VERSION}.tar.gz\" ]; then \\\n\t\t(wget -nv -O ./hadoop-${HADOOP_VERSION}.tar.gz ${HADOOP_DOWNLOAD_URL} || wget -nv -O ./hadoop-${HADOOP_VERSION}.tar.gz ${HADOOP_BACKUP_DOWNLOAD_URL}); \\\n\tfi && \\\n\tif [ ! -f \"./apache-zookeeper-${ZOOKEEPER_VERSION}-bin.tar.gz\" ]; then \\\n\t\t(wget -nv -O ./apache-zookeeper-${ZOOKEEPER_VERSION}-bin.tar.gz ${ZOOKEEPER_DOWNLOAD_URL} || wget -nv -O ./apache-zookeeper-${ZOOKEEPER_VERSION}-bin.tar.gz ${ZOOKEEPER_BACKUP_DOWNLOAD_URL}); \\\n\tfi\n\n# Extract required files\nRUN tar -xf ./accumulo-${ACCUMULO_VERSION}-bin.tar.gz accumulo-${ACCUMULO_VERSION}/bin/ accumulo-${ACCUMULO_VERSION}/lib/ && \\\n\trm -f ./accumulo-${ACCUMULO_VERSION}-bin.tar.gz && \\\n\t./accumulo-${ACCUMULO_VERSION}/bin/build_native_library.sh && \\\n\ttar -xf ./hadoop-${HADOOP_VERSION}.tar.gz \\\n\t\thadoop-${HADOOP_VERSION}/lib/native/ \\\n\t\thadoop-${HADOOP_VERSION}/share/hadoop/client/ \\\n\t\thadoop-${HADOOP_VERSION}/share/hadoop/common/lib/ \\\n\t\thadoop-${HADOOP_VERSION}/share/hadoop/hdfs/hadoop-hdfs-${HADOOP_VERSION}.jar \\\n\t\thadoop-${HADOOP_VERSION}/share/hadoop/yarn/ \\\n\t&& \\\n\trm -f ./hadoop-${HADOOP_VERSION}.tar.gz && \\\n\tcp ./hadoop-${HADOOP_VERSION}/share/hadoop/yarn/timelineservice/lib/commons-lang-*.jar ./hadoop-${HADOOP_VERSION}/share/hadoop/common/lib/ && \\\n\trm -rf ./hadoop-${HADOOP_VERSION}/share/hadoop/yarn && \\\n\ttar -xf ./apache-zookeeper-${ZOOKEEPER_VERSION}-bin.tar.gz --wildcards \"apache-zookeeper-${ZOOKEEPER_VERSION}-bin/lib/zookeeper*.jar\" && \\\n\trm -f ./apache-zookeeper-${ZOOKEEPER_VERSION}-bin.tar.gz\n\nFROM ${BASE_IMAGE_NAME}:${BASE_IMAGE_TAG}\nARG ACCUMULO_VERSION\nARG HADOOP_VERSION\nARG ZOOKEEPER_VERSION\nARG USER=accumulo\nARG GROUP=accumulo\n\nRUN apt -qq update && \\\n\tapt -qq --no-install-recommends install -y \\\n\t\tdumb-init \\\n\t\topenjdk-8-jre-headless \\\n\t\txmlstarlet \\\n\t&& rm -rf /var/lib/apt/lists/*\n\nCOPY --from=builder --chown=root:root /accumulo-${ACCUMULO_VERSION} /opt/accumulo-${ACCUMULO_VERSION}/\nCOPY ./conf /opt/accumulo-${ACCUMULO_VERSION}/conf\nCOPY --from=builder --chown=root:root /hadoop-${HADOOP_VERSION} /opt/hadoop-${HADOOP_VERSION}/\nCOPY --from=builder --chown=root:root /apache-zookeeper-${ZOOKEEPER_VERSION}-bin /opt/zookeeper-${ZOOKEEPER_VERSION}/\n\nRUN groupadd ${GROUP} && useradd --home-dir /opt/accumulo --gid ${GROUP} --no-create-home --shell /bin/bash ${USER}\n\nRUN cd /opt \\\n\t&& ln -s ./accumulo-${ACCUMULO_VERSION} ./accumulo \\\n\t&& ln -s ./hadoop-${HADOOP_VERSION} ./hadoop \\\n\t&& ln -s ./zookeeper-${ZOOKEEPER_VERSION} ./zookeeper \\\n\t&& mkdir -p -m 755 /var/log/accumulo \\\n\t&& chown ${USER}:${GROUP} /var/log/accumulo\n\nUSER ${USER}\nENV JAVA_HOME /usr/lib/jvm/java-8-openjdk-amd64/jre/\nENV ACCUMULO_HOME /opt/accumulo\nENV ACCUMULO_CONF_DIR ${ACCUMULO_HOME}/conf\nENV ACCUMULO_LOG_DIR /var/log/accumulo\nENV HADOOP_HOME /opt/hadoop\nENV PATH $ACCUMULO_HOME/bin:$PATH\n\nCOPY ./entrypoint.sh /\nENTRYPOINT [\"/entrypoint.sh\", \"accumulo\"]\nCMD [\"help\"]\n"
}