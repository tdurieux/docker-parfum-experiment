{
  "startTime": 1674251365328,
  "endTime": 1674251366339,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 52,
        "lineEnd": 55,
        "columnStart": 7,
        "columnEnd": 14
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Dockerfile to build an image for the FeedBunch web app\nFROM ruby:2.7.2\n\n# Change when FeedBunch latest tag changes\nENV FEEDBUNCH_TAG=master\nARG FEEDBUNCH_URL=https://gitlab.com/amatriain/feedbunch.git\n\n# Env vars with default values that the user can change\nENV PORT=9292\nENV ADMIN_EMAIL=some@email.com\nENV ADMIN_USERNAME=admin\nENV ADMIN_PASSWORD=feedbunch_admin\nENV DEMO_USER_ENABLED=false\nENV SIGNUPS_ENABLED=false\nENV UPLOADS_LOCATION=local\nENV AWS_ACCESS_KEY_ID=aws_access_key_id\nENV AWS_SECRET_ACCESS_KEY=aws_secret_access_key\nENV AWS_REGION=aws_region\nENV AWS_S3_BUCKET=feedbunch-production\nENV SMTP_ADDRESS=smtp.gmail.com\nENV SMTP_PORT=587\nENV SMTP_USER_NAME=gmail_user\nENV SMTP_PASSWORD=gmail_password\nENV SMTP_AUTHENTICATION=plain\nENV EMAIL_LINKS_URL='https://www.feedbunch.com'\nENV REDIS_SIDEKIQ_HOST=localhost\nENV REDIS_SIDEKIQ_PORT=6379\nENV REDIS_CACHE_HOST=localhost\nENV REDIS_CACHE_PORT=6380\nENV POSTGRES_HOST=localhost\nENV POSTGRES_PORT=5432\nENV DB_NAME=feedbunch\nENV DB_USER=feedbunch\nENV DB_PASSWORD=feedbunch\n\n# Env vars to be picked by Rails, not intended to be changed\nENV LANG C.UTF-8\nENV FORCE_SECURE=false\nENV RAILS_ENV=production\nENV FEEDBUNCH_LOG_LEVEL=debug\nENV APP_DIR=/home/feedbunch_webapp/feedbunch/FeedBunch-app\nENV STDOUT_FILE=/dev/stdout\nENV STDERR_FILE=/dev/stderr\nENV RAILS_LOG_TO_STDOUT=true\nENV RAILS_SERVE_STATIC_FILES=true\n\n# HTTP port\nEXPOSE $PORT/tcp\n\n# Install needed packages\nRUN set -eux \\\n    && apt-get update \\\n    && DEBIAN_FRONTEND=noninteractive \\\n        apt-get --no-install-recommends install -y \\\n        git \\\n        nodejs \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Create unprivileged user feedbunch_webapp\nRUN adduser --disabled-login --gecos '' feedbunch_webapp\n\n# FeedBunch installed to the feedbunch_webapp user's home\nWORKDIR /home/feedbunch_webapp\n\n# Get FeedBunch app files from git repo\nRUN git clone $FEEDBUNCH_URL\nWORKDIR $APP_DIR\nRUN git checkout -q $FEEDBUNCH_TAG\n\n# Copy FeedBunch additional files\nCOPY ./config/database.yml.default ./config/database.yml.default\nCOPY ./config/secrets.yml.default ./config/secrets.yml.default\nCOPY start_feedbunch_webapp.sh .\n\n# Create folders where volumes will be mounted, so permissions are preserved\nRUN mkdir $APP_DIR/opml_imports\nRUN mkdir $APP_DIR/opml_exports\n\n# Fix permissions\nRUN chown -R feedbunch_webapp:feedbunch_webapp /home/feedbunch_webapp\nRUN chmod +x start_feedbunch_webapp.sh\n\n# Volume shared with the feedbunch-background container, for local OPML uploads\nVOLUME $APP_DIR/opml_imports\n\n# Volume shared with the feedbunch-background container, for local OPML downloads\nVOLUME $APP_DIR/opml_exports\n\n# Install gems\nUSER feedbunch_webapp\nRUN bundle config --global frozen 1\nRUN bundle config set without 'ci development test'\nRUN bundle install\n\nENTRYPOINT [\"bash\", \"start_feedbunch_webapp.sh\"]\n"
}