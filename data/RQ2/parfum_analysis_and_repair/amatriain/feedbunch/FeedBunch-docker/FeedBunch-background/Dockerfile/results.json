{
  "startTime": 1674217969633,
  "endTime": 1674217970707,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 45,
        "lineEnd": 48,
        "columnStart": 7,
        "columnEnd": 14
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Dockerfile to build an image for the FeedBunch sidekiq app\nFROM ruby:2.7.2\n\n# Change when FeedBunch latest tag changes\nENV FEEDBUNCH_TAG=master\nARG FEEDBUNCH_URL=https://gitlab.com/amatriain/feedbunch.git\n\n# Env vars with default values that the user can change\nENV ADMIN_EMAIL=some@email.com\nENV DEMO_USER_ENABLED=false\nENV SIGNUPS_ENABLED=false\nENV UPLOADS_LOCATION=local\nENV AWS_ACCESS_KEY_ID=aws_access_key_id\nENV AWS_SECRET_ACCESS_KEY=aws_secret_access_key\nENV AWS_REGION=aws_region\nENV AWS_S3_BUCKET=feedbunch-production\nENV SMTP_ADDRESS=smtp.gmail.com\nENV SMTP_PORT=587\nENV SMTP_USER_NAME=gmail_user\nENV SMTP_PASSWORD=gmail_password\nENV SMTP_AUTHENTICATION=plain\nENV EMAIL_LINKS_URL='https://www.feedbunch.com'\nENV REDIS_SIDEKIQ_HOST=localhost\nENV REDIS_SIDEKIQ_PORT=6379\nENV POSTGRES_HOST=localhost\nENV POSTGRES_PORT=5432\nENV DB_NAME=feedbunch\nENV DB_USER=feedbunch\nENV DB_PASSWORD=feedbunch\nENV HEADLESS_BROWSER_HOST=127.0.0.1\nENV HEADLESS_BROWSER_PORT=4444\n\n# Env vars to be picked by Rails, not intended to be changed\nENV LANG C.UTF-8\nENV RAILS_ENV=production\nENV FEEDBUNCH_LOG_LEVEL=debug\nENV APP_DIR=/home/feedbunch_background/feedbunch/FeedBunch-app\nENV STDOUT_FILE=/dev/stdout\nENV STDERR_FILE=/dev/stderr\nENV RAILS_LOG_TO_STDOUT=true\nENV HEADLESS_BROWSER_LOCATION=remote\n\n# Install needed packages\nRUN set -eux \\\n    && apt-get update \\\n    && DEBIAN_FRONTEND=noninteractive \\\n        apt-get --no-install-recommends install -y \\\n        git \\\n        nodejs \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Create unprivileged user feedbunch_background\nRUN adduser --disabled-login --gecos '' feedbunch_background\n\n# FeedBunch installed to the feedbunch_background user's home\nWORKDIR /home/feedbunch_background\n\n# Get FeedBunch app files from git repo\nRUN git clone $FEEDBUNCH_URL\nWORKDIR $APP_DIR\nRUN git checkout -q $FEEDBUNCH_TAG\n\n# Copy FeedBunch additional files\nCOPY ./config/database.yml.default ./config/database.yml.default\nCOPY ./config/secrets.yml.default ./config/secrets.yml.default\nCOPY start_feedbunch_background.sh .\n\n# Create folders where volumes will be mounted, so permissions are preserved\nRUN mkdir $APP_DIR/opml_imports\nRUN mkdir $APP_DIR/opml_exports\n\n# Fix permissions\nRUN chown -R feedbunch_background:feedbunch_background /home/feedbunch_background\nRUN chmod +x start_feedbunch_background.sh\n\n# Volume shared with the feedbunch-webapp container, for local OPML uploads\nVOLUME $APP_DIR/opml_imports\n\n# Volume shared with the feedbunch-webapp container, for local OPML downloads\nVOLUME $APP_DIR/opml_exports\n\n# Volume for files cached by rack-cache\nVOLUME $APP_DIR/rack_cache\n\n# Install gems\nUSER feedbunch_background\nRUN bundle config --global frozen 1\nRUN bundle config set without 'ci development test'\nRUN bundle install\n\nENTRYPOINT [\"bash\", \"start_feedbunch_background.sh\"]\n"
}