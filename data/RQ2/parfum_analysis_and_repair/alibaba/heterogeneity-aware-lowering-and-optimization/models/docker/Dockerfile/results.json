{
  "startTime": 1674215344780,
  "endTime": 1674215346235,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 139,
        "lineEnd": 139,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 140,
        "lineEnd": 140,
        "columnStart": 4,
        "columnEnd": 76
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 141,
        "lineEnd": 141,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 142,
        "lineEnd": 142,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 145,
        "lineEnd": 145,
        "columnStart": 4,
        "columnEnd": 76
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 148,
        "lineEnd": 148,
        "columnStart": 4,
        "columnEnd": 128
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 149,
        "lineEnd": 149,
        "columnStart": 4,
        "columnEnd": 101
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 152,
        "lineEnd": 152,
        "columnStart": 4,
        "columnEnd": 76
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 153,
        "lineEnd": 153,
        "columnStart": 4,
        "columnEnd": 85
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 154,
        "lineEnd": 154,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "curlUseHttpsUrl",
      "position": {
        "lineStart": 139,
        "lineEnd": 139,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "curlUseHttpsUrl",
      "position": {
        "lineStart": 140,
        "lineEnd": 140,
        "columnStart": 4,
        "columnEnd": 76
      }
    },
    {
      "rule": "curlUseHttpsUrl",
      "position": {
        "lineStart": 141,
        "lineEnd": 141,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "curlUseHttpsUrl",
      "position": {
        "lineStart": 145,
        "lineEnd": 145,
        "columnStart": 4,
        "columnEnd": 76
      }
    },
    {
      "rule": "curlUseHttpsUrl",
      "position": {
        "lineStart": 149,
        "lineEnd": 149,
        "columnStart": 4,
        "columnEnd": 101
      }
    },
    {
      "rule": "curlUseHttpsUrl",
      "position": {
        "lineStart": 152,
        "lineEnd": 152,
        "columnStart": 4,
        "columnEnd": 76
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 2,
        "lineEnd": 2,
        "columnStart": 4,
        "columnEnd": 22
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 44,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 70,
        "lineEnd": 70,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 3,
        "lineEnd": 3,
        "columnStart": 18,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 22,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 42,
        "lineEnd": 43,
        "columnStart": 22,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 65,
        "lineEnd": 65,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 126,
        "lineEnd": 126,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 65,
        "lineEnd": 65,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 126,
        "lineEnd": 126,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 3,
        "lineEnd": 3,
        "columnStart": 18,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 22,
        "columnEnd": 45
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 42,
        "lineEnd": 43,
        "columnStart": 22,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 65,
        "lineEnd": 65,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 126,
        "lineEnd": 126,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 4,
        "columnEnd": 19
      }
    },
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 159,
        "lineEnd": 159,
        "columnStart": 4,
        "columnEnd": 16
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 65,
        "lineEnd": 65,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 126,
        "lineEnd": 126,
        "columnStart": 4,
        "columnEnd": 51
      }
    }
  ],
  "repairedDockerfile": "# PyTorch Models\nFROM pytorch/pytorch AS PT\nRUN pip3 install --no-cache-dir scipy\nRUN apt update && apt install --no-install-recommends -y wget imagemagick && rm -rf /var/lib/apt/lists/*;\nCOPY scripts/get_cls_model_from_pytorch.py /\n\nWORKDIR /models/vision/classification/alexnet\nRUN /get_cls_model_from_pytorch.py alexnet\n\nWORKDIR /models/vision/classification/densenet\nRUN /get_cls_model_from_pytorch.py densenet121\n\nWORKDIR /models/vision/classification/googlenet\nRUN /get_cls_model_from_pytorch.py googlenet\n\nWORKDIR /models/vision/classification/inception\nRUN /get_cls_model_from_pytorch.py inception_v3 inception_v3.onnx 299\n\nWORKDIR /models/vision/classification/mobilenet\nRUN /get_cls_model_from_pytorch.py mobilenet_v2\n\nWORKDIR /models/vision/classification/squeezenet\nRUN /get_cls_model_from_pytorch.py squeezenet1_0\nRUN /get_cls_model_from_pytorch.py squeezenet1_1\n\nWORKDIR /models/vision/classification/vgg\nRUN /get_cls_model_from_pytorch.py vgg16\nRUN /get_cls_model_from_pytorch.py vgg19\n\nCOPY scripts/get_unet.py /tmp\nWORKDIR /models/vision/segmentation/unet\nRUN python3 /tmp/get_unet.py\nRUN wget https://github.com/zhixuhao/unet/raw/master/img/0test.png\nRUN convert 0test.png -resize 256x256 test.jpg && rm 0test.png\n\n# HRNet\nFROM pytorch/pytorch:1.8.1-cuda11.1-cudnn8-devel AS HRNET\nSHELL [ \"/bin/bash\", \"-c\"]\nRUN mv /etc/apt/sources.list.d/{cuda,nvidia-ml}.list /tmp/\nRUN apt-get update && apt-get install --no-install-recommends -y curl && \\\n    curl -fsSL https://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/3bf863cc.pub | apt-key add - && \\\n    mv /tmp/{cuda.list,nvidia-ml.list} /etc/apt/sources.list.d/ && rm -rf /var/lib/apt/lists/*;\nRUN apt-get update && apt-get install --no-install-recommends -y git wget libgeos-dev gcc \\\n    libglib2.0-dev libsm6 libxext6 libxrender-dev && rm -rf /var/lib/apt/lists/*;\nRUN pip3 install --no-cache-dir EasyDict==1.7 opencv-python==3.4.8.29 shapely==1.6.4 Cython \\\n    pandas pyyaml json_tricks scikit-image yacs >=0.1.5 \\\n    tensorboardX==1.6 pycocotools gdown\nWORKDIR /tmp\nRUN mkdir -p images annot /models/vision/pose_estimation\nRUN git clone --depth=1 https://github.com/leoxiaobin/deep-high-resolution-net.pytorch\nRUN python3 -c \"import gdown; gdown.download('https://drive.google.com/uc?id=1_wn2ifmoQprBrFvUCDedjPON4Y6jsN-v', '/tmp/pose_hrnet_w32_256x256.pth')\"\nRUN wget 'https://upload-images.jianshu.io/upload_images/1877813-ff9b9c6b0e013006.jpg?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp' \\\n    -O images/005808361.jpg\nRUN cd deep-high-resolution-net.pytorch/lib/nms && \\\n    python3 setup_linux.py build_ext --inplace\nENV PYTHONPATH=/tmp/deep-high-resolution-net.pytorch/lib\nCOPY scripts/hrnet/hrnet_cfg.yaml scripts/hrnet/get_hrnet.py ./\nCOPY scripts/hrnet/test.json annot\nRUN python3 get_hrnet.py --cfg hrnet_cfg.yaml TEST.MODEL_FILE pose_hrnet_w32_256x256.pth\nRUN mv pose_hrnet_w32_256x256.onnx input.in output.in /models/vision/pose_estimation\n\n#YOLOv5\nWORKDIR /tmp\nARG YOLOV5L_URI=https://github.com/ultralytics/yolov5\nARG YOLOv5_VERSION=v6.1\nRUN apt install --no-install-recommends -y mesa-utils libgl1-mesa-glx && rm -rf /var/lib/apt/lists/*;\nRUN git clone ${YOLOV5L_URI}\nWORKDIR yolov5\nRUN git checkout -b tmp 7043872\nRUN pip3 install --no-cache-dir -r requirements.txt# base requirements\nRUN pip3 install --no-cache-dir coremltools >=4.1 onnx >=1.8.1 scikit-learn==0.19.2\nRUN PYTHONPATH=/tmp/yolov5 python3 export.py --include onnx \\\n    --weights ${YOLOV5L_URI}/releases/download/${YOLOv5_VERSION}/yolov5l.pt --img 640 --batch 1\nWORKDIR /models/vision/detection/yolo\nRUN mv /tmp/yolov5/yolov5l.onnx .\n\n# ONNX models\nFROM alpine/git:v2.30.1 AS ONNX\nRUN apk add --no-cache git-lfs\nWORKDIR /tmp\nRUN git clone https://github.com/onnx/models\nWORKDIR /tmp/models\nRUN git checkout -f -b tmp 94abdef\nRUN git-lfs pull -X=\"\" -I=\"caffenet-3.onnx\"\nRUN git-lfs pull -X=\"\" -I=\"yolov3-10.onnx\"\nRUN git-lfs pull -X=\"\" -I=\"inception-v1-9.onnx\"\nRUN git-lfs pull -X=\"\" -I=\"resnet18-v1-7.onnx\"\nRUN git-lfs pull -X=\"\" -I=\"resnet50-v2-7.onnx\"\nRUN git-lfs pull -X=\"\" -I=\"resnet101-v2-7.onnx\"\nRUN git-lfs pull -X=\"\" -I=\"shufflenet-9.onnx\"\nRUN git-lfs pull -X=\"\" -I=\"bertsqad-10.onnx\"\n\nWORKDIR /models/vision/classification/caffenet\nRUN mv /tmp/models/vision/classification/caffenet/model/caffenet-3.onnx .\n\nWORKDIR /models/vision/classification/inception\nRUN mv /tmp/models/vision/classification/inception_and_googlenet/inception_v1/model/inception-v1-9.onnx .\n\nWORKDIR /models/vision/classification/resnet\nRUN mv /tmp/models/vision/classification/resnet/model/resnet50-v2-7.onnx .\nRUN mv /tmp/models/vision/classification/resnet/model/resnet18-v1-7.onnx .\nRUN mv /tmp/models/vision/classification/resnet/model/resnet101-v2-7.onnx .\n\nWORKDIR /models/vision/classification/shufflenet\nRUN mv /tmp/models/vision/classification/shufflenet/model/shufflenet-9.onnx .\n\nWORKDIR /models/vision/detection/yolo\nRUN mv /tmp/models/vision/object_detection_segmentation/yolov3/model/yolov3-10.onnx .\n\nWORKDIR /models/text/comprehension/bert\nRUN mv /tmp/models/text/machine_comprehension/bert-squad/model/bertsquad-10.onnx .\n\nRUN cd /tmp/models && \\\n    git checkout -b yolov4 625eaec && \\\n    git-lfs pull -X=\"\" -I=\"yolov4.onnx\"\n\nWORKDIR /models/vision/detection/yolo\nRUN mv /tmp/models/vision/object_detection_segmentation/yolov4/model/yolov4.onnx .\n\nWORKDIR /tmp\nRUN git clone --depth=1 -b rel-1.8.0 https://github.com/onnx/onnx.git\nRUN mv onnx/onnx/backend/test/data/node /unittests\n\n\n# MNIST Simple TF Model\nFROM tensorflow/tensorflow:1.14.0 AS TF\nRUN apt-get install --no-install-recommends -y wget && rm -rf /var/lib/apt/lists/*;\nWORKDIR mnist_simple\nCOPY scripts/mnist_simple_train.py .\nRUN python mnist_simple_train.py\nWORKDIR /models/vision/classification/mnist_simple\nRUN mv /mnist_simple/mnist_simple.pb .\nRUN wget -qO- https://web.archive.org/web/20160828233817/http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz  | gunzip -c > test_image\nRUN wget -qO- https://web.archive.org/web/20160828233817/http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz | gunzip -c > test_label\n\n# Data\nFROM curlimages/curl:7.76.0 As Data\nRUN mkdir -p /tmp/models/vision/test_images\nWORKDIR /tmp/models/vision/test_images\nRUN curl -f -o plane.jpg https://images.cocodataset.org/test2017/000000030207.jpg\nRUN curl -f -o food.jpg https://images.cocodataset.org/test2017/000000228503.jpg\nRUN curl -f -o sport.jpg https://images.cocodataset.org/test2017/000000133861.jpg\nRUN curl -f -o dog.jpg https://raw.githubusercontent.com/pytorch/hub/master/images/dog.jpg\nRUN mkdir -p /tmp/models/detection\nWORKDIR /tmp/models/detection\nRUN curl -f -o test.jpg https://images.cocodataset.org/test2017/000000133861.jpg\nRUN mkdir -p /tmp/models/vision/classification/caffenet\nWORKDIR /tmp/models/vision/classification/caffenet\nRUN curl -f -o caffenet.prototxt https://raw.githubusercontent.com/BVLC/caffe/master/models/bvlc_reference_caffenet/deploy.prototxt\nRUN curl -f -o caffenet.caffemodel https://dl.caffe.berkeleyvision.org/bvlc_reference_caffenet.caffemodel\nRUN mkdir -p /tmp/models/vision/detection/yolo\nWORKDIR /tmp/models/vision/detection/yolo\nRUN curl -f -o test.jpg https://images.cocodataset.org/test2017/000000133861.jpg\nRUN curl -f -O https://raw.githubusercontent.com/AlexeyAB/darknet/master/data/person.jpg\nRUN curl -f -O https://raw.githubusercontent.com/ultralytics/yolov5/master/data/images/zidane.jpg\n\n\n# Collect all Models & Data\nFROM alpine\nRUN apk add --no-cache tree\nCOPY --from=PT /models /models\nCOPY --from=ONNX /models /models\nCOPY --from=HRNET /models /models\nCOPY --from=TF /models /models\nCOPY --from=DATA /tmp/models /models\nCOPY --from=ONNX /unittests /unittests\nENTRYPOINT [\"tree\", \"/models\"]"
}