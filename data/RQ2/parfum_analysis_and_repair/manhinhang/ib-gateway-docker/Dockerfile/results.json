{
  "startTime": 1674250874239,
  "endTime": 1674250875438,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 5,
        "lineEnd": 16,
        "columnStart": 5,
        "columnEnd": 7
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 5,
        "lineEnd": 16,
        "columnStart": 5,
        "columnEnd": 7
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 33
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 57
      }
    }
  ],
  "repairedDockerfile": "FROM python:3.7-slim\n\n# install dependencies\nRUN apt-get update \\\n  && apt-get upgrade -y \\\n  && apt-get install --no-install-recommends -y wget \\\n  unzip \\\n  xvfb \\\n  libxtst6 \\\n  libxrender1 \\\n  build-essential \\\n  net-tools \\\n  x11-utils \\\n  socat \\\n  expect \\\n  procps \\\n  xterm && rm -rf /var/lib/apt/lists/*;\nRUN apt install --no-install-recommends -y openjdk-17-jre && rm -rf /var/lib/apt/lists/*;\nRUN pip install --no-cache-dir ib_insync==0.9.70 google-cloud-secret-manager==2.11.1\n\n# set environment variables\nENV TWS_INSTALL_LOG=/root/Jts/tws_install.log \\\n    ibcIni=/root/ibc/config.ini \\\n    ibcPath=/opt/ibc \\\n    javaPath=/opt/i4j_jres \\\n    twsPath=/root/Jts \\\n    twsSettingsPath=/root/Jts \\\n    IB_GATEWAY_PING_CLIENT_ID=1 \\\n    ibAccMaxRetryCount=30\n\n# make dirs\nRUN mkdir -p /tmp && mkdir -p ${ibcPath} && mkdir -p ${twsPath}\n\n# download IB TWS\nRUN wget -q -O /tmp/ibgw.sh https://download2.interactivebrokers.com/installers/ibgateway/stable-standalone/ibgateway-stable-standalone-linux-x64.sh\nRUN chmod +x /tmp/ibgw.sh\n\n# download IBC\nRUN wget -q -O /tmp/IBC.zip https://github.com/IbcAlpha/IBC/releases/download/3.13.0/IBCLinux-3.13.0.zip\nRUN unzip /tmp/IBC.zip -d ${ibcPath}\nRUN chmod +x ${ibcPath}/*.sh ${ibcPath}/*/*.sh\n\n# install TWS, write output to file so that we can parse the TWS version number later\nCOPY install_ibgw.exp /tmp/install_ibgw.exp\nRUN chmod +x /tmp/install_ibgw.exp\nRUN /tmp/install_ibgw.exp\n\n# remove downloaded files\nRUN rm /tmp/ibgw.sh /tmp/IBC.zip\n\n# copy IBC/Jts configs\nCOPY ibc/config.ini ${ibcIni}\nCOPY ibc/jts.ini ${twsPath}/jts.ini\n\n# copy cmd script\nWORKDIR /root\nCOPY cmd.sh /root/cmd.sh\nRUN chmod +x /root/cmd.sh\n\n# python script for /root directory\nCOPY src/bootstrap.py /root/bootstrap.py\nRUN chmod +x /root/bootstrap.py\nCOPY src/ib_account.py /root/ib_account.py\nRUN chmod +x /root/ib_account.py\n\n# set display environment variable (must be set after TWS installation)\nENV DISPLAY=:0\nENV GCP_SECRET=False\n\nENV IBGW_PORT 4002\nENV IBGW_WATCHDOG_CONNECT_TIMEOUT 30\nENV IBGW_WATCHDOG_APP_STARTUP_TIME 30\nENV IBGW_WATCHDOG_APP_TIMEOUT 30\nENV IBGW_WATCHDOG_RETRY_DELAY 2\nENV IBGW_WATCHDOG_PROBE_TIMEOUT 4\n\nEXPOSE $IBGW_PORT\n\nENTRYPOINT [ \"sh\", \"/root/cmd.sh\" ]\n"
}