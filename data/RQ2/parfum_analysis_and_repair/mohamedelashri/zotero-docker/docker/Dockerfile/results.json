{
  "startTime": 1674217795156,
  "endTime": 1674217796442,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 132,
        "columnEnd": 171
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 68,
        "columnEnd": 96
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 80
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 126
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 195
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 166
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 95
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 80
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 126
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 195
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 166
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 95
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 80
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 126
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 195
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 166
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 95
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 104
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 150
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 219
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 95
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 190
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 93
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 119
      }
    }
  ],
  "repairedDockerfile": "# Use the official Docker Hub Ubuntu 18.04 base image\nFROM ubuntu:20.04\n\n# replace shell with bash so we can source files\nRUN rm /bin/sh && ln -s /bin/bash /bin/sh\n\n# Update the base image\nRUN DEBIAN_FRONTEND=noninteractive apt-get update && apt-get -y upgrade && apt-get -y dist-upgrade\n\n# Setup PHP5\nRUN DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install software-properties-common && rm -rf /var/lib/apt/lists/*;\nRUN DEBIAN_FRONTEND=noninteractive add-apt-repository ppa:ondrej/php\nRUN DEBIAN_FRONTEND=noninteractive apt-get update\nRUN DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install apache2 libapache2-mod-php7.2 sudo rsyslog wget mysql-client curl nodejs && rm -rf /var/lib/apt/lists/*;\nRUN DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install php7.2-cli php7.2-xml php7.2-mysql php7.2-pgsql php7.2-json php7.2-curl php7.2-mbstring php7.2-intl php7.2-redis php7.2-dev php-pear composer && rm -rf /var/lib/apt/lists/*;\n\nRUN sed -i 's/memory_limit = 128M/memory_limit = 1G/g' /etc/php/7.2/apache2/php.ini\nRUN sed -i 's/max_execution_time = 30/max_execution_time = 300/g' /etc/php/7.2/apache2/php.ini\nRUN sed -i 's/short_open_tag = Off/short_open_tag = On/g' /etc/php/7.2/apache2/php.ini\nRUN sed -i 's/short_open_tag = Off/short_open_tag = On/g' /etc/php/7.2/cli/php.ini\nRUN sed -i 's/display_errors = On/display_errors = Off/g' /etc/php/7.2/apache2/php.ini\nRUN sed -i 's/error_reporting = E_ALL \\& ~E_DEPRECATED \\& ~E_STRICT/error_reporting = E_ALL \\& ~E_NOTICE \\& ~E_STRICT \\& ~E_DEPRECATED/g' /etc/php/7.2/apache2/php.ini\n\n# Add zip toolbox\nRUN DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install zip unzip php-zip && rm -rf /var/lib/apt/lists/*;\n\n# Setup igbinary\nRUN DEBIAN_FRONTEND=noninteractive pecl install igbinary\nRUN echo \"extension=igbinary.so\" > /etc/php/7.2/mods-available/igbinary.ini\n#RUN ln -s /etc/php/7.2/mods-available/igbinary.ini /etc/php/7.2/cli/conf.d/20-igbinary.ini\n#RUN ln -s /etc/php/7.2/mods-available/igbinary.ini /etc/php/7.2/apache2/conf.d/20-igbinary.ini\n\n# Setup Memcached\nRUN DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install libmemcached11 libmemcachedutil2 build-essential libmemcached-dev libz-dev libxml2-dev zlib1g-dev libicu-dev g++ && rm -rf /var/lib/apt/lists/*;\nRUN DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install apt-utils && rm -rf /var/lib/apt/lists/*;\nRUN DEBIAN_FRONTEND=noninteractive apt-get -y upgrade\nRUN DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install pkg-config re2c && rm -rf /var/lib/apt/lists/*;\nRUN DEBIAN_FRONTEND=noninteractive pecl channel-update pecl.php.net\nRUN DEBIAN_FRONTEND=noninteractive pecl download memcached-3.0.4 && tar xvzf memcached-3.0.4.tgz && cd memcached-3.0.4 && phpize && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --enable-memcached-igbinary && make && make install && rm memcached-3.0.4.tgz\nRUN echo \"extension=memcached.so\" > /etc/php/7.2/mods-available/memcached.ini\nRUN ln -s /etc/php/7.2/mods-available/memcached.ini /etc/php/7.2/cli/conf.d/20-memcached.ini\nRUN ln -s /etc/php/7.2/mods-available/memcached.ini /etc/php/7.2/apache2/conf.d/20-memcached.ini\n\n# HTTP_Request2\nRUN DEBIAN_FRONTEND=noninteractive pear install HTTP_Request2\n\n# Setup awscli\nRUN DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends -y install python3 python3-pip rsync git wget rinetd && rm -rf /var/lib/apt/lists/*;\nRUN DEBIAN_FRONTEND=noninteractive pip --no-cache-dir install awscli\n\n# Install NodeJS, Zotero web-library requires: node: ^8.16.0 (https://gist.github.com/remarkablemark/aacf14c29b3f01d6900d13137b21db3a#file-dockerfile-L5)\nRUN mkdir -p /usr/local/nvm\nENV NVM_DIR /usr/local/nvm\nENV NODE_VERSION 10.22.1\nRUN DEBIAN_FRONTEND=noninteractive wget -qO- https://raw.githubusercontent.com/nvm-sh/nvm/v0.36.0/install.sh | bash\nRUN source $NVM_DIR/nvm.sh \\\n    && nvm install $NODE_VERSION \\\n    && nvm alias default $NODE_VERSION \\\n    && nvm use default\n# add node and npm to path so the commands are available\nENV NODE_PATH $NVM_DIR/v$NODE_VERSION/lib/node_modules\nENV PATH $NVM_DIR/versions/node/v$NODE_VERSION/bin:$PATH\n\n# Setup Apache2\nRUN a2enmod rewrite\nRUN a2enmod headers\n\n# Enable the new virtualhost\nCOPY zotero.conf /etc/apache2/sites-available/\nRUN a2dissite 000-default\nRUN a2ensite zotero\n\n# Override gzip configuration\nCOPY gzip.conf /etc/apache2/conf-available/\nRUN a2enconf gzip\n\n# AWS local credentials\nRUN mkdir ~/.aws  && bash -c 'echo -e \"[default]\\nregion = us-east-1\" > ~/.aws/config' && bash -c 'echo -e \"[default]\\naws_access_key_id = zotero\\naws_secret_access_key = zoterodocker\" > ~/.aws/credentials'\n\n# Chown log directory\nRUN chown 33:33 /var/log/apache2\n\n# Rinetd\nRUN echo \"0.0.0.0\t\t8082\t\tminio\t\t9000\" >> /etc/rinetd.conf\n\n# Expose and entrypoint\nCOPY entrypoint.sh /\nRUN chmod +x /entrypoint.sh\nVOLUME /var/www/zotero\nEXPOSE 80/TCP\nEXPOSE 81/TCP\nEXPOSE 82/TCP\nEXPOSE 8001/TCP\n\nENTRYPOINT [\"/entrypoint.sh\"]\n\n"
}