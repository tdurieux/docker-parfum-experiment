{
  "startTime": 1674220930090,
  "endTime": 1674220931787,
  "originalSmells": [
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 80,
        "lineEnd": 80,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 5,
        "lineEnd": 32,
        "columnStart": 4,
        "columnEnd": 12
      }
    },
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 33,
        "columnEnd": 54
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM alpine:3.6 as kernel-build\n#linuxkit/alpine:f2f4db272c910d136380781a97e475013fabda8b AS kernel-build\n\nRUN apk update\n\nRUN apk add --no-cache \\\n    argp-standalone \\\n    automake \\\n    bash \\\n    bc \\\n    binutils-dev \\\n    bison \\\n    build-base \\\n    curl \\\n    diffutils \\\n    flex \\\n    git \\\n    gmp-dev \\\n    gnupg \\\n    installkernel \\\n    kmod \\\n    libelf-dev \\\n    libressl-dev \\\n    linux-headers \\\n    ncurses-dev \\\n    python2 \\\n    findutils \\\n    sed \\\n    squashfs-tools \\\n    tar \\\n    xz \\\n    xz-dev \\\n    zlib-dev\n\n# libunwind-dev pkg is missed from arm64 now, below statement will be removed if the pkg is available.\nRUN [ $(uname -m) == x86_64 ] && apk add --no-cache libunwind-dev || true\n\nENV KERNEL_VERSION_aarch64 4.19.5\nENV KERNEL_SERIES_aarch64 4.19.x\n\nENV KERNEL_VERSION_x86_64 4.9.51\nENV KERNEL_SERIES_x86_64 4.9.x\n\nENV KERNEL_SOURCE=https://www.kernel.org/pub/linux/kernel/v4.x/linux-\\${KERNEL_VERSION}.tar.xz\nENV KERNEL_SHA256_SUMS=https://www.kernel.org/pub/linux/kernel/v4.x/sha256sums.asc\nENV KERNEL_PGP2_SIGN=https://www.kernel.org/pub/linux/kernel/v4.x/linux-\\${KERNEL_VERSION}.tar.sign\n\nENV IXGBE_URL=https://sourceforge.net/projects/e1000/files/ixgbe%20stable/\nENV IXGBE_VERSION=5.3.7\n\n# The following hack allows us to build different version\nSHELL [\"/bin/sh\", \"-c\", \"export KERNEL_VERSION=$(eval echo \\\\$KERNEL_VERSION_$(uname -m)) ; export KERNEL_SERIES=$(eval echo \\\\$KERNEL_SERIES_$(uname -m)) ; eval KERNEL_SOURCE=$KERNEL_SOURCE ; eval export KERNEL_PGP2_SIGN=$KERNEL_PGP2_SIGN ; /bin/sh -c \\\"$1\\\"\", \"-\" ]\n\n# We copy the entire directory. This copies some unneeded files, but\n# allows us to check for the existence /patches-${KERNEL_SERIES} to\n# build kernels without patches.\nCOPY / /\n\n# Download and verify kernel\n# PGP keys: 589DA6B1 (greg@kroah.com) & 6092693E (autosigner@kernel.org) & 00411886 (torvalds@linux-foundation.org)\nRUN curl -fsSLO ${KERNEL_SHA256_SUMS} && \\\n    gpg2 -q --import keys.asc && \\\n    gpg2 --verify sha256sums.asc && \\\n    KERNEL_SHA256=$(grep linux-${KERNEL_VERSION}.tar.xz sha256sums.asc | cut -d ' ' -f 1) && \\\n    [ -f linux-${KERNEL_VERSION}.tar.xz ] || curl -fsSLO ${KERNEL_SOURCE} && \\\n    echo \"${KERNEL_SHA256}  linux-${KERNEL_VERSION}.tar.xz\" | sha256sum -c - && \\\n    xz -d linux-${KERNEL_VERSION}.tar.xz && \\\n    curl -fsSLO ${KERNEL_PGP2_SIGN} && \\\n    gpg2 --verify linux-${KERNEL_VERSION}.tar.sign linux-${KERNEL_VERSION}.tar && \\\n    cat linux-${KERNEL_VERSION}.tar | tar --absolute-names -x && mv /linux-${KERNEL_VERSION} /linux\n\n# Apply local patches\nWORKDIR /linux\nRUN set -e && for patch in /patches-${KERNEL_SERIES}/*.patch; do \\\n        echo \"Applying $patch\"; \\\n        patch -p1 < \"$patch\"; \\\n    done\n\n# FIXME: for now, make sure that Intel ixgbe drivers are taken out of tree\n#        Once we upgrade to a newer kernel we should revisit this\nRUN tar -C /tmp -xzvf /ixgbe-${IXGBE_VERSION}.tgz && \\\n    rm -rf /linux/drivers/net/ethernet/intel/ixgbe && \\\n    cp -r /tmp/ixgbe-${IXGBE_VERSION}/src /linux/drivers/net/ethernet/intel/ixgbe && rm /ixgbe-${IXGBE_VERSION}.tgz\n\n# Kernel config\nRUN mkdir /out\n\nRUN case $(uname -m) in \\\n    x86_64) \\\n        KERNEL_DEF_CONF=/linux/arch/x86/configs/x86_64_defconfig; \\\n        ;; \\\n    aarch64) \\\n        KERNEL_DEF_CONF=/linux/arch/arm64/configs/defconfig; \\\n        ;; \\\n    esac  && \\\n    cp /kernel_config-${KERNEL_SERIES}-$(uname -m) ${KERNEL_DEF_CONF}; \\\n    if [ -n \"${EXTRA}\" ]; then \\\n        sed -i \"s/CONFIG_LOCALVERSION=\\\"-linuxkit\\\"/CONFIG_LOCALVERSION=\\\"-linuxkit${EXTRA}\\\"/\" ${KERNEL_DEF_CONF}; \\\n        if [ \"${EXTRA}\" = \"-dbg\" ]; then \\\n            sed -i 's/CONFIG_PANIC_ON_OOPS=y/# CONFIG_PANIC_ON_OOPS is not set/' ${KERNEL_DEF_CONF}; \\\n        fi && \\\n        cat /kernel_config${EXTRA} >> ${KERNEL_DEF_CONF}; \\\n    fi && \\\n    make defconfig && \\\n    make oldconfig && \\\n    if [ -z \"${EXTRA}\" ]; then diff .config ${KERNEL_DEF_CONF}; fi\n\n# Kernel\nRUN make -j \"$(getconf _NPROCESSORS_ONLN)\" KCFLAGS=\"-fno-pie\" && \\\n    case $(uname -m) in \\\n    x86_64) \\\n        cp arch/x86_64/boot/bzImage /out/kernel; \\\n        ;; \\\n    aarch64) \\\n        cp arch/arm64/boot/Image.gz /out/kernel; \\\n        ;; \\\n    esac && \\\n    cp System.map /out && \\\n    ([ \"${EXTRA}\" = \"-dbg\" ] && cp vmlinux /out || true)\n\n# Modules\nRUN make INSTALL_MOD_PATH=/tmp/kernel-modules modules_install && \\\n    ( DVER=$(basename $(find /tmp/kernel-modules/lib/modules/ -mindepth 1 -maxdepth 1)) && \\\n      cd /tmp/kernel-modules/lib/modules/$DVER && \\\n      rm build source && \\\n      ln -s /usr/src/linux-headers-$DVER build ) && \\\n    ( cd /tmp/kernel-modules && tar cf /out/kernel.tar lib )\n\n# Headers (userspace API)\nRUN mkdir -p /tmp/kernel-headers/usr && \\\n    make INSTALL_HDR_PATH=/tmp/kernel-headers/usr headers_install && \\\n    ( cd /tmp/kernel-headers && tar cf /out/kernel-headers.tar usr )\n\n# Headers (kernel development)\nRUN DVER=$(basename $(find /tmp/kernel-modules/lib/modules/ -mindepth 1 -maxdepth 1)) && \\\n    dir=/tmp/usr/src/linux-headers-$DVER && \\\n    mkdir -p $dir && \\\n    cp /linux/.config $dir && \\\n    cp /linux/Module.symvers $dir && \\\n    find . -path './include/*' -prune -o \\\n           -path './arch/*/include' -prune -o \\\n           -path './scripts/*' -prune -o \\\n           -type f \\( -name 'Makefile*' -o -name 'Kconfig*' -o -name 'Kbuild*' -o \\\n                      -name '*.lds' -o -name '*.pl' -o -name '*.sh' \\) | \\\n         tar cf - -T - | (cd $dir; tar xf -) && \\\n    ( cd /tmp && tar cf /out/kernel-dev.tar usr/src )\n\nRUN printf \"KERNEL_SOURCE=${KERNEL_SOURCE}\\n\" > /out/kernel-source-info\n\n# perf (Don't compile for 4.4.x, it's broken and tedious to fix)\nRUN if [ \"${KERNEL_SERIES}\" != \"4.4.x\" -a $(uname -m) != aarch64 ]; then \\\n       mkdir -p /build/perf && \\\n       make -C tools/perf LDFLAGS=-static O=/build/perf && \\\n       strip /build/perf/perf && \\\n       cp /build/perf/perf /out; \\\n     fi\n\nFROM scratch\nENTRYPOINT []\nCMD []\nWORKDIR /\nCOPY --from=kernel-build /out/* /\n"
}