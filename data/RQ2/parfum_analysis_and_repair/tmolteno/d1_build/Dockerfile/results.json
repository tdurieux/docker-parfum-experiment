{
  "startTime": 1674249783521,
  "endTime": 1674249785118,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 4,
        "lineEnd": 4,
        "columnStart": 22,
        "columnEnd": 261
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 75,
        "lineEnd": 75,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 169,
        "lineEnd": 169,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 170,
        "lineEnd": 170,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 171,
        "lineEnd": 171,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 225,
        "lineEnd": 225,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 239,
        "lineEnd": 239,
        "columnStart": 4,
        "columnEnd": 76
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 75,
        "lineEnd": 75,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 169,
        "lineEnd": 169,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 170,
        "lineEnd": 170,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 171,
        "lineEnd": 171,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 225,
        "lineEnd": 225,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 239,
        "lineEnd": 239,
        "columnStart": 4,
        "columnEnd": 76
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 4,
        "lineEnd": 4,
        "columnStart": 22,
        "columnEnd": 261
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 75,
        "lineEnd": 75,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 169,
        "lineEnd": 169,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 170,
        "lineEnd": 170,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 171,
        "lineEnd": 171,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 225,
        "lineEnd": 225,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 239,
        "lineEnd": 239,
        "columnStart": 4,
        "columnEnd": 76
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 4,
        "columnEnd": 90
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 75,
        "lineEnd": 75,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 169,
        "lineEnd": 169,
        "columnStart": 4,
        "columnEnd": 118
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 170,
        "lineEnd": 170,
        "columnStart": 4,
        "columnEnd": 75
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 171,
        "lineEnd": 171,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 225,
        "lineEnd": 225,
        "columnStart": 4,
        "columnEnd": 60
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 239,
        "lineEnd": 239,
        "columnStart": 4,
        "columnEnd": 100
      }
    }
  ],
  "repairedDockerfile": "FROM debian:bullseye as builder\nMAINTAINER Tim Molteno \"tim@molteno.net\"\nARG DEBIAN_FRONTEND=noninteractive\n\nRUN apt-get update && apt-get install --no-install-recommends -y autoconf automake autotools-dev curl python3 libmpc-dev libmpfr-dev libgmp-dev gawk build-essential bison flex texinfo gperf libtool patchutils bc zlib1g-dev libexpat-dev swig libssl-dev python3-distutils python3-dev git && rm -rf /var/lib/apt/lists/*;\n\nRUN apt-get install --no-install-recommends -y gcc-riscv64-linux-gnu g++-riscv64-linux-gnu && rm -rf /var/lib/apt/lists/*;\nENV CROSS=\"CROSS_COMPILE=riscv64-linux-gnu-\"\nRUN riscv64-linux-gnu-gcc --version | grep gcc | cut -d')' -f2\n# WORKDIR /build\n# ARG GNU_TOOLS_TAG\n# RUN git config --global advice.detachedHead false\n# RUN git clone --recursive --depth 1 --branch ${GNU_TOOLS_TAG} https://github.com/riscv/riscv-gnu-toolchain\n# WORKDIR /build/riscv-gnu-toolchain\n# RUN git checkout ${GNU_TOOLS_TAG}\n# RUN ./configure --prefix=/opt/riscv64-unknown-linux-gnu --with-arch=rv64gc --with-abi=lp64d\n# RUN make linux -j $(nproc)\n# ENV PATH=\"/opt/riscv64-unknown-linux-gnu/bin:$PATH\"\n\n# ARG CROSS=CROSS_COMPILE=/build/riscv64-unknown-linux-gnu/bin/riscv64-unknown-linux-gnu-\n# ENV CROSS=CROSS_COMPILE=riscv64-unknown-linux-gnu-\n\n# Clean up\n# WORKDIR /build\n# RUN rm -rf riscv-gnu-toolchain\n\n\n\n############################################################################################\n#\n# Build a BSP boot0 SPL\n#\nFROM builder as build_boot0\nRUN echo $CROSS\nWORKDIR /build\nRUN git clone           --branch mainline https://github.com/smaeul/sun20i_d1_spl\nWORKDIR /build/sun20i_d1_spl\n# RUN git checkout 0ad88bfdb723b1ac74cca96122918f885a4781ac\nRUN echo make $CROSS p=sun20iw1p1 mmc\nRUN make $CROSS p=sun20iw1p1 mmc\n# The file resides in /build/sun20i_d1_spl/nboot/boot0_sdcard_sun20iw1p1.bin\n\n\n\n############################################################################################\n#\n# Build opensbi\n#\nFROM builder as build_opensbi\nARG OPENSBI_TAG\nWORKDIR /build\nRUN git clone --depth 1 --branch ${OPENSBI_TAG}  https://github.com/smaeul/opensbi\nWORKDIR /build/opensbi\nRUN make $CROSS PLATFORM=generic FW_PIC=y FW_OPTIONS=0x2\n# The binary is located here: /build/opensbi/build/platform/generic/firmware/fw_dynamic.bin\n\n\n############################################################################################\n#\n# Now build the Linux kernel\n#\nFROM builder as build_kernel\nARG KERNEL_TAG\nRUN apt-get install --no-install-recommends -y cpio && rm -rf /var/lib/apt/lists/*; # Required for kernel build\nWORKDIR /build\nRUN git clone --depth 1 --branch ${KERNEL_TAG} https://github.com/smaeul/linux\nWORKDIR /build/linux\n#RUN git checkout riscv/d1-wip\n#RUN git checkout d1-wip-v5.18-rc4\nCOPY kernel/update_kernel_config.sh .\nRUN ./update_kernel_config.sh nezha_defconfig\nWORKDIR /build\nRUN make ARCH=riscv -C linux O=../linux-build nezha_defconfig\nRUN make -j $(nproc) -C linux-build ARCH=riscv $CROSS V=0\n# Files reside in /build/linux-build/arch/riscv/boot/Image.gz\nRUN apt-get install --no-install-recommends -y kmod && rm -rf /var/lib/apt/lists/*;\n# RUN make -j $(nproc) -C linux-build ARCH=riscv $CROSS INSTALL_MOD_PATH=/build/modules modules_install\n\n\n\n#\n# Build wifi modules\n#\nWORKDIR /build\nRUN git clone --depth 1 https://github.com/lwfinger/rtl8723ds.git\nWORKDIR /build/rtl8723ds\nRUN make -j $(nproc) ARCH=riscv $CROSS KSRC=../linux-build modules\nRUN ls -l\n# Module resides in /build/rtl8723ds/8723ds.ko\n\nWORKDIR /build\nCOPY kernel/xradio/ ./xradio/\nWORKDIR /build/xradio\nRUN make ARCH=riscv $CROSS -C /build/linux-build M=$PWD modules\nRUN ls -l\n# Module resides in /build/xr829/xr829.ko\n\n\n\n\n############################################################################################\n#\n# Build u-boot\n#\nFROM builder as build_uboot\nARG UBOOT_TAG\nARG BOARD\nRUN apt-get install --no-install-recommends -y python3-setuptools git && rm -rf /var/lib/apt/lists/*;\nWORKDIR /build\nRUN git clone --depth 1 --branch ${UBOOT_TAG}  https://github.com/smaeul/u-boot.git\nWORKDIR /build/u-boot\n\n# Make sure we update the device tree and add the overlays\nCOPY kernel/update_uboot_config.sh .\nCOPY config/ov_lichee_rv_mini_lcd.dts ./arch/riscv/dts/ov_lichee_rv_mini_lcd.dts\nRUN sed -i '3s/^/dtb-$(CONFIG_TARGET_SUNXI) += ov_lichee_rv_mini_lcd.dtb\\n/' ./arch/riscv/dts/Makefile\nRUN cat ./arch/riscv/dts/Makefile\n\nRUN if [ \"$BOARD\"  = \"lichee_rv_86\" ] ; then \\\n      echo \"Building for the RV_86_Panel\"; \\\n      ./update_uboot_config.sh lichee_rv_86_panel_defconfig; \\\n      make $CROSS lichee_rv_86_panel_defconfig; \\\n    elif [ \"$BOARD\"  = \"lichee_rv_dock\" ] ; then \\\n      echo \"Building for Lichee RV Dock\"; \\\n      ./update_uboot_config.sh lichee_rv_defconfig; \\\n      make $CROSS lichee_rv_defconfig; \\\n    else \\\n      echo \"ERROR: unknown board\"; \\\n    fi\nRUN make -j $(nproc) $CROSS all V=1\nRUN ls -l arch/riscv/dts/\n# The binary is located here: u-boot/arch/riscv/dts/sun20i-d1-lichee-rv-dock.dtb\n# The binary is located here: u-boot/arch/riscv/dts/sun20i-d1-lichee-rv-86-panel.dtb\n\n#\n# Generate u-boot TOC\n#\nWORKDIR /build\nCOPY --from=build_opensbi /build/opensbi/build/platform/generic/firmware/fw_dynamic.bin ./\nCOPY config/toc1_${BOARD}.cfg .\nRUN ls -l\nRUN ./u-boot/tools/mkimage -A riscv -T sunxi_toc1 -d toc1_${BOARD}.cfg u-boot.toc1\n# The u-boot toc is here: u-boot.toc1\n#\n# Create a boot script...\n#\nCOPY config/bootscr.txt .\nRUN ./u-boot/tools/mkimage -T script -C none -O linux -A riscv -d bootscr.txt boot.scr\n# The boot script is here: boot.scr\n\n#\n# Try device tree FIT format\n#\n# RUN apt-get install -y device-tree-compiler\nCOPY --from=build_kernel /build/linux-build/ ./linux-build/\nCOPY config/${BOARD}_boot.its .\nRUN PATH=/build/linux-build/scripts/dtc:$PATH ./u-boot/tools/mkimage -f ${BOARD}_boot.its boot.scr\n# RUN ./u-boot/tools/mkimage -f lichee_rv_boot.itb boot.scr\n\n\n\n\n############################################################################################\n#\n#   Build the root filesystem\n#\nFROM builder as build_rootfs\nARG BOARD\n\nRUN apt-get install --no-install-recommends -y mmdebstrap qemu-user-static binfmt-support debian-ports-archive-keyring && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends -y multistrap systemd-container && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends -y kmod && rm -rf /var/lib/apt/lists/*;\n\nWORKDIR /build\nCOPY rootfs/multistrap_$BOARD.conf multistrap.conf\n\nRUN multistrap -f multistrap.conf\n\n# Now install the kernel modules into the rootfs\nWORKDIR /build\nCOPY --from=build_kernel /build/linux-build/ ./linux-build/\nCOPY --from=build_kernel /build/linux/ ./linux/\nCOPY --from=build_kernel /build/rtl8723ds/8723ds.ko .\nCOPY --from=build_kernel /build/xradio/xradio_wlan.ko .\n\nWORKDIR /build/linux-build\nRUN make ARCH=riscv INSTALL_MOD_PATH=/port/rv64-port modules_install\n\n\nRUN ls /port/rv64-port/lib/modules/ > /kernel_ver\nRUN echo \"export MODDIR=$(ls /port/rv64-port/lib/modules/)\" > /moddef\nRUN ls /port/rv64-port/lib/modules/\nRUN . /moddef; echo \"Creating wireless module in ${MODDIR}\"\nRUN . /moddef; install -v -D -p -m 644 /build/8723ds.ko /port/rv64-port/lib/modules/${MODDIR}/kernel/drivers/net/wireless/8723ds.ko\nRUN . /moddef; install -v -D -p -m 644 /build/xradio_wlan.ko /port/rv64-port/lib/modules/${MODDIR}/kernel/drivers/net/wireless/xradio_wlan.ko\n\n\n\nRUN . /moddef; rm /port/rv64-port/lib/modules/${MODDIR}/build\nRUN . /moddef; rm /port/rv64-port/lib/modules/${MODDIR}/source\n\nRUN . /moddef; depmod -a -b /port/rv64-port \"${MODDIR}\"\nRUN echo '8723ds' >> /port/rv64-port/etc/modules\nRUN echo 'xradio_wlan' >> /port/rv64-port/etc/modules\n\n# This may not be needed as it should be done by the networking setup.\n# RUN cp /etc/resolv.conf /port/rv64-port/etc/resolv.conf\n\n\n\n############################################################################################\n#\n#   Now Build the disk image\n#\nFROM builder as build_image\nARG KERNEL_TAG\nARG GNU_TOOLS_TAG\nARG DISK_MB\nARG BOARD\n\nENV KERNEL_TAG=$KERNEL_TAG\nENV GNU_TOOLS_TAG=$GNU_TOOLS_TAG\nENV DISK_MB=$DISK_MB\nENV BOARD=$BOARD\n\nRUN apt-get install --no-install-recommends -y kpartx parted && rm -rf /var/lib/apt/lists/*;\n\nWORKDIR /builder\nCOPY --from=build_rootfs /kernel_ver ./kernel_ver\nCOPY --from=build_rootfs /port/rv64-port/ ./rv64-port/\n\nCOPY --from=build_kernel /build/linux-build/arch/riscv/boot/Image.gz .\nCOPY --from=build_kernel /build/linux/arch/riscv/configs/nezha_defconfig .\n\nCOPY --from=build_boot0 /build/sun20i_d1_spl/nboot/boot0_sdcard_sun20iw1p1.bin .\nCOPY --from=build_uboot /build/u-boot.toc1 .\nCOPY --from=build_uboot /build/boot.scr .\n\nRUN ls -l\nRUN apt-get install --no-install-recommends -y kpartx openssl fdisk dosfstools e2fsprogs kmod parted && rm -rf /var/lib/apt/lists/*;\n\nCOPY rootfs/setup_rootfs.sh ./rv64-port/setup_rootfs.sh\n\nCOPY scripts/build.sh .\nCOPY scripts/create_image.sh .\nCMD /builder/build.sh\n"
}