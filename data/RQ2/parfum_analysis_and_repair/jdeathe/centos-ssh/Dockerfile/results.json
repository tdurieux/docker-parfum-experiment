{
  "startTime": 1674252000567,
  "endTime": 1674252001425,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 18,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 25,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 38
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM centos:7.6.1810\n\nARG RELEASE_VERSION=\"2.6.1\"\n\n# ------------------------------------------------------------------------------\n# - Import the RPM GPG keys for repositories\n# - Base install of required packages\n# - Install supervisord (used to run more than a single process)\n# - Install supervisor-stdout to allow output of services started by\n#  supervisord to be easily inspected with \"docker logs\".\n# ------------------------------------------------------------------------------\nRUN rpm --rebuilddb \\\n\t&& rpm --import \\\n\t\thttp://mirror.centos.org/centos/RPM-GPG-KEY-CentOS-7 \\\n\t&& rpm --import \\\n\t\thttps://dl.fedoraproject.org/pub/epel/RPM-GPG-KEY-EPEL-7 \\\n\t&& rpm --import \\\n\t\thttps://dl.iuscommunity.org/pub/ius/IUS-COMMUNITY-GPG-KEY \\\n\t&& yum -y install \\\n\t\t\t--setopt=tsflags=nodocs \\\n\t\t\t--disableplugin=fastestmirror \\\n\t\tcentos-release-scl \\\n\t\tcentos-release-scl-rh \\\n\t\tepel-release \\\n\t\thttps://centos7.iuscommunity.org/ius-release.rpm \\\n\t&& yum -y install \\\n\t\t\t--setopt=tsflags=nodocs \\\n\t\t\t--disableplugin=fastestmirror \\\n\t\tinotify-tools-3.14-8.el7 \\\n\t\topenssh-clients-7.4p1-21.el7 \\\n\t\topenssh-server-7.4p1-21.el7 \\\n\t\topenssl-1.0.2k-19.el7 \\\n\t\tpython-setuptools-0.9.8-7.el7 \\\n\t\tsudo-1.8.23-4.el7 \\\n\t\tyum-plugin-versionlock-1.1.31-52.el7 \\\n\t&& yum versionlock add \\\n\t\tinotify-tools \\\n\t\topenssh \\\n\t\topenssh-server \\\n\t\topenssh-clients \\\n\t\tpython-setuptools \\\n\t\tsudo \\\n\t\tyum-plugin-versionlock \\\n\t&& yum clean all \\\n\t&& easy_install \\\n\t\t'supervisor == 4.0.4' \\\n\t\t'supervisor-stdout == 0.1.1' \\\n\t&& mkdir -p \\\n\t\t/var/log/supervisor/ \\\n\t&& rm -rf /etc/ld.so.cache \\\n\t&& rm -rf /sbin/sln \\\n\t&& rm -rf /usr/{{lib,share}/locale,share/{man,doc,info,cracklib,i18n},{lib,lib64}/gconv,bin/localedef,sbin/build-locale-archive} \\\n\t&& rm -rf /{root,tmp,var/cache/{ldconfig,yum}}/* \\\n\t&& > /etc/sysconfig/i18n && rm -rf /var/cache/yum\n\n# ------------------------------------------------------------------------------\n# Copy files into place\n# ------------------------------------------------------------------------------\nADD src /\n\n# ------------------------------------------------------------------------------\n# Provisioning\n# - UTC Timezone\n# - Networking\n# - Configure SSH defaults for non-root public key authentication\n# - Enable the wheel sudoers group\n# - Replace placeholders with values in systemd service unit template\n# - Set permissions\n# ------------------------------------------------------------------------------\nRUN ln -sf \\\n\t\t/usr/share/zoneinfo/UTC \\\n\t\t/etc/localtime \\\n\t&& echo \"NETWORKING=yes\" \\\n\t\t> /etc/sysconfig/network \\\n\t&& sed -i \\\n\t\t-e 's~^PasswordAuthentication yes~PasswordAuthentication no~g' \\\n\t\t-e 's~^#PermitRootLogin yes~PermitRootLogin no~g' \\\n\t\t-e 's~^#UseDNS yes~UseDNS no~g' \\\n\t\t-e 's~^\\(.*\\)/usr/libexec/openssh/sftp-server$~\\1internal-sftp~g' \\\n\t\t/etc/ssh/sshd_config \\\n\t&& sed -i \\\n\t\t-e 's~^# %wheel\\tALL=(ALL)\\tALL~%wheel\\tALL=(ALL) ALL~g' \\\n\t\t-e 's~\\(.*\\) requiretty$~#\\1requiretty~' \\\n\t\t/etc/sudoers \\\n\t&& sed -i \\\n\t\t-e \"s~{{RELEASE_VERSION}}~${RELEASE_VERSION}~g\" \\\n\t\t/etc/systemd/system/centos-ssh@.service \\\n\t&& chmod 644 \\\n\t\t/etc/{supervisord.conf,supervisord.d/{20-sshd-bootstrap,50-sshd-wrapper}.conf} \\\n\t&& chmod 700 \\\n\t\t/usr/{bin/healthcheck,sbin/{scmi,sshd-{bootstrap,wrapper},system-{timezone,timezone-wrapper}}}\n\nEXPOSE 22\n\n# ------------------------------------------------------------------------------\n# Set default environment variables\n# ------------------------------------------------------------------------------\nENV \\\n\tENABLE_SSHD_BOOTSTRAP=\"true\" \\\n\tENABLE_SSHD_WRAPPER=\"true\" \\\n\tENABLE_SUPERVISOR_STDOUT=\"false\" \\\n\tSSH_AUTHORIZED_KEYS=\"\" \\\n\tSSH_CHROOT_DIRECTORY=\"%h\" \\\n\tSSH_INHERIT_ENVIRONMENT=\"false\" \\\n\tSSH_PASSWORD_AUTHENTICATION=\"false\" \\\n\tSSH_SUDO=\"ALL=(ALL) ALL\" \\\n\tSSH_USER=\"app-admin\" \\\n\tSSH_USER_FORCE_SFTP=\"false\" \\\n\tSSH_USER_HOME=\"/home/%u\" \\\n\tSSH_USER_ID=\"500:500\" \\\n\tSSH_USER_PASSWORD=\"\" \\\n\tSSH_USER_PASSWORD_HASHED=\"false\" \\\n\tSSH_USER_PRIVATE_KEY=\"\" \\\n\tSSH_USER_SHELL=\"/bin/bash\" \\\n\tSYSTEM_TIMEZONE=\"UTC\"\n\n# ------------------------------------------------------------------------------\n# Set image metadata\n# ------------------------------------------------------------------------------\nLABEL \\\n\tmaintainer=\"James Deathe <james.deathe@gmail.com>\" \\\n\tinstall=\"docker run \\\n--rm \\\n--privileged \\\n--volume /:/media/root \\\njdeathe/centos-ssh:${RELEASE_VERSION} \\\n/usr/sbin/scmi install \\\n--chroot=/media/root \\\n--name=\\${NAME} \\\n--tag=${RELEASE_VERSION} \\\n--setopt='--volume {{NAME}}.config-ssh:/etc/ssh'\" \\\n\tuninstall=\"docker run \\\n--rm \\\n--privileged \\\n--volume /:/media/root \\\njdeathe/centos-ssh:${RELEASE_VERSION} \\\n/usr/sbin/scmi uninstall \\\n--chroot=/media/root \\\n--name=\\${NAME} \\\n--tag=${RELEASE_VERSION} \\\n--setopt='--volume {{NAME}}.config-ssh:/etc/ssh'\" \\\n\torg.deathe.name=\"centos-ssh\" \\\n\torg.deathe.version=\"${RELEASE_VERSION}\" \\\n\torg.deathe.release=\"jdeathe/centos-ssh:${RELEASE_VERSION}\" \\\n\torg.deathe.license=\"MIT\" \\\n\torg.deathe.vendor=\"jdeathe\" \\\n\torg.deathe.url=\"https://github.com/jdeathe/centos-ssh\" \\\n\torg.deathe.description=\"OpenSSH 7.4 / Supervisor 4.0 / EPEL/IUS/SCL Repositories - CentOS-7 7.6.1810 x86_64.\"\n\nHEALTHCHECK \\\n\t--interval=1s \\\n\t--timeout=1s \\\n\t--retries=5 \\\n\tCMD [\"/usr/bin/healthcheck\"]\n\nCMD [\"/usr/bin/supervisord\", \"--configuration=/etc/supervisord.conf\"]\n"
}