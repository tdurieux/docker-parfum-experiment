{
  "startTime": 1674251620178,
  "endTime": 1674251621473,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 14,
        "lineEnd": 43,
        "columnStart": 22,
        "columnEnd": 8
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Build an Ubuntu-based container to run Mycroft\n#\n#   The steps in this build are ordered from least likely to change to most\n#   likely to change.  The intent behind this is to reduce build time so things\n#   like Jenkins jobs don't spend a lot of time re-building things that did not\n#   change from one build to the next.\n#\nFROM ubuntu:18.04 as core_builder\nARG platform\nENV TERM linux\nENV DEBIAN_FRONTEND noninteractive\n# Un-comment any package sources that include a multiverse\nRUN sed -i 's/# \\(.*multiverse$\\)/\\1/g' /etc/apt/sources.list\n# Install Server Dependencies for Mycroft\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n    autoconf \\\n    automake \\\n    bison \\\n    build-essential \\\n    curl \\\n    flac \\\n    git \\\n    jq \\\n    libfann-dev \\\n    libffi-dev \\\n    libicu-dev \\\n    libjpeg-dev \\\n    libglib2.0-dev \\\n    libssl-dev \\\n    libtool \\\n    locales \\\n    mpg123 \\\n    pkg-config \\\n    portaudio19-dev \\\n    pulseaudio \\\n    pulseaudio-utils \\\n    python3 \\\n    python3-dev \\\n    python3-pip \\\n    python3-setuptools \\\n    python3-venv \\\n    screen \\\n    sudo \\\n    swig \\\n    && apt-get clean \\\n    && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\n# Set the locale\nRUN locale-gen en_US.UTF-8\nENV LANG en_US.UTF-8\nENV LANGUAGE en_US:en\nENV LC_ALL en_US.UTF-8\n\nENV USER root\nENV CI true\n# Setup the virtual environment\n#   This may not be the most efficient way to do this in terms of number of\n#   steps, but it is built to take advantage of Docker's caching mechanism\n#   to only rebuild things that have changed since the last build.\nRUN mkdir -p /opt/mycroft/mycroft-core /opt/mycroft/skills /root/.mycroft /var/log/mycroft\nRUN python3 -m venv \"/opt/mycroft/mycroft-core/.venv\"\n\n# Install required Python packages.  Generate hash, which mycroft core uses to\n# determine if any changes have been made since it last started\nWORKDIR /opt/mycroft/mycroft-core\nRUN .venv/bin/python -m pip install pip==20.0.2\nCOPY requirements/requirements.txt .\nRUN .venv/bin/python -m pip install -r requirements.txt\nCOPY requirements/extra-audiobackend.txt .\nCOPY requirements/extra-stt.txt .\nCOPY requirements/extra-mark1.txt .\nRUN .venv/bin/python -m pip install -r extra-audiobackend.txt \\\n    && .venv/bin/python -m pip install -r extra-stt.txt \\\n    && .venv/bin/python -m pip install -r extra-mark1.txt\nCOPY requirements/tests.txt .\nRUN .venv/bin/python -m pip install -r tests.txt\nCOPY dev_setup.sh .\nRUN md5sum requirements.txt tests.txt extra-audiobackend.txt extra-stt.txt extra-mark1.txt dev_setup.sh > .installed\n\n# Add the mycroft core virtual environment to the system path.\nENV PATH /opt/mycroft/mycroft-core/.venv/bin:$PATH\n\n# Install Mark I default skills\nRUN msm -p mycroft_mark_1 default\nCOPY . /opt/mycroft/mycroft-core\nRUN .venv/bin/python -m pip install --no-deps /opt/mycroft/mycroft-core\nEXPOSE 8181\n\n\n# Integration Test Suite\n#\n#   Build against this target to set the container up as an executable that\n#   will run the \"voight_kampff\" integration test suite.\n#\nFROM core_builder as voight_kampff_builder\nARG platform\n# Setup a dummy TTS backend for the audio process\nRUN mkdir /etc/mycroft\nRUN echo '{\"tts\": {\"module\": \"dummy\"}, \"skills\": {\"auto_update\": false}}' > /etc/mycroft/mycroft.conf\nRUN mkdir ~/.mycroft/allure-result\n\n# The behave feature files for a skill are defined within the skill's\n# repository.  Copy those files into the local feature file directory\n# for test discovery.\nWORKDIR /opt/mycroft/mycroft-core\n# Generate hash of required packages\nRUN python -m test.integrationtests.voight_kampff.test_setup -c test/integrationtests/voight_kampff/default.yml\n\n# Setup and run the integration tests\nENV PYTHONPATH /opt/mycroft/mycroft-core/\nWORKDIR /opt/mycroft/mycroft-core/test/integrationtests/voight_kampff\nENTRYPOINT [\"./run_test_suite.sh\"]\n"
}