{
  "startTime": 1674254227089,
  "endTime": 1674254228095,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 59
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG NODE_VERSION=10\nARG GITHUB_ACCOUNT=ging\nARG GITHUB_REPOSITORY=fiware-pep-proxy\n\n########################################################################################\n#\n# This build stage retrieves the source code and sets up node-SAAS\n#\n########################################################################################\n\nFROM node:${NODE_VERSION} as builder\nCOPY . /opt/fiware-pep-proxy\nWORKDIR /opt/fiware-pep-proxy\nRUN npm install --only=prod --no-package-lock --no-optional && npm cache clean --force;\n\n########################################################################################\n#\n# This build stage creates an anonymous user to be used with the distroless build\n# as defined below.\n#\n########################################################################################\nFROM node:${NODE_VERSION} AS anon-user\nRUN sed -i -r \"/^(root|nobody)/!d\" /etc/passwd /etc/shadow /etc/group \\\n    && sed -i -r 's#^(.*):[^:]*$#\\1:/sbin/nologin#' /etc/passwd\n\n########################################################################################\n#\n# This build stage creates a distroless image for production.\n#\n# IMPORTANT: For production environments use Docker Secrets to protect values of the\n# sensitive ENV variables defined below, by adding _FILE to the name of the relevant\n# variable.\n#\n# -  PEP_PROXY_USERNAME\n# -  PEP_PROXY_PASSWORD\n# -  PEP_PROXY_TOKEN_SECRET\n#\n########################################################################################\n\nFROM gcr.io/distroless/nodejs:${NODE_VERSION}\nARG GITHUB_ACCOUNT\nARG GITHUB_REPOSITORY\nARG NODE_VERSION\n\nLABEL \"maintainer\"=\"FIWARE Identity Manager Team. DIT-UPM\"\nLABEL \"org.opencontainers.image.authors\"=\"\"\nLABEL \"org.opencontainers.image.documentation\"=\"https://fiware-idm.readthedocs.io/\"\nLABEL \"org.opencontainers.image.vendor\"=\"Universidad Polit√©cnica de Madrid.\"\nLABEL \"org.opencontainers.image.licenses\"=\"MIT\"\nLABEL \"org.opencontainers.image.title\"=\"PEP Proxy - Wilma\"\nLABEL \"org.opencontainers.image.description\"=\"Support for proxy functions within OAuth2-based authentication schemas. Also implements PEP functions within an XACML-based access control schema.\"\nLABEL \"org.opencontainers.image.source\"=https://github.com/${GITHUB_ACCOUNT}/${GITHUB_REPOSITORY}\nLABEL \"org.nodejs.version\"=${NODE_VERSION}\n\nCOPY --from=builder /opt/fiware-pep-proxy /opt/fiware-pep-proxy\nCOPY --from=anon-user /etc/passwd /etc/shadow /etc/group /etc/\nWORKDIR /opt/fiware-pep-proxy\n\nUSER nobody\nENV NODE_ENV=production\n# Ports used by application\nEXPOSE ${PEP_PROXY_PORT:-1027}\nCMD [\"./bin/www\"]\nHEALTHCHECK  --interval=30s --timeout=3s --start-period=60s \\\n  CMD [\"/nodejs/bin/node\", \"./bin/healthcheck\"]\n\n#\n# ALL ENVIRONMENT VARIABLES\n#\n#    PEP_PROXY_PORT\n#    PEP_PROXY_HTTPS_ENABLED\n#    PEP_PROXY_HTTPS_PORT\n#    PEP_PROXY_IDM_HOST\n#    PEP_PROXY_IDM_PORT\n#    PEP_PROXY_IDM_SSL_ENABLED\n#    PEP_PROXY_APP_HOST\n#    PEP_PROXY_APP_PORT\n#    PEP_PROXY_APP_SSL_ENABLED\n#    PEP_PROXY_ORG_ENABLED\n#    PEP_PROXY_ORG_HEADER\n#    PEP_PROXY_APP_ID\n#    PEP_PROXY_USERNAME\n#    PEP_PROXY_PASSWORD\n#    PEP_PROXY_TOKEN_SECRET\n#    PEP_PROXY_AUTH_ENABLED\n#    PEP_PROXY_PDP\n#    PEP_PROXY_PDP_PROTOCOL\n#    PEP_PROXY_PDP_HOST\n#    PEP_PROXY_PDP_PORT\n#    PEP_PROXY_PDP_PATH\n#    PEP_PROXY_TENANT_HEADER\n#    PEP_PROXY_AZF_CUSTOM_POLICY\n#    PEP_PROXY_PUBLIC_PATHS\n#    PEP_PROXY_CORS_ORIGIN\n#    PEP_PROXY_CORS_METHODS\n#    PEP_PROXY_CORS_OPTIONS_SUCCESS_STATUS\n#    PEP_PROXY_CORS_ALLOWED_HEADERS\n#    PEP_PROXY_CORS_CREDENTIALS\n#    PEP_PROXY_CORS_MAX_AGE\n#    PEP_PROXY_AUTH_FOR_NGINX\n#    PEP_PROXY_MAGIC_KEY\n#    PEP_PROXY_ERROR_TEMPLATE\n#    PEP_PROXY_ERROR_CONTENT_TYPE\n"
}