{
  "startTime": 1674215420869,
  "endTime": 1674215421863,
  "originalSmells": [
    {
      "rule": "gpgUseHaPools",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 2,
        "columnEnd": 74
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 1,
        "columnEnd": 62
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 2,
        "columnEnd": 77
      }
    }
  ],
  "repairedDockerfile": "FROM adoptopenjdk:8-jre-hotspot-bionic\n\n# explicitly set user/group IDs\nRUN set -eux; \\\n\tgroupadd -r cassandra --gid=999; \\\n\tuseradd -r -g cassandra --uid=999 cassandra\n\nRUN set -eux; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends \\\n# solves warning: \"jemalloc shared library could not be preloaded to speed up memory allocations\"\n\t\tlibjemalloc1 \\\n# \"free\" is used by cassandra-env.sh\n\t\tprocps \\\n# \"cqlsh\" needs a python interpreter\n\t\tpython \\\n# \"ip\" is not required by Cassandra itself, but is commonly used in scripting Cassandra's configuration (since it is so fixated on explicit IP addresses)\n\t\tiproute2 \\\n# Cassandra will automatically use numactl if available\n#   https://github.com/apache/cassandra/blob/18bcda2d4c2eba7370a0b21f33eed37cb730bbb3/bin/cassandra#L90-L100\n#   https://github.com/apache/cassandra/commit/604c0e87dc67fa65f6904ef9a98a029c9f2f865a\n\t\tnumactl \\\n\t; \\\n\trm -rf /var/lib/apt/lists/*\n\n# grab gosu for easy step-down from root\nENV GOSU_VERSION 1.11\nRUN set -eux; \\\n\tsavedAptMark=\"$(apt-mark showmanual)\"; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends ca-certificates dirmngr gnupg wget; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\tdpkgArch=\"$(dpkg --print-architecture | awk -F- '{ print $NF }')\"; \\\n\twget -O /usr/local/bin/gosu \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\"; \\\n\twget -O /usr/local/bin/gosu.asc \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\"; \\\n\texport GNUPGHOME=\"$(mktemp -d)\"; \\\n\tgpg --batch --keyserver hkps://keys.openpgp.org --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4; \\\n\tgpg --batch --verify /usr/local/bin/gosu.asc /usr/local/bin/gosu; \\\n\tgpgconf --kill all; \\\n\trm -rf \"$GNUPGHOME\" /usr/local/bin/gosu.asc; \\\n\tapt-mark auto '.*' > /dev/null; \\\n\t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; \\\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\n\tchmod +x /usr/local/bin/gosu; \\\n\tgosu --version; \\\n\tgosu nobody true\n\nENV CASSANDRA_HOME /opt/cassandra\nENV CASSANDRA_CONF /etc/cassandra\nENV PATH $CASSANDRA_HOME/bin:$PATH\n\n# https://cwiki.apache.org/confluence/display/CASSANDRA2/DebianPackaging#DebianPackaging-AddingRepositoryKeys\nENV GPG_KEYS \\\n# gpg: key 0353B12C: public key \"T Jake Luciani <jake@apache.org>\" imported\n\t514A2AD631A57A16DD0047EC749D6EEC0353B12C \\\n# gpg: key FE4B2BDA: public key \"Michael Shuler <michael@pbandjelly.org>\" imported\n\tA26E528B271F19B9E5D8E19EA278B781FE4B2BDA \\\n# gpg: key E91335D77E3E87CB: public key \"Michael Semb Wever <mick@thelastpickle.com>\" imported\n\tA4C465FEA0C552561A392A61E91335D77E3E87CB\n\nENV CASSANDRA_VERSION 4.0-beta1\nENV CASSANDRA_SHA512 240ae95f78de172333eee865f01b838433845fbd0dceea0eb91ea3a419873f74c5e266cfb62553fa0260849afa7ec5cc65335d037d1455e36b96ddc0f18effc7\n\n# https://github.com/f-secure-foundry/usbarmory-debian-base_image/issues/9\nRUN mkdir ~/.gnupg\nRUN echo \"disable-ipv6\" >> ~/.gnupg/dirmngr.conf\n\nRUN set -eux; \\\n\tsavedAptMark=\"$(apt-mark showmanual)\"; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends ca-certificates dirmngr gnupg wget; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\n\tddist() { \\\n\t\tlocal f=\"$1\"; shift; \\\n\t\tlocal distFile=\"$1\"; shift; \\\n\t\tlocal success=; \\\n\t\tlocal distUrl=; \\\n\t\tfor distUrl in \\\n# https://issues.apache.org/jira/browse/INFRA-8753?focusedCommentId=14735394#comment-14735394\n\t\t\t'https://www.apache.org/dyn/closer.cgi?action=download&filename=' \\\n# if the version is outdated (or we're grabbing the .asc file), we might have to pull from the dist/archive :/\n\t\t\thttps://www-us.apache.org/dist/ \\\n\t\t\thttps://www.apache.org/dist/ \\\n\t\t\thttps://archive.apache.org/dist/ \\\n\t\t; do \\\n\t\t\tif wget --progress=dot:giga -O \"$f\" \"$distUrl$distFile\" && [ -s \"$f\" ]; then \\\n\t\t\t\tsuccess=1; \\\n\t\t\t\tbreak; \\\n\t\t\tfi; \\\n\t\tdone; \\\n\t\t[ -n \"$success\" ]; \\\n\t}; \\\n\n\tddist 'cassandra-bin.tgz' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz\"; \\\n\techo \"$CASSANDRA_SHA512 *cassandra-bin.tgz\" | sha512sum --check --strict -; \\\n\n\tddist 'cassandra-bin.tgz.asc' \"cassandra/$CASSANDRA_VERSION/apache-cassandra-$CASSANDRA_VERSION-bin.tar.gz.asc\"; \\\n\texport GNUPGHOME=\"$(mktemp -d)\"; \\\n\tfor key in $GPG_KEYS; do \\\n\n\t\tgpg --batch --keyserver ipv4.ha.pool.sks-keyservers.net --recv-keys \"$key\"; \\\n\tdone \\\n\t; \\\n\tgpg --batch --verify cassandra-bin.tgz.asc cassandra-bin.tgz; \\\n\trm -rf \"$GNUPGHOME\"; \\\n\n\tapt-mark auto '.*' > /dev/null; \\\n\t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark > /dev/null; \\\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\n\n\tmkdir -p \"$CASSANDRA_HOME\"; \\\n\ttar --extract --file cassandra-bin.tgz --directory \"$CASSANDRA_HOME\" --strip-components 1; \\\n\trm cassandra-bin.tgz*; \\\n\n\t[ ! -e \"$CASSANDRA_CONF\" ]; \\\n\tmv \"$CASSANDRA_HOME/conf\" \"$CASSANDRA_CONF\"; \\\n\tln -sT \"$CASSANDRA_CONF\" \"$CASSANDRA_HOME/conf\"; \\\n\n\tdpkgArch=\"$(dpkg --print-architecture)\"; \\\n\tcase \"$dpkgArch\" in \\\n\t\tppc64el) \\\n# https://issues.apache.org/jira/browse/CASSANDRA-13345\n# \"The stack size specified is too small, Specify at least 328k\"\n\t\t\tif grep -q -- '^-Xss' \"$CASSANDRA_CONF/jvm.options\"; then \\\n# 3.11+ (jvm.options)\n\t\t\t\tgrep -- '^-Xss256k$' \"$CASSANDRA_CONF/jvm.options\"; \\\n\t\t\t\tsed -ri 's/^-Xss256k$/-Xss512k/' \"$CASSANDRA_CONF/jvm.options\"; \\\n\t\t\t\tgrep -- '^-Xss512k$' \"$CASSANDRA_CONF/jvm.options\"; \\\n\t\t\telif grep -q -- '-Xss256k' \"$CASSANDRA_CONF/cassandra-env.sh\"; then \\\n# 3.0 (cassandra-env.sh)\n\t\t\t\tsed -ri 's/-Xss256k/-Xss512k/g' \"$CASSANDRA_CONF/cassandra-env.sh\"; \\\n\t\t\t\tgrep -- '-Xss512k' \"$CASSANDRA_CONF/cassandra-env.sh\"; \\\n\t\t\tfi; \\\n\t\t\t;; \\\n\tesac; \\\n\n\tmkdir -p \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \\\n\tchown -R cassandra:cassandra \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \\\n\tchmod 777 \"$CASSANDRA_CONF\" /var/lib/cassandra /var/log/cassandra; \\\n\tln -sT /var/lib/cassandra \"$CASSANDRA_HOME/data\"; \\\n\tln -sT /var/log/cassandra \"$CASSANDRA_HOME/logs\"; \\\n\n# smoke test\n\tcassandra -v\n\nVOLUME /var/lib/cassandra\n\nCOPY docker-entrypoint.sh /usr/local/bin/\nRUN ln -s usr/local/bin/docker-entrypoint.sh /docker-entrypoint.sh # backwards compat\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\n# 7000: intra-node communication\n# 7001: TLS intra-node communication\n# 7199: JMX\n# 9042: CQL\n# 9160: thrift service\nEXPOSE 7000 7001 7199 9042 9160\nCMD [\"cassandra\", \"-f\"]\n"
}