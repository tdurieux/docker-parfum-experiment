{
  "startTime": 1674254870735,
  "endTime": 1674254873713,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 121,
        "lineEnd": 122,
        "columnStart": 4,
        "columnEnd": 62
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 263,
        "lineEnd": 263,
        "columnStart": 4,
        "columnEnd": 20
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 279,
        "lineEnd": 279,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 315,
        "lineEnd": 315,
        "columnStart": 4,
        "columnEnd": 76
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 49,
        "lineEnd": 52,
        "columnStart": 22,
        "columnEnd": 13
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 59,
        "lineEnd": 80,
        "columnStart": 22,
        "columnEnd": 8
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 83,
        "lineEnd": 94,
        "columnStart": 22,
        "columnEnd": 16
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 98,
        "lineEnd": 100,
        "columnStart": 24,
        "columnEnd": 13
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 106,
        "lineEnd": 110,
        "columnStart": 22,
        "columnEnd": 11
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 141,
        "lineEnd": 144,
        "columnStart": 22,
        "columnEnd": 16
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 177,
        "lineEnd": 189,
        "columnStart": 22,
        "columnEnd": 10
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 192,
        "lineEnd": 196,
        "columnStart": 22,
        "columnEnd": 10
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 200,
        "lineEnd": 209,
        "columnStart": 22,
        "columnEnd": 23
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 212,
        "lineEnd": 213,
        "columnStart": 22,
        "columnEnd": 10
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 216,
        "lineEnd": 220,
        "columnStart": 22,
        "columnEnd": 18
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 223,
        "lineEnd": 227,
        "columnStart": 22,
        "columnEnd": 13
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 230,
        "lineEnd": 245,
        "columnStart": 22,
        "columnEnd": 16
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 249,
        "lineEnd": 254,
        "columnStart": 22,
        "columnEnd": 13
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 264,
        "lineEnd": 268,
        "columnStart": 22,
        "columnEnd": 17
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 284,
        "lineEnd": 307,
        "columnStart": 22,
        "columnEnd": 13
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 310,
        "lineEnd": 312,
        "columnStart": 22,
        "columnEnd": 14
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 316,
        "lineEnd": 333,
        "columnStart": 22,
        "columnEnd": 11
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 343,
        "lineEnd": 349,
        "columnStart": 24,
        "columnEnd": 23
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 365,
        "lineEnd": 367,
        "columnStart": 22,
        "columnEnd": 11
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 370,
        "lineEnd": 374,
        "columnStart": 22,
        "columnEnd": 10
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 377,
        "lineEnd": 405,
        "columnStart": 22,
        "columnEnd": 19
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 408,
        "lineEnd": 410,
        "columnStart": 22,
        "columnEnd": 15
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 415,
        "lineEnd": 420,
        "columnStart": 24,
        "columnEnd": 16
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 426,
        "lineEnd": 431,
        "columnStart": 23,
        "columnEnd": 18
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 435,
        "lineEnd": 449,
        "columnStart": 22,
        "columnEnd": 17
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 452,
        "lineEnd": 453,
        "columnStart": 22,
        "columnEnd": 18
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 457,
        "lineEnd": 460,
        "columnStart": 22,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 462,
        "lineEnd": 465,
        "columnStart": 22,
        "columnEnd": 18
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 469,
        "lineEnd": 473,
        "columnStart": 22,
        "columnEnd": 16
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 476,
        "lineEnd": 481,
        "columnStart": 22,
        "columnEnd": 11
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 484,
        "lineEnd": 486,
        "columnStart": 22,
        "columnEnd": 18
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 489,
        "lineEnd": 492,
        "columnStart": 22,
        "columnEnd": 13
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 495,
        "lineEnd": 498,
        "columnStart": 22,
        "columnEnd": 18
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 501,
        "lineEnd": 518,
        "columnStart": 22,
        "columnEnd": 16
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 521,
        "lineEnd": 525,
        "columnStart": 22,
        "columnEnd": 14
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 528,
        "lineEnd": 531,
        "columnStart": 22,
        "columnEnd": 9
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 535,
        "lineEnd": 561,
        "columnStart": 23,
        "columnEnd": 17
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 567,
        "lineEnd": 571,
        "columnStart": 22,
        "columnEnd": 21
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 49,
        "lineEnd": 52,
        "columnStart": 22,
        "columnEnd": 13
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 59,
        "lineEnd": 80,
        "columnStart": 22,
        "columnEnd": 8
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 83,
        "lineEnd": 94,
        "columnStart": 22,
        "columnEnd": 16
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 98,
        "lineEnd": 100,
        "columnStart": 24,
        "columnEnd": 13
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 106,
        "lineEnd": 110,
        "columnStart": 22,
        "columnEnd": 11
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 141,
        "lineEnd": 144,
        "columnStart": 22,
        "columnEnd": 16
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 177,
        "lineEnd": 189,
        "columnStart": 22,
        "columnEnd": 10
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 192,
        "lineEnd": 196,
        "columnStart": 22,
        "columnEnd": 10
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 200,
        "lineEnd": 209,
        "columnStart": 22,
        "columnEnd": 23
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 212,
        "lineEnd": 213,
        "columnStart": 22,
        "columnEnd": 10
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 216,
        "lineEnd": 220,
        "columnStart": 22,
        "columnEnd": 18
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 223,
        "lineEnd": 227,
        "columnStart": 22,
        "columnEnd": 13
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 230,
        "lineEnd": 245,
        "columnStart": 22,
        "columnEnd": 16
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 249,
        "lineEnd": 254,
        "columnStart": 22,
        "columnEnd": 13
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 264,
        "lineEnd": 268,
        "columnStart": 22,
        "columnEnd": 17
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 284,
        "lineEnd": 307,
        "columnStart": 22,
        "columnEnd": 13
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 310,
        "lineEnd": 312,
        "columnStart": 22,
        "columnEnd": 14
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 316,
        "lineEnd": 333,
        "columnStart": 22,
        "columnEnd": 11
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 343,
        "lineEnd": 349,
        "columnStart": 24,
        "columnEnd": 23
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 365,
        "lineEnd": 367,
        "columnStart": 22,
        "columnEnd": 11
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 370,
        "lineEnd": 374,
        "columnStart": 22,
        "columnEnd": 10
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 377,
        "lineEnd": 405,
        "columnStart": 22,
        "columnEnd": 19
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 408,
        "lineEnd": 410,
        "columnStart": 22,
        "columnEnd": 15
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 415,
        "lineEnd": 420,
        "columnStart": 24,
        "columnEnd": 16
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 426,
        "lineEnd": 431,
        "columnStart": 23,
        "columnEnd": 18
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 435,
        "lineEnd": 449,
        "columnStart": 22,
        "columnEnd": 17
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 452,
        "lineEnd": 453,
        "columnStart": 22,
        "columnEnd": 18
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 457,
        "lineEnd": 460,
        "columnStart": 22,
        "columnEnd": 51
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 462,
        "lineEnd": 465,
        "columnStart": 22,
        "columnEnd": 18
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 469,
        "lineEnd": 473,
        "columnStart": 22,
        "columnEnd": 16
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 476,
        "lineEnd": 481,
        "columnStart": 22,
        "columnEnd": 11
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 484,
        "lineEnd": 486,
        "columnStart": 22,
        "columnEnd": 18
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 489,
        "lineEnd": 492,
        "columnStart": 22,
        "columnEnd": 13
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 495,
        "lineEnd": 498,
        "columnStart": 22,
        "columnEnd": 18
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 501,
        "lineEnd": 518,
        "columnStart": 22,
        "columnEnd": 16
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 521,
        "lineEnd": 525,
        "columnStart": 22,
        "columnEnd": 14
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 528,
        "lineEnd": 531,
        "columnStart": 22,
        "columnEnd": 9
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 535,
        "lineEnd": 561,
        "columnStart": 23,
        "columnEnd": 17
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 567,
        "lineEnd": 571,
        "columnStart": 22,
        "columnEnd": 21
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Copyright (C) 2018-2021 VyOS maintainers and contributors\n#\n# This program is free software; you can redistribute it and/or modify\n# in order to easy exprort images built to \"external\" world\n# it under the terms of the GNU General Public License version 2 or later as\n# published by the Free Software Foundation.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU General Public License for more details.\n#\n# You should have received a copy of the GNU General Public License\n# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\n# Must be run with --privileged flag, recommended to run the container with a\n# volume mapped in order to easy export images\n\n# This Dockerfile is installable on both x86, x86-64, armhf and arm64 systems\nARG ARCH=\nFROM ${ARCH}debian:bullseye\n\n# It is also possible to emulate an arm system inside docker,\n# execution of this emulated system needs to be executed on an x86 or x86-64 host.\n\n# To install using a non-native cpu instructionset use the `--build-arg ARCH=<ARCH>/`\n# Supported architectures:\n#     arm32v6/\n#     arm32v7/\n#     arm64v8/\n# Example bo byukd natively:\n#     docker build -t vyos-build:current .\n# Example to build on armhf:\n#     docker build -t vyos-build:current-armhf --build-arg ARCH=arm32v7/ .\n# Example to build on arm64:\n#     docker build -t vyos-build:current-arm64 --build-arg ARCH=arm64v8/ .\n\n# On some versions of docker the emulation framework is not installed by default and\n# you need to install qemu, qemu-user-static and register qemu inside docker manually using:\n# `docker run --rm --privileged multiarch/qemu-user-static:register --reset`\nLABEL authors=\"VyOS Maintainers <maintainers@vyos.io>\"\nENV DEBIAN_FRONTEND noninteractive\n\n# Standard shell should be bash not dash\nRUN echo \"dash dash/sh boolean false\" | debconf-set-selections && \\\n    dpkg-reconfigure dash\n\nRUN echo -e 'APT::Install-Recommends \"0\";\\nAPT::Install-Suggests \"0\";' > /etc/apt/apt.conf.d/01norecommends\n\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      dialog \\\n      apt-utils \\\n      locales && rm -rf /var/lib/apt/lists/*;\n\nRUN echo \"en_US.UTF-8 UTF-8\" > /etc/locale.gen && locale-gen\nENV LANG en_US.utf8\n\nENV OCAML_VERSION 4.12.0\n\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      bash \\\n      bash-completion \\\n      vim \\\n      vim-autopep8 \\\n      nano \\\n      git \\\n      curl \\\n      sudo \\\n      mc \\\n      pbuilder \\\n      devscripts \\\n      lsb-release \\\n      libtool \\\n      libapt-pkg-dev \\\n      flake8 \\\n      pkg-config \\\n      debhelper \\\n      gosu \\\n      po4a \\\n      openssh-client \\\n      jq && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for vyos-build\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      build-essential \\\n      python3-pystache \\\n      squashfs-tools \\\n      genisoimage \\\n      fakechroot \\\n      python3-git \\\n      python3-pip \\\n      python3-flake8 \\\n      python3-autopep8 \\\n      debootstrap \\\n      live-build && rm -rf /var/lib/apt/lists/*;\n\n# Syslinux and Grub2 is only supported on x86 and x64 systems\nRUN if dpkg-architecture -ii386 || dpkg-architecture -iamd64; then \\\n      apt-get update && apt-get install --no-install-recommends -y \\\n        syslinux \\\n        grub2; rm -rf /var/lib/apt/lists/*; \\\n    fi\n\n#\n# Building libvyosconf requires a full configured OPAM/OCaml setup\n#\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      debhelper \\\n      libffi-dev \\\n      libpcre3-dev \\\n      unzip && rm -rf /var/lib/apt/lists/*;\n\n# Update certificate store to not crash ocaml package install\n# Apply fix for https in curl running on armhf\nRUN dpkg-reconfigure ca-certificates; \\\n    if dpkg-architecture -iarmhf; then \\\n      echo \"cacert=/etc/ssl/certs/ca-certificates.crt\" >> ~/.curlrc; \\\n    fi\n\n\n# Installing OCAML needed to compile libvyosconfig\nRUN curl -f https://raw.githubusercontent.com/ocaml/opam/master/shell/install.sh \\\n      --output /tmp/opam_install.sh --retry 10 --retry-delay 5 && \\\n    sed -i 's/read BINDIR/BINDIR=\"\"/' /tmp/opam_install.sh && sh /tmp/opam_install.sh && \\\n    opam init --root=/opt/opam --comp=${OCAML_VERSION} --disable-sandboxing --no-setup\n\nRUN eval $(opam env --root=/opt/opam --set-root) && opam install -y \\\n      pcre re\n\nRUN eval $(opam env --root=/opt/opam --set-root) && opam install -y \\\n      num \\\n      ctypes \\\n      ctypes-foreign \\\n      ctypes-build \\\n      containers\n\n# Build VyConf which is required to build libvyosconfig\nRUN eval $(opam env --root=/opt/opam --set-root) && \\\n    opam pin add vyos1x-config https://github.com/vyos/vyos1x-config.git#40f7d2af -y\n\n# Packages needed for libvyosconfig\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      quilt \\\n      libpcre3-dev \\\n      libffi-dev && rm -rf /var/lib/apt/lists/*;\n\n# Build libvyosconfig\nRUN eval $(opam env --root=/opt/opam --set-root) && \\\n    git clone https://github.com/vyos/libvyosconfig.git /tmp/libvyosconfig && \\\n    cd /tmp/libvyosconfig && git checkout 2f90f3c5 && \\\n    dpkg-buildpackage -uc -us -tc -b && \\\n    dpkg -i /tmp/libvyosconfig0_*_$(dpkg-architecture -qDEB_HOST_ARCH).deb\n\n# Install open-vmdk\nRUN wget -O /tmp/open-vmdk-master.zip https://github.com/vmware/open-vmdk/archive/master.zip && \\\n    unzip -d /tmp/ /tmp/open-vmdk-master.zip && \\\n    cd /tmp/open-vmdk-master/ && \\\n    make && \\\n    make install\n\n#\n# live-build: building in docker fails with mounting /proc | /sys\n#\n# https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=919659\n# https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=921815\n# https://salsa.debian.org/installer-team/debootstrap/merge_requests/26\n#\nRUN wget https://salsa.debian.org/klausenbusk-guest/debootstrap/commit/a9a603b17cadbf52cb98cde0843dc9f23a08b0da.patch \\\n      -O /tmp/a9a603b17cadbf52cb98cde0843dc9f23a08b0da.patch && \\\n    git clone https://salsa.debian.org/installer-team/debootstrap /tmp/debootstrap && \\\n    cd /tmp/debootstrap && git checkout 1.0.114 && \\\n    patch -p1 < /tmp/a9a603b17cadbf52cb98cde0843dc9f23a08b0da.patch && \\\n    dch -n \"Applying fix for docker image compile\" && \\\n    dpkg-buildpackage -us -uc && \\\n    sudo dpkg -i ../debootstrap*.deb\n\n# Packages needed for vyatta-cfg\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      autotools-dev \\\n      libglib2.0-dev \\\n      libboost-filesystem-dev \\\n      libapt-pkg-dev \\\n      libtool \\\n      flex \\\n      bison \\\n      libperl-dev \\\n      autoconf \\\n      automake \\\n      pkg-config \\\n      cpio && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for vyatta-cfg-firewall\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      autotools-dev \\\n      autoconf \\\n      automake \\\n      cpio && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for Linux Kernel\n# gnupg2 is required by Jenkins for the TAR verification\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      gnupg2 \\\n      rsync \\\n      libncurses5-dev \\\n      flex \\\n      bison \\\n      bc \\\n      kmod \\\n      cpio \\\n      python-is-python3 && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for Intel QAT out-of-tree drivers\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      yasm && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for Accel-PPP\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      liblua5.3-dev \\\n      libssl1.1 \\\n      libssl-dev \\\n      libpcre3-dev && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for Wireguard\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      debhelper-compat \\\n      dkms \\\n      pkg-config \\\n      systemd && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for iproute2\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      bison \\\n      debhelper \\\n      flex \\\n      libxtables-dev \\\n      libatm1-dev \\\n      libcap-dev \\\n      libdb-dev \\\n      libbsd-dev \\\n      libelf-dev \\\n      libmnl-dev \\\n      libselinux1-dev \\\n      linux-libc-dev \\\n      pkg-config \\\n      po-debconf \\\n      zlib1g-dev && rm -rf /var/lib/apt/lists/*;\n\n# Prerequisites for building rtrlib\n# see http://docs.frrouting.org/projects/dev-guide/en/latest/building-frr-for-debian8.html\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      cmake \\\n      dpkg-dev \\\n      debhelper \\\n      libssh-dev \\\n      doxygen && rm -rf /var/lib/apt/lists/*;\n\n# Build rtrlib release 0.8.0\nRUN export RTRLIB_VERSION=\"0.8.0\" export ARCH=$(dpkg-architecture -qDEB_HOST_ARCH) && \\\n    git clone https://github.com/rtrlib/rtrlib.git /tmp/rtrlib && cd /tmp/rtrlib && \\\n    dpkg-buildpackage -uc -us -tc -b && \\\n    dpkg -i ../librtr0*_${ARCH}.deb ../librtr-dev*_${ARCH}.deb ../rtr-tools*_${ARCH}.deb\n\n# Packages needed to build libyang2\nRUN pip install --no-cache-dir apkg\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      graphviz \\\n      cmake \\\n      libpcre3-dev \\\n      python3-pip && rm -rf /var/lib/apt/lists/*;\n\n# Prerequisites for building FRR from source\n# see http://docs.frrouting.org/projects/dev-guide/en/latest/building-frr-for-debian8.html\n#\nRUN export LIBYANG_COMMIT=\"v2.0.164\" && \\\n    git clone https://github.com/CESNET/libyang.git && \\\n    cd libyang && git checkout $LIBYANG_COMMIT && apkg build -i && \\\n    cd pkg/pkgs/debian-11/libyang2_* && dpkg -i *.deb\n\n# FRR documentation also has a dependency on an up to date spinx version\nRUN pip install --no-cache-dir sphinx==4.0.2\n\n# Packages needed to build FRR itself\n# https://github.com/FRRouting/frr/blob/master/doc/developer/building-libyang.rst\n# for more info\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      bison \\\n      chrpath \\\n      debhelper \\\n      flex \\\n      gawk \\\n      install-info \\\n      libc-ares-dev \\\n      libcap-dev \\\n      libjson-c-dev \\\n      libpam0g-dev \\\n      libpcre3-dev \\\n      libpython3-dev \\\n      libreadline-dev \\\n      librtr-dev \\\n      libsnmp-dev \\\n      libssh-dev \\\n      libsystemd-dev \\\n      lsb-base \\\n      pkg-config \\\n      python3 \\\n      python3-dev \\\n      python3-pytest \\\n      texinfo && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for hvinfo\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      gnat \\\n      gprbuild && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for vyos-1x\nRUN pip install --no-cache-dir git+https://github.com/aristanetworks/j2lint.git@341b5d5db86\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      dh-python \\\n      fakeroot \\\n      libzmq3-dev \\\n      python3 \\\n      python3-setuptools \\\n      python3-sphinx \\\n      python3-xmltodict \\\n      python3-lxml \\\n      python3-nose \\\n      python3-netifaces \\\n      python3-jinja2 \\\n      python3-psutil \\\n      python3-stdeb \\\n      python3-all \\\n      python3-coverage \\\n      quilt \\\n      whois && rm -rf /var/lib/apt/lists/*;\n\nRun git clone https://github.com/dsoprea/PyInotify.git /tmp/inotify && \\\n    cd /tmp/inotify && \\\n    python3 setup.py --command-packages=stdeb.command bdist_deb && \\\n    sudo dpkg -i ./deb_dist/python3-inotify*.deb\n\n# Packages needed for vyos-1x-xdp package, gcc-multilib is not available on\n# arm64 but required by XDP\nRUN if dpkg-architecture -ii386 || dpkg-architecture -iamd64; then \\\n      apt-get update && apt-get install --no-install-recommends -y \\\n        gcc-multilib \\\n        clang \\\n        llvm \\\n        libelf-dev \\\n        libpcap-dev \\\n        build-essential; rm -rf /var/lib/apt/lists/*; \\\n      git clone https://github.com/libbpf/libbpf.git /tmp/libbpf && \\\n        cd /tmp/libbpf && git checkout b91f53ec5f1aba2 && cd src && make install; \\\n    fi\n\n# Go required for validators and vyos-xe-guest-utilities\nRUN GO_VERSION_INSTALL=\"1.18.3\" ; \\\n    if [ \"$ARCH\" = \"arm64v8\" ] ; then \\\n        wget -O /tmp/go${GO_VERSION_INSTALL}.linux-arm64.tar.gz https://go.dev/dl/go${GO_VERSION_INSTALL}.linux-arm64.tar.gz ; \\\n    else \\\n        wget -O /tmp/go${GO_VERSION_INSTALL}.linux-amd64.tar.gz https://go.dev/dl/go${GO_VERSION_INSTALL}.linux-amd64.tar.gz ; \\\n    fi && \\\n    tar -C /opt -xzf /tmp/go*.tar.gz && \\\n    rm /tmp/go*.tar.gz\n\n# Packages needed for ipaddrcheck\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      libcidr-dev \\\n      check && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for vyatta-quagga\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      libpam-dev \\\n      libcap-dev \\\n      libsnmp-dev \\\n      gawk && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for vyos-strongswan\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      bison \\\n      bzip2 \\\n      debhelper \\\n      dh-apparmor \\\n      dpkg-dev \\\n      flex \\\n      gperf \\\n      libxtables-dev \\\n      libcap-dev \\\n      libcurl4-openssl-dev \\\n      libgcrypt20-dev \\\n      libgmp3-dev \\\n      libiptc-dev \\\n      libkrb5-dev \\\n      libldap2-dev \\\n      libnm-dev \\\n      libpam0g-dev \\\n      libsqlite3-dev \\\n      libssl-dev \\\n      libsystemd-dev \\\n      libtool \\\n      libxml2-dev \\\n      pkg-config \\\n      po-debconf \\\n      systemd \\\n      tzdata \\\n      python-setuptools \\\n      python3-stdeb && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for opennhrp\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      libc-ares-dev \\\n      libev-dev && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for Qemu test-suite\n# This is for now only supported on i386 and amd64 platforms\nRUN if dpkg-architecture -ii386 || dpkg-architecture -iamd64; then \\\n      apt-get update && apt-get install --no-install-recommends -y \\\n        python3-pexpect \\\n        ovmf \\\n        qemu-system-x86 \\\n        qemu-utils \\\n        qemu-kvm; rm -rf /var/lib/apt/lists/*; \\\n    fi\n\n# Packages needed for building vmware and GCE images\n# This is only supported on i386 and amd64 platforms\nRUN if dpkg-architecture -ii386 || dpkg-architecture -iamd64; then \\\n     apt-get update && apt-get install --no-install-recommends -y \\\n      kpartx \\\n      parted \\\n      udev \\\n      grub-pc \\\n      grub2-common; rm -rf /var/lib/apt/lists/*; \\\n    fi\n\n# Packages needed for vyos-cloud-init\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      python3-configobj \\\n      python3-httpretty \\\n      python3-jsonpatch \\\n      python3-mock \\\n      python3-oauthlib \\\n      python3-pep8 \\\n      python3-pyflakes \\\n      python3-serial \\\n      python3-unittest2 \\\n      python3-yaml \\\n      python3-jsonschema \\\n      python3-contextlib2 \\\n      python3-pytest-cov \\\n      cloud-utils && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for libnss-mapuser & libpam-radius\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      libaudit-dev && rm -rf /var/lib/apt/lists/*;\n\n# Install utillities for building grub and u-boot images\nRUN if dpkg-architecture -iarm64; then \\\n    apt-get update && apt-get install --no-install-recommends -y \\\n      dosfstools \\\n      u-boot-tools \\\n      grub-efi-$(dpkg-architecture -qDEB_HOST_ARCH); rm -rf /var/lib/apt/lists/*; \\\n    elif dpkg-architecture -iarmhf; then \\\n    apt-get update && apt-get install --no-install-recommends -y \\\n      dosfstools \\\n      u-boot-tools \\\n      grub-efi-arm; rm -rf /var/lib/apt/lists/*; \\\n    fi\n\n# Packages needed for libnftnl\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      debhelper-compat \\\n      libmnl-dev \\\n      libtool \\\n      pkg-config && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for wide-dhcpv6\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      bison \\\n      debhelper \\\n      flex \\\n      libfl-dev \\\n      rsync && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for vyos-http-api-tools\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      dh-virtualenv \\\n      python3-venv && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for openvpn-otp\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      debhelper \\\n      libssl-dev \\\n      openvpn && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for OWAMP/TWAMP (service sla)\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      dh-exec \\\n      libi2util-dev \\\n      i2util-tools && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for keepalived\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      autoconf \\\n      libglib2.0-dev \\\n      libip4tc-dev \\\n      libipset-dev \\\n      libjson-c-dev \\\n      libnfnetlink-dev \\\n      libnftnl-dev \\\n      libnl-3-dev \\\n      libnl-genl-3-dev \\\n      libnl-nf-3-dev \\\n      libpcre2-dev \\\n      libpopt-dev \\\n      libsnmp-dev \\\n      libssl-dev \\\n      libsystemd-dev \\\n      linux-libc-dev \\\n      pkg-config && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for dropbear\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      debhelper-compat \\\n      libtomcrypt-dev \\\n      libtommath-dev \\\n      libz-dev && rm -rf /var/lib/apt/lists/*;\n\n# Creating image for embedded systems needs this utilities to prepare a image file\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      parted \\\n      udev \\\n      zip && rm -rf /var/lib/apt/lists/*;\n\n# Packages needed for Fastnetmon\nRUN if dpkg-architecture -ii386 || dpkg-architecture -iamd64; then \\\n     apt-get update && apt-get install --no-install-recommends -y \\\n       cmake \\\n       debhelper-compat \\\n       libboost-atomic-dev \\\n       libboost-chrono-dev \\\n       libboost-date-time-dev \\\n       libboost-program-options-dev \\\n       libboost-regex-dev \\\n       libboost-system-dev \\\n       libboost-thread-dev \\\n       libbson-dev \\\n       libcapnp-dev \\\n       libgrpc-dev \\\n       libgrpc++-dev \\\n       libprotobuf-dev \\\n       protobuf-compiler \\\n       protobuf-compiler-grpc \\\n       capnproto \\\n       libhiredis-dev \\\n       libjson-c-dev \\\n       liblog4cpp5-dev \\\n       libluajit-5.1-dev \\\n       libicu-dev \\\n       libmongoc-dev \\\n       libncurses5-dev \\\n       libpcap-dev \\\n       pkg-config; rm -rf /var/lib/apt/lists/*; \\\n     fi\n\n#\n# fpm: a command-line program designed to help you build packages (e.g. deb)\n#\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      ruby \\\n      ruby-dev \\\n      rubygems \\\n      build-essential && rm -rf /var/lib/apt/lists/*;\nRUN gem install --no-document fpm\n\n# Allow password-less 'sudo' for all users in group 'sudo'\nRUN sed \"s/^%sudo.*/%sudo\\tALL=(ALL) NOPASSWD:ALL/g\" -i /etc/sudoers && \\\n    chmod a+s /usr/sbin/useradd /usr/sbin/groupadd /usr/sbin/gosu /usr/sbin/usermod\n\n# Ensure sure all users have access to our OCAM and Go installation\nRUN echo \"$(opam env --root=/opt/opam --set-root)\" >> /etc/skel/.bashrc && \\\n    echo \"export PATH=/opt/go/bin:\\$PATH\" >> /etc/skel/.bashrc\n\n# Cleanup\nRUN rm -rf /tmp/*\n\n# Disable mouse in vim\nRUN echo -e \"set mouse=\\nset ttymouse=\" > /etc/vim/vimrc.local\n\nCOPY entrypoint.sh /usr/local/bin/entrypoint.sh\nENTRYPOINT [\"/usr/local/bin/entrypoint.sh\"]\n"
}