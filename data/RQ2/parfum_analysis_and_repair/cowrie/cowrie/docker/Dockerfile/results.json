{
  "startTime": 1674254061772,
  "endTime": 1674254062440,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 29,
        "lineEnd": 44,
        "columnStart": 4,
        "columnEnd": 19
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# This Dockerfile contains two images, `builder` and `runtime`.\n# `builder` contains all necessary code to build\n# `runtime` is stripped down.\n\nARG ARCH=\nARG BUILD_DATE\nARG TAG\nFROM ${ARCH}debian:bullseye-slim as builder\n\nWORKDIR /\n\n# This is a temporary workaround, see https://github.com/cowrie/docker-cowrie/issues/26\nENV CRYPTOGRAPHY_DONT_BUILD_RUST=1\n\nENV COWRIE_GROUP=cowrie \\\n    COWRIE_USER=cowrie \\\n    COWRIE_HOME=/cowrie\n\n# Set locale to UTF-8, otherwise upstream libraries have bytes/string conversion issues\nENV LC_ALL=en_US.UTF-8 \\\n    LANG=en_US.UTF-8 \\\n    LANGUAGE=en_US.UTF-8\n\nRUN groupadd -r ${COWRIE_GROUP} && \\\n    useradd -r -d ${COWRIE_HOME} -m -g ${COWRIE_GROUP} ${COWRIE_USER}\n\n# Set up Debian prereqs\nRUN export DEBIAN_FRONTEND=noninteractive; \\\n    apt-get update && \\\n    apt-get install --no-install-recommends -y \\\n        -o APT::Install-Suggests=false \\\n        -o APT::Install-Recommends=fal \\\n      python3-pip \\\n      ca-certificates \\\n      libffi-dev \\\n      libssl-dev \\\n      python3-dev \\\n      python3-venv \\\n      python3 \\\n      rustc \\\n      cargo \\\n      git \\\n      build-essential \\\n      python3-virtualenv \\\n      libsnappy-dev && \\\n    rm -rf /var/lib/apt/lists/*\n\nUSER ${COWRIE_USER}\nWORKDIR ${COWRIE_HOME}\n\n# Copy requirements first to use Docker caching better\nRUN mkdir -p ${COWRIE_HOME}/cowrie-git\nCOPY --chown=${COWRIE_USER}:${COWRIE_GROUP} requirements.txt requirements-output.txt ${COWRIE_HOME}/cowrie-git/\n\nRUN python3 -m venv cowrie-env && \\\n    . cowrie-env/bin/activate && \\\n    pip install --no-cache-dir --upgrade pip wheel setuptools && \\\n    pip install --no-cache-dir --upgrade cffi && \\\n    pip install --no-cache-dir --upgrade -r ${COWRIE_HOME}/cowrie-git/requirements.txt && \\\n    pip install --no-cache-dir --upgrade -r ${COWRIE_HOME}/cowrie-git/requirements-output.txt\n\nCOPY --chown=${COWRIE_USER}:${COWRIE_GROUP} . ${COWRIE_HOME}/cowrie-git\n\n\nFROM gcr.io/distroless/python3-debian11 AS runtime\n#FROM gcr.io/distroless/python3-debian11:debug AS runtime\n\nLABEL org.opencontainers.image.created=\"${BUILD_DATE}\"\nLABEL org.opencontainers.image.authors=\"Michel Oosterhof <michel@oosterhof.net>\"\nLABEL org.opencontainers.image.url=\"https://cowrie.org/\"\nLABEL org.opencontainers.image.documentation=\"https://cowrie.readthedocs.io\"\nLABEL org.opencontainers.image.source=\"https://github.com/cowrie/docker-cowrie\"\nLABEL org.opencontainers.image.version=\"${TAG}\"\nLABEL org.opencontainers.image.revision=\"Source control revision identifier for the packaged software.\"\nLABEL org.opencontainers.image.vendor=\"Cowrie\"\nLABEL org.opencontainers.image.licenses=\"BSD-3-Clause\"\nLABEL org.opencontainers.image.ref.name=\"${TAG}\"\nLABEL org.opencontainers.image.title=\"Cowrie SSH/Telnet Honeypot\"\nLABEL org.opencontainers.image.description=\"Cowrie SSH/Telnet Honeypot\"\n#LABEL org.opencontainers.image.base.digest=\"7beb0248fd81\"\nLABEL org.opencontainers.image.base.name=\"gcr.io/distroless/python3-debian11\"\n\nENV COWRIE_GROUP=cowrie \\\n    COWRIE_USER=cowrie \\\n    COWRIE_HOME=/cowrie\n\n#RUN groupadd -r ${COWRIE_GROUP} && \\\n#    useradd -r -d ${COWRIE_HOME} -m -g ${COWRIE_GROUP} ${COWRIE_USER}\nCOPY --from=builder --chown=0:0 /etc/passwd /etc/passwd\nCOPY --from=builder --chown=0:0 /etc/group /etc/group\n\n#RUN export DEBIAN_FRONTEND=noninteractive; \\\n#    apt-get update && \\\n#    apt-get install -y \\\n#        -o APT::Install-Suggests=false \\\n#        -o APT::Install-Recommends=false \\\n#      libssl1.1 \\\n#      ca-certificates \\\n#      libffi7 \\\n#      procps \\\n#      python3 \\\n#      python3-distutils && \\\n#    rm -rf /var/lib/apt/lists/* && \\\n#    ln -s /usr/bin/python3 /usr/local/bin/python\n\nCOPY --from=builder --chown=${COWRIE_USER}:${COWRIE_GROUP} ${COWRIE_HOME} ${COWRIE_HOME}\n\nRUN python3 -m compileall ${COWRIE_HOME} /usr/lib/python3.9\n\nVOLUME [ \"/cowrie/cowrie-git/var\", \"/cowrie/cowrie-git/etc\" ]\n\nUSER ${COWRIE_USER}\nWORKDIR ${COWRIE_HOME}/cowrie-git\n\nENV PATH=${COWRIE_HOME}/cowrie-env/bin:${PATH}\nENV PYTHONPATH=${COWRIE_HOME}/cowrie-git/src\nENV PYTHONUNBUFFERED=1\n\nENTRYPOINT [ \"/cowrie/cowrie-env/bin/python3\" ]\nCMD [ \"/cowrie/cowrie-env/bin/twistd\", \"-n\", \"--umask=0022\", \"--pidfile=\", \"cowrie\" ]\n\nEXPOSE 2222 2223\n"
}