{
  "startTime": 1674250636883,
  "endTime": 1674250637536,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 57
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Copyright 2016 Teradata\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\nFROM teradatalabs/cdh5-hive:unlabelled\nMAINTAINER Teradata Docker Team <docker@teradata.com>\n\n# INSTALL KERBEROS\nRUN yum install -y krb5-libs krb5-server krb5-workstation && rm -rf /var/cache/yum\n\n# ADD KERBEROS CONFIGURATION\nADD files/kerberos/krb5.conf /etc/krb5.conf\nADD files/kerberos/kdc.conf /var/kerberos/krb5kdc/kdc.conf\nADD files/kerberos/kadm5.acl /var/kerberos/krb5kdc/kadm5.acl\n\n# CREATE KERBEROS DATABASE\nRUN /usr/sbin/kdb5_util create -s -P password\n\n# ADD SUPERVISORD BOOTSTRAP KERBEROS SCRIPT\nADD files/bootstrap-kerberos.sh /root/bootstrap-kerberos.sh\nADD files/supervisord.d/bootstrap-kerberos.conf /etc/supervisord.d/bootstrap-kerberos.conf\n\n# ADD HADOOP PRINCIPALS\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey hdfs/hadoop-master@LABS.TERADATA.COM\"\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey mapred/hadoop-master@LABS.TERADATA.COM\"\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey yarn/hadoop-master@LABS.TERADATA.COM\"\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey HTTP/hadoop-master@LABS.TERADATA.COM\"\n\n# CREATE HADOOP KEYTAB FILES\nRUN /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/hadoop/conf/hdfs.keytab hdfs/hadoop-master HTTP/hadoop-master\"\nRUN /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/hadoop/conf/mapred.keytab mapred/hadoop-master HTTP/hadoop-master\"\nRUN /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/hadoop/conf/yarn.keytab yarn/hadoop-master HTTP/hadoop-master\"\nRUN /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/hadoop/conf/HTTP.keytab HTTP/hadoop-master\"\nRUN chown hdfs:hadoop /etc/hadoop/conf/hdfs.keytab\nRUN chown mapred:hadoop /etc/hadoop/conf/mapred.keytab\nRUN chown yarn:hadoop /etc/hadoop/conf/yarn.keytab\nRUN chown hdfs:hadoop /etc/hadoop/conf/HTTP.keytab\nRUN chmod 644 /etc/hadoop/conf/*.keytab\n\n# ENABLE HADOOP SECURITY\nADD files/conf/core-site.xml /etc/hadoop/conf/core-site.xml\nADD files/conf/hdfs-site.xml /etc/hadoop/conf/hdfs-site.xml\n\n# ENABLE MAPRED SECURITY\nADD files/conf/mapred-site.xml /etc/hadoop/conf/mapred-site.xml\nADD files/conf/taskcontroller.cfg /etc/hadoop/conf/taskcontroller.cfg\n\n# ENABLE YARN SECURITY\nADD files/conf/yarn-site.xml /etc/hadoop/conf/yarn-site.xml\nADD files/conf/container-executor.cfg /etc/hadoop/conf/container-executor.cfg\nRUN chmod 6050 /etc/hadoop/conf/container-executor.cfg\n\n# CREATE HIVE PRINCIPAL AND KEYTAB\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey hive/hadoop-master@LABS.TERADATA.COM\"\nRUN /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/hive/conf/hive.keytab hive/hadoop-master\"\n\n# ENABLE HIVE SECURITY\nADD files/conf/hive-site.xml /etc/hive/conf/hive-site.xml\nRUN chown hive:hadoop /etc/hive/conf/hive.keytab\nRUN chmod 644 /etc/hive/conf/hive.keytab\n\n# ENABLE AUTHORIZATION IN HIVE SERVER\nADD files/conf/hiveserver2-site.xml /etc/hive/conf/hiveserver2-site.xml\n\n# CREATE PRESTO PRINCIPAL AND KEYTAB\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey presto-server/presto-master.docker.cluster@LABS.TERADATA.COM\"\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey presto-server/presto-worker.docker.cluster@LABS.TERADATA.COM\"\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey presto-server/presto-worker-1.docker.cluster@LABS.TERADATA.COM\"\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey presto-server/presto-worker-2.docker.cluster@LABS.TERADATA.COM\"\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey HTTP/presto-master.docker.cluster@LABS.TERADATA.COM\"\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey presto-client/presto-master.docker.cluster@LABS.TERADATA.COM\"\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey hive/presto-master.docker.cluster@LABS.TERADATA.COM\"\nRUN mkdir -p /etc/presto/conf\nRUN /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/presto/conf/presto-server.keytab presto-server/presto-master.docker.cluster presto-server/presto-worker.docker.cluster presto-server/presto-worker-1.docker.cluster presto-server/presto-worker-2.docker.cluster\"\nRUN /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/presto/conf/presto-server-HTTP.keytab HTTP/presto-master.docker.cluster\"\nRUN /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/presto/conf/presto-client.keytab presto-client/presto-master.docker.cluster\"\nRUN /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/presto/conf/hive-presto-master.keytab hive/presto-master.docker.cluster\"\nRUN chmod 644 /etc/presto/conf/*.keytab\n\n# CREATE SSL KEYSTORE\nRUN keytool -genkeypair \\\n    -alias presto \\\n    -keyalg RSA \\\n    -keystore /etc/presto/conf/keystore.jks \\\n    -keypass password \\\n    -storepass password \\\n    -dname \"CN=presto-master, OU=, O=, L=, S=, C=\"\nRUN chmod 644 /etc/presto/conf/keystore.jks\n\n# EXPOSE KERBEROS PORTS\nEXPOSE\t88\nEXPOSE\t749\n\nCMD /root/startup.sh\n"
}