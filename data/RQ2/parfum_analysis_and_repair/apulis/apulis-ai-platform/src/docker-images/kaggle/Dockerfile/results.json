{
  "startTime": 1674254645870,
  "endTime": 1674254647251,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 51,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 61,
        "lineEnd": 61,
        "columnStart": 4,
        "columnEnd": 22
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 4,
        "columnEnd": 25
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 101,
        "lineEnd": 101,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 102,
        "lineEnd": 102,
        "columnStart": 139,
        "columnEnd": 179
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 61,
        "columnEnd": 90
      }
    },
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 22,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 73,
        "lineEnd": 73,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 22,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 25,
        "columnEnd": 114
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 73,
        "lineEnd": 73,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 30,
        "lineEnd": 42,
        "columnStart": 22,
        "columnEnd": 33
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 73,
        "lineEnd": 73,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 22,
        "columnEnd": 46
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 25,
        "columnEnd": 114
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 73
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 73,
        "lineEnd": 73,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 97
      }
    }
  ],
  "repairedDockerfile": "ARG BASE_TAG=staging\n\nFROM nvidia/cuda:9.2-cudnn7-devel-ubuntu16.04 AS nvidia\nFROM gcr.io/kaggle-images/python-tensorflow-whl:1.12.0-py36 as tensorflow_whl\nFROM gcr.io/kaggle-images/python:${BASE_TAG}\n\nADD clean-layer.sh  /tmp/clean-layer.sh\nRUN chmod +x /tmp/clean-layer.sh\n\n# Cuda support\nCOPY --from=nvidia /etc/apt/sources.list.d/cuda.list /etc/apt/sources.list.d/\nCOPY --from=nvidia /etc/apt/sources.list.d/nvidia-ml.list /etc/apt/sources.list.d/\nCOPY --from=nvidia /etc/apt/trusted.gpg /etc/apt/trusted.gpg.d/cuda.gpg\n\n# Ensure the cuda libraries are compatible with the custom Tensorflow wheels.\n# TODO(b/120050292): Use templating to keep in sync or COPY installed binaries from it.\nENV CUDA_VERSION=9.2.148\nENV CUDA_PKG_VERSION=9-2=$CUDA_VERSION-1\nLABEL com.nvidia.volumes.needed=\"nvidia_driver\"\nLABEL com.nvidia.cuda.version=\"${CUDA_VERSION}\"\nENV PATH=/usr/local/nvidia/bin:/usr/local/cuda/bin:${PATH}\n# The stub is useful to us both for built-time linking and run-time linking, on CPU-only systems.\n# When intended to be used with actual GPUs, make sure to (besides providing access to the host\n# CUDA user libraries, either manually or through the use of nvidia-docker) exclude them. One\n# convenient way to do so is to obscure its contents by a bind mount:\n#   docker run .... -v /non-existing-directory:/usr/local/cuda/lib64/stubs:ro ...\nENV LD_LIBRARY_PATH=\"/usr/local/nvidia/lib64:/usr/local/cuda/lib64:/usr/local/cuda/lib64/stubs\"\nENV NVIDIA_VISIBLE_DEVICES=all\nENV NVIDIA_DRIVER_CAPABILITIES=compute,utility\nENV NVIDIA_REQUIRE_CUDA=\"cuda>=9.2\"\nRUN apt-get update && apt-get install -y --no-install-recommends \\\r\n      cuda-cupti-$CUDA_PKG_VERSION \\\r\n      cuda-cudart-$CUDA_PKG_VERSION \\\r\n      cuda-cudart-dev-$CUDA_PKG_VERSION \\\r\n      cuda-libraries-$CUDA_PKG_VERSION \\\r\n      cuda-libraries-dev-$CUDA_PKG_VERSION \\\r\n      cuda-nvml-dev-$CUDA_PKG_VERSION \\\r\n      cuda-minimal-build-$CUDA_PKG_VERSION \\\r\n      cuda-command-line-tools-$CUDA_PKG_VERSION \\\r\n      libcudnn7=7.4.1.5-1+cuda9.2 \\\r\n      libcudnn7-dev=7.4.1.5-1+cuda9.2 \\\r\n      libnccl2=2.3.7-1+cuda9.2 \\\r\n      libnccl-dev=2.3.7-1+cuda9.2 && \\\r\n    ln -s /usr/local/cuda-9.2 /usr/local/cuda && \\\r\n    ln -s /usr/local/cuda/lib64/stubs/libcuda.so /usr/local/cuda/lib64/stubs/libcuda.so.1 && \\\n    /tmp/clean-layer.sh && rm -rf /var/lib/apt/lists/*;\n\n# Reinstall packages with a separate version for GPU support\n# Tensorflow\nCOPY --from=tensorflow_whl /tmp/tensorflow_gpu/*.whl /tmp/tensorflow_gpu/\nRUN pip uninstall -y tensorflow && \\\n    pip install --no-cache-dir /tmp/tensorflow_gpu/tensorflow*.whl && \\\n    rm -rf /tmp/tensorflow_gpu && \\\n    conda uninstall -y pytorch-cpu torchvision-cpu && \\\n    conda install -y pytorch torchvision cudatoolkit=9.2 -c pytorch && \\\n    pip uninstall -y mxnet && \\\n    # b/126259508 --no-deps prevents numpy from being downgraded.\r\n    pip install --no-cache-dir --no-deps mxnet-cu92 && \\\n    /tmp/clean-layer.sh\n\n# Install GPU-only packages\nRUN pip install --no-cache-dir pycuda && \\\n    pip install --no-cache-dir cupy-cuda92 && \\\n    pip install --no-cache-dir pynvrtc && \\\n    /tmp/clean-layer.sh\n\n# Re-add TensorBoard Jupyter extension patch\nADD patches/tensorboard/notebook.py /opt/conda/lib/python3.6/site-packages/tensorboard/notebook.py\n\nRUN apt-get install --no-install-recommends -y openssh-server sudo screen && rm -rf /var/lib/apt/lists/*;\n\n# netcore 2.0\n\nRUN apt-get install --no-install-recommends -y software-properties-common && rm -rf /var/lib/apt/lists/*;\nRUN curl -f https://packages.microsoft.com/keys/microsoft.asc | gpg --batch --dearmor > microsoft.gpg\nRUN mv microsoft.gpg /etc/apt/trusted.gpg.d/microsoft.gpg\nRUN sh -c 'echo \"deb [arch=amd64] https://packages.microsoft.com/repos/microsoft-ubuntu-xenial-prod xenial main\" > /etc/apt/sources.list.d/dotnetdev.list'\nRUN add-apt-repository \"deb http://security.ubuntu.com/ubuntu xenial-security main\"\nRUN apt-get update && apt-get install -y --no-install-recommends libicu55 && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends -y dotnet-sdk-2.2 && rm -rf /var/lib/apt/lists/*;\n# RUN apt-get install -y aspnetcore-runtime-2.2  dotnet-runtime-2.2 dotnet-runtime-deps-2.2 dotnet-sdk-2.2\n\n# Gdal\n# RUN add-apt-repository -y ppa:ubuntugis/ubuntugis-unstable\n# RUN apt update -y\n# RUN apt install -y libgdal-dev gdal-bin python-gdal python3-gdal vim htop\n# RUN conda remove -y ipykernel\n# RUN conda install -y gdal ipykernel jupyterlab\n# RUN conda install -y gdal\n# RUN conda update -y conda\n# RUN conda update -y jupyter\n# RUN conda install -c conda-forge jupyterlab\n# RUN conda create -n ipykernel_py2 python=2 ipykernel\n# RUN conda create -n ipykernel_py3 python=3 ipykernel\n# RUN source activate ipykernel_py2\n# RUN source activate ipykernel_py3\n# RUN python -m ipykernel install --user\nRUN apt-get update -y && apt-get install --no-install-recommends -y python3-pycurl locales ssh-askpass python3-tk python3-pip python3-dev && rm -rf /var/lib/apt/lists/*;\nRUN pip install --no-cache-dir --upgrade pip\nRUN pip install --no-cache-dir mechanize\nRUN apt-get install --no-install-recommends -y firefox unzip xvfb libxi6 libgconf-2-4 default-jdk && rm -rf /var/lib/apt/lists/*;\nRUN pip install --no-cache-dir selenium PyVirtualDisplay\nRUN wget https://github.com/mozilla/geckodriver/releases/download/v0.14.0/geckodriver-v0.14.0-linux64.tar.gz -O /tmp/geckodriver.tar.gz && tar -C /opt -xzf /tmp/geckodriver.tar.gz && rm /tmp/geckodriver.tar.gz\n\n# project file\nRUN pip3 uninstall pil\nRUN pip3 install --no-cache-dir youtube-dl face_recognition glob3 opencv-python pillow\n\n\n\nENV APACHE_RUN_USER www-data\nENV APACHE_RUN_GROUP www-data\nENV APACHE_LOG_DIR /var/log/apache2\n"
}