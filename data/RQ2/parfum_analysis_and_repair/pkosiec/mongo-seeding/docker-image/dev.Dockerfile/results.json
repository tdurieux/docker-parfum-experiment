{
  "startTime": 1674253512516,
  "endTime": 1674253513871,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 66,
        "lineEnd": 66,
        "columnStart": 4,
        "columnEnd": 36
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Run with context of the upper level directory\n\n#\n# Stage 1: Core\n#\n\nFROM node:17-alpine AS coreBuilder\nLABEL Maintainer=\"Pawel Kosiec <pawel@kosiec.net>\"\n\nENV CORE_DIR=./core\nWORKDIR /app\n\n# Copy sources\nCOPY $CORE_DIR/package.json $CORE_DIR/package-lock.json $CORE_DIR/tsconfig.json /app/\nCOPY $CORE_DIR/src /app/src/\n\n# Install dependencies\nRUN npm install --no-optional && npm cache clean --force;\n\n# Build app\nRUN npm run build\n\n# Remove sources\nRUN rm -rf /app/src/ &&  \\\n    rm -rf /app/node_modules/\nRUN npm i --production --no-optional && npm cache clean --force;\n\n#\n# Stage 2: CLI\n#\n\nFROM node:17-alpine as cliBuilder\n\nENV CLI_DIR=./cli\nWORKDIR /app\n\n# Install dependencies\nCOPY $CLI_DIR/package.json $CLI_DIR/package-lock.json $CLI_DIR/tsconfig.json /app/\nRUN npm i --no-optional && npm cache clean --force;\n\n# Copy built core\nCOPY --from=coreBuilder /app/ node_modules/mongo-seeding/\n\n# Copy app sources\nCOPY $CLI_DIR/src/ /app/src/\nCOPY $CLI_DIR/bin/ /app/bin/\n\n# Build app\nRUN npm run build\n\n# Remove unnecessary sources\nRUN rm -rf /app/src/ && \\\n    rm -rf /app/node_modules/\n\n#\n# Stage 3: Final Docker image\n#\n\nFROM node:17-alpine\nLABEL Maintainer=\"Pawel Kosiec <pawel@kosiec.net>\"\n\nWORKDIR /app\n\nCOPY --from=cliBuilder /app/ /app/\n\n# Create a symlink\nRUN npm i --production --no-optional && \\\n    npm link && \\\n    rm -rf /app/node_modules/mongo-seeding/ && npm cache clean --force;\n\n# Copy built core\nCOPY --from=coreBuilder /app/ /app/node_modules/mongo-seeding/\n\nWORKDIR /data\nCMD seed"
}