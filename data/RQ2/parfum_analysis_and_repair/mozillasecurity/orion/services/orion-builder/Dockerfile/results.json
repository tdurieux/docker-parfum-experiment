{
  "startTime": 1674252402194,
  "endTime": 1674252403272,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 7,
        "columnEnd": 32
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# This Source Code Form is subject to the terms of the Mozilla Public\n# License, v. 2.0. If a copy of the MPL was not distributed with this\n# file, You can obtain one at https://mozilla.org/MPL/2.0/.\n\nFROM alpine:latest\n\nLABEL maintainer Jesse Schwartzentruber <truber@mozilla.com>\n\nARG REGISTRY_VER=\"b804bcd6a44de56fcf8ff3f0ababae7479ad608e\"\nARG IMG_VER=\"3667c6a05b1a2c2c6b680e2323fbcc9ed76947a8\"\nARG FUSE_OVERLAYFS_VER=\"refs/tags/v1.4.0\"\n\nCOPY services/orion-builder /src/orion-builder\nRUN retry() { \\\n    { i=0; while [ $i -lt 9 ]; do \"$@\" && return || sleep 30; i=\"$((i+1))\"; done; \"$@\"; } \\\n    && retry apk add --no-cache \\\n        # base packages\n        git \\\n        openssl \\\n        skopeo \\\n        # fuse-overlayfs deps\n        autoconf \\\n        automake \\\n        build-base \\\n        fuse3 \\\n        fuse3-dev \\\n        linux-headers \\\n        # img deps\n        bash \\\n        build-base \\\n        go \\\n        libseccomp-dev \\\n        pigz \\\n        runc \\\n        shadow-uidmap \\\n        # orion-builder deps\n        build-base \\\n        py3-pip \\\n        py3-requests \\\n        py3-wheel \\\n        python3 \\\n        python3-dev \\\n    # build fuse-overlayfs\n    && git init /fuse-overlayfs \\\n    && cd /fuse-overlayfs \\\n    && git remote add origin https://github.com/containers/fuse-overlayfs \\\n    && retry git fetch -q --depth 1 --no-tags origin \"$FUSE_OVERLAYFS_VER:$FUSE_OVERLAYFS_VER\" \\\n    && git -c advice.detachedHead=false checkout \"$FUSE_OVERLAYFS_VER\" \\\n    && ./autogen.sh \\\n    && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix /usr \\\n    && make clean \\\n    && make \\\n    && make install \\\n    && cd / \\\n    && rm -rf /usr/share/man/man1 /fuse-overlayfs \\\n    # build img with fuse-overlayfs backend\n    && git init /img \\\n    && cd /img \\\n    && git remote add origin https://github.com/genuinetools/img \\\n    && retry git fetch -q --depth 1 --no-tags origin \"$IMG_VER\" \\\n    && git -c advice.detachedHead=false checkout \"$IMG_VER\" \\\n    && retry go get -u github.com/jteeuwen/go-bindata/... \\\n    && retry make BUILDTAGS=\"seccomp noembed\" \\\n    && strip img \\\n    && mv img /usr/bin \\\n    && cd / \\\n    && rm -rf /img /root/.cache /root/go \\\n    # install orion-builder\n    && ln -s /usr/bin/python3 /usr/bin/python \\\n    && retry pip --no-cache-dir --disable-pip-version-check install https://github.com/mozilla/task-boot/archive/0.3.2.tar.gz \\\n    && retry pip --no-cache-dir --disable-pip-version-check install -e /src/orion-builder \\\n    && find /usr/lib/python*/site-packages -name \"*.so\" -exec strip \"{}\" + \\\n    && rm -rf /root/.cache /usr/bin/__pycache__ \\\n    # precompile .py files\n    && python -m compileall -b -q /usr/lib \\\n    && find /usr/lib -name \\*.py -delete \\\n    && find /usr/lib -name __pycache__ -exec rm -rf \"{}\" + \\\n    # install docker registry\n    && retry wget -q -O /bin/registry https://github.com/docker/distribution-library-image/raw/$REGISTRY_VER/amd64/registry \\\n    && retry wget -q -O /root/registry.yml https://github.com/docker/distribution-library-image/raw/$REGISTRY_VER/amd64/config-example.yml \\\n    && chmod +x /bin/registry \\\n    # cleanup\n    && apk del \\\n        autoconf \\\n        automake \\\n        bash \\\n        build-base \\\n        fuse3-dev \\\n        go \\\n        libseccomp-dev \\\n        linux-headers \\\n        py3-pip \\\n        py3-wheel \\\n        python3-dev \\\n   }\n"
}