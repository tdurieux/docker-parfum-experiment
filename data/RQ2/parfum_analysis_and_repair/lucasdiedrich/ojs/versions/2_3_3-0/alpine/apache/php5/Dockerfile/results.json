{
  "startTime": 1674220914528,
  "endTime": 1674220915622,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 95,
        "lineEnd": 95,
        "columnStart": 4,
        "columnEnd": 46
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM alpine:3.8\n\nLABEL maintainer=\"Public Knowledge Project <marc.bria@gmail.com>\"\n\nWORKDIR /var/www/html\n\nENV COMPOSER_ALLOW_SUPERUSER=1  \\\n    SERVERNAME=\"localhost\"      \\\n    HTTPS=\"on\"                  \\\n    OJS_VERSION=ojs-2_3_3-0 \\\n    OJS_CLI_INSTALL=\"0\"         \\\n    OJS_DB_HOST=\"localhost\"     \\\n    OJS_DB_USER=\"ojs\"           \\\n    OJS_DB_PASSWORD=\"ojs\"       \\\n    OJS_DB_NAME=\"ojs\"           \\\n    OJS_WEB_CONF=\"/etc/apache2/conf.d/ojs.conf\"\t\\\n    OJS_CONF=\"/var/www/html/config.inc.php\"\n\n\n# PHP_INI_DIR to be symmetrical with official php docker image\nENV PHP_INI_DIR /etc/php/5.6\n\n# When using Composer, disable the warning about running commands as root/super user\nENV COMPOSER_ALLOW_SUPERUSER=1\n\n# Basic packages\nENV PACKAGES \t\t\\\n\tapache2 \t\t\\\n\tapache2-ssl \t\\\n\tapache2-utils \t\\\n\tca-certificates \\\n\tcurl \t\t\t\\\n\tttf-freefont\t\\\n\tdcron \t\t\t\\\n\tphp5\t\t\t\\\n\tphp5-cli\t\t\\\n\tphp5-apache2\t\\\n\trunit \t\t\t\\\n\tsupervisor\n\n#\tphp5-fpm \t\t\\\n\n# PHP extensions\nENV PHP_EXTENSIONS\t\\\n\tphp5-bcmath\t\t\\\n\tphp5-bz2\t\t\\\n\tphp5-calendar\t\\\n\tphp5-ctype\t\t\\\n\tphp5-curl\t\t\\\n\tphp5-dom\t\t\\\n\tphp5-exif\t\t\\\n\tphp5-ftp\t\t\\\n\tphp5-gd \t\t\\\n\tphp5-gettext\t\\\n\tphp5-iconv\t\t\\\n\tphp5-json\t\t\\\n\tphp5-mcrypt\t\t\\\n\tphp5-mysql\t\t\\\n\tphp5-opcache\t\\\n\tphp5-openssl\t\\\n\tphp5-pdo_mysql\t\\\n\tphp5-phar\t\t\\\n\tphp5-posix\t\t\\\n\tphp5-shmop\t\t\\\n\tphp5-sockets\t\\\n\tphp5-sysvmsg\t\\\n\tphp5-sysvsem\t\\\n\tphp5-sysvshm\t\\\n\tphp5-xml\t\t\\\n\tphp5-xmlreader\t\\\n\tphp5-zip\t\t\\\n\tphp5-zlib\n\n# Required to build OJS:\nENV BUILDERS \t\t\\\n\tgit \t\t\t\\\n\tnodejs \t\t\t\\\n\tnpm\n\n# To make a smaller image, we start with the copy.\n# This let us joining runs in a single layer.\nCOPY exclude.list /tmp/exclude.list\n\nRUN set -xe \\\n\t&& apk add --no-cache --virtual .build-deps $BUILDERS \\\n \t&& apk add --no-cache $PACKAGES \\\n\t&& apk add --no-cache $PHP_EXTENSIONS \\\n# Building OJS:\n\t# Configure and download code from git\n\t&& git config --global url.https://.insteadOf git:// \\\n\t&& git config --global advice.detachedHead false \\\n\t&& git clone --depth 1 --single-branch --branch $OJS_VERSION --progress https://github.com/pkp/ojs.git . \\\n\t&& git submodule update --init --recursive >/dev/null \\\n\t&& ln -s /usr/bin/php5 /usr/bin/php \\\n\t# Composer vudu: \\\n\t&& curl -f -sS https://getcomposer.org/installer | php -- --install-dir=/usr/local/bin --filename=composer.phar \\\n# Create directories\n  && mkdir -p /var/www/files /run/apache2  /run/supervisord/ \\\n\t&& cp config.TEMPLATE.inc.php config.inc.php \\\n\t&& chown -R apache:apache /var/www/* \\\n# Prepare freefont for captcha\n\t&& ln -s /usr/share/fonts/TTF/FreeSerif.ttf /usr/share/fonts/FreeSerif.ttf \\\n# Prepare crontab\n\t&& echo \"0 * * * *   ojs-run-scheduled\" | crontab - \\\n# Prepare httpd.conf\n\t&& sed -i -e '\\#<Directory />#,\\#</Directory>#d' /etc/apache2/httpd.conf \\\n\t&& sed -i -e \"s/^ServerSignature.*/ServerSignature Off/\" /etc/apache2/httpd.conf \\\n# Clear the image (list of files to be deleted in exclude.list).\n  && rm -rf $(cat /tmp/exclude.list) \\\n\t&& apk del --no-cache .build-deps \\\n\t&& rm -rf /tmp/* \\\n\t&& find . \\( -name .gitignore -o -name .gitmodules -o -name .keepme \\) -exec rm '{}' \\;\n\nCOPY root/ /\n\nEXPOSE 80 443\n\nVOLUME [ \"/var/www/files\", \"/var/www/html/public\" ]\n\nCMD [\"/usr/bin/supervisord\", \"-c\", \"/etc/supervisord.conf\"]\n"
}