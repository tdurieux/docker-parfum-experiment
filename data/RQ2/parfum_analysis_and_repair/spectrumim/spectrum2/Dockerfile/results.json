{
  "startTime": 1674251185047,
  "endTime": 1674251186810,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 2,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 4,
        "columnEnd": 75
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 171
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 73,
        "lineEnd": 76,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 2,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 130,
        "lineEnd": 130,
        "columnStart": 4,
        "columnEnd": 74
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 141,
        "lineEnd": 150,
        "columnStart": 2,
        "columnEnd": 8
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 4,
        "columnEnd": 75
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 171
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 73,
        "lineEnd": 76,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 2,
        "columnEnd": 49
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 130,
        "lineEnd": 130,
        "columnStart": 4,
        "columnEnd": 74
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 4,
        "columnEnd": 75
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 171
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 73,
        "lineEnd": 76,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 2,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 130,
        "lineEnd": 130,
        "columnStart": 4,
        "columnEnd": 74
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 141,
        "lineEnd": 150,
        "columnStart": 2,
        "columnEnd": 8
      }
    }
  ],
  "repairedDockerfile": "FROM debian:bullseye-backports as base\n\nARG DEBIAN_FRONTEND=noninteractive\nARG APT_LISTCHANGES_FRONTEND=none\n\nRUN apt-get update -qq\nRUN apt-get install --no-install-recommends -y dpkg-dev devscripts curl git && rm -rf /var/lib/apt/lists/*;\nRUN echo \"deb https://packages.spectrum.im/spectrum2/ bullseye main\" | tee -a /etc/apt/sources.list\nRUN echo \"deb-src https://packages.spectrum.im/spectrum2/ bullseye main\" | tee -a /etc/apt/sources.list\nRUN curl -f https://packages.spectrum.im/packages.key | apt-key add -\n\nRUN apt-get update -qq\nRUN apt-get build-dep --no-install-recommends -y spectrum2\nRUN apt-get install --no-install-recommends -y libminiupnpc-dev libnatpmp-dev && rm -rf /var/lib/apt/lists/*;\n\nRUN apt-get install --no-install-recommends -y cmake && rm -rf /var/lib/apt/lists/*;\n\n#TODO include in Build-Depends\nRUN apt-get install --no-install-recommends -y libssl-dev && rm -rf /var/lib/apt/lists/*;\n\n# Spectrum 2\nCOPY . spectrum2/\n\nFROM base as test\n\nARG DEBIAN_FRONTEND=noninteractive\nARG APT_LISTCHANGES_FRONTEND=none\n\nWORKDIR /spectrum2\n\nRUN apt-get install --no-install-recommends -y prosody ngircd python3-sleekxmpp python3-dateutil python3-dnspython libcppunit-dev purple-xmpp-carbons libglib2.0-dev psmisc && rm -rf /var/lib/apt/lists/*;\n\nRUN cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_TESTS=ON -DENABLE_QT4=OFF -DCMAKE_UNITY_BUILD=ON . && make -j4\n\nENTRYPOINT [\"make\", \"extended_test\"]\n\nFROM base as test-clang\n\nARG DEBIAN_FRONTEND=noninteractive\nARG APT_LISTCHANGES_FRONTEND=none\n\nRUN curl -fsSL https://apt.llvm.org/llvm-snapshot.gpg.key | apt-key add -\n\nRUN echo 'deb http://apt.llvm.org/bullseye/ llvm-toolchain-bullseye-13 main' > /etc/apt/sources.list.d/llvm.list\nRUN apt-get update -qq\n\nRUN apt-get install --no-install-recommends -y libcppunit-dev clang-13 lld-13 && rm -rf /var/lib/apt/lists/*;\n\nWORKDIR /spectrum2\n\nRUN cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_TESTS=ON -DENABLE_QT4=OFF -DCMAKE_UNITY_BUILD=ON -DCMAKE_C_COMPILER=/usr/bin/clang-13 -DCMAKE_CXX_COMPILER=/usr/bin/clang++-13 -DCMAKE_EXE_LINKER_FLAGS=-fuse-ld=lld -DCMAKE_SHARED_LINKER_FLAGS=-fuse-ld=lld . && make -j4\n\nENTRYPOINT [\"make\", \"test\"]\n\nFROM spectrum2/alpine-build-environment:latest as test-musl\n\nCOPY . /spectrum2/\n\nWORKDIR /spectrum2\n\nRUN cmake -DCMAKE_BUILD_TYPE=RelWithDebInfo -DENABLE_TESTS=ON -DENABLE_QT4=OFF -DCMAKE_UNITY_BUILD=ON . && make -j4\n\nENTRYPOINT [\"make\", \"test\"]\n\nFROM base as staging\n\nARG DEBIAN_FRONTEND=noninteractive\nARG APT_LISTCHANGES_FRONTEND=none\n\nWORKDIR /spectrum2/packaging/debian/\n\nRUN /bin/bash ./build_spectrum2.sh\n\nRUN apt-get install --no-install-recommends -y libjson-glib-dev \\\n\t\tgraphicsmagick-imagemagick-compat libsecret-1-dev libnss3-dev \\\n\t\tlibwebp-dev libgcrypt20-dev libpng-dev libglib2.0-dev \\\n\t\tlibprotobuf-c-dev protobuf-c-compiler libmarkdown2-dev && rm -rf /var/lib/apt/lists/*;\n\nRUN echo \"---> Installing purple-instagram\" && \\\n\t\tgit clone https://github.com/EionRobb/purple-instagram.git && \\\n\t\tcd purple-instagram && \\\n\t\tmake && \\\n\t\tmake DESTDIR=/tmp/out install\n\nRUN echo \"---> Installing icyque\" && \\\n\t\tgit clone https://github.com/EionRobb/icyque.git && \\\n\t\tcd icyque && \\\n\t\tmake && \\\n\t\tmake DESTDIR=/tmp/out install\n\nRUN echo \"---> Install Steam\" && \\\n\t\tgit clone https://github.com/EionRobb/pidgin-opensteamworks.git && \\\n\t\tcd pidgin-opensteamworks/steam-mobile && \\\n\t\tmake && \\\n\t\tmake DESTDIR=/tmp/out install\n\nRUN echo \"---> purple-gowhatsapp\" && \\\n\t\tapt-get -y --no-install-recommends install -t bullseye-backports golang && \\\n\t\tgit clone https://github.com/hoehermann/purple-gowhatsapp.git && \\\n\t\tcd purple-gowhatsapp && \\\n\t\tgit checkout v1.3.0 && \\\n\t\tcmake . && \\\n\t\tmake && \\\n\t\tmake DESTDIR=/tmp/out install && rm -rf /var/lib/apt/lists/*;\n\nRUN echo \"---> purple-battlenet\" && \\\ngit clone --recursive https://github.com/EionRobb/purple-battlenet && \\\n\t\tcd purple-battlenet && \\\n\t\tmake && \\\n\t\tmake DESTDIR=/tmp/out install\n\nRUN echo \"---> purple-hangouts\" && \\\ngit clone --recursive https://github.com/EionRobb/purple-hangouts && \\\n\t\tcd purple-hangouts && \\\n\t\tmake && \\\n\t\tmake DESTDIR=/tmp/out install\n\nRUN echo \"---> purple-mattermost\" && \\\ngit clone --recursive https://github.com/EionRobb/purple-mattermost && \\\n\t\tcd purple-mattermost && \\\n\t\tmake && \\\n\t\tmake DESTDIR=/tmp/out install\n\n\nFROM debian:bullseye-slim as production\n\nEXPOSE 8080\nVOLUME [\"/etc/spectrum2/transports\", \"/var/lib/spectrum2\"]\n\nRUN apt-get update -qq\nRUN apt-get install --no-install-recommends -y curl ca-certificates gnupg1 && rm -rf /var/lib/apt/lists/*;\n\nRUN echo \"deb https://packages.spectrum.im/spectrum2/ bullseye main\" | tee -a /etc/apt/sources.list\nRUN curl -fsSL https://packages.spectrum.im/packages.key | apt-key add -\nRUN echo \"deb http://download.opensuse.org/repositories/home:/ars3n1y/Debian_11/ /\" | tee /etc/apt/sources.list.d/home:ars3n1y.list\nRUN curl -fsSL https://download.opensuse.org/repositories/home:ars3n1y/Debian_11/Release.key | apt-key add\nRUN apt-get update -qq\n\nCOPY --from=staging spectrum2/packaging/debian/*.deb /tmp/\n\nRUN echo \"---> Installing libpurple plugins\" && \\\n\t\tDEBIAN_FRONTEND=noninteractive apt install --no-install-recommends -y \\\n\t\tpidgin-sipe \\\n\t\tlibpurple-telegram-tdlib \\\n\t\tlibtdjson1.7.9 \\\n\t\tpurple-discord \\\n\t\tpurple-facebook \\\n\t\tlibmarkdown2 \\\n\t\tskypeweb \\\n\t\t/tmp/*.deb \\\n\t\tnodejs \\\n\t\t&& rm -rf /var/lib/apt/lists/*\n\n\nCOPY --from=staging /tmp/out/* /usr/\n\nCOPY --from=staging spectrum2/packaging/docker/run.sh /run.sh\n\nRUN rm -rf /tmp/*.deb\n\nENTRYPOINT [\"/run.sh\"]\n"
}