{
  "startTime": 1674250025396,
  "endTime": 1674250026147,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 29,
        "lineEnd": 29,
        "columnStart": 4,
        "columnEnd": 15
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "ARG PHP_TAG=\"7.4-cli-alpine3.13\"\nARG COMPOSER_TAG=\"2.0.11\"\n\nFROM php:$PHP_TAG as ext-builder\nRUN docker-php-source extract && \\\n    apk add --no-cache --virtual .phpize-deps $PHPIZE_DEPS\n\nFROM ext-builder as ext-inotify\nRUN pecl install inotify && \\\n    docker-php-ext-enable inotify\n\nFROM ext-builder as ext-pcntl\nRUN docker-php-ext-install pcntl\n\nFROM ext-builder as ext-intl\nRUN apk add --no-cache icu-dev && \\\n    docker-php-ext-install intl\n\nFROM ext-builder as ext-xdebug\nRUN pecl install xdebug && \\\n    docker-php-ext-enable xdebug\n\nFROM ext-builder as ext-swoole\nRUN apk add --no-cache git\nARG SWOOLE_VERSION=\"4.5.11\"\nRUN if $(echo \"$SWOOLE_VERSION\" | grep -qE '^[4-9]\\.[0-9]+\\.[0-9]+$'); then SWOOLE_GIT_REF=\"v$SWOOLE_VERSION\"; else SWOOLE_GIT_REF=\"$SWOOLE_VERSION\"; fi && \\\n    git clone https://github.com/swoole/swoole-src.git --branch \"$SWOOLE_GIT_REF\" --depth 1 && \\\n    cd swoole-src && \\\n    phpize && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" && \\\n    make && \\\n    make install && \\\n    docker-php-ext-enable swoole\n\nFROM ext-builder as ext-pcov\nRUN pecl install pcov && \\\n    docker-php-ext-enable pcov\nRUN echo \"pcov.enabled=1\" >> /usr/local/etc/php/conf.d/docker-php-ext-pcov.ini && \\\n    echo \"pcov.directory=/usr/src/app/src\" >> /usr/local/etc/php/conf.d/docker-php-ext-pcov.ini\n\nFROM php:$PHP_TAG as base\nWORKDIR /usr/src/app\nRUN addgroup -g 1000 -S runner && \\\n    adduser -u 1000 -S app -G runner && \\\n    chown app:runner /usr/src/app\nRUN apk add --no-cache libstdc++ icu lsof\n# php -i | grep 'PHP API' | sed -e 's/PHP API => //'\nARG PHP_API_VERSION=\"20190902\"\nCOPY --from=ext-swoole /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/swoole.so /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/swoole.so\nCOPY --from=ext-swoole /usr/local/etc/php/conf.d/docker-php-ext-swoole.ini /usr/local/etc/php/conf.d/docker-php-ext-swoole.ini\nCOPY --from=ext-inotify /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/inotify.so /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/inotify.so\nCOPY --from=ext-inotify /usr/local/etc/php/conf.d/docker-php-ext-inotify.ini /usr/local/etc/php/conf.d/docker-php-ext-inotify.ini\nCOPY --from=ext-pcntl /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/pcntl.so /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/pcntl.so\nCOPY --from=ext-pcntl /usr/local/etc/php/conf.d/docker-php-ext-pcntl.ini /usr/local/etc/php/conf.d/docker-php-ext-pcntl.ini\nCOPY --from=ext-intl /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/intl.so /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/intl.so\nCOPY --from=ext-intl /usr/local/etc/php/conf.d/docker-php-ext-intl.ini /usr/local/etc/php/conf.d/docker-php-ext-intl.ini\n\nFROM composer:${COMPOSER_TAG} AS composer-bin\nFROM base as app-installer\nENV COMPOSER_ALLOW_SUPERUSER=\"1\"\nCOPY --chown=app:runner --from=composer-bin /usr/bin/composer /usr/local/bin/composer\nCOPY composer.json composer.lock ./\nRUN composer validate\nARG COMPOSER_ARGS=\"install\"\nRUN composer ${COMPOSER_ARGS} --prefer-dist --no-progress --no-autoloader --ansi\nCOPY . ./\nRUN composer dump-autoload --classmap-authoritative --ansi\n\nFROM base as base-coverage-xdebug\nRUN apk add --no-cache bash\nARG PHP_API_VERSION=\"20190902\"\nCOPY --from=ext-xdebug /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/xdebug.so /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/xdebug.so\nCOPY --from=ext-xdebug /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini\nUSER app:runner\nENV COVERAGE=\"1\" \\\n    COMPOSER_ALLOW_SUPERUSER=\"1\" \\\n    XDEBUG_MODE=\"coverage\"\nCOPY --chown=app:runner --from=composer-bin /usr/bin/composer /usr/local/bin/composer\nCOPY --chown=app:runner --from=app-installer /usr/src/app ./\n\nFROM base as base-coverage-pcov\nARG PHP_API_VERSION=\"20190902\"\nCOPY --from=ext-pcov /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/pcov.so /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/pcov.so\nCOPY --from=ext-pcov /usr/local/etc/php/conf.d/docker-php-ext-pcov.ini /usr/local/etc/php/conf.d/docker-php-ext-pcov.ini\nUSER app:runner\nENV COVERAGE=\"1\" \\\n    COMPOSER_ALLOW_SUPERUSER=\"1\"\nCOPY --chown=app:runner --from=composer-bin /usr/bin/composer /usr/local/bin/composer\nCOPY --chown=app:runner --from=app-installer /usr/src/app ./\n\nFROM base as base-pcov-xdebug\nARG PHP_API_VERSION=\"20190902\"\nCOPY --from=ext-pcov /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/pcov.so /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/pcov.so\nCOPY --from=ext-pcov /usr/local/etc/php/conf.d/docker-php-ext-pcov.ini /usr/local/etc/php/conf.d/docker-php-ext-pcov.ini\nCOPY --from=ext-xdebug /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/xdebug.so /usr/local/lib/php/extensions/no-debug-non-zts-${PHP_API_VERSION}/xdebug.so\nCOPY --from=ext-xdebug /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini /usr/local/etc/php/conf.d/docker-php-ext-xdebug.ini\nUSER app:runner\nENV COVERAGE=\"1\" \\\n    COMPOSER_ALLOW_SUPERUSER=\"1\" \\\n    XDEBUG_MODE=\"coverage\"\nCOPY --chown=app:runner --from=composer-bin /usr/bin/composer /usr/local/bin/composer\nCOPY --chown=app:runner --from=app-installer /usr/src/app ./\n\nFROM base as cli\nUSER app:runner\nCOPY --chown=app:runner --from=app-installer /usr/src/app ./\nENTRYPOINT [\"./tests/Fixtures/Symfony/app/console\"]\nCMD [\"swoole:server:run\"]\n\nFROM cli as Composer\nENV COMPOSER_ALLOW_SUPERUSER=\"1\"\nCOPY --chown=app:runner --from=composer-bin /usr/bin/composer /usr/local/bin/composer\nENTRYPOINT [\"composer\"]\nCMD [\"test\"]\n\nFROM base-coverage-xdebug as CoverageXdebug\nENTRYPOINT [\"composer\"]\nCMD [\"unit-code-coverage\"]\n\nFROM base-coverage-pcov as CoveragePcov\nENTRYPOINT [\"composer\"]\nCMD [\"unit-code-coverage\"]\n\nFROM base-pcov-xdebug as MergeCodeCoverage\nENTRYPOINT [\"composer\"]\nCMD [\"merge-code-coverage\"]\n\nFROM base-coverage-xdebug as CoverageXdebugWithRetry\nENTRYPOINT [\"/bin/bash\"]\nCMD [\"tests/run-feature-tests-code-coverage.sh\"]\n"
}