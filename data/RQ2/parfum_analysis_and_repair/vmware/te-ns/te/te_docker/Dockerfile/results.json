{
  "startTime": 1674254980154,
  "endTime": 1674254981264,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 82,
        "lineEnd": 82,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 83,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 51,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 52,
        "lineEnd": 52,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 58,
        "lineEnd": 58,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 59,
        "lineEnd": 59,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 60,
        "lineEnd": 60,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 61,
        "lineEnd": 61,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 51,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 52,
        "lineEnd": 52,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 58,
        "lineEnd": 58,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 59,
        "lineEnd": 59,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 60,
        "lineEnd": 60,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 61,
        "lineEnd": 61,
        "columnStart": 4,
        "columnEnd": 29
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#**********************************************************************************************\n# Traffic Emulator for Network Services\n# Copyright 2020 VMware, Inc\n# The BSD-2 license (the \"License\") set forth below applies to all parts of\n# the Traffic Emulator for Network Services project. You may not use this file\n# except in compliance with the License.\n#\n# BSD-2 License\n#\n# Redistribution and use in source and binary forms, with or without modification,\n# are permitted provided that the following conditions are met:\n#\n# Redistributions of source code must retain the above copyright notice,\n# this list of conditions and the following disclaimer.\n#\n# Redistributions in binary form must reproduce the above copyright notice,\n# this list of conditions and the following disclaimer in the documentation\n# and/or other materials provided with the distribution.\n#\n# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY\n# EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES\n# OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.\n# IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT,\n# INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,\n# BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA,\n# OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n# WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)\n# ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY\n# OF SUCH DAMAGE\n#**********************************************************************************************\n\nFROM ubuntu:16.04\n\nENV IPADRESS=127.0.0.1\nENV FLASK_PORT=5000\nENV NGINX_PORT=5001\nENV GRAFANA_PORT=5002\nENV REDIS_PORT=6379\nENV POSTGRES_PORT=5432\nENV ZMQ_PORT=5555\nENV STAT_COLLECT_INTERVAL=15\nENV STAT_DUMP_INTERVAL=15\nENV WORKDR=/app/\nENV TZ=UTC\nENV LOGPATH=/tmp/\nENV LOGLEVEL=10\nENV LC_ALL C.UTF-8\nENV LANG C.UTF-8\n\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone\nRUN apt-get update && \\\n    apt-get install --no-install-recommends -y redis-server && \\\n    apt-get install --no-install-recommends -y python3 && \\\n    apt-get install --no-install-recommends -y supervisor && \\\n    apt-get -y --no-install-recommends install python3-pip --reinstall && \\\n    apt-get install --no-install-recommends -y nginx && \\\n    apt-get install --no-install-recommends -y net-tools && \\\n    apt-get install --no-install-recommends -y openssh-server && \\\n    apt-get install --no-install-recommends -y vim && \\\n    apt-get install --no-install-recommends -y sshpass && \\\n    apt-get install --no-install-recommends -y logrotate && \\\n    apt install --no-install-recommends -y libffi-dev && \\\n    wget --no-check-certificate https://dl.grafana.com/oss/release/grafana_7.0.1_amd64.deb && \\\n    dpkg -i grafana_7.0.1_amd64.deb && \\\n    rm grafana_7.0.1_amd64.deb && rm -rf /var/lib/apt/lists/*;\n\nRUN echo \"/tmp/*.log { \\n\\\nsu root root \\n\\\nsize 100M \\n\\\nrotate 5 \\n\\\ncompress \\n\\\ncopytruncate \\n\\\nmissingok \\n\\\n}\\n\" > /etc/logrotate.d/te-logs\nRUN chmod 0644 /etc/logrotate.d/te-logs\n\n#Creating a cron (Running cron job every 2 mins -- logrotate)\nRUN echo \"*/2 * * * * /usr/sbin/logrotate /etc/logrotate.d/te-logs\" > /etc/cron.d/cron_logrotate_te_logs\nRUN chmod 0644 /etc/cron.d/cron_logrotate_te_logs\nRUN crontab /etc/cron.d/cron_logrotate_te_logs\n\nCOPY te_docker/requirements.txt /tmp/\nRUN pip3 install --no-cache-dir --upgrade \"pip < 21.0\"\nRUN pip3 install --no-cache-dir --requirement /tmp/requirements.txt\n\nCOPY te_docker/setup_postgres.sh /tmp/\nRUN chmod 755 /tmp/setup_postgres.sh\nRUN /tmp/setup_postgres.sh\n\nCOPY open_source_licenses.tar.bz2 /\n\nCOPY te_docker/te.conf /etc/nginx/sites-available/default\nCOPY te_docker/postgres_grafana_config.yaml /etc/grafana/provisioning/datasources/\nCOPY te_docker/grafana_dashboard_config.yaml /etc/grafana/provisioning/dashboards/\nCOPY te_docker/udp_client_metrics_dashboard.json /var/lib/grafana/dashboards/\nCOPY te_docker/tcp_client_metrics_dashboard.json /var/lib/grafana/dashboards/\n\nADD TE.py \\\n    TE_CLASS.py \\\n    TE_UTILS.py \\\n    TE_WORK.py \\\n    TE_DP_CONFIG.py \\\n    GET_AND_RUN_DOCKER_IMAGE.py \\\n    te_json_schema.py \\\n    TE_METRICS.py \\\n    $WORKDR\n\nRUN mkdir $WORKDR/static\nCOPY te_swagger.json $WORKDR/static/\n\nCOPY tedp_docker.tar \\\n    /var/www/html/\nRUN md5sum /var/www/html/tedp_docker.tar > /var/www/html/check.sum\nARG IMAGE_ID=-1\nRUN echo $IMAGE_ID > /var/www/html/image.id\nRUN chmod -R 755 /var/www/html/\n\nRUN echo \"Done TE Dockerization!\\n\"\n\nENTRYPOINT sed -i \"s/5001/$NGINX_PORT/g\" /etc/nginx/sites-available/default && \\\n    redis-server --port $REDIS_PORT --daemonize yes && /etc/init.d/nginx restart && \\\n    sed -i \"s/5432/$POSTGRES_PORT/g\" /etc/postgresql/*/main/postgresql.conf && \\\n    service postgresql restart && \\\n    service cron start && \\\n    sed -i \"s/url: localhost:[0-9]*/url: localhost:$POSTGRES_PORT/g\" /etc/grafana/provisioning/datasources/postgres_grafana_config.yaml && \\\n    echo \"[supervisord]\" >> /etc/supervisord.conf && \\\n    echo \"nodaemon=true\" >> /etc/supervisord.conf && \\\n    echo \"[program:TE]\" >> /etc/supervisord.conf && \\\n    echo \"command=python3 $WORKDR/TE.py -m $IPADRESS -fp $FLASK_PORT -rp $REDIS_PORT -np $NGINX_PORT \\\n    -pp $POSTGRES_PORT -zp $ZMQ_PORT -gp $GRAFANA_PORT -ct $STAT_COLLECT_INTERVAL -dt $STAT_DUMP_INTERVAL \\\n    -lp $LOGPATH -ll $LOGLEVEL\" >> /etc/supervisord.conf && /usr/bin/supervisord\n"
}