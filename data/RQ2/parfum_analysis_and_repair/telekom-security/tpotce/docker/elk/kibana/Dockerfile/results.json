{
  "startTime": 1674253770818,
  "endTime": 1674253771797,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 8,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 16
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ubuntu:22.04\n#\n# VARS\nENV KB_VER=8.2.3\n# Include dist\nCOPY dist/ /root/dist/\n#\nRUN apt-get update -y && \\\n    apt-get install --no-install-recommends -y \\\n            aria2 \\\n            curl && \\\n#\n# Determine arch, get and install packages\n    ARCH=$(arch) && \\\n      if [ \"$ARCH\" = \"x86_64\" ]; then KB_ARCH=\"amd64\"; fi && \\\n      if [ \"$ARCH\" = \"aarch64\" ]; then KB_ARCH=\"arm64\"; fi && \\\n    echo \"$ARCH\" && \\\n    cd /root/dist/ && \\\n    aria2c -s 16 -x 16 https://artifacts.elastic.co/downloads/kibana/kibana-$KB_VER-$KB_ARCH.deb && \\\n    dpkg -i kibana-$KB_VER-$KB_ARCH.deb && \\\n#\n# Setup user, groups and configs\n    mkdir -p /usr/share/kibana/config \\\n             /usr/share/kibana/data && \\\n    cp /etc/kibana/kibana.yml /usr/share/kibana/config && \\\n    sed -i 's/#server.basePath: \"\"/server.basePath: \"\\/kibana\"/' /usr/share/kibana/config/kibana.yml && \\\n    sed -i 's/#server.host: \"localhost\"/server.host: \"0.0.0.0\"/' /usr/share/kibana/config/kibana.yml && \\\n    sed -i 's/#elasticsearch.hosts: \\[\"http:\\/\\/localhost:9200\"\\]/elasticsearch.hosts: \\[\"http:\\/\\/elasticsearch:9200\"\\]/' /usr/share/kibana/config/kibana.yml && \\\n    sed -i 's/#server.rewriteBasePath: false/server.rewriteBasePath: false/' /usr/share/kibana/config/kibana.yml && \\\n    echo \"xpack.reporting.roles.enabled: false\" >> /usr/share/kibana/config/kibana.yml && \\\n    echo \"elasticsearch.requestTimeout: 60000\" >> /usr/share/kibana/config/kibana.yml && \\\n    echo \"elasticsearch.shardTimeout: 60000\" >> /usr/share/kibana/config/kibana.yml && \\\n    echo \"kibana.autocompleteTimeout: 60000\" >> /usr/share/kibana/config/kibana.yml && \\\n    echo \"kibana.autocompleteTerminateAfter: 1000000\" >> /usr/share/kibana/config/kibana.yml && \\\n    rm -rf /usr/share/kibana/optimize/bundles/* && \\\n    /usr/share/kibana/bin/kibana --optimize --allow-root && \\\n    groupmod -g 2000 kibana && \\\n    usermod -u 2000 kibana && \\\n    chown -R root:kibana /etc/kibana && \\\n    chown -R kibana:kibana /usr/share/kibana/data \\\n                           /run/kibana \\\n\t\t\t   /var/log/kibana \\\n\t\t     \t   /var/lib/kibana && \\\n    chmod 755 -R /usr/share/kibana/config && \\\n#\n# Clean up\n    apt-get purge aria2 -y && \\\n    apt-get autoremove -y --purge && \\\n    apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/* /root/.cache /root/*\n#\n# Healthcheck\nHEALTHCHECK --retries=10 CMD curl -s -XGET 'http://127.0.0.1:5601'\n#\n# Start kibana\nSTOPSIGNAL SIGKILL\nUSER kibana:kibana\nCMD [\"/usr/share/kibana/bin/kibana\"]\n"
}