{
  "startTime": 1674217625220,
  "endTime": 1674217626713,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 51,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 19
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM jupyter/datascience-notebook:hub-1.4.2\n# https://hub.docker.com/r/jupyter/datascience-notebook/\n\nWORKDIR /\nUSER root\n# set local source.list\nRUN mv /etc/apt/sources.list /etc/apt/sources.list.bak\nCOPY ./linux_source/sources_ubuntu.list /etc/apt/sources.list\n\n# rstudio server / shiny ------------------\nCOPY scripts /rocker_scripts\n\nENV R_HOME=/opt/conda/lib/R\nENV R_LIB=/opt/conda/lib/R/library\nENV CRAN=https://packagemanager.rstudio.com/all/__linux__/focal/latest\nARG CRAN_URL=https://mirrors.tuna.tsinghua.edu.cn/CRAN\n\nENV S6_VERSION=v2.1.0.2\nENV RSTUDIO_VERSION=1.4.1717\nENV PANDOC_VERSION=default\n\nENV PATH=/usr/lib/rstudio-server/bin:$PATH\nRUN /rocker_scripts/install_rstudio.sh && \\\n    /rocker_scripts/install_pandoc.sh && \\\n    /rocker_scripts/install_shiny_server.sh && \\\n    ## folder permission\n    chown -R $NB_UID:$NB_UID /srv/shiny-server/ && \\\n    chown -R $NB_UID:$NB_UID /var/lib/shiny-server && \\\n    chown -R $NB_UID:$NB_UID /var/log/shiny-server && \\\n    fix-permissions \"${CONDA_DIR}\" && \\\n    fix-permissions \"/home/${NB_USER}\"\n\n# pkgs ------------------\n# py pgks\nENV RSESSION_PROXY_RSTUDIO_1_4=yes\nRUN conda install --quiet --yes pip && \\\n    python3 -m pip install --upgrade https://github.com/jupyterhub/jupyter-rsession-proxy/tarball/master &&\\\n    python3 -m pip install -i https://pypi.tuna.tsinghua.edu.cn/simple --no-cache \\\n        xgboost \\\n        sklearn2pmml \\\n        jupyter-shiny-proxy && \\ \n    rm -rf /tmp/* && \\\n    ## conda install\n    conda install --quiet --yes 'JayDeBeApi' 'openpyxl' && \\\n    conda clean --all -f -y && \\\n    fix-permissions \"${CONDA_DIR}\" && \\\n    fix-permissions \"/home/${NB_USER}\"\n\n# r pkgs\n# r-dbi https://github.com/r-dbi # service cron start\nRUN apt-get update && \\\n    apt-get install --no-install-recommends -y \\\n        qpdf \\\n        cron \\\n        default-jdk && \\\n    apt-get clean && rm -rf /var/lib/apt/lists/* && \\\n    # conda install r pkgs\n    conda install --quiet --yes \\\n        'r-png' 'r-reticulate' \\\n        'r-odbc' 'r-rjdbc' 'r-rpostgres' \\\n        'r-mlr3' 'r-scorecard' \\\n        'r-pkgdown' 'r-blogdown' && \\\n    conda clean --all -f -y && \\\n    ## install.packages r pkgs\n    R --quiet -e \"install.packages(c('RClickhouse', 'blastula', 'rjson', 'xgboost', 'tsibble', 'fable'), repos='${CRAN_URL}'); devtools::install_github('bnosac/cronR')\" && \\\n    rm -rf /tmp/* && \\\n    fix-permissions \"${CONDA_DIR}\" && \\\n    fix-permissions \"/home/${NB_USER}\"\n\n# shiny https://xiangyun.rbind.io/2021/08/shiny-in-production/\nRUN R --quiet -e \"install.packages(c( \\\n        'flexdashboard', 'bs4Dash', 'shinydashboard', 'shinydashboardPlus', \\\n        'shinyFeedback', 'shinyWidgets', \\\n        'bslib', 'sass', 'thematic', 'htmltools', 'jquerylib', 'htmlwidgets', \\\n        'plotly', 'echarts4r', 'leaflet', 'leaflet.minicharts', 'visNetwork', \\\n        'shinythemes', 'shinycssloaders', 'shinyBS', 'shiny.i18n', 'shinyFiles', 'miniUI', \\\n         'sparkline', 'incidence', 'EpiEstim'), repos='${CRAN_URL}')\"  && \\ \n    rm -rf /tmp/* && \\\n    fix-permissions \"${CONDA_DIR}\" && \\\n    fix-permissions \"/home/${NB_USER}\"\n\n# setting jupyter_shiny_proxy home directory to /srv/shiny-server\nRUN cd /opt/conda/lib/python3.9/site-packages/jupyter_shiny_proxy &&  \\\n    awk '{sub(/os.getcwd\\(\\)/,\"\\\"/srv/shiny-server\\\"\")}1' __init__.py > /tmp/temp.py && mv /tmp/temp.py __init__.py && \\ \n    cd /\n# setting for service cron start\nRUN chmod gu+rw /var/run/ && \\\n    chmod gu+s  /usr/sbin/cron\n\n# startup ------------------\n# R startup # https://rviews.rstudio.com/2017/04/19/r-for-enterprise-understanding-r-s-startup/\nRUN echo 'options(repos = c(CRAN = \"https://cran.rstudio.com/\", CRANextra = \"https://mirrors.tuna.tsinghua.edu.cn/CRAN/\"))' >> /opt/conda/lib/R/etc/Rprofile.site && \\\n    echo 'RETICULATE_PYTHON = \"/opt/conda/bin/python\"' >> /opt/conda/lib/R/etc/Renviron.site\n# R_HOME, R_LIBS, LD_LIBRARY_PATH, PATH\n\n# rstudio server config\nRUN echo 'session-default-working-dir=/home/jovyan/work' >> /etc/rstudio/rsession.conf && \\\n    echo 'session-default-new-project-dir=/home/jovyan/work' >> /etc/rstudio/rsession.conf\nCOPY ./config/rstudio-prefs.json /etc/rstudio/rstudio-prefs.json\n\nRUN mkdir -p /home/jovyan/share && \\\n    ln -s /home/jovyan/share /home/jovyan/work/share && \\\n    fix-permissions \"/home/${NB_USER}\"\n\nWORKDIR $HOME\nUSER $NB_UID\n\n\n# docker build -t shichenxie/dstudio_lab:ds1.4.2 -f ./Dockerfile_labds_jupyter1.4 .\n\n# fix openssl issue # https://github.com/tschaffter/rstudio/issues/1\n# RUN conda remove --force -y openssl\n"
}