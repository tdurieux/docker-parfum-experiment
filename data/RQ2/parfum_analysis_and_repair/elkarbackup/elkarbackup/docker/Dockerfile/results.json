{
  "startTime": 1674216264012,
  "endTime": 1674216265416,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 67,
        "lineEnd": 73,
        "columnStart": 22,
        "columnEnd": 9
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "##\n## Bootstrap & Build elkarbackup\n##\n\nFROM php:7.3-cli-alpine\n\nRUN apk add --no-cache \\\n      git \\\n      curl \\\n      grep \\\n      mysql-client \\\n      acl \\\n      rsnapshot \\\n    && docker-php-ext-install \\\n      pdo_mysql \\\n      pcntl\n\n# Prepare default directories\nRUN mkdir -p -m 777 \\\n      /app/elkarbackup \\\n      /app/uploads \\\n      /app/backups \\\n      /app/tmp \\\n      /app/.ssh\n\n# Download and install composer\nCOPY --from=composer:latest /usr/bin/composer /usr/bin/composer\n\n\nENV DOCKERDIR=./docker/\n\n## Copy Elkarbackup from this repo\nCOPY . /app/elkarbackup\nRUN set -ex; \\\n      cd /app/elkarbackup; \\\n      mkdir -p var/cache var/sessions var/log; \\\n      # Remove leftover parameters file\n      rm -f config/parameters.yaml \\\n      # This doctrine migration file was provoking an error as it was trying to\n      # copy a file to a hardcoded path it does not exist in this docker image.\n      # We can disable it without negative consequences\n      rm migrations/Version20130306101349.php;\n\n## Custom composer.json (database not required)\nCOPY $DOCKERDIR/composer.json.docker /app/elkarbackup/composer.json\n\n## Custom parameters.yml template with envars\nCOPY $DOCKERDIR/parameters.yaml.docker /app/elkarbackup/config/parameters.yaml.dist\n\n## Custom monolog.yaml (to log to stderr)\nCOPY $DOCKERDIR/monolog.yaml.docker /app/elkarbackup/config/packages/dev/monolog.yaml\n\n## Disable \"Manage parameters\" menu item\nCOPY $DOCKERDIR/src/Builder.php /app/elkarbackup/src/Menu/Builder.php\n\n## Composer install\nRUN set -ex; \\\n      cd /app/elkarbackup; \\\n      composer install --no-interaction\n\n\n##\n## PHP Apache image with Elkarbackup\n##\n\n\nFROM php:7.3-apache-buster\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n      default-mysql-client \\\n      acl \\\n      rsnapshot \\\n      sudo \\\n      git \\\n      zip \\\n    && rm -rf /var/lib/apt/lists/* \\\n    && docker-php-ext-install \\\n      pdo_mysql \\\n      pcntl\n\n# Download and install composer\nCOPY --from=composer:2.1 /usr/bin/composer /usr/bin/composer\n\nCOPY --from=0 /app /app\n\nENV DOCKERDIR=./docker/\n\n# Apache configuration\nCOPY $DOCKERDIR/elkarbackup.conf /etc/apache2/sites-available\nRUN a2enmod rewrite \\\n  && a2dissite 000-default \\\n  && a2dissite default-ssl \\\n  && a2ensite elkarbackup\n\n# Sudoers for script execution with environment variables\nRUN echo \"Cmnd_Alias ELKARBACKUP_SCRIPTS=/app/uploads/*\" >> /etc/sudoers.d/elkarbackup\nRUN echo \"Defaults!ELKARBACKUP_SCRIPTS env_keep += \\\"ELKARBACKUP_LEVEL ELKARBACKUP_EVENT ELKARBACKUP_URL ELKARBACKUP_ID ELKARBACKUP_PATH ELKARBACKUP_STATUS ELKARBACKUP_CLIENT_NAME ELKARBACKUP_JOB_NAME ELKARBACKUP_OWNER_EMAIL ELKARBACKUP_RECIPIENT_LIST ELKARBACKUP_CLIENT_TOTAL_SIZE ELKARBACKUP_JOB_TOTAL_SIZE ELKARBACKUP_JOB_RUN_SIZE ELKARBACKUP_CLIENT_STARTTIME ELKARBACKUP_CLIENT_ENDTIME ELKARBACKUP_JOB_STARTTIME ELKARBACKUP_JOB_ENDTIME ELKARBACKUP_SSH_ARGS\\\"\" >> /etc/sudoers.d/elkarbackup\nRUN echo \"elkarbackup ALL = NOPASSWD: ELKARBACKUP_SCRIPTS\" >> /etc/sudoers.d/elkarbackup\n\n# Add SSH default key location\nRUN echo \"    IdentityFile /app/.ssh/id_rsa\" >> /etc/ssh/ssh_config\n\n# Console commands log output\nRUN ln -sf /proc/1/fd/1 /var/log/output.log\n\n## Set timezone\nRUN ln -snf /usr/share/zoneinfo/Europe/Paris /etc/localtime && echo \"Europe/Paris\" > /etc/timezone\nRUN printf '[PHP]\\ndate.timezone = \"Europe/Paris\"\\n' > /usr/local/etc/php/conf.d/tzone.ini\n\nCOPY $DOCKERDIR/entrypoint.sh /\nCOPY $DOCKERDIR/envars.sh /\nRUN chmod u+x /entrypoint.sh\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD []\n\nVOLUME /app/backups\nEXPOSE 80\n\nLABEL maintainer=\"Xabi Ezpeleta <xezpeleta@gmail.com>\"\nLABEL org.opencontainers.image.source=https://github.com/elkarbackup/elkarbackup\nLABEL org.opencontainers.image.url=https://github.com/elkarbackup/elkarbackup/blob/master/docker/README.md\nLABEL org.opencontainers.image.documentation=https://github.com/elkarbackup/elkarbackup/blob/master/docker/README.md\n"
}