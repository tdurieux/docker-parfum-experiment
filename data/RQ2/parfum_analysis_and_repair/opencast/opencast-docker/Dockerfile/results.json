{
  "startTime": 1674249464045,
  "endTime": 1674249465048,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 73,
        "lineEnd": 73,
        "columnStart": 4,
        "columnEnd": 98
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 30,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 14
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Copyright 2016 The WWU eLectures Team All rights reserved.\n#\n# Licensed under the Educational Community License, Version 2.0\n# (the \"License\"); you may not use this file except in compliance with\n# the License. You may obtain a copy of the License at\n#\n#     http://opensource.org/licenses/ECL-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\nFROM docker.io/maven:3-jdk-11-slim AS build\n\nARG OPENCAST_REPO=\"https://github.com/opencast/opencast.git\"\nARG OPENCAST_VERSION=\"develop\"\nARG FFMPEG_VERSION=\"latest\"\n\nENV OPENCAST_SRC=\"/usr/src/opencast\" \\\n    OPENCAST_HOME=\"/opencast\" \\\n    OPENCAST_UHOME=\"/home/opencast\" \\\n    OPENCAST_UID=\"800\" \\\n    OPENCAST_GID=\"800\" \\\n    OPENCAST_USER=\"opencast\" \\\n    OPENCAST_GROUP=\"opencast\" \\\n    FFMPEG_VERSION=\"${FFMPEG_VERSION}\"\n\nRUN apt-get update \\\n && apt-get install -y --no-install-recommends \\\n      bzip2 \\\n      ca-certificates \\\n      g++ \\\n      gcc \\\n      git \\\n      gzip \\\n      libc-dev \\\n      make \\\n      openssl \\\n      tar \\\n      xz-utils && rm -rf /var/lib/apt/lists/*;\n\nRUN git clone https://github.com/ncopa/su-exec.git /tmp/su-exec \\\n && cd /tmp/su-exec \\\n && make \\\n && cp su-exec /usr/local/sbin\n\nRUN mkdir -p /tmp/ffmpeg \\\n && cd /tmp/ffmpeg \\\n && curl -f -sSL \"https://s3.opencast.org/opencast-ffmpeg-static/ffmpeg-${FFMPEG_VERSION}.tar.xz\" \\\n     | tar xJf - --strip-components 1 --wildcards '*/ffmpeg' '*/ffprobe' \\\n && chown root:root ff* \\\n && mv ff* /usr/local/bin\n\nRUN groupadd --system -g \"${OPENCAST_GID}\" \"${OPENCAST_GROUP}\" \\\n && useradd --system -M -N -g \"${OPENCAST_GROUP}\" -d \"${OPENCAST_UHOME}\" -u \"${OPENCAST_UID}\" \"${OPENCAST_USER}\" \\\n && mkdir -p \"${OPENCAST_SRC}\" \"${OPENCAST_HOME}\" \"${OPENCAST_UHOME}\" \\\n && chown -R \"${OPENCAST_USER}:${OPENCAST_GROUP}\" \"${OPENCAST_SRC}\" \"${OPENCAST_HOME}\" \"${OPENCAST_UHOME}\"\n\nUSER \"${OPENCAST_USER}\"\nWORKDIR \"${OPENCAST_SRC}\"\n\nRUN git clone --recursive \"${OPENCAST_REPO}\" . \\\n && git checkout \"${OPENCAST_VERSION}\" \\\n && sed -i \"s#https://mvn.opencast.org/#https://radosgw.public.os.wwu.de/mvn.opencast.org/#\" pom.xml\nRUN mvn --batch-mode install \\\n      -Dhttp.keepAlive=false -Dmaven.wagon.http.pool=false -Dmaven.wagon.httpconnectionManager.ttlSeconds=120 \\\n      -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn \\\n      -DskipTests=true \\\n      -Dcheckstyle.skip=true \\\n      -DskipJasmineTests=true\nARG OPENCAST_DISTRIBUTION\nRUN tar -xzf build/opencast-dist-${OPENCAST_DISTRIBUTION}-*.tar.gz --strip 1 -C \"${OPENCAST_HOME}\" && rm build/opencast-dist-${OPENCAST_DISTRIBUTION}-*.tar.gz\n\n\nFROM docker.io/openjdk:11-jdk-slim\nLABEL org.opencontainers.image.base.name=\"docker.io/openjdk:11-jdk-slim\"\n\nENV OPENCAST_HOME=\"/opencast\" \\\n    OPENCAST_DATA=\"/data\" \\\n    OPENCAST_CUSTOM_CONFIG=\"/etc/opencast\" \\\n    OPENCAST_USER=\"opencast\" \\\n    OPENCAST_GROUP=\"opencast\" \\\n    OPENCAST_UHOME=\"/home/opencast\" \\\n    OPENCAST_UID=\"800\" \\\n    OPENCAST_GID=\"800\"\nENV OPENCAST_CONFIG=\"${OPENCAST_HOME}/etc\" \\\n    OPENCAST_SCRIPTS=\"${OPENCAST_HOME}/docker/scripts\" \\\n    OPENCAST_SUPPORT=\"${OPENCAST_HOME}/docker/support\" \\\n    OPENCAST_STAGE_BASE_HOME=\"${OPENCAST_HOME}/docker/stage/base\" \\\n    OPENCAST_STAGE_OUT_HOME=\"${OPENCAST_HOME}/docker/stage/out\"\n\nRUN groupadd --system -g \"${OPENCAST_GID}\" \"${OPENCAST_GROUP}\" \\\n && useradd --system -M -N -g \"${OPENCAST_GROUP}\" -d \"${OPENCAST_UHOME}\" -u \"${OPENCAST_UID}\" \"${OPENCAST_USER}\" \\\n && mkdir -p \"${OPENCAST_DATA}\" \"${OPENCAST_UHOME}\" \\\n && chown -R \"${OPENCAST_USER}:${OPENCAST_GROUP}\" \"${OPENCAST_DATA}\" \"${OPENCAST_UHOME}\"\n\nRUN apt-get update \\\n && apt-get install -y --no-install-recommends \\\n      ca-certificates \\\n      curl \\\n      fontconfig \\\n      fonts-dejavu \\\n      fonts-freefont-ttf \\\n      fonts-liberation \\\n      fonts-linuxlibertine \\\n      hunspell \\\n      hunspell-en-au \\\n      hunspell-en-ca \\\n      hunspell-en-gb \\\n      hunspell-en-us \\\n      hunspell-en-za \\\n      inotify-tools \\\n      jq \\\n      netcat-openbsd \\\n      nfs-common \\\n      openssl \\\n      rsync \\\n      sox \\\n      synfig \\\n      tesseract-ocr \\\n      tesseract-ocr-eng \\\n      tzdata \\\n && rm -rf /var/lib/apt/lists/*\n\nCOPY --from=build /usr/local/sbin/su-exec /usr/local/sbin/\nCOPY --from=build /usr/local/bin/ff* /usr/local/bin/\nCOPY --from=build \"${OPENCAST_HOME}\" \"${OPENCAST_HOME}\"\nCOPY rootfs /\n\nARG OPENCAST_REPO=\"https://github.com/opencast/opencast.git\"\nARG OPENCAST_VERSION=\"develop\"\nARG OPENCAST_DISTRIBUTION\nARG VERSION=unkown\nARG BUILD_DATE=unkown\nARG GIT_COMMIT=unkown\n\nENV OPENCAST_REPO=${OPENCAST_REPO} \\\n    OPENCAST_VERSION=${OPENCAST_VERSION} \\\n    OPENCAST_DISTRIBUTION=${OPENCAST_DISTRIBUTION}\n\nRUN if [ \"${OPENCAST_DISTRIBUTION}\" = \"allinone\" ]; then \\\n      rm -f \"${OPENCAST_CONFIG}/org.opencastproject.organization-mh_default_org.cfg-clustered\"; \\\n    fi \\\n && mv \"${OPENCAST_CONFIG}/org.opencastproject.organization-mh_default_org.cfg-clustered\" \"${OPENCAST_CONFIG}/org.opencastproject.organization-mh_default_org.cfg\" || true \\\n && chown \"${OPENCAST_USER}:${OPENCAST_GROUP}\" \"${OPENCAST_HOME}\" \"${OPENCAST_CONFIG}\" \\\n && chown -R \"${OPENCAST_USER}:${OPENCAST_GROUP}\" \"${OPENCAST_HOME}/data\" \\\n  \\\n && mkdir -p \"${OPENCAST_STAGE_BASE_HOME}\" \\\n && rsync -vrlog --chown=0:0 \"${OPENCAST_CONFIG}\" \"${OPENCAST_STAGE_BASE_HOME}\" \\\n  \\\n && javac \"${OPENCAST_SCRIPTS}/TryToConnectToDb.java\" \\\n && rm -rf /tmp/* \"${OPENCAST_SCRIPTS}/TryToConnectToDb.java\"\n\nWORKDIR \"${OPENCAST_HOME}\"\n\nEXPOSE 8080\nVOLUME [ \"${OPENCAST_DATA}\" ]\n\nLABEL maintainer=\"educast.nrw <info@educast.nrw>\" \\\n      org.opencontainers.image.title=\"opencast-${OPENCAST_DISTRIBUTION}\" \\\n      org.opencontainers.image.description=\"container image for the Opencast ${OPENCAST_DISTRIBUTION} distribution\" \\\n      org.opencontainers.image.version=\"${VERSION}\" \\\n      org.opencontainers.image.vendor=\"Opencast\" \\\n      org.opencontainers.image.authors=\"educast.nrw <info@educast.nrw>\" \\\n      org.opencontainers.image.licenses=\"ECL-2.0\" \\\n      org.opencontainers.image.url=\"https://github.com/opencast/opencast-docker/blob/${VERSION}/README.md\" \\\n      org.opencontainers.image.documentation=\"https://github.com/opencast/opencast-docker/blob/${VERSION}/README.md\" \\\n      org.opencontainers.image.source=\"https://github.com/opencast/opencast-docker\" \\\n      org.opencontainers.image.created=\"${BUILD_DATE}\" \\\n      org.opencontainers.image.revision=\"${GIT_COMMIT}\"\n\nHEALTHCHECK --timeout=10s CMD /docker-healthcheck.sh\nENTRYPOINT [\"/docker-entrypoint.sh\"]\nCMD [\"app:start\"]\n"
}