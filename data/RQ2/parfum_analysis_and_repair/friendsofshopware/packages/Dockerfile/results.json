{
  "startTime": 1674249052169,
  "endTime": 1674249052811,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 15
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Composer\n\nFROM composer:2 as vendor\n\nWORKDIR /app\nCOPY composer.* /app/\nRUN set -ex; \\\n    COMPOSER_MEMORY_LIMIT=-1 composer install \\\n    --ignore-platform-reqs \\\n    --no-dev \\\n    --no-scripts \\\n    --no-suggest \\\n    --no-interaction \\\n    --prefer-dist \\\n    --no-autoloader\n\nCOPY src /app/src\n\nRUN set -ex; \\\n    composer dump-autoload \\\n    --no-dev \\\n    --optimize \\\n    --classmap-authoritative\n\n# Webpack Encore\n\nFROM node:16-alpine as npm\nWORKDIR /app\nCOPY package.json package-lock.json /app/\nCOPY --from=vendor --chown=1000:1000 /app/vendor /app/vendor\nRUN npm install && npm cache clean --force;\nRUN mkdir -p public/build\nCOPY assets /app/assets\nCOPY config /app/config\nCOPY templates /app/templates\nCOPY webpack.config.js /app/\nRUN npm run build\n\nFROM php:8.0-fpm-alpine\n\nARG GIT_TAG=unspecified\nENV APP_ENV=prod \\\n    REDIS_URL=redis://redis:6379 \\\n    VERSION=$GIT_TAG \\\n    TZ=Europe/Berlin \\\n    FPM_PM=dynamic \\\n    FPM_PM_MAX_CHILDREN=10 \\\n    FPM_PM_START_SERVERS=2 \\\n    FPM_PM_MIN_SPARE_SERVERS=1 \\\n    FPM_PM_MAX_SPARE_SERVERS=3 \\\n    PHP_MAX_UPLOAD_SIZE=128m \\\n    PHP_MAX_EXECUTION_TIME=60 \\\n    PHP_MEMORY_LIMIT=512m\n\nCOPY --from=ghcr.io/shyim/supervisord /usr/local/bin/supervisord /usr/bin/supervisord\nCOPY --from=mlocati/php-extension-installer /usr/bin/install-php-extensions /usr/bin/\n\nRUN apk add --no-cache \\\n      nginx \\\n      shadow && \\\n    install-php-extensions bcmath intl mysqli pdo_mysql sockets bz2 gmp soap zip gmp redis opcache && \\\n    ln -sf /dev/stdout /var/log/nginx/access.log && \\\n    ln -sf /dev/stderr /var/log/nginx/error.log && \\\n    rm -rf /var/lib/nginx/tmp && \\\n    ln -sf /tmp /var/lib/nginx/tmp && \\\n    mkdir -p /var/tmp/nginx/ || true && \\\n    chown -R www-data:www-data /var/lib/nginx /var/tmp/nginx/ && \\\n    chmod 777 -R /var/tmp/nginx/ && \\\n    rm -rf /tmp/* && \\\n    chown -R www-data:www-data /var/www && \\\n    usermod -u 1000 www-data && \\\n    chown -R 1000 /var/www/html\n\nCOPY config/docker/ /\n\nENTRYPOINT [\"/entrypoint.sh\"]\nSTOPSIGNAL SIGKILL\n\nCOPY --chown=1000:1000 . /var/www/html\nCOPY --from=vendor --chown=1000:1000 /app/vendor /var/www/html/vendor\nCOPY --from=npm --chown=1000:1000 /app/public /var/www/html/public\n\nRUN php bin/console cache:clear && \\\n    echo \"opcache.preload=/var/www/html/var/cache/prod/App_KernelProdContainer.preload.php\" > /usr/local/etc/php/conf.d/preload.ini && \\\n    echo \"opcache.preload_user=www-data\" >> /usr/local/etc/php/conf.d/preload.ini && \\\n    echo \"opcache.memory_consumption=256\" >> /usr/local/etc/php/conf.d/preload.ini && \\\n    echo \"opcache.max_accelerated_files=20000\" >> /usr/local/etc/php/conf.d/preload.ini && \\\n    echo \"opcache.validate_timestamps=0\" >> /usr/local/etc/php/conf.d/preload.ini && \\\n    echo \"opcache.jit_buffer_size=100M\" >> /usr/local/etc/php/conf.d/preload.ini && \\\n    echo \"realpath_cache_size=4096K\" >> /usr/local/etc/php/conf.d/preload.ini && \\\n    echo \"realpath_cache_ttl=600\" >> /usr/local/etc/php/conf.d/preload.ini && \\\n    echo \"display_errors=0\" > /usr/local/etc/php/conf.d/prod.ini\n"
}