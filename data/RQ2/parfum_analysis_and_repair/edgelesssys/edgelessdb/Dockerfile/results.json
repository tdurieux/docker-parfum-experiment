{
  "startTime": 1674220155867,
  "endTime": 1674220157099,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseY",
      "position": {
        "lineStart": 61,
        "lineEnd": 61,
        "columnStart": 5,
        "columnEnd": 72
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 2,
        "lineEnd": 13,
        "columnStart": 18,
        "columnEnd": 12
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 44,
        "lineEnd": 44,
        "columnStart": 18,
        "columnEnd": 52
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 61,
        "lineEnd": 61,
        "columnStart": 5,
        "columnEnd": 72
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 2,
        "lineEnd": 13,
        "columnStart": 18,
        "columnEnd": 12
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 44,
        "lineEnd": 44,
        "columnStart": 18,
        "columnEnd": 52
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 49,
        "lineEnd": 60,
        "columnStart": 19,
        "columnEnd": 26
      }
    },
    {
      "rule": "ruleAptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 61,
        "lineEnd": 61,
        "columnStart": 5,
        "columnEnd": 72
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ubuntu:focal-20220531 AS build\n\nRUN apt update && DEBIAN_FRONTEND=noninteractive apt --no-install-recommends install -y \\\n  bbe \\\n  bison \\\n  build-essential \\\n  clang-10 \\\n  cmake \\\n  doxygen \\\n  git \\\n  liblz4-dev \\\n  libssl-dev \\\n  ninja-build \\\n  zlib1g-dev && rm -rf /var/lib/apt/lists/*;\n\nARG erttag=v0.3.3\nARG edbtag=v0.3.0\nRUN git clone -b $erttag --depth=1 https://github.com/edgelesssys/edgelessrt \\\n  && git clone -b $edbtag --depth=1 https://github.com/edgelesssys/edgelessdb \\\n  && mkdir ertbuild edbbuild\n\n# install ert\nRUN cd edgelessrt && export SOURCE_DATE_EPOCH=$(git log -1 --pretty=%ct) && cd /ertbuild \\\n  && cmake -GNinja -DCMAKE_BUILD_TYPE=Release -DBUILD_TESTS=OFF /edgelessrt \\\n  && ninja install\n\n# build edb\nRUN cd edgelessdb && export SOURCE_DATE_EPOCH=$(git log -1 --pretty=%ct) && cd /edbbuild \\\n  && . /opt/edgelessrt/share/openenclave/openenclaverc \\\n  && cmake -DCMAKE_BUILD_TYPE=Release -DBUILD_TESTS=OFF /edgelessdb \\\n  && make -j`nproc` edb-enclave\n\n# sign edb\nARG heapsize=1024 production=OFF\nRUN --mount=type=secret,id=signingkey,dst=/edbbuild/private.pem,required=true \\\n  cd edbbuild \\\n  && . /opt/edgelessrt/share/openenclave/openenclaverc \\\n  && cmake -DHEAPSIZE=$heapsize -DPRODUCTION=$production /edgelessdb \\\n  && make sign-edb\n\n# deploy\nFROM ubuntu:focal-20220531\nARG PSW_VERSION=2.17.100.3-focal1\nARG DCAP_VERSION=1.14.100.3-focal1\nRUN apt update && apt install --no-install-recommends -y gnupg libcurl4 wget \\\n  && wget -qO- https://download.01.org/intel-sgx/sgx_repo/ubuntu/intel-sgx-deb.key | apt-key add \\\n  && echo 'deb [arch=amd64] https://download.01.org/intel-sgx/sgx_repo/ubuntu focal main' >> /etc/apt/sources.list \\\n  && wget -qO- https://packages.microsoft.com/keys/microsoft.asc | apt-key add \\\n  && echo 'deb [arch=amd64] https://packages.microsoft.com/ubuntu/20.04/prod focal main' >> /etc/apt/sources.list \\\n  && apt update && apt install -y --no-install-recommends \\\n  libsgx-ae-pce=$PSW_VERSION \\\n  libsgx-ae-qe3=$DCAP_VERSION \\\n  libsgx-ae-qve=$DCAP_VERSION \\\n  libsgx-dcap-ql=$DCAP_VERSION \\\n  libsgx-dcap-ql-dev=$DCAP_VERSION \\\n  libsgx-enclave-common=$PSW_VERSION \\\n  libsgx-headers=$PSW_VERSION \\\n  libsgx-launch=$PSW_VERSION \\\n  libsgx-pce-logic=$DCAP_VERSION \\\n  libsgx-qe3-logic=$DCAP_VERSION \\\n  libsgx-urts=$PSW_VERSION \\\n  && apt install -y --no-install-recommends -d az-dcap-client libsgx-dcap-default-qpl=$DCAP_VERSION && rm -rf /var/lib/apt/lists/*;\nCOPY --from=build /edbbuild/edb /edbbuild/edb-enclave.signed /edgelessdb/src/entry.sh /\nCOPY --from=build /opt/edgelessrt/bin/erthost /opt/edgelessrt/bin/\nENV PATH=${PATH}:/opt/edgelessrt/bin AZDCAP_DEBUG_LOG_LEVEL=error\nENTRYPOINT [\"/entry.sh\"]\nEXPOSE 3306 8080\n"
}