{
  "user": "ranimepiracy",
  "name": "index",
  "namespace": "ranimepiracy",
  "repository_type": "image",
  "status": 1,
  "status_description": "active",
  "description": "Web-ui of the /r/animepiracy index",
  "is_private": false,
  "is_automated": false,
  "can_edit": false,
  "star_count": 1,
  "pull_count": 3461,
  "last_updated": "2022-05-15T07:42:18.183397Z",
  "date_registered": "2021-02-09T12:11:54.244506Z",
  "collaborator_count": 0,
  "affiliation": null,
  "hub_user": "yasamato",
  "has_starred": false,
  "full_description": "[![Website](https://img.shields.io/website?down_message=offline&label=piracy.moe&up_message=online&url=https%3A%2F%2Fpiracy.moe&logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAABmJLR0QA/wD/AP+gvaeTAAAAB3RJTUUH5QEaDQwpbkb66QAACLNJREFUSMc1lllzZMdxhU9W1d37djcaQDcWDgacAT2LSGpzOEIMyY/W/9R/0IueFLLDluQHk6YoSpiNM1ga6H27a1Vl6gGj/ANfxjmR5ySJ/AZgwEEs4CAOYsXZalE3kxkV88W2f7c6GmTzXrz4y81L682g2/7s8TSsFmI3KDw1CiBAwQs8gwWKEGoQgdlAKoABD/GAhbfNpl3f1H6zsLVMtxfbpuNYtxvaS6b9ZHa/Gy03anxtz/rbQrGJOGaPVtA4OAYIBAihIhCBYcAFIABDvDi3uW2K8UbaclN2F+We9cYzmLny0c1qdNIfz8uedcHKSliFl5PHe8nm5eiDsUo2Bg2BW4oJiYJnWAaRgX8ACISru3Vzu7F1NN8dF23smbyARVgEkMnuoJ8sn+6/td4Yst/efVbaTtGmw3w+PD7D2ZfsQVe/03qGWD2IAsgDAPDWLZfFrcxXw23TtZ6Y4YWYhQUCsHjn+dX0+LODq8qGPyzPWxcRuPHB9fJg/9NTM/pCeSuR5sWfVPUK4gEBi4ErpK6q+3p6u7fcHjZeO5DjB7eEmdumbsqNa3Ya1hv99bLrVUYGWjMAAeZFXi5+yA930AkNniE79le/1Zv/gwhEjF/M1rfh5P6sbDuO4UQ84AXsuanLtlxGqjrt6+FRr3eYa6OrdTm9Xd1PV5siZpMrHZUcrxb3+e6K8gsACHIc/pK3b5RfQmCml73F6rh2gQc8wExOpG0qVy7ysPrk8/3B0VFnNNBZTkHAtulrNSqrJzf3y+vl5evJtOpLlM9W0fDD98FRogcngCAZuvznev0t2ZWZTU8sNIs4gRdY7+tikZnt+YteP0jTp8eIjVtsVBrbXdluq+Rgz/QGadzLTm2aXf7Xf39YrwqOlNTkxq8oSlRnj7TRp/8uBz9BvTRZulpse16MZ2ls48rp2RGd/+SxCRSWgS9jpRveVdXfr7gTBP1MhxAuIc4r0308evr25urq6mI/IhpwW7jp+zDpQmkVxggT6ozM2elSX9ub1X5d17qdvvwsO/nXT5l8e1tHR0/EBM3931QckM38ohIpW/aUBNJYLpogz/Ju8PmZ7mW7xk7EHPnlhPszvXcEAUQgbLTdnXSXy2VRV/zyx3sHn5+qNGiuduHgU7N3AAipZ83t35Wh7JOLdnZXj8cq18mjfTvfStV2OiYWx7UPcNdwVxTb+3eAgDSRggkN/MaEfpQX3cOL3mlfCG6940psyH4+CZLUxB119kU7u3Ftm3z6Iq4f2+mdW1cEVb27jw2noaimFW+JVxIP/XrKmzkAIgUdGIiH8HBfuePMOQ/Pzd3Kb7lp72+//n9t9PCLL/df/Cg+ORfn2NrZm7e78Xj08pm0K2lqXzUCh9bDs/JXbQudDjjOabdAu/UUGrQCBmlDxugwEPZguG0RDc7zg4SblVhHRBAiHdj1dv32G25F4Ud2V2pxUXGvuIJ4EomwNbtLr86QP9Gr75QvGxcoiId4mICCkIDmehl0Y9Ik7EhHtkGU90AaTBDSYWRMqE3E1RZtHUQ6VBXBAgwCERtdBx2jeWd4pcgmpjAgBrFojTC0tzs72eo8CgYJuaq7F4YSpMMhWCACgYnibPiZIq0grfMmAcUezj2kJZhERNKe7D11uzuzuISIgniwZx1yK+10y62rbhfhQeab8XRys1OBkgIs4j2YidTo8x8fXjz3jWVhaEAcwBAGM5vMHf+b7z7xuufPfuXDPsQbPDkX64QO3XznixpQdrlVmcTHo+U7vhu3ByeXexcHwgytybMtNuX9++L2XZQZSkNIF+zBgICgdFRx1i9evYNddBNCmhucnIoVWSTN65mIMNi68vtv9X7pLl52Fn9cv7ocf9l57dugevtD+fp9+cM7Pyiix0+Sg8cm1zB9iAcAgABfTtvlh+7zF+7q99okoNRgtxTXtZPKFrUKDVvfumS6NN//YXzxJMo7fH3v9y//mqcnxc10+Z9/tlETnj+PwxSaTBaiEog8NKVzuL6Rnv5OVjCYIRCIGLbi67CZLKFVMEib8br0ZmtV5fjrv5VKbKB05W3voJXsUf3sp61Urhk+Wrl27jlTUWtCBSWsiN/dxv/z5vAXxzeD7TeWpsNnqdLKcBPbubW7Oj7dY4Jzrra6VQkZy7VjCkXHd1U4vtoAoPxUBHAyn8tf1oi+a0M6iI0PyRny03WwqqI/3+4/TWZJs+10kR4ODKPbTmcqRjzKl68nznOoYMjDxEEnEiiIfOxNAeRhCKCmlaJRQAQBCSBCAEiui72tjX59Vjn1VE6+MnZS+6pIHg1gqNnVLBIZhH6z22gB2LPzzlkrQJzmYZwSqQfOx7yEgEEAHjYAi+Cos+mYEOExxQPTjJcmtvGoV61q21gWKE05bea3K8sQZmGOQ6UUTZezIO3m/UEYJwDJw9YfY1n++ZogUP40nq4my77907qdGXKb+CjWWdpe3YkXFpDIqB9EgZQFEwE6ODvOv/gkvJvMx6vt7bzemjTNeyaM6AEDAUAQEohgGO0yOyNfZ8rK/M7E8TrYPwbQbBsWiIiwdBJzmIezXZ1mOSsTdbq9nLft4D++/IRN/3+/ffPNm2uYJEzzMEq01kQfJVKQf+lOUNWdrvEsgDdhRirrsXXNrrZtI8oQkdJ0vB++mXmTdKBMEGjn7U3ZaZfpV8/y5+ej9zeTk14zr8rJDJZiEyYmCJXSj/LixNxHkYoTxYCIGEQJBZErrK0bhdYxC0cgc9SPBnumgA7jhFxRNbyxenL5/vqbP6521crpX744/GqUfLjaXs2bebEdT+va6+eHK5tVw2FA9PG4DcIOtPZNJW0boIU4L8azCsMg7aRlrYmU8zwr1dZqtn6+2pVNWyIua68hg1SG/Ww4SHZvZ7Md75n2sBuQJ+8evCGDKAPBNQ7sDDlAsVgRUztqxZgwFAiI3m+ChkkLNJExQVPzprLOWlWtDWLP+aOROT+wIjFEhP9pPfAP0yfoPOLdWQcAAAAldEVYdGRhdGU6Y3JlYXRlADIwMjEtMDEtMjZUMTM6MTI6NDErMDE6MDA0xJsnAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDIxLTAxLTI2VDEzOjEyOjQxKzAxOjAwRZkjmwAAAFd6VFh0UmF3IHByb2ZpbGUgdHlwZSBpcHRjAAB4nOPyDAhxVigoyk/LzEnlUgADIwsuYwsTIxNLkxQDEyBEgDTDZAMjs1Qgy9jUyMTMxBzEB8uASKBKLgDqFxF08kI1lQAAAABJRU5ErkJggg==)](https://piracy.moe)\n[![GitHub Workflow Status](https://img.shields.io/github/workflow/status/ranimepiracy/index/Docker?logo=github)](https://github.com/ranimepiracy/index)\n[![CodeFactor](https://www.codefactor.io/repository/github/ranimepiracy/index/badge)](https://www.codefactor.io/repository/github/ranimepiracy/index)\n[![Codacy Badge](https://app.codacy.com/project/badge/Grade/841b254fc40146108ca99d32ce833199)](https://www.codacy.com/gh/ranimepiracy/index/dashboard)\n[![Docker Image Size (tag)](https://img.shields.io/docker/image-size/ranimepiracy/index/latest?logo=docker)](https://hub.docker.com/r/ranimepiracy/index)\n[![Subreddit subscribers](https://img.shields.io/reddit/subreddit-subscribers/animepiracy?label=%2Fr%2Fanimepiracy&logo=reddit)](https://www.reddit.com/r/animepiracy)\n[![Twitter Follow](https://img.shields.io/twitter/follow/ranimepiracy?label=%40ranimepiracy&logo=twitter&style=flat)](https://twitter.com/ranimepiracy)\n[![Discord](https://img.shields.io/discord/622243127435984927?label=Discord&logo=discord)](https://discord.gg/piracy)\n\n# [piracy.moe](https://piracy.moe) index\n\nThe frontend, editor panel, and API of the /r/animepiracy index.\n\nPlease report incorrect or missing data at our [Discord server](https://discord.gg/piracy) in `#index-wiki`, not here.\n\n## Getting started\n\nThe easiest way is to get started is by using Docker Compose. You need to copy\nthe [`docker-compose.yml`](docker-compose.yml) and [`example.env`](example.env) file from GitHub. Rename `example.env`\nto `.env` and adjust the environment variables as you need to. with the following command:\n\n```shell\ndocker-compose up -d\n```\n\nYou'll need to change `<host-port>` to your port of choice. The web-server is not secured via SSL/TLS, it is in your\nresponsibility to put a reverse proxy in front of this container. When you run the image for the first time, don't\nforget to set your own [discord-id](https://discord.com/developers/docs/resources/user) in the\nenv `SETUP_WHITELIST_DISCORD_ID` to be able to login and edit. Once your container has set up itself once, you can\nremove the env variable from your setup.\n\n## Database\n\nWe use [mongodb](https://github.com/mongodb/mongo) as our database server. You can deploy your own mongo setup as HA\nservice or just a simple single docker container via e.g.:\n\n> Note: The database will start empty, you have to fill the data yourself.\n\n```shell\ndocker run -d \\\n    --name mongo \\\n    -v ./db:/data/db \\\n    mongo\n```\n\nFor development or testing purposes it is highly recommended to\nuse [mongo-express](https://github.com/mongo-express/mongo-express) for accessing, viewing and editing the current state\nof the database. If you make it publicly accessible, **don't forget** to secure it with _login credentials_.\n\nTo simply spin up a mongo-express docker container, run:\n\n```shell\ndocker run -d \\\n    --name mongo-express \\\n    -p 8081:8081 \\\n    mongo-express\n```\n\nYou can also take a look at our provided [`docker-compose`](docker-compose.yml) file on how to set it up.\n\n## Cache-DB\n\nTo increase performance we use [redis](https://redis.io/) to cache results from the mongoDB. The cache is being\nauto-populated on cache-misses.\n\nYou can create a new instance with docker by running:\n\n```shell\ndocker run -d \\\n    --name redis \\\n    redis\n```\n\nThe redis db is already included in the example [`docker-compose`](docker-compose.yml) file\n\n## Updating container image\n\nWarning: be aware, that we do not offer any kind of official support and every update may be with breaking changes. Be\nsure to make backups before you update\n\nTo get the newest version of the container image\nfrom [Docker Hub](https://hub.docker.com/repository/docker/ranimepiracy/index), you will need to run:\n\n```shell\ndocker pull ranimepiracy/index\n```\n\nAfterwards, you will need to stop and remove your current running instance and start it again.\n\n## Parameters\n\nHere is a collection of the possible ENV-variables with their default values you should set in your `.env` file:\n\n| Parameter                     | Function                                                                                                                 | Default                                                          |\n| ----------------------------- | ------------------------------------------------------------------------------------------------------------------------ | ---------------------------------------------------------------- |\n| `NEXT_PUBLIC_SITE_NAME`       | The name of your site                                                                                                    | `\"The Anime Index\"`                                              |\n| `NEXT_PUBLIC_DOMAIN`          | Your domain or IP, remove trailing slash                                                                                 | `\"https://piracy.moe\"`                                           |\n| `NEXTAUTH_URL`                | Your domain or IP, remove trailing slash                                                                                 | `$NEXT_PUBLIC_DOMAIN`                                            |\n| `DATABASE_URL`                | Take a look at [mongodb docs](https://docs.mongodb.com/manual/reference/connection-string/)                              | `\"mongodb://mongo:27017\"`                                        |\n| `CACHE_URL`                   | Connection string for the redis cache database                                                                           | `\"redis://redis:6379\"`                                           |\n| `CHROME_URL`                  | WebSocket URL to a running chrome instance                                                                               | `\"ws://chrome:3300\"`                                             |\n| `AUDIT_WEBHOOK`               | WebHook-URL for audit-log, leave empty to disable support                                                                | `\"\"`                                                             |\n| `DISCORD_CLIENT_ID`           | Discord OAuth2 client ID                                                                                                 | `\"your_discord_oauth_client_id\"`                                 |\n| `DISCORD_CLIENT_SECRET`       | Discord OAuth2 client secret                                                                                             | `\"your_discord_oauth_client_secret\"`                             |\n| `DISCORD_BOT_TOKEN`           | Required to access BOT resources                                                                                         | `\"your_discord_bot_token\"`                                       |\n| `SETUP_WHITELIST_DISCORD_ID=` | If you need help getting your id, check out this [guide](https://wiki.discord.id/obtain-ids/desktop)                     | `\"your_discord_id\"`                                              |\n| `MEILI_MASTER_KEY`            | Set a random secure string, read more about [meili](https://docs.meilisearch.com/reference/features/authentication.html) | `\"a_super_secret_long_randomly_generated_string_that_is_secure\"` |\n\nAnd the following env variables are only needed when you are in dev mode and debugging the db\n\n| Parameter                      | Function                                                                 | Default        |\n| ------------------------------ | ------------------------------------------------------------------------ | -------------- |\n| `ME_CONFIG_BASICAUTH_USERNAME` | [mongo-express](https://github.com/mongo-express/mongo-express) username | \"admin\"        |\n| `ME_CONFIG_BASICAUTH_PASSWORD` | [mongo-express](https://github.com/mongo-express/mongo-express) password | \"SUPER_SECRET\" |\n\nIf you want to verify how the docker-compose file fills the envs in, use `docker-compose config`\n\n## Getting started to code\n\n### Setup around the web app\n\n1. Getting started isn't that straight forward. You will need to have installed the latest version\n   of [docker with docker-compose](https://docs.docker.com/get-docker/) on your machine.\n\n2. Start by cloning the repo via a graphical git client (highly recommended) or use the cli via\n\n```shell\ngit clone https://github.com/ranimepiracy/index\n```\n\n3. Copy the [`example.env`](example.env) file to `.env`.\n\n### How to fill the .env\n\n- Replace `NEXT_PUBLIC_DOMAIN` and `NEXTAUTH_URL` with `http://localhost:3000`\n- Generate a random strong string of at least 32 characters and use it for `NEXTAUTH_SECRET`. You can use generators\n  e.g [1Password](https://1password.com/password-generator/) or create it yourself.\n- Change `DATABASE_URL`, `CACHE_URL` and `CHROME_URL` to use localhost instead of `mongo`, `redis` and `chrome` for\n  example: `mongodb://mongo:27017` -> becomes `mongodb://localhost:27017`\n- Go to `https://discord.com/developers` -> Create a new Application -> Go into `Auth2` inside your Application panel ->\n  Copy the `CLIENT ID` and `CLIENT SECRET` into the `.env` file.\n- In `Redirects` in `Auth2` copy and paste the following URL needed verify your Discord\n  login `http://localhost:3000/api/auth/callback/discord`.\n- Fill `SETUP_WHITELIST_DISCORD_ID` with your Discord ID to have an admin account when you login.\n- Generate again another random strong string of at least 32 characters and use it for `MEILI_MASTER_KEY`. You can use\n  generators e.g [1Password](https://1password.com/password-generator/) or create it yourself.\n- Lastly if you want to change the password for mongo-express, you can do so with the last two variables, usually though\n  none of us do while developing locally.\n\n4. Add the following ports to the images in the [`docker-compose`](docker-compose.yml) file:\n\n| service  | port-mapping  |\n| :------- | ------------- |\n| `mongo`  | `27017:27017` |\n| `redis`  | `6379:6379`   |\n| `meili`  | `7700:7700`   |\n| `chrome` | `3300:3000`   |\n\nAs an example, the setup for `mongo` should look similar to this:\n\n```yml\nmongo:\n  image: mongo\n  container_name: index-db\n  restart: unless-stopped\n  ports:\n    - 27017:27017\n  volumes:\n    - ./db:/data/db\n```\n\n5. Now run the command to start all the needed backend processes\n\n```shell\ndocker-compose up -d mongo redis meili chrome mongo-express\n```\n\nAlternatively you can also just comment or remove the index service and run the command\n\n```shell\ndocker-compose up -d\n```\n\n### Web service\n\nTo start coding on the frontend, you will need to make sure, you have the latest version of\n[node.js](https://nodejs.org/en/https://nodejs.org/en/) correctly installed. To install all the required dependencies\nrun once:\n\n```shell\nnpm install\n```\n\n> Note: We decided to stick with npm instead of yarn to manage dependencies.\n\nYou should now have a folder called `node_modules`, which contains all the dependencies we need. We use\n[Next.js](https://nextjs.org) as framework for our [React](https://reactjs.org) web service. To test the web service you\nwill have to run a db server in the background and start the frontend via:\n\n```shell\nnpm run dev\n```\n\nAfter compiling you can open [http://localhost:3000](http://localhost:3000) in your browser of choice and see the\nrunning web application.\n\nAs we use [Next.js](https://nextjs.org), the frontend supports hot reloading, so you can just leave the page open, while\nyou modify the code and see the changes on the fly in your browser.\n\n### Docker image\n\nTo create a ready-made docker image, just run:\n\n```shell\ndocker build . -t index\n```\n\nYou now have a local image with tag `index` that contains a distributable version of the code which can now be run.\n\n### Auto-formatter\n\nWe use [prettier](https://prettier.io) to ensure a consistent code style across all participants. You can simply\nauto-format everything with e.g. running the command\n\n```shell\nnpx prettier --write .\n```\n\n## Design of the web app\n\n### ISR/SSR\n\nWhere possible we use [ISR](https://vercel.com/docs/next.js/incremental-static-regeneration) to pre generate all\npublicly accessible pages for caching by CDNs or proxies while validating and fetching new data\nwith [SWR](https://web.dev/stale-while-revalidate/) requesting our own api.\n\n### API\n\nWe serve every api request over the endpoint `/api`, the corresponding code can be viewed at [pages/api](pages/api).\n\n- `/api/auth` is reserved for [NextAuth.js](https://next-auth.js.org/).\n- `/api/edit/...` requires a logged-in user and usually (at least) editor rights and is for modifying or creating new\n  content. The `_id` keyword `_new` is reserved for creating new content.\n- `/api/delete/...` requires a logged-in user and usually (at least) editor rights and is for deleting content.\n- `/api/[content]s` are public endpoints for fetching a list of all items of a certain content.\n- `/api/[content]/...` are public endpoints for fetching information about a specific content.\n\n### Page restrictions\n\nEvery page request first has to go through [\\_app.js](pages/_app.js), where a basic layout is being applied and if a\npage has an `auth` property, it also validates whether the user can access the given page. Valid auth attributes are:\n\n- `auth` itself is `null` or `typeof auth === \"undefined\"`, no restrictions. This seems to be a public page.\n- `requireLogin`, not really needed, but set it for logic reasons. User must be logged-in.\n- `requireAdmin`, only a user with admin rights can access this page.\n- `requireEditor`, only editors can view this page.\n\n## Contribution\n\nPull-requests are always welcome, but may not be always merged as it has to be in align with our idea of the index. If\nyou want a certain feature or have an idea, you can always open a feature request\nin [Issues](https://github.com/ranimepiracy/index/issues/new?assignees=&labels=enhancement&template=feature_request.md&title=%5BFEAT%5D)\nor report it on our [Discord](https://discord.gg/piracy) in `#index` to be discussed. If it is not bad, in align with\nour ideas, and we find some time, we will certainly implement your requested feature (sometime...).\n\n### Things we use\n\n- [next.js](https://nextjs.org/) as Webserver\n- [React](https://reactjs.org/) as JS framework\n- Styles from [bootstrap](https://getbootstrap.com/)\n- Icons from [Font Awesome](https://fontawesome.com)\n- We bake everything into a [docker image](https://www.docker.com/)\n- Running on [node js](https://nodejs.org/)\n- User-authentication via [NextAuth.js](https://next-auth.js.org/)\n- PWA-support with [next-pwa](https://www.npmjs.com/package/next-pwa)\n- [mongodb](https://www.mongodb.com) as database backend\n- [redis](https://redis.io) as cache\n- [MeiliSearch](https://www.meilisearch.com/) as search engine\n- [puppeteer](https://github.com/puppeteer/puppeteer) to create screenshots of websites\n- [browserless/chrome](https://github.com/browserless/chrome) to run our chrome instance\n- [react-in-viewport](https://github.com/roderickhsiao/react-in-viewport) for checking if components are visible or not\n- [react-draggable](https://github.com/react-grid-layout/react-draggable) for dragging components by the end user\n- [react-toastify](https://github.com/fkhadra/react-toastify) for handling notifications\n\nAnd most importantly:\n\n> The help of our awesome community :3\n\n### Technical debts\n\n- We use JS instead of TS (not needed, but type checking is still a wanted security feature)\n- Multi-language support\n- Unify `Editor`-views\n- Unify db insert and updates to the format of `func(_id, dataObject)` and update only as needed, GraphQL would be\n  nice...\n- Move to `add`, `remove` api instead of having to send whole arrays to update lists -> GraphQL?\n",
  "permissions": {
    "read": true,
    "write": false,
    "admin": false
  },
  "media_types": [
    "application/vnd.docker.container.image.v1+json"
  ],
  "content_types": [
    "image"
  ]
}