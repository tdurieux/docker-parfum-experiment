{
  "user": "satelliteqe",
  "name": "broker",
  "namespace": "satelliteqe",
  "repository_type": "image",
  "status": 1,
  "status_description": "active",
  "description": "",
  "is_private": false,
  "is_automated": false,
  "can_edit": false,
  "star_count": 0,
  "pull_count": 165,
  "last_updated": "2021-07-16T19:29:58.856476Z",
  "date_registered": "2020-06-09T19:13:48.38672Z",
  "collaborator_count": 0,
  "affiliation": null,
  "hub_user": "satelliteqe",
  "has_starred": false,
  "full_description": "[![PythonPackage](https://github.com/SatelliteQE/broker/actions/workflows/python-publish.yml/badge.svg)](https://github.com/SatelliteQE/broker/actions/workflows/python-publish.yml)\n[![ContainerImage](https://github.com/SatelliteQE/broker/actions/workflows/update_broker_image.yml/badge.svg)](https://github.com/SatelliteQE/broker/actions/workflows/update_broker_image.yml)\n[![CodeQL](https://github.com/SatelliteQE/broker/actions/workflows/codeql-analysis.yml/badge.svg)](https://github.com/SatelliteQE/broker/actions/workflows/codeql-analysis.yml)\n# Broker\nThe infrastrucure middleman\n\n\n# Description\nBroker is a tool designed to provide a common interface between one or many services that provision virtual machines. It is an abstraction layer that allows you to ignore (most) of the implementation details and just get what you need.\n\n# Installation\n```\ndnf install cmake\ncd <broker root directory>\npip install .   or   pip install broker\ncp broker_settings.yaml.example broker_settings.yaml\n```\nThen edit the broker_settings.yaml file\n\nBroker can also be ran outside of its base directory. In order to do so, specify the directory broker's files are in with the\n`BROKER_DIRECTORY` envronment variable.\n```BROKER_DIRECTORY=/home/jake/Programming/broker/ broker inventory```\n\n# Configuration\nThe broker_settings.yaml file is used, through DynaConf, to set configuration values for broker's interaction with its 'providers'.\n\nDynaConf integration provides support for setting environment variables to override any settings from the yaml file.\n\nAn environment variable override would take the form of: `DYNACONF_AnsibleTower__base_url=\"https://my.ansibletower.instance.com\"`. Note the use of double underscores to model nested maps in yaml.\n\nBroker allows for multiple instances of a provider to be in the configuration file. You can name an instance anything you want, then put instance-specfic settings nested under the instance name. One of your instances must have a setting `default: True`.\n\nFor the AnsibleTower provider, authentication can be achieved either through setting a username and password, or through a token (Personal Access Token in Tower).\n\nA username can still be provided when using a token to authenticate. This user will be used for inventory sync (examples below). This may be helpful for AnsibleTower administrators who would like to use their own token to authenticate, but want to set a different user in configuration for checking inventory.\n\n# Usage\n**Checking out a VM**\n```\nbroker checkout --workflow \"workflow-name\" --workflow-arg1 something --workflow-arg2 else\n```\nYou can pass in any arbitrary arguments you want. Broker can also checkout multiple VMs at once by specifying a count.\n```\nbroker checkout --nick rhel7 --count 3\n```\nTo specify an instance a checkout should be performed against, pass a flag name matching your provider class and a value matching the instance name.\n```\nbroker checkout --nick rhel7 --AnsibleTower testing\n```\nIf you have more complex data structures you need to pass in, you can do that in two ways.\nYou can populate a json or yaml file where the top-level keys will become broker arguments and their nested data structures become values.\n```\nbroker checkout --nick rhel7 --args-file tests/data/broker_args.json\n```\nYou can also pass in a file for other arguments, where the contents will become the argument's value\n```\nbroker checkout --nick rhel7 --extra tests/data/args_file.yaml\n```\n\n**Nicks**\n\nBroker allows you to define configurable nicknames for checking out vms. Just add yours to setting.yaml and call with the ```--nick``` option\n```\nbroker checkout --nick rhel7\n```\n\n**Duplicating a VM**\n\nBroker offers another shortcut for checking out a VM with the same recipe as one already checked out by Broker. This is via the ```duplicate``` command.\n```\nbroker duplicate my.awesome.vm.com\nbroker duplicate 0\nbroker duplicate 1 3\nbroker duplicate 0 --count 2\n```\n\n**Listing your VMs**\n\nBroker maintains a local inventory of the VMs you've checked out. You can see these with the ```inventory``` command.\n```\nbroker inventory\n```\nTo sync your inventory from a supported provider, use the `--sync` option.\n```\nbroker inventory --sync AnsibleTower\n```\nTo sync an inventory for a specific user, use the following syntax with `--sync`.\n```\nbroker inventory --sync AnsibleTower:<username>\n```\nTo sync an inventory for a specific instance, use the follow syntax with --sync.\n```\nbroker inventory --sync AnsibleTower::<instance name>\n```\nThis can also be combined with the user syntax above.\n```\nbroker inventory --sync AnsibleTower:<username>::<instance name>\n```\n\n\n**Extending your VM lease time**\n\nProviders supporting extending a VM's lease time make that functionality available through the `extend` subcommand.\n```\nbroker extend 0\nbroker extend hostname\nbroker extend vmname\nbroker extend --all\n```\n\n**Checking in VMs**\n\nYou can also return a VM to its provider with the ```checkin``` command.\nYou may use either the local id (```broker inventory```), the hostname, or \"all\" to checkin everything.\n```\nbroker checkin my.host.fqdn.com\nbroker checkin 0\nbroker checkin 1 3 my.host.fqdn.com\nbroker checkin --all\n```\n\n**Gaining information about Broker's providers**\n\nBroker's `providers` command allows you to gather information about what providers are avaiable as well as each providers actions. Additionally, you can find out information about different arguments for a provider's action with this command.\n```\nbroker providers --help\nbroker providers AnsibleTower --help\nbroker providers AnsibleTower --workflows\nbroker providers AnsibleTower --workflow remove-vm\n```\n\n**Run arbitrary actions**\n\nIf a provider action doesn't result in a host creation/removal, Broker allows you to execute that action as well. There are a few output options available as well.\n```\nbroker execute --help\nbroker execute --workflow my-awesome-workflow --additional-arg True\nbroker execute -o raw --workflow my-awesome-workflow --additional-arg True\nbroker execute -o raw --workflow my-awesome-workflow --additional-arg True --artifacts last\n```\n\n**machine processable output**\n\nIf running in a CI or other automated environment, Broker offers the choice to store important output information in an output file. This is json-formatted data. Please be aware that any existing file with the matching path and name will be erased.\n```\nbroker --output-file output.json checkout --nick rhel7\nbroker --output-file inventory.json inventory\n```\n\n**Run Broker in the background**\n\nCertain Broker actions can be run in the background, these currently are: checkout, checkin, duplicate, and execute. When running a command in this mode, it will spin up a new Broker process and no longer log to stderr. To check progress, you can still follow broker's log file.\nNote that background mode will interfere with output options for execute since it won't be able to print to stdout. Those should kept in log mode.\n```\nbroker checkout --background --nick rhel7\nbroker checkin -b --all\nbroker duplicate -b 0\nbroker execute -b --workflow my-awesome-workflow --artifacts\n```\n\n**Filter hosts for Broker actions**\n\nActions that Broker can take against hosts (checkin, duplicate, extend) can take in a filter argument. This filter will decide which hosts the actions are applied to. A filter by itself will not select hosts for these actions, you will still need to specify which hosts to act against, or use `--all` when available. From there, the filter decides which of those hosts make it through to be acted upon.\n\nBroker's filters are based on what is stored in its local inventory file. Therefore, only properties in that file are filter-able. Nested properties are annotated with a `.` notation. For example, a top-level property `hostname` can be accessed by itself. However, a nested property of `_broker_args` called `version` would be accessed by `_broker_args.version`.\n\nFilters take the form `\"(property)(condition)(value)\"`. Filters have several possible conditions:\n - `<` means \"in\" or that the filter value exists within the actual value\n - `=` means \"equals\"\n - `{` means \"starts with\"\n - `}` means \"ends with\"\n\nFurthermore, putting a `!` before the condition inverts the filter. So `!=` means \"not equals\" and `!<` means \"not in\".\n\n**Example filters:**\n\n`--filter 'hostname<test'` The string test should exist somewhere in the hostname value\n`--filter '_broker_args.template{deploy-sat'` The template should start with the string \"deploy-sat\"\n\nYou can also chain multiple filters together by separating them with a comma. These are additive AND filters where each filter condition must match.\n\n`--filter 'name<test,_broker_args.provider!=RHEV'` The host's name should have test in it and the provider should not equal RHEV.\n\n**Note:** Due to shell expansion, it is recommended to wrap a filter in single quotes.\n",
  "permissions": {
    "read": true,
    "write": false,
    "admin": false
  },
  "media_types": [
    "application/vnd.docker.container.image.v1+json"
  ],
  "content_types": [
    "image"
  ]
}