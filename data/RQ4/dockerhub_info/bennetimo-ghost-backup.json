{
  "user": "bennetimo",
  "name": "ghost-backup",
  "namespace": "bennetimo",
  "repository_type": "image",
  "status": 1,
  "status_description": "active",
  "description": "Easily backup and restore your Ghost blog",
  "is_private": false,
  "is_automated": true,
  "can_edit": false,
  "star_count": 7,
  "pull_count": 23583,
  "last_updated": "2022-01-06T02:40:05.257246Z",
  "date_registered": "2015-12-16T22:34:24.40426Z",
  "collaborator_count": 0,
  "affiliation": null,
  "hub_user": "bennetimo",
  "has_starred": false,
  "full_description": "# ghost-backup\n\nghost-backup is a simple, automated, backup (and restore) [Docker] container for a [Ghost] blog. It supports Ghost configured with either sqlite or mysql/[mariadb]. \n\nghost-backup can:\n\n * Take a full backup of your ghost blog with a single `backup` command\n   * Database backup (mysql or mariadb)\n   * Content files backup (images, themes etc)\n   * Json file backup (retrieved by accessing the export feature of the ghost api)\n * Automate backups according to any arbitrary schedule (via cron)\n * Allow restore of files selectively and interactively\n * Be extensively customised\n\nBy default it will create a backup of your ghost content directory (images, themes, apps etc), the database \n(actual posts), and the exported json file daily at 3am, keeping the most recent 30 backups of each.\n\nWhen using sqlite, the db backup/restore is handled using the [command line shell] of the [online backup API]. \nFor mysql/mariadb, it uses [mysqldump](https://dev.mysql.com/doc/refman/5.5/en/mysqldump.html).\n\n### Quick Start (Ghost using sqlite)\nGhost uses sqlite by default if you have not changed the [configuration](https://docs.ghost.org/docs/config) to mysql.\n\nCreate and run the ghost-backup container with the volumes from your Ghost data container:\n\n`docker run --name ghost-backup -d --volumes-from <your-ghost-container> bennetimo/ghost-backup`\n\nWhere:\n\n`<your-ghost-container>` is either your Ghost blog container, or a separate data-only container/[volume] holding your blog files. Basically, wherever your blog content lives.\n\nThat's it! This will create and run a container named 'ghost-backup' which will create a backup of your Ghost database and content files under `/backups` inside the `ghost-backup` container every day at 3am.\n\n> If you want json file backup also, a few more options are required\n\nThe below sections walk through customizing the backup.\n\n### Quick Start (Ghost using mysql/mariadb)\n\nIf your Ghost [configuration](https://docs.ghost.org/docs/config) is using mysql/mariadb then you just need to start the ghost-backup\ncontainer on the same [network] as your database container, so that it can talk to your database.  \n\n```\ndocker run --name ghost-backup -d \\\n    --volumes-from <your-ghost-container> \\\n    --network=<your network> \\\n    -e MYSQL_USER=<yourdbuser> \\\n    -e MYSQL_PASSWORD=<yourdbpassword> \\\n    -e MYSQL_DATABASE=<yourdatabase> \\\n    bennetimo/ghost-backup\n```\n\nWhere:\n  * `<your-ghost-container>` is as above\n  * `<your-network>` is a network that your database container is connected to. It should be accessible using the hostname 'mysql' which you can set with [--network-alias]\n  * MYSQL_ vars are the details needed to access your database \n \n> This could also be setup via [container links], but this feature is now considered legacy and deprecated.\n\n### Configuring the backup location\n\nBy default, the backups will live in `/backups` inside the `ghost-backup` container. You can verify they're \nthere with `docker exec ghost-backup ls /backups`. \n\nTo mount the backups directory somewhere on the host add:\n`-v </backup/folder/on/host>:/backups` to your docker run command.\n\nTo use [docker volumes](https://docs.docker.com/storage/volumes/), first create the volume, then attach it to both the ghost container \nand backup container. See the bottom of this readme for an example docker-compose\nconfiguration using volumes.\n\n> To change the backups folder used in the container set the env var: BACKUP_LOCATION=/your/new/location\n\n### Ghost json file backup/restore setup\n\nGhost labs has had a feature to [export your blog content](https://help.ghost.org/article/13-import-export) as a single json file for a long time. Since version\n1.x+ it is also possible to [import a json file](https://docs.ghost.org/docs/migrating-to-ghost-1-0-0#section-3-use-the-ghost-1-0-0-importer). This is a mandatory step \nwhen upgrading from ghost 0.x to 1.x as the database format changed. ghost-backup can be configured to export/import this json file using the exact same api that it used when \nyou initiate this manually via http://yourghostblog/ghost/labs.\n\n> If you import a json file twice, all posts will be duplicated. The API does not seem to currently filter out duplicate posts so be careful\n\nTo use the json api, ghost-backup needs to authenticate and obtain an [access token](https://api.ghost.org/docs/user-authentication#retrieve-a-bearer-token-via-curl ), and needs to be able to\ncommunicate with your ghost service.\n\nYou need to configure the following additional environment variables, so that an access token can be retrieved:\n \n * GHOST_SERVICE_USER_EMAIL # The email address of a user configured in your ghost installation (N.B. this should be uri encoded, e.g. my-email.%40example.com) \n * GHOST_SERVICE_USER_PASSWORD # The password for that user\n \n > A good idea would be to create a new user in your ghost admin panel specifically for ghost-backup and use those credentials here\n\nghost-backup expects to be able to communicate with your ghost service via the hostname `ghost` using the\ndefault port of `2368`. If you need to override these, you can override the env vars:\n\n * GHOST_SERVICE_NAME \n * GHOST_SERVICE_PORT\n\nTo use the json api a [client id and secret](https://api.ghost.org/docs/client-authentication) is also required. With a standard ghost install there are several clients preconfigured,\nincluding 'ghost-frontend' and 'ghost-backup'. Each of these gets a secret randomly generated and put into the database. By default\nghost-backup will use the 'ghost-backup' client and read the corresponding secret from the database so you do not need to configure this.\nHowever if you need to override the client used for any reason, you can set the `CLIENT_SLUG` for your ghost-backup container.\n\nA full configuration with support for json import/export might look like this:\n\n```\ndocker run --name ghost-backup -d \\\n    --volumes-from <your-ghost-container> \\\n    --network=<your-network> \\\n    -e MYSQL_USER=<yourdbuser> \\\n    -e MYSQL_PASSWORD=<yourdbpassword> \\\n    -e MYSQL_DATABASE=<yourdatabase> \\\n    -e GHOST_SERVICE_USER_EMAIL=<my-email.%40emample.com> \\\n    -e GHOST_SERVICE_USER_PASSWORD=<mypassword> \\\n    bennetimo/ghost-backup\n```\n\n### Perform a manual backup\n`docker exec ghost-backup backup`\n\nThis will create an immediate backup. You should now have backup files created in the backup folder (`/backups` by default). \nOne archive is the database, one the archive of your content files, and if configured also a json export of your ghost blog.\n\n>Note that backups are tagged with the date and time in the form yyyymmdd-hhmm, therefore if two backups are created in the same minute then the second will overwrite the first.\n\n### Restore a backup\nA backup is no good if it can't be restored :) You can do that in three ways:\n\n> N.B. After a database restore you will likely need to restart your ghost block container to see the changes\n\n#### Interactive restore\nYou can launch an interactive backup menu using:\n`docker exec -it ghost-backup restore -i`\nThis will display a menu with all of the available backup files. You can select which to restore by number or name. \n\n> Using interactive backup you can restore a DB archive separately to a Ghost files archive\n\n#### By date restore\nYou can also restore by date:\n\n`docker exec ghost-backup restore -d yyyymmdd-hhmm`\nThis will restore the backup files from yyyymmdd-hhmm, if found. \n\n> Date restore expects to find both a db and content files archive for the corresponding date, or will stop.\nIf you want to restore just one of the other (or a json file), use either file restore or interactive restore\n\n#### By file restore\nYou can restore a given file mounted to the container:\n\n`docker exec ghost-backup restore -f /path/to/file/filename`\n\n> N.B. Be sure to use fully qualified path names when restoring a single file\n\n#### In place restore\nBy default the restore script will remove the ghost files from `GHOST_LOCATION/content` before restoring the archive, except for the database which is handled separately. \n\nTo restore without removing files first you can specify the command argument capitalised, e.g. `-I, -D, -F`.\n\n#### Matching files to restore\n\nghost-backup uses the following matches to determine whether a file to restore is a db archive, content archive, or json file:\n\n```\nDB_ARCHIVE_MATCH=\"${BACKUP_FILE_PREFIX}.*db.*gz\"\nGHOST_ARCHIVE_MATCH=\"${BACKUP_FILE_PREFIX}.*ghost.*tar\"\nGHOST_JSON_FILE_MATCH=\"${BACKUP_FILE_PREFIX}.*ghost.*json\"\n```\n\nIf you rename your backup files, they must match these patterns to be able to restore.\n\n### Advanced Configuration\nghost-backup has a number of options which can be configured as you need. \n\n| Environment Variable  | Default       | Meaning           |\n| --------------------- | ------------- | ----------------- | \n| BACKUP_TIME           | 0 3 * * *   | A [cron expression] controlling the backup schedule.|\n| BACKUP_LOCATION       | /backups    | Where the backups are written to|\n| BACKUPS_RETAIN_LIMIT  | 30            | How many backups to keep. Oldest are removed first|\n| LOG_LOCATION          | /var/log/ghost-backup.log | Location of the log file |\n| AUTOMATED_BACKUPS     | true             | Whether scheduled backups are on |\n| GHOST_LOCATION\t\t| /var/lib/ghost/content | Location of ghost content and db files |\n| BACKUP_FILE_PREFIX    | backup | Prefix for all created backup files |\n| MYSQL_SERVICE_NAME    | mysql | Hostname  of mysql container (if applicable) |\n| MYSQL_SERVICE_PORT    | 3306 | Port of mysql container (if applicable) |\n| SQLITE_DB_NAME        | ghost.db      | Name of sqlite database (if applicable) |\n| CLIENT_SLUG           | ghost-backup  | client used for authenticating with the ghost json api |\n| GHOST_SERVICE_NAME    | ghost         | Hostname of ghost container (if applicable) |\n| GHOST_SERVICE_PORT    | 2368          | Port of ghost container   |\n\n\nFor example, if you wanted to backup at 2AM to the location /some/dir/backups, storing 10 days of backups you would use:\n\n```\ndocker run --name ghost-backup -d \\\n        --volumes-from <your-data-container> \\\n        -e \"BACKUP_LOCATION=/some/dir/backups\" \\\n        -e \"BACKUP_TIME=0 2 * * *\" \\\n        -e \"BACKUPS_RETAIN_LIMIT=10\" \\\n         bennetimo/ghost-backup\n```\n\n> This example is for Ghost using sqlite. If you're using mysql/mariadb just add the linked mysql containers as described above.\n\n#### Disable backup types\n\nBy default, the backup will have a Ghost content files archive, a DB archive, an exported json file \n(if connected to your ghost service) and purge any excess old backups specified by the `BACKUPS_RETAIN_LIMIT`.\nEach of these can be disabled with command arguments:\n\n * -D //Do not include a DB archive\n * -F //Do not include a ghost content files archive\n * -J //Do not include a ghost json file export\n * -P //Do not purge old files\n\nFor example to perform a backup of just the DB with no purge:\n\n`docker exec ghost-backup backup -FJP`\n\n### Backup to Dropbox\nYou can configure the backup location as you wish, which if used in conjunction with [bennetimo/docker-dropbox] will backup to a [Dropbox] folder.\n\nTo do this, you need to have a dropbox container running, linked to your account:\n`docker run -d --name dropbox bennetimo/docker-dropbox`\n\n> You need to link this container to your Dropbox account first, see [docker-dropbox quickstart]\n\nThen create your backup container using the Dropbox volume:\n```\ndocker run --name ghost-backup -d \\\n        --volumes-from <your-ghost-container> \\\n        --volumes-from <your-dropbox-container> \\\n        -e \"BACKUP_LOCATION=/root/Dropbox\" \n        bennetimo/ghost-backup`\n```\n\nThat's it. Now if your Dropbox container has been linked correctly to your account you'll have a backup of your blog added every day at 3am to your Dropbox. \n\n### View the logs\n`docker logs ghost-backup`\nWill display logs of all of backup runs (manual and automated) and restore operations. By default the log file is at: `/var/log/ghost-backup.log`\n\n### Disabling automated backups\nIf you want to disable automated backups and just perform them manually as necessary, then you can stop the crontab installation by starting your container as:\n\n```\ndocker run -d --name ghost-backup \\\n    --volumes-from <your-ghost-container> \n    -e \"AUTOMATED_BACKUPS=false\" bennetimo/ghost-backup\n```\n\nNow you can run:\n`docker exec ghost-backup backup`\n\nEvery time you want to take a backup. You can restore as normal (described above).\n\n### Using ghost-backup for cloning an environment locally\nYou can use ghost-backup to create a local test environment for your blog, with all the posts and content. This allows\nyou to write your posts, tweak your theme and check everything is working locally before cloning it exactly\non your live blog. To do this:\n\n1. Setup your local/dev dockerised ghost blog\n2. Setup the ghost-backup container for your local blog as described in this readme, with e.g. Dropbox as the backup location\n3. Create a live dockerised blog on your remote server, also with ghost-backup configured to use a suitable backups mount\n\nNow your workflow will be:\n\n1. Write/edit content locally\n2. Take a local backup with `docker exec ghost-backup backup`\n3. Transfer your backup archives to your remote host (e.g. scp/DropBox) to the mounted backup location\n4. On the remote host `docker exec ghost-backup restore -i` and restore your backup files\n5. Restart your remote ghost blog to pick up changes\n\n### Example Docker Compose Configuration\n\nUsing [docker-compose](https://docs.docker.com/compose/) makes it easy to configure all the requirement components. \n\nThe example configuration below will startup a ghost container, mariadb container and ghost-backup container\nall on the same network so that ghost backup can work.\n\nThen:\n\n 1. `docker-compose up`\n 1. View your blog at [http://localhost:2368/](http://localhost:2368/)\n 1. Take a backup with `docker exec ghost-backup backup`\n \n> When first starting up, ghost may try to connect to the mysql container before it is ready for connections generating\na few error messages. After a few tries it will succeed, or to avoid this you can start the mysql container separately first,\nor do something else to [control startup order](https://docs.docker.com/compose/startup-order/)\n\n```\nversion: \"3.7\"\n\nservices:\n # Ghost container\n ghost:\n  image: ghost:1.25\n  restart: always\n  ports:\n   - \"2368:2368\"\n  environment:\n   - database__client=mysql\n   - database__connection__host=mysql\n   - database__connection__database=ghost\n   - database__connection__user=yourdbuser\n   - database__connection__password=yourdbpassword\n  volumes:\n  - \"data-ghost-content:/var/lib/ghost/content\"\n\n # Database container\n mysql:\n  image: mariadb:10.3\n  restart: always\n  environment:\n   - MYSQL_ROOT_PASSWORD=myrootpassword\n   - MYSQL_USER=yourdbuser\n   - MYSQL_PASSWORD=yourdbpassword\n   - MYSQL_DATABASE=ghost\n  expose:\n  - \"3306\"\n  volumes:\n  - \"data-ghost-db:/var/lib/mysql\"\n\n # Ghost backup container\n ghost-backup:\n  image: bennetimo/ghost-backup:1.25\n  container_name: \"ghost-backup\"\n  environment:\n   - MYSQL_USER=yourdbuser\n   - MYSQL_PASSWORD=yourdbpassword\n   - MYSQL_DATABASE=ghost\n  volumes:\n  - \"data-ghost-content:/var/lib/ghost/content\"\n\n# Data volumes containing all the persistent storage for the blog\nvolumes:\n data-ghost-content:\n data-ghost-db:\n```\n\n> N.B. The above is shown as a self contained file for completeness. But, you'd probably want to look at using\n[env_files](https://docs.docker.com/compose/environment-variables/#the-env_file-configuration-option) or \n[multiple compose files](https://docs.docker.com/compose/extends/#multiple-compose-files) for better separation\n\n### Versions\n\nGhost 0.x to 1.x introduced some breaking changes so backups and restores between them are not possible without a little work.\n\nghost-backup 0.7.3 is an earlier version of this container for ghost 0.x releases.\n\nghost-backup 1.x is for ghost 1.x+ releases.\n\n#### Migrating from ghost 0.x to 1.x+\n\nFollow ghosts [migration guide](https://docs.ghost.org/docs/migrating-to-ghost-1-0-0).\n\nDatabase backups will *not* be compatible between these two major versions. However *the json backup is*.\n\nFor content files that used to live under `/var/lib/ghost` in 0.x moved to `/var/lib/ghost/content` in 1.x, as\nwell as there being a few other changes with config/themes etc.\n\n### Other Info\n\nThis container was inspired by [wordpress-backup]. \n\n**Disclaimer:** Will not be held responsible for any loss of files/backups arising from your use of this \ncontainer. **Be sure to test your backup/restore process when you first set everything up to make sure it\nis all working as you expect.**\n\n [Docker]: https://www.docker.com/\n [volume]: https://docs.docker.com/storage/volumes/\n [container links]: https://docs.docker.com/network/links/\n [network]: https://docs.docker.com/engine/reference/commandline/network_create/#extended-description\n [--network-alias]: https://docs.docker.com/engine/reference/run/#network-settings\n [Ghost]: https://ghost.org/\n [cron expression]: https://en.wikipedia.org/wiki/Cron#Format\n [Dropbox]: https://www.dropbox.com/\n [bennetimo/docker-dropbox]: https://hub.docker.com/r/bennetimo/docker-dropbox/\n [docker-dropbox quickstart]: https://github.com/bennetimo/docker-dropbox#quick-start\n [mariadb]: https://hub.docker.com/_/mariadb/\n [command line shell]: https://www.sqlite.org/cli.html\n [online backup API]: https://www.sqlite.org/backup.html\n [wordpress-backup]: https://hub.docker.com/r/aveltens/wordpress-backup/\n [client authentication]: https://api.ghost.org/docs/client-authentication\n\n",
  "permissions": {
    "read": true,
    "write": false,
    "admin": false
  },
  "media_types": [
    "application/vnd.docker.container.image.v1+json"
  ],
  "content_types": [
    "image"
  ]
}