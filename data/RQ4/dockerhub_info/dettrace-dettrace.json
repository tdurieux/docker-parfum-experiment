{
  "user": "dettrace",
  "name": "dettrace",
  "namespace": "dettrace",
  "repository_type": "image",
  "status": 1,
  "status_description": "active",
  "description": "Automated build of dettrace reproducible container software.",
  "is_private": false,
  "is_automated": false,
  "can_edit": false,
  "star_count": 0,
  "pull_count": 43,
  "last_updated": "2020-09-20T04:56:29.053168Z",
  "date_registered": "2020-03-18T14:16:15.84772Z",
  "collaborator_count": 0,
  "affiliation": null,
  "hub_user": "dettrace",
  "has_starred": false,
  "full_description": "\n# DetTrace: A Reproducible Container Abstraction\n\n[![Build Status](https://dev.azure.com/upenn-acg/detTrace/_apis/build/status/dettrace.dettrace?branchName=master)](https://dev.azure.com/upenn-acg/detTrace/_build/latest?definitionId=1&branchName=master)\n\nHere, we give an overview of the command line interface for Dettrace as well as common Dettrace workflows. We describe the steps necessary to build Dettrace, software dependencies, hardware requirements, and compiler toolchains. Furthermore, we show various example use-cases for Dettrace and using chroot environments.\n\n## Quick Start\n\nTo quickly run something deterministically, use Docker.  Clone this repository and build:\n\n```bash\ndocker build -t dettrace .\ndocker run -it --rm --privileged dettrace\n```\n\nOr pull and run from DockerHub:\n\n```bash\ndocker run -it --rm --privileged dettrace/dettrace\n```\n\nOnce inside the container (in privileged mode with CAP_SYS_ADMIN), you can run under dettrace:\n\n```bash\n> dettrace  --epoch=\"1980-01-01,00:00:00\" date\nTue Jan  1 00:00:00 UTC 1980\n```\n\nIn this simple example, by controlling the container config, we\ncontrolled the virtual time exposed through system calls inside the\nreproducible container.\n\n\n## Description\n\nThe latest version of Dettrace can be found on GitHub at https://github.com/dettrace/dettrace.\n\n### Hardware dependencies\nThe Dettrace prototype currently only works for x86-64 Intel CPUs. While not strictly necessary, portability guarantees are strongest when the CPU supports intercepting certain nondeterministic CPU instructions, e.g., CPUID.\n\n### Software dependencies\nDettrace works well with kernel versions 4.8 through 5.3 (only minor modifications should be necessary to allow Dettrace to work in newer kernel versions). Kernel version < 4.8 use a slower\nptrace implementation (more details in publication) making overall execution of Dettrace slower. Kernel version >= 4.12 are required for OS support for CPUID interception. Currently Dettrace has a few dependencies:\n- libssl: Hashing implementation for bytes from read system call (Useful for debugging nondeterministic bytes read from pipe).\n- libseccomp: Helper library for finer-grained system call filtering using seccomp-bpf.\n- libarchive: Unpackaging archive files used by Dettrace.\n- libelfin: ELF/DWARF parser.\n- libfuse: test-only dependence, used for filesystem tests.\n\n\nThese dependencies are fairly common and should be easy to install from your Linux distro's package manager. For Apt these are libarchive-dev, libssl-dev, and libseccomp-dev, libelfin-dev, and libfuse-dev.\n\nDettrace relies on various Linux namespaces for isolation and determinism. Some systems disable user namespaces by default. If you encounter a `clone failed: operation not permitted` error, please enable user namespace access (the exact method may depend on your distro and OS version). Furthermore, Linux does not allow user namespaces for processes whose root is not `/` (the chroot system call was executed at some point).\n\n### Data sets\n\nWhile Dettrace is designed to enforce reproducibility for arbitrary computation, the prototype implementation is tailored to work with Debian packages and chroot environments. The Debian Apt Package Repository and chroot images available through debootstrap may be of interest. Our prototype was used to build the now old Debian Wheezy packages; recent Debian version may execute system calls not currently implemented in Dettrace.\n\n## Installation\n\nDettrace uses a standard Makefile for compilation. Assuming you have the all the software dependencies (above), and a C++ compiler supporting C++14, running `make` in the root directory of the repository will generate the Dettrace binary under `bin/`. Dettrace may also be statically linked using `make static` assuming all the correct dependencies are present as statically linkable objects. Dettrace may be installed anywhere on the system by moving the `bin/` directory along with the `root/` directory. This directory structure must be maintained as the Dettrace binary always expects `root/` to be located at the directory `../root` relative to the location of the Dettrace binary (see reasoning below).\n\nThe word `chroot` is unfortunately overloaded, referring to both the Linux system call which changes the location of the root directory for a process, and for the concept of a directory tree which \"looks like\" a Linux filesystem, containing all the binaries, libraries, and special files (e.g. `/proc`, `/dev/`) necessary for a Linux system to function.\n\nThe Debian command `debootstrap` is an easy way to get such a chroot environment. For more information see: https://wiki.debian.org/chroot. If you're using a different Linux distribution, you should consult the documentation to find the appropriate way to install a chroot. You can install debootstrap from the Apt repository. `sudo apt install debootstrap`.\n\nOne can install a Stretch Debian chroot by running the commands:\n\n```bash\n> mkdir stretch\n> sudo debootstrap stretch stretch/ http://deb.debian.org/debian\n```\n\nUnfortunately, this requires root permissions. Once you have downloaded the chroot, you should have a `stretch/` directory which we can `ls`:\n```bash\n> ls stretch\nbin/   dev/  home/  lib64/  mnt/  proc/  run/\nboot/  etc/  lib/   media/  opt/  root/  sbin/\n```\n\nAs you can see, this looks just like a Linux filesystem tree. Dettrace accepts any such chroot to be used as the starting image. As Dettrace will be using the files in `stretch/`\nwe need to ensure the permissions are correct (more information can be found at https://wiki.debian.org/chroot):\n```bash\n> sudo chgrp -R $USER stretch/\n> sudo chown -R $USER stretch/\n```\n\nYou are now ready to use Dettrace and the chroot (see below).\n\n## Experiment workflow\n\nDettrace is a command line tool which makes it easy to make computation reproducible. You can simply prepend the command you are interested in determinizing with `./path/to/dettrace`, but if you want to execute a command containing hyphenated flags, be sure to separate it with ` -- `.\nFor example:\n\n```bash\n> ./bin/dettrace -- ls -ahl\n-rw-r--r-- 1 root ... Jan 1 1970 initramfs.cpio\ndrwxr-xr-x 1 root ... Jan 1 1970 root\n-rw-r--r-- 1 root ... Jan 1 1970 shell.nix\ndrwxr-xr-x 1 root ... Jan 1 1970 src\n...\n```\nNote the modification dates of all files are now deterministic! Dettrace will determinize the specified program along with any subprocesses that are spawned. Furthermore, Dettrace containerizes the program to guarantee a reproducible starting filesystem.  For example `/tmp` must always start empty, and if we generate a temp file it must be deterministic:\n\n```bash\n> ./bin/dettrace -- ls /tmp\n> ./bin/dettrace -- bash -c 'mktemp; ls /tmp'\n/tmp/tmp.GF2eacAJCh\ntmp.GF2eacAJCh\n```\n\nSimilarly we may create a file and then `stat` the file with Dettrace:\n```bash\n> touch foo.txt\n> ./bin/dettrace stat foo.txt\n  File: foo.txt\n  Size: 0\t Blocks: 1  IO Block: 512 ...\nDevice: 1h/1d\tInode: 8   Links: 1\nAccess: (0644/-rw-r--r--)  Uid: ...\nAccess: 1970-01-01 00:00:00.000000000 +0000\nModify: 1970-01-01 00:00:00.000000000 +0000\nChange: 1970-01-01 00:00:00.000000000 +0000\n Birth: -\n```\nNotice the file's metadata is now deterministic!\n\nThe current release of dettrace does not build its a custom chroot environment for executing each command.  Rather, you can control the base filesystem image using existing container technology like Docker.  Running dettrace inside a Docker container will expose the `/` file system including CWD.\n\n## Evaluation and expected result\n\nAny program running under Dettrace is expected to produce deterministic output. So running the `date` command multiple times will produce the same result.\n\n```bash\n> ./bin/dettrace date\nSun Aug  8 22:00:00 UTC 1993\n> ./bin/dettrace date\nSun Aug  8 22:00:00 UTC 1993\n```\n\nDettrace comes with dozens of sample nondeterministic programs meant to stress test different sources of nondeterminism found in programs. These programs are designed to be nondeterministic, and have an expected, deterministic, output when running under Dettrace. You may test your installation by running `make test` to run all our sample programs and integration tests. If docker is installed you may run `make test-docker` to run the same tests under a Docker environment instead. Docker is the preferred way to run the tests as it handles hard-to-reproduce sources of irreproducibility seen in the wild.\n\nLet's do a reproducible build! For simplicity we will use Dettrace itself as the program to build reproducibly. From the root directory of the Dettrace repository:\n```bash\n./bin/dettrace -- make -C src/\n```\n\nThis will build Dettrace deterministically under Dettrace. You can use a program like `hashdeep` to hash the binary outputs of programs and ensure the results are deterministic\nacross builds.\n\n## Experiment customization\n\nDettrace has several command line options which may be useful. See `./bin/dettrace --help` for list of all options.\n\n## Contribution Guidelines\n\nAs more people work concurrently on DetTrace, and the project becomes more complicated,\nplease follow the following guidelines for contributing to DetTrace.\n\n1) Every commit from now on should represent a working, testable, version of DetTrace,\n    please squash commits as needed to have every commit represent a logical, working\n    state of DetTrace.\n2) Please create and add an integration test for any change made made to DetTrace if\n    possible. This will avoid future regressions, and ensure your change works.\n3) Pushing to master has been disabled for all of us!\n    Submit a pull request with your changes. We should\n    all do a better job and hold each other accountable for reviews and quick pull\n    request merges to keep things moving along.\n4) Rebase changes to the latest commit in master (head) before submitting a pull request.\n5) Use rebase instead of merge when updating your branch with the latest DetTrace changes.\n6) Keep pull request commit numbers short when possible. It is hard/impossible to follow\n    pull requests consisting of hundreds of commits!\n",
  "permissions": {
    "read": true,
    "write": false,
    "admin": false
  },
  "media_types": [
    "application/vnd.docker.container.image.v1+json"
  ],
  "content_types": [
    "image"
  ]
}