{"startTime":"2023-01-11T11:40:44.273Z","endTime":1673437267784,"repository":"sbs20/scanservjs","organization":"docker-parfum","dockerfilePath":"Dockerfile","dockerfile_sha":"83cdb6c2439653665d89e793acb2e5924ba7bd0e","dockerfile":"# Builder image\n#\n# The builder image simply builds the core javascript app and nothing else\n# ==============================================================================\nFROM node:16-alpine AS scanservjs-build\nENV APP_DIR=/app\nWORKDIR \"$APP_DIR\"\n\nCOPY package*.json \"$APP_DIR/\"\nCOPY packages/server/package*.json \"$APP_DIR/packages/server/\"\nCOPY packages/client/package*.json \"$APP_DIR/packages/client/\"\n\nRUN npm run install\n\nCOPY packages/client/ \"$APP_DIR/packages/client/\"\nCOPY packages/server/ \"$APP_DIR/packages/server/\"\n\nRUN npm run build\n\n# Sane image\n#\n# This is the minimum bullseye/node/sane image required which is used elsewhere.\n# ==============================================================================\nFROM node:16-bullseye-slim AS scanservjs-base\nRUN apt-get update \\\n  && apt-get install -yq \\\n    imagemagick \\\n    sane \\\n    sane-utils \\\n    tesseract-ocr \\\n    tesseract-ocr-ces \\\n    tesseract-ocr-deu \\\n    tesseract-ocr-eng \\\n    tesseract-ocr-spa \\\n    tesseract-ocr-fra \\\n    tesseract-ocr-ita \\\n    tesseract-ocr-nld \\\n    tesseract-ocr-pol \\\n    tesseract-ocr-por \\\n    tesseract-ocr-rus \\\n    tesseract-ocr-tur \\\n    tesseract-ocr-chi-sim \\\n    sane-airscan \\\n  && sed -i \\\n    's/policy domain=\"coder\" rights=\"none\" pattern=\"PDF\"/policy domain=\"coder\" rights=\"read | write\" pattern=\"PDF\"'/ \\\n    /etc/ImageMagick-6/policy.xml \\\n  && sed -i \\\n    's/policy domain=\"resource\" name=\"disk\" value=\"1GiB\"/policy domain=\"resource\" name=\"disk\" value=\"8GiB\"'/ \\\n    /etc/ImageMagick-6/policy.xml \\\n  && npm install -g npm@8.3.0\n\n# Core image\n#\n# This is the minimum core image required. It installs the base dependencies for\n# sane and tesseract. The executing user remains ROOT. If you want to build your\n# own image with drivers then this is likely the image to start from.\n# ==============================================================================\nFROM scanservjs-base AS scanservjs-core\n\nENV APP_DIR=/app\nWORKDIR \"$APP_DIR\"\n\nENV \\\n  # This goes into /etc/sane.d/net.conf\n  SANED_NET_HOSTS=\"\" \\\n  # This gets added to /etc/sane.d/airscan.conf\n  AIRSCAN_DEVICES=\"\" \\\n  # This directs scanserv not to bother querying `scanimage -L`\n  SCANIMAGE_LIST_IGNORE=\"\" \\\n  # This gets added to scanservjs/server/config.js:devices\n  DEVICES=\"\" \\\n  # Override OCR language\n  OCR_LANG=\"\"\n\n# Copy entry point\nCOPY run.sh /run.sh\nRUN [\"chmod\", \"+x\", \"/run.sh\"]\nENTRYPOINT [ \"/run.sh\" ]\n\n# Copy the code and install\nCOPY --from=scanservjs-build \"$APP_DIR/dist\" \"$APP_DIR/\"\nRUN npm install --production\n\nEXPOSE 8080\n\n# User2001 image\n#\n# This image changes the executing user to 2001 for increased security. This\n# also, however, leads to some runtime issues with parameters. This was the\n# default behaviour from v2.9.0 until v2.18.1 and was because issue #177. This\n# stage is kept for backwards compatibility.\n# ==============================================================================\nFROM scanservjs-core AS scanservjs-user2001\n\n# Make it possible to override the UID/GID/username of the user running scanservjs\nARG UID=2001\nARG GID=2001\nARG UNAME=scanservjs\n\n# Create a known user, and change ownership on relevant files (the entrypoint\n# script and $APP_DIR must be readable to run the service itself, and some\n# config files need write access).\nRUN groupadd -g $GID -o $UNAME \\\n  && useradd -o -u $UID -g $GID -m -s /bin/bash $UNAME \\\n  && chown -R $UID:$GID /run.sh \"$APP_DIR\" /etc/sane.d/net.conf /etc/sane.d/airscan.conf\nUSER $UNAME\n\n# default build\nFROM scanservjs-core\n\n# hplip image\n#\n# This image adds the HP scanner libs to the image. This target is not built by\n# default - you will need to specifically target it.\n# ==============================================================================\nFROM scanservjs-core AS scanservjs-hplip\nRUN apt-get install -yq libsane-hpaio \\\n  && apt-get clean \\\n  && rm -rf /var/lib/apt/lists/* \\\n  && echo hpaio >> /etc/sane.d/dll.conf\n"}