{"startTime":"2023-01-11T10:19:10.739Z","endTime":1673432356560,"repository":"usgs/nshmp-haz","organization":"docker-parfum","dockerfilePath":"Dockerfile","dockerfile_sha":"2b9d91e77219a70e3bf802ac0663c7971af9b484","dockerfile":"####\n# Dockerfile for nshmp-haz.\n#\n# Usage:\n#   docker run \\\n#       -e PROGRAM=<deagg | deagg-epsilon | deagg-iml | hazard | hazard-2018 | rate> \\\n#       -e MODEL=<WUS-20[08|14|18] | CEUS-20[08|14|18] | COUS-20[08|14|18] | AK-2007> \\\n#       -v /absolute/path/to/sites/file:/app/sites.<geojson | csv> \\\n#       -v /absolute/path/to/config/file:/app/config.json \\\n#       -v /absolute/path/to/output:/app/output \\\n#       usgs/nshmp-haz\n#\n# Usage with custom model:\n#   docker run \\\n#       -e PROGRAM=<deagg | deagg-epsilon | deagg-iml | hazard | hazard-2018 | rate> \\\n#       -e MOUNT_MODEL=true \\\n#       -v /absolute/path/to/model:/app/model \\\n#       -v /absolute/path/to/sites/file:/app/sites.<geojson | csv> \\\n#       -v /absolute/path/to/config/file:/app/config.json \\\n#       -v /absolute/path/to/output:/app/output \\\n#       usgs/nshmp-haz\n#\n# Note: Models load as requested. While all supported models are\n# available, requesting them all will eventually result in an\n# OutOfMemoryError. Increase -Xmx to -Xmx16g or -Xmx24g, if available.\n####\n\nARG BUILD_IMAGE=usgs/amazoncorretto:8\nARG FROM_IMAGE=usgs/amazoncorretto:8\n\n# Project\nARG project=nshmp-haz\n\n# Builder image working directory\nARG builder_workdir=/app/${project}\n\n# Path to JAR file in builder image\nARG jar_path=${builder_workdir}/build/libs/${project}.jar\n\n####\n# Builder Image: Java 11\n#   - Install git\n#   - Build nshmp-haz\n####\nFROM ${BUILD_IMAGE} as builder\n\n# Get builder workdir\nARG builder_workdir\n\n# Set working directory\nWORKDIR ${builder_workdir}\n\n# Copy project over to container\nCOPY . ${builder_workdir}/.\n\n# Build nshmp-haz\nRUN ./gradlew assemble\n\n####\n# Application Image: Java 11\n#   - Install jq\n#   - Copy JAR file from builder image\n#   - Download model\n#   - Run nshmp-haz (docker-entrypoint.sh)\n####\nFROM ${FROM_IMAGE}\n\nLABEL maintainer=\"Peter Powers <pmpowers@usgs.gov>\"\n\nWORKDIR /app\n\nRUN yum update -y\nRUN yum install -y file epel-release\nRUN yum install -y jq\n\nARG jar_path\nARG builder_workdir\n\nCOPY --from=builder ${jar_path} .\nCOPY scripts scripts\nCOPY README.md .\n\nENV CONFIG_FILE \"\"\nENV DEBUG false\nENV IML \"\"\nENV JAVA_XMX \"8g\"\nENV LANG \"en_US.UTF-8\"\nENV MODEL \"\"\nENV MOUNT_MODEL false\nENV NSHM_VERSION main\nENV PROGRAM hazard\nENV PROJECT ${project}\nENV RETURN_PERIOD \"\"\n\nVOLUME [ \"/app/output\" ]\n\n# Run nshmp-haz\nENTRYPOINT [ \"bash\", \"scripts/docker-entrypoint.sh\" ]\n"}