{"startTime":"2023-01-09T10:05:59.212Z","endTime":1673258791074,"repository":"fzls/djc_helper","organization":"docker-parfum","dockerfilePath":"Dockerfile","dockerfile_sha":"e069f865f7c3f60942a55b8d20369ef1d6ba801c","dockerfile":"# syntax=docker/dockerfile:1\n\nFROM ubuntu:20.04\n\n# 设置时区\nENV TZ=Asia/Shanghai \\\n    DEBIAN_FRONTEND=noninteractive\n\nRUN set -x \\\n    && apt update \\\n    && apt install -y tzdata \\\n    && ln -fs /usr/share/zoneinfo/${TZ} /etc/localtime \\\n    && echo ${TZ} > /etc/timezone \\\n    && dpkg-reconfigure --frontend noninteractive tzdata \\\n    && rm -rf /var/lib/apt/lists/*\n\n# 安装python3.8\nRUN set -x \\\n    && apt-get update \\\n    && apt-get install -y python3 python3-pip \\\n    && rm -rf /var/lib/apt/lists/*\n\n# 设置工作目录\nWORKDIR /djc_helper\n\n## 下载chrome和driver\nCOPY _ubuntu_download_and_install_chrome_and_driver.sh _ubuntu_download_chrome_and_driver.sh _ubuntu_install_chrome_and_driver.sh ./\nRUN set -x \\\n    && apt-get update \\\n    && apt-get install -y sudo \\\n    && rm -rf /var/lib/apt/lists/*\nRUN bash _ubuntu_download_and_install_chrome_and_driver.sh\n\n# 安装依赖\nARG pip_index_url=https://pypi.org/simple\n#ARG pip_index_url=https://pypi.tuna.tsinghua.edu.cn/simple\nCOPY requirements_docker.txt requirements_z_base.txt ./\nRUN set -x \\\n    && PATH=\"$PATH:$HOME/.local/bin\" \\\n    && python3 -m pip install -i $pip_index_url --no-cache-dir --user --upgrade pip setuptools wheel \\\n    && pip3 install -i $pip_index_url --no-cache-dir -r requirements_docker.txt\n\n# 可通过以下两种方式传入配置\n# 1. 环境变量（正式环境推荐该方式）\n#   支持通过下列环境变量来传递配置信息。若同时设置，则按下面顺序取第一个非空的环境变量作为配置\n# 示例：docker run --env DJC_HELPER_CONFIG_TOML=\"$DJC_HELPER_CONFIG_TOML\" fzls/djc_helper:latest\n# toml配置\nENV DJC_HELPER_CONFIG_TOML=\"\"\n# toml配置编码为base64\nENV DJC_HELPER_CONFIG_BASE64=\"\"\n# toml配置先通过lzma压缩，然后编码为base64\nENV DJC_HELPER_CONFIG_LZMA_COMPRESSED_BASE64=\"\"\n# toml配置解析后再序列化为单行的JSON配置\nENV DJC_HELPER_CONFIG_SINGLE_LINE_JSON=\"\"\n\n# 2. 映射本地配置文件到容器中（调试时可以使用这个）\n# docker run --mount type=bind,source=local/absolute/path/to/config.toml,target=/djc_helper/config.toml fzls/djc_helper:latest\n\n# 复制源码（最常改动的内容放到最后，确保修改代码后仅这部分内容会变动，其他层不变）\nCOPY . .\n\n# 使用非root账户来调用小助手，确保在腾讯云环境下也能正常调用chrome，否则会报 selenium.common.exceptions.WebDriverException: Message: unknown error: DevToolsActivePort file doesn't exist\n# add our user and group first to make sure their IDs get assigned consistently, regardless of whatever dependencies get added\nRUN groupadd -r -g 999 fzls && useradd -r -g fzls -u 999 fzls\n\nRUN set -eux; \\\n\tapt-get update; \\\n\tapt-get install -y gosu; \\\n\trm -rf /var/lib/apt/lists/*; \\\n    # verify that the binary works\n\tgosu nobody true\n\nRUN chown fzls:fzls /djc_helper /usr/local/bin /usr/bin\nCMD [\"gosu\", \"fzls\", \"python3\", \"-u\", \"main.py\"]\n"}