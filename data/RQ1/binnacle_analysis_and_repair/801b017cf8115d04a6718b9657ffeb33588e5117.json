{
  "startTime": 1674239624700,
  "endTime": 1674239624926,
  "originalSmells": [
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 1,
        "columnEnd": 55
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM php:7.1-alpine\n\n# install the PHP extensions we need (https://make.wordpress.org/hosting/handbook/handbook/server-environment/#php-extensions)\nRUN set -ex; \\\n\n\tapk add --no-cache --virtual .build-deps \\\n\t\t$PHPIZE_DEPS \\\n\t\timagemagick-dev \\\n\t\tlibjpeg-turbo-dev \\\n\t\tlibpng-dev \\\n\t; \\\n\n\tdocker-php-ext-configure gd --with-png-dir=/usr --with-jpeg-dir=/usr; \\\n\tdocker-php-ext-install \\\n\t\tbcmath \\\n\t\texif \\\n\t\tgd \\\n\t\tmysqli \\\n\t\topcache \\\n\t\tzip \\\n\t; \\\n\tpecl install imagick-3.4.4; \\\n\tdocker-php-ext-enable imagick; \\\n\n\trunDeps=\"$( \\\n\t\tscanelf --needed --nobanner --format '%n#p' --recursive /usr/local/lib/php/extensions \\\n\t\t\t| tr ',' '\\n' \\\n\t\t\t| sort -u \\\n\t\t\t| awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' \\\n\t)\"; \\\n\tapk add --no-cache --virtual .wordpress-phpexts-rundeps $runDeps; \\\n\tapk del .build-deps\n\n# set recommended PHP.ini settings\n# see https://secure.php.net/manual/en/opcache.installation.php\nRUN { \\\n\t\techo 'opcache.memory_consumption=128'; \\\n\t\techo 'opcache.interned_strings_buffer=8'; \\\n\t\techo 'opcache.max_accelerated_files=4000'; \\\n\t\techo 'opcache.revalidate_freq=2'; \\\n\t\techo 'opcache.fast_shutdown=1'; \\\n\t\techo 'opcache.enable_cli=1'; \\\n\t} > /usr/local/etc/php/conf.d/opcache-recommended.ini\n# https://codex.wordpress.org/Editing_wp-config.php#Configure_Error_Logging\nRUN { \\\n\t\techo 'error_reporting = 4339'; \\\n\t\techo 'display_errors = Off'; \\\n\t\techo 'display_startup_errors = Off'; \\\n\t\techo 'log_errors = On'; \\\n\t\techo 'error_log = /dev/stderr'; \\\n\t\techo 'log_errors_max_len = 1024'; \\\n\t\techo 'ignore_repeated_errors = On'; \\\n\t\techo 'ignore_repeated_source = Off'; \\\n\t\techo 'html_errors = Off'; \\\n\t} > /usr/local/etc/php/conf.d/error-logging.ini\n\n# install wp-cli dependencies\nRUN apk add --no-cache \\\n# bash is needed for 'wp shell': https://github.com/wp-cli/shell-command/blob/b8dafcc2a2eba5732fdee70be077675a302848e9/src/WP_CLI/REPL.php#L104\n\t\tbash \\\n\t\tless \\\n\t\tmysql-client\n\nRUN set -ex; \\\n\tmkdir -p /var/www/html; \\\n\tchown -R www-data:www-data /var/www/html\nWORKDIR /var/www/html\nVOLUME /var/www/html\n\n# https://make.wordpress.org/cli/2018/05/31/gpg-signature-change/\n# pub   rsa2048 2018-05-31 [SC]\n#       63AF 7AA1 5067 C056 16FD  DD88 A3A2 E8F2 26F0 BC06\n# uid           [ unknown] WP-CLI Releases <releases@wp-cli.org>\n# sub   rsa2048 2018-05-31 [E]\nENV WORDPRESS_CLI_GPG_KEY 63AF7AA15067C05616FDDD88A3A2E8F226F0BC06\n\nENV WORDPRESS_CLI_VERSION 2.2.0\nENV WORDPRESS_CLI_SHA512 2103f04a5014d629eaa42755815c9cec6bb489ed7b0ea6e77dedb309e8af098ab902b2f9c6369ae4b7cb8cc1f20fbb4dedcda83eb1d0c34b880fa6e8a3ae249d\n\nRUN set -ex; \\\n\t\\\n\tapk add --no-cache --virtual .fetch-deps \\\n\t\tgnupg \\\n\t; \\\n\t\\\n\tcurl -o /usr/local/bin/wp.gpg -fSL \"https://github.com/wp-cli/wp-cli/releases/download/v${WORDPRESS_CLI_VERSION}/wp-cli-${WORDPRESS_CLI_VERSION}.phar.gpg\"; \\\n\t\\\n\texport GNUPGHOME=\"$(mktemp -d)\"; \\\n\tgpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys \"$WORDPRESS_CLI_GPG_KEY\"; \\\n\tgpg --batch --decrypt --output /usr/local/bin/wp /usr/local/bin/wp.gpg; \\\n\tcommand -v gpgconf && gpgconf --kill all || :; \\\n\trm -rf \"$GNUPGHOME\" /usr/local/bin/wp.gpg; \\\n\t\\\n\techo \"$WORDPRESS_CLI_SHA512 */usr/local/bin/wp\" | sha512sum -c -; \\\n\tchmod +x /usr/local/bin/wp; \\\n\t\\\n\tapk del .fetch-deps; \\\n\t\\\n\twp --allow-root --version\n\nCOPY docker-entrypoint.sh /usr/local/bin/\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\nUSER www-data\nCMD [\"wp\", \"shell\"]\n"
}