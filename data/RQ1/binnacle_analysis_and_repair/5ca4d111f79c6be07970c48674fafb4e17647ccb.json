{
  "startTime": 1674234047320,
  "endTime": 1674234047478,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 32,
        "columnEnd": 104
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 6,
        "lineEnd": 11,
        "columnStart": 22,
        "columnEnd": 8
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 6,
        "lineEnd": 11,
        "columnStart": 22,
        "columnEnd": 8
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# This dockerfile is used to build the release version of Storefront\n# For a development or testing container use Docker/develop/Dockerfile\nFROM tomcat:8.5.34-jre8\n\nLABEL maintainer=\"Ryan Frazier <ryan.frazier@sdl.usu.edu>\"\n\nRUN apt-get update && apt-get install --no-install-recommends -y \\\n    curl \\\n    procps \\\n    tar \\\n    unzip \\\n    wget && rm -rf /var/lib/apt/lists/*;\n\n###################\n## ElasticSearch ##\n###################\n\nENV ES_NAME elasticsearch\nARG ES_VERSION=6.0.1\nENV ES_FILE=$ES_NAME-$ES_VERSION\nENV ES_HOME /usr/local/share/$ES_FILE\nARG ES_TGZ_URL=https://artifacts.elastic.co/downloads/$ES_NAME/$ES_FILE.tar.gz\n\nRUN mkdir -p \"$ES_HOME\"\nWORKDIR $ES_HOME\nRUN wget $ES_TGZ_URL\nRUN tar -C $ES_HOME -zxvf $ES_FILE.tar.gz && \\\n    rm $ES_FILE.tar.gz* && \\\n    addgroup $ES_NAME && \\\n\tuseradd --home-dir $ES_HOME --shell /bin/sh -g $ES_NAME $ES_NAME && \\\n    chown -R $ES_NAME:$ES_NAME $ES_HOME\n\n################\n## StoreFront ##\n################\n\nWORKDIR $CATALINA_HOME/webapps\n\n# download the latest version of Storefront from github\nRUN export STOREFRONT_WAR_URL=$( curl -f -s https://api.github.com/repos/di2e/openstorefront/releases/latest | grep -oP '\"browser_download_url\": \"\\K(.*)(?=\")') && \\\n    curl -fSL $STOREFRONT_WAR_URL -O\n\n####################\n## Start Services ##\n####################\n\nARG STOREFRONT_HOME=/usr/local/share/openstorefront\nRUN mkdir -p \"$STOREFRONT_HOME\" && \\\n\tchmod 755 -R \"$STOREFRONT_HOME\"\nWORKDIR $STOREFRONT_HOME\n\n#COPY tomcat-users.xml $CATALINA_HOME/conf/\nRUN echo -e '<?xml version=\"1.0\" encoding=\"utf-8\"?>\\n' \\\n    \"<tomcat-users>\\n\" \\\n    \"  <role rolename=\\\"manager-gui\\\"/>\\n\" \\\n    \"  <role rolename=\\\"manager-gui\\\"/>\\n\" \\\n    \"  <role rolename=\\\"manager-script\\\"/>\\n\" \\\n    \"  <user username=\\\"admin\\\" password=\\\"Secret1@\\\" roles=\\\"manager,manager-gui,manager-script\\\" />\\n\" \\\n    \"</tomcat-users>\" \\\n    \"\" > $CATALINA_HOME/conf/tomcat-users.xml\n\n#COPY startup.sh ./\nRUN echo -e '#!/bin/sh\\n' \\\n    \"\\n\" \\\n    \"su - $ES_NAME -c \\\"ES_JAVA_OPTS=\\\\\\\"-Xms512m -Xmx512m\\\\\\\" $ES_HOME/$ES_FILE/bin/$ES_NAME -d\\\" \\n\"\\\n    \"$CATALINA_HOME/bin/catalina.sh start \\n\" \\\n    \"tail -f $CATALINA_HOME/logs/catalina.out \\n\" \\\n    \"\" > startup.sh\n\nRUN chmod +x startup.sh\n\nENTRYPOINT ./startup.sh\n"
}