{
  "startTime": 1674249717673,
  "endTime": 1674249718343,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 104,
        "lineEnd": 104,
        "columnStart": 8,
        "columnEnd": 87
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 117,
        "lineEnd": 117,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 5,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 5
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM php:7.0-fpm as builder\n\nRUN set -ex; \\\n\n    apt-get update; \\\n    apt-get install --no-install-recommends -y \\\n        autoconf \\\n        build-essential \\\n        libbsd-dev \\\n        libbz2-dev \\\n        libc-client2007e-dev \\\n        libc6-dev \\\n        libcurl3 \\\n        libcurl4-openssl-dev \\\n        libedit-dev \\\n        libedit2 \\\n        libgmp-dev \\\n        libgpgme11-dev \\\n        libicu-dev \\\n        libjpeg-dev \\\n        libkrb5-dev \\\n        libldap2-dev \\\n        libmagick++-dev \\\n        libmagickwand-dev \\\n        libmcrypt-dev \\\n        libmemcached-dev \\\n        libpcre3-dev \\\n        libpng-dev \\\n        libsqlite3-0 \\\n        libsqlite3-dev \\\n        libssh2-1-dev \\\n        libssl-dev \\\n        libtinfo-dev \\\n        libtool \\\n        libwebp-dev \\\n        libvpx-dev \\\n        libxml2 \\\n        libxml2-dev \\\n        libxpm-dev \\\n        libxslt1-dev \\\n    ; \\\n    apt-get clean; \\\n    rm -rf /var/lib/apt/lists/*; \\\n    ln -s /usr/include/x86_64-linux-gnu/gmp.h /usr/include; \\\n    docker-php-ext-configure gd \\\n        --with-png-dir=/usr \\\n        --with-jpeg-dir=/usr \\\n        --with-freetype-dir=/usr \\\n        --with-webp-dir=/usr \\\n        --with-xpm-dir=/usr \\\n        --with-vpx-dir=/usr; \\\n    docker-php-ext-configure imap --with-kerberos --with-imap-ssl; \\\n    docker-php-ext-configure ldap --with-libdir=lib/x86_64-linux-gnu; \\\n    docker-php-ext-install \\\n        bcmath \\\n        bz2 \\\n        calendar \\\n        dba \\\n        exif \\\n        gd \\\n        gettext \\\n        gmp \\\n        imap \\\n        intl \\\n        ldap \\\n        mcrypt \\\n        mysqli \\\n        opcache \\\n        pdo_mysql \\\n        shmop \\\n        soap \\\n        sockets \\\n        sysvmsg \\\n        sysvsem \\\n        sysvshm \\\n        wddx \\\n        xmlrpc \\\n        xsl \\\n        zip \\\n    ; \\\n    pecl install \\\n        gnupg-1.4.0 \\\n        igbinary-2.0.1 \\\n        imagick-3.4.3 \\\n        memcached-3.0.3 \\\n        msgpack-2.0.2 \\\n        redis-3.1.3 \\\n        uopz-5.0.2 \\\n    ; \\\n    echo \"\\n\" | pecl install ssh2-1.1.2; \\\n    docker-php-ext-enable --ini-name pecl.ini \\\n        gnupg \\\n        igbinary \\\n        imagick \\\n        memcached \\\n        msgpack \\\n        redis \\\n        ssh2 \\\n        uopz \\\n    ;\n\nRUN set -ex; \\\n\n    NR_VERSION=\"$( curl -f --connect-timeout 10 -skS https://download.newrelic.com/php_agent/release/ \\\n            | sed -n 's/.*>\\(.*linux\\).tar.gz<.*/\\1/p')\" \\\n    ; \\\n    curl --connect-timeout 10 -o nr.tar.gz -fkSL \"https://download.newrelic.com/php_agent/release/$NR_VERSION.tar.gz\"; \\\n    tar -xf nr.tar.gz; \\\n    cp $NR_VERSION/agent/x64/newrelic-20151012.so /usr/local/lib/php/extensions/no-debug-non-zts-20151012/newrelic.so; \\\n    mkdir -p /var/log/newrelic; \\\n    rm -rf newrelic-php5* nr.tar.gz; \\\n    echo \"extension=newrelic.so\" > /usr/local/etc/php/conf.d/newrelic.ini;\n\nRUN set -ex; \\\n\n    curl --connect-timeout 10 -o ioncube.tar.gz -fkSL \"https://downloads.ioncube.com/loader_downloads/ioncube_loaders_lin_x86-64.tar.gz\"; \\\n    tar -zxvf ioncube.tar.gz; rm ioncube.tar.gz \\\n    cp ioncube/ioncube_loader_lin_7.0.so /usr/local/lib/php/extensions/no-debug-non-zts-20151012/ioncube.so; \\\n    rm -Rf ioncube*; \\\n    echo \"zend_extension=ioncube.so\" > /usr/local/etc/php/conf.d/01-ioncube.ini;\n\n# Now that all the modules are built/downloaded, use the original php:7.0-fpm image and\n# install only the runtime dependencies with the new modules and config files.\nFROM php:7.0-fpm\n\nWORKDIR /\n\nRUN set -ex ; \\\n    \\\n    apt-get update && apt-get install -y --no-install-recommends \\\n        libc-client2007e \\\n        libgpgme11 \\\n        libicu57 \\\n        libmagickwand-6.q16-3 \\\n        libmcrypt4 \\\n        libmemcached11 \\\n        libmemcachedutil2 \\\n        libpng16-16 \\\n        libvpx4 \\\n        libwebp6 \\\n        libxpm4 \\\n        libxslt1.1 \\\n        ssmtp \\\n        ; \\\n    rm -rf /tmp/pear /usr/share/doc /usr/share/man /var/lib/apt/lists/*; \\\n    cd /usr/local/etc/php; \\\n    php-fpm -v 2>/dev/null | sed -E 's/PHP ([5|7].[0-9]{1,2}.[0-9]{1,2})(.*)/\\1/g' | head -n1 > php_version.txt;\n\nCOPY --from=builder /usr/local/lib/php/extensions/no-debug-non-zts-20151012/ /usr/local/lib/php/extensions/no-debug-non-zts-20151012/\nCOPY --from=builder /usr/local/etc/php/conf.d/ /usr/local/etc/php/conf.d/\n\nRUN pear install --alldeps \\\n        Auth_SASL \\\n        Auth_SASL2-beta \\\n        Benchmark \\\n        pear.php.net/Console_Color2-0.1.2 \\\n        Console_Table \\\n        HTTP_OAuth-0.3.1 \\\n        HTTP_Request2 \\\n        Log \\\n        Mail \\\n        MDB2 \\\n        Net_GeoIP \\\n        Net_SMTP \\\n        Net_Socket \\\n        XML_RPC2 \\\n        pear.symfony.com/YAML \\\n    ;\n\nRUN set -ex \\\n    && { \\\n        echo '[global]'; \\\n        echo 'daemonize = no'; \\\n        echo 'error_log = /proc/self/fd/2'; \\\n        echo; \\\n        echo '[www]'; \\\n        echo 'listen = [::]:9000'; \\\n        echo 'listen.owner = www-data'; \\\n        echo 'listen.group = www-data'; \\\n        echo; \\\n        echo 'user = www-data'; \\\n        echo 'group = www-data'; \\\n        echo; \\\n        echo 'access.log = /proc/self/fd/2'; \\\n        echo; \\\n        echo 'pm = static'; \\\n        echo 'pm.max_children = 1'; \\\n        echo 'pm.start_servers = 1'; \\\n        echo 'request_terminate_timeout = 65s'; \\\n        echo 'pm.max_requests = 1000'; \\\n        echo 'catch_workers_output = yes'; \\\n    } | tee /usr/local/etc/php-fpm.d/www.conf \\\n    && mkdir -p /usr/local/php/php/auto_prepends \\\n    && { \\\n        echo '<?php'; \\\n        echo 'if (function_exists(\"uopz_allow_exit\")) {;' \\\n        echo '    uopz_allow_exit(true);'; \\\n        echo '}'; \\\n        echo '?>'; \\\n    } | tee /usr/local/php/php/auto_prepends/default_prepend.php \\\n    && { \\\n        echo 'FromLineOverride=YES'; \\\n        echo 'mailhub=127.0.0.1'; \\\n        echo 'UseTLS=NO'; \\\n        echo 'UseSTARTTLS=NO'; \\\n    } | tee /etc/ssmtp/ssmtp.conf \\\n    && { \\\n        echo '[PHP]'; \\\n        echo 'log_errors = On'; \\\n        echo 'error_log = /dev/stderr'; \\\n        echo 'auto_prepend_file = /usr/local/php/php/auto_prepends/default_prepend.php'; \\\n    } | tee /usr/local/etc/php/conf.d/php.ini \\\n    ;\n\nEXPOSE 9000\nCMD [\"php-fpm\"]\n"
}