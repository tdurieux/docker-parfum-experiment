{
  "startTime": 1674234278053,
  "endTime": 1674234278284,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 72,
        "lineEnd": 72,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 73,
        "lineEnd": 73,
        "columnStart": 4,
        "columnEnd": 34
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# Dockerfile to build Docker data processing image for DIRBS\n#\n# SPDX-License-Identifier: BSD-4-Clause-Clear\n#\n# Copyright (c) 2018-2019 Qualcomm Technologies, Inc.\n#\n# All rights reserved.\n#\n# Redistribution and use in source and binary forms, with or without modification, are permitted (subject to the\n# limitations in the disclaimer below) provided that the following conditions are met:\n#\n#    - Redistributions of source code must retain the above copyright notice, this list of conditions and the following\n#      disclaimer.\n#    - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the\n#      following disclaimer in the documentation and/or other materials provided with the distribution.\n#    - All advertising materials mentioning features or use of this software, or any deployment of this software,\n#      or documentation accompanying any distribution of this software, must display the trademark/logo as per the\n#      details provided here: https://www.qualcomm.com/documents/dirbs-logo-and-brand-guidelines\n#    - Neither the name of Qualcomm Technologies, Inc. nor the names of its contributors may be used to endorse or\n#      promote products derived from this software without specific prior written permission.\n#\n#\n#\n# SPDX-License-Identifier: ZLIB-ACKNOWLEDGEMENT\n#\n# Copyright (c) 2018-2019 Qualcomm Technologies, Inc.\n#\n# This software is provided 'as-is', without any express or implied warranty. In no event will the authors be held liable\n# for any damages arising from the use of this software. Permission is granted to anyone to use this software for any\n# purpose, including commercial applications, and to alter it and redistribute it freely, subject to the following\n# restrictions:\n#\n#    - The origin of this software must not be misrepresented; you must not claim that you wrote the original software.\n#      If you use this software in a product, an acknowledgment is required by displaying the trademark/logo as per the\n#      details provided here: https://www.qualcomm.com/documents/dirbs-logo-and-brand-guidelines\n#    - Altered source versions must be plainly marked as such, and must not be misrepresented as being the original\n#      software.\n#    - This notice may not be removed or altered from any source distribution.\n#\n# NO EXPRESS OR IMPLIED LICENSES TO ANY PARTY'S PATENT RIGHTS ARE GRANTED BY THIS LICENSE. THIS SOFTWARE IS PROVIDED BY\n# THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,\n# THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE\n# COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL\n# DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\n# BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE\n# POSSIBILITY OF SUCH DAMAGE.\n#\n\nFROM dirbs-base\n\nENV HLL_VERSION=2.10.2\n\n# Make sure /data directory exists and is owned by correct user\nRUN mkdir -p /data && chown -R dirbs.dirbs /data\n\n# Install SSH server, PostgreSQL 10 (needed by unit tests) and mark volume as writeable by DIRBS group\nRUN set -x && \\\n    echo 'deb http://apt.postgresql.org/pub/repos/apt/ xenial-pgdg main' > /etc/apt/sources.list.d/pgdg.list && \\\n    wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - && \\\n    apt-get -q update --fix-missing && \\\n    apt-get -q install -y --no-install-recommends postgresql-10 postgresql-contrib-10 postgresql-server-dev-10 \\\n                                                  openssh-server wget unzip build-essential && \\\n    apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\n# Copy wheel and opensource requirements into build\nCOPY opensource_requirements.txt test_requirements.txt *.whl /home/dirbs/\n\n# Install dependencies, wheel\nRUN set -x && \\\n    pip3 install --no-cache-dir -r /home/dirbs/opensource_requirements.txt && \\\n    pip3 install --no-cache-dir -r /home/dirbs/test_requirements.txt && \\\n    pip3 install --no-cache-dir /home/dirbs/*.whl && \\\n    chown -R dirbs.dirbs /home/dirbs/dirbs-venv\n\n# Copy other files into build\nCOPY etc/ /opt/dirbs/etc\nCOPY tests/ /home/dirbs/tests\n\n# Install config and change permissions\nRUN set -x && \\\n    cp /opt/dirbs/etc/config.yml /home/dirbs/.dirbs.yml && \\\n    chown dirbs.dirbs /home/dirbs/.dirbs.yml && \\\n    chown -R dirbs.dirbs /home/dirbs/tests\n\n# Copy authorized keys\nCOPY docker/prd/processing/authorized_keys /home/dirbs/.ssh/\n\n# Configure Open SSH\nRUN set -x && \\\n    mkdir -p /var/run/sshd && \\\n    chmod 700 /var/run/sshd && \\\n    chown -R dirbs.dirbs /home/dirbs/.ssh && \\\n    chmod -R 700 /home/dirbs/.ssh && \\\n    chmod 600 /home/dirbs/.ssh/authorized_keys && \\\n    sed -i 's/^#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config && \\\n    sed 's@session\\s*required\\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd\n\n# Install hll\nRUN set -x && \\\n    wget -q -O hll.zip https://github.com/citusdata/postgresql-hll/archive/v$HLL_VERSION.zip && \\\n    unzip hll.zip && \\\n    cd postgresql-hll-$HLL_VERSION && \\\n    make install\n\n# Export port for SSH server\nEXPOSE 22\n\n# Mark volumes - want persistent host keys, so make /etc/ssh persistent\nVOLUME [\"/data\", \"/etc/ssh\"]\n\n# Copy entrypoint\nCOPY docker/prd/processing/entrypoint.sh /\n\n# Make sure both scripts have permissions set correctly\nRUN set -x && chmod a+x /entrypoint.sh\n\n# Jenkins build arg\nARG BUILD_TAG\nENV BUILD_TAG ${BUILD_TAG:-No build tag supplied}\nRUN echo $BUILD_TAG > /etc/dirbs_build_tag\n\n# Remove default Ubuntu MOTD content\nRUN rm /etc/update-motd.d/*\n\n# Add environment and build info to MOTD\nCOPY docker/base/dirbs-motd.sh /etc/update-motd.d/00-dirbs-text\n\n# Set entry point\nENTRYPOINT [\"/entrypoint.sh\"]\n\n# Set command\nCMD [\"/usr/sbin/sshd\", \"-D\", \"-e\"]\n"
}