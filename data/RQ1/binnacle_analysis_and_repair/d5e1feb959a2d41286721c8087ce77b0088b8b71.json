{
  "startTime": 1674241222036,
  "endTime": 1674241222682,
  "originalSmells": [
    {
      "rule": "curlUseHttpsUrl",
      "position": {
        "lineStart": 38,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 42,
        "lineEnd": 42,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 158,
        "lineEnd": 158,
        "columnStart": 4,
        "columnEnd": 40
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# AUTOMATICALLY GENERATED\n# DO NOT EDIT THIS FILE DIRECTLY, USE /Dockerfile.tmpl.php\n\n# https://hub.docker.com/_/alpine\nFROM alpine:3.5\n\nMAINTAINER Instrumentisto Team <developer@instrumentisto.com>\n\n\n# Build and install Postfix\n# https://git.alpinelinux.org/cgit/aports/tree/main/postfix/APKBUILD?h=2b1512eefca296b0ef1b60d2e521349385a3c353\nRUN apk update \\\n && apk upgrade \\\n && apk add --no-cache \\\n        ca-certificates \\\n && update-ca-certificates \\\n    \\\n # Install Postfix dependencies\n && apk add --no-cache \\\n        pcre icu-libs \\\n        db libpq mariadb-client-libs sqlite-libs \\\n        libsasl \\\n        libldap \\\n    \\\n # Install tools for building\n && apk add --no-cache --virtual .tool-deps \\\n        curl coreutils autoconf g++ libtool make libressl \\\n    \\\n # Install Postfix build dependencies\n && apk add --no-cache --virtual .build-deps \\\n        libressl-dev \\\n        linux-headers \\\n        pcre-dev icu-dev \\\n        db-dev postgresql-dev mariadb-dev sqlite-dev \\\n        cyrus-sasl-dev \\\n        openldap-dev \\\n    \\\n # Download and prepare Postfix sources \\\n && curl -fL -o /tmp/postfix.tar.gz \\\n         https://cdn.postfix.johnriley.me/mirrors/postfix-release/official/postfix-3.1.3.tar.gz \\\n && (echo \"00e2b0974e59420cabfddc92597a99b42c8a8c9cd9a0c279c63ba6be9f40b15400f37dc16d0b1312130e72b5ba82b56fc7d579ee9ef975a957c0931b0401213c  /tmp/postfix.tar.gz\" \\\n         | sha512sum -c -) \\\n && tar -xzf /tmp/postfix.tar.gz -C /tmp/ \\\n && cd /tmp/postfix-* \\\n && curl -fL -o ./no-glibc.patch \\\n         https://git.alpinelinux.org/cgit/aports/plain/main/postfix/no-glibc.patch?h=2b1512eefca296b0ef1b60d2e521349385a3c353 \\\n && patch -p1 -i ./no-glibc.patch \\\n && curl -fL -o ./postfix-install.patch \\\n         https://git.alpinelinux.org/cgit/aports/plain/main/postfix/postfix-install.patch?h=2b1512eefca296b0ef1b60d2e521349385a3c353 \\\n && patch -p1 -i ./postfix-install.patch \\\n && curl -fL -o ./libressl.patch \\\n         https://git.alpinelinux.org/cgit/aports/plain/main/postfix/libressl.patch?h=2b1512eefca296b0ef1b60d2e521349385a3c353 \\\n && patch -p1 -i ./libressl.patch \\\n && sed -i -e \"s|#define HAS_NIS|//#define HAS_NIS|g\" \\\n           -e \"/^#define ALIAS_DB_MAP/s|:/etc/aliases|:/etc/postfix/aliases|\" \\\n        src/util/sys_defs.h \\\n && sed -i -e \"s:/usr/local/:/usr/:g\" conf/master.cf \\\n\n # Build Postfix from sources\n && make makefiles \\\n         CCARGS=\"-DHAS_SHL_LOAD -DUSE_TLS \\\n                 -DHAS_PCRE $(pkg-config --cflags libpcre) \\\n                 -DHAS_PGSQL $(pkg-config --cflags libpq) \\\n                 -DHAS_MYSQL $(mysql_config --include) \\\n                 -DHAS_SQLITE $(pkg-config --cflags sqlite3) \\\n                 -DHAS_LDAP \\\n                 -DUSE_CYRUS_SASL -I/usr/include/sasl \\\n                 -DUSE_SASL_AUTH -DDEF_SASL_SERVER=\\\\\\\"dovecot\\\\\\\" \\\n                 -DUSE_LDAP_SASL\" \\\n         AUXLIBS=\"-lssl -lcrypto -lsasl2\" \\\n         AUXLIBS_PCRE=\"$(pkg-config --libs libpcre)\" \\\n         AUXLIBS_PGSQL=\"$(pkg-config --libs libpq)\" \\\n         AUXLIBS_MYSQL=\"$(mysql_config --libs)\" \\\n         AUXLIBS_SQLITE=\"$(pkg-config --libs sqlite3)\" \\\n         AUXLIBS_LDAP=\"-lldap -llber\" \\\n         shared=yes \\\n         dynamicmaps=yes \\\n         pie=yes \\\n         daemon_directory=/usr/lib/postfix \\\n         shlibs_directory=/usr/lib/postfix \\\n         # No documentation included to keep image size smaller\n         manpage_directory=/tmp/man \\\n         readme_directory=/tmp/readme \\\n         html_directory=/tmp/html \\\n && make \\\n\n # Create Postfix user and groups\n && addgroup -S -g 91 postfix \\\n && adduser -S -u 90 -D \\\n            -H -h /var/spool/postfix \\\n            -G postfix -g postfix \\\n            postfix \\\n && addgroup postfix mail \\\n && addgroup -S -g 93 postdrop \\\n && adduser -S -u 92 -D -s /sbin/nologin \\\n            -H -h /var/mail/domains \\\n            -G postdrop -g vmail \\\n            vmail \\\n\n # Install Postfix\n && make upgrade \\\n # Always execute these binaries under postdrop group\n && chmod g+s /usr/sbin/postdrop \\\n              /usr/sbin/postqueue \\\n # Ensure spool dir has correct rights\n && install -d -o postfix -g postfix /var/spool/postfix \\\n # Fix removed directories in default configuration\n && sed -i -e 's,^manpage_directory =.*,manpage_directory = /dev/null,' \\\n           -e 's,^readme_directory =.*,readme_directory = /dev/null,' \\\n           -e 's,^html_directory =.*,html_directory = /dev/null,' \\\n        /etc/postfix/main.cf \\\n # Prepare directories for drop-in configuration files\n && install -d /etc/postfix/main.cf.d \\\n && install -d /etc/postfix/master.cf.d \\\n # Generate default TLS credentials\n && install -d /etc/ssl/postfix \\\n && openssl req -new -x509 -nodes -days 365 \\\n                -subj \"/CN=smtp.example.com\" \\\n                -out /etc/ssl/postfix/server.crt \\\n                -keyout /etc/ssl/postfix/server.key \\\n && chmod 0600 /etc/ssl/postfix/server.key \\\n # Pregenerate Diffie-Hellman parameters (heavy operation)\n && openssl dhparam -out /etc/postfix/dh2048.pem 2048 \\\n # Tweak TLS/SSL settings to achieve A grade\n && echo -e \"\\n\\\n        \\n# TLS PARAMETERS\\\n        \\n#\\\n        \\ntls_ssl_options = NO_COMPRESSION\\\n        \\ntls_high_cipherlist = ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256\\\n        \\n\\\n        \\n# SMTP TLS PARAMETERS (outgoing connections)\\\n        \\n#\\\n        \\nsmtp_tls_security_level = may\\\n        \\nsmtp_tls_CApath = /etc/ssl/certs\\\n        \\n\\\n        \\n# SMTPD TLS PARAMETERS (incoming connections)\\\n        \\n#\\\n        \\nsmtpd_tls_security_level = may\\\n        \\nsmtpd_tls_ciphers = high\\\n        \\nsmtpd_tls_mandatory_ciphers = high\\\n        \\nsmtpd_tls_exclude_ciphers = aNULL, LOW, EXP, MEDIUM, ADH, AECDH, MD5, DSS, ECDSA, CAMELLIA128, 3DES, CAMELLIA256, RSA+AES, eNULL\\\n        \\nsmtpd_tls_dh1024_param_file = /etc/postfix/dh2048.pem\\\n        \\nsmtpd_tls_CApath = /etc/ssl/certs\\\n        \\nsmtpd_tls_cert_file = /etc/ssl/postfix/server.crt\\\n        \\nsmtpd_tls_key_file = /etc/ssl/postfix/server.key\\\n    \" >> /etc/postfix/main.cf \\\n\n # Cleanup unnecessary stuff\n && apk del .tool-deps .build-deps \\\n && rm -rf /var/cache/apk/* \\\n           /tmp/* && rm /tmp/postfix.tar.gz\n\n\n# Install s6-overlay\nRUN apk add --update --no-cache --virtual .tool-deps \\\n        curl \\\n && curl -fL -o /tmp/s6-overlay.tar.gz \\\n         https://github.com/just-containers/s6-overlay/releases/download/v1.21.2.2/s6-overlay-amd64.tar.gz \\\n && tar -xzf /tmp/s6-overlay.tar.gz -C / \\\n    \\\n # Cleanup unnecessary stuff\n && apk del .tool-deps \\\n && rm -rf /var/cache/apk/* \\\n           /tmp/* && rm /tmp/s6-overlay.tar.gz\n\nENV S6_BEHAVIOUR_IF_STAGE2_FAILS=2 \\\n    S6_CMD_WAIT_FOR_SERVICES=1\n\n\nCOPY rootfs /\n\nRUN chmod +x /etc/services.d/*/run \\\n             /etc/cont-init.d/*\n\n\nEXPOSE 25 465 587\n\nENTRYPOINT [\"/init\"]\n\nCMD [\"/usr/lib/postfix/master\", \"-d\"]\n"
}