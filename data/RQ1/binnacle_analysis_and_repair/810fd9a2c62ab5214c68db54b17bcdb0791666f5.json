{
  "startTime": 1674244995294,
  "endTime": 1674244995856,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 4,
        "columnEnd": 24
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 42,
        "lineEnd": 42,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 7,
        "lineEnd": 7,
        "columnStart": 4,
        "columnEnd": 408
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 199
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 162
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 67,
        "lineEnd": 67,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 86
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 7,
        "lineEnd": 7,
        "columnStart": 4,
        "columnEnd": 408
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 199
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 162
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 67,
        "lineEnd": 67,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 86
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 7,
        "lineEnd": 7,
        "columnStart": 4,
        "columnEnd": 408
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 199
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 162
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 67,
        "lineEnd": 67,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 86
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 27
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 7,
        "lineEnd": 7,
        "columnStart": 4,
        "columnEnd": 432
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 223
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 186
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 67,
        "lineEnd": 67,
        "columnStart": 4,
        "columnEnd": 111
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 110
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 51
      }
    }
  ],
  "repairedDockerfile": "FROM ubuntu:18.04\n\n# Based on\n# https://switch2osm.org/manually-building-a-tile-server-18-04-lts/\n\n# Install dependencies\nRUN apt-get update\nRUN apt-get install --no-install-recommends -y libboost-all-dev git-core tar unzip wget bzip2 build-essential autoconf libtool libxml2-dev libgeos-dev libgeos++-dev libpq-dev libbz2-dev libproj-dev munin-node munin libprotobuf-c0-dev protobuf-c-compiler libfreetype6-dev libtiff5-dev libicu-dev libgdal-dev libcairo-dev libcairomm-1.0-dev apache2 apache2-dev libagg-dev liblua5.2-dev ttf-unifont lua5.1 liblua5.1-dev libgeotiff-epsg && rm -rf /var/lib/apt/lists/*;\n\n# Set up environment and renderer user\nENV TZ=UTC\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone\nRUN adduser --disabled-password --gecos \"\" renderer\nUSER renderer\n\n# Install latest osm2pgsql\nRUN mkdir /home/renderer/src\nWORKDIR /home/renderer/src\nRUN git clone https://github.com/openstreetmap/osm2pgsql.git\nWORKDIR /home/renderer/src/osm2pgsql\nUSER root\nRUN apt-get install --no-install-recommends -y make cmake g++ libboost-dev libboost-system-dev libboost-filesystem-dev libexpat1-dev zlib1g-dev libbz2-dev libpq-dev libgeos-dev libgeos++-dev libproj-dev lua5.2 liblua5.2-dev && rm -rf /var/lib/apt/lists/*;\nUSER renderer\nRUN mkdir build\nWORKDIR /home/renderer/src/osm2pgsql/build\nRUN cmake ..\nRUN make\nUSER root\nRUN make install\nUSER renderer\n\n# Install and test Mapnik\nUSER root\nRUN apt-get -y --no-install-recommends install autoconf apache2-dev libtool libxml2-dev libbz2-dev libgeos-dev libgeos++-dev libproj-dev gdal-bin libmapnik-dev mapnik-utils python-mapnik && rm -rf /var/lib/apt/lists/*;\nUSER renderer\nRUN python -c 'import mapnik'\n\n# Install mod_tile and renderd\nWORKDIR /home/renderer/src\nRUN git clone -b switch2osm https://github.com/SomeoneElseOSM/mod_tile.git\nWORKDIR /home/renderer/src/mod_tile\nRUN ./autogen.sh\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\"\nRUN make\nUSER root\nRUN make install\nRUN make install-mod_tile\nRUN ldconfig\nUSER renderer\n\n# Configure stylesheet\nWORKDIR /home/renderer/src\nRUN git clone https://github.com/gravitystorm/openstreetmap-carto.git\nWORKDIR /home/renderer/src/openstreetmap-carto\nUSER root\nRUN apt-get install --no-install-recommends -y npm nodejs && rm -rf /var/lib/apt/lists/*;\nRUN npm install -g carto && npm cache clean --force;\nUSER renderer\nRUN carto -v\nRUN carto project.mml > mapnik.xml\n\n# Load shapefiles\nWORKDIR /home/renderer/src/openstreetmap-carto\nRUN scripts/get-shapefiles.py\n\n# Install fonts\nUSER root\nRUN apt-get install --no-install-recommends -y fonts-noto-cjk fonts-noto-hinted fonts-noto-unhinted ttf-unifont && rm -rf /var/lib/apt/lists/*;\nUSER renderer\n\n# Configure renderd\nUSER root\nRUN sed -i 's/renderaccount/renderer/g' /usr/local/etc/renderd.conf\nRUN sed -i 's/hot/tile/g' /usr/local/etc/renderd.conf\nUSER renderer\n\n# Configure Apache\nUSER root\nRUN mkdir /var/lib/mod_tile\nRUN chown renderer /var/lib/mod_tile\nRUN mkdir /var/run/renderd\nRUN chown renderer /var/run/renderd\nRUN echo \"LoadModule tile_module /usr/lib/apache2/modules/mod_tile.so\" >> /etc/apache2/conf-available/mod_tile.conf\nRUN a2enconf mod_tile\nCOPY apache.conf /etc/apache2/sites-available/000-default.conf\nUSER renderer\n\n# Install PostgreSQL\nUSER root\nRUN apt-get install --no-install-recommends -y postgresql postgresql-contrib postgis postgresql-10-postgis-2.4 && rm -rf /var/lib/apt/lists/*;\nUSER renderer\n\n# Start running\nUSER root\nRUN apt-get install --no-install-recommends -y sudo && rm -rf /var/lib/apt/lists/*;\nCOPY run.sh /\nENTRYPOINT [\"/run.sh\"]\nCMD []"
}