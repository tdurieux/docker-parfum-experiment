{
  "startTime": 1674235326022,
  "endTime": 1674235326469,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 51,
        "lineEnd": 58,
        "columnStart": 22,
        "columnEnd": 11
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 8,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 18
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 51,
        "lineEnd": 58,
        "columnStart": 22,
        "columnEnd": 11
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Multistage docker build, requires docker 17.05\n\n# builder stage\nFROM rust:latest as builder\n\nRUN rustup update && \\\n    set -ex && \\\n    apt-get update && \\\n    apt-get --no-install-recommends --yes install \\\n        clang \\\n        libclang-dev \\\n        llvm-dev \\\n        libncurses5 \\\n        libncursesw5 \\\n        cmake \\\n        git \\\n        libssl-dev && rm -rf /var/lib/apt/lists/*;\n\nWORKDIR /usr/src/grin\n\n# Copying Grin\nRUN git clone https://github.com/mimblewimble/grin.git .; git checkout master; git pull;\n\n# Building Grin\nRUN cargo build --release\n\n# Update and build grin\nRUN touch sxxyyzzzzqyxxxzfggx\nRUN git fetch && \\\n    git pull && \\\n    git checkout v1.0.0\n\n# Monkey Patch\nRUN sed -i -e 's/127\\.0\\.0\\.1:13420/0.0.0.0:13420/g' wallet/src/command.rs\nCOPY stratumserver.rs servers/src/mining/stratumserver.rs\n\nRUN cargo build --release\n\n# Generate configuration\nRUN mkdir -p /root/.grin && \\\n    cd /root/.grin && \\\n        ln -s . main\nRUN target/release/grin ${NET_FLAG} server config && \\\n    echo dummy > dummy && \\\n    echo dummy >> dummy && \\\n    target/release/grin ${NET_FLAG} wallet init  < dummy\n\n\n# runtime stage\nFROM docker.mwgrinpool.com:5001/keybase:latest\n\nRUN apt-get update && DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends install -y \\\n    locales \\\n    procps \\\n    libssl-dev \\\n    vim \\\n    telnet \\\n    curl \\\n    python3 \\\n      && \\\n    apt-get autoremove -y && \\\n    rm -rf /var/cache/apt && rm -rf /var/lib/apt/lists/*;\n\nRUN sed -i -e 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen && \\\n    dpkg-reconfigure --frontend=noninteractive locales && \\\n    update-locale LANG=en_US.UTF-8\n\nENV LANG en_US.UTF-8\n\nCOPY --from=builder /usr/src/grin/target/release/grin /usr/local/bin/grin\nCOPY --from=builder /usr/src/grin/grin-server.toml /usr/src/grin/grin-server.toml\nCOPY --from=builder /root/.grin/grin-wallet.toml /usr/src/grin/grin-wallet.toml\n\n# Update grin-server config\nRUN sed -i 's/^db_root = .*$/db_root = \"\\/server\\/.grin\"/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^api_http_addr = .*$/api_http_addr = \"0.0.0.0:13413\"/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^api_secret_path = .*$/api_secret_path = \"\\/root\\/.grin\\/.api_secret\"/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^archive_mode = .*$/archive_mode = true/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^skip_sync_wait = .*$/skip_sync_wait = false/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^run_tui = .*$/run_tui = false/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^run_test_miner = .*$/run_test_miner = false/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^host = .*$/host = \"0.0.0.0\"/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^port = .*$/port = 3414/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^#peer_max_count = .*$/peer_max_count = 250/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^#peer_min_preferred_count = .*$/peer_min_preferred_count = 16/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^enable_stratum_server = .*$/enable_stratum_server = true/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^stratum_server_addr = .*$/stratum_server_addr = \"0.0.0.0:13416\"/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^attempt_time_per_block = .*$/attempt_time_per_block = 300/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^minimum_share_difficulty = .*$/minimum_share_difficulty = 1/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^wallet_listener_url = .*$/wallet_listener_url = \"http:\\/\\/grinwallet:13415\"/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^burn_reward = .*$/burn_reward = false/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^log_to_stdout = .*$/log_to_stdout = true/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^stdout_log_level = .*$/stdout_log_level = \"Debug\"/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^log_to_file = .*$/log_to_file = true/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^file_log_level = .*$/file_log_level = \"Debug\"/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^log_file_path = .*$/log_file_path = \"\\/server\\/grin.log\"/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^log_file_append = .*$/log_file_append = true/' /usr/src/grin/grin-server.toml && \\\n    sed -i 's/^log_max_size = .*$/log_max_size = 16777216/' /usr/src/grin/grin-server.toml\n\n# Update grin-wallet config\nRUN sed -i 's/^api_listen_interface = .*$/api_listen_interface = \"0.0.0.0\"/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^api_listen_port = .*$/api_listen_port = 13415/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^api_secret_path = .*$/api_secret_path = \"\\/root\\/.grin\\/.api_secret\"/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^node_api_secret_path = .*$/node_api_secret_path = \"\\/root\\/.grin\\/.api_secret\"/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^check_node_api_http_addr = .*$/check_node_api_http_addr = \"http:\\/\\/grin:13413\"/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^data_file_dir = .*$/data_file_dir = \"\\/wallet\\/wallet_data\"/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^keybase_notify_ttl = .*$/keybase_notify_ttl = 1440/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^log_to_stdout = .*$/log_to_stdout = true/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^stdout_log_level = .*$/stdout_log_level = \"Debug\"/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^log_to_file = .*$/log_to_file = true/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^file_log_level = .*$/file_log_level = \"Debug\"/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^log_file_path = .*$/log_file_path = \"\\/wallet\\/grin-wallet.log\"/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^log_file_append = .*$/log_file_append = true/' /usr/src/grin/grin-wallet.toml && \\\n    sed -i 's/^log_max_size = .*$/log_max_size = 16777216/' /usr/src/grin/grin-wallet.toml\n\n\n# floonet ports\nEXPOSE 13413\nEXPOSE 13414\nEXPOSE 13415\nEXPOSE 13416\n\n# mainnet ports\nEXPOSE 3413\nEXPOSE 3414\nEXPOSE 3415\nEXPOSE 3416\n\nCOPY run.sh /\nCOPY run-wallet.sh /\nCOPY libheath.py /\nCMD [\"/run.sh\"]\n"
}