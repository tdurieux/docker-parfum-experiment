{
  "startTime": 1674241743702,
  "endTime": 1674241743993,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 5,
        "columnEnd": 383
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ubuntu:16.04\nMAINTAINER Florian Kelbert <f.kelbert@imperial.ac.uk>\n\nENV\tAPACHE_VERSION 2.4.23\nENV\tLIBRESSL_VERSION 2.4.1\n\nARG \tMAIN_DIR=/talos/\n\nARG\tSGX_FILE=sgx_linux_ubuntu16.04.1_x64_sdk_1.9.100.39124.bin\nARG\tSGX_URL=https://download.01.org/intel-sgx/linux-1.9/${SGX_FILE}\n\nARG\tLIBRESSL_ROOT=${MAIN_DIR}/src/libressl-${LIBRESSL_VERSION}/\nARG\tLIBRESSL_CRYPTO=${LIBRESSL_ROOT}/crypto\nARG\tLIBRESSL_LIB=${LIBRESSL_ROOT}/lib\n\nARG\tAPACHE_FILE=httpd-2.4.23.tar.bz2\nARG\tAPACHE_URL=https://archive.apache.org/dist/httpd/${APACHE_FILE}\nARG \tAPACHE_ROOT=${MAIN_DIR}/httpd-${APACHE_VERSION}\nARG \tAPACHE_INSTALL=${APACHE_ROOT}/install\nARG \tAPACHE_HTDOCS=${APACHE_INSTALL}/htdocs\nARG \tAPACHE_USR=www-data\nARG \tAPACHE_GRP=www-data\n\nARG \tSTARTFILE=$MAIN_DIR/start.sh\n\nRUN \tapt-get update && \\\n\tapt-get install -y --no-install-recommends \\\n\t\tgcc \\\n\t\tavr-libc \\\n\t\tbuild-essential \\\n\t\tlibpcre3-dev \\\n\t\tzlib1g-dev \\\n\t\tgit \\\n\t\tbison \\\n\t\tflex \\\n\t\tlibtool \\\n\t\tgit \\\n\t\topenssh-client \\\n\t\twget \\\n\t\tca-certificates \\\n\t\tmake \\\n\t\tpatch \\\n\t\tlibapr1-dev \\\n\t\tlibaprutil1-dev \\\n\t&& apt-get clean \\\n\t&& apt-get autoclean \\\n\t&& rm -rf /var/lib/apt/lists/*\n\n# Create main directory\nRUN    mkdir -p ${MAIN_DIR}\n\n# Copy repository into container\nWORKDIR ${MAIN_DIR}\nCOPY . .\n\n# Install Intel SGX SDK\nRUN \twget ${SGX_URL} \\\n\t&& chmod +x ${SGX_FILE} \\\n\t&& echo \"yes\" | ./${SGX_FILE} \\\n\t&& rm ${SGX_FILE}\n\n# Patch libressl with TaLoS code\nWORKDIR ${MAIN_DIR}/src/talos\nRUN\t./patch_libressl.sh\n\n# Compile and install TaLoS\nWORKDIR ${LIBRESSL_CRYPTO}\nRUN\tln -s Makefile.sgx Makefile \\\n\t&& . \"${MAIN_DIR}/sgxsdk/environment\" \\\n\t&& make \\\n\t&& make install\n\n# Download, unpack, configure, compile and install Apache Httpd\nWORKDIR ${MAIN_DIR}\nRUN\twget ${APACHE_URL} \\\n\t&& tar xjvf ${APACHE_FILE} \\\n\t&& rm ${APACHE_FILE}\nWORKDIR ${APACHE_ROOT}\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=\"${APACHE_INSTALL}\" --enable-http --enable-proxy --enable-ssl --enable-ssl-staticlib-deps --with-ssl=\"${LIBRESSL_ROOT}\" --enable-file-cache --enable-cache --enable-disk-cache --enable-mem-cache --enable-deflate --enable-expires --enable-headers --enable-usertrack --enable-cgi --enable-vhost-alias --enable-rewrite --enable-so --enable-dav --with-mpm=worker\nRUN\tsed -i -e \"s#MOD_LDFLAGS.*#MOD_LDFLAGS=-L${LIBRESSL_LIB} -lssl -lcrypto -lsgx_urts_sim -lsgx_uae_service_sim -ldl -lrt -lcrypt -lpthread#\" -e \"$ iMOD_CFLAGS=-I${LIBRESSL_ROOT}/include\" modules/ssl/modules.mk\nRUN\t. \"${MAIN_DIR}/sgxsdk/environment\" && \\\n\texport LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:${LIBRESSL_LIB} && \\\n\tLIBRARY_PATH=${LIBRARY_PATH}:${LD_LIBRARY_PATH} make\nRUN\tmake install\n\n# Configure httpd, set links, create certificate, set owner\nRUN \tmkdir -p ${APACHE_INSTALL}/lib \\\n\t&& ln -s ${LIBRESSL_CRYPTO}/enclave.signed.so \\\n\t&& ln -s ${LIBRESSL_LIB}/libssl.so ${APACHE_INSTALL}/lib/ \\\n\t&& ln -s ${LIBRESSL_LIB}/libcrypto.so ${APACHE_INSTALL}/lib/\nRUN\tcp ${MAIN_DIR}/conf/apache/httpd.conf ${APACHE_INSTALL}/conf/\nRUN\techo \"\\nABC\\nMy City\\nMy Institution\\n\\nwww.example.com\\n\\n\" | openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout ${APACHE_INSTALL}/conf/cert.key -out ${APACHE_INSTALL}/conf/cert.crt\nRUN\tchown -R ${APACHE_USR}:${APACHE_GRP} ${APACHE_INSTALL}\n\n# Create httpd startup file\nRUN\techo \"#!/bin/bash\\n\\\n\tcd ${APACHE_ROOT}; \\n\\\n\tsource ${MAIN_DIR}/sgxsdk/environment;\\n\\\n\texport LD_LIBRARY_PATH=\\${LD_LIBRARY_PATH}:${LIBRESSL_LIB};\\n\\\n\t./install/bin/httpd -X\" > /start.sh \\\n\t&& chmod +x /start.sh\n\nEXPOSE 7777\nEXPOSE 7778\n\n"
}