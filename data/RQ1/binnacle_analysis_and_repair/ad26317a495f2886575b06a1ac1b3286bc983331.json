{
  "startTime": 1674239833227,
  "endTime": 1674239833405,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 48,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 127,
        "columnEnd": 138
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 8,
        "lineEnd": 23,
        "columnStart": 25,
        "columnEnd": 12
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 38,
        "lineEnd": 45,
        "columnStart": 25,
        "columnEnd": 13
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 8,
        "lineEnd": 23,
        "columnStart": 25,
        "columnEnd": 12
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 38,
        "lineEnd": 45,
        "columnStart": 25,
        "columnEnd": 13
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Build stage\nFROM ubuntu:16.04 AS build\n\nLABEL vendor=\"Idiap Research Institut\"\nLABEL project=\"SUMMA\"\nLABEL maintainer=\"william.droz@idiap.ch\"\n\n# Install dependencies and tools to build IBDiarization\nRUN apt-get update -y && apt-get install --no-install-recommends -y \\\n  autoconf \\\n  automake \\\n  build-essential \\\n  cmake \\\n  g++ \\\n  git \\\n  libboost-all-dev \\\n  libomp-dev \\\n  libatlas-dev \\\n  libatlas-base-dev \\\n  python3 \\\n  sox \\\n  subversion \\\n  wget \\\n  zlib1g-dev && rm -rf /var/lib/apt/lists/*;\n\nRUN git clone https://github.com/kaldi-asr/kaldi.git && cd kaldi &&  git checkout 5.4 && cd tools && make -j 4 && cd ../src && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" && make -j 4\n\nRUN git clone https://github.com/wdroz/IBDiarization.git\n\n# Build IBDiarization\nENV IB_DIARIZATION_HOME /IBDiarization\nWORKDIR /IBDiarization/src/diarization/cmake/\nRUN cmake . && make -j 4\n\n# Final stage\nFROM ubuntu:16.04\n\n# Install only the dependencies to run IBDiarization\nRUN apt-get update -y && apt-get install --no-install-recommends -y \\\n  ffmpeg \\\n  libatlas-dev \\\n  libatlas-base-dev \\\n  libboost-all-dev \\\n  libomp-dev \\\n  python3 \\\n  python3-pip && rm -rf /var/lib/apt/lists/*;\n\nRUN pip3 install --no-cache-dir --upgrade pip\nRUN pip3 install --no-cache-dir \\\n  webrtcvad \\\n  aio-pika==0.21.0 \\\n  pydiarization\n\n# Copy IBDiarization from the previous stage\nCOPY --from=build /IBDiarization /IBDiarization\n\n# Copy Kaldi bins from the previous stage\nCOPY --from=build /kaldi/src/featbin /featbin\n\nENV PATH=\"/featbin:${PATH}\"\n\nENV PATH=\"/IBDiarization/src/diarization/cmake:${PATH}\"\n\nWORKDIR /IBDiarization\n\n# Default result directory\nRUN mkdir result.dir\n\n# Test the wrapper\nRUN python3 -m pydiarization.test_diarization_wrapper\n\nENV LANG C.UTF-8\nENV PYTHONUNBUFFERED y\n\nRUN /featbin/compute-mfcc-feats --help\n\nENTRYPOINT [ \"/usr/bin/env\", \"python3\", \"-u\", \"/IBDiarization/rabbitmq.py\" ]\n"
}