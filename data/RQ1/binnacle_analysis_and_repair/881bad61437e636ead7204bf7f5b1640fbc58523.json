{
  "startTime": 1674243790288,
  "endTime": 1674243791472,
  "originalSmells": [
    {
      "rule": "mkdirUsrSrcThenRemove",
      "position": {
        "lineStart": 138,
        "lineEnd": 138,
        "columnStart": 6,
        "columnEnd": 24
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 357,
        "lineEnd": 357,
        "columnStart": 20,
        "columnEnd": 50
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 357,
        "lineEnd": 357,
        "columnStart": 60,
        "columnEnd": 92
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 61,
        "lineEnd": 136,
        "columnStart": 18,
        "columnEnd": 14
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 357,
        "lineEnd": 357,
        "columnStart": 76,
        "columnEnd": 108
      }
    }
  ],
  "repairedDockerfile": "FROM debian:stretch-slim\n\n################################################################################\n\nARG PHP_VERSION=7.3.6\n\nARG PHP_NUM=73\n\nARG PHP_PREFIX=/usr/local/php73\n\nARG PHP_INI_DIR=/usr/local/etc/php73\n\nARG COMPOSER_VERSION=1.8.5\n\nENV COMPOSER_ALLOW_SUPERUSER=1\n\nENV COMPOSER_HOME=/tmp\n\nENV TZ Asia/Shanghai\n\n################################################################################\n\nARG DEB_URL=deb.debian.org\n\n# mirrors.ustc.edu.cn\n\nARG DEB_SECURITY_URL=security.debian.org\n\n# mirrors.ustc.edu.cn/debian-security/\n\nCOPY --from=php /usr/local/bin/docker-php-source /usr/local/bin/\n\nCOPY --from=php /usr/local/bin/docker-php-ext-* /usr/local/bin/docker-php-entrypoint /usr/local/bin/\n\nCOPY wsl-php-ext-enable.sh /usr/local/bin/wsl-php-ext-enable.sh\n\nENV PHP_CFLAGS=\"-fstack-protector-strong -fpic -fpie -O2\"\nENV PHP_CPPFLAGS=\"$PHP_CFLAGS\"\nENV PHP_LDFLAGS=\"-Wl,-O1 -Wl,--hash-style=both -pie\"\n\nENV PHP_URL=\"https://secure.php.net/get/php-${PHP_VERSION}.tar.xz/from/this/mirror\"\n\nENV PHPIZE_DEPS \\\n\t\tautoconf \\\n\t\tdpkg-dev \\\n\t\tfile \\\n\t\tg++ \\\n\t\tgcc \\\n\t\tlibc-dev \\\n\t\tmake \\\n\t\tpkg-config \\\n\t\tre2c\n\nRUN sed -i \"s!deb.debian.org!${DEB_URL}!g\" /etc/apt/sources.list \\\n        && sed -i \"s!security.debian.org!${DEB_SECURITY_URL}!g\" /etc/apt/sources.list \\\n        && set -eux; \\\n     { \\\n    \t\techo 'Package: php*'; \\\n    \t\techo 'Pin: release *'; \\\n    \t\techo 'Pin-Priority: -1'; \\\n    \t} > /etc/apt/preferences.d/no-debian-php \\\n\t&& apt update && apt-get install -y --no-install-recommends \\\n    libargon2-0 \\\n\t\tlibargon2-0-dev \\\n    libbz2-1.0 \\\n    libbz2-dev \\\n    libc-client2007e \\\n    libc-client2007e-dev \\\n\t\tlibcurl4-openssl-dev \\\n    libedit2 \\\n\t\tlibedit-dev \\\n    libenchant1c2a \\\n    libenchant-dev \\\n    libsodium18 \\\n\t\tlibsodium-dev \\\n    libsqlite3-0 \\\n\t\tlibsqlite3-dev \\\n    libssl1.1 \\\n\t\tlibssl-dev \\\n    libxml2 \\\n\t\tlibxml2-dev \\\n    zlib1g \\\n\t\tzlib1g-dev \\\n    libxslt1.1 \\\n    libxslt1-dev \\\n    libfreetype6 \\\n    libfreetype6-dev \\\n    libjpeg62-turbo \\\n    libjpeg62-turbo-dev \\\n    libpng16-16 \\\n    libpng-dev \\\n    libsasl2-2 \\\n    libsasl2-dev \\\n    libmemcached11 \\\n    libmemcachedutil2 \\\n    libmemcached-dev \\\n    libpq5 \\\n    libpq-dev \\\n    libzip4 \\\n    libzip-dev \\\n    libyaml-0-2 \\\n    libyaml-dev \\\n\t\t${PHP_EXTRA_BUILD_DEPS:-} \\\n    $PHPIZE_DEPS \\\n\t\tca-certificates \\\n\t\tcurl \\\n    tar \\\n    wget \\\n\t\txz-utils \\\n    libtidy5 \\\n    libtidy-dev \\\n    libxmlrpc-epi0 \\\n    libxmlrpc-epi-dev \\\n    libexif12 \\\n    libexif-dev \\\n    libgmp10 \\\n    libgmp-dev \\\n    libc-client2007e-dev \\\n    libc-client2007e \\\n    libkrb5-3 \\\n    libkrb5-dev \\\n    libxpm4 \\\n    libxpm-dev \\\n    libwebp6 \\\n    libwebp-dev \\\n    libldap-2.4-2 \\\n    libldap2-dev \\\n    libpspell-dev \\\n    # libsnmp30 \\\n    # libsnmp-dev \\\n    # snmp \\\n    libmhash2 \\\n    libmhash-dev \\\n    libpcre3 \\\n    libpcre3-dev \\\n    libicu57 \\\n    libicu-dev \\\n  && mkdir -p $PHP_INI_DIR/conf.d; rm -rf /var/lib/apt/lists/*; \\\n      mkdir -p /usr/src; rm -rf /usr/src \\\n\t\t\t\t\tcd /usr/src; \\\n\t\t\t\t\twget -O php.tar.xz \"$PHP_URL\" \\\n  && set -eux; \\\n\tsavedAptMark=\"$(apt-mark showmanual)\"; \\\n\texport \\\n\t\tCFLAGS=\"$PHP_CFLAGS\" \\\n\t\tCPPFLAGS=\"$PHP_CPPFLAGS\" \\\n\t\tLDFLAGS=\"$PHP_LDFLAGS\" \\\n\t&& docker-php-source extract; \\\n\tcd /usr/src/php; \\\n\tgnuArch=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\"; \\\n\tdebMultiarch=\"$(dpkg-architecture --query DEB_BUILD_MULTIARCH)\"; \\\n  # https://bugs.php.net/bug.php?id=74125\n\tif [ ! -d /usr/include/curl ]; then \\\n\t\tln -sT \"/usr/include/$debMultiarch/curl\" /usr/local/include/curl; \\\n\tfi; \\\n  # X https://www.howtoforge.com/tutorial/how-to-install-php-7-on-debian/\n  # https://stackoverflow.com/questions/34272444/compiling-php7-error\n  ln -sf /usr/lib/libc-client.so.2007e.0 /usr/lib/x86_64-linux-gnu/libc-client.a; \\\n  # https://stackoverflow.com/questions/43617752/docker-php-and-freetds-cannot-find-freetds-in-know-installation-directories\n  # ln -sf /usr/lib/x86_64-linux-gnu/libsybdb.so /usr/lib/ ; \\\n\t./configure \\\n    --prefix=${PHP_PREFIX} \\\n    --sysconfdir=${PHP_INI_DIR} \\\n\t\t--build=\"$gnuArch\" \\\n\t\t--with-config-file-path=\"$PHP_INI_DIR\" \\\n\t\t--with-config-file-scan-dir=\"$PHP_INI_DIR/conf.d\" \\\n    --enable-fpm --with-fpm-user=nginx --with-fpm-group=nginx \\\n\t\t\\\n\t\t--disable-cgi \\\n\t\t\\\n# --enable-ftp is included here because ftp_ssl_connect() needs ftp to be compiled statically\n# (see https://github.com/docker-library/php/issues/236)\n\t\t--enable-ftp \\\n# --enable-mbstring is included here because otherwise there's no way to get pecl to use it properly\n# (see https://github.com/docker-library/php/issues/195)\n\t\t--enable-mbstring \\\n# --enable-mysqlnd is included here because it's harder to compile after the fact than extensions are\n# (since it's a plugin for several extensions, not an extension in itself)\n\t\t--enable-mysqlnd \\\n# https://wiki.php.net/rfc/argon2_password_hash (7.2+)\n\t\t--with-password-argon2 \\\n# https://wiki.php.net/rfc/libsodium\n\t\t--with-sodium=shared \\\n\t\t\\\n    --with-curl \\\n    --with-gettext \\\n    --with-gd \\\n        # php 7.4\n        # --enable-freetype \\\n        --with-freetype-dir=/usr/lib \\\n        --disable-gd-jis-conv \\\n        --with-jpeg-dir=/usr/lib \\\n        --with-png-dir=/usr/lib \\\n        --with-webp-dir=/usr/lib \\\n        --with-xpm-dir=/usr/lib \\\n    --with-libedit \\\n    --with-openssl \\\n        --with-system-ciphers \\\n    --with-pcre-regex \\\n    --with-pdo-mysql \\\n    --with-pdo-pgsql=shared \\\n    --with-xsl=shared \\\n    --with-zlib \\\n    --with-mhash \\\n    --enable-bcmath \\\n    --enable-libxml \\\n    --enable-inline-optimization \\\n    --enable-mbregex \\\n    --enable-pcntl=shared \\\n    --enable-shmop=shared \\\n    --enable-soap=shared \\\n    --enable-sockets=shared \\\n    --enable-sysvmsg=shared \\\n    --enable-sysvsem=shared \\\n    --enable-sysvshm=shared \\\n    --enable-xml \\\n    --enable-zip \\\n        --with-libzip \\\n    --enable-calendar=shared \\\n    --enable-intl=shared \\\n    --enable-exif \\\n    --with-bz2 \\\n    --with-tidy \\\n    --with-gmp \\\n    --with-imap=shared \\\n        --with-imap-ssl \\\n        --with-kerberos \\\n    --with-xmlrpc \\\n    --with-pic \\\n    --with-enchant=shared \\\n    --enable-fileinfo=shared \\\n    --with-ldap=shared \\\n        --with-ldap-sasl \\\n    --enable-phar \\\n    --enable-posix=shared \\\n    --with-pspell=shared \\\n    --enable-shmop=shared \\\n    # --with-snmp=shared \\\n    --enable-embed=shared \\\n    --with-mysqli=shared \\\n    --with-pgsql=shared \\\n    \\\n  # bundled pcre does not support JIT on s390x\n  # https://manpages.debian.org/stretch/libpcre3-dev/pcrejit.3.en.html#AVAILABILITY_OF_JIT_SUPPORT\n\t\t$(test \"$gnuArch\" = 's390x-linux-gnu' && echo '--without-pcre-jit') \\\n\t\t--with-libdir=\"lib/$debMultiarch\" \\\n\t\t\\\n\t\t${PHP_EXTRA_CONFIGURE_ARGS:-} ; \\\n\tmake -j \"$(nproc)\"; \\\n\tmake install \\\n  && rm -rf /usr/local/sbin \\\n  && for file in $( ls ${PHP_PREFIX}/bin ); do ln -sf ${PHP_PREFIX}/bin/$file /usr/local/bin/ ; done \\\n\t&& pecl update-channels \\\n\t&& rm -rf /tmp/pear ~/.pearrc \\\n  && set -ex \\\n\t&& cd ${PHP_INI_DIR} \\\n\t&& if [ -d php-fpm.d ]; then \\\n\t\t# for some reason, upstream's php-fpm.conf.default has \"include=NONE/etc/php-fpm.d/*.conf\"\n\t\tsed 's!=NONE/!=!g' php-fpm.conf.default | tee php-fpm.conf > /dev/null; \\\n\t\tcp php-fpm.d/www.conf.default php-fpm.d/www.conf; \\\n\telse \\\n\t\t# PHP 5.x doesn't use \"include=\" by default, so we'll create our own simple config that mimics PHP 7+ for consistency\n\t\tmkdir php-fpm.d; \\\n\t\tcp php-fpm.conf.default php-fpm.d/www.conf; \\\n\t\t{ \\\n\t\t\techo '[global]'; \\\n\t\t\techo 'include=${PHP_INI_DIR}/php-fpm.d/*.conf'; \\\n\t\t} | tee php-fpm.conf; \\\n\tfi \\\n  && cp /usr/src/php/php.ini-* ${PHP_INI_DIR} \\\n  && cp ${PHP_INI_DIR}/php.ini-development ${PHP_INI_DIR}/php.ini \\\n  && pecl install mongodb \\\n                  igbinary \\\n                  redis \\\n                  memcached \\\n                  # 安装测试版的扩展，可以在扩展名后加 -beta\n                  xdebug \\\n                  yaml \\\n                  swoole \\\n  && mkdir -p /usr/local/etc/php \\\n  && ln -s ${PHP_INI_DIR}/conf.d /usr/local/etc/php/conf.d \\\n  && chmod +x /usr/local/bin/wsl-php-ext-enable.sh \\\n  && docker-php-ext-enable mongodb \\\n                           redis \\\n                           memcached \\\n                           xdebug \\\n                           yaml \\\n                           igbinary \\\n                           # opcache 已默认安装，需要自行载入\n                           opcache \\\n                           swoole \\\n                           \\\n                           pdo_pgsql \\\n                           xsl \\\n                           pcntl \\\n                           shmop \\\n                           soap \\\n                           sockets \\\n                           sysvmsg \\\n                           sysvsem \\\n                           sysvshm \\\n                           calendar \\\n                           intl \\\n                           imap \\\n                           enchant \\\n                           fileinfo \\\n                           ldap \\\n                           posix \\\n                           pspell \\\n                           # snmp \\\n                           mysqli \\\n                           pgsql \\\n  && curl -fsSL https://raw.githubusercontent.com/khs1994-docker/lnmp/master/wsl/config/php.fpm.zz-wsl.conf.example \\\n       > ${PHP_INI_DIR}/php-fpm.d/zz-debian.conf \\\n  && curl -s -f -L -o /tmp/installer.php \\\n         https://raw.githubusercontent.com/composer/getcomposer.org/cb19f2aa3aeaa2006c0cd69a7ef011eb31463067/web/installer \\\n  && php -r \" \\\n    \\$signature = '48e3236262b34d30969dca3c37281b3b4bbe3221bda826ac6a9a62d6444cdb0dcd0615698a5cbe587c3f0fe57a54d8f5'; \\\n    \\$hash = hash('sha384', file_get_contents('/tmp/installer.php')); \\\n    if (!hash_equals(\\$signature, \\$hash)) { \\\n        unlink('/tmp/installer.php'); \\\n        echo 'Integrity check failed, installer is either corrupt or worse.' . PHP_EOL; \\\n        exit(1); \\\n    }\" \\\n  && php /tmp/installer.php --no-ansi --install-dir=${PHP_PREFIX}/bin --filename=composer --version=${COMPOSER_VERSION} \\\n  && ${PHP_PREFIX}/bin/composer --ansi --version --no-interaction \\\n  && rm -rf /tmp/* \\\n  # config opcache\n  # && echo 'opcache.enable_cli=1' >> ${PHP_INI_DIR}/conf.d/wsl-php-ext-opcache.ini \\\n  && echo 'opcache.file_cache=/tmp' >> ${PHP_INI_DIR}/conf.d/wsl-php-ext-opcache.ini \\\n  && echo \"date.timezone=${PHP_TIMEZONE:-PRC}\" | tee ${PHP_INI_DIR}/conf.d/date_timezone.ini \\\n  && echo \"error_log=/var/log/php${PHP_NUM}.error.log\" | tee ${PHP_INI_DIR}/conf.d/error_log.ini\n\n      # nginx apt\n\n      # apache other\n\n      # mysql apt\n\n      # mariadb apt\n\n      # redis\n\nCOPY --from=redis:5.0.5 /usr/local/bin/redis-* ${PHP_PREFIX}/bin/\n\n      # memcached\n\nCOPY --from=memcached:1.5.6 /usr/local/bin/memcached ${PHP_PREFIX}/bin/\n\n      # rabbitmq apt\n\n      # postgresql apt\n\n      # mongodb\n\n      # phpmyadmin\n\nRUN cd /usr/local ; tar -zcvf php73.tar.gz php73 ; rm php73.tar.gz cd etc ; tar -zcvf php73-etc.tar.gz php73 \\\n    && for ext in $( ls /usr/src/php/ext ); \\\n        do echo '*' $( php -r \"if(extension_loaded('$ext')){echo '[x] $ext';}else{echo '[ ] $ext';}\" ); done \\\n    && php -v \\\n    && php -i | grep \".ini\" \\\n    && ${PHP_PREFIX}/sbin/php-fpm -v\n\n\nFROM hello-world:latest\n\n# scratch\n\nLABEL maintainer=\"khs1994-docker/lnmp <khs1994@khs1994.com>\"\n\nCOPY --from=0 /usr/local/php73.tar.gz /\n\nCOPY --from=0 /usr/local/etc/php73-etc.tar.gz /\n"
}