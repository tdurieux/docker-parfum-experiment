{
  "startTime": 1674252894321,
  "endTime": 1674252894781,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 119,
        "lineEnd": 119,
        "columnStart": 5,
        "columnEnd": 114
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 69,
        "lineEnd": 94,
        "columnStart": 5,
        "columnEnd": 31
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM debian:stretch\n\n## From the Build-Depends of the Debian R package, plus subversion\nRUN apt-get update -qq \\\n  && apt-get install -y --no-install-recommends \\\n    ca-certificates \\\n    curl \\\n    ed \\\n    fonts-texgyre \\\n    less \\\n    locales \\\n    libreadline-dev \\\n    vim-tiny \\\n    wget \\\n  && echo \"en_US.UTF-8 UTF-8\" >> /etc/locale.gen \\\n  && locale-gen en_US.utf8 \\\n  && /usr/sbin/update-locale LANG=en_US.UTF-8 \\\n  && apt-get install -y --no-install-recommends \\\n    bash-completion \\\n    bison \\\n    debhelper \\\n    default-jdk \\\n    g++ \\\n    gcc \\\n    gfortran \\\n    groff-base \\\n    libblas-dev \\\n    libbz2-dev \\\n    libcairo2-dev \\\n    libcurl4-openssl-dev \\\n    libjpeg-dev \\\n    liblapack-dev \\\n    liblzma-dev \\\n    libncurses5-dev \\\n    libpango1.0-dev \\\n    libpcre3-dev \\\n    libpng-dev \\\n    libreadline-dev \\\n    libtiff5-dev \\\n    libx11-dev \\\n    libxt-dev \\\n    mpack \\\n    rsync \\\n    subversion \\\n    tcl8.6-dev \\\n    texinfo \\\n    texlive-base \\\n    texlive-extra-utils \\\n    texlive-fonts-extra \\\n    texlive-fonts-recommended \\\n    texlive-generic-recommended \\\n    texlive-latex-base \\\n    texlive-latex-extra \\\n    texlive-latex-recommended \\\n    tk8.6-dev \\\n    valgrind \\\n    x11proto-core-dev \\\n    xauth \\\n    xdg-utils \\\n    xfonts-base \\\n    xvfb \\\n    zlib1g-dev \\\n  && cd /tmp \\\n  && svn co https://svn.r-project.org/R/trunk R-devel \\\n## Build and install according the standard 'recipe' I emailed/posted years ago\n## Updated compiler flags to match https://www.stats.ox.ac.uk/pub/bdr/memtests/README.txt\n  && cd /tmp/R-devel \\\n  ## Get source code of recommended packages\n  && ./tools/rsync-recommended \\\n  && R_PAPERSIZE=letter \\\n     R_BATCHSAVE=\"--no-save --no-restore\" \\\n     R_BROWSER=xdg-open \\\n     PAGER=/usr/bin/pager \\\n     PERL=/usr/bin/perl \\\n     R_UNZIPCMD=/usr/bin/unzip \\\n     R_ZIPCMD=/usr/bin/zip \\\n     R_PRINTCMD=/usr/bin/lpr \\\n     LIBnn=lib \\\n     AWK=/usr/bin/awk \\\n     CFLAGS=\"-pipe -Wall -pedantic -O2 -mtune=native -fsanitize=address\" \\\n     FFLAGS=\"-pipe -O2 -mtune=native\" \\\n     FCFLAGS=\"-pipe -O2 -mtune=native\" \\\n     CXXFLAGS=\"-pipe -Wall -pedantic -O2 -mtune=native\" \\\n           MAIN_LDFLAGS=\"-fsanitize=address,undefined\" \\\n           CC=\"gcc -std=gnu99 -fsanitize=address,undefined -fno-omit-frame-pointer\" \\\n     CXX=\"g++ -fsanitize=address,undefined,bounds-strict -fno-omit-frame-pointer -fno-sanitize=object-size,vptr\" \\\n           CXX1X=\"g++ -fsanitize=address,undefined,bounds-strict -fno-omit-frame-pointer -fno-sanitize=object-size,vptr\" \\\n     FC=\"gfortran\" \\\n     F77=\"gfortran\" \\\n     ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" \\\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n     --enable-R-shlib \\\n               --with-blas \\\n               --with-readline \\\n               --with-recommended-packages \\\n               --program-suffix=dev \\\n               --disable-openmp \\\n  && make \\\n  && make install \\\n  && make clean \\\n  ## Add a default CRAN mirror\n  && echo \"options(repos = c(CRAN = 'https://cran.rstudio.com/'), download.file.method = 'libcurl')\" >> /usr/local/lib/R/etc/Rprofile.site \\\n  ## Add a library directory (for user-installed packages)\n  && mkdir -p /usr/local/lib/R/site-library \\\n  && chown root:staff /usr/local/lib/R/site-library \\\n  && chmod g+wx /usr/local/lib/R/site-library \\\n  ## Fix library path\n  && echo \"R_LIBS_USER='/usr/local/lib/R/site-library'\" >> /usr/local/lib/R/etc/Renviron \\\n  && echo \"R_LIBS=\\${R_LIBS-'/usr/local/lib/R/site-library:/usr/local/lib/R/library:/usr/lib/R/library'}\" >> /usr/local/lib/R/etc/Renviron \\\n  ## install packages from date-locked MRAN snapshot of CRAN\n  && [ -z \"$BUILD_DATE\" ] && BUILD_DATE=$(TZ=\"America/Los_Angeles\" date -I) || true \\\n  && MRAN=https://mran.microsoft.com/snapshot/${BUILD_DATE} \\\n  && echo MRAN=$MRAN >> /etc/environment \\\n  && export MRAN=$MRAN \\\n  ## MRAN becomes default only in versioned images\n  ## Use littler installation scripts\n  && Rscript -e \"install.packages(c('littler', 'docopt'), repos = '$MRAN')\" \\\n  && ln -s /usr/local/lib/R/site-library/littler/examples/install2.r /usr/local/bin/install2.r \\\n  && ln -s /usr/local/lib/R/site-library/littler/examples/installGithub.r /usr/local/bin/installGithub.r \\\n  && ln -s /usr/local/lib/R/site-library/littler/bin/r /usr/local/bin/r \\\n  ## TEMPORARY WORKAROUND to get more robust error handling for install2.r prior to littler update\n  && curl -f -O /usr/local/bin/install2.r https://github.com/eddelbuettel/littler/raw/master/inst/examples/install2.r \\\n  && chmod +x /usr/local/bin/install2.r \\\n  ## Clean up from R source install\n  && cd / \\\n  && rm -rf /tmp/* \\\n  && apt-get remove --purge -y $BUILDDEPS \\\n  && apt-get autoremove -y \\\n  && apt-get autoclean -y \\\n  && rm -rf /var/lib/apt/lists/*\n\nENV LC_ALL en_US.UTF-8\nENV LANG en_US.UTF-8\n\n## More verbose UBSAN/SAN output (cf #3) -- this is still somewhat speculative\n## Entry copied from Prof Ripley's setup described at http://www.stats.ox.ac.uk/pub/bdr/memtests/README.txt\nENV ASAN_OPTIONS 'alloc_dealloc_mismatch=0:detect_leaks=0:detect_odr_violation=0'\n\n\nCMD [\"R\"]\n\n"
}