{
  "startTime": 1674244534605,
  "endTime": 1674244534891,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 92,
        "lineEnd": 92,
        "columnStart": 5,
        "columnEnd": 17
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 116,
        "lineEnd": 116,
        "columnStart": 4,
        "columnEnd": 9
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 260
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 4,
        "columnEnd": 98
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 74
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 43
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 10,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 79
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 5,
        "columnEnd": 42
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 108,
        "lineEnd": 108,
        "columnStart": 5,
        "columnEnd": 25
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 44,
        "lineEnd": 44,
        "columnStart": 5,
        "columnEnd": 39
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 5,
        "columnEnd": 42
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 5,
        "columnEnd": 40
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM centos\n\n### Guacamole Server ###\n# 更多详细安装信息可参考 Guacamole 官方 <https://guacamole.apache.org/doc/gug/installing-guacamole.html>\n# 拷贝定制过的 guacamole-server 并解压\nADD f2etest-guacamole/guacamole-server-0.9.3.tar.gz /home/guacdshare\n\nWORKDIR /home/guacdshare\n\n# 安装需要使用到的依赖包\nRUN yum install -y wget gcc initscripts sudo lsof automake autoconf libtool make \\\n  # 安装 `guacd` 依赖\n  cairo-devel libpng-devel uuid-devel freerdp* libvncserver-devel openssl-devel \\\n  # 编译前创建 `freerdp` 的软连接\n  && ln -s /usr/local/lib/freerdp/guacsnd.so /usr/lib64/freerdp/ \\\n  && ln -s /usr/local/lib/freerdp/guacdr.so /usr/lib64/freerdp/ && rm -rf /var/cache/yum\n\nWORKDIR /home/guacdshare/guacamole-server-0.9.3\n\n# 运行配置脚本并将 `guacd` 添加到 `/etc/init.d` 目录\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --with-init-dir=/etc/init.d \\\n  # 编译\n  && make \\\n  # 安装构建的组件\n  && make install \\\n  # 更新已安装库的缓存\n  && ldconfig \\\n  # 设置运行时自动启动\n  && chkconfig --add guacd \\\n  && chkconfig guacd on\n\n\n### Guacamole Client ###\nWORKDIR /root\n\n## JAVA ##\n# 下载 JDK 1.8\nRUN wget --no-cookies --no-check-certificate --header \"Cookie: gpw_e24=http%3A%2F%2Fwww.oracle.com%2F; oraclelicense=accept-securebackup-cookie\" \"https://download.oracle.com/otn-pub/java/jdk/8u141-b15/336fa29ff2bb4ef291e347e091f7f4a7/jdk-8u141-linux-x64.tar.gz\" \\\n  && mkdir /usr/java\n\nWORKDIR /usr/java\n\n# 拷贝并解压 JDK\nRUN cp /root/jdk-8u141-linux-x64.tar.gz ./ \\\n  && tar xzf jdk-8u141-linux-x64.tar.gz && rm jdk-8u141-linux-x64.tar.gz\n\n# 设置 JAVA 运行环境\nENV JAVA_HOME /usr/java/jdk1.8.0_141\nENV PATH $JAVA_HOME/bin;$PATH\nENV CLASSPATH .:$JAVA_HOME/lib\n\n## TOMCAT ##\nWORKDIR /usr/local\n\n# 下载并解压 Tomcat\nRUN wget https://mirrors.hust.edu.cn/apache/tomcat/tomcat-8/v8.5.38/bin/apache-tomcat-8.5.38.tar.gz \\\n  && tar -xzvf apache-tomcat-8.5.38.tar.gz \\\n  && mv apache-tomcat-8.5.38 tomcat8 && rm apache-tomcat-8.5.38.tar.gz\n\n# 拷贝定制过的 WAR 包\nCOPY f2etest-guacamole/guacamole-0.9.3.war /usr/local/tomcat8/webapps/guacamole.war\n\n# 拷贝 guacamole 配置文件和免登配置文件\nCOPY f2etest-docker/guacamole.properties /etc/guacamole/\nCOPY f2etest-docker/noauth-config.xml /etc/guacamole/\n\n# 拷贝 Tomcat 服务脚本到 `/etc/init.d` 目录\nCOPY f2etest-docker/tomcat8 /etc/init.d/\n\nWORKDIR /etc/init.d\n\n# 增加 Tomcat 服务让其运行时自动启动\nRUN chmod 755 tomcat8 \\\n  && chkconfig --add tomcat8 \\\n  && chkconfig --level 234 tomcat8 on \\\n  && mkdir /root/.guacamole \\\n  && ln -s /etc/guacamole/guacamole.properties /root/.guacamole\n\n\n### F2etst Web ###\n## Node Env ##\nWORKDIR /usr/local\n\n# 下载 node v10 并解压\nRUN wget https://nodejs.org/dist/v10.15.1/node-v10.15.1-linux-x64.tar.xz \\\n  && xz -d node-v10.15.1-linux-x64.tar.xz \\\n  && tar -xf node-v10.15.1-linux-x64.tar \\\n  && mv node-v10.15.1-linux-x64 node \\\n  # 给 `node`, `npm` 命令创建软连接\n  && ln -s /usr/local/node/bin/node /usr/bin/node \\\n  && ln -s /usr/local/node/bin/npm /usr/bin/npm \\\n  # 安装 pm2 [node 应用进程管理器]\n  && npm i -g pm2 \\\n  # 给 `pm2` 命令创建软连接 \\\n  && ln -s /usr/local/node/bin/pm2 /usr/bin/pm2 && npm cache clean --force; && rm node-v10.15.1-linux-x64.tar\n\n## MySQL ##\n# 下载安装 MySQL\nRUN wget https://dev.mysql.com/get/mysql-community-release-el7-5.noarch.rpm \\\n  && yum localinstall -y mysql-community-release-el7-5.noarch.rpm \\\n  && yum install -y mysql-community-server && rm -rf /var/cache/yum\n\n## Nginx ##\n# 拷贝 nginx 源配置\nCOPY f2etest-docker/nginx.repo /etc/yum.repos.d/\n\n# yum 安装 nginx\nRUN yum-config-manager --enable nginx-mainline \\\n  && yum install -y nginx && rm -rf /var/cache/yum\n\nCOPY f2etest-docker/nginx.conf /etc/nginx/\n\n# 拷贝 Web 应用程序\nCOPY f2etest-web /home/f2etest-web\nWORKDIR /home/f2etest-web/\n# 安装 node 依赖包\nRUN npm i && npm cache clean --force;\n\n\n# 拷贝初始化脚本（初始化数据库表、`pm2` 启动 Web、启动 Nginx）\nCOPY f2etest-docker/setup.sh ./\nRUN chmod 777 setup.sh\n\nEXPOSE 80\n\n# 指定容器启动程序（以防出现权限不足情况）\nENTRYPOINT [\"/usr/sbin/init\"]\n"
}