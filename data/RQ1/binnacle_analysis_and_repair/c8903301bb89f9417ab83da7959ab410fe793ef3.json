{
  "startTime": 1674249753698,
  "endTime": 1674249754137,
  "originalSmells": [
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 4,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 7
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM alpine:3.8\n\n# Install required alpine linux packages.\nRUN apk update\nRUN apk add --no-cache \\\n    git \\\n    perl \\\n    perl-dev \\\n    musl-dev \\\n    python \\\n    apache2 \\\n    gcc \\\n    make \\\n    perl-app-cpanminus \\\n    perl-namespace-autoclean \\\n    gdbm \\\n    apache2-dev \\\n    curl \\\n    apache2-utils \\\n    apache2-ssl \\\n    shadow \\\n    vim\n\n# Install modperl\nRUN cd /tmp && \\\n    wget https://apache.org/dist/perl/mod_perl-2.0.10.tar.gz && \\\n    tar -xzf mod_perl-2.0.10.tar.gz && \\\n    cd mod_perl-2.0.10/ && \\\n    perl Makefile.PL MP_APXS=/usr/bin/apxs && \\\n    make && make install && rm mod_perl-2.0.10.tar.gz\n\n# Load modperl in httpd conf\nRUN echo >> /etc/apache2/httpd.conf && \\\n    echo \"LoadModule perl_module /usr/lib/apache2/mod_perl.so\" >> /etc/apache2/httpd.conf\n\n# Build Crypt::Rijndael perl module manually because we need to apply a patch\n# to rijndael.h.\nRUN cd /tmp && \\\n    wget https://cpan.metacpan.org/authors/id/L/LE/LEONT/Crypt-Rijndael-1.13.tar.gz && \\\n    tar -xzf Crypt-Rijndael-1.13.tar.gz && \\\n    cd Crypt-Rijndael-1.13/ && \\\n    perl Makefile.PL && \\\n    sed -i s/__uint8_t/uint8_t/g rijndael.h && \\\n    sed -i s/__uint32_t/uint32_t/g rijndael.h && make install && rm Crypt-Rijndael-1.13.tar.gz\n\n# Install the remaining required perl modules using cpanm.\nRUN cpanm --notest --no-man-pages --no-wget --curl \\\n    Moose \\\n    MooseX::Types \\\n    MooseX::ConfigFromFile \\\n    MooseX::Getopt \\\n    MooseX::Role::Parameterized \\\n    MooseX::SimpleConfig \\\n    MooseX::StrictConstructor \\\n    MooseX::Types::DateTime \\\n    Time::HiRes \\\n    Time::Piece \\\n    Catalyst::Devel \\\n    Catalyst::Plugin::RequireSSL \\\n    Catalyst::Plugin::Session::Store::FastMmap \\\n    JSON Catalyst::View::JSON \\\n    Template::Plugin::Filter::Minify::CSS \\\n    Template::Plugin::Filter::Minify::JavaScript \\\n    Catalyst::Plugin::Cache::FastMmap \\\n    Catalyst::Plugin::UploadProgress \\\n    HTML::GenerateUtil \\\n    Class::Factory JSON::XS \\\n    Digest Archive::Zip \\\n    Data::Validate::URI \\\n    Log::Handler \\\n    Crypt::OpenPGP \\\n    Params::Classify \\\n    Variable::Magic \\\n    DateTime \\\n    Class::ISA \\\n    Catalyst::Authentication::User::Hash \\\n    Catalyst::Plugin::Session::State::Cookie \\\n    Catalyst::View::TT \\\n    Archive::Tar \\\n    Catalyst::Plugin::ConfigLoader::Environment\n\n# Set up deployment dirs.\nRUN mkdir /var/ibexfarm && \\\n    git clone https://github.com/addrummond/ibexfarm.git /var/ibexfarm/ibexfarm && \\\n    chown -R apache:apache /var/ibexfarm/\n\n# Checkout the revision of github.com/addrummond/ibex corresponding to 0.3.9\n# and create a tarball.\nRUN cd /tmp && \\\n    git clone https://github.com/addrummond/ibex && \\\n    cd ibex && \\\n    git checkout 9e903f9 && \\\n    rm -rf .git* && \\\n    rm -rf docs && \\\n    rm -rf contrib && \\\n    rm -f LICENSE README example_lighttpd.conf mkdist.sh server_conf.py && \\\n    cd .. && \\\n    tar -czf ibex-deploy.tar.gz ibex && \\\n    mv ibex-deploy.tar.gz /var/ibexfarm && rm ibex-deploy.tar.gz\n\nRUN touch /etc/apache2/conf.d/httpdpasswd && \\\n    chown apache:apache /etc/apache2/conf.d/httpdpasswd\n\n# This is the dir apache2 wants to put its PID file in.\nRUN mkdir /run/apache2\n\n# Main ibex farm config.\nRUN printf \"---\\n\\\nname: IbexFarm\\n\\\n\\n\\\nurl_prefix: '/'\\n\\\n\\n\\\nwebmaster_name: 'IBEX_WEBMASTER'\\n\\\nwebmaster_email: 'IBEX_WEBMASTER_EMAIL'\\n\\\n\\n\\\nibex_archive: '/var/ibexfarm/ibex-deploy.tar.gz'\\n\\\nibex_archive_root_dir: 'ibex'\\n\\\nibex_version: '0.3.9'\\n\\\ndeployment_dir: '/ibexdata/deploy'\\n\\\ndeployment_www_dir: '/ibexdata/ibexexps'\\n\\\n\\n\\\nmax_fname_length: 150\\n\\\n\\n\\\ndirs: [ 'js_includes', 'css_includes', 'data_includes', 'chunk_includes', 'server_state', 'results' ]\\n\\\nsync_dirs: [ 'js_includes', 'css_includes', 'data_includes', 'chunk_includes', 'server_state' ]\\n\\\ndirs_to_types:\\n\\\n  js_includes: 'text/javascript'\\n\\\n  css_includes: 'text/css'\\n\\\n  data_includes: 'text/javascript'\\n\\\n  chunk_includes: 'text/html'\\n\\\n  server_state: 'text/plain'\\n\\\n  results: 'text/plain'\\n\\\noptional_dirs:\\n\\\n  server_state: 1\\n\\\n  results: 1\\n\\\nwritable: [ 'data_includes/*', 'results/*', 'server_state/*','chunk_includes/*' ]\\n\\\n\\n\\\nenforce_quotas: 0\\n\\\nquota_max_files_in_dir: 500\\n\\\nquota_max_file_size: 1048576\\n\\\nquota_max_total_size: 1048576\\n\\\nquota_record_dir: '/tmp/quota'\\n\\\n\\n\\\npassword_protect_apache:\\n\\\n    htpasswd: '/usr/bin/htpasswd'\\n\\\n    passwd_file: '/etc/apache2/conf.d/httpdpasswd'\\n\\\n\\n\\\nmax_upload_size_bytes: 1048576\\n\\\n\\n\\\nexperiment_password_protection: Apache\\n\\\n\\n\\\ngit_path: '/usr/bin/git'\\n\\\ngit_checkout_timeout_seconds: 25\\n\\\n\\n\\\nevent_log_file: '/dev/stdout'\\n\\\n\\n\\\nexperiment_base_url: '/ibexexps/'\\n\\\n\\n\\\npython_hashbang: '/usr/bin/python'\\n\\\n\\n\\\nconfig_url: 'http://localhost/ajax/config'\\n\\\nconfig_permitted_hosts: ['localhost', '::1']\\n\" > /var/ibexfarm/ibexfarm/ibexfarm.yaml\n\n## Choose port Apache listens on based on env var\nRUN sed -i 's/^Listen[\\t ].*/Listen ${IBEXFARM_port}'/ /etc/apache2/httpd.conf\n\n## Append to Apache config\nRUN printf \"ServerName localhost\\n\\\n\\n\\\nPerlSwitches -I/var/ibexfarm/ibexfarm/lib\\n\\\nPerlModule IbexFarm\\n\\\n\\n\\\n<LocationMatch \\\"^/(?!(?:static/|ibexexps/))\\\">\\n\\\n    SetHandler modperl\\n\\\n    PerlResponseHandler IbexFarm\\n\\\n</LocationMatch>\\n\\\n\\n\\\nAlias /static/ /var/ibexfarm/ibexfarm/root/static/\\n\\\n<Directory /var/ibexfarm/ibexfarm/root/static/>\\n\\\n    Options none\\n\\\n    Require all granted\\n\\\n</Directory>\\n\\\n<Location /static>\\n\\\n    SetHandler default-handler\\n\\\n</Location>\\n\\\n\\n\\\nDocumentRoot \\\"/var/www\\\"\\n\\\n\\n\\\nAddHandler cgi-script .py\\n\\\nAlias \"/ibexexps\" \"/ibexdata/ibexexps\"\\n\\\n\\n\\\n<Directory \\\"/ibexdata/ibexexps\\\" >\\n\\\n    Options +ExecCGI +FollowSymLinks\\n\\\n    AllowOverride AuthConfig\\n\\\n    DirectoryIndex experiment.html\\n\\\n    Require all granted\\n\\\n</Directory>\\n\\\n#\\n\\\n# Relax access to content within /var/www.\\n\\\n#\\n\\\n<Directory \\\"/var/www\\\">\\n\\\n    AllowOverride None\\n\\\n    # Allow open access:\\n\\\n    Require all granted\\n\\\n</Directory>\\n\\\n\\n\\\n# Log to stdout/stderr\\n\\\nErrorLog /dev/stderr\\n\\\nTransferLog /dev/stdout\\n\\\n\\n\\\nLoadModule cgi_module modules/mod_cgi.so\\n\\\n# SetEnv rather than PerlSetEnv for IBEXFARM_config_url because\\n\\\n# it needs to go through to CGI scripts, not modperl code.\\n\\\nSetEnv IBEXFARM_config_url \\\"\\${IBEXFARM_config_url}\\\"\\n\\\nPerlSetEnv IBEXFARM_host \\\"\\${IBEXFARM_host}\\\"\\n\\\nPerlSetEnv IBEXFARM_url_prefix \\\"\\${IBEXFARM_url_prefix}\\\"\\n\\\nPerlSetEnv IBEXFARM_webmaster_email \\\"\\${IBEXFARM_webmaster_email}\\\"\\n\\\nPerlSetEnv IBEXFARM_webmaster_name \\\"\\${IBEXFARM_webmaster_name}\\\"\\n\\\nPerlSetEnv IBEXFARM_config_secret \\\"\\${IBEXFARM_config_secret}\\\"\\n\\\nPerlSetEnv IBEXFARM_config_url_envvar \\\"\\${IBEXFARM_config_url_envvar}\\\"\\n\" >> /etc/apache2/httpd.conf\n\n# Apache https config\nRUN printf \"LoadModule ssl_module modules/mod_ssl.so\\n\\\nLoadModule socache_shmcb_module modules/mod_socache_shmcb.so\\n\\\nSSLRandomSeed startup file:/dev/urandom 512\\n\\\nSSLRandomSeed connect builtin\\n\\\nSSLCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES:!ADH\\n\\\nSSLProxyCipherSuite HIGH:MEDIUM:!MD5:!RC4:!3DES:!ADH\\n\\\nSSLHonorCipherOrder on\\n\\\nSSLProtocol all -SSLv3\\n\\\nSSLProxyProtocol all -SSLv3\\n\\\nSSLPassPhraseDialog  builtin\\n\\\nSSLSessionCache        \\\"shmcb:/var/cache/mod_ssl/scache(512000)\\\"\\n\\\nSSLSessionCacheTimeout  300\\n\\\n<VirtualHost *:443>\\n\\\nServerName \\\"\\${IBEXFARM_host}:443\\\"\\n\\\nServerAdmin \\\"\\${IBEXFARM_webmaster_email}\\\"\\n\\\nErrorLog /dev/stderr\\n\\\nTransferLog /dev/stdout\\n\\\nSSLEngine on\\n\\\nSSLCertificateFile      /ibexdata/cert.pem\\n\\\nSSLCertificateKeyFile   /ibexdata/privkey.pem\\n\\\nSSLCertificateChainFile /ibexdata/chain.pem\\n\\\nCustomLog /dev/stdout \\\"%%t %%h %%{SSL_PROTOCOL}x %%{SSL_CIPHER}x \\\\\\\"%%r\\\\\\\" %%b\\\"\\n\\\n</VirtualHost>\\n\" > /var/ibexfarm/ssl.conf\n\n# Create wrapper we use to run httpd, including or not including ssl\n# config depending on port.\nRUN rm -f /etc/apache2/conf.d/ssl.conf && \\\n    echo '#!/bin/sh' > /var/ibexfarm/start.sh && \\\n    printf \"rm -f /etc/apache2/conf.d/ssl.conf\\nif [ \\\"\\$IBEXFARM_port\\\" = \\\"443\\\" ]; then\\n  ln -s /var/ibexfarm/ssl.conf /etc/apache2/conf.d/ssl.conf\\nfi\\nexec /usr/sbin/httpd -D FOREGROUND\\n\" >> /var/ibexfarm/start.sh && \\\n    chmod +x /var/ibexfarm/start.sh\n\n# Fix handling of base URL in Catalyst\nRUN echo 'sub auto : Private { my ($self, $c) = @_; $c->req->base(URI->new(IbexFarm->config->{url_prefix})); }; 1' >> /var/ibexfarm/ibexfarm/lib/IbexFarm/Controller/Root.pm\n\n# Fix the id of the apache user and group so we know what they are\n# when doing chowns in the host system.\nRUN groupmod -g 987654 apache && \\\n    usermod -u 987654 apache\n\nEXPOSE 80 443\nENTRYPOINT [\"/var/ibexfarm/start.sh\"]\n"
}