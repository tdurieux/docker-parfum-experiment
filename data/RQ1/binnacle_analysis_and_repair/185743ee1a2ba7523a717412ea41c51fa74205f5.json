{
  "startTime": 1674241214846,
  "endTime": 1674241216020,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 72,
        "lineEnd": 72,
        "columnStart": 18,
        "columnEnd": 70
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 73,
        "lineEnd": 73,
        "columnStart": 4,
        "columnEnd": 116
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 108,
        "lineEnd": 108,
        "columnStart": 4,
        "columnEnd": 120
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 49,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "curlUseHttpsUrl",
      "position": {
        "lineStart": 108,
        "lineEnd": 108,
        "columnStart": 4,
        "columnEnd": 120
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 97
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 82,
        "lineEnd": 82,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 83,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 21
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 84,
        "lineEnd": 84,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 22
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 123,
        "lineEnd": 123,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 85
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 121,
        "lineEnd": 121,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 63,
        "columnEnd": 88
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 86
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 81,
        "lineEnd": 81,
        "columnStart": 4,
        "columnEnd": 84
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 90,
        "lineEnd": 90,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 116,
        "lineEnd": 116,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 63,
        "columnEnd": 88
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 81,
        "lineEnd": 81,
        "columnStart": 4,
        "columnEnd": 84
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 63,
        "columnEnd": 88
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 86
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 81,
        "lineEnd": 81,
        "columnStart": 4,
        "columnEnd": 84
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 90,
        "lineEnd": 90,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 116,
        "lineEnd": 116,
        "columnStart": 4,
        "columnEnd": 27
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 70
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 81,
        "lineEnd": 81,
        "columnStart": 4,
        "columnEnd": 108
      }
    }
  ],
  "repairedDockerfile": "FROM java:openjdk-8-jdk\nMAINTAINER Dalitso Banda <dalitsohb@gmail.com>\n\n# `Z_VERSION` will be updated by `dev/change_zeppelin_version.sh`\nENV Z_VERSION=\"git_master\"\nENV Z_COMMIT=\"2ea945f548a4e41312026d5ee1070714c155a11e\"\nENV LOG_TAG=\"[ZEPPELIN_${Z_VERSION}]:\" \\\n    Z_HOME=\"/zeppelin\" \\\n    LANG=en_US.UTF-8 \\\n    LC_ALL=en_US.UTF-8\n\nRUN echo \"$LOG_TAG Install essentials\" && \\\n    apt-get -y update && \\\n    apt-get install --no-install-recommends -y locales && \\\n    locale-gen $LANG && \\\n    apt-get install --no-install-recommends -y git wget grep curl sed && \\\n    apt-get autoclean && apt-get autoremove && rm -rf /var/lib/apt/lists/*;\n\nRUN echo \"$LOG_TAG Getting maven\" && \\\n    wget https://www.eu.apache.org/dist/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz && \\\n    tar -zxf apache-maven-3.3.9-bin.tar.gz -C /usr/local/ && \\\n    ln -s /usr/local/apache-maven-3.3.9/bin/mvn /usr/local/bin/mvn && rm apache-maven-3.3.9-bin.tar.gz\n\nADD patch_beam.patch /tmp/patch_beam.patch\n\nRUN echo \"$LOG_TAG install nodejs\" && \\\n    curl -f -sL https://deb.nodesource.com/setup_11.x | bash - && apt-get install --no-install-recommends -y nodejs && \\\n    echo \"$LOG_TAG Download Zeppelin source\" && \\\n    git clone https://github.com/apache/zeppelin.git /zeppelin-${Z_VERSION}-bin-all && \\\n    mv /zeppelin-${Z_VERSION}-bin-all ${Z_HOME}_src && \\\n    mkdir ${Z_HOME}/notebook/mmlspark -p && \\\n    cd ${Z_HOME}_src && \\\n    git checkout ${Z_COMMIT} && \\\n    echo '{ \"allow_root\": true }' > /root/.bowerrc && \\\n    echo \"$LOG_TAG building zeppelin\" && \\\n    # setup \\\n    cd ${Z_HOME}_src && \\\n    git status && \\\n    mv /tmp/patch_beam.patch . && \\\n    git apply --ignore-space-change --ignore-whitespace patch_beam.patch && \\\n     ./dev/change_scala_version.sh 2.11 && \\\n    # dendencies\n    apt-get -y update && \\\n    apt-get install --no-install-recommends -y git libfontconfig r-base-dev r-cran-evaluate wget grep curl sed && \\\n    # setup zeppelin-web\n    cd ${Z_HOME}_src/zeppelin-web && \\\n    rm package-lock.json && \\\n    mkdir -p /usr/local/lib/node_modules && \\\n    npm install -g @angular/cli && \\\n    npm install -g grunt-cli bower && \\\n    bower install && \\\n    cd ${Z_HOME}_src && \\\n    export MAVEN_OPTS=\"-Xmx2g -Xss128M -XX:MetaspaceSize=512M -XX:MaxMetaspaceSize=1024M -XX:+CMSClassUnloadingEnabled\" && \\\n    mvn -e -B package -DskipTests -Pscala-2.11 -Pbuild-distr && \\\n    tar xvf ${Z_HOME}_src/zeppelin-distribution/target/zeppelin-0.9.0-SNAPSHOT.tar.gz && \\\n    rm -rf ${Z_HOME}/* && \\\n    mv zeppelin-0.9.0-SNAPSHOT ${Z_HOME}_dist && \\\n    mv ${Z_HOME}_dist/* ${Z_HOME} && \\\n    echo \"$LOG_TAG Cleanup\" && \\\n    apt-get remove --purge -y r-base-dev r-cran-evaluate libfontconfig && \\\n    npm uninstall -g @angular/cli grunt-cli bower && \\\n    apt-get autoclean && apt-get autoremove -y && \\\n    rm -rf ${Z_HOME}_dist && \\\n    rm -rf ${Z_HOME}_src && \\\n    rm -rf /root/.ivy2 && \\\n    rm -rf /root/.m2 && \\\n    rm -rf /root/.npm && \\\n    rm -rf /root/.cache && \\\n    rm -rf /tmp/* && npm cache clean --force; && rm ${Z_HOME}_src/zeppelin-distribution/target/zeppelin-0.9.0-SNAPSHOT.tar.gz && rm -rf /var/lib/apt/lists/*;\n\nRUN echo \"$LOG_TAG install tini related packages\" && \\\n    apt-get install --no-install-recommends -y wget curl grep sed dpkg && \\\n    TINI_VERSION=$( curl -f https://github.com/krallin/tini/releases/latest | grep -o \"/v.*\\\"\" | sed 's:^..\\(.*\\).$:\\1:') && \\\n    curl -f -L \"https://github.com/krallin/tini/releases/download/v${TINI_VERSION}/tini_${TINI_VERSION}.deb\" > tini.deb && \\\n    dpkg -i tini.deb && \\\n    rm tini.deb && rm -rf /var/lib/apt/lists/*;\n\nRUN echo \"$LOG_TAG installing python related packages\" && \\\n    curl -f https://bootstrap.pypa.io/get-pip.py -o get-pip.py && \\\n    python get-pip.py && \\\n    rm get-pip.py && \\\n    apt-get install --no-install-recommends -y python-dev libpython3-dev build-essential pkg-config gfortran && \\\n    pip install --no-cache-dir -U pip setuptools wheel && \\\n    pip install --no-cache-dir numpy && \\\n    pip install --no-cache-dir matplotlib && \\\n    pip install --no-cache-dir pandas && \\\n    apt-get update && \\\n    apt-get upgrade -y && \\\n    echo \"deb http://deb.debian.org/debian stretch main\" >> /etc/apt/sources.list && \\\n    apt-get update && \\\n    apt-get install --no-install-recommends -y g++ gcc-6 libstdc++-6-dev && \\\n    echo \"$LOG_TAG Cleanup\" && \\\n    apt-get purge -y --auto-remove build-essential pkg-config gfortran libpython3-dev && \\\n    apt-get autoremove -y && \\\n    apt-get autoclean && \\\n    apt-get clean && \\\n    rm -rf /root/.npm && \\\n    rm -rf /root/.m2 && \\\n    rm -rf /root/.cache && \\\n    rm -rf /tmp/* && rm -rf /var/lib/apt/lists/*;\n\nENV APACHE_SPARK_VERSION 2.4.0\nENV HADOOP_VERSION 3.2.0\nENV HADOOP_GIT_COMMIT=\"release-3.2.0-RC1\"\n\nRUN echo \"$LOG_TAG Getting SPARK_HOME\" && \\\n    mkdir -p /opt && \\\n    cd /opt && \\\n    curl -f https://apache.claz.org/spark/spark-${APACHE_SPARK_VERSION}/spark-${APACHE_SPARK_VERSION}-bin-without-hadoop.tgz | \\\n        tar -xz && \\\n    ln -s spark-${APACHE_SPARK_VERSION}-bin-without-hadoop spark && \\\n    echo Spark ${APACHE_SPARK_VERSION} installed in /opt/spark && \\\n    export SPARK_HOME=/opt/spark\n\nRUN echo \"$LOG_TAG building hadoop\" && \\\n    apt-get update && \\\n    apt-get install --no-install-recommends -y make && \\\n    cd  / && \\\n    git clone https://github.com/apache/hadoop.git  hadoop_src && \\\n    mkdir /hadoop_deps && cd /hadoop_deps && \\\n    wget https://github.com/protocolbuffers/protobuf/releases/download/v2.5.0/protobuf-2.5.0.tar.bz2 && \\\n    tar xvf protobuf-2.5.0.tar.bz2 && \\\n    cd protobuf-2.5.0 && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" && make && make install && ldconfig && \\\n    cd /hadoop_src && git checkout ${HADOOP_GIT_COMMIT} && mvn package -Pdist -DskipTests -Dtar && \\\n    mv hadoop-dist/target/hadoop-${HADOOP_VERSION} /opt/hadoop && \\\n    rm -r /hadoop_src && \\\n    rm -rf /root/.ivy2 && \\\n    rm -rf /root/.m2 && \\\n    export HADOOP_HOME=/opt/hadoop && \\\n    echo \"\\nexport HADOOP_CLASSPATH=/opt/hadoop/share/hadoop/tools/lib/*\" >> /opt/hadoop/etc/hadoop/hadoop-env.sh && \\\n    echo Hadoop ${HADOOP_VERSION} installed in /opt/hadoop && \\\n    apt-get purge -y --auto-remove g++ make build-essential autoconf automake && \\\n    cd  / && rm -rf /hadoop_deps && rm protobuf-2.5.0.tar.bz2 && rm -rf /var/lib/apt/lists/*;\n\nRUN echo \"\\nSPARK_DIST_CLASSPATH=/jars:/jars/*:$(/opt/hadoop/bin/hadoop classpath)\" >> /opt/spark/conf/spark-env.sh\nENV HADOOP_HOME=/opt/hadoop\nADD jars /jars\n\n# add notebooks\nADD mmlsparkExamples/ ${Z_HOME}/notebook/mmlspark/\n\nADD spark-defaults.conf /opt/spark/conf/spark-defaults.conf\nADD zeppelin-env.sh ${Z_HOME}/conf/\n\nEXPOSE 8080\n\nENTRYPOINT [ \"/usr/bin/tini\", \"--\" ]\nWORKDIR ${Z_HOME}\nCMD [\"sh\", \"-c\", \"echo '\\nspark.driver.host' $(hostname -i) >> /opt/spark/conf/spark-defaults.conf && bin/zeppelin.sh\"]\n"
}