{
  "startTime": 1674252693806,
  "endTime": 1674252694546,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 253,
        "lineEnd": 253,
        "columnStart": 21,
        "columnEnd": 78
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 259,
        "lineEnd": 259,
        "columnStart": 4,
        "columnEnd": 79
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 262,
        "lineEnd": 262,
        "columnStart": 4,
        "columnEnd": 81
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 246,
        "lineEnd": 246,
        "columnStart": 4,
        "columnEnd": 60
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# Copyright 2016 Telefonica Investigaci√≥n y Desarrollo, S.A.U\n#\n# This file is part of fiware-cygnus (FI-WARE project).\n#\n# fiware-cygnus is free software: you can redistribute it and/or modify it under the terms of the GNU Affero\n# General Public License as published by the Free Software Foundation, either version 3 of the License, or (at your\n# option) any later version.\n# fiware-cygnus is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without even the\n# implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public License\n# for more details.\n#\n# You should have received a copy of the GNU Affero General Public License along with fiware-cygnus. If not, see\n# http://www.gnu.org/licenses/.\n#\n# For those usages not covered by the GNU Affero General Public License please contact with iot_support at tid dot es\n#\n\nFROM centos:centos7.6.1810\n\nMAINTAINER Francisco Romero Bueno <francisco.romerobueno@telefonica.com>\n\n# Environment variables\nENV CYGNUS_USER \"cygnus\"\nENV CYGNUS_HOME \"/opt/fiware-cygnus\"\nENV CYGNUS_VERSION \"1.14.0_SNAPSHOT\"\nENV CYGNUS_CONF_PATH \"/opt/apache-flume/conf\"\nENV CYGNUS_CONF_FILE \"/opt/apache-flume/conf/agent.conf\"\nENV CYGNUS_AGENT_NAME \"cygnus-ngsi\"\nENV CYGNUS_LOG_LEVEL \"INFO\"\nENV CYGNUS_LOG_APPENDER \"console\"\nENV CYGNUS_SERVICE_PORT \"5050\"\nENV CYGNUS_JAVA_OPTS \"-Xms2048m -Xmx4096m\"\nENV CYGNUS_API_PORT \"5080\"\nENV CYGNUS_MULTIAGENT false\nENV CYGNUS_MONITORING_TYPE \"\"\n\n# These variables are optional ENV variables to docker runtime\n\n# MySQL options\nENV CYGNUS_MYSQL_HOST \"\"\nENV CYGNUS_MYSQL_PORT \"\"\n# ENV CYGNUS_MYSQL_USER \"\"  # Warning: For development use only - Storing sensitive information in clear text is insecure\n# ENV CYGNUS_MYSQL_PASS \"\"  # Warning: For development use only - Storing sensitive information in clear text is insecure\nENV CYGNUS_MYSQL_SKIP_CONF_GENERATION \"\"\nENV CYGNUS_MYSQL_ENABLE_ENCODING \"\"\nENV CYGNUS_MYSQL_ENABLE_GROUPING \"\"\nENV CYGNUS_MYSQL_ENABLE_NAME_MAPPINGS \"\"\nENV CYGNUS_MYSQL_SKIP_NAME_MAPPINGS_GENERATION \"\"\nENV CYGNUS_MYSQL_ENABLE_LOWERCASE \"\"\nENV CYGNUS_MYSQL_DATA_MODEL \"\"\nENV CYGNUS_MYSQL_ATTR_PERSISTENCE \"\"\nENV CYGNUS_MYSQL_BATCH_SIZE \"\"\nENV CYGNUS_MYSQL_BATCH_TIMEOUT \"\"\nENV CYGNUS_MYSQL_BATCH_TTL \"\"\n\n# MongoDB / STH options\nENV CYGNUS_MONGO_HOSTS \"\"\n# ENV CYGNUS_MONGO_USER \"\" # Warning: For development use only - Storing sensitive information in clear text is insecure\n# ENV CYGNUS_MONGO_PASS \"\" # Warning: For development use only - Storing sensitive information in clear text is insecure\nENV CYGNUS_MONGO_SKIP_CONF_GENERATION \"\"\nENV CYGNUS_MONGO_ENABLE_ENCODING \"\"\nENV CYGNUS_MONGO_ENABLE_GROUPING \"\"\nENV CYGNUS_MONGO_ENABLE_NAME_MAPPINGS \"\"\nENV CYGNUS_MONGO_SKIP_NAME_MAPPINGS_GENERATION \"\"\nENV CYGNUS_MONGO_ENABLE_LOWERCASE \"\"\nENV CYGNUS_MONGO_DATA_MODEL \"\"\nENV CYGNUS_MONGO_ATTR_PERSISTENCE \"\"\nENV CYGNUS_MONGO_DB_PREFIX \"\"\nENV CYGNUS_MONGO_COLLECTION_PREFIX \"\"\nENV CYGNUS_MONGO_BATCH_SIZE \"\"\nENV CYGNUS_MONGO_BATCH_TIMEOUT \"\"\nENV CYGNUS_MONGO_BATCH_TTL \"\"\nENV CYGNUS_MONGO_DATA_EXPIRATION \"\"\nENV CYGNUS_MONGO_COLLECTIONS_SIZE \"\"\nENV CYGNUS_MONGO_MAX_DOCUMENTS \"\"\nENV CYGNUS_MONGO_IGNORE_WHITE_SPACES \"\"\nENV CYGNUS_STH_ENABLE_ENCODING \"\"\nENV CYGNUS_STH_ENABLE_GROUPING \"\"\nENV CYGNUS_STH_ENABLE_NAME_MAPPINGS \"\"\nENV CYGNUS_STH_SKIP_NAME_MAPPINGS_GENERATION \"\"\nENV CYGNUS_STH_ENABLE_LOWERCASE \"\"\nENV CYGNUS_STH_DATA_MODEL \"\"\nENV CYGNUS_STH_DB_PREFIX \"\"\nENV CYGNUS_STH_COLLECTION_PREFIX \"\"\nENV CYGNUS_STH_RESOLUTIONS \"\"\nENV CYGNUS_STH_BATCH_SIZE \"\"\nENV CYGNUS_STH_BATCH_TIMEOUT \"\"\nENV CYGNUS_STH_BATCH_TTL \"\"\nENV CYGNUS_STH_DATA_EXPIRATION \"\"\n\n# CKAN options\nENV CYGNUS_CKAN_HOST \"\"\nENV CYGNUS_CKAN_PORT \"\"\nENV CYGNUS_CKAN_API_KEY \"\"\nENV CYGNUS_CKAN_SSL \"\"\nENV CYGNUS_CKAN_SKIP_CONF_GENERATION \"\"\nENV CYGNUS_CKAN_ENABLE_ENCODING \"\"\nENV CYGNUS_CKAN_ENABLE_GROUPING \"\"\nENV CYGNUS_CKAN_ENABLE_NAME_MAPPINGS \"\"\nENV CYGNUS_CKAN_SKIP_NAME_MAPPINGS_GENERATION \"\"\nENV CYGNUS_CKAN_DATA_MODEL \"\"\nENV CYGNUS_CKAN_ATTR_PERSISTENCE \"\"\nENV CYGNUS_CKAN_ORION_URL \"\"\nENV CYGNUS_CKAN_BATCH_SIZE \"\"\nENV CYGNUS_CKAN_BATCH_TIMEOUT \"\"\nENV CYGNUS_CKAN_BATCH_TTL \"\"\nENV CYGNUS_CKAN_BACKEND_MAX_CONNS \"\"\nENV CYGNUS_CKAN_BACKEND_MAX_CONSS_PER_ROUTE \"\"\n\n# HDFS options\nENV CYGNUS_HDFS_HOST \"\"\nENV CYGNUS_HDFS_PORT \"\"\n# ENV CYGNUS_HDFS_USER \"\" # Warning: For development use only - Storing sensitive information in clear text is insecure\n# ENV CYGNUS_HDFS_TOKEN \"\" # Warning: For development use only - Storing sensitive information in clear text is insecure\nENV CYGNUS_HDFS_SKIP_CONF_GENERATION \"\"\nENV CYGNUS_HDFS_ENABLE_ENCODING \"\"\nENV CYGNUS_HDFS_ENABLE_GROUPING \"\"\nENV CYGNUS_HDFS_ENABLE_NAME_MAPPINGS \"\"\nENV CYGNUS_HDFS_SKIP_NAME_MAPPINGS_GENERATION \"\"\nENV CYGNUS_HDFS_ENABLE_LOWERCASE \"\"\nENV CYGNUS_HDFS_DATA_MODEL \"\"\nENV CYGNUS_HDFS_FILE_FORMAT \"\"\nENV CYGNUS_HDFS_BACKEND_IMPL \"\"\nENV CYGNUS_HDFS_BACKEND_MAX_CONNS \"\"\nENV CYGNUS_HDFS_BACKEND_MAX_CONNS_PER_ROUTE \"\"\nENV CYGNUS_HDFS_PASSWORD \"\"\nENV CYGNUS_HDFS_SERVICE_AS_NAMESPACE \"\"\nENV CYGNUS_HDFS_BATCH_SIZE \"\"\nENV CYGNUS_HDFS_BATCH_TIMEOUT \"\"\nENV CYGNUS_HDFS_BATCH_TTL \"\"\nENV CYGNUS_HDFS_BATCH_RETRY_INTERVALS \"\"\nENV CYGNUS_HDFS_HIVE \"\"\nENV CYGNUS_HDFS_KRB5_AUTH \"\"\n\n# PostgreSQL options\nENV CYGNUS_POSTGRESQL_HOST \"\"\nENV CYGNUS_POSTGRESQL_PORT \"\"\n# ENV CYGNUS_POSTGRESQL_USER \"\" # Warning: For development use only - Storing sensitive information in clear text is insecure\n# ENV CYGNUS_POSTGRESQL_PASS \"\" # Warning: For development use only - Storing sensitive information in clear text is insecure\nENV CYGNUS_POSTGRESQL_SKIP_CONF_GENERATION \"\"\nENV CYGNUS_POSTGRESQL_ENABLE_ENCODING \"\"\nENV CYGNUS_POSTGRESQL_ENABLE_GROUPING \"\"\nENV CYGNUS_POSTGRESQL_ENABLE_NAME_MAPPINGS \"\"\nENV CYGNUS_POSTGRESQL_SKIP_NAME_MAPPINGS_GENERATION \"\"\nENV CYGNUS_POSTGRESQL_ENABLE_LOWERCASE \"\"\nENV CYGNUS_POSTGRESQL_ATTR_PERSISTENCE \"\"\nENV CYGNUS_POSTGRESQL_BATCH_SIZE \"\"\nENV CYGNUS_POSTGRESQL_BATCH_TIMEOUT \"\"\nENV CYGNUS_POSTGRESQL_BATCH_TTL \"\"\nENV CYGNUS_POSTGRESQL_ENABLE_CACHE \"\"\n\n# Carto options\n# ENV CYGNUS_CARTO_USER \"\"\n# ENV CYGNUS_CARTO_KEY \"\"\n\n\n# Docker Secrets Support - The following equivalents to storing clear text usernames and passwords are also available:\n#\n# ENV CYGNUS_MYSQL_USER_FILE\n# ENV CYGNUS_MYSQL_PASS_FILE\n# ENV CYGNUS_MONGO_USER_FILE\n# ENV CYGNUS_MONGO_PASS_FILE\n# ENV CYGNUS_HDFS_USER_FILE\n# ENV CYGNUS_HDFS_TOKEN_FILE\n# ENV CYGNUS_POSTGRESQL_USER_FILE\n# ENV CYGNUS_POSTGRESQL_PASS_FILE\n# ENV CYGNUS_CARTO_USER_FILE\n# ENV CYGNUS_CARTO_KEY_FILE\n\n# Orion options\nENV CYGNUS_ORION_SKIP_CONF_GENERATION \"\"\nENV CYGNUS_ORION_ENABLE_ENCODING \"\"\nENV CYGNUS_ORION_ENABLE_GROUPING \"\"\nENV CYGNUS_ORION_ENABLE_NAME_MAPPINGS \"\"\nENV CYGNUS_ORION_SKIP_NAME_MAPPINGS_GENERATION \"\"\nENV CYGNUS_ORION_ENABLE_LOWERCASE \"\"\nENV CYGNUS_ORION_HOST \"\"\nENV CYGNUS_ORION_PORT \"\"\nENV CYGNUS_ORION_SSL \"\"\nENV CYGNUS_ORION_USER \"\"\nENV CYGNUS_ORION_PASS \"\"\nENV CYGNUS_ORION_KEYSTONE_HOST \"\"\nENV CYGNUS_ORION_KEYSTONE_PORT \"\"\nENV CYGNUS_ORION_KEYSTONE_SSL \"\"\nENV CYGNUS_ORION_FIWARE \"\"\nENV CYGNUS_ORION_FIWARE_PATH \"\"\nENV CYGNUS_ORION_BATCH_SIZE \"\"\nENV CYGNUS_ORION_BATCH_TIMEOUT \"\"\nENV CYGNUS_ORION_BATCH_TTL \"\"\nENV CYGNUS_ORION_BATCH_RETRY_INTERVALS \"\"\nENV CYGNUS_ORION_ENABLE_CACHE \"\"\n\n\n\n# PostgreGIS options\nENV CYGNUS_POSTGIS_HOST \"\"\nENV CYGNUS_POSTGIS_PORT \"\"\n# ENV CYGNUS_POSTGIS_USER \"\" # Warning: For development use only - Storing sensitive information in clear text is insecure\n# ENV CYGNUS_POSTGIS_PASS \"\" # Warning: For development use only - Storing sensitive information in clear text is insecure\nENV CYGNUS_POSTGIS_SKIP_CONF_GENERATION \"\"\nENV CYGNUS_POSTGIS_ENABLE_ENCODING \"\"\nENV CYGNUS_POSTGIS_ENABLE_GROUPING \"\"\nENV CYGNUS_POSTGIS_ENABLE_NAME_MAPPINGS \"\"\nENV CYGNUS_POSTGIS_SKIP_NAME_MAPPINGS_GENERATION \"\"\nENV CYGNUS_POSTGIS_ENABLE_LOWERCASE \"\"\nENV CYGNUS_POSTGIS_ATTR_PERSISTENCE \"\"\nENV CYGNUS_POSTGIS_BATCH_SIZE \"\"\nENV CYGNUS_POSTGIS_BATCH_TIMEOUT \"\"\nENV CYGNUS_POSTGIS_BATCH_TTL \"\"\nENV CYGNUS_POSTGIS_ENABLE_CACHE \"\"\n\n\n# Elasticsearch options\nENV CYGNUS_ELASTICSEARCH_HOST \"\"\nENV CYGNUS_ELASTICSEARCH_PORT \"\"\nENV CYGNUS_ELASTICSEARCH_SSL \"\"\nENV CYGNUS_ELASTICSEARCH_SKIP_CONF_GENERATION \"\"\nENV CYGNUS_ELASTICSEARCH_INDEX_PREFIX \"\"\nENV CYGNUS_ELASTICSEARCH_MAPPING_TYPE \"\"\nENV CYGNUS_ELASTICSEARCH_BACKEND_MAX_CONNS \"\"\nENV CYGNUS_ELASTICSEARCH_BACKEND_MAX_CONSS_PER_ROUTE \"\"\nENV CYGNUS_ELASTICSEARCH_IGNORE_WHITE_SPACES \"\"\nENV CYGNUS_ELASTICSEARCH_ATTR_PERSISTENCE \"\"\nENV CYGNUS_ELASTICSEARCH_TIMEZONE \"\"\nENV CYGNUS_ELASTICSEARCH_CAST_VALUE \"\"\nENV CYGNUS_ELASTICSEARCH_CACHE_FLASH_INTERVAL_SEC \"\"\n\n\n# NOTE: Configure correctly GIT_URL_CYGNUS and GIT_REV_CYGNUS for each git branch/fork used\nENV GIT_URL_CYGNUS \"https://github.com/telefonicaid/fiware-cygnus.git\"\n# ENV GIT_URL_CYGNUS \"https://github.com/myuser/fiware-cygnus.git\"\nENV GIT_REV_CYGNUS \"master\"\n\nENV MVN_VER \"3.5.4\"\nENV MVN_HOME \"/opt/apache-maven\"\n\nENV FLUME_VER \"1.9.0\"\nENV FLUME_HOME \"/opt/apache-flume\"\n\nENV JAVA_VERSION \"1.8.0\"\n\n# Install\nRUN \\\n\n    adduser ${CYGNUS_USER} && \\\n    yum -y install nc java-${JAVA_VERSION}-openjdk-devel git && \\\n    export JAVA_HOME=/usr/lib/jvm/java-${JAVA_VERSION}-openjdk && \\\n    export MAVEN_OPTS=\"-Xmx4096m -XX:MaxPermSize=256m -Dfile.encoding=UTF-8 -Dproject.build.sourceEncoding=UTF-8 -Dmaven.compiler.useIncrementalCompilation=false -DdependencyLocationsEnabled=false -XX:+TieredCompilation -XX:TieredStopAtLevel=1\" && \\\n    export MAVEN_ARGS=\"-B -T4\" && \\\n    # For debug Maven\n    # export MAVEN_ARGS=\"${MAVEN_ARGS} -X -e -Dmaven.compiler.verbose=true\" && \\\n    echo \"INFO: Getting apache preferred site and obtain URLs for Maven and Flume...\" && \\\n    APACHE_DOMAIN=\"$( curl -f -s 'https://www.apache.org/dyn/closer.cgi?as_json=1' | python -c 'import json,sys;obj=json.load(sys.stdin);print obj[\"preferred\"]')\" \\\n      || APACHE_DOMAIN=\"http://archive.apache.org/dist/\" && \\\n    MVN_URL=\"${APACHE_DOMAIN}maven/maven-3/${MVN_VER}/binaries/apache-maven-${MVN_VER}-bin.tar.gz\" && \\\n    FLUME_URL=\"${APACHE_DOMAIN}flume/${FLUME_VER}/apache-flume-${FLUME_VER}-bin.tar.gz\" && \\\n    echo -e $'INFO: Java version <'${JAVA_VERSION}'>\\n'$(java -version)'\\nINFO: Apache domain <'${APACHE_DOMAIN}'>\\nINFO: URL MAVEN <'${MVN_URL}'>\\nINFO: URL FLUME <'${FLUME_URL}'>' && \\\n    echo \"INFO: Download and install Maven and Flume...\" && \\\n    curl -f --remote-name --location --insecure --silent --show-error \"${MVN_URL}\" && \\\n    tar xzf apache-maven-${MVN_VER}-bin.tar.gz && \\\n    mv apache-maven-${MVN_VER} ${MVN_HOME} && \\\n    curl -f --remote-name --location --insecure --silent --show-error \"${FLUME_URL}\" && \\\n    tar zxf apache-flume-${FLUME_VER}-bin.tar.gz && \\\n    mv apache-flume-${FLUME_VER}-bin ${FLUME_HOME} && \\\n    mkdir -p ${FLUME_HOME}/plugins.d/cygnus && \\\n    mkdir -p ${FLUME_HOME}/plugins.d/cygnus/lib && \\\n    mkdir -p ${FLUME_HOME}/plugins.d/cygnus/libext && \\\n    chown -R cygnus:cygnus ${FLUME_HOME} && \\\n    # Make a shallow clone to help reduce final image size\n    echo \"INFO: Cloning Cygnus using <${GIT_URL_CYGNUS}> and <${GIT_REV_CYGNUS}>\" && \\\n    git clone ${GIT_URL_CYGNUS} ${CYGNUS_HOME} && \\\n    cd ${CYGNUS_HOME} && \\\n    git checkout ${GIT_REV_CYGNUS} && \\\n    echo \"INFO: Build and install cygnus-common\" && \\\n    cd ${CYGNUS_HOME}/cygnus-common && \\\n    ${MVN_HOME}/bin/mvn ${MAVEN_ARGS} clean compile exec:exec assembly:single && \\\n    cp target/cygnus-common-${CYGNUS_VERSION}-jar-with-dependencies.jar ${FLUME_HOME}/plugins.d/cygnus/libext/ && \\\n    ${MVN_HOME}/bin/mvn install:install-file -Dfile=${FLUME_HOME}/plugins.d/cygnus/libext/cygnus-common-${CYGNUS_VERSION}-jar-with-dependencies.jar -DgroupId=com.telefonica.iot -DartifactId=cygnus-common -Dversion=${CYGNUS_VERSION} -Dpackaging=jar -DgeneratePom=false && \\\n    echo \"INFO: Build and install cygnus-ngsi\" && \\\n    cd ${CYGNUS_HOME}/cygnus-ngsi && \\\n    ${MVN_HOME}/bin/mvn ${MAVEN_ARGS} clean compile exec:exec assembly:single && \\\n    cp target/cygnus-ngsi-${CYGNUS_VERSION}-jar-with-dependencies.jar ${FLUME_HOME}/plugins.d/cygnus/lib/ && \\\n    echo \"INFO: Install Cygnus Application script\" && \\\n    cp ${CYGNUS_HOME}/cygnus-common/target/classes/cygnus-flume-ng ${FLUME_HOME}/bin/ && \\\n    chmod +x ${FLUME_HOME}/bin/cygnus-flume-ng && \\\n    echo \"INFO: Instantiate some configuration files\" && \\\n    cp ${CYGNUS_HOME}/cygnus-common/conf/log4j.properties.template ${FLUME_HOME}/conf/log4j.properties && \\\n    cp ${CYGNUS_HOME}/cygnus-ngsi/conf/grouping_rules.conf.template ${FLUME_HOME}/conf/grouping_rules.conf && \\\n    cp ${CYGNUS_HOME}/cygnus-ngsi/conf/name_mappings.conf.template ${FLUME_HOME}/conf/name_mappings.conf && \\\n    echo \"INFO: Create Cygnus log folder\" && \\\n    mkdir -p /var/log/cygnus && \\\n    echo \"INFO: Cleanup to thin the final image... doing optimizations...\" && \\\n    cd ${CYGNUS_HOME}/cygnus-common && \\\n    ${MVN_HOME}/bin/mvn ${MAVEN_ARGS} clean && \\\n    cd ${CYGNUS_HOME}/cygnus-ngsi && \\\n    ${MVN_HOME}/bin/mvn ${MAVEN_ARGS} clean && \\\n    rm -rf /root/.m2 && rm -rf ${MVN_HOME} && rm -rf ${FLUME_HOME}/docs && rm -rf ${CYGNUS_HOME}/doc && rm -f /*.tar.gz && \\\n    echo \"INFO: Java runtime not needs JAVA_HOME... Unsetting...\" && \\\n    unset JAVA_HOME && \\\n    yum erase -y git java-${JAVA_VERSION}-openjdk-devel && \\\n    rpm -qa redhat-logos gtk2 pulseaudio-libs libvorbis jpackage* groff alsa* atk cairo libX* | xargs -r rpm -e --nodeps && yum -y erase libss && \\\n    yum clean all && rpm -vv --rebuilddb && rm -rf /var/lib/yum/yumdb && rm -rf /var/lib/yum/history && \\\n    find /usr/share/locale -mindepth 1 -maxdepth 1 ! -name 'en_US' ! -name 'locale.alias' | xargs -r rm -r && rm -f /var/log/*log && \\\n    bash -c 'localedef --list-archive | grep -v -e \"en_US\" | xargs localedef --delete-from-archive' && \\\n    /bin/cp -f /usr/lib/locale/locale-archive /usr/lib/locale/locale-archive.tmpl && \\\n    build-locale-archive && find ${CYGNUS_HOME} -name '.[^.]*' 2>/dev/null | xargs -r rm -rf && rm -rf /var/cache/yum\n\n\nCOPY cygnus-entrypoint.sh /\nCOPY agent.conf ${FLUME_HOME}/conf/\nCOPY agent.conf ${CYGNUS_HOME}/docker/cygnus-ngsi/agent.conf\nCOPY cartodb_keys.conf ${FLUME_HOME}/conf/\n\n# Define the entry point\nENTRYPOINT [\"/cygnus-entrypoint.sh\"]\n\n# Ports used by cygnus-ngsi\nEXPOSE ${CYGNUS_SERVICE_PORT} ${CYGNUS_API_PORT}\n\n"
}