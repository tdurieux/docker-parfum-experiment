{
  "startTime": 1674240362767,
  "endTime": 1674240363604,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 3,
        "columnEnd": 124
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 3,
        "columnEnd": 68
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 29,
        "lineEnd": 29,
        "columnStart": 3,
        "columnEnd": 104
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 3,
        "columnEnd": 22
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 52,
        "lineEnd": 52,
        "columnStart": 4,
        "columnEnd": 43
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# PostgreSQL container for test databases from FMI master databases\n# Adapted from official PostgreSQL Dockerfile:\n# https://github.com/docker-library/postgres/\n#\n# https://hub.docker.com/_/centos/\n\nFROM centos:7\nMAINTAINER \"fmi\"\n\n# Ability to override PGDATA from command line or docker-compose.yml\nENV PGDATA=/var/lib/pgsql/data/9.5\n\n# Explicitly set user/group IDs\nRUN groupadd -r postgres && useradd -r -g postgres postgres && \\\n   # Inject excludes into YUM config files.\n   # https://wiki.postgresql.org/wiki/YUM_Installation\n   sed -i '/\\[base\\]/,/gpgkey=/{/gpgkey=/s/$/\\'$'\\n''exclude = postgres*/;}' /etc/yum.repos.d/CentOS-Base.repo && \\\n   sed -i '/\\[updates\\]/,/gpgkey=/{/gpgkey=/s/$/\\'$'\\n''exclude = postgres*/;}' /etc/yum.repos.d/CentOS-Base.repo && \\\n\n   # Install newest PostgreSQL major version repo.\n   # http://yum.postgresql.org/repopackages.php\n   # Note: EPEL is required by postgis and also supplies pv.\n\n   echo \"ip_resolve=IPv4\" >> /etc/yum.conf && \\\n   curl -f -4 \"https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\" -o /tmp/epel-release-latest-7.noarch.rpm && \\\n   yum --nogpgcheck -y install /tmp/epel-release-latest-7.noarch.rpm && \\\n\n   yum -y update && \\\n   yum -y localinstall https://download.postgresql.org/pub/repos/yum/9.5/redhat/rhel-7-x86_64/pgdg-centos95-9.5-2.noarch.rpm && \\\n   yum -y install postgresql95 postgresql95-server postgresql95-contrib postgresql95-libs postgis2_95 pv && \\\n   yum clean all && rm -rf /tmp/* && \\\n   yum -y install lsof && rm -rf /var/cache/yum\n\n# The database dumps\nCOPY fminames-test.sql.gz /tmp\nCOPY fminames-features-test.dmp.gz /tmp\nCOPY fminames-altadditional-test.dmp.gz /tmp\nCOPY fminames-additional-test.dmp.gz /tmp\nCOPY fminames-kwadditional-test.dmp.gz /tmp\nCOPY fminames-kwhgnadditional-test.dmp.gz /tmp\nCOPY gis-test.sql.gz /tmp\nCOPY avi-test.sql.gz /tmp\nCOPY auth-test.sql.gz /tmp\nCOPY icemap-test.sql.gz /tmp\nCOPY icemap-copy.tar.gz /tmp\nCOPY icemappublications-test.dmp.gz /tmp\nCOPY iceeggannotation-test.dmp.gz /tmp\nCOPY icemapmetadata-test.dmp.gz /tmp\nCOPY map_number-test.dmp.gz /tmp\nCOPY strptc-test.dmp.gz /tmp\nCOPY mosaic-radar-test.dmp.gz /tmp\n\nRUN tar xvf /tmp/icemap-copy.tar.gz -C /tmp && \\\n    mkdir -p ${PGDATA} && \\\n    mkdir -p /etc/provision /var/run/postgresql && \\\n    chown -R postgres ${PGDATA} /var/run/postgresql /tmp /etc/provision && rm /tmp/icemap-copy.tar.gz\n\nUSER postgres\n\n# The first command (only needed once) is to initialize the database in PGDATA.\n# -E UTF-8 is needed here because the fminames schema is also UTF-8.\nRUN /usr/pgsql-9.5/bin/initdb -E 'UTF-8' -D ${PGDATA}\n\nCOPY etc/postgresql.conf ${PGDATA}\nCOPY etc/pg_hba.conf ${PGDATA}\n\n# Start the server and create database users.\n# -w is needed because otherwise createuser would run before the database is up.\n# The server is stopped gracefully in the last step to avoid an error in the next\n# layer, where the server is required to be running again.\nRUN /usr/pgsql-9.5/bin/pg_ctl -w -s -D ${PGDATA} -o \"-p 5432\" start && \\\n    createdb -E 'UTF-8' fminames && \\\n    createdb -e -E UTF8 gis && \\\n    createdb -e -E UTF8 avi && \\\n    createdb -E UTF8 authentication && \\\n    createdb -e -E UTF8 icemap2storage_ro && \\\n    /usr/pgsql-9.5/bin/psql -c \"CREATE USER admin LOGIN SUPERUSER INHERIT NOCREATEDB NOCREATEROLE NOREPLICATION PASSWORD 'admin_pw';\" && \\\n    /usr/pgsql-9.5/bin/psql -c \"CREATE USER fminames_user WITH PASSWORD 'fminames_pw';\" && \\\n    /usr/pgsql-9.5/bin/psql -c \"CREATE USER gis_admin NOLOGIN SUPERUSER INHERIT NOCREATEDB NOCREATEROLE NOREPLICATION;\" && \\\n    /usr/pgsql-9.5/bin/psql -c \"CREATE USER gis_user WITH PASSWORD 'gis_pw';\" && \\\n    /usr/pgsql-9.5/bin/psql -c \"CREATE USER avi_user WITH PASSWORD 'avi_pw';\" && \\\n    /usr/pgsql-9.5/bin/psql -c \"CREATE USER auth_user WITH PASSWORD 'auth_pw';\" && \\\n    /usr/pgsql-9.5/bin/psql -c \"CREATE USER iceservice WITH PASSWORD 'iceservice_pw';\" && \\\n    /usr/pgsql-9.5/bin/psql avi admin -c \"CREATE SCHEMA avidb_bs_ro;\" && \\\n    /usr/pgsql-9.5/bin/psql avi admin -c \"CREATE EXTENSION postgis SCHEMA avidb_bs_ro;\" && \\\n    /usr/pgsql-9.5/bin/psql gis admin -c \"CREATE SCHEMA mosaic;\" && \\\n    /usr/pgsql-9.5/bin/psql gis admin -c \"CREATE EXTENSION postgis SCHEMA mosaic;\" && \\\n    /usr/pgsql-9.5/bin/psql icemap2storage_ro admin -c \"CREATE SCHEMA icemap;\" && \\\n    /usr/pgsql-9.5/bin/psql icemap2storage_ro admin -c \"CREATE SCHEMA icemap_static;\" && \\\n    /usr/pgsql-9.5/bin/psql icemap2storage_ro admin -c \"CREATE EXTENSION postgis SCHEMA public;\" && \\\n#   /usr/pgsql-9.5/bin/psql -c \"ALTER USER admin NOLOGIN;\"\n    /usr/pgsql-9.5/bin/pg_ctl -w -s -D ${PGDATA} -o \"-p 5432\" stop && \\\n\n    # Populate database server from dumps. You might want to add\n    # --set ON_ERROR_STOP=on as an argument to psql, but the current fminames SQL\n    # dump will not load in that case.\n    cd /tmp/ && pv -f fminames-test.sql.gz | gunzip > fminames.sql && \\\n    /usr/pgsql-9.5/bin/pg_ctl -w -s -D ${PGDATA} -o \"-p 5432\" start && \\\n    pv -f /tmp/fminames.sql | sed 's/postgis\\-2\\.1/postgis\\-2\\.3/g' | /usr/pgsql-9.5/bin/psql fminames && \\\n    /usr/pgsql-9.5/bin/psql fminames -c \"GRANT INSERT ON public.geonames TO fminames_user;\" && \\\n    rm /tmp/fminames.sql && \\\n    pv -f /tmp/fminames-altadditional-test.dmp.gz | gunzip > fminames-altadditional.dmp && \\\n    pv -f /tmp/fminames-altadditional.dmp | /usr/pgsql-9.5/bin/psql fminames -c \"\\\\copy public.alternate_geonames (id, source, geonames_id, language, name, preferred, short, colloquial, historic, priority, locked, last_modified) FROM STDIN\" && \\\n    rm /tmp/fminames-altadditional.dmp && \\\n    pv -f /tmp/fminames-additional-test.dmp.gz | gunzip > fminames-additional.dmp && \\\n    pv -f /tmp/fminames-additional.dmp | /usr/pgsql-9.5/bin/psql fminames -c \"\\\\copy public.geonames (id, name, ansiname, lat, lon, class, features_code, countries_iso2, cc2, admin1, admin2, admin3, admin4, population, elevation, dem, timezone, modified, municipalities_id, priority, locked, the_geom, the_geog, last_modified, landcover) FROM STDIN\" && \\\n    rm /tmp/fminames-additional.dmp && \\\n    pv -f /tmp/fminames-kwadditional-test.dmp.gz | gunzip > fminames-kwadditional.dmp && \\\n    pv -f /tmp/fminames-kwadditional.dmp | /usr/pgsql-9.5/bin/psql fminames -c \"\\\\copy public.keywords (keyword, comment, languages, autocomplete) FROM STDIN\" && \\\n    rm /tmp/fminames-kwadditional.dmp && \\\n    pv -f /tmp/fminames-kwhgnadditional-test.dmp.gz | gunzip > fminames-kwhgnadditional.dmp && \\\n    pv -f /tmp/fminames-kwhgnadditional.dmp | /usr/pgsql-9.5/bin/psql fminames -c \"\\\\copy public.keywords_has_geonames (keyword, geonames_id, comment, name, last_modified) FROM STDIN\" && \\\n    rm /tmp/fminames-kwhgnadditional.dmp && \\\n    /usr/pgsql-9.5/bin/psql fminames -c \"GRANT SELECT ON ALL TABLES IN SCHEMA public TO fminames_user;\" && \\\n    pv -f gis-test.sql.gz | gunzip | grep -v \"OWNER TO partio;\" > gis.sql && \\\n    pv -f /tmp/gis.sql | sed 's/postgis\\-2\\.1/postgis\\-2\\.3/g' | /usr/pgsql-9.5/bin/psql gis && \\\n    /usr/pgsql-9.5/bin/psql gis admin -c \"SELECT UpdateGeometrySRID('natural_earth', 'admin_0_countries', 'the_geom', 4326);\" && \\\n    /usr/pgsql-9.5/bin/psql gis admin -c \"GRANT USAGE ON SCHEMA public TO gis_user;\" && \\\n    rm /tmp/gis.sql && \\\n    /usr/pgsql-9.5/bin/psql gis -c \"GRANT SELECT ON ALL TABLES IN SCHEMA fminames,mml,natural_earth,public TO gis_user;\" && \\\n    pv -f avi-test.sql.gz | gunzip | egrep -v \"CREATE SCHEMA avidb_bs_ro\" > avi.sql && \\\n    sed -i 's/public\\.geometry/geometry/g' avi.sql && \\\n    sed -i 's/ TO avidb_r./ TO admin/g' avi.sql && \\\n    sed -i 's/ FROM avidb_r./ FROM admin/g' avi.sql && \\\n    sed -i 's/ TO avidb_bs_ro/ TO avi_user/g' avi.sql && \\\n    sed -i 's/ TO avidb_iwxxm/ TO admin/g' avi.sql && \\\n    pv -f /tmp/avi.sql | /usr/pgsql-9.5/bin/psql avi && \\\n    rm /tmp/avi.sql && \\\n    /usr/pgsql-9.5/bin/psql avi -c \"GRANT USAGE ON SCHEMA avidb_bs_ro TO avi_user;\" && \\\n    /usr/pgsql-9.5/bin/psql -c \"ALTER ROLE avi_user SET search_path TO avidb_bs_ro,public;\" && \\\n    /usr/pgsql-9.5/bin/psql avi -c \"GRANT SELECT ON ALL TABLES IN SCHEMA avidb_bs_ro,public TO avi_user;\" && \\\n    /usr/pgsql-9.5/bin/psql avi -c \"DROP FUNCTION public.avidb_messages_part_trig_func();\" && \\\n    pv -f auth-test.sql.gz | gunzip > auth.sql && \\\n    sed -i 's/weatherproof_../admin/g' auth.sql && \\\n    pv -f /tmp/auth.sql | /usr/pgsql-9.5/bin/psql authentication && \\\n    rm /tmp/auth.sql && \\\n    /usr/pgsql-9.5/bin/psql authentication -c \"GRANT USAGE ON SCHEMA authengine_test TO auth_user;\" && \\\n    /usr/pgsql-9.5/bin/psql authentication -c \"GRANT SELECT ON ALL TABLES IN SCHEMA authengine_test TO auth_user;\" && \\\n    pv -f /tmp/icemap-test.sql.gz | gunzip > icemap.sql && \\\n    pv -f /tmp/icemap.sql | /usr/pgsql-9.5/bin/psql icemap2storage_ro admin && \\\n    pv -f /tmp/icemappublications-test.dmp.gz | gunzip > icemappublications.sql && \\\n    pv -f /tmp/icemappublications.sql | /usr/pgsql-9.5/bin/psql icemap2storage_ro admin && \\\n    pv -f /tmp/iceeggannotation-test.dmp.gz | gunzip > iceeggannotation.sql && \\\n    pv -f /tmp/iceeggannotation.sql | /usr/pgsql-9.5/bin/psql icemap2storage_ro admin && \\\n    pv -f /tmp/icemapmetadata-test.dmp.gz | gunzip > icemapmetadata.sql && \\\n    pv -f /tmp/icemapmetadata.sql | /usr/pgsql-9.5/bin/psql icemap2storage_ro admin && \\\n    pv -f /tmp/map_number-test.dmp.gz | gunzip > map_number.sql && \\\n    pv -f /tmp/map_number.sql | /usr/pgsql-9.5/bin/psql icemap2storage_ro admin && \\\n    pv -f /tmp/strptc-test.dmp.gz | gunzip > strptc.sql && \\\n    pv -f /tmp/strptc.sql | /usr/pgsql-9.5/bin/psql icemap2storage_ro admin && \\\n    /usr/pgsql-9.5/bin/psql icemap2storage_ro admin -a -f /tmp/icemap-copy.sql && \\\n    rm /tmp/icemap.sql && \\\n    /usr/pgsql-9.5/bin/psql icemap2storage_ro -c \"GRANT USAGE ON SCHEMA icemap,icemap_static TO iceservice;\" && \\\n    /usr/pgsql-9.5/bin/psql icemap2storage_ro -c \"GRANT SELECT ON ALL TABLES IN SCHEMA icemap,icemap_static TO iceservice;\" && \\\n\n    # Radar mosaic\n    pv -f /tmp/mosaic-radar-test.dmp.gz | gunzip | /usr/pgsql-9.5/bin/psql gis && \\\n    rm /tmp/mosaic-radar-test.dmp.gz && \\\n    /usr/pgsql-9.5/bin/psql gis admin -c \"GRANT USAGE ON SCHEMA mosaic TO gis_user;\" && \\\n    /usr/pgsql-9.5/bin/psql gis admin -c \"GRANT SELECT ON ALL TABLES IN SCHEMA mosaic TO gis_user;\" && \\\n    /usr/pgsql-9.5/bin/pg_ctl -w -s -D ${PGDATA} -o \"-p 5432\" stop && \\\n\n    chmod 0700 ${PGDATA}\n\n# PostgreSQL is set to listen on TCP port 5444.\nEXPOSE 5444\n\n#Launch the daemon\nENTRYPOINT exec /usr/pgsql-9.5/bin/postgres -o \"-p 5444\" -D /var/lib/pgsql/data/9.5\n"
}