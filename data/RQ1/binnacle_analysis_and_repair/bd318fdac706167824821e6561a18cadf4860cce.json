{
  "startTime": 1674240172243,
  "endTime": 1674240172882,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 3,
        "columnEnd": 14
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 13,
        "lineEnd": 17,
        "columnStart": 2,
        "columnEnd": 1
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM centos/systemd\nMAINTAINER 5team (team@fivemetrics.io)\n\nENV ROOTDIR /usr/local/app\nENV VERSION 0.1\nENV RELEASE 1\nWORKDIR $ROOTDIR\n\nCOPY . $ROOTDIR\n\nRUN rpm -hiv https://dl.influxdata.com/influxdb/releases/influxdb-1.6.0.x86_64.rpm \\\n&& rpm -hiv https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm \\\n&& rpm -hiv http://rpms.remirepo.net/enterprise/remi-release-7.rpm \\\n; yum -y --enablerepo=remi-php71 install php71 php71-php php71-php-cli php71-php-xml php71-php-process \\\nphp71-php-common php71-php-mysqlnd php71-php-pecl-zip php71-php-mbstring php71-php-pdo php71-php-pecl-apcu \\\nphp71-php-pecl-gearman php71-php-opcache php71-php-pecl-redis php71-php-intl \\\nmariadb-server httpd redis mod_ssl npm nodejs mod_ssl gearmand cronie wget \\\n; rm -rf /var/cache/yum ln -sfn /usr/bin/php71 /usr/bin/php \\\n; wget https://raw.githubusercontent.com/composer/getcomposer.org/1b137f8bf6db3e79a38a5bc45324414a6b1f9df2/web/installer -O - -q | php -- --quiet \\\n&& chmod 755 composer.phar \\\n; mkdir -p $ROOTDIR/src/ \\\n&& mkdir -p $ROOTDIR/vendor/nelmio/api-doc-bundle/Resources/views/SwaggerUi \\\n&& mkdir -p /usr/lib/systemd/system/ \\\n&& mkdir -p /etc/app/gearman/ \\\n&& mkdir -p /etc/app/collector/ \\\n&& mkdir -p /etc/httpd/conf.d/ \\\n&& mkdir -p /etc/logrotate.d/ \\\n&& mkdir -p /etc/my.cnf.d/ \\\n&& mkdir -p /var/log/app/ \\\n&& mkdir -p /var/mysqltmp \\\n&& mkdir -p /usr/local/bin/ \\\n; /usr/bin/mysql_install_db \\\n&& chown -R mysql /var/lib/mysql \\\n&& chown -R mysql /var/mysqltmp \\\n; /bin/bash -c \"/usr/bin/mysqld_safe --datadir='/var/lib/mysql' &\" && sleep 5 \\\n&& /usr/bin/mysql -e \"GRANT ALL ON fivemetrics.* TO 'system'@'127.0.0.1' IDENTIFIED BY 'fivemetrics'\" \\\n&& /usr/bin/mysql -e \"FLUSH PRIVILEGES\" \\\n; cd $ROOTDIR/interface \\\n&& npm install \\\n&& ./build.sh $VERSION-$RELEASE \\\n&& cd $ROOTDIR/ \\\n&& ./composer.phar install -n \\\n; npm cache clean --force; cp -a $ROOTDIR/interface/dist/css $ROOTDIR/public \\\n&& cp -a $ROOTDIR/interface/dist/imgs $ROOTDIR/public \\\n&& cp -a $ROOTDIR/interface/dist/js $ROOTDIR/public \\\n&& cp -a $ROOTDIR/interface/dist/locales $ROOTDIR/public \\\n&& cp -a $ROOTDIR/interface/dist/public $ROOTDIR/public \\\n&& cp -a $ROOTDIR/interface/dist/frontend.php $ROOTDIR/public \\\n&& cp $ROOTDIR/system/usr/local/bin/gearman_top /usr/local/bin/gearman_top \\\n&& cp $ROOTDIR/system/usr/local/bin/gcontrol /usr/local/bin/gcontrol \\\n&& cp $ROOTDIR/system/usr/local/bin/collector /usr/local/bin/collector \\\n&& cp $ROOTDIR/system/usr/local/bin/account-cleaner /usr/local/bin/account-cleaner \\\n&& cp $ROOTDIR/system/usr/local/bin/gworker-runner /usr/local/bin/gworker-runner \\\n&& cp $ROOTDIR/system/usr/lib/systemd/system/gcontrol.service /usr/lib/systemd/system/gcontrol.service \\\n&& cp $ROOTDIR/system/usr/lib/systemd/system/collector.service /usr/lib/systemd/system/collector.service \\\n&& cp $ROOTDIR/system/etc/app/gearman/conf.json /etc/app/gearman/conf.json \\\n&& cp $ROOTDIR/system/etc/httpd/conf.d/app.conf /etc/httpd/conf.d/ \\\n&& cp $ROOTDIR/system/etc/httpd/conf.d/deflate.conf /etc/httpd/conf.d/ \\\n&& cp $ROOTDIR/system/etc/httpd/conf.d/expire.conf /etc/httpd/conf.d/ \\\n&& cp $ROOTDIR/system/etc/my.cnf.d/fivemetrics.cnf /etc/my.cnf.d/ \\\n&& cp $ROOTDIR/src/FrontendBundle/Resources/views/api/index.html.twig $ROOTDIR/vendor/nelmio/api-doc-bundle/Resources/views/SwaggerUi/index.html.twig \\\n&& cp $ROOTDIR/system/etc/logrotate.conf /etc/logrotate.conf \\\n&& cp $ROOTDIR/system/etc/logrotate.d/fivemetrics /etc/logrotate.d/fivemetrics \\\n&& php $ROOTDIR/bin/console doctrine:database:create \\\n&& php $ROOTDIR/bin/console doctrine:schema:create \\\n&& php $ROOTDIR/bin/console doctrine:fixtures:load -n \\\n&& php $ROOTDIR/bin/console app:nosql:fixtures:load -n \\\n&& php $ROOTDIR/bin/console cache:clear --env prod \\\n&& php $ROOTDIR/bin/console cache:clear --env dev \\\n; sed -i 's/ --no-sqs//;s/ExecStart=\\(.*\\)/ExecStart=\\1 --no-sqs/' /usr/lib/systemd/system/collector.service \\\n&& sleep 3 \\\n&& chown -R apache. /var/log/app/ \\\n&& chmod -R 755 /usr/local/bin/ \\\n&& echo \"*/5 * * * * root /usr/bin/php /usr/local/app/bin/console app:nosql:fixtures:collect >/dev/null\" > /etc/cron.d/fivemetrics_collect \\\n&& /bin/sed -i 's|/public/|/|g' /etc/httpd/conf/httpd.conf \\\n&& sed -i 's/^extension=curl.so/;extension=curl.so/' /etc/opt/remi/php71/php.d/20-curl.ini \\\n&& sed -i '/^[^#]/s/^/#/' /etc/httpd/conf.d/welcome.conf \\\n&& sed -i 's|^DocumentRoot.*|DocumentRoot \"/usr/local/app/public/\"|' /etc/httpd/conf/httpd.conf \\\n&& chown -R apache: $ROOTDIR/ \\\n&& fgrep -q 'TraceEnable Off' /etc/httpd/conf/httpd.conf || sed -i '21iTraceEnable Off\\n' /etc/httpd/conf/httpd.conf \\\n&& sed -i 's/expose_php.*/expose_php = off/' /etc/opt/remi/php71/php.ini \\\n&& sed -i 's/memory_limit = 128M/memory_limit = 1024M/' /etc/opt/remi/php71/php.ini \\\n; systemctl enable redis \\\n&& systemctl enable collector \\\n&& systemctl enable gearmand \\\n&& systemctl enable httpd \\\n&& systemctl enable mariadb \\\n&& systemctl enable gcontrol \\\n; cp -fa $ROOTDIR/system/usr/local/bin/systemctl /usr/bin/systemctl\n\nEXPOSE 80 443 3306 8086\n\nCMD [\"/usr/bin/systemctl\"]\n"
}