{
  "startTime": 1674245400160,
  "endTime": 1674245400815,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 174
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 138
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 113
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 4,
        "columnEnd": 25
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 174
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 138
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 113
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 4,
        "columnEnd": 25
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 174
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 138
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 113
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 4,
        "columnEnd": 25
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 27
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 197
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 162
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 18,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 88
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 137
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 85
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 51
      }
    }
  ],
  "repairedDockerfile": "FROM ubuntu:14.04\nMAINTAINER Jan Nonnen <helvalius@gmail.com>\n# Define the OSM argument, use monaco as default\nARG OSM=http://download.geofabrik.de/europe/monaco-latest.osm.pbf\n\nRUN apt-get update\n\n# Install basic software\nRUN apt-get -y --no-install-recommends install wget && rm -rf /var/lib/apt/lists/*;\n\n\n# Note: libgeos++-dev is included here too (the nominatim install page suggests installing it if there is a problem with the 'pear install DB' below - it seems safe to install it anyway)\nRUN apt-get -y --no-install-recommends install build-essential gcc git osmosis libxml2-dev libgeos-dev libpq-dev libbz2-dev libtool cmake libproj-dev proj-bin libgeos-c1 libgeos++-dev libexpat1-dev && rm -rf /var/lib/apt/lists/*;\n\n# Install Boost (required by osm2pqsql)\nRUN apt-get -y --no-install-recommends install autoconf make g++ libboost-dev libboost-system-dev libboost-filesystem-dev libboost-thread-dev lua5.2 liblua5.2-dev && rm -rf /var/lib/apt/lists/*;\n\n# Install PHP5\nRUN apt-get -y --no-install-recommends install php5 php-pear php5-pgsql php5-json php-db && rm -rf /var/lib/apt/lists/*;\n\n# From the website \"If you plan to install the source from github, the following additional packages are needed:\"\n# RUN apt-get -y install git autoconf-archive\n\n# Install Postgres, PostGIS and dependencies\nRUN apt-get -y --no-install-recommends install postgresql postgis postgresql-contrib postgresql-9.3-postgis-2.1 postgresql-server-dev-9.3 && rm -rf /var/lib/apt/lists/*;\n\n# Work around for AUFS bug as per https://github.com/docker/docker/issues/783#issuecomment-56013588\nRUN mkdir /etc/ssl/private-copy; mv /etc/ssl/private/* /etc/ssl/private-copy/; rm -r /etc/ssl/private; mv /etc/ssl/private-copy /etc/ssl/private; chmod -R 0700 /etc/ssl/private; chown -R postgres /etc/ssl/private\n\n# Some additional packages that may not already be installed\n# bc is needed in configPostgresql.sh\nRUN apt-get -y --no-install-recommends install bc && rm -rf /var/lib/apt/lists/*;\n\n# Install Apache\nRUN apt-get -y --no-install-recommends install apache2 && rm -rf /var/lib/apt/lists/*;\n\n# Add Protobuf support\nRUN apt-get -y --no-install-recommends install libprotobuf-c0-dev protobuf-c-compiler && rm -rf /var/lib/apt/lists/*;\n\nRUN apt-get -y --no-install-recommends install sudo && rm -rf /var/lib/apt/lists/*;\n\n#\n\nRUN pear install DB\nRUN useradd -m -p password1234 nominatim\nRUN mkdir -p /app/git/\nRUN git clone --recursive https://github.com/twain47/Nominatim.git /app/git/\nRUN mkdir -p /app/nominatim\n\nWORKDIR /app/nominatim\n\nRUN cmake /app/git/\nRUN make\n\n# Configure postgresql\nRUN service postgresql start && \\\n  pg_dropcluster --stop 9.3 main\nRUN service postgresql start && \\\n  pg_createcluster --start -e UTF-8 9.3 main\n\nRUN sudo -u postgres /usr/lib/postgresql/9.3/bin/pg_ctl start -w -D /etc/postgresql/9.3/main/ && \\\n  cat /var/log/postgresql/postgresql-9.3-main.log && \\\n  sudo -u postgres psql postgres -tAc \"SELECT 1 FROM pg_roles WHERE rolname='nominatim'\" | grep -q 1 || sudo -u postgres createuser -s nominatim && \\\n  sudo -u postgres psql postgres -tAc \"SELECT 1 FROM pg_roles WHERE rolname='www-data'\" | grep -q 1 || sudo -u postgres createuser -SDR www-data && \\\n  sudo -u postgres psql postgres -c \"DROP DATABASE IF EXISTS nominatim\"\n\nRUN wget --output-document=/app/data.pbf $OSM\n# RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/europe/luxembourg-latest.osm.pbf\n# RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/north-america-latest.osm.pbf\n# RUN wget --output-document=/app/data.pbf http://download.geofabrik.de/north-america/us/delaware-latest.osm.pbf\n\nWORKDIR /app/nominatim\n\nADD local.php /app/nominatim/settings/local.php\n\n\nRUN ./utils/setup.php --help\n\nRUN chown -R nominatim:nominatim /app/nominatim\nRUN sudo -u postgres /usr/lib/postgresql/9.3/bin/pg_ctl start -w -D /etc/postgresql/9.3/main/ && \\\n  sudo -u nominatim ./utils/setup.php --osm-file /app/data.pbf --all --threads 2\n\nRUN mkdir -p /var/www/nominatim\nRUN cp -R /app/nominatim/website /var/www/nominatim/\nRUN cp -R /app/nominatim/settings /var/www/nominatim/\nRUN chown -R nominatim:www-data /var/www/nominatim\n\n\n# Adjust PostgreSQL configuration so that remote connections to the\n# database are possible.\nRUN echo \"host all  all    0.0.0.0/0  trust\" >> /etc/postgresql/9.3/main/pg_hba.conf\n\n# And add ``listen_addresses`` to ``/etc/postgresql/9.3/main/postgresql.conf``\nRUN echo \"listen_addresses='*'\" >> /etc/postgresql/9.3/main/postgresql.conf\n\n# Expose the PostgreSQL port\nEXPOSE 5432\n\nRUN apt-get install --no-install-recommends -y curl && rm -rf /var/lib/apt/lists/*;\nADD 400-nominatim.conf /etc/apache2/sites-available/400-nominatim.conf\nRUN service apache2 start && \\\n  a2ensite 400-nominatim.conf && \\\n  /etc/init.d/apache2 reload\n\n# Expose the HTTP port\nEXPOSE 8080\n\n\nADD configPostgresql.sh /app/nominatim/configPostgresql.sh\nWORKDIR /app/nominatim\nRUN chmod +x ./configPostgresql.sh\nADD start.sh /app/nominatim/start.sh\nRUN chmod +x /app/nominatim/start.sh\n\nRUN echo \"Using OSM URL: \"$OSM\n\nCMD /app/nominatim/start.sh\n"
}