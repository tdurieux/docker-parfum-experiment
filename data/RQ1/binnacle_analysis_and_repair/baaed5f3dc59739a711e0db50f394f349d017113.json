{
  "startTime": 1674251078782,
  "endTime": 1674251079280,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 86
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 75,
        "lineEnd": 75,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 72,
        "lineEnd": 72,
        "columnStart": 4,
        "columnEnd": 33
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM alpine:3.8 as build\n\nRUN apk add --no-cache cmake boost-dev make curl git curl-dev ruby ruby-dev gcc g++ yaml-cpp-dev jq openjdk8\n\nENV JAVA_HOME /usr/lib/jvm/java-1.8-openjdk\nENV PATH $PATH:$JAVA_HOME/jre/bin:$JAVA_HOME/bin\n\nSHELL [\"/bin/ash\", \"-eo\", \"pipefail\", \"-c\"]\n\nRUN mkdir /workspace\nWORKDIR /workspace\nRUN sed -i -e 's/sys\\/poll/poll/' /usr/include/boost/asio/detail/socket_types.hpp\n\nCOPY configs/components/leatherman.json /workspace\nRUN git clone -b 1.5.x https://github.com/puppetlabs/leatherman && \\\n    mkdir -p /workspace/leatherman/build\nWORKDIR /workspace/leatherman/build\nRUN git checkout \"$(jq .ref /workspace/leatherman.json | tr -d \\\")\" && \\\n    cmake .. -DBOOST_STATIC=OFF -DCMAKE_VERBOSE_MAKEFILE=ON ; make ; make install\nENV CMAKE_SHARED_OPTIONS='-DCMAKE_PREFIX_PATH=/opt/puppetlabs/puppet -DCMAKE_INSTALL_PREFIX=/opt/puppetlabs/puppet -DCMAKE_INSTALL_RPATH=/opt/puppetlabs/puppet/lib -DCMAKE_VERBOSE_MAKEFILE=ON'\n\nWORKDIR /workspace\n\nCOPY configs/components/libwhereami.json /workspace\nRUN git clone https://github.com/puppetlabs/libwhereami && \\\n    mkdir -p /workspace/libwhereami/build\nWORKDIR /workspace/libwhereami/build\nRUN git checkout \"$(jq .ref /workspace/libwhereami.json | tr -d \\\")\"\nRUN cmake $CMAKE_SHARED_OPTIONS -DBOOST_STATIC=OFF ..; make ; make install\n\nWORKDIR /workspace\n\nCOPY configs/components/cpp-hocon.json /workspace\nRUN git clone https://github.com/puppetlabs/cpp-hocon && \\\n    mkdir -p /workspace/cpp-hocon/build\nWORKDIR /workspace/cpp-hocon/build\nRUN git checkout \"$(jq .ref /workspace/cpp-hocon.json | tr -d \\\")\"\nRUN cmake $CMAKE_SHARED_OPTIONS -DBOOST_STATIC=OFF ..; make ; make install\n\nWORKDIR /workspace\n\nCOPY configs/components/facter.json /workspace\n\nRUN git clone https://github.com/puppetlabs/facter && \\\n    mkdir -p /workspace/facter/build\nWORKDIR /workspace/facter/build\nRUN git checkout \"$(jq .ref /workspace/facter.json | tr -d \\\")\"\nRUN cmake /lib $CMAKE_SHARED_OPTIONS -DRUBY_LIB_INSTALL=/usr/lib/ruby/vendor_ruby ..; make ; make install\n\nWORKDIR /workspace\n\nCOPY configs/components/cpp-pcp-client.json /workspace\nRUN git clone https://github.com/puppetlabs/cpp-pcp-client && \\\n    mkdir -p /workspace/cpp-pcp-client/build\nWORKDIR /workspace/cpp-pcp-client/build\nRUN git checkout \"$(jq .ref /workspace/cpp-pcp-client.json | tr -d \\\")\"\nRUN cmake .. $CMAKE_SHARED_OPTIONS ; make ; make install\n\nWORKDIR /workspace\n\nCOPY configs/components/pxp-agent.json /workspace\nRUN git clone https://github.com/puppetlabs/pxp-agent && \\\n    mkdir -p /workspace/pxp-agent/build\nWORKDIR /workspace/pxp-agent/build\nRUN git checkout \"$(jq .ref /workspace/pxp-agent.json | tr -d \\\")\"\nRUN cmake .. $CMAKE_SHARED_OPTIONS ; make ; make install\n\nRUN apk add --no-cache augeas ruby-augeas libressl-dev\nRUN gem install --no-rdoc --no-ri deep_merge json etc semantic_puppet puppet-resource_api multi_json locale httpclient fast_gettext\n\nWORKDIR /workspace\nRUN curl -f -O -L https://people.redhat.com/~rjones/virt-what/files/virt-what-1.18.tar.gz && \\\n    tar zxf virt-what-1.18.tar.gz && rm virt-what-1.18.tar.gz\n\nWORKDIR /workspace/virt-what-1.18\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" && \\\n    make && \\\n    make install\n\nWORKDIR /workspace\n\nCOPY configs/components/hiera.json /workspace\nRUN git clone https://github.com/puppetlabs/hiera\nWORKDIR /workspace/hiera\nRUN git checkout \"$(jq .ref /workspace/hiera.json | tr -d \\\")\"\nRUN ./install.rb --no-configs --bindir=/opt/puppetlabs/puppet/bin --sitelibdir=/usr/lib/ruby/vendor_ruby\n\nWORKDIR /workspace\nCOPY configs/components/puppet.json /workspace\nRUN git clone https://github.com/puppetlabs/puppet\nWORKDIR /workspace/puppet\nRUN git checkout \"$(jq .ref /workspace/puppet.json | tr -d \\\")\"\nRUN ./install.rb --bindir=/opt/puppetlabs/puppet/bin --configdir=/etc/puppetlabs/puppet --sitelibdir=/usr/lib/ruby/vendor_ruby --codedir=/etc/puppetlabs/code --vardir=/opt/puppetlabs/puppet/cache --logdir=/var/log/puppetlabs/puppet --rundir=/var/run/puppetlabs --quick\n\nRUN mkdir -p /opt/puppetlabs/bin && \\\n    ln -s /opt/puppetlabs/puppet/bin/facter /opt/puppetlabs/bin/facter && \\\n    ln -s /opt/puppetlabs/puppet/bin/puppet /opt/puppetlabs/bin/puppet && \\\n    ln -s /opt/puppetlabs/puppet/bin/hiera /opt/puppetlabs/bin/hiera\n\nENV PATH=\"/opt/puppetlabs/bin:$PATH\"\n\nRUN puppet config set confdir /etc/puppetlabs/puppet && \\\n    puppet config set codedir /etc/puppetlabs/code && \\\n    puppet config set vardir /opt/puppetlabs/puppet/cache && \\\n    puppet config set logdir /var/log/puppetlabs/puppet && \\\n    puppet config set rundir /var/run/puppetlabs\n\nRUN mkdir -p /etc/puppetlabs/code/environment/production && \\\n    puppet module install puppetlabs-augeas_core && \\\n    puppet module install puppetlabs-cron_core && \\\n    puppet module install puppetlabs-host_core && \\\n    puppet module install puppetlabs-mount_core && \\\n    puppet module install puppetlabs-scheduled_task && \\\n    puppet module install puppetlabs-selinux_core && \\\n    puppet module install puppetlabs-sshkeys_core && \\\n    puppet module install puppetlabs-yumrepo_core && \\\n    puppet module install puppetlabs-zfs_core && \\\n    puppet module install puppetlabs-zone_core && \\\n    puppet module install puppetlabs-apk\n\n\nFROM alpine:3.8\n\nARG version=6.0.0\nARG vcs_ref\nARG build_date\n\nENV PUPPET_AGENT_VERSION=\"$version\"\nENV PATH=\"/opt/puppetlabs/bin:$PATH\"\n\nLABEL org.label-schema.maintainer=\"Puppet Release Team <release@puppet.com>\" \\\n      org.label-schema.vendor=\"Puppet\" \\\n      org.label-schema.url=\"https://github.com/puppetlabs/puppet-agent\" \\\n      org.label-schema.name=\"Puppet Agent (Alpine)\" \\\n      org.label-schema.license=\"Apache-2.0\" \\\n      org.label-schema.version=\"$PUPPET_AGENT_VERSION\" \\\n      org.label-schema.vcs-url=\"https://github.com/puppetlabs/puppet-agent\" \\\n      org.label-schema.vcs-ref=\"$vcs_ref\" \\\n      org.label-schema.build-date=\"$build_date\" \\\n      org.label-schema.schema-version=\"1.0\" \\\n      org.label-schema.dockerfile=\"/Dockerfile\"\n\nRUN apk add --no-cache \\\n    bash \\\n    ruby \\\n    bind-tools \\\n    curl \\\n    shadow \\\n    yaml-cpp \\\n    ruby-json \\\n    ruby-augeas \\\n    boost-random \\\n    boost-iostreams \\\n    boost-graph \\\n    boost-signals \\\n    boost \\\n    boost-serialization \\\n    boost-program_options \\\n    boost-system \\\n    boost-unit_test_framework \\\n    boost-math \\\n    boost-doc \\\n    boost-wserialization \\\n    boost-date_time \\\n    boost-wave \\\n    boost-filesystem \\\n    boost-prg_exec_monitor \\\n    boost-regex \\\n    boost-thread\n\nCOPY --from=build /usr/lib/ruby/vendor_ruby /usr/lib/ruby/vendor_ruby\nCOPY --from=build /etc/puppetlabs /etc/puppetlabs\nCOPY --from=build /opt/puppetlabs /opt/puppetlabs\nCOPY --from=build /usr/lib/ruby/gems /usr/lib/ruby/gems\nCOPY --from=build /usr/lib/ruby/vendor_ruby /usr/lib/ruby/vendor_ruby\n\nENTRYPOINT [\"/opt/puppetlabs/bin/puppet\"]\nCMD [\"agent\", \"--verbose\", \"--onetime\", \"--no-daemonize\", \"--summarize\"]\n\nCOPY docker/puppet-agent-alpine/Dockerfile /\n"
}