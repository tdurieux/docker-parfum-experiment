{
  "startTime": 1674251240778,
  "endTime": 1674251240910,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 16,
        "lineEnd": 16,
        "columnStart": 4,
        "columnEnd": 57
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\nFROM prestodb/cdh5.15-hive:unlabelled\nMAINTAINER Presto community <https://prestodb.io/community.html>\n\n# INSTALL KERBEROS\nRUN yum install -y krb5-libs krb5-server krb5-workstation && rm -rf /var/cache/yum\n\n# COPY CONFIGURATION\nCOPY ./files /\n\n# CREATE KERBEROS DATABASE\nRUN /usr/sbin/kdb5_util create -s -P password\n\n# ADD HADOOP PRINCIPALS\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey hdfs/hadoop-master@LABS.TERADATA.COM\" \\\n  && /usr/sbin/kadmin.local -q \"addprinc -randkey mapred/hadoop-master@LABS.TERADATA.COM\" \\\n  && /usr/sbin/kadmin.local -q \"addprinc -randkey yarn/hadoop-master@LABS.TERADATA.COM\" \\\n  && /usr/sbin/kadmin.local -q \"addprinc -randkey HTTP/hadoop-master@LABS.TERADATA.COM\"\n\n# CREATE HADOOP KEYTAB FILES\nRUN /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/hadoop/conf/hdfs.keytab hdfs/hadoop-master HTTP/hadoop-master\" \\\n  && /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/hadoop/conf/mapred.keytab mapred/hadoop-master HTTP/hadoop-master\" \\\n  && /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/hadoop/conf/yarn.keytab yarn/hadoop-master HTTP/hadoop-master\" \\\n  && /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/hadoop/conf/HTTP.keytab HTTP/hadoop-master\"\nRUN chown hdfs:hadoop /etc/hadoop/conf/hdfs.keytab \\\n  && chown mapred:hadoop /etc/hadoop/conf/mapred.keytab \\\n  && chown yarn:hadoop /etc/hadoop/conf/yarn.keytab \\\n  && chown hdfs:hadoop /etc/hadoop/conf/HTTP.keytab \\\n  && chmod 644 /etc/hadoop/conf/*.keytab\n\n# CREATE HIVE PRINCIPAL AND KEYTAB\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey hive/hadoop-master@LABS.TERADATA.COM\" \\\n  && /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/hive/conf/hive.keytab hive/hadoop-master\"\nRUN chown hive:hadoop /etc/hive/conf/hive.keytab \\\n  && chmod 644 /etc/hive/conf/hive.keytab\n\n# YARN SECURITY SETTINGS\nRUN chmod 6050 /etc/hadoop/conf/container-executor.cfg\n\n# CREATE PRESTO PRINCIPAL AND KEYTAB\nRUN /usr/sbin/kadmin.local -q \"addprinc -randkey presto-server/presto-master.docker.cluster@LABS.TERADATA.COM\" \\\n  && /usr/sbin/kadmin.local -q \"addprinc -randkey presto-server/presto-worker.docker.cluster@LABS.TERADATA.COM\" \\\n  && /usr/sbin/kadmin.local -q \"addprinc -randkey presto-server/presto-worker-1.docker.cluster@LABS.TERADATA.COM\" \\\n  && /usr/sbin/kadmin.local -q \"addprinc -randkey presto-server/presto-worker-2.docker.cluster@LABS.TERADATA.COM\" \\\n  && /usr/sbin/kadmin.local -q \"addprinc -randkey HTTP/presto-master.docker.cluster@LABS.TERADATA.COM\" \\\n  && /usr/sbin/kadmin.local -q \"addprinc -randkey presto-client/presto-master.docker.cluster@LABS.TERADATA.COM\" \\\n  && /usr/sbin/kadmin.local -q \"addprinc -randkey hive/presto-master.docker.cluster@LABS.TERADATA.COM\" \\\n  && mkdir -p /etc/presto/conf \\\n  && /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/presto/conf/presto-server.keytab presto-server/presto-master.docker.cluster presto-server/presto-worker.docker.cluster presto-server/presto-worker-1.docker.cluster presto-server/presto-worker-2.docker.cluster\" \\\n  && /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/presto/conf/presto-server-HTTP.keytab HTTP/presto-master.docker.cluster\" \\\n  && /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/presto/conf/presto-client.keytab presto-client/presto-master.docker.cluster\" \\\n  && /usr/sbin/kadmin.local -q \"xst -norandkey -k /etc/presto/conf/hive-presto-master.keytab hive/presto-master.docker.cluster\"\nRUN chmod 644 /etc/presto/conf/*.keytab\n\n# CREATE SSL KEYSTORE\nRUN keytool -genkeypair \\\n    -alias presto \\\n    -keyalg RSA \\\n    -keystore /etc/presto/conf/keystore.jks \\\n    -keypass password \\\n    -storepass password \\\n    -dname \"CN=presto-master, OU=, O=, L=, S=, C=\" \\\n    -validity 100000\nRUN chmod 644 /etc/presto/conf/keystore.jks\n\n# EXPOSE KERBEROS PORTS\nEXPOSE\t88\nEXPOSE\t749\n\nCMD supervisord -c /etc/supervisord.conf\n"
}