{
  "startTime": 1674249561908,
  "endTime": 1674249562305,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 11,
        "columnEnd": 37
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 41,
        "lineEnd": 54,
        "columnStart": 11,
        "columnEnd": 33
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Usage:\n#\n# docker build --force-rm -t zabbix-server .\n# docker run -d --name zabbix-server -h zabbix-server -p 10051:10051 zabbix-server\n#\n#\nFROM  alpine:3.4\nLABEL maintainer=\"phithon <root@leavesongs.com>\"\n\nARG APK_FLAGS_COMMON=\"-q\"\nARG APK_FLAGS_PERSISTANT=\"${APK_FLAGS_COMMON} --clean-protected --no-cache\"\nARG APK_FLAGS_DEV=\"${APK_FLAGS_COMMON} --no-cache\"\nARG         ZBX_SOURCES=\"http://sourceforge.net/projects/zabbix/files/ZABBIX%20Latest%20Stable/3.0.3/zabbix-3.0.3.tar.gz/download\"\n\nENV LANG=en_US.UTF-8 \\\n        TERM=xterm \\\n        ZBX_SOURCES=${ZBX_SOURCES} \\\n        ZBX_SRV_PORT=10051 \\\n        ZBX_SRV_HOST=127.0.0.1,172.17.0.1 \\\n        ZBX_SRV_HOST_ACT= \\\n        ZBX_AGT_NUM=3 \\\n        ZBX_AGT_PORT=10050 \\\n        MIBDIRS=/var/lib/zabbix/mibs \\\n        MIBS=+ALL \\\n        DB_TYPE=mysql\n\nRUN apk update \\\n        && apk add ${APK_FLAGS_PERSISTANT} bash mariadb-client-libs \\\n        mariadb-client fping libxml2 unixodbc net-snmp-agent-libs libldap libcurl openipmi-libs libssh2 \\\n        && addgroup zabbix \\\n        && adduser -S -D -G zabbix -h /var/lib/zabbix/ zabbix \\\n        && mkdir -p /etc/zabbix/zabbix_agentd.conf.d /etc/zabbix/zabbix_server.conf.d /var/log/zabbix /var/run/zabbix/ /var/lib/zabbix/enc /var/lib/zabbix/modules /var/lib/zabbix/externalscripts /var/lib/zabbix/alertscripts /var/lib/zabbix/mibs /var/lib/zabbix/snmptraps /var/lib/zabbix/ssh_keys /var/lib/zabbix/ssl/certs /var/lib/zabbix/ssl/keys /var/lib/zabbix/ssl/ssl_ca  \\\n        && chown -R zabbix:root /var/lib/zabbix /var/run/zabbix /var/log/zabbix \\\n        && rm -rf /var/cache/apk/*\n\nRUN apk add ${APK_FLAGS_DEV} --virtual build-deps tzdata alpine-sdk coreutils automake autoconf mysql-dev libxml2-dev unixodbc-dev net-snmp-dev libssh2-dev openipmi-dev openldap-dev curl-dev openssl-dev \\\n        && rm -f /etc/localtime && ln -s /usr/share/zoneinfo/UTC /etc/localtime \\\n        && cd /tmp/ \\\n        && mkdir -p /tmp/zabbix \\\n        && curl -f -#SL \"${ZBX_SOURCES}\" | tar -xz -C /tmp/zabbix --strip-components 1 \\\n        && cd /tmp/zabbix \\\n        && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=/usr --silent --sysconfdir=/etc/zabbix --libdir=/usr/lib/zabbix \\\n                --enable-server \\\n                --enable-agent \\\n#                    --enable-static \\\n#                    --enable-ipv6 \\\n                --with-ldap \\\n                --with-net-snmp \\\n                --with-openipmi \\\n                --with-ssh2 \\\n                --with-libcurl \\\n                --with-unixodbc \\\n                --with-libxml2 \\\n                --with-openssl \\\n                --with-${DB_TYPE} \\\n        && make -j\"$(nproc)\" -s 1>/dev/null \\\n        && cp src/zabbix_get/zabbix_get /usr/sbin/ \\\n        && cp src/zabbix_server/zabbix_server /usr/sbin/ \\\n        && cp conf/zabbix_server.conf /etc/zabbix/ \\\n        && cp src/zabbix_agent/zabbix_agentd /usr/sbin/ \\\n        && cp conf/zabbix_agentd.conf /etc/zabbix/ \\\n        && cp /usr/share/snmp/mibs/* ${MIBDIRS}/ \\\n        && chown -R zabbix:root /etc/zabbix /var/lib/zabbix/ \\\n        && sed -e \"s/.*\\(PidFile=\\).*/\\1\\/var\\/run\\/zabbix\\/zabbix_server.pid/g\" \\\n                -e \"s/^\\(LogFile=\\).*/\\1\\/var\\/log\\/zabbix\\/zabbix_server.log/g\" \\\n                -e \"s/^#\\(FpingLocation=.*\\)/\\1/g\" \\\n                -e \"s/^# \\(LoadModulePath=\\)$/\\1\\/usr\\/lib\\/zabbix\\/modules/g\" \\\n                -e \"s/^# \\(Include=\\)$/\\1\\/etc\\/zabbix\\/zabbix_server.conf.d\\/*\\.conf/g\" -i /etc/zabbix/zabbix_server.conf \\\n        && sed -e \"s/.*\\(PidFile=\\).*/\\1\\/var\\/run\\/zabbix\\/zabbix_agentd.pid/g\" \\\n                -e \"s/^\\(LogFile=\\).*/\\1\\/var\\/log\\/zabbix\\/zabbix_agentd.log/g\" \\\n                -e \"s/^# \\(LoadModulePath=\\)$/\\1\\/usr\\/lib\\/zabbix\\/modules/g\" \\\n                -e \"s/^# \\(Include=\\)$/\\1\\/etc\\/zabbix\\/zabbix_agentd.conf.d\\/*\\.conf/g\" -i /etc/zabbix/zabbix_agentd.conf \\\n        && chmod 4770 /usr/sbin/fping \\\n        && chmod ug+s /usr/sbin/fping \\\n        && chown root:zabbix /usr/sbin/fping \\\n        && apk del ${APK_FLAGS_COMMON} --purge build-deps \\\n        && rm -rf /var/cache/apk/* /tmp/zabbix/\n\nADD docker-entrypoint.sh /\n\nEXPOSE 10051/TCP 162/UDP\nENTRYPOINT [\"/docker-entrypoint.sh\"]\n\nHEALTHCHECK --interval=15s --timeout=3s --retries=3 CMD nc -vz localhost 10051 || exit 1"
}