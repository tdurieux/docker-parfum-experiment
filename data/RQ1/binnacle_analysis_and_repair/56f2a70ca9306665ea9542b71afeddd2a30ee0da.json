{
  "startTime": 1674252102638,
  "endTime": 1674252102981,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 83,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 62
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 107,
        "lineEnd": 107,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 111,
        "lineEnd": 111,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 112,
        "lineEnd": 112,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 113,
        "lineEnd": 113,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 114,
        "lineEnd": 114,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 115,
        "lineEnd": 115,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 64,
        "lineEnd": 66,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 246
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 96,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 95
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 102,
        "lineEnd": 102,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 246
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 64,
        "lineEnd": 66,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 246
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 96,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 95
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 102,
        "lineEnd": 102,
        "columnStart": 4,
        "columnEnd": 35
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 94,
        "lineEnd": 94,
        "columnStart": 4,
        "columnEnd": 269
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 96,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 118
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 102,
        "lineEnd": 102,
        "columnStart": 4,
        "columnEnd": 59
      }
    }
  ],
  "repairedDockerfile": "# Dockerfile for building general development\n# environment for Data Science Analytics\n# customized for TVB Big Data Team\nFROM ubuntu:16.04\nLABEL maintainer \"michaelchan_wahyan@yahoo.com.hk\"\n\nENV SHELL=/bin/bash \\\n    TZ=Asia/Hong_Kong \\\n    PYTHONIOENCODING=UTF-8 \\\n    AIRFLOW_HOME=/opt/airflow \\\n    AIRFLOW_GPL_UNIDECODE=yes \\\n    CLOUD_SDK_REPO=\"cloud-sdk-xenial\" \\\n    HADOOP_COMMON_HOME=/hadoop-2.7.7 \\\n    HADOOP_HDFS_HOME=/hadoop-2.7.7 \\\n    HADOOP_HOME=/hadoop-2.7.7 \\\n    HADOOP_CONF_DIR=/hadoop-2.7.7/etc/hadoop \\\n    HADOOP_COMMON_LIB_NATIVE_DIR=/hadoop-2.7.7/lib/native \\\n    HADOOP_INSTALL=/hadoop-2.7.7 \\\n    HADOOP_MAPRED_HOME=/hadoop-2.7.7 \\\n    JAVA_HOME=/jdk1.8.0_171 \\\n    PYSPARK_DRIVER_PYTHON=\"jupyter\" \\\n    PYSPARK_DRIVER_PYTHON_OPTS=\"notebook\" \\\n    PYSPARK_PYTHON=python3 \\\n    SPARK_HOME=/spark-2.4.0-bin-hadoop2.7 \\\n    SPARK_PATH=/spark-2.4.0-bin-hadoop2.7 \\\n    YARN_HOME=/hadoop-2.7.7 \\\n    PATH=$PATH:/root/anaconda/bin:/bin:/usr/local/sbin:/usr/local/bin:/usr/local/lib:/usr/lib:/usr/sbin:/usr/bin:/sbin:/bin:/hadoop-2.7.7/sbin:/hadoop-2.7.7/bin\n\n# ========================\n# Jupyter Lab installation\n# ========================\n# ref : https://github.com/mikebirdgeneau/jupyterlab-docker/blob/master/jupyterlab/Dockerfile\n# for pip3 installation on jupyterlab related packages :\n# ipywidgets   nbextension   jupyterlab\n\n# ==================\n# SPARK installation\n# ==================\n# ref : https://medium.com/@GalarnykMichael/install-spark-on-ubuntu-pyspark-231c45677de0\n# SPARK installation - Part 1 (conda)\n# SPARK installation - Part 2 (spark)\n# SPARK installation - Part 3 (jdk 8.171)\n# SPARK installation - Part 4 (hadoop 2.7.6)\n\n# =============================\n# Google Cloud SDK installation\n# =============================\n# ref : https://cloud.google.com/sdk/docs/quickstart-debian-ubuntu\n#    many more gcloud packages that could be installed\n#    google-cloud-sdk-app-engine-python\n#    google-cloud-sdk-app-engine-python-extras\n#    google-cloud-sdk-app-engine-java\n#    google-cloud-sdk-app-engine-go\n#    google-cloud-sdk-datalab\n#    google-cloud-sdk-datastore-emulator\n#    google-cloud-sdk-pubsub-emulator\n#    google-cloud-sdk-cbt\n#    google-cloud-sdk-bigtable-emulator\n#    kubectl\n\nCOPY [ \"jdk-8u171-linux-x64.tar.gz\" , \"/\" ]\n\nRUN apt-get -y update ; \\\n    apt-get -y upgrade ; \\\n    apt-get -y --no-install-recommends install screen apt-utils cmake htop wget vim nano curl git \\\n               software-properties-common apt-transport-https net-tools wget \\\n               cowsay fortune sl; rm -rf /var/lib/apt/lists/*; \\\n    add-apt-repository 'deb [arch=amd64,i386] https://cran.rstudio.com/bin/linux/ubuntu xenial/' ; \\\n    apt-get -y update ; \\\n    add-apt-repository ppa:jonathonf/python-3.6 ; \\\n    apt-get -y update ; \\\n    apt-key adv --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9 ; \\\n    apt-get -y update ; \\\n    tar  -zxvf jdk-8u171-linux-x64.tar.gz ; \\\n    rm   -f    jdk-8u171-linux-x64.tar.gz ; \\\n    wget https://archive.apache.org/dist/spark/spark-2.4.0/spark-2.4.0-bin-hadoop2.7.tgz ; \\\n    tar  -zxvf spark-2.4.0-bin-hadoop2.7.tgz ; \\\n    rm   -f    spark-2.4.0-bin-hadoop2.7.tgz ; \\\n    wget https://archive.apache.org/dist/hadoop/core/hadoop-2.7.7/hadoop-2.7.7.tar.gz ; \\\n    tar  -zxvf hadoop-2.7.7.tar.gz ; \\\n    rm   -f    hadoop-2.7.7.tar.gz ; \\\n    mkdir /gcs-connector-hadoop ; \\\n    echo \"deb https://packages.cloud.google.com/apt $CLOUD_SDK_REPO main\" | tee -a /etc/apt/sources.list.d/google-cloud-sdk.list ; \\\n    curl -f https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -; \\\n    apt-get -y update ; \\\n    apt-get -y --no-install-recommends install google-cloud-sdk; \\\n    wget https://storage.googleapis.com/hadoop-lib/gcs/gcs-connector-latest-hadoop2.jar ; \\\n    mv   gcs-connector-latest-hadoop2.jar       /gcs-connector-hadoop/ ; \\\n    echo export     HADOOP_CLASSPATH=/gcs-connector-hadoop/gcs-connector-latest-hadoop2.jar >> /hadoop-2.7.7/etc/hadoop/hadoop-env.sh ; \\\n    echo spark.driver.extraClassPath /gcs-connector-hadoop/gcs-connector-latest-hadoop2.jar >> $SPARK_HOME/conf/spark-defaults.conf ; \\\n    echo spark.driver.memory                    5g                                          >> $SPARK_HOME/conf/spark-defaults.conf ; \\\n    echo spark.driver.maxResultSize             5g                                          >> $SPARK_HOME/conf/spark-defaults.conf ; \\\n    echo spark.driver.allowMultipleContexts     True                                        >> $SPARK_HOME/conf/spark-defaults.conf\n\nRUN apt-get -y --no-install-recommends install libcurl4-openssl-dev libssl-dev libeigen3-dev libgmp-dev libgmpxx4ldbl libmpfr-dev libboost-dev libboost-thread-dev libtbb-dev libeigen3-dev libgmp-dev libgmpxx4ldbl libmpfr-dev libboost-dev libboost-thread-dev libtbb-dev; rm -rf /var/lib/apt/lists/*; \\\n    apt-get -y update ; \\\n    apt-get -y --no-install-recommends install r-base bc npm ca-certificates musl-dev gcc make g++ gfortran python3.6; \\\n    curl -f https://bootstrap.pypa.io/get-pip.py | python3.6; \\\n    rm -f /usr/bin/python3  && ln -s /usr/bin/python3.6  /usr/bin/python3 ; \\\n    rm -f /usr/bin/python3m && ln -s /usr/bin/python3.6m /usr/bin/python3m ; \\\n    apt-get -y --no-install-recommends install python3.6-dev; \\\n    apt-get -y upgrade ; \\\n    apt-get -y --no-install-recommends install python3.6-tk\n\n# jupyter(lab) related python packages are\n# required before installing interactive R kernel\nCOPY [ \"requirements0.txt\" , \"requirements1.txt\" , \"requirements2.txt\" , \"requirements3.txt\" , \"requirements4.txt\" , \"requirements5.txt\" , \"/\" ]\nRUN pip3 install --no-cache-dir -r requirements0.txt; \\\n    R -e 'install.packages(c(\"devtools\", \"bayesAB\", \"plyr\", \"dplyr\", \"data.table\", \"bigrquery\", \"pwr\", \"cowsay\", \"fortunes\", \"progress\", \"ggplot2\", \"forecast\"))' ; \\\n    R -e 'devtools::install_github(\"IRkernel/IRkernel\")' ; \\\n    R -e 'IRkernel::installspec()' ; \\\n    pip3 install --no-cache-dir -r requirements1.txt; \\\n    pip3 install --no-cache-dir -r requirements2.txt; \\\n    pip3 install --no-cache-dir -r requirements3.txt; \\\n    pip3 install --no-cache-dir -r requirements4.txt; \\\n    pip3 install --no-cache-dir -r requirements5.txt\n\nRUN jupyter nbextension enable --py widgetsnbextension ;\\\n    jupyter serverextension enable --py jupyterlab\n    #jupyter labextension install @jupyterlab/latex\n\n# info to hadoop                 <-- HADOOP_CLASSPATH\n# info to spark                  <-- spark.driver.extraClassPath\n# max mem consumed per core      <-- spark.driver.memory\n# prevent rdd.collect() exceed   <-- spark.driver.maxResultSize\n# RUN pip3 install git+https://github.com/michaelchanwahyan/nbparameterise.git\n\n\nCOPY [ \".bashrc\" , \".vimrc\"               , \"/root/\"                 ]\nCOPY [ \"core-site.xml\"                    , \"$HADOOP_CONF_DIR\"       ]\nCOPY [ \"app_template\"                     , \"/\"                      ]\nCOPY [ \"airflow\"                          , \"/opt/airflow\"           ]\n\nEXPOSE 9090 9999\nCMD [ \"/bin/bash\" ]\n"
}