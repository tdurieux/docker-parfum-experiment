{
  "startTime": 1674243117106,
  "endTime": 1674243117758,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 42,
        "lineEnd": 42,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 90
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 29,
        "lineEnd": 29,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 14,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 67
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 45,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 59,
        "lineEnd": 59,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 64,
        "lineEnd": 64,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 90,
        "lineEnd": 90,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 14,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 67
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 45,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 59,
        "lineEnd": 59,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 64,
        "lineEnd": 64,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 90,
        "lineEnd": 90,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 14,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 67
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 45,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 59,
        "lineEnd": 59,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 36
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 64,
        "lineEnd": 64,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 90,
        "lineEnd": 90,
        "columnStart": 4,
        "columnEnd": 32
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 14,
        "lineEnd": 18,
        "columnStart": 4,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 4,
        "columnEnd": 91
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 45,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 59,
        "lineEnd": 59,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 60
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 64,
        "lineEnd": 64,
        "columnStart": 4,
        "columnEnd": 82
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 90,
        "lineEnd": 90,
        "columnStart": 4,
        "columnEnd": 56
      }
    }
  ],
  "repairedDockerfile": "FROM ubuntu:16.04\nENV workdir /var/www\n\n# Production OSM setup\nENV RAILS_ENV=production\n\n# Postgres dependecies\nRUN apt-get update\nRUN apt-get install --no-install-recommends -y wget && rm -rf /var/lib/apt/lists/*;\nRUN wget -q https://www.postgresql.org/media/keys/ACCC4CF8.asc -O - | apt-key add -\nRUN sh -c 'echo \"deb http://apt.postgresql.org/pub/repos/apt/ xenial-pgdg main\" >> /etc/apt/sources.list.d/pgdg.list'\nRUN apt-get update\n\n# Install the openstreetmap-website dependencies and passenger dependencies\nRUN apt-get install --no-install-recommends -y ruby2.3 libruby2.3 ruby2.3-dev \\\n    libmagickwand-dev libxml2-dev libxslt1-dev \\\n    apache2 apache2-dev build-essential git \\\n    postgresql postgresql-contrib libpq-dev \\\n    libsasl2-dev imagemagick libffi-dev curl && rm -rf /var/lib/apt/lists/*;\nRUN gem2.3 install bundler\n\n# Install node for some images process dependencies\nRUN curl -f -sL https://deb.nodesource.com/setup_8.x | bash -\nRUN apt-get install --no-install-recommends -y nodejs && rm -rf /var/lib/apt/lists/*;\n\n# Fixing image_optim issues, installing a bush of libraries from : https://github.com/toy/image_optim#pngout-installation-optional\nRUN apt-get install --no-install-recommends -y advancecomp gifsicle jhead jpegoptim optipng && rm -rf /var/lib/apt/lists/*;\nRUN git clone --recursive https://github.com/kornelski/pngquant.git && \\\n    cd pngquant && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" && \\\n    make && \\\n    make install\nRUN git clone https://github.com/tjko/jpeginfo.git && \\\n    cd jpeginfo && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" && \\\n    make && \\\n    make strip && \\\n    make install\nRUN wget https://iweb.dl.sourceforge.net/project/pmt/pngcrush/1.8.12/pngcrush-1.8.12.tar.gz && \\\n    tar zxf pngcrush-1.8.12.tar.gz && \\\n    cd pngcrush-1.8.12 && \\\n    make && cp -f pngcrush /usr/local/bin && rm pngcrush-1.8.12.tar.gz\nRUN npm install -g svgo && npm cache clean --force;\n\n# Install openstreetmap-cgimap\nRUN apt-get install --no-install-recommends -y libxml2-dev libpqxx-dev libfcgi-dev \\\n    libboost-dev libboost-regex-dev libboost-program-options-dev \\\n    libboost-date-time-dev libboost-filesystem-dev \\\n    libboost-system-dev libboost-locale-dev libmemcached-dev \\\n    libcrypto++-dev automake autoconf libtool libyajl-dev && rm -rf /var/lib/apt/lists/*;\nENV cgimap /tmp/openstreetmap-cgimap\nRUN git clone git://github.com/zerebubuth/openstreetmap-cgimap.git $cgimap\nRUN cd $cgimap &&\\\n    ./autogen.sh && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" && \\\n    make && \\\n    make install\n\n# Daemontools provides the `fghack` program required for running the `cgimap`\nRUN apt-get install --no-install-recommends -y daemontools && rm -rf /var/lib/apt/lists/*;\n\n# Install the PGP key and add HTTPS support for APT\nRUN apt-get install --no-install-recommends -y dirmngr gnupg && rm -rf /var/lib/apt/lists/*;\nRUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys 561F9B9CAC40B2F7\nRUN apt-get install --no-install-recommends -y apt-transport-https ca-certificates && rm -rf /var/lib/apt/lists/*;\n\n# Add the APT repository\nRUN sh -c 'echo deb https://oss-binaries.phusionpassenger.com/apt/passenger xenial main > /etc/apt/sources.list.d/passenger.list'\nRUN apt-get update\n\n# Install Passenger + Apache module\nRUN apt-get install --no-install-recommends -y libapache2-mod-passenger && rm -rf /var/lib/apt/lists/*;\n\n# Enable the Passenger Apache module and restart Apache\nRUN echo \"ServerName $(cat /etc/hostname)\" >> /etc/apache2/apache2.conf\nRUN a2enmod passenger\nRUN apache2ctl restart\n\n# Check installation\nRUN /usr/bin/passenger-config validate-install\nRUN /usr/sbin/passenger-memory-stats\n\n# Clone the openstreetmap-website\nRUN rm -rf $workdir\nRUN git clone https://github.com/openstreetmap/openstreetmap-website.git $workdir\nWORKDIR $workdir\n# gitsha 39f0b501e8cefea961447de9c8076e20fa3adbb4 at Jul 23, 2018\nRUN git checkout 39f0b501e8cefea961447de9c8076e20fa3adbb4\n\n# Install the javascript runtime required by the `execjs` gem in\nRUN apt-get install --no-install-recommends -y libv8-dev && rm -rf /var/lib/apt/lists/*;\nRUN echo \"gem 'therubyracer'\" >> Gemfile\n\n# Install app dependencies\nRUN bundle update listen && bundle install\n\n# Configure database.yml, application.yml and secrets.yml\nADD config/database.yml $workdir/config/database.yml\nADD config/application.yml $workdir/config/application.yml\nRUN echo \"#session key \\n\\\nproduction: \\n\\\n  secret_key_base: $(bundle exec rake secret)\" > $workdir/config/secrets.yml\n\n# Protect sensitive information\nRUN chmod 600 $workdir/config/database.yml $workdir/config/application.yml $workdir/config/secrets.yml\n\n# Configure ActionMailer SMTP settings, Replace config/initializers/action_mailer.rb with out configurations\nADD config/action_mailer.rb config/initializers/action_mailer.rb\n\n# Precompile the website assets\nRUN bundle exec rake assets:precompile --trace\n\n# The rack interface requires a `tmp` directory to use openstreetmap-cgimap\nRUN ln -s /tmp /var/www/tmp\n\n# Add Apache configuration file\nADD config/production.conf /etc/apache2/sites-available/production.conf\nRUN a2dissite 000-default\nRUN a2ensite production\n\n# Enable required apache modules for the cgimap Apache service\nRUN a2enmod proxy proxy_http rewrite\n\n# Config the virtual host apache2\nADD config/cgimap.conf /tmp/\nRUN sed -e 's/RewriteRule ^(.*)/#RewriteRule ^(.*)/' \\\n        -e 's/\\/var\\/www/\\/var\\/www\\/public/g' \\\n        /tmp/cgimap.conf > /etc/apache2/sites-available/cgimap.conf\nRUN chmod 644 /etc/apache2/sites-available/cgimap.conf\nRUN a2ensite cgimap\nRUN apache2ctl configtest\n\n# Set Permissions for www-data\nRUN chown -R www-data: /var/www\n\n# Script to start the app\nADD start.sh $workdir/start.sh\n\nCMD $workdir/start.sh"
}