{
  "startTime": 1674241192360,
  "endTime": 1674241192813,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 27,
        "columnEnd": 160
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 7,
        "lineEnd": 7,
        "columnStart": 26,
        "columnEnd": 86
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Copied  from https://github.com/adelton/docker-freeipa/Dockerfile.centos-7  (23ae0a2)\n# Clone from the CentOS 7\nFROM centos:centos7\n\nMAINTAINER Mesosphere support@mesosphere.io\n\nRUN cd /etc/yum.repos.d && curl -f -LO https://copr.fedorainfracloud.org/coprs/g/freeipa/freeipa-4-3-centos-7/repo/epel-7/pvoborni-freeipa-4-3-centos-7-epel-7.repo\nRUN mkdir -p /run/lock && yum install -y ipa-server ipa-server-dns ipa-server-trust-ad && yum clean all && rm -rf /var/cache/yum\n\nRUN echo '7fe9c3084d2b8ba846c23458be86c8677693f0eb /etc/tmpfiles.d/opendnssec.conf' | sha1sum --quiet -c && mv -v /etc/tmpfiles.d/opendnssec.conf /usr/lib/tmpfiles.d/opendnssec.conf\nRUN echo '5a70f1f3db0608c156d5b6629d4cbc3b304fc045 /etc/systemd/system/sssd.service.d/journal.conf' | sha1sum --quiet -c && rm -vf /etc/systemd/system/sssd.service.d/journal.conf\nRUN find /etc/systemd/system/* '!' -name '*.wants' | xargs rm -rvf\nRUN for i in basic.target sysinit.target network.service netconsole.service ; do rm -f /usr/lib/systemd/system/$i && ln -s /dev/null /usr/lib/systemd/system/$i ; done\n\nRUN echo LANG=C > /etc/locale.conf\n\nRUN /sbin/ldconfig -X\n\nCOPY assets/init-data assets/ipa-server-configure-first assets/ipa-server-status-check assets/exit-with-status assets/ipa-volume-upgrade-* /usr/sbin/\nCOPY assets/install.sh assets/uninstall.sh /bin/\nRUN chmod -v +x /usr/sbin/init-data /usr/sbin/ipa-server-configure-first /usr/sbin/ipa-server-status-check /usr/sbin/exit-with-status /usr/sbin/ipa-volume-upgrade-* /bin/install.sh /bin/uninstall.sh\nCOPY assets/container-ipa.target assets/ipa-server-configure-first.service assets/ipa-server-upgrade.service assets/ipa-server-update-self-ip-address.service assets/kill-tail.service /usr/lib/systemd/system/\nRUN rmdir -v /etc/systemd/system/multi-user.target.wants \\\n\t&& mkdir /etc/systemd/system/container-ipa.target.wants \\\n\t&& ln -s /etc/systemd/system/container-ipa.target.wants /etc/systemd/system/multi-user.target.wants\nRUN mkdir -p /usr/lib/systemd/system/shutdown.target.wants && ln -sf /usr/lib/systemd/system/kill-tail.service /usr/lib/systemd/system/shutdown.target.wants/kill-tail.service\n\nRUN systemctl set-default container-ipa.target\nRUN systemctl enable ipa-server-configure-first.service\n\nCOPY assets/exit-via-chroot.conf /usr/lib/systemd/system/systemd-poweroff.service.d/\n\nRUN groupadd -g 389 dirsrv ; useradd -u 389 -g 389 -c 'DS System User' -d '/var/lib/dirsrv' --no-create-home -s '/sbin/nologin' dirsrv\nRUN groupadd -g 288 kdcproxy ; useradd -u 288 -g 288 -c 'IPA KDC Proxy User' -d '/var/lib/kdcproxy' -s '/sbin/nologin' kdcproxy\n\nCOPY assets/atomic-install-help /usr/share/ipa/\nCOPY assets/volume-data-list assets/volume-data-mv-list assets/volume-data-autoupdate /etc/\nRUN set -e ; cd / ; mkdir /data-template ; cat /etc/volume-data-list | while read i ; do echo $i ; if [ -e $i ] ; then tar cf - .$i | ( cd /data-template && tar xf - ) ; fi ; mkdir -p $( dirname $i ) ; if [ \"$i\" == /var/log/ ] ; then mv /var/log /var/log-removed ; else rm -rf $i ; fi ; ln -sf /data${i%/} ${i%/} ; done\nRUN rm -rf /var/log-removed\nRUN sed -i 's!^d /var/log.*!L /var/log - - - - /data/var/log!' /usr/lib/tmpfiles.d/var.conf\nRUN mv /data-template/etc/dirsrv/schema /usr/share/dirsrv/schema && ln -s /usr/share/dirsrv/schema /data-template/etc/dirsrv/schema\nRUN rm -f /data-template/var/lib/systemd/random-seed\nRUN echo 1.1 > /etc/volume-version\n\nRUN for i in /usr/lib/systemd/system/*-domainname.service ; do sed -i 's#^ExecStart=/#ExecStart=-/#' $i ; done\n\nRUN sed -i 's/^UUID=/# UUID=/' /etc/fstab\n\nENV container docker\n\nEXPOSE 53/udp 53 80 443 389 636 88 464 88/udp 464/udp 123/udp 7389 9443 9444 9445\n\nVOLUME [ \"/tmp\", \"/run\", \"/data\" ]\n\nSTOPSIGNAL RTMIN+3\nENTRYPOINT [ \"/usr/sbin/init-data\" ]\nRUN uuidgen > /data-template/build-id\n\n# Invocation:\n# docker run -ti -v /sys/fs/cgroup:/sys/fs/cgroup:ro --tmpfs /run --tmpfs /tmp -v /opt/ipa-data:/data:Z -h ipa.example.test ${NAME} [ options ]\n\n# For atomic, we run INSTALL --privileged but install.sh will start another unprivileged container.\n# We do it this way to be able to set hostname for the unprivileged container.\nLABEL INSTALL 'docker run -ti --rm --privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} -e NAME=${NAME} -e IMAGE=${IMAGE} ${IMAGE} /bin/install.sh'\nLABEL RUN 'docker run ${RUN_OPTS} --name ${NAME} -v /var/lib/${NAME}:/data:Z -v /sys/fs/cgroup:/sys/fs/cgroup:ro --tmpfs /run --tmpfs /tmp -v /dev/urandom:/dev/random:ro ${IMAGE}'\nLABEL RUN_OPTS_FILE '/var/lib/${NAME}/docker-run-opts'\nLABEL STOP 'docker stop ${NAME}'\nLABEL UNINSTALL 'docker run --rm --privileged -v /:/host -e HOST=/host -e DATADIR=/var/lib/${NAME} ${IMAGE} /bin/uninstall.sh'\n"
}