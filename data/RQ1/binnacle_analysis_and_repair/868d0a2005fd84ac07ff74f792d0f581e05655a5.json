{
  "startTime": 1674244627787,
  "endTime": 1674244628141,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 56,
        "lineEnd": 56,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 57,
        "lineEnd": 57,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 64,
        "lineEnd": 64,
        "columnStart": 4,
        "columnEnd": 48
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 67,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 8
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 22,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 67,
        "columnEnd": 105
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 88
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 22,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 22,
        "columnEnd": 68
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 67,
        "columnEnd": 105
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 27,
        "lineEnd": 27,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 88
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 22,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 4,
        "columnEnd": 58
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "############################################################\n# Dockerfile to build Nginx Amplify Agent with N+ container\n# Based on Ubuntu 14.04\n############################################################\n\n# Set the base image to Ubuntu\nFROM ubuntu:14.04\n\n# File Author / Maintainer\nMAINTAINER Mike Belov\n\nRUN echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections\nRUN apt-get update && apt-get install --no-install-recommends -y -q wget apt-transport-https \\\n && apt-get install --no-install-recommends -y -qq curl libcurl3 libcurl3-dev php5-curl && apt-get install --no-install-recommends -y -qq ca-certificates && rm -rf /var/lib/apt/lists/*;\n\n# Download certificate and key from the customer portal (https://cs.nginx.com)\n# and copy to the build context\nADD docker/test-plus/nginx-repo.crt /etc/ssl/nginx/\nADD docker/test-plus/nginx-repo.key /etc/ssl/nginx/\n\n# Get other files required for installation\nRUN wget -q -O - https://nginx.org/keys/nginx_signing.key | apt-key add -\nRUN wget -q -O /etc/apt/apt.conf.d/90nginx https://cs.nginx.com/static/files/90nginx\n\n# Install NGINX Plus and  basic applications\nRUN printf \"deb https://plus-pkgs.nginx.com/ubuntu `lsb_release -cs` nginx-plus\\n\" >/etc/apt/sources.list.d/nginx-plus.list \\\n && apt-get update \\\n && apt-get install --no-install-recommends -y nginx-plus \\\n && apt-get install --no-install-recommends -y --fix-missing tar curl nano wget dialog net-tools build-essential \\\n && cp /usr/sbin/nginx /usr/sbin/nginx2 && rm -rf /var/lib/apt/lists/*;\n\n# Instal mysql and prepare init file\nRUN groupadd -r mysql && useradd -r -g mysql mysql\nRUN apt-get update && apt-get install --no-install-recommends -y mysql-server-5.5 && rm -rf /var/lib/apt/lists/*;\nRUN echo \"SET PASSWORD FOR 'root'@'localhost' = PASSWORD('root');\" > /mysql.init\nRUN echo \"CREATE USER 'amplify-agent'@'localhost' IDENTIFIED BY 'amplify-agent';\" >> /mysql.init\n\n# Install php-fpm and configure\nRUN rm -rf /run \\\n && mkdir /run \\\n && apt-get update \\\n && apt-get install --no-install-recommends -y php5-fpm \\\n && mkdir /run/php/ && rm -rf /var/lib/apt/lists/*;\n\n# add fastcgi_params and php-fpm.conf for nginx\nADD docker/test-plus/fastcgi_params /etc/nginx/fastcgi_params\nADD docker/test-plus/php-fpm.conf /etc/nginx/conf.d/php-fpm.conf\n# overwrite default www.conf for php5.0-fpm and add second one\nADD docker/test-plus/php-fpm-www.conf /etc/php5/fpm/pool.d/www.conf\nADD docker/test-plus/php-fpm-www2.conf /etc/php5/fpm/pool.d/www2.conf\n# add test .php file to /var/www/php-fpm root\nADD docker/test-plus/test.php /var/www/php-fpm/test.php\n\n# Install Python and Basic Python Tools\nRUN apt-get update \\\n && apt-get install --no-install-recommends -y python python-dev python-distribute \\\n && curl -f https://bootstrap.pypa.io/get-pip.py | python - 'pip==18.1.0' \\\n && pip install --no-cache-dir supervisor && rm -rf /var/lib/apt/lists/*;\n\n# Copy the application folder inside the container\n#ADD . /amplify\nADD docker/test-plus/requirements.txt /etc/naas/requirements.txt\n\n# Install agent requirements:\nRUN pip install --no-cache-dir -I -r /etc/naas/requirements.txt\n\n# Install test requirements\nRUN pip install --no-cache-dir \\\n    pytest \\\n    pytest-xdist \\\n    pyhamcrest \\\n    requests_mock \\\n    timeout-decorator \\\n    freezegun \\\n    mock\n\nENV AMPLIFY_ENVIRONMENT testing\nENV PYTHONPATH /amplify\nENV PYTEST_ADDOPTS \"--ignore=test/unit/ext/controller\"\n\n# Set the default directory where CMD will execute\nWORKDIR /amplify\n\n# add config\nADD docker/test-plus/nginx.conf /etc/nginx/nginx.conf\nADD docker/test-plus/nginx2.conf /etc/nginx/nginx2.conf\nADD docker/test-plus/nginx_bad_status.conf /etc/nginx/nginx_bad_status.conf\nADD docker/test-plus/nginx_syslog.conf /etc/nginx/nginx_syslog.conf\nADD docker/test-plus/supervisord.conf /etc/supervisord.conf\nADD docker/test-plus/nginx_no_logs.conf /etc/nginx/nginx_no_logs.conf\n\n# add ssl\nADD docker/test-plus/amplify-agent-test.crt /etc/nginx/certs.d/amplify-agent-test.crt\nADD docker/test-plus/amplify-agent-test.key /etc/nginx/certs.d/amplify-agent-test.key\n\nRUN usermod -d /var/lib/mysql/ mysql\n\nCMD bash\n"
}