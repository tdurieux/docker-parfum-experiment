{
  "startTime": 1674246354167,
  "endTime": 1674246355147,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 75
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 79
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 70,
        "lineEnd": 70,
        "columnStart": 4,
        "columnEnd": 78
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 75,
        "lineEnd": 75,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 146,
        "lineEnd": 146,
        "columnStart": 29,
        "columnEnd": 54
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 146,
        "lineEnd": 146,
        "columnStart": 58,
        "columnEnd": 69
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 149,
        "lineEnd": 149,
        "columnStart": 36,
        "columnEnd": 47
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 157,
        "lineEnd": 157,
        "columnStart": 36,
        "columnEnd": 60
      }
    },
    {
      "rule": "npmCacheCleanUseForce",
      "position": {
        "lineStart": 80,
        "lineEnd": 80,
        "columnStart": 4,
        "columnEnd": 19
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 131,
        "lineEnd": 131,
        "columnStart": 4,
        "columnEnd": 21
      }
    },
    {
      "rule": "mkdirUsrSrcThenRemove",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 42,
        "lineEnd": 42,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "gpgVerifyAscRmAsc",
      "position": {
        "lineStart": 72,
        "lineEnd": 72,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 74,
        "lineEnd": 74,
        "columnStart": 4,
        "columnEnd": 80
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 32,
        "lineEnd": 32,
        "columnStart": 4,
        "columnEnd": 99
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 68,
        "lineEnd": 68,
        "columnStart": 4,
        "columnEnd": 137
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 72,
        "lineEnd": 72,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "gpgUseHaPools",
      "position": {
        "lineStart": 68,
        "lineEnd": 68,
        "columnStart": 4,
        "columnEnd": 137
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 22,
        "columnEnd": 76
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 22,
        "columnEnd": 126
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 138
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 9,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 9,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 130,
        "lineEnd": 130,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 138
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 9,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 9,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 130,
        "lineEnd": 130,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 14,
        "lineEnd": 14,
        "columnStart": 22,
        "columnEnd": 76
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 55,
        "lineEnd": 55,
        "columnStart": 22,
        "columnEnd": 126
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 138
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 9,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 9,
        "columnEnd": 50
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 130,
        "lineEnd": 130,
        "columnStart": 4,
        "columnEnd": 33
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 162
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 9,
        "columnEnd": 78
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 9,
        "columnEnd": 74
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 130,
        "lineEnd": 130,
        "columnStart": 4,
        "columnEnd": 57
      }
    }
  ],
  "repairedDockerfile": "#Required environment variables\n#eums.environment => name corresponding with the different settings files e.g. qa, snap, staging, test\n\n#  Base OS\nFROM ubuntu:14.04\nMAINTAINER eums <eums@thoughtworks.com>\n\n##############################################################################\n## Change policy\n##############################################################################\nRUN echo exit 0 > /usr/sbin/policy-rc.d\nRUN chmod +x /usr/sbin/policy-rc.d\n\nRUN export DEBIAN_FRONTEND=noninteractive\nRUN apt-get update && apt-get install --no-install-recommends -y wget curl build-essential libpq-dev && rm -rf /var/lib/apt/lists/*;\n\n##############################################################################\n## Python 2.7.9 Pre-requisites\n##############################################################################\n# remove several traces of debian python\nRUN apt-get purge -y python.*\n\n# http://bugs.python.org/issue19846\n# > At the moment, setting \"LANG=C\" on a Linux system *fundamentally breaks Python 3*, and that's not OK.\nENV LANG C.UTF-8\nENV LANGUAGE en_US\n\n#The properties below are not used as parameters to facilitate docker caching and faster builds\n#They have been left here more as doc so be sure to update them if you change the version\nENV PYTHON_VERSION 2.7.9\n\n# gpg: key 18ADD4FF: public key \"Benjamin Peterson <benjamin@python.org>\" imported\nRUN gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys C01E1CAD5EA2C4F0B8E3571504C367C218ADD4FF\n\nRUN set -x \\\n\t&& mkdir -p /usr/src/python \\\n\t&& curl -f -SLO \"https://www.python.org/ftp/python/2.7.9/Python-2.7.9.tar.xz\" \\\n\t&& curl -f -SLO \"https://www.python.org/ftp/python/2.7.9/Python-2.7.9.tar.xz.asc\" && rm -rf /usr/src/python\nRUN gpg --batch --verify Python-2.7.9.tar.xz.asc \\\n\t&& tar -xJC /usr/src/python --strip-components=1 -f Python-2.7.9.tar.xz \\\n\t&& rm Python-2.7.9.tar.xz* \\\n\t&& cd /usr/src/python \\\n\t&& ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --enable-shared --enable-unicode=ucs4 \\\n\t&& make -j$(nproc) \\\n\t&& make install \\\n\t&& ldconfig\nRUN curl -f -SL 'https://bootstrap.pypa.io/get-pip.py' | python2 \\\n\t&& find /usr/local \\\n\t\t\\( -type d -a -name test -o -name tests \\) \\\n\t\t-o \\( -type f -a -name '*.pyc' -o -name '*.pyo' \\) \\\n\t\t-exec rm -rf '{}' + \\\n\t&& rm -rf /usr/src/python\n\nRUN pip install --no-cache-dir virtualenv\n\nRUN apt-get update && apt-get install --no-install-recommends -y supervisor openssh-server postgresql postgresql-contrib nodejs nginx redis-server git && rm -rf /var/lib/apt/lists/*;\nRUN mkdir -p /var/lock/apache2 /var/run/apache2 /var/run/sshd /var/log/supervisor\n\nRUN echo \"root:password\" | chpasswd  # need a password for ssh\nRUN sed -i 's/PermitRootLogin without-password/PermitRootLogin yes/' /etc/ssh/sshd_config\n\n# SSH login fix. Otherwise user is kicked off after login\nRUN sed 's@session\\s*required\\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd\n\n##############################################################################\n## install NodeJS\n##############################################################################\n# verify gpg and sha256: http://nodejs.org/dist/v0.10.30/SHASUMS256.txt.asc\nRUN gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 7937DFD2AB06298B2293C3187D33FF9D0246406D 114F43EE0176B71C7BC219DD50A3051F888C628D\n\nRUN curl -f -SLO \"http://nodejs.org/dist/v0.10.21/node-v0.10.21-linux-x64.tar.gz\"\nRUN curl -f -SLO \"http://nodejs.org/dist/v0.10.21/SHASUMS256.txt.asc\"\nRUN gpg --batch --verify SHASUMS256.txt.asc && rm SHASUMS256.txt.asc\nRUN grep \" node-v0.10.21-linux-x64.tar.gz\\$\" SHASUMS256.txt.asc | sha256sum -c -\nRUN tar -xzf \"node-v0.10.21-linux-x64.tar.gz\" -C /usr/local --strip-components=1 && rm \"node-v0.10.21-linux-x64.tar.gz\"\nRUN curl -f -SLO \"http://nodejs.org/dist/v0.10.21/SHASUMS256.txt.asc\"\nRUN rm \"node-v0.10.21-linux-x64.tar.gz\" SHASUMS256.txt.asc\nRUN npm install -g npm@1.4.28 && npm cache clean --force;\nRUN npm install -g npm@\"1.3.11\" && npm cache clean --force;\nRUN npm install -g grunt-cli@0.1.13 && npm cache clean --force;\nRUN npm cache clear --force\n\n\n##############################################################################\n## install MongoDB\n##############################################################################\nRUN sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10\nRUN echo 'deb http://downloads-distro.mongodb.org/repo/ubuntu-upstart dist 10gen' | sudo tee /etc/apt/sources.list.d/mongodb.list\nRUN sudo apt-get update\nRUN apt-get install --no-install-recommends -y mongodb-org=2.6.5 mongodb-org-server=2.6.5 mongodb-org-shell=2.6.5 mongodb-org-mongos=2.6.5 mongodb-org-tools=2.6.5 && rm -rf /var/lib/apt/lists/*;\nENV LC_ALL C\n\n##############################################################################\n## install Elasticsearch\n##############################################################################\n# Install Java\nRUN sudo rm -fr /var/lib/apt/lists\nRUN sudo apt-get update\nRUN sudo apt-get install --no-install-recommends -y software-properties-common && rm -rf /var/lib/apt/lists/*;\nRUN sudo apt-add-repository ppa:webupd8team/java\nRUN sudo apt-get update\n\nRUN echo debconf shared/accepted-oracle-license-v1-1 select true | sudo debconf-set-selections\nRUN echo debconf shared/accepted-oracle-license-v1-1 seen true | sudo debconf-set-selections\n\nRUN sudo apt-get install --no-install-recommends -y oracle-java8-installer && rm -rf /var/lib/apt/lists/*;\n\n# Add elasticsearch repository to apt-get repositories\nRUN mkdir -p /opt/downloads\nRUN cd /opt/downloads && curl -SsfLO \"https://download.elasticsearch.org/elasticsearch/elasticsearch/elasticsearch-1.7.3.deb\"\n\n# Install Elasticsearch\nRUN dpkg -i /opt/downloads/elasticsearch-1.7.3.deb\n\n# Enable Cross-site Origin Requests to Elasticsearch\nRUN sudo echo 'http.cors.enabled : true' >> /etc/elasticsearch/elasticsearch.yml\n\n# Set MAX_MAP_COUNT configuration off. When on, an error is returned because docker is a readonly OS\nRUN sed -i '/sysctl -q -w vm.max_map_count/ s/^#*/true\\n#/' /etc/init.d/elasticsearch\n\n# Set elasticsearch to run with root user\nRUN sed -i '/^ES_USER=el/ s/^#*/true\\nES_USER=root\\n#/' /etc/init.d/elasticsearch\nRUN sed -i '/^ES_GROUP=el/ s/^#*/true\\nES_GROUP=root\\n#/' /etc/init.d/elasticsearch\n\n# Enable Elasticsearch service to start on boot\nRUN sudo update-rc.d elasticsearch defaults 95 10\n\n##############################################################################\n# Install UWSGI and config\n##############################################################################\nRUN apt-get install --no-install-recommends -y python-dev && rm -rf /var/lib/apt/lists/*;\nRUN pip install --no-cache-dir uwsgi\nCOPY ./eums/scripts/packaging/eums.uwsgi.ini /etc/uwsgi/sites/eums.uwsgi.ini\n\nCOPY ./eums/scripts/packaging/nginx.config /etc/nginx/nginx.conf\nCOPY ./eums/scripts/packaging/eums.nginx.config /etc/nginx/sites-available/eums\nRUN ln -sf /etc/nginx/sites-available/eums /etc/nginx/sites-enabled/eums\nRUN rm /etc/nginx/sites-enabled/default\n##############################################################################\n## Install dependenices\n##############################################################################\nCOPY ./eums/requirements.txt /opt/app/eums/requirements.txt\nRUN virtualenv ~/.virtualenvs/eums\nRUN /bin/bash -c \"source ~/.virtualenvs/eums/bin/activate && cd /opt/app/eums && pip install -r requirements.txt\"\n\nCOPY ./contacts/package.json /opt/app/contacts/package.json\nRUN cd /opt/app/contacts/ && npm install fibers@1.0.15 && npm install && npm cache clean --force;\n\nCOPY ./eums/eums/client/package.json /opt/app/eums/eums/client/package.json\nRUN cd /opt/app/eums/eums/client && npm install && npm cache clean --force;\n\n#RUN cd /opt/app/eums/eums/client && npm install -g bower\n#COPY ./eums/eums/client/bower.json /opt/app/eums/eums/client/bower.json\n#RUN cd /opt/app/eums/eums/client && bower install --allow-root\nADD ./eums/eums/client/bower_components /opt/app/eums/eums/client/bower_components/\n\n\nRUN cd /opt/app/eums/eums/client && npm install -g grunt-cli && npm cache clean --force;\n\n##############################################################################\n## Add the codebase to the image\n##############################################################################\nCOPY ./eums /opt/app/eums\nCOPY ./contacts /opt/app/contacts\nCOPY ./contacts/scripts/startContacts.sh /opt/scripts/startContacts.sh\nCOPY ./eums/scripts/deployment/startPostgres.sh /opt/scripts/startPostgres.sh\nCOPY ./eums/scripts/deployment/buildConfigs.sh /opt/scripts/buildConfigs.sh\nCOPY ./eums/scripts/deployment/celery.sh /opt/scripts/celery.sh\nCOPY ./eums/scripts/deployment/startProcessListener.sh /opt/scripts/startProcessListener.sh\nCOPY ./eums/scripts/setupmap /opt/scripts/setupmap\nRUN chmod a+x -R /opt/scripts\nRUN chmod a+x -R /opt/app/eums/scripts\n\nCOPY ./eums/scripts/supervisor/supervisord.conf /etc/supervisor/conf.d/supervisord.conf\nCOPY ./eums/scripts/supervisor/celeryd.conf /etc/supervisor/conf.d/celeryd.conf\nRUN mkdir /var/log/celery\nRUN touch /var/log/celery/workers.log\n\nVOLUME /var/lib/postgresql\nVOLUME /data\n\nEXPOSE 22 80\n\n##############################################################################\n## Entrypoint and command parameters\n##############################################################################\nCMD [\"/usr/bin/supervisord\"]\n"
}