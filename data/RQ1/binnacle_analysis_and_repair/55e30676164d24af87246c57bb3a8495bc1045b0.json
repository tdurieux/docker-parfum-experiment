{
  "startTime": 1674252486846,
  "endTime": 1674252487059,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 2,
        "columnEnd": 89
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 2,
        "columnEnd": 24
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 45,
        "lineEnd": 45,
        "columnStart": 2,
        "columnEnd": 57
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 2,
        "columnEnd": 13
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 2,
        "columnEnd": 29
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 10,
        "lineEnd": 16,
        "columnStart": 2,
        "columnEnd": 22
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 26,
        "lineEnd": 28,
        "columnStart": 2,
        "columnEnd": 30
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM centos:7\n\nLABEL maintainer=\"mozdef@mozilla.com\"\n\nENV PYTHON_VERSION 2.7.11\nENV TZ UTC\n\nRUN \\\n  yum makecache fast && \\\n  yum install -y epel-release && \\\n  yum install -y \\\n                  glibc-devel \\\n                  gcc \\\n                  libstdc++ \\\n                  libffi-devel \\\n                  zlib-devel \\\n                  make && \\\n  useradd -ms /bin/bash -d /opt/mozdef -m mozdef && \\\n  mkdir /opt/mozdef/envs && \\\n  curl -f -s -L https://www.python.org/ftp/python/$PYTHON_VERSION/Python-$PYTHON_VERSION.tgz | tar -C /opt/mozdef/ -xz && \\\n  cd /opt/mozdef/Python-$PYTHON_VERSION && \\\n  ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" && \\\n  make && \\\n  make install && \\\n  rm -r /opt/mozdef/Python-$PYTHON_VERSION && \\\n  cd /opt/mozdef && \\\n  yum install -y mysql-devel \\\n                    python-devel \\\n                    python-pip && \\\n  chown -R mozdef:mozdef /opt/mozdef/ && \\\n  pip install --no-cache-dir virtualenv && \\\n  mkdir /opt/mozdef/envs/mozdef && \\\n  mkdir /opt/mozdef/envs/mozdef/cron && rm -rf /var/cache/yum\n\n# Create python virtual environment and install dependencies\nCOPY requirements.txt /opt/mozdef/envs/mozdef/requirements.txt\n\nCOPY cron/update_geolite_db.py /opt/mozdef/envs/mozdef/cron/update_geolite_db.py\nCOPY cron/update_geolite_db.conf /opt/mozdef/envs/mozdef/cron/update_geolite_db.conf\nCOPY cron/update_geolite_db.sh /opt/mozdef/envs/mozdef/cron/update_geolite_db.sh\n\nUSER mozdef\nRUN \\\n  virtualenv /opt/mozdef/envs/python && \\\n  source /opt/mozdef/envs/python/bin/activate && \\\n  pip install --no-cache-dir -r /opt/mozdef/envs/mozdef/requirements.txt\n\nCOPY lib /opt/mozdef/envs/mozdef/lib\n\nUSER root\nRUN chown -R mozdef:mozdef /opt/mozdef/envs/mozdef\n\nUSER mozdef\n# We have to replace the python virtualenv path until\n# https://github.com/mozilla/MozDef/issues/421 is fixed\nRUN sed -i 's|/opt/mozdef/envs/mozdef/bin/activate|/opt/mozdef/envs/python/bin/activate|g' /opt/mozdef/envs/mozdef/cron/*.sh\n\nRUN mkdir /opt/mozdef/envs/mozdef/data\n\nWORKDIR /opt/mozdef/envs/mozdef\n\nVOLUME /opt/mozdef/envs/mozdef/data\n\nUSER root\n"
}