{
  "startTime": 1674251607453,
  "endTime": 1674251607601,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 12,
        "columnEnd": 56
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "### Step 1 : clone repo\nFROM    alpine/git AS xhgui_sources\n# Clone xhgui and install master as there is no suitable tag, then remove useless files\nRUN     git clone --depth 1 https://github.com/perftools/xhgui /usr/local/src/xhgui && \\\n        cd /usr/local/src/xhgui && \\\n        rm -rf /usr/local/src/xhgui/.git \\\n               /usr/local/src/xhgui/.scrutinizer.yml \\\n               /usr/local/src/xhgui/.travis.yml \\\n               /usr/local/src/xhgui/phpunit.xml \\\n               /usr/local/src/xhgui/README.md \\\n               /usr/local/src/xhgui/tests\n\n\n### Step 2 : Build project with composer\nFROM        edyan/php:5.6 as xhgui_built\nCOPY        --from=xhgui_sources --chown=www-data:www-data /usr/local/src/xhgui /usr/local/src/xhgui\nCOPY        --from=composer:1.8  --chown=www-data:www-data /usr/bin/composer /usr/bin/composer\nCOPY        --chown=www-data:www-data conf/xhgui.config.php /usr/local/src/xhgui/config/config.php\n\nWORKDIR     /usr/local/src/xhgui\nUSER        www-data\n\n# Accelerate download\nRUN         composer global require hirak/prestissimo --no-plugins --no-scripts && \\\n            ln -s /usr/bin/composer composer.phar && \\\n            sed -i 's/composer\\.phar install --prefer-dist/composer.phar install --prefer-dist --no-dev/g' install.php && \\\n            php install.php && \\\n            rm -f composer.phar\n\n\n### Step 3 : Build the final container\nFROM        edyan/php:5.6\n\nARG         BUILD_DATE\nARG         DEBIAN_FRONTEND=noninteractive\n\nLABEL       maintainer=\"Emmanuel Dyan <emmanueldyan@gmail.com>\"\nLABEL       org.label-schema.build-date=$BUILD_DATE\n\nCOPY        --from=xhgui_built --chown=www-data:www-data /usr/local/src/xhgui /usr/local/src/xhgui\n\n# Install tools\nRUN apt-get update && \\\n            # Upgrade the system\n            apt-get upgrade -y && \\\n            # Install packages needed by xhgui and that container\n            apt-get install --no-install-recommends -y mongodb-server supervisor && \\\n            # Alllow user to open port 80\n            setcap CAP_NET_BIND_SERVICE=+eip /usr/bin/php5 && \\\n            # Clean\n            apt-get autoremove -y && \\\n            apt-get autoclean && \\\n            apt-get clean && \\\n            # Empty some directories from all files and hidden files\n            find /root /tmp -mindepth 1 -delete && \\\n            rm -rf /var/lib/apt/lists/* /usr/share/man/* /usr/share/doc/* \\\n                   /var/cache/* /var/log/* /usr/share/php/docs /usr/share/php/tests\n\n# Prepare Mongodb, supervisord\nCOPY        conf/supervisord.conf /etc/supervisor/conf.d/supervisord.conf\n\nRUN         mkdir -p /data/db /var/log/mongodb && \\\n            chown -R mongodb:mongodb /data/db && \\\n            # Supervisord\n            mkdir -p /var/log/supervisor\n\n# Global directives\nVOLUME      [\"/usr/local/src/xhgui\"]\n\nEXPOSE      80 27017\n\nENV         XHGUI_MONGO_HOST   \"mongodb://127.0.0.1\"\nENV         MONGO_PORT         27017\nENV         PHP_WEBSERVER_PORT 80\n\nCOPY        tests/test.php /root/test.php\nCOPY        post-run.sh /root/post-run.sh\nRUN         chmod +x /root/post-run.sh /root/test.php\n\nCMD         [\"/usr/bin/supervisord\", \"-n\", \"-c\", \"/etc/supervisor/conf.d/supervisord.conf\"]\n"
}