{
  "startTime": 1674251665722,
  "endTime": 1674251666303,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 114,
        "lineEnd": 114,
        "columnStart": 4,
        "columnEnd": 103
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 115,
        "lineEnd": 115,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 100
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 109
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 113
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 134,
        "lineEnd": 134,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 100
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 109
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 113
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 134,
        "lineEnd": 134,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 100
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 109
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 113
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 134,
        "lineEnd": 134,
        "columnStart": 4,
        "columnEnd": 39
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 15,
        "lineEnd": 15,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 4,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 24,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 124
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 4,
        "columnEnd": 133
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 34,
        "lineEnd": 34,
        "columnStart": 4,
        "columnEnd": 137
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 37,
        "lineEnd": 37,
        "columnStart": 4,
        "columnEnd": 81
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 62
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 79
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 134,
        "lineEnd": 134,
        "columnStart": 4,
        "columnEnd": 63
      }
    }
  ],
  "repairedDockerfile": "#From debian:stretch-slim\n#From debian:stretch\nFrom ubuntu:18.04\nMAINTAINER Lanka Software Foundation <support@opensource.lk>\n\nARG DEBIAN_FRONTEND=noninteractive\nENV TELEGRAF_VERSION 1.8.1-1\n\n\n\n\nRUN apt-get update --fix-missing && apt-get -y purge exim4*\nRUN apt-get -y upgrade\nRUN apt-get -y --no-install-recommends install apt-utils && rm -rf /var/lib/apt/lists/*;\n# installing netstat command\nRUN apt-get -y --no-install-recommends install net-tools && rm -rf /var/lib/apt/lists/*;\n# installing ping command\nRUN apt-get install --no-install-recommends -y iputils-ping && rm -rf /var/lib/apt/lists/*;\n# install mail until for testing functions\nRUN apt-get -y --no-install-recommends install mailutils && rm -rf /var/lib/apt/lists/*;\n# installing lsof command\nRUN apt-get -y --no-install-recommends install lsof && rm -rf /var/lib/apt/lists/*;\nRUN apt-get -y --no-install-recommends install telnet && rm -rf /var/lib/apt/lists/*;\nRUN apt-get -y --no-install-recommends install nano && rm -rf /var/lib/apt/lists/*;\nRUN apt-get -y --no-install-recommends install letsencrypt openssl && rm -rf /var/lib/apt/lists/*;\n#postfix-mysql was used to connect with a mysql datbase\n#RUN apt-get -y install postfix postfix-mysql postfix-pcre libsasl2-modules\n#postfix-ldap required to connect with ldap services\nRUN apt-get -y --no-install-recommends install postfix postfix-ldap postfix-pcre postfix-policyd-spf-python libsasl2-modules && rm -rf /var/lib/apt/lists/*;\n\nRUN apt-get install --no-install-recommends -y rsyslog fetchmail libdbi-perl libdbd-pg-perl libdbd-mysql-perl liblockfile-simple-perl && rm -rf /var/lib/apt/lists/*;\n#RUN apt-get -y install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-sieve dnsutils\n# changing for modifications\n#RUN apt-get -y install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-sieve dnsutils dovecot-managesieved\nRUN apt-get -y --no-install-recommends install dovecot-core dovecot-imapd dovecot-pop3d dovecot-lmtpd dovecot-mysql dovecot-ldap dnsutils && rm -rf /var/lib/apt/lists/*;\n#RUN apt install -y mail-stack-delivery // this was used instead of dovecto one by one installation\n\nRUN apt-get install --no-install-recommends -y dovecot-sieve dovecot-managesieved && rm -rf /var/lib/apt/lists/*;\n\n# installing ldap utils for testing perposes\nRUN apt-get install --no-install-recommends -y ldap-utils curl && rm -rf /var/lib/apt/lists/*;\n\n\n#RUN apt-get -y install gnupg python-gpgme dovecot-managesieved sudo\n# Following changed introduced to above installation due to python-gpgme not installed in 18.04 ubuntu\n#RUN apt-get -y install gnupg dovecot-managesieved sudo\nRUN apt-get install --no-install-recommends -y gnupg software-properties-common && rm -rf /var/lib/apt/lists/*;\n# Above two lines used instead of line with python-gpgme\n\nRUN adduser --system --no-create-home --group --home /etc/zeyple --disabled-login zeyple\nRUN mkdir -p /etc/zeyple/keys && chmod 700 /etc/zeyple/keys && chown zeyple: /etc/zeyple/keys\n#ADD https://raw.github.com/infertux/zeyple/master/zeyple/zeyple.py /usr/local/bin/zeyple.py\nADD ./configs/zeyple/zeyple.py /usr/local/bin/zeyple.py\nRUN chmod 744 /usr/local/bin/zeyple.py && chown zeyple: /usr/local/bin/zeyple.py\nADD https://raw.github.com/infertux/zeyple/master/zeyple/zeyple.conf.example /etc/zeyple.conf\n#ADD ./emailserver/config/zeyple/zeyple.conf.example /etc/zeyple.conf\nRUN touch /var/log/zeyple.log && chown zeyple: /var/log/zeyple.log\nRUN chown -R zeyple /etc/zeyple /usr/local/bin/zeyple.py\n\n# COPY Changing dovecot congiguration files permission\nCOPY ./configs/Dovecot /etc/dovecot/\n#RUN chgrp dovecot /etc/dovecot/dovecot-sql.conf.ext\n#RUN chmod o= /etc/dovecot/dovecot-sql.conf.ext\n\n# changes accoring to url : https://www.linode.com/docs/email/postfix/email-with-postfix-dovecot-and-mariadb-on-centos-7/\nCOPY ./configs/Postfix /etc/postfix/\n#RUN chmod o= /etc/postfix/mariadb-sql/mysql-virtual_*.cf\n#RUN chgrp postfix /etc/postfix/mariadb-sql/mysql-virtual_*.cf\n\n# Changing sql configuration files permissions\n#RUN chmod o= /etc/postfix/sql/mysql_virtual_*.cf\n#RUN chgrp postfix /etc/postfix/sql/mysql_virtual_*.cf\n# Changing ldap configuration files permissions\nRUN chmod o= /etc/postfix/ldap/*.cf\nRUN chgrp postfix /etc/postfix/ldap/*.cf\n\n# Adding sieve file to /var/mail\nCOPY ./configs/sieve /var/mail/sieve\n\n\nRUN groupadd -g 5000 vmail && useradd -g vmail -u 5000 vmail -d /var/mail\nRUN chown -R vmail:vmail /var/mail\nRUN chown -R postfix /etc/postfix\nRUN chmod -R o-rwx /etc/postfix\nRUN chmod -R 755 /etc/postfix\nRUN chown -R vmail:dovecot /etc/dovecot\nRUN chmod -R o-rwx /etc/dovecot\n\nCOPY ./configs/Rspamd/rspamd.sh /\nRUN ./rspamd.sh  // Error : /bin/sh: 1: ./rspamd.sh: Permission denied , bellow line introduced\nRUN chmod +x ./rspamd.sh\nRUN ./rspamd.sh 2> /dev/null || true\nCOPY ./configs/Rspamd /etc/rspamd/\n#RUN mkdir /var/lib/rspamd/dkim/\t//error :/rspamd/...dkim/': No such file or directory\nRUN mkdir -p /var/lib/rspamd/dkim\n\nRUN rspamadm dkim_keygen -b 1024 -s 2018 -d $DOMAIN -k /var/lib/rspamd/dkim/2018.key > /var/lib/rspamd/dkim/2018.txt\nRUN chown -R _rspamd:_rspamd /var/lib/rspamd/dkim\nRUN chmod 440 /var/lib/rspamd/dkim/*\n\nRUN cp -R /etc/rspamd/local.d/dkim_signing.conf /etc/rspamd/local.d/arc.conf\nCOPY ./configs/sieve /sieve\n\nCOPY ./configs/init_sys.sh /bin/\n#COPY ./configs/.env /bin/\nRUN chmod +x /bin/init_sys.sh\n#RUN chmod 755 /bin/.env\n\n\n# Adding pod start commands to the email image\nADD ./configs/pod_start.sh /bin/pod_start.sh\nRUN chmod +x /bin/pod_start.sh\n\n# install filebeat to send alarms to ELK stack in copper hub\nRUN curl -f -L -O https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.7.1-linux-x86_64.tar.gz\nRUN tar xzvf filebeat-6.7.1-linux-x86_64.tar.gz && rm filebeat-6.7.1-linux-x86_64.tar.gz\nRUN cd filebeat-6.7.1-linux-x86_64\n# coppy local filebeat configuration file\nADD ./configs/filebeat/filebeat.yml /filebeat-6.7.1-linux-x86_64/filebeat.yml\n#RUN chown root filebeat.yml\n#RUN ./filebeat -e\n\n# postfixlog analyser\nCOPY ./configs/logAnalyze/pflogsumm /usr/local/bin/pflogsumm\nRUN chown bin:bin /usr/local/bin/pflogsumm\nRUN chmod 755 /usr/local/bin/pflogsumm\n\n# copying virus sh file\n #RUN mkdir /agent\n #RUN chmod 755 /agent\n #COPY ./emailserver/configs/clamAV/init_refresh.sh /agent/\n #RUN chmod +x /agent/init_refresh.sh\n\n# Antivirus with amavisd-new and clamAV\nRUN apt -y --no-install-recommends install clamav-daemon clamav && rm -rf /var/lib/apt/lists/*;\nCOPY ./configs/clamAV/antivirus.conf /etc/rspamd/override.d/\n\n# Install Telegraf\nRUN wget https://dl.influxdata.com/telegraf/releases/telegraf_${TELEGRAF_VERSION}_amd64.deb && \\\n\tdpkg -i telegraf_${TELEGRAF_VERSION}_amd64.deb && rm telegraf_${TELEGRAF_VERSION}_amd64.deb\n\n# Configure Telegraf\nCOPY ./configs/telegraf/telegraf.conf /etc/telegraf/telegraf.conf\nCOPY ./configs/telegraf/init.sh /etc/init.d/telegraf\n\n# Cleanup\nRUN apt-get clean && \\\n rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\nCOPY ./configs/telegraf/entrypoint.sh entrypoint.sh\nRUN chmod 755 entrypoint.sh\n\n\n#RUN init_sys.sh\n\nENTRYPOINT [\"init_sys.sh\"]\n\n#ENTRYPOINT [\"entrypoint.sh\"]\n#CMD [\"telegraf\"]\n#CMD service postfix start\n#ENTRYPOINT [\"tail\", \"-f\", \"/dev/null\"]"
}