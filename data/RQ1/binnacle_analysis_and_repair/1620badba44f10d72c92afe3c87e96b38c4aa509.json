{
  "startTime": 1674240097863,
  "endTime": 1674240098459,
  "originalSmells": [
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 43
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 42,
        "lineEnd": 53,
        "columnStart": 22,
        "columnEnd": 6
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Â© Copyright IBM Corporation 2017, 2019.\n# LICENSE: Apache License, Version 2.0 (http://www.apache.org/licenses/LICENSE-2.0)\n########## Dockerfile for Alfresco version 5.2 #####################\n#\n# This Dockerfile builds a basic installation of Alfresco.\n#\n# Alfresco is a collection of information management software products Unix-like operating systems developed using Java technology.\n# Their primary software offering, branded as a Digital Business Platform is proprietary & a commercially licensed open source platform,\n# supports open standards, and provides enterprise scale.\n#\n# To build this image, from the directory containing this Dockerfile\n# (assuming that the file is named Dockerfile):\n# docker build -t <image_name> .\n#\n# To start Alfresco run the below command:\n# docker run --name <container_name> -p <host_port>:8080 -d <image_name> \n#\n# We can view the Alfresco UI at http://<Alfresco-host-ip>:<port_number>/alfresco\n#\n# Reference:\n# https://www.alfresco.com/\n#\n##################################################################################\n#\n#\tNOTE:- Kindly check correct pg_hba.conf file for PostgreSQL before editing.\n#\n##################################################################################\n\n# Base Image\nFROM s390x/ubuntu:16.04\n\n# The author\nMAINTAINER  LoZ Open Source Ecosystem (https://www.ibm.com/developerworks/community/groups/community/lozopensource)\n\nENV SOURCE_DIR=/tmp/source\nENV\tM2_HOME=$SOURCE_DIR/apache-maven-3.3.9\nENV\tJAVA_HOME=/usr/lib/jvm/java-8-openjdk-s390x\nENV\tPATH=$M2_HOME/bin:$JAVA_HOME/bin:$PATH\nENV\tMAVEN_OPTS=\"-Xmx1024m\"\nENV\t_JAVA_OPTIONS=-Xmx10g\n\n# Install dependencies\nRUN apt-get update && apt-get -y --no-install-recommends install \\\n\t\tant \\\n\t\tcurl \\\n\t\tgcc \\\n\t\tgit \\\n\t\tmake \\\n\t\topenjdk-8-jdk \\\n\t\tpostgresql \\\n\t\tpostgresql-contrib \\\n\t\tsubversion \\\n\t\ttar \\\n\t\twget \\\n\n# Configure PostgreSQL Database\n\t&& mkdir -p $SOURCE_DIR \\\n\t&& cd $SOURCE_DIR \\\n\t&& sed -i '85s/postgres/all/' /etc/postgresql/9.5/main/pg_hba.conf \\\n\t&& sed -i '85s/peer/trust/' /etc/postgresql/9.5/main/pg_hba.conf \\\n\t&& service postgresql start \\\n\t&& sleep 30s \\\n\t&& psql -U postgres -c \"CREATE USER alfresco WITH PASSWORD 'alfresco';\" \\\n\t&& psql -U postgres -c \"CREATE DATABASE alfresco;\" \\\n\t&& psql -U postgres -c \"GRANT ALL PRIVILEGES ON DATABASE alfresco to alfresco;\" \\\n\t&& service postgresql restart \\\n\n# Install OpenSSL version 1.0.2k\n\t&& cd $SOURCE_DIR \\\n\t&& git clone https://github.com/openssl/openssl.git \\\n\t&& cd openssl \\\n\t&& git checkout OpenSSL_1_0_2k \\\n\t&& ./config --prefix=/usr --openssldir=/usr/local/openssl shared \\\n\t&& make \\\n\t&& make install \\\n\n# Build and Install Apache Tomcat\n\t&& cd $SOURCE_DIR \\\n\t&& git clone https://github.com/apache/tomcat.git \\\n\t&& cd tomcat/ \\\n\t&& git checkout 8.5.16 \\\n\t&& cp build.properties.default build.properties \\\n\t&& ant \\\n\n# Configure Tomcat\n\t&& groupadd tomcat \\\n\t&& useradd -s /bin/false -g tomcat -d /opt/tomcat tomcat \\\n\t&& mkdir /opt/tomcat \\\n\t&& cp -R $SOURCE_DIR/tomcat/output/build/* /opt/tomcat/ \\\n\t&& cd /opt/tomcat \\\n\t&& chgrp -R tomcat /opt/tomcat \\\n\t&& chmod -R g+r conf \\\n\t&& chmod g+x conf \\\n\t&& chown -R tomcat webapps/ temp/ logs/ \\\n\n\t&& sed -i '44i <role rolename=\"manager-gui\"/>' conf/tomcat-users.xml \\\n\t&& sed -i '45i <role rolename=\"manager-script\"/>' conf/tomcat-users.xml \\\n\t&& sed -i '46i <user username=\"admin\" password=\"admin\" roles=\"manager-gui, manager-script\"/>' conf/tomcat-users.xml \\\n\n\t&& cd lib \\\n\t&& wget https://jdbc.postgresql.org/download/postgresql-42.1.4.jar \\\n\n# Install Maven\n\t&& cd $SOURCE_DIR \\\n\t&& wget https://archive.apache.org/dist/maven/maven-3/3.3.9/binaries/apache-maven-3.3.9-bin.tar.gz \\\n\t&& tar -xvzf apache-maven-3.3.9-bin.tar.gz \\\n# Get Alfresco Source code\n\t&& svn co https://svn.alfresco.com/repos/alfresco-open-mirror/alfresco/COMMUNITYTAGS/5.2.g/ \\\n\n# Remove or comment on the line 31 of the file: ./5.2.g/root/projects/solr4/source/java/org/alfresco/solr/AlfrescoSolrCloseHook.java\n\t&& sed -i '31 s/^/\\/\\//' ./5.2.g/root/projects/solr4/source/java/org/alfresco/solr/AlfrescoSolrCloseHook.java \\\n\n# Change alfresco-global.properties.sample to alfresco-global.properties\n\t&& mv 5.2.g/root/projects/repository/config/alfresco-global.properties.sample 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\n# Edit 5.2.g/root/projects/repository/config/alfresco-global.properties file\n\t&& sed -i '11i dir.root=/Alfresco/alf_data' 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\t&& sed -i '12i dir.contentstore=/Alfresco/alf_data/contentstore' 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\t&& sed -i '13i dir.contentstore.deleted=/Alfresco/alf_data/contentstore.deleted' 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\t&& sed -i '14i db.name=alfresco' 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\t&& sed -i '15i db.username=alfresco' 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\t&& sed -i '16i db.password=alfresco' 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\t&& sed -i '17i db.host=localhost' 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\t&& sed -i '18i db.port=5432' 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\t&& sed -i '19i db.url=jdbc:postgresql://localhost:5432/alfresco' 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\t&& sed -i '20i db.pool.max=275' 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\t&& sed -i '21i db.driver=org.postgresql.Driver' 5.2.g/root/projects/repository/config/alfresco-global.properties \\\n\n# Edit 5.2.g/root/projects/dev-tomcat/src/main/tomcat/shared/classes/alfresco-global.properties file\n\t&& sed -i '8d;9d;10d;11d;12d;13d' 5.2.g/root/projects/dev-tomcat/src/main/tomcat/shared/classes/alfresco-global.properties \\\n\t&& sed -i '4i dir.root=/Alfresco/alf_data' 5.2.g/root/projects/dev-tomcat/src/main/tomcat/shared/classes/alfresco-global.properties \\\n\t&& sed -i '5i dir.contentstore=/Alfresco/alf_data/contentstore' 5.2.g/root/projects/dev-tomcat/src/main/tomcat/shared/classes/alfresco-global.properties \\\n\t&& sed -i '6i dir.contentstore.deleted=/Alfresco/alf_data/contentstore.deleted' 5.2.g/root/projects/dev-tomcat/src/main/tomcat/shared/classes/alfresco-global.properties \\\n\t&& sed -i '11i db.host=localhost' 5.2.g/root/projects/dev-tomcat/src/main/tomcat/shared/classes/alfresco-global.properties \\\n\t&& sed -i '12i db.port=5432' 5.2.g/root/projects/dev-tomcat/src/main/tomcat/shared/classes/alfresco-global.properties \\\n\t&& sed -i '13i db.url=jdbc:postgresql://localhost:5432/alfresco' 5.2.g/root/projects/dev-tomcat/src/main/tomcat/shared/classes/alfresco-global.properties \\\n\t&& sed -i '14i db.pool.max=275' 5.2.g/root/projects/dev-tomcat/src/main/tomcat/shared/classes/alfresco-global.properties \\\n\n# Build and Install Alfresco\n\t&& cd 5.2.g/root/ \\\n\t&& mvn clean install -DskipTests \\\n\n# Copy alfresco.war to /opt/tomcat/webapps\n\t&& cd /opt/tomcat \\\n\t&& cp $SOURCE_DIR/5.2.g/root/projects/web-client/target/alfresco.war webapps/ \\\n\n# Clean up cache data and remove dependencies which are not required\n\t&& apt-get -y remove \\\n\t\tant \\\n\t\tcurl \\\n\t\tgcc \\\n\t\tgit \\\n\t\tmake \\\n\t\tsubversion \\\n\t\twget \\\n\t&& apt-get autoremove -y \\\n\t&& apt autoremove -y \\\n\t&& rm -rf $HOME/.m2 \\\n\t&& rm -rf $SOURCE_DIR \\\n\t&& apt-get clean \\\n\t&& rm -rf /var/lib/apt/lists/* && rm apache-maven-3.3.9-bin.tar.gz\n\nEXPOSE 8080\n\nWORKDIR /opt/tomcat\n\nCMD service postgresql restart && bin/catalina.sh run\n\n# End of Dockerfile\n"
}