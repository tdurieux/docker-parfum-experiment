{
  "startTime": 1674250365645,
  "endTime": 1674250365997,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 82,
        "lineEnd": 82,
        "columnStart": 4,
        "columnEnd": 64
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 93,
        "lineEnd": 93,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 90,
        "lineEnd": 90,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 99
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 5,
        "columnEnd": 41
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 5,
        "columnEnd": 100
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 5,
        "columnEnd": 41
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 64,
        "lineEnd": 64,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 29
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# The Dockerfile is Licensed under GNU AFFERO GENERAL PUBLIC LICENSE Version 3\n\nFROM ubuntu as builder\nLABEL maintainer=\"sahil@ole.org,mappuji@ole.org\"\n\nCOPY ./crosscompile.sh .\nRUN bash ./crosscompile.sh armv7 install\n\nFROM resin/rpi-raspbian\n\nENV COUCHDB_VERSION 2.0.0\n\n#create dirs and links for the npm module\nRUN mkdir -p /usr/lib/node_modules; \\\n    ln -s /usr/lib/node_modules/grunt-cli/bin/grunt /usr/bin/grunt\n\nCOPY --from=builder /usr/lib/node_modules /usr/lib/node_modules\n\n# Add CouchDB user account\nRUN groupadd -r couchdb && useradd -d /opt/couchdb -g couchdb couchdb\n\nRUN apt-get update -y && apt-get install -y --no-install-recommends \\\n    ca-certificates \\\n    curl \\\n    erlang-nox \\\n    erlang-reltool \\\n    haproxy \\\n    libicu52 \\\n    libmozjs185-1.0 \\\n    openssl \\\n  && rm -rf /var/lib/apt/lists/*\n\n# grab gosu for easy step-down from root and tini for signal handling\nRUN gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n  && curl -o /usr/local/bin/gosu -fSL \"https://github.com/tianon/gosu/releases/download/1.7/gosu-$(dpkg --print-architecture)\" \\\n  && curl -o /usr/local/bin/gosu.asc -fSL \"https://github.com/tianon/gosu/releases/download/1.7/gosu-$(dpkg --print-architecture).asc\" \\\n  && gpg --batch --verify /usr/local/bin/gosu.asc \\\n  && rm /usr/local/bin/gosu.asc \\\n  && chmod +x /usr/local/bin/gosu \\\n  && gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 6380DC428747F6C393FEACA59A84159D7001A4E5; \\\n# check if tini exists\n  if ! type \"tini\" > /dev/null; then \\\n  curl -o /usr/local/bin/tini -fSL \"https://github.com/krallin/tini/releases/download/v0.14.0/tini\" \\\n  && curl -o /usr/local/bin/tini.asc -fSL \"https://github.com/krallin/tini/releases/download/v0.14.0/tini.asc\" \\\n  && gpg --batch --verify /usr/local/bin/tini.asc \\\n  && rm /usr/local/bin/tini.asc \\\n  && chmod +x /usr/local/bin/tini; \\\n  fi;\n\n# https://www.apache.org/dist/couchdb/KEYS\nENV GPG_KEYS \\\n  15DD4F3B8AACA54740EB78C7B7B7C53943ECCEE1 \\\n  1CFBFA43C19B6DF4A0CA3934669C02FFDF3CEBA3 \\\n  25BBBAC113C1BFD5AA594A4C9F96B92930380381 \\\n  4BFCA2B99BADC6F9F105BEC9C5E32E2D6B065BFB \\\n  5D680346FAA3E51B29DBCB681015F68F9DA248BC \\\n  7BCCEB868313DDA925DF1805ECA5BCB7BB9656B0 \\\n  C3F4DFAEAD621E1C94523AEEC376457E61D50B88 \\\n  D2B17F9DA23C0A10991AF2E3D9EE01E47852AEE4 \\\n  E0AF0A194D55C84E4A19A801CDB0C0F904F4EE9B\nRUN set -xe \\\n  && for key in $GPG_KEYS; do \\\n    gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys \"$key\"; \\\n  done\n\nENV COUCHDB_VERSION 2.0.0\n\n# Download dev dependencies\nRUN buildDeps=' \\\n    apt-transport-https \\\n    gcc \\\n    git \\\n    g++ \\\n    erlang-dev \\\n    libcurl4-openssl-dev \\\n    libicu-dev \\\n    libmozjs185-dev \\\n    make \\\n  ' \\\n && apt-get update -y -qq && apt-get install -y --no-install-recommends $buildDeps \\\n && curl -f -s https://deb.nodesource.com/gpgkey/nodesource.gpg.key | apt-key add - \\\n && echo 'deb https://deb.nodesource.com/node_4.x jessie main' > /etc/apt/sources.list.d/nodesource.list \\\n && echo 'deb-src https://deb.nodesource.com/node_4.x jessie main' >> /etc/apt/sources.list.d/nodesource.list \\\n && apt-get update -y -qq \\\n && apt-get install --no-install-recommends -y nodejs \\\n # Acquire CouchDB source code\n && cd /usr/src && mkdir couchdb \\\n && curl -fSL https://github.com/apache/couchdb/archive/$COUCHDB_VERSION.tar.gz -o couchdb.tar.gz \\\n && tar -xzf couchdb.tar.gz -C couchdb --strip-components=1 \\\n && cd couchdb \\\n # Build the release and install into /opt\n && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --disable-docs \\\n && make release \\\n && mv /usr/src/couchdb/rel/couchdb /opt/ \\\n # Cleanup build detritus\n && apt-get purge -y --auto-remove $buildDeps \\\n && rm -rf /var/lib/apt/lists/* /usr/lib/node_modules /usr/src/couchdb* && rm couchdb.tar.gz\n\n# Add configuration\nCOPY local.ini /opt/couchdb/etc/local.d/\nCOPY vm.args /opt/couchdb/etc/\n\nCOPY ./docker-entrypoint.sh /\n\n# Setup directories and permissions\nRUN chmod +x /docker-entrypoint.sh \\\n && mkdir /opt/couchdb/data /opt/couchdb/etc/default.d \\\n && chown -R couchdb:couchdb /opt/couchdb/\n\nWORKDIR /opt/couchdb\nEXPOSE 5984 4369 9100\nVOLUME [\"/opt/couchdb/data\"]\n\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\nCMD [\"/opt/couchdb/bin/couchdb\"]\n"
}