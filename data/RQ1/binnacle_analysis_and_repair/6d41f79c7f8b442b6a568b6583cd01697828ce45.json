{
  "startTime": 1674246027194,
  "endTime": 1674246027544,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 29
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM andreptb/tomcat:7-jdk8\n\n# DO NOT TOUCH ABOVE THIS LINE\n\n# INSTRUCTIONS do not use directly.\n# 1. Create a folder with the OXL file and other files referenced in the ARG statement below\n# 2. Copy this Dockerfile into that folder. Set git_repo and branch_name in line 48 below (as passing git parameters from build-docker.sh fails)\n# 2. Build with \"docker image build --squash -t knetminer-myspecies -f Dockerfile-local [--build-arg varname=value -build-arg ...] .\", specifying one build-arg parameter for each argument not provided with a default below or that you wish to override\n# 3. Run the resulting image with \"docker run -p8080:8080 -it --rm knetminer-myspecies\". You can access it at http://localhost:8080/client/\n\n# DO NOT TOUCH BELOW THIS LINE\n\n# Files that need to be in the local folder (including the .oxl file)\n\n#ARG oxl_file=data.oxl \nARG oxl_file \nARG semantic_motifs_file=SemanticMotifs.txt \nARG basemap_file=basemap.xml \nARG sample_query_file=sampleQuery.xml \nARG background_image_file=background.jpg \nARG release_notes_file=release_notes.html \n\n# Other arguments\n\nARG tax_id \nARG multiorganisms=false\nARG species_name\nARG species_link_name\nARG keywords\nARG description\nARG reference_genome\n#ARG git_branch=master\nARG knetminer_port\n\n#EXPOSE 8080\nEXPOSE ${knetminer_port}\n\nWORKDIR /root\nENV ds=/root/knetminer/common/quickstart/datasource/src/main \\\n    cl=/root/knetminer/common/quickstart/client/src/main/webapp/html \\\n\ttc=/usr/local/tomcat/conf/ \\\n    common=/root/knetminer/common\n\nRUN set -x \\\n && apk add --no-cache maven nodejs-npm git libxml2-utils \\\n && npm config set unsafe-perm true \\\n && npm install bower gulp -g \\\n && echo '{\"allow_root\":true}' > /root/.bowerrc \\\n && git clone --single-branch -b knetminer-3.0 https://github.com/Rothamsted/knetminer.git \\\n && cd knetminer \\\n && mkdir -p ${cl}/data ${cl}/image && npm cache clean --force;\n\nCOPY ${oxl_file} /root/data.oxl\nCOPY ${semantic_motifs_file} ${ds}/resources/SemanticMotifs.txt\nCOPY ${basemap_file} ${cl}/data/basemap.xml\nCOPY ${sample_query_file} ${cl}/data/sampleQuery.xml\nCOPY ${background_image_file} ${cl}/image/background.jpg\nCOPY ${release_notes_file} ${cl}/release_notes.html\n\nRUN cd knetminer \\\n && mv ${ds}/resources/config.xml.template ${ds}/resources/config.xml \\\n && mv ${ds}/java/rres/knetminer/datasource/provider/Quickstart.java.template ${ds}/java/rres/knetminer/datasource/provider/Quickstart.java \\\n && mv ${cl}/release.html.template ${cl}/release.html \\\n && mv ${cl}/index.jsp.template ${cl}/index.jsp \\\n && mv ${cl}/javascript/utils-config.js.template ${cl}/javascript/utils-config.js \\\n && chromosomes=$(echo \"cat //genome/chromosome/@number\" | xmllint --shell ${cl}/data/basemap.xml | sed -n 's/[^\\\"]*\\\"\\([^\\\"]*\\)\\\"[^\\\"]*/\\1/gp' | sed -e :a -e '$!N; s/\\n/,/; ta';) \\\n && sed -e \"s/!!REFGENOME!!/${reference_genome}/g\" -i'' ${cl}/javascript/utils-config.js \\\n && sed -e \"s/!!SPECIES!!/${species_name}/g\" -i'' ${cl}/javascript/utils-config.js \\\n && sed -e \"s/!!LINKNAME!!/${species_link_name}/g\" -i'' ${cl}/javascript/utils-config.js \\\n && sed -e \"s/!!SPECIES!!/${species_name}/g\" -i'' ${cl}/release.html \\\n && sed -e \"/!!RELEASE!!/{r ${cl}/release_notes.html\" -e \"d}\" -i'' ${cl}/release.html \\\n && sed -e \"s/!!SPECIES!!/${species_name}/g\" -i'' ${cl}/index.jsp \\\n && sed -e \"s/!!CHROMOSOMES!!/${chromosomes}/g\" -i'' ${cl}/index.jsp \\\n && sed -e \"s/!!METAKEYWORDS!!/${keywords}/g\" -i'' ${cl}/index.jsp \\\n && sed -e \"s/!!METADESC!!/${description}/g\" -i'' ${cl}/index.jsp \\\n && sed -e \"s/!!REFGENOME!!/${reference_genome}/g\" -i'' ${ds}/resources/config.xml \\\n && sed -e \"s/!!TAXID!!/${tax_id}/g\" -i'' ${ds}/resources/config.xml \\\n && sed -e \"s/!!LINKNAME!!/${species_link_name}/g\" -i'' ${ds}/java/rres/knetminer/datasource/provider/Quickstart.java \\\n && sed -i.bk \"s/8080/${knetminer_port}/g\" ${tc}/server.xml \\\n && mvn install \\\n && cd ${common} \\\n && mvn install \\\n && cd ${common}/server-datasource-api \\\n && mvn install \\\n && cd ${common}/server-datasource-ondexlocal \\\n && mvn install \\\n && cd ${common}/server-base \\\n && mvn install \\\n && cd ${common}/client-base \\\n && mvn install \\\n && cd ${common}/quickstart \\\n && mvn install \\\n && mv ${common}/quickstart/client/target/client.war ${CATALINA_HOME}/webapps \\\n && mv ${common}/quickstart/ws/target/ws.war ${CATALINA_HOME}/webapps \\\n && rm -rf /root/.m2 /root/knetminer\n\nCMD [\"catalina.sh\", \"run\"]\n"
}