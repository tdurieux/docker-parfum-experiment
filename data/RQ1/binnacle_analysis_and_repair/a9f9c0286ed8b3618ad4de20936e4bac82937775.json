{
  "startTime": 1674239908350,
  "endTime": 1674239908842,
  "originalSmells": [
    {
      "rule": "curlUseHttpsUrl",
      "position": {
        "lineStart": 44,
        "lineEnd": 45,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 4,
        "columnEnd": 41
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 161,
        "lineEnd": 161,
        "columnStart": 4,
        "columnEnd": 55
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# AUTOMATICALLY GENERATED\n# DO NOT EDIT THIS FILE DIRECTLY, USE /Dockerfile.tmpl.php\n\n# https://hub.docker.com/_/debian\nFROM debian:stretch-slim\n\nMAINTAINER Instrumentisto Team <developer@instrumentisto.com>\n\n\n# Build and install Postfix\n# https://git.launchpad.net/postfix/tree/debian/rules?id=94dfb9850484db5f47958eaa86f958857ab9834c\nRUN apt-get update \\\n && apt-get upgrade -y \\\n && apt-get install -y --no-install-recommends --no-install-suggests \\\n            inetutils-syslogd \\\n            ca-certificates \\\n && update-ca-certificates \\\n    \\\n # Install Postfix dependencies\n && apt-get install -y --no-install-recommends --no-install-suggests \\\n            libpcre3 libicu57 \\\n            libdb5.3 libpq5 libmariadbclient18 libsqlite3-0 \\\n            libsasl2-2 \\\n            libldap-2.4 \\\n    \\\n # Install tools for building\n && toolDeps=\" \\\n        curl make gcc g++ libc-dev \\\n    \" \\\n && apt-get install -y --no-install-recommends --no-install-suggests \\\n            $toolDeps \\\n    \\\n # Install Postfix build dependencies\n && buildDeps=\" \\\n        libssl-dev \\\n        libpcre3-dev libicu-dev \\\n        libdb-dev libpq-dev libmariadbclient-dev libsqlite3-dev \\\n        libsasl2-dev \\\n        libldap2-dev \\\n    \" \\\n && apt-get install -y --no-install-recommends --no-install-suggests \\\n            $buildDeps \\\n    \\\n # Download and prepare Postfix sources \\\n && curl -fL -o /tmp/postfix.tar.gz \\\n         https://cdn.postfix.johnriley.me/mirrors/postfix-release/official/postfix-3.1.3.tar.gz \\\n && (echo \"00e2b0974e59420cabfddc92597a99b42c8a8c9cd9a0c279c63ba6be9f40b15400f37dc16d0b1312130e72b5ba82b56fc7d579ee9ef975a957c0931b0401213c  /tmp/postfix.tar.gz\" \\\n         | sha512sum -c -) \\\n && tar -xzf /tmp/postfix.tar.gz -C /tmp/ \\\n && cd /tmp/postfix-* \\\n && sed -i -e \"s:/usr/local/:/usr/:g\" conf/master.cf \\\n\n # Build Postfix from sources\n && make makefiles \\\n         CCARGS=\"-DHAS_SHL_LOAD -DUSE_TLS \\\n                 -DHAS_PCRE $(pcre-config --cflags) \\\n                 -DHAS_PGSQL -I/usr/include/postgresql \\\n                 -DHAS_MYSQL $(mysql_config --include) \\\n                 -DHAS_SQLITE -I/usr/include \\\n                 -DHAS_LDAP -I/usr/include \\\n                 -DUSE_CYRUS_SASL -I/usr/include/sasl \\\n                 -DUSE_SASL_AUTH -DDEF_SASL_SERVER=\\\\\\\"dovecot\\\\\\\" \\\n                 -DUSE_LDAP_SASL\" \\\n         AUXLIBS=\"-lssl -lcrypto -lsasl2\" \\\n         AUXLIBS_PCRE=\"$(pcre-config --libs)\" \\\n         AUXLIBS_PGSQL=\"-lpq\" \\\n         AUXLIBS_MYSQL=\"$(mysql_config --libs)\" \\\n         AUXLIBS_SQLITE=\"-lsqlite3 -lpthread\" \\\n         AUXLIBS_LDAP=\"-lldap -llber\" \\\n         shared=yes \\\n         dynamicmaps=yes \\\n         pie=yes \\\n         daemon_directory=/usr/lib/postfix \\\n         shlibs_directory=/usr/lib/postfix \\\n         # No documentation included to keep image size smaller\n         manpage_directory=/tmp/man \\\n         readme_directory=/tmp/readme \\\n         html_directory=/tmp/html \\\n && make \\\n\n # Create Postfix user and groups\n && addgroup --system --gid 91 postfix \\\n && adduser --system --uid 90 --disabled-password \\\n            --no-create-home --home /var/spool/postfix \\\n            --ingroup postfix --gecos postfix \\\n            postfix \\\n && adduser postfix mail \\\n && addgroup --system --gid 93 postdrop \\\n && adduser --system --uid 92 --disabled-password --shell /sbin/nologin \\\n            --no-create-home --home /var/mail/domains \\\n            --ingroup postdrop --gecos vmail \\\n            vmail \\\n\n # Install Postfix\n && make upgrade \\\n # Always execute these binaries under postdrop group\n && chmod g+s /usr/sbin/postdrop \\\n              /usr/sbin/postqueue \\\n # Ensure spool dir has correct rights\n && install -d -o postfix -g postfix /var/spool/postfix \\\n # Fix removed directories in default configuration\n && sed -i -e 's,^manpage_directory =.*,manpage_directory = /dev/null,' \\\n           -e 's,^readme_directory =.*,readme_directory = /dev/null,' \\\n           -e 's,^html_directory =.*,html_directory = /dev/null,' \\\n        /etc/postfix/main.cf \\\n # Prepare directories for drop-in configuration files\n && install -d /etc/postfix/main.cf.d \\\n && install -d /etc/postfix/master.cf.d \\\n # Generate default TLS credentials\n && install -d /etc/ssl/postfix \\\n && openssl req -new -x509 -nodes -days 365 \\\n                -subj \"/CN=smtp.example.com\" \\\n                -out /etc/ssl/postfix/server.crt \\\n                -keyout /etc/ssl/postfix/server.key \\\n && chmod 0600 /etc/ssl/postfix/server.key \\\n # Pregenerate Diffie-Hellman parameters (heavy operation)\n && openssl dhparam -out /etc/postfix/dh2048.pem 2048 \\\n # Tweak TLS/SSL settings to achieve A grade\n && echo \"\\n\\\n        \\n# TLS PARAMETERS\\\n        \\n#\\\n        \\ntls_ssl_options = NO_COMPRESSION\\\n        \\ntls_high_cipherlist = ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256\\\n        \\n\\\n        \\n# SMTP TLS PARAMETERS (outgoing connections)\\\n        \\n#\\\n        \\nsmtp_tls_security_level = may\\\n        \\nsmtp_tls_CApath = /etc/ssl/certs\\\n        \\n\\\n        \\n# SMTPD TLS PARAMETERS (incoming connections)\\\n        \\n#\\\n        \\nsmtpd_tls_security_level = may\\\n        \\nsmtpd_tls_ciphers = high\\\n        \\nsmtpd_tls_mandatory_ciphers = high\\\n        \\nsmtpd_tls_exclude_ciphers = aNULL, LOW, EXP, MEDIUM, ADH, AECDH, MD5, DSS, ECDSA, CAMELLIA128, 3DES, CAMELLIA256, RSA+AES, eNULL\\\n        \\nsmtpd_tls_dh1024_param_file = /etc/postfix/dh2048.pem\\\n        \\nsmtpd_tls_CApath = /etc/ssl/certs\\\n        \\nsmtpd_tls_cert_file = /etc/ssl/postfix/server.crt\\\n        \\nsmtpd_tls_key_file = /etc/ssl/postfix/server.key\\\n    \" >> /etc/postfix/main.cf \\\n\n # Cleanup unnecessary stuff\n && apt-get purge -y --auto-remove \\\n                  -o APT::AutoRemove::RecommendsImportant=false \\\n            $toolDeps $buildDeps \\\n && rm -rf /var/lib/apt/lists/* \\\n           /etc/*/inetutils-syslogd \\\n           /tmp/* && rm /tmp/postfix.tar.gz\n\n\n# Install s6-overlay\nRUN apt-get update \\\n && apt-get install -y --no-install-recommends --no-install-suggests \\\n            curl \\\n && curl -fL -o /tmp/s6-overlay.tar.gz \\\n         https://github.com/just-containers/s6-overlay/releases/download/v1.21.2.2/s6-overlay-amd64.tar.gz \\\n # In Debian: /bin -> /usr/bin\n # So unpacking s6-overlay.tar.gz to the / will replace /bin symlink with\n # /bin directory from archive.\n # To avoid this we need to copy content of /bin manually.\n && mkdir -p /tmp/s6-overlay \\\n && tar -xzf /tmp/s6-overlay.tar.gz -C /tmp/s6-overlay/ \\\n && cp -rf /tmp/s6-overlay/bin/* /bin/ \\\n && rm -rf /tmp/s6-overlay/bin \\\n           /tmp/s6-overlay/usr/bin/execlineb \\\n && cp -rf /tmp/s6-overlay/* / \\\n    \\\n # Cleanup unnecessary stuff\n && apt-get purge -y --auto-remove \\\n                  -o APT::AutoRemove::RecommendsImportant=false \\\n            curl \\\n && rm -rf /var/lib/apt/lists/* \\\n           /tmp/* && rm /tmp/s6-overlay.tar.gz\n\nENV S6_BEHAVIOUR_IF_STAGE2_FAILS=2 \\\n    S6_CMD_WAIT_FOR_SERVICES=1\n\n\nCOPY rootfs /\n\nRUN chmod +x /etc/services.d/*/run \\\n             /etc/cont-init.d/*\n\n\nEXPOSE 25 465 587\n\nENTRYPOINT [\"/init\"]\n\nCMD [\"/usr/lib/postfix/master\", \"-d\"]\n"
}