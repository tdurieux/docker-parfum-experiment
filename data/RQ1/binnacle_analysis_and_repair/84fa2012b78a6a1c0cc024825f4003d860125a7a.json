{
  "startTime": 1674245521058,
  "endTime": 1674245521310,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 58,
        "columnEnd": 149
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 58,
        "columnEnd": 149
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# fix java version here until the following issue is resolved: https://github.com/researchstudio-sat/webofneeds/issues/1229\nFROM openjdk:8u121-jdk\n\n# install certbot\n# next 3 and a half lines as per https://unix.stackexchange.com/questions/508724/failed-to-fetch-jessie-backports-repository (second answer)\nRUN echo \"deb [check-valid-until=no] http://cdn-fastly.deb.debian.org/debian jessie main\" > /etc/apt/sources.list.d/jessie.list\nRUN echo \"deb [check-valid-until=no] http://archive.debian.org/debian jessie-backports main\" > /etc/apt/sources.list.d/jessie-backports.list\nRUN sed -i '/deb http:\\/\\/deb.debian.org\\/debian jessie-updates main/d' /etc/apt/sources.list\nRUN apt-get -o Acquire::Check-Valid-Until=false update && apt-get -o Acquire::Check-Valid-Until=false --no-install-recommends install -y certbot -t jessie-backports dos2unix && rm -rf /var/lib/apt/lists/*;\n\n# main directory where the certificates are generated. This directory should be mounted to the host since other\n# directories inside (e.g. \"live\") use symlinks which should not be broken by mounting\nENV main_dir=\"/etc/letsencrypt\"\n\n# webroot directory which is used for the letsencrypt acme challenge, this is mounted from the nginx web proxy\nENV webroot_dir=\"/usr/share/nginx/html\"\n\n# mail address that gets informed when the certificate is about to run out\nENV certificate_email=florian.kleedorfer@researchstudio.at\n\nENV domain_params=\"-d matchat.org -d www.matchat.org -d node.matchat.org -d ownerblue.master.matchat.org -d ownergreen.master.matchat.org -d nodeblue.master.matchat.org -d nodegreen.master.matchat.org\"\n\n# java key store password\nENV key_store_password=changeit\n\n# the certificate files \"privkey.pem\" and \"fullchain.pem\" are generated by letsencrypt certbot in the folder \"live\"\n# and subfolder \"matchat.org\" (as symlinks that point to an archive folder). The certificate is valid for the domain\n# \"matchat.org\" and the subdomains \"www.matchat.org\" and \"node.matchat.org\" (see certificate-request-and-renew.sh)\nENV key_pem_file=\"$main_dir/live/matchat.org/privkey.pem\"\nENV cert_pem_file=\"$main_dir/live/matchat.org/fullchain.pem\"\n\n# the java key store file is generated from the .pem files in the same folder.\nENV pfx_store_file=\"$main_dir/live/matchat.org/t-key-cert.pfx\"\nENV jks_store_file=\"$main_dir/live/matchat.org/t-keystore.jks\"\n\nADD certificate-request-and-renew.sh /usr/local/bin/certificate-request-and-renew.sh\nRUN chmod +x /usr/local/bin/certificate-request-and-renew.sh\nRUN dos2unix /usr/local/bin/certificate-request-and-renew.sh\n\n# execute cron to keep container running\n#RUN touch /var/log/cron.log\n#CMD cron && tail -f /var/log/cron.log\n\n# try to renew letsencrypt certificates\n# Changed from 'RUN' command as this is not a command to change the container but the command to be executed when the container runs\nENTRYPOINT /usr/local/bin/certificate-request-and-renew.sh\n"
}