{
  "startTime": 1674239550733,
  "endTime": 1674239551455,
  "originalSmells": [
    {
      "rule": "mkdirUsrSrcThenRemove",
      "position": {
        "lineStart": 141,
        "lineEnd": 141,
        "columnStart": 1,
        "columnEnd": 19
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 150,
        "lineEnd": 150,
        "columnStart": 1,
        "columnEnd": 25
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# NOTE: THIS DOCKERFILE IS GENERATED VIA \"update.sh\"\n#\n# PLEASE DO NOT EDIT IT DIRECTLY.\n#\n\nFROM debian:stretch-slim\n\n# prevent Debian's PHP packages from being installed\n# https://github.com/docker-library/php/pull/542\nRUN set -eux; \\\n\t{ \\\n\t\techo 'Package: php*'; \\\n\t\techo 'Pin: release *'; \\\n\t\techo 'Pin-Priority: -1'; \\\n\t} > /etc/apt/preferences.d/no-debian-php\n\n# dependencies required for running \"phpize\"\n# (see persistent deps below)\nENV PHPIZE_DEPS \\\n\t\tautoconf \\\n\t\tdpkg-dev \\\n\t\tfile \\\n\t\tg++ \\\n\t\tgcc \\\n\t\tlibc-dev \\\n\t\tmake \\\n\t\tpkg-config \\\n\t\tre2c\n\n# persistent / runtime deps\nRUN apt-get update && apt-get install -y \\\n\t\t$PHPIZE_DEPS \\\n\t\tca-certificates \\\n\t\tcurl \\\n\t\txz-utils \\\n\t--no-install-recommends && rm -r /var/lib/apt/lists/*\n\nENV PHP_INI_DIR /usr/local/etc/php\nRUN set -eux; \\\n\tmkdir -p \"$PHP_INI_DIR/conf.d\"; \\\n# allow running as an arbitrary user (https://github.com/docker-library/php/issues/743)\n\t[ ! -d /var/www/html ]; \\\n\tmkdir -p /var/www/html; \\\n\tchown www-data:www-data /var/www/html; \\\n\tchmod 777 /var/www/html\n\n##<autogenerated>##\nENV APACHE_CONFDIR /etc/apache2\nENV APACHE_ENVVARS $APACHE_CONFDIR/envvars\n\nRUN set -eux; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends apache2; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\t\\\n# generically convert lines like\n#   export APACHE_RUN_USER=www-data\n# into\n#   : ${APACHE_RUN_USER:=www-data}\n#   export APACHE_RUN_USER\n# so that they can be overridden at runtime (\"-e APACHE_RUN_USER=...\")\n\tsed -ri 's/^export ([^=]+)=(.*)$/: ${\\1:=\\2}\\nexport \\1/' \"$APACHE_ENVVARS\"; \\\n\t\\\n# setup directories and permissions\n\t. \"$APACHE_ENVVARS\"; \\\n\tfor dir in \\\n\t\t\"$APACHE_LOCK_DIR\" \\\n\t\t\"$APACHE_RUN_DIR\" \\\n\t\t\"$APACHE_LOG_DIR\" \\\n\t; do \\\n\t\trm -rvf \"$dir\"; \\\n\t\tmkdir -p \"$dir\"; \\\n\t\tchown \"$APACHE_RUN_USER:$APACHE_RUN_GROUP\" \"$dir\"; \\\n# allow running as an arbitrary user (https://github.com/docker-library/php/issues/743)\n\t\tchmod 777 \"$dir\"; \\\n\tdone; \\\n\t\\\n# delete the \"index.html\" that installing Apache drops in here\n\trm -rvf /var/www/html/*; \\\n\t\\\n# logs should go to stdout / stderr\n\tln -sfT /dev/stderr \"$APACHE_LOG_DIR/error.log\"; \\\n\tln -sfT /dev/stdout \"$APACHE_LOG_DIR/access.log\"; \\\n\tln -sfT /dev/stdout \"$APACHE_LOG_DIR/other_vhosts_access.log\"; \\\n\tchown -R --no-dereference \"$APACHE_RUN_USER:$APACHE_RUN_GROUP\" \"$APACHE_LOG_DIR\"\n\n# Apache + PHP requires preforking Apache for best results\nRUN a2dismod mpm_event && a2enmod mpm_prefork\n\n# PHP files should be handled by PHP, and should be preferred over any other file type\nRUN { \\\n\t\techo '<FilesMatch \\.php$>'; \\\n\t\techo '\\tSetHandler application/x-httpd-php'; \\\n\t\techo '</FilesMatch>'; \\\n\t\techo; \\\n\t\techo 'DirectoryIndex disabled'; \\\n\t\techo 'DirectoryIndex index.php index.html'; \\\n\t\techo; \\\n\t\techo '<Directory /var/www/>'; \\\n\t\techo '\\tOptions -Indexes'; \\\n\t\techo '\\tAllowOverride All'; \\\n\t\techo '</Directory>'; \\\n\t} | tee \"$APACHE_CONFDIR/conf-available/docker-php.conf\" \\\n\t&& a2enconf docker-php\n\nENV PHP_EXTRA_BUILD_DEPS apache2-dev\nENV PHP_EXTRA_CONFIGURE_ARGS --with-apxs2 --disable-cgi\n##</autogenerated>##\n\n# Apply stack smash protection to functions using local buffers and alloca()\n# Make PHP's main executable position-independent (improves ASLR security mechanism, and has no performance impact on x86_64)\n# Enable optimization (-O2)\n# Enable linker optimization (this sorts the hash buckets to improve cache locality, and is non-default)\n# Adds GNU HASH segments to generated executables (this is used if present, and is much faster than sysv hash; in this configuration, sysv hash is also generated)\n# https://github.com/docker-library/php/issues/272\nENV PHP_CFLAGS=\"-fstack-protector-strong -fpic -fpie -O2\"\nENV PHP_CPPFLAGS=\"$PHP_CFLAGS\"\nENV PHP_LDFLAGS=\"-Wl,-O1 -Wl,--hash-style=both -pie\"\n\nENV GPG_KEYS CBAF69F173A0FEA4B537F470D66C9593118BCCB6 F38252826ACD957EF380D39F2F7956BC5DA04B5D\n\n#ENV PHP_VERSION 7.3.5\n#ENV PHP_URL=\"https://www.php.net/get/php-7.3.5.tar.xz/from/this/mirror\" PHP_ASC_URL=\"https://www.php.net/get/php-7.3.5.tar.xz.asc/from/this/mirror\"\n#ENV PHP_SHA256=\"e1011838a46fd4a195c8453b333916622d7ff5bce4aca2d9d99afac142db2472\" PHP_MD5=\"\"\n\nRUN set -xe; \\\n\n\tfetchDeps=' \\\n\t\tgit wget \\\n\t'; \\\n\tif ! command -v gpg > /dev/null; then \\\n\t\tfetchDeps=\"$fetchDeps \\\n\t\t\tdirmngr \\\n\t\t\tgnupg \\\n\t\t\"; \\\n\tfi; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends $fetchDeps; \\\n\trm -rf /var/lib/apt/lists/*; \\\n\n\tmkdir -p /usr/src; rm -rf /usr/src \\\n\tcd /usr/src; \\\n\n\tgit clone http://git.php.net/repository/php-src.git php; \\\n\tcd php; \\\n\tgit checkout PHP-7.4; \\\n\t./buildconf --force; \\\n\trm -rf .git; \\\n\tcd /usr/src; \\\n\ttar -cJf php.tar.xz php; rm php.tar.xz \\\n\trm -rf php; \\\n\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps\n\nCOPY docker-php-source /usr/local/bin/\n\nRUN set -eux; \\\n\t\\\n\tsavedAptMark=\"$(apt-mark showmanual)\"; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends \\\n\t\tbison \\\n\t\tlibcurl4-openssl-dev \\\n\t\tlibedit-dev \\\n\t\tlibonig-dev \\\n\t\tlibsodium-dev \\\n\t\tlibsqlite3-dev \\\n\t\tlibssl-dev \\\n\t\tlibxml2-dev \\\n\t\tzlib1g-dev \\\n\t\tlibffi-dev \\\n\t\t${PHP_EXTRA_BUILD_DEPS:-} \\\n\t; \\\n##<argon2>##\n\tsed -e 's/stretch/buster/g' /etc/apt/sources.list > /etc/apt/sources.list.d/buster.list; \\\n\t{ \\\n\t\techo 'Package: *'; \\\n\t\techo 'Pin: release n=buster'; \\\n\t\techo 'Pin-Priority: -10'; \\\n\t\techo; \\\n\t\techo 'Package: libargon2*'; \\\n\t\techo 'Pin: release n=buster'; \\\n\t\techo 'Pin-Priority: 990'; \\\n\t} > /etc/apt/preferences.d/argon2-buster; \\\n\tapt-get update; \\\n\tapt-get install -y --no-install-recommends libargon2-dev; \\\n##</argon2>##\n\trm -rf /var/lib/apt/lists/*; \\\n\t\\\n\texport \\\n\t\tCFLAGS=\"$PHP_CFLAGS\" \\\n\t\tCPPFLAGS=\"$PHP_CPPFLAGS\" \\\n\t\tLDFLAGS=\"$PHP_LDFLAGS\" \\\n\t; \\\n\tdocker-php-source extract; \\\n\tcd /usr/src/php; \\\n\tgnuArch=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\"; \\\n\tdebMultiarch=\"$(dpkg-architecture --query DEB_BUILD_MULTIARCH)\"; \\\n# https://bugs.php.net/bug.php?id=74125\n\tif [ ! -d /usr/include/curl ]; then \\\n\t\tln -sT \"/usr/include/$debMultiarch/curl\" /usr/local/include/curl; \\\n\tfi; \\\n\t./configure \\\n\t\t--build=\"$gnuArch\" \\\n\t\t--with-config-file-path=\"$PHP_INI_DIR\" \\\n\t\t--with-config-file-scan-dir=\"$PHP_INI_DIR/conf.d\" \\\n\t\t\\\n\t\t--with-ffi \\\n# make sure invalid --configure-flags are fatal errors intead of just warnings\n\t\t--enable-option-checking=fatal \\\n\t\t\\\n# https://github.com/docker-library/php/issues/439\n\t\t--with-mhash \\\n\t\t\\\n# --enable-ftp is included here because ftp_ssl_connect() needs ftp to be compiled statically (see https://github.com/docker-library/php/issues/236)\n\t\t--enable-ftp \\\n# --enable-mbstring is included here because otherwise there's no way to get pecl to use it properly (see https://github.com/docker-library/php/issues/195)\n\t\t--enable-mbstring \\\n# --enable-mysqlnd is included here because it's harder to compile after the fact than extensions are (since it's a plugin for several extensions, not an extension in itself)\n\t\t--enable-mysqlnd \\\n# https://wiki.php.net/rfc/argon2_password_hash (7.2+)\n\t\t--with-password-argon2 \\\n# https://wiki.php.net/rfc/libsodium\n\t\t#--with-sodium=shared \\\n        # TODO: The above resulted in: undefined symbol: sodium_init\n\t\t# https://github.com/docker-library/php/blob/master/7.3/stretch/fpm/Dockerfile#L173\n\t\t--with-sodium \\\n\t\t\\\n\t\t--with-curl \\\n\t\t--with-libedit \\\n\t\t--with-openssl \\\n\t\t--with-zlib \\\n\t\t\\\n# Pear has been disabled by default and therefore pecl won't be available:\n# Branch: PHP-7.4\n# Commit: e93d6d97aab7a5de1f7b8dc750ca9d08214de8c4\n\t\t--with-pear \\\n# bundled pcre does not support JIT on s390x\n# https://manpages.debian.org/stretch/libpcre3-dev/pcrejit.3.en.html#AVAILABILITY_OF_JIT_SUPPORT\n\t\t$(test \"$gnuArch\" = 's390x-linux-gnu' && echo '--without-pcre-jit') \\\n\t\t--with-libdir=\"lib/$debMultiarch\" \\\n\t\t\\\n\t\t${PHP_EXTRA_CONFIGURE_ARGS:-} \\\n\t; \\\n\tmake -j \"$(nproc)\"; \\\n\tfind -type f -name '*.a' -delete; \\\n\tmake install; \\\n\tfind /usr/local/bin /usr/local/sbin -type f -executable -exec strip --strip-all '{}' + || true; \\\n\tmake clean; \\\n\t\\\n# https://github.com/docker-library/php/issues/692 (copy default example \"php.ini\" files somewhere easily discoverable)\n\tcp -v php.ini-* \"$PHP_INI_DIR/\"; \\\n\t\\\n\tcd /; \\\n\tdocker-php-source delete; \\\n\t\\\n# reset apt-mark's \"manual\" list so that \"purge --auto-remove\" will remove all build dependencies\n\tapt-mark auto '.*' > /dev/null; \\\n\t[ -z \"$savedAptMark\" ] || apt-mark manual $savedAptMark; \\\n\tfind /usr/local -type f -executable -exec ldd '{}' ';' \\\n\t\t| awk '/=>/ { print $(NF-1) }' \\\n\t\t| sort -u \\\n\t\t| xargs -r dpkg-query --search \\\n\t\t| cut -d: -f1 \\\n\t\t| sort -u \\\n\t\t| xargs -r apt-mark manual \\\n\t; \\\n\tapt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\n\t\\\n\tphp --version; \\\n\t\\\n# https://github.com/docker-library/php/issues/443\n\tpecl update-channels; \\\n\trm -rf /tmp/pear ~/.pearrc\n\nCOPY docker-php-ext-* docker-php-entrypoint /usr/local/bin/\n\n# sodium was built as a shared module (so that it can be replaced later if so desired), so let's enable it too (https://github.com/docker-library/php/issues/598)\n# RUN docker-php-ext-enable sodium\n\nENTRYPOINT [\"docker-php-entrypoint\"]\n##<autogenerated>##\nRUN docker-php-ext-install opcache && mv /usr/local/etc/php/php.ini-production /usr/local/etc/php/php.ini\nCOPY apache2-foreground /usr/local/bin/\nCOPY index.php /var/www/html/index.php\nCOPY preload.php /var/www/html/preload.php\nCOPY php.ini-nextphp /usr/local/etc/php/conf.d/php-nextphp.ini\nCOPY flag /flag\nWORKDIR /var/www/html\n\n\nRUN a2enmod dump_io && { \\\n\t\techo 'LogLevel dumpio:trace7'; \\\n                echo 'DumpIOInput On'; \\\n        } | tee \"$APACHE_CONFDIR/conf-available/dumpio.conf\" \\\n        && a2enconf dumpio && chown root:root /var/www/html && chmod 0755 -R /var/www/html\n\nEXPOSE 80\nCMD [\"apache2-foreground\"]\n##</autogenerated>##\n"
}