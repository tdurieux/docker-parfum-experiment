{
  "startTime": 1674249163767,
  "endTime": 1674249163997,
  "originalSmells": [
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 26,
        "lineEnd": 53,
        "columnStart": 2,
        "columnEnd": 15
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# First step: Composer dependencies & autoloader\nFROM composer:1.7 as composer\n\nWORKDIR /opt/app/\n\n# First copy only the composer files, to avoid re-downloading dependencies\n# every time the source code changes.\nCOPY composer.json composer.lock ./\nRUN composer install \\\n    --ignore-platform-reqs \\\n    --no-interaction \\\n    --no-plugins \\\n    --prefer-dist \\\n    --no-dev \\\n    --no-autoloader \\\n    --no-scripts\n\n# Then copy the whole source code, and generate the autoloader.\nCOPY . .\nRUN composer dump-autoload --optimize\n\n# Second step: creation of the executable image\nFROM alpine:3.6\n\nRUN apk update && \\\n  apk upgrade && \\\n  apk add --no-cache \\\n\tapache2 \\\n\topenssl \\\n    openssh \\\n    tzdata \\\n    openntpd \\\n    bash \\\n\tphp7-apache2 \\\n\tphp7 \\\n\tphp7-phar \\\n\tphp7-json \\\n\tphp7-iconv \\\n\tphp7-openssl \\\n\tphp7-xdebug \\\n\tphp7-mbstring \\\n\tphp7-dom \\\n\tphp7-pdo \\\n\tphp7-zip \\\n\tphp7-gd \\\n\tphp7-pdo_mysql \\\n\tphp7-curl \\\n\tphp7-apcu \\\n\tphp7-ctype \\\n\tphp7-session \\\n\tphp7-simplexml \\\n\tphp7-xsl \\\n\tphp7-fileinfo \\\n\tphp7-tokenizer\n\nRUN cp /usr/bin/php7 /usr/bin/php && rm -f /var/cache/apk/*\n\nRUN mkdir /run/apache2 \\\n    && sed -i \"s/^#LoadModule\\ rewrite_module/LoadModule\\ rewrite_module/\" /etc/apache2/httpd.conf \\\n    && sed -i \"s/^#LoadModule\\ session_module/LoadModule\\ session_module/\" /etc/apache2/httpd.conf \\\n    && sed -i \"s/^#LoadModule\\ session_cookie_module/LoadModule\\ session_cookie_module/\" /etc/apache2/httpd.conf \\\n    && sed -i \"s/^#LoadModule\\ session_crypto_module/LoadModule\\ session_crypto_module/\" /etc/apache2/httpd.conf \\\n    && sed -i \"s/^#LoadModule\\ deflate_module/LoadModule\\ deflate_module/\" /etc/apache2/httpd.conf \\\n    && sed -i \"s/^#ServerName\\ www.example.com:80/ServerName\\ localhost/\" /etc/apache2/httpd.conf \\\n    && sed -i \"s/^Listen\\ 80/Listen\\ 0.0.0.0:80/\" /etc/apache2/httpd.conf \\\n    && sed -i \"s#^DocumentRoot \\\".*#DocumentRoot \\\"/opt/app/web\\\"#\" /etc/apache2/httpd.conf \\\n    && printf \"\\n<Directory \\\"/opt/app/web\\\">\\n\\tAllowOverride All\\n\\tOptions -Indexes\\n\\tRequire all granted\\n</Directory>\\n\" >> /etc/apache2/httpd.conf \\\n    && sed -i \"s/^variables_order\\ =\\ \\\"GPCS\\\"/variables_order\\ =\\ \\\"EGPCS\\\"/\" /etc/php7/php.ini \\\n    && sed -i \"s/^;realpath_cache_size\\ =\\ 4096k/realpath_cache_size=4096K/\" /etc/php7/php.ini \\\n    && sed -i \"s/^;realpath_cache_ttl\\ =\\ 120/realpath_cache_ttl=600/\" /etc/php7/php.ini \\\n    #&& sed -i \"s/^;opcache.validate_timestamps=1/opcache.validate_timestamps=0/\" /etc/php7/php.ini \\\n    && sed -i \"s/^;opcache.memory_consumption=128/opcache.memory_consumption=256/\" /etc/php7/php.ini \\\n    && sed -i \"s/^;opcache.max_accelerated_files=10000/opcache.max_accelerated_files=20000/\" /etc/php7/php.ini \\\n    && sed -i \"s/^;date.timezone\\ =/date.timezone\\ =\\ \\\"Europe\\/Paris\\\"/\" /etc/php7/php.ini \\\n    && sed -i \"s/^;intl.default_locale\\ =/intl.default_locale\\ =\\ \\\"fr_FR.UTF-8\\\"/\" /etc/php7/php.ini \\\n    && ln -sfT /dev/stderr /var/log/apache2/error.log \\\n    && ln -sfT /dev/stdout /var/log/apache2/access.log\n\nCOPY build/entrypoint.sh /\nRUN chmod +x /entrypoint.sh\n\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"httpd\", \"-D\", \"FOREGROUND\"]\nEXPOSE 80\n\nVOLUME /opt/app/web/uploads\n\nENV SYMFONY_LOG_DIR=/var/log/symfony \\\n  SYMFONY_CACHE_DIR=/var/cache/symfony \\\n  SYMFONY_ENVIRONMENT=prod \\\n  SYMFONY_DEBUG=false\n\nWORKDIR /opt/app\nCOPY --from=composer /opt/app/vendor vendor\nCOPY . ."
}