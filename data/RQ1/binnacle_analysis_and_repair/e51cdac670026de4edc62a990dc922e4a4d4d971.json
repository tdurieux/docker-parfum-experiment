{
  "startTime": 1674245773029,
  "endTime": 1674245773186,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 80,
        "lineEnd": 80,
        "columnStart": 4,
        "columnEnd": 24
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM bigm/base-deb-tools\n# see: https://github.com/Icinga/docker-icinga2\n\n# install icinga2\nRUN /xt/tools/_ppa_install ppa:formorer/icinga \\\n    apache2-utils php5-cli php5-mysql \\\n    icinga2-common icinga2 icinga2-ido-mysql \\\n    icinga2-classicui \\\n    icingaweb2 icingaweb2-module-monitoring icingaweb2-module-doc \\\n    nagios-plugins nagios-plugins-contrib nagios-plugins-extra\n\n# create api certificates and users (will be overridden later)\nRUN icinga2 api setup\n\n# set icinga2 NodeName and create proper certificates required for the API\nRUN sed -i -e 's/^.* NodeName = .*/const NodeName = \"docker-icinga2\"/gi' /etc/icinga2/constants.conf; \\\n icinga2 pki new-cert --cn docker-icinga2 --key /etc/icinga2/pki/docker-icinga2.key --csr /etc/icinga2/pki/docker-icinga2.csr; \\\n icinga2 pki sign-csr --csr /etc/icinga2/pki/docker-icinga2.csr --cert /etc/icinga2/pki/docker-icinga2.crt;\n\n# configure PHP timezone\nRUN sed -i 's/;date.timezone =/date.timezone = UTC/g' /etc/php5/apache2/php.ini\n\n# enable features\nRUN icinga2 feature enable command \\\n    && icinga2 feature enable livestatus \\\n    && usermod -a -G nagios www-data\n## icinga2 feature enable compatlog ??? http://docs.icinga.org/icinga2/latest/doc/module/icinga2/chapter/icinga2-features#db-ido\n\nRUN /xt/tools/_apt_install mysql-client python-pip python-xmpp python-dns\n\n# create needed folders for later \"icinga2 daemon\" (based on /etc/init.d/icinga2 start)\nADD root/ /\nRUN \\\n    mkdir -p /etc/icingaweb2/enabledModules \\\n    && ln -s /usr/share/icingaweb2/modules/monitoring /etc/icingaweb2/enabledModules/monitoring \\\n    && ln -s /usr/share/icingaweb2/modules/doc /etc/icingaweb2/enabledModules/doc \\\n    && ln -s /usr/share/icingaweb2/modules/iframe /etc/icingaweb2/enabledModules/iframe \\\n    && chown -R www-data:nagios /etc/icingaweb2/* \\\n    && mkdir -p /var/run/icinga2/cmd \\\n    && chown nagios:nagios /var/run/icinga2 \\\n    && chmod 0755 /var/run/icinga2 \\\n    && chown nagios:nagios /var/run/icinga2/cmd \\\n    && chmod 2710 /var/run/icinga2/cmd\n\n#    && find /etc/icingaweb2 -type f -name \"*.ini\" -exec chmod 660 {} \\; \\\n#    && find /etc/icingaweb2 -type d -exec chmod 2770 {} \\; \\\n\nADD startup/* /xt/startup/\nADD supervisor.d/* /etc/supervisord.d/\n\nEXPOSE 80 443 5665\n\nENV ICINGAWEB_USER admin\nENV ICINGAWEB_REALM \"Icinga Web 2\"\n#ENV ICINGAWEB_PASSWORD\n\n#ENV ICINGAWEB_MYSQL_HOST localhost\nENV ICINGAWEB_MYSQL_USER icingaweb2\nENV ICINGAWEB_MYSQL_PASSWORD secret\nENV ICINGAWEB_MYSQL_DB icinga2\nENV ICINGAWEB_MYSQL_PORT \"\"\nENV ICINGAWEB_MYSQL_FROM \"%\"\n\n#VOLUME [\"/etc/icinga2\", \"/etc/icingaweb2\", \"/etc/icinga2-classicui\", \"/var/lib/icinga2\", \"/usr/share/icingaweb2\"]\n\n# folders under /xt/defaults will be populated in instance if they are empty\nRUN mkdir -p /xt/defaults/etc \\\n    && cp -rp /etc/icinga2 /xt/defaults/etc/icinga2 \\\n    && cp -rp /etc/icingaweb2 /xt/defaults/etc/icingaweb2 \\\n    && cp -rp /etc/icinga2-classicui /xt/defaults/etc/icinga2-classicui\n\n# syntax highlighting\n#RUN echo '## Icinga 2' >> /etc/nanorc \\\n#    && echo 'include \"/usr/share/icinga2-common/syntax/nano/icinga2.nanorc\"' >> /etc/nanorc \\\n#    && mkdir /usr/share/vim/vimfiles/{syntax,ftdetect} \\\n#    && cp -a /usr/share/icinga2-common/syntax/vim/ftdetect/. /usr/share/vim/vimfiles/ftdetect/ \\\n#    && cp -a /usr/share/icinga2-common/syntax/vim/syntax/. /usr/share/vim/vimfiles/syntax/\n\n# HipChat notification support\nRUN pip install --no-cache-dir hipsaint\n\n# TODO graphite support\n"
}