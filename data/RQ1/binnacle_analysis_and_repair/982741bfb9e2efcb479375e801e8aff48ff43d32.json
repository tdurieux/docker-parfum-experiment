{
  "startTime": 1674249525053,
  "endTime": 1674249525275,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 10,
        "lineEnd": 10,
        "columnStart": 18,
        "columnEnd": 77
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM bioinstaller/opencpu:latest\n\n## This handle reaches Jianfeng\nMAINTAINER \"Jianfeng Li\" lee_jianfeng@life2cloud.com\n\nADD . /tmp/BioInstaller\n\nADD https://raw.githubusercontent.com/JhuangLab/annovarR/master/inst/docker/shiny-server.conf /etc/shiny-server/shiny-server.conf\nADD https://raw.githubusercontent.com/JhuangLab/annovarR/master/inst/docker/shiny-apache.conf /etc/apache2/sites-enabled/000-default.conf\n\nRun apt update && apt install --no-install-recommends -y lmodern openssl tcl environment-modules qpdf \\\n    && Rscript -e \"install.packages('prettydoc')\" \\\n    && Rscript -e \"devtools::install('/tmp/BioInstaller')\" \\\n    && Rscript -e \"devtools::install_github('openbiox/bioshiny/src/bioshiny')\" \\\n    && ln -s /usr/local/lib/R/site-library/bioshiny/extdata/shiny /srv/shiny-server/bioshiny \\\n    && mkdir /home/opencpu/.bioshiny \\\n    && chown -R opencpu /home/opencpu/.bioshiny \\\n    && runuser -s /bin/bash -l opencpu -c \"Rscript -e 'bioshiny::copy_configs()'\" \\\n    && chown -R opencpu /etc/shiny-server/shiny-server.conf \\\n    && chmod a+r /etc/apache2/sites-enabled/000-default.conf \\\n    && echo 'LC_ALL=\"en_US.UTF-8\"\\nLANG=\"en_US.UTF-8\"' >> /etc/R/Renviron \\\n    && Rscript -e \"source(system.file('extdata', 'shiny/deps.R', package = 'bioshiny'))\" \\\n    && runuser -s /bin/bash -l opencpu -c \"export BIO_SOFTWARES_DB_ACTIVE=/home/opencpu/.bioshiny/info.yaml\" \\\n    && export BIO_SOFTWARES_DB_ACTIVE=\"/home/opencpu/.bioshiny/info.yaml\" \\\n    && export BIOSHINY_CONFIG=\"/home/opencpu/.bioshiny/shiny.config.yaml\" \\\n    && echo 'source /usr/share/modules/init/bash\\n' >> /etc/profile \\\n    && echo 'export BIO_SOFTWARES_DB_ACTIVE=\"/home/opencpu/.bioshiny/info.yaml\"\\n' >> /home/opencpu/.bashrc \\\n    && echo 'BIOSHINY_CONFIG=\"/home/opencpu/.bioshiny/shiny.config.yaml\"\\n' >> /home/opencpu/.Renviron \\\n    && echo 'export BIO_SOFTWARES_DB_ACTIVE=\"/home/opencpu/.bioshiny/info.yaml\"\\n' >> /home/opencpu/.bashrc \\\n    && echo 'BIOSHINY_CONFIG=\"/home/opencpu/.bioshiny/shiny.config.yaml\"\\n' >> /home/opencpu/.Renviron \\\n    && runuser -s /bin/bash -l opencpu -c \"export AUTO_CREATE_BIOSHINY_DIR=TRUE\" \\\n    && chown -R opencpu /home/opencpu/ \\\n    && chown -R opencpu /usr/local/lib/R/site-library \\\n    && chown -R opencpu /usr/lib/R/library \\\n    && echo 'file=`ls /usr/local/lib/R/site-library/`; cd /usr/lib/R/library; for i in ${file}; do rm -rf ${i};done' >> /tmp/rm_script \\\n    && sh /tmp/rm_script \\\n    && ln -sf /usr/local/lib/R/site-library/* /usr/lib/R/library/ \\\n    && rm /tmp/rm_script \\\n    && rm -rf /tmo/BioInstaller \\\n    && rm -rf /var/lib/apt/lists/* \\\n    && rm -rf /tmp/downloaded_packages/ /tmp/*.rds\n\nRun runuser -s /bin/bash -l opencpu -c \"Rscript -e \\\"BioInstaller::install.bioinfo('miniconda2', destdir = '/home/opencpu/opt/')\\\"\" \\\n    && rm /home/opencpu/opt/*.sh \\\n    && runuser -s /bin/bash -l opencpu -c \"Rscript -e \\\"BioInstaller::install.bioinfo('spack', version = 'master', destdir = '/home/opencpu/opt/spack')\\\"\"\n\nRun echo 'source /etc/profile' >> /home/opencpu/.bashrc \\\n    && echo 'source /etc/profile' >> /root/.bashrc \\\n    && echo 'export SPACK_ROOT=/home/opencpu/opt/spack;source $SPACK_ROOT/share/spack/setup-env.sh;' >> /etc/profile \\\n    && echo 'export PATH=/home/opencpu/opt/miniconda2/bin:$PATH\\n' >> /etc/profile \\\n    && echo \"options('repos' = c(CRAN='https://mirrors.tuna.tsinghua.edu.cn/CRAN/'))\" >> /home/opencpu/.Rprofile \\\n    && echo \"options(BioC_mirror='https://mirrors.tuna.tsinghua.edu.cn/bioconductor')\" >> /home/opencpu/.Rprofile \\\n    && echo \"options('repos' = c(CRAN='https://mirrors.tuna.tsinghua.edu.cn/CRAN/'))\" >> /root/.Rprofile \\\n    && echo \"options(BioC_mirror='https://mirrors.tuna.tsinghua.edu.cn/bioconductor')\" >> /root/.Rprofile\n\nCMD service cron start && runuser -s /bin/bash -l opencpu -c '. ~/.bashrc; export AUTO_CREATE_BIOSHINY_DIR=\"TRUE\";Rscript -e \"bioshiny::set_shiny_workers(3, auto_create = TRUE)\" &' && runuser -s /bin/bash -l opencpu -c '. ~/.bashrc; sh /usr/bin/start_shiny_server' && . /etc/profile; /usr/lib/rstudio-server/bin/rserver && apachectl -DFOREGROUND\n"
}