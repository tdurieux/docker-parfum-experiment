{
  "startTime": 1674243374900,
  "endTime": 1674243375073,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 26,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 9
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 32,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 14
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ubuntu:18.04\nMAINTAINER Przemyslaw Lis <przemek@concertoplatform.com>\n\nARG CRAN_MIRROR=https://cloud.r-project.org\n\nENV CONCERTO_PASSWORD=admin\nENV DB_HOST=localhost\nENV DB_PORT=3306\nENV DB_NAME=concerto\nENV DB_USER=concerto\nENV DB_PASSWORD=changeme\nENV NGINX_PORT=80\nENV PHP_FPM_PM=dynamic\nENV PHP_FPM_PM_MAX_CHILDREN=30\nENV PHP_FPM_PM_START_SERVERS=10\nENV PHP_FPM_PM_MIN_SPARE_SERVERS=5\nENV PHP_FPM_PM_MAX_SPARE_SERVERS=15\nENV PHP_FPM_PM_PROCESS_IDLE_TIMEOUT=10s\nENV PHP_FPM_PM_MAX_REQUESTS=300\nENV TZ=Europe/London\n\nCOPY . /app/concerto/\nADD https://raw.githubusercontent.com/vishnubob/wait-for-it/master/wait-for-it.sh /\n\nRUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone \\\n && apt-get update -y \\\n && apt-get -y --no-install-recommends install \\\n    ca-certificates \\\n    gnupg \\\n && echo \"deb $CRAN_MIRROR/bin/linux/ubuntu bionic-cran35/\" | tee -a /etc/apt/sources.list \\\n && apt-key adv --no-tty --keyserver keyserver.ubuntu.com --recv-keys E298A3A825C0D65DFD57CBB651716619E084DAB9 \\\n && apt-get update -y \\\n && apt-get -y --no-install-recommends install \\\n    cron \\\n    curl \\\n    gettext \\\n    libcurl4-openssl-dev \\\n    libmariadbclient-dev \\\n    libxml2-dev \\\n    libssl-dev \\\n    locales \\\n    nginx \\\n    php7.2-curl \\\n    php7.2-mbstring \\\n    php7.2-mysql \\\n    php7.2-xml \\\n    php7.2-zip \\\n    php-fpm \\\n    procps \\\n    r-base \\\n    r-base-dev \\\n && rm -rf /var/lib/apt/lists/* \\\n && sed -i 's/# en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/' /etc/locale.gen \\\n && locale-gen \"en_US.UTF-8\" \\\n && Rscript -e \"install.packages(c('session','RMySQL','jsonlite','catR','digest','rjson','httr'), repos='$CRAN_MIRROR')\" \\\n && R CMD INSTALL /app/concerto/src/Concerto/TestBundle/Resources/R/concerto5 \\\n && chmod +x /wait-for-it.sh \\\n && php /app/concerto/bin/console concerto:r:cache \\\n && crontab -l | { cat; echo \"* * * * * . /root/env.sh; /usr/bin/php /app/concerto/bin/console concerto:schedule:tick --env=prod >> /var/log/cron.log 2>&1\"; } | crontab - \\\n && crontab -l | { cat; echo \"0 0 * * * . /root/env.sh; /usr/bin/php /app/concerto/bin/console concerto:sessions:clear --env=prod >> /var/log/cron.log 2>&1\"; } | crontab - \\\n && crontab -l | { cat; echo \"*/5 * * * * . /root/env.sh; /usr/bin/php /app/concerto/bin/console concerto:sessions:log --env=prod >> /var/log/cron.log 2>&1\"; } | crontab - \\\n && rm -f /etc/nginx/sites-available/default \\\n && rm -f /etc/nginx/sites-enabled/default \\\n && ln -fs /etc/nginx/sites-available/concerto.conf /etc/nginx/sites-enabled/concerto.conf\n\nCOPY build/docker/php/php.ini /etc/php/7.2/fpm/php.ini\nCOPY build/docker/nginx/nginx.conf /etc/nginx/nginx.conf\nCOPY build/docker/nginx/concerto.conf.tpl /etc/nginx/sites-available/concerto.conf.tpl\nCOPY build/docker/php-fpm/php-fpm.conf /etc/php/7.2/fpm/php-fpm.conf\nCOPY build/docker/php-fpm/www.conf /etc/php/7.2/fpm/pool.d/www.conf\n\nRUN rm -rf /app/concerto/src/Concerto/PanelBundle/Resources/public/files \\\n && rm -rf /app/concerto/src/Concerto/TestBundle/Resources/sessions\n\nEXPOSE 80 9000\nWORKDIR /app/concerto\nHEALTHCHECK --interval=1m --start-period=1m CMD curl -f http://localhost/api/check/health || exit 1\n\nCMD printenv | sed 's/^\\([a-zA-Z0-9_]*\\)=\\(.*\\)$/export \\1=\"\\2\"/g' > /root/env.sh \\\n && mkdir -p /data/files \\\n && chown -R www-data:www-data /data/files \\\n && mkdir -p /data/sessions \\\n && chown -R www-data:www-data /data/sessions \\\n && ln -sf /data/files /app/concerto/src/Concerto/PanelBundle/Resources/public \\\n && ln -sf /data/sessions /app/concerto/src/Concerto/TestBundle/Resources \\\n && /wait-for-it.sh $DB_HOST:$DB_PORT -t 300 \\\n && php bin/console concerto:setup --env=prod --admin-pass=$CONCERTO_PASSWORD \\\n && php bin/console concerto:content:import --env=prod --convert \\\n && rm -rf var/cache/* \\\n && php bin/console cache:warmup --env=prod \\\n && chown -R www-data:www-data var/cache \\\n && chown -R www-data:www-data var/logs \\\n && chown -R www-data:www-data var/sessions \\\n && chown -R www-data:www-data src/Concerto/PanelBundle/Resources/import \\\n && chown -R www-data:www-data src/Concerto/TestBundle/Resources/R/fifo \\\n && cron \\\n && cat /etc/nginx/sites-available/concerto.conf.tpl | sed \"s/{{nginx_port}}/$NGINX_PORT/g\" > /etc/nginx/sites-available/concerto.conf \\\n && service nginx start \\\n && php bin/console concerto:forker:start --env=prod  \\\n && /etc/init.d/php7.2-fpm start \\\n && tail -F var/logs/prod.log -n 0"
}