{
  "startTime": 1674236231112,
  "endTime": 1674236231477,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 5,
        "lineEnd": 5,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 50
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 32,
        "lineEnd": 32,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 4,
        "lineEnd": 4,
        "columnStart": 22,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 22,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 22,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 22,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 4,
        "lineEnd": 4,
        "columnStart": 22,
        "columnEnd": 51
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 22,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 9,
        "lineEnd": 9,
        "columnStart": 22,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 13,
        "columnStart": 22,
        "columnEnd": 46
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Start off with ubuntu (https://hub.docker.com/_/ubuntu)\nFROM ubuntu:latest as builder\n\n# Install node (https://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions)\nRUN apt-get update && apt-get install --no-install-recommends -y curl gnupg && rm -rf /var/lib/apt/lists/*;\nRUN curl -f -sL https://deb.nodesource.com/setup_11.x | bash -\nRUN apt-get update && apt-get install --no-install-recommends -y nodejs build-essential && rm -rf /var/lib/apt/lists/*;\n\n# Install bazel (https://docs.bazel.build/versions/master/install-ubuntu.html#install-on-ubuntu)\nRUN apt-get update && apt-get install --no-install-recommends -y openjdk-8-jdk && rm -rf /var/lib/apt/lists/*;\nRUN echo \"deb [arch=amd64] http://storage.googleapis.com/bazel-apt stable jdk1.8\" | \\\n    tee /etc/apt/sources.list.d/bazel.list\nRUN curl -f https://bazel.build/bazel-release.pub.gpg | apt-key add -\nRUN apt-get update && apt-get install --no-install-recommends -y bazel && rm -rf /var/lib/apt/lists/*;\nRUN bazel version  # Extract before loading pentago\n\n# Clone and build pentago\nWORKDIR /pentago/pentago\nADD pentago /pentago/pentago\nADD third_party /pentago/third_party\nADD WORKSPACE /pentago/\nRUN bazel build -c opt --copt=-march=native utility base data/... search end high mid \\\n    @lzma//... @zlib//...\n\n# Test pentago except for mpi\nWORKDIR /pentago/pentago\nRUN bazel test -c opt --copt=-march=native --test_output=errors utility/... base/... \\\n    data/... end/... high/...  mid/... search/...\n\n# Set up node\nWORKDIR /pentago/web/server\nADD web/server /pentago/web/server\nRUN npm install --unsafe-perm && npm cache clean --force;\nRUN node unit.js\n\n# Switch to minimal node.js image, keeping only what we need (see https://hub.docker.com/_/node)\nFROM node:11-alpine\n\n# Bring pentago node back up\nCOPY --from=builder /pentago/web/server /pentago/web/server\nWORKDIR /pentago/web/server\nRUN node unit.js\n\n# Serve!\nWORKDIR /var/pentago\nCMD node /pentago/web/server/server.js --pool 7 --api-key `cat ssl/api-key`\n"
}