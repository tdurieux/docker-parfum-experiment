{
  "startTime": 1674246308062,
  "endTime": 1674246308372,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 8,
        "lineEnd": 8,
        "columnStart": 18,
        "columnEnd": 72
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# crashplan-pro Dockerfile\n#\n# https://github.com/jlesage/docker-crashplan-pro\n#\n\nFROM ubuntu:18.04\nWORKDIR /tmp\nRUN apt update && apt install --no-install-recommends -y build-essential && rm -rf /var/lib/apt/lists/*;\nCOPY uname_wrapper.c /tmp/\nRUN gcc -o /tmp/uname_wrapper.so /tmp/uname_wrapper.c -Wall -Werror -fPIC -shared -ldl\nRUN strip /tmp/uname_wrapper.so\n\n# Pull base image.\nFROM jlesage/baseimage-gui:alpine-3.8-glibc-v3.5.2\n\n# Define software versions.\nARG CRASHPLAN_VERSION=7.0.0\nARG CRASHPLAN_TIMESTAMP=1525200006700\nARG CRASHPLAN_BUILD=581\n\n# Define software download URLs.\n# NOTE: Do not use the following URL, as it may not point to the latest build\n#       number:\n# https://download.code42.com/installs/linux/install/CrashPlanSmb/CrashPlanSmb_${CRASHPLAN_VERSION}_Linux.tgz\nARG CRASHPLAN_URL=https://web-eam-msp.crashplanpro.com/client/installers/CrashPlanSmb_${CRASHPLAN_VERSION}_${CRASHPLAN_TIMESTAMP}_${CRASHPLAN_BUILD}_Linux.tgz\n\n# Define container build variables.\nARG TARGETDIR=/usr/local/crashplan\n\n# Define working directory.\nWORKDIR /tmp\n\n# Install CrashPlan.\nRUN \\\n    add-pkg --virtual build-dependencies cpio curl && \\\n    echo \"Installing CrashPlan...\" && \\\n    # Download CrashPlan.\n    curl -f -# -L ${CRASHPLAN_URL} | tar -xz && \\\n    mkdir -p ${TARGETDIR} && \\\n    # Extract CrashPlan.\n    cat $(ls crashplan-install/*.cpi) | gzip -d -c - | cpio -i --no-preserve-owner --directory=${TARGETDIR} && \\\n    mv \"${TARGETDIR}\"/*.asar \"${TARGETDIR}/electron/resources\" && \\\n    chmod 755 \"${TARGETDIR}/electron/crashplan\" && \\\n    chmod 755 \"${TARGETDIR}/bin/CrashPlanService\" && \\\n    chmod 755 \"${TARGETDIR}/bin/restore-tool\" && \\\n    # Keep a copy of the default config.\n    mv ${TARGETDIR}/conf /defaults/conf && \\\n    # Make sure the UI connects by default to the engine using the loopback IP address (127.0.0.1).\n    sed-patch '/<orgType>BUSINESS<\\/orgType>/a \\\\t<serviceUIConfig>\\n\\t\\t<serviceHost>127.0.0.1<\\/serviceHost>\\n\\t<\\/serviceUIConfig>' /defaults/conf/default.service.xml && \\\n    # Set manifest directory to default config.  It should not be used, but do\n    # like the install script.\n    sed-patch \"s|<backupConfig>|<backupConfig>\\n\\t\\t\\t<manifestPath>/usr/local/var/crashplan</manifestPath>|g\" /defaults/conf/default.service.xml && \\\n    # Add the javaMemoryHeapMax setting to the default service file.\n    sed-patch '/<serviceUIConfig>/i\\\\t<javaMemoryHeapMax nil=\"true\"/>' /defaults/conf/default.service.xml && \\\n    mkdir -p /usr/local/var/crashplan && \\\n    # Prevent automatic updates.\n    rm -r /usr/local/crashplan/upgrade && \\\n    touch /usr/local/crashplan/upgrade && chmod 400 /usr/local/crashplan/upgrade && \\\n    # The configuration directory should be stored outside the container.\n    ln -s /config/conf $TARGETDIR/conf && \\\n    # The cache directory should be stored outside the container.\n    ln -s /config/cache $TARGETDIR/cache && \\\n    # The log directory should be stored outside the container.\n    rm -r $TARGETDIR/log && \\\n    ln -s /config/log $TARGETDIR/log && \\\n    # The '/var/lib/crashplan' directory should be stored outside the container.\n    ln -s /config/var /var/lib/crashplan && \\\n    # The '/repository' directory should be stored outside the container.\n    # NOTE: The '/repository/metadata' directory changed in 6.7.0 changed to\n    #       '/usr/local/crashplan/metadata' in 6.7.1.\n    ln -s /config/repository/metadata /usr/local/crashplan/metadata && \\\n    # Cleanup\n    del-pkg build-dependencies && \\\n    rm -rf /tmp/*\n\n# Misc adjustments.\nRUN  \\\n    # Remove the 'nobody' user.  This is to avoid issue when the container is\n    # running under ID 65534.\n    sed-patch '/^nobody:/d' /defaults/passwd && \\\n    sed-patch '/^nobody:/d' /defaults/group && \\\n    sed-patch '/^nobody:/d' /defaults/shadow && \\\n    # Clear stuff from /etc/fstab to avoid showing irrelevant devices in the open\n    # file dialog window.\n    echo > /etc/fstab && \\\n    # Save the current CrashPlan version.\n    echo \"${CRASHPLAN_VERSION}\" > /defaults/cp_version\n\n# Install dependencies.\nRUN \\\n    add-pkg libselinux --repository http://dl-cdn.alpinelinux.org/alpine/edge/community && \\\n    add-pkg \\\n        gtk+3.0 \\\n        libxscrnsaver \\\n        nss \\\n        eudev \\\n        gconf \\\n        # The following package is used to send key presses to the X process.\n        xdotool \\\n        # For the monitor.\n        yad \\\n        bc\n\n# Adjust the openbox config.\nRUN \\\n    # Maximize only the main/initial window.\n    sed-patch 's/<application type=\"normal\">/<application type=\"normal\" title=\"Code42\">/' \\\n        /etc/xdg/openbox/rc.xml && \\\n    # Make sure the main window is always in the background.\n    sed-patch '/<application type=\"normal\" title=\"Code42\">/a \\    <layer>below</layer>' \\\n        /etc/xdg/openbox/rc.xml\n\n# Enable log monitoring.\nRUN \\\n    sed-patch 's|LOG_FILES=|LOG_FILES=/config/log/service.log|' /etc/logmonitor/logmonitor.conf && \\\n    sed-patch 's|STATUS_FILES=|STATUS_FILES=/config/log/app.log|' /etc/logmonitor/logmonitor.conf\n\n# Generate and install favicons.\nRUN \\\n    APP_ICON_URL=https://github.com/jlesage/docker-templates/raw/master/jlesage/images/crashplan-pro-icon.png && \\\n    install_app_icon.sh \"$APP_ICON_URL\"\n\n# Add files.\nCOPY rootfs/ /\nCOPY --from=0 /tmp/uname_wrapper.so /usr/local/crashplan/\n\n# Set environment variables.\nENV S6_WAIT_FOR_SERVICE_MAXTIME=10000 \\\n    APP_NAME=\"CrashPlan for Small Business\" \\\n    KEEP_APP_RUNNING=1\n\n# Define mountable directories.\nVOLUME [\"/config\"]\nVOLUME [\"/storage\"]\n\n# Metadata.\nLABEL \\\n      org.label-schema.name=\"crashplan-pro\" \\\n      org.label-schema.description=\"Docker container for CrashPlan PRO\" \\\n      org.label-schema.version=\"unknown\" \\\n      org.label-schema.vcs-url=\"https://github.com/jlesage/docker-crashplan-pro\" \\\n      org.label-schema.schema-version=\"1.0\"\n"
}