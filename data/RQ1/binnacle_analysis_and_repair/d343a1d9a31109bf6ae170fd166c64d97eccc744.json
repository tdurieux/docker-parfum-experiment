{
  "startTime": 1674244016082,
  "endTime": 1674244016486,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 27,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 121
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 141,
        "lineEnd": 141,
        "columnStart": 22,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 27,
        "lineEnd": 28,
        "columnStart": 4,
        "columnEnd": 121
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 141,
        "lineEnd": 141,
        "columnStart": 22,
        "columnEnd": 57
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM rocker/rstudio:3.3.2\nMAINTAINER ttickle@broadinstitute.org and Brian Haas (bhaas@broadinstitute.org)\n\n######################\n## Environment\n######################\n\n### locations\nENV BIN /usr/local/bin\nENV DATA /usr/local/data\nENV R_STUDIO /usr/local/R\nENV SRC /usr/local/src\n\n### User setup\nRUN groupadd -g 2000 training && useradd -m -u 2000 -g 2000 training\nRUN echo 'training:training' | chpasswd\nRUN chsh -s /bin/bash training\nENV HOME=/home/training\nRUN echo \"alias ll='ls -la -G'\" >> /home/training/.profile\nRUN usermod -G training,www-data training\n\n######################\n## Dependencies and Tools\n######################\n##############\n## Helper tools\nRUN apt-get update && \\\n    apt-get install --no-install-recommends -y unzip wget git \\\n    libssl-dev libcurl4-openssl-dev libxml2-dev libxt-dev libgstreamer0.10-0 ibgstreamer-plugins-base0.10-0 libcairo2-dev && rm -rf /var/lib/apt/lists/*;\n\n#    r-base r-base-dev \\\n\n##############\n## devtools\n## seurat\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"useful\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"devtools\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"RcppArmadillo\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"reshape\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"Rook\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"rjson\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"RMTstat\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"extRemes\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"pcaMethods\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"SummarizedExperiment\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"pheatmap\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"amap\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"vioplot\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"biocLite(\\\"codetools\\\", dependencies=TRUE)\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"devtools::install_github(\\\"satijalab/seurat\\\")\" >> ${SRC}/install_pkgs.R && \\\n    wget https://cran.r-project.org/src/contrib/Archive/nlme/nlme_3.1-123.tar.gz && \\\n    R CMD INSTALL nlme_3.1-123.tar.gz && \\\n    Rscript ${SRC}/install_pkgs.R\n\nRUN echo \".libPaths(c(\\\"/usr/local/lib/R/site-library\\\",\\\"/usr/local/lib/R/library\\\"))\" > ${SRC}/install_pkgs.R && \\\n    echo \"source(\\\"https://bioconductor.org/biocLite.R\\\")\" > ${SRC}/install_pkgs.R && \\\n    echo \"devtools::install_github(\\\"RGLab/MAST@summarizedExpt\\\")\" >> ${SRC}/install_pkgs.R && \\\n    Rscript ${SRC}/install_pkgs.R\n\n\n# Ports\nEXPOSE 8787\n\n\n## Pull in data from ftp\nWORKDIR ${R_STUDIO}/data\nRUN wget https://data.broadinstitute.org/Trinity/CTAT/single_cell_workshop/data/bipolar_cluster_seurat_demo.Robj && \\\n    wget https://data.broadinstitute.org/Trinity/CTAT/single_cell_workshop/data/bipolar_demo_seurat_pca.Robj && \\\n    wget https://data.broadinstitute.org/Trinity/CTAT/single_cell_workshop/data/bipolar_regress_demo.Robj && \\\n    wget https://data.broadinstitute.org/Trinity/CTAT/single_cell_workshop/data/bipolar_seurat_demo.Robj && \\\n    wget https://data.broadinstitute.org/Trinity/CTAT/single_cell_workshop/data/mast_zlm_demo.Robj && \\\n    wget https://data.broadinstitute.org/Trinity/CTAT/single_cell_workshop/data/small_bipolar.Robj\n\nWORKDIR ${R_STUDIO}/src\nRUN wget https://data.broadinstitute.org/Trinity/CTAT/single_cell_workshop/src/dotplot.R && \\\n    wget https://data.broadinstitute.org/Trinity/CTAT/single_cell_workshop/src/makeNiceMAST.R\n\nWORKDIR ${SRC}\nRUN git clone https://github.com/TimothyTickle/single_cell_analysis.git\n\n\n## For seurat, needs java and unfortunately writes to /usr/local/lib/R/site-library! and needs open permissions\nRUN apt-get update && apt-get install --no-install-recommends -y default-jre htop && apt-get clean && rm -rf /var/lib/apt/lists/*;\nRUN chmod 777 /usr/local/lib/R/site-library\n\n## Rstudio is hard coded to look for /usr/bin/R but I need to the /usr/local/bin/R\n## And cringe the solution...\n#RUN rm /usr/bin/R && ln -s /usr/local/bin/R /usr/bin/R\n"
}