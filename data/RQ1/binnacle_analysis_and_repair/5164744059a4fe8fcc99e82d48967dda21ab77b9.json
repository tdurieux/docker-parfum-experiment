{
  "startTime": 1674237279782,
  "endTime": 1674237279987,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 21,
        "lineEnd": 21,
        "columnStart": 7,
        "columnEnd": 74
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM debian:9.9-slim\n\n# Default google-fluentd to the latest stable.\n# Use `docker build --build-arg REPO_SUFFIX=<CUSTOM_REPO_SUFFIX>` to override\n# the version.\nARG REPO_SUFFIX=20190525-1\n\nCOPY entrypoint.sh Dockerfile /\n\n# TODO: This may be a moving target, figure out how to pin.\nRUN apt-get update \\\n    && apt-get install -y --no-install-recommends \\\n        curl \\\n        gnupg2 \\\n        lsb-release \\\n        build-essential \\\n        procps \\\n        systemd \\\n        ca-certificates \\\n        adduser \\\n    # Install Logging Agent. \\\n    && curl -f -sS https://dl.google.com/cloudagents/install-logging-agent.sh | REPO_SUFFIX=\"$REPO_SUFFIX\" DO_NOT_INSTALL_CATCH_ALL_CONFIG=true bash \\\n    # Store versions in the VERSION file.\n    && dpkg -s google-fluentd | sed -nE 's/^Version: (.*)(-[^-]+)$/VERSION=\\1\\nGOOGLE_FLUENTD_VERSION=\\1\\2/p' >> /VERSION \\\n    && echo REPO_SUFFIX=$REPO_SUFFIX >> /VERSION \\\n    && /opt/google-fluentd/embedded/bin/gem list fluent-plugin-google-cloud | sed 's/^fluent-plugin-google-cloud (\\(.*\\))$/FLUENT_PLUGIN_GOOGLE_CLOUD_VERSION=\\1/' >> /VERSION \\\n    # If any additional gems need to be installed, it should happen before the\n    # image cleanup.\n    # ==> INSTALL_ADDITIONAL_GEMS_HERE_IF_NEEDED <==\n    # Clean up to reduce image size.\n    && apt-get purge -y \\\n        curl \\\n        lsb-release \\\n        build-essential \\\n        gtk2.0 \\\n        libkrb5-3 \\\n    && apt-get autoremove -y --purge \\\n    # Remove docs.\n    && rm -rf \\\n        /usr/share/doc \\\n        /usr/share/man \\\n        /opt/google-fluentd/embedded/lib/ruby/gems/*/doc \\\n        /opt/google-fluentd/embedded/share/doc \\\n        /opt/google-fluentd/embedded/share/gtk-doc \\\n        /opt/google-fluentd/embedded/share/man \\\n        /opt/google-fluentd/embedded/share/terminfo \\\n    # Remove unused gems.\n    && /opt/google-fluentd/embedded/bin/gem uninstall -ax --force \\\n        # Gems for ingesting logs to Treasure Data Cloud.\n        td \\\n        td-client \\\n        td-logger \\\n        fluent-plugin-td \\\n        fluent-plugin-td-monitoring \\\n        hirb \\\n        parallel \\\n        ohai \\\n        mixlib-cli \\\n        mixlib-config \\\n        mixlib-log \\\n        mixlib-shellout \\\n        systemu \\\n        # Gems for Mongo.\n        fluent-plugin-mongo \\\n        mongo \\\n    # Remove unused gem versions.\n    && /opt/google-fluentd/embedded/bin/gem uninstall httpclient -v 2.7.2 \\\n    && rm -rf \\\n        # Cache.\n        /var/cache \\\n        # apt.\n        /usr/bin/apt-* \\\n        /var/lib/apt/lists/* \\\n        # dpkg.\n        /usr/bin/dpkg* \\\n        /var/lib/dpkg \\\n        # Temp files.\n        /tmp/* \\\n        # LDAP.\n        /usr/lib/x86_64-linux-gnu/libldap* \\\n        # IBM mainframe / EBCDIC specific encodings.\n        /usr/lib/x86_64-linux-gnu/gconv/IBM* \\\n        /usr/lib/x86_64-linux-gnu/gconv/EBCDIC* \\\n        # ecpg.\n        /opt/google-fluentd/embedded/bin/ecpg \\\n        # OpenSSL.\n        /opt/google-fluentd/embedded/bin/openssl \\\n        /usr/bin/openssl \\\n        # Postgres.\n        /opt/google-fluentd/embedded/bin/pg_* \\\n        /opt/google-fluentd/embedded/bin/postgre* \\\n        /opt/google-fluentd/embedded/share/postgre* \\\n        /opt/google-fluentd/embedded/lib/postgre* \\\n        /opt/google-fluentd/embedded/bin/psql \\\n        # libtool.\n        /opt/google-fluentd/embedded/share/libtool \\\n        /opt/google-fluentd/embedded/bin/libtool \\\n        # .a files and include libraries.\n        /opt/google-fluentd/embedded/include \\\n        /opt/google-fluentd/embedded/lib/*.a \\\n    # Log files.\n    && find /var/log -name \"*.log\" -type f -delete \\\n    # Remove .c .cc .h files.\n    && (find /opt/google-fluentd/embedded/ -name '*.c' -o -name '*.cc' -o -name '*.h'  | xargs rm) \\\n    # Remove unused api client libraries.\n    && (find /opt/google-fluentd/embedded/lib/ruby/gems/*/gems/google-api-client-*/generated/google/apis -mindepth 1 -maxdepth 1 \\! -name 'logging*' | xargs rm -rf) \\\n    && sed -i \"s/num_threads 8/num_threads 8\\n  detect_json true\\n  # Enable metadata agent lookups.\\n  enable_metadata_agent true\\n  metadata_agent_url \\\"http:\\/\\/local-metadata-agent.stackdriver.com:8000\\\"/\" \"/etc/google-fluentd/google-fluentd.conf\"\n\nENV LD_PRELOAD=/opt/google-fluentd/embedded/lib/libjemalloc.so\n\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"/usr/sbin/google-fluentd\"]\n"
}