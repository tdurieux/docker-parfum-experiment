{
  "startTime": 1674247930271,
  "endTime": 1674247930716,
  "originalSmells": [
    {
      "rule": "mkdirUsrSrcThenRemove",
      "position": {
        "lineStart": 26,
        "lineEnd": 26,
        "columnStart": 1,
        "columnEnd": 27
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM alpine:3.10\n\nRUN apk add --no-cache \\\n\t\tbzip2 \\\n\t\tcoreutils \\\n\t\tcurl \\\n\t\tgcc \\\n\t\tgnupg \\\n\t\tlinux-headers \\\n\t\tmake \\\n\t\tmusl-dev \\\n\t\ttzdata\n\n# pub   1024D/ACC9965B 2006-12-12\n#       Key fingerprint = C9E9 416F 76E6 10DB D09D  040F 47B7 0C55 ACC9 965B\n# uid                  Denis Vlasenko <vda.linux@googlemail.com>\n# sub   1024g/2C766641 2006-12-12\nRUN gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys C9E9416F76E610DBD09D040F47B70C55ACC9965B\n\nENV BUSYBOX_VERSION 1.31.0\n\nRUN set -ex; \\\n\ttarball=\"busybox-${BUSYBOX_VERSION}.tar.bz2\"; \\\n\tcurl -fL -o busybox.tar.bz2 \"https://busybox.net/downloads/$tarball\"; \\\n\tcurl -fL -o busybox.tar.bz2.sig \"https://busybox.net/downloads/$tarball.sig\"; \\\n\tgpg --batch --verify busybox.tar.bz2.sig busybox.tar.bz2; \\\n\tmkdir -p /usr/src/busybox; rm -rf /usr/src/busybox \\\n\ttar -xf busybox.tar.bz2 -C /usr/src/busybox --strip-components 1; \\\n\trm busybox.tar.bz2*\n\nWORKDIR /usr/src/busybox\n\n# https://www.mail-archive.com/toybox@lists.landley.net/msg02528.html\n# https://www.mail-archive.com/toybox@lists.landley.net/msg02526.html\nRUN sed -i 's/^struct kconf_id \\*$/static &/g' scripts/kconfig/zconf.hash.c_shipped\n\n# CONFIG_LAST_SUPPORTED_WCHAR: see https://github.com/docker-library/busybox/issues/13 (UTF-8 input)\n# see http://wiki.musl-libc.org/wiki/Building_Busybox\nRUN set -ex; \\\n\t\\\n\tsetConfs=' \\\n\t\tCONFIG_AR=y \\\n\t\tCONFIG_FEATURE_AR_CREATE=y \\\n\t\tCONFIG_FEATURE_AR_LONG_FILENAMES=y \\\n\t\tCONFIG_LAST_SUPPORTED_WCHAR=0 \\\n\t\tCONFIG_STATIC=y \\\n\t'; \\\n\t\\\n\tunsetConfs=' \\\n\t\tCONFIG_FEATURE_SYNC_FANCY \\\n\t\t\\\n\t\tCONFIG_FEATURE_HAVE_RPC \\\n\t\tCONFIG_FEATURE_INETD_RPC \\\n\t\tCONFIG_FEATURE_UTMP \\\n\t\tCONFIG_FEATURE_WTMP \\\n\t'; \\\n\t\\\n\tmake defconfig; \\\n\t\\\n\tfor conf in $unsetConfs; do \\\n\t\tsed -i \\\n\t\t\t-e \"s!^$conf=.*\\$!# $conf is not set!\" \\\n\t\t\t.config; \\\n\tdone; \\\n\t\\\n\tfor confV in $setConfs; do \\\n\t\tconf=\"${confV%=*}\"; \\\n\t\tsed -i \\\n\t\t\t-e \"s!^$conf=.*\\$!$confV!\" \\\n\t\t\t-e \"s!^# $conf is not set\\$!$confV!\" \\\n\t\t\t.config; \\\n\t\tif ! grep -q \"^$confV\\$\" .config; then \\\n\t\t\techo \"$confV\" >> .config; \\\n\t\tfi; \\\n\tdone; \\\n\t\\\n\tmake oldconfig; \\\n\t\\\n# trust, but verify\n\tfor conf in $unsetConfs; do \\\n\t\t! grep -q \"^$conf=\" .config; \\\n\tdone; \\\n\tfor confV in $setConfs; do \\\n\t\tgrep -q \"^$confV\\$\" .config; \\\n\tdone;\n\nRUN set -ex \\\n\t&& make -j \"$(nproc)\" \\\n\t\tbusybox \\\n\t&& ./busybox --help \\\n\t&& mkdir -p rootfs/bin \\\n\t&& ln -vL busybox rootfs/bin/ \\\n\t&& chroot rootfs /bin/busybox --install /bin\n\n# grab a simplified getconf port from Alpine we can statically compile\nRUN set -x \\\n\t&& aportsVersion=\"v$(cat /etc/alpine-release)\" \\\n\t&& curl -fsSL \\\n\t\t\"https://git.alpinelinux.org/cgit/aports/plain/main/musl/getconf.c?h=${aportsVersion}\" \\\n\t\t-o /usr/src/getconf.c \\\n\t&& gcc -o rootfs/bin/getconf -static -Os /usr/src/getconf.c \\\n\t&& chroot rootfs /bin/getconf _NPROCESSORS_ONLN\n\n# download a few extra files from buildroot (/etc/passwd, etc)\nRUN set -ex; \\\n\tbuildrootVersion='2019.05'; \\\n\tmkdir -p rootfs/etc; \\\n\tfor f in passwd shadow group; do \\\n\t\tcurl -fL -o \"rootfs/etc/$f\" \"https://git.busybox.net/buildroot/plain/system/skeleton/etc/$f?id=$buildrootVersion\"; \\\n\tdone; \\\n# CVE-2019-5021, https://github.com/docker-library/official-images/pull/5880#issuecomment-490681907\n\tgrep -E '^root::' rootfs/etc/shadow; \\\n\tsed -ri -e 's/^root::/root:*:/' rootfs/etc/shadow; \\\n\tgrep -E '^root:[*]:' rootfs/etc/shadow; \\\n# set expected permissions, etc too (https://git.busybox.net/buildroot/tree/system/device_table.txt)\n\tcurl -fL -o buildroot-device-table.txt \"https://git.busybox.net/buildroot/plain/system/device_table.txt?id=$buildrootVersion\"; \\\n\tawk ' \\\n\t\t!/^#/ { \\\n\t\t\tif ($2 != \"d\" && $2 != \"f\") { \\\n\t\t\t\tprintf \"error: unknown type \\\"%s\\\" encountered in line %d: %s\\n\", $2, NR, $0 > \"/dev/stderr\"; \\\n\t\t\t\texit 1; \\\n\t\t\t} \\\n\t\t\tsub(/^\\/?/, \"rootfs/\", $1); \\\n\t\t\tif ($2 == \"d\") { \\\n\t\t\t\tprintf \"mkdir -p %s\\n\", $1; \\\n\t\t\t} \\\n\t\t\tprintf \"chmod %s %s\\n\", $3, $1; \\\n\t\t} \\\n\t' buildroot-device-table.txt | sh -eux; \\\n\trm buildroot-device-table.txt\n\n# create missing home directories\nRUN set -ex \\\n\t&& cd rootfs \\\n\t&& for userHome in $(awk -F ':' '{ print $3 \":\" $4 \"=\" $6 }' etc/passwd); do \\\n\t\tuser=\"${userHome%%=*}\"; \\\n\t\thome=\"${userHome#*=}\"; \\\n\t\thome=\"./${home#/}\"; \\\n\t\tif [ ! -d \"$home\" ]; then \\\n\t\t\tmkdir -p \"$home\"; \\\n\t\t\tchown \"$user\" \"$home\"; \\\n\t\t\tchmod 755 \"$home\"; \\\n\t\tfi; \\\n\tdone\n\n# test and make sure it works\nRUN chroot rootfs /bin/sh -xec 'true'\n\n# ensure correct timezone (UTC)\nRUN set -ex; \\\n\tln -vL /usr/share/zoneinfo/UTC rootfs/etc/localtime; \\\n\t[ \"$(chroot rootfs date +%Z)\" = 'UTC' ]\n\n# test and make sure DNS works too\nRUN cp -L /etc/resolv.conf rootfs/etc/ \\\n\t&& chroot rootfs /bin/sh -xec 'nslookup google.com' \\\n\t&& rm rootfs/etc/resolv.conf\n"
}