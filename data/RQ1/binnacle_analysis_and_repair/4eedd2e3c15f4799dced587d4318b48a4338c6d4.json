{
  "startTime": 1674244712568,
  "endTime": 1674244712820,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 81,
        "lineEnd": 81,
        "columnStart": 4,
        "columnEnd": 15
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n# Copyright 2019 Astronomer Inc.\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n# http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\nFROM alpine:3.9\nLABEL maintainer=\"Astronomer <humans@astronomer.io>\"\n\nARG BUILD_NUMBER=-1\nLABEL io.astronomer.docker.build.number=$BUILD_NUMBER\nLABEL io.astronomer.docker=true\nLABEL io.astronomer.docker.module=\"airflow\"\nLABEL io.astronomer.docker.component=\"airflow\"\nLABEL io.astronomer.docker.airflow.version=\"1.10.3\"\n\nARG ORG=\"astronomer\"\nARG VERSION=\"1.10.3-1\"\nARG SUBMODULES=\"all, statsd, elasticsearch\"\n\nENV AIRFLOW_REPOSITORY=\"https://github.com/${ORG}/airflow\"\nENV AIRFLOW_MODULE=\"git+${AIRFLOW_REPOSITORY}@${VERSION}#egg=apache-airflow[${SUBMODULES}]\"\nENV AIRFLOW_HOME=\"/usr/local/airflow\"\nENV PYMSSQL_BUILD_WITH_BUNDLED_FREETDS=1\nENV PYTHONPATH=${PYTHONPATH:+${PYTHONPATH}:}${AIRFLOW_HOME}\nENV AIRFLOW_GPL_UNIDECODE=\"True\"\n\nARG ASTRONOMER_USER=\"astro\"\nARG ASTRONOMER_GROUP=\"astro\"\nENV ASTRONOMER_USER=${ASTRONOMER_USER}\nENV ASTRONOMER_GROUP=${ASTRONOMER_GROUP}\n\nRUN addgroup -S ${ASTRONOMER_GROUP} \\\n\t&& adduser -S -G ${ASTRONOMER_GROUP} ${ASTRONOMER_USER}\n\n# Install packages\nRUN apk update \\\n\t&& apk add --no-cache --virtual .build-deps \\\n\t\tbuild-base \\\n\t\tcyrus-sasl-dev \\\n\t\tfreetds-dev \\\n\t\tfreetype-dev \\\n\t\tgit \\\n\t\tkrb5-dev \\\n\t\tlibffi-dev \\\n\t\tlibxml2-dev \\\n\t\tlibxslt-dev \\\n\t\tlinux-headers \\\n\t\tmariadb-dev \\\n\t\tnodejs \\\n\t\tnodejs-npm \\\n\t\tpostgresql-dev \\\n\t\tpython3-dev \\\n\t\ttzdata \\\n\t&& apk add --no-cache \\\n\t\tbash \\\n\t\tca-certificates \\\n\t\tcyrus-sasl \\\n\t\tkrb5-libs \\\n\t\tmariadb-connector-c \\\n\t\tpostgresql \\\n\t\tpython3 \\\n\t\ttini \\\n\t&& update-ca-certificates \\\n\t&& cp /usr/share/zoneinfo/UTC /etc/localtime \\\n\t&& pip3 install --no-cache-dir --upgrade pip==19.1.1 \\\n\t&& pip3 install --no-cache-dir --upgrade setuptools==39.0.1 \\\n\t&& pip3 install --no-cache-dir cython \\\n\t&& pip3 install --no-cache-dir numpy \\\n\t&& pip3 install --no-cache-dir \"${AIRFLOW_MODULE}\" \\\n\t&& pip3 install --no-cache-dir \"https://github.com/astronomer/astronomer-fab-securitymanager/releases/download/v1.0.2/astronomer_fab_security_manager-1.0.2-py3-none-any.whl\" \\\n\t&& cd /usr/lib/python3.6/site-packages/airflow/www_rbac \\\n\t&& npm install \\\n\t&& npm run build \\\n\t&& rm -rf node_modules \\\n\t&& apk del .build-deps \\\n\t&& ln -sf /usr/bin/python3 /usr/bin/python \\\n\t&& ln -sf /usr/bin/pip3 /usr/bin/pip && npm cache clean --force;\n\n# Create logs directory so we can own it when we mount volumes\nRUN mkdir -p ${AIRFLOW_HOME}/logs\n\n# Copy entrypoint to root\nCOPY include/entrypoint /\n\n# Copy cron scripts\nCOPY include/clean-airflow-logs /etc/periodic/15min/clean-airflow-logs\n\n# Ensure our user has ownership to AIRFLOW_HOME\nRUN chown -R ${ASTRONOMER_USER}:${ASTRONOMER_GROUP} ${AIRFLOW_HOME}\n\n# Switch to AIRFLOW_HOME\nWORKDIR ${AIRFLOW_HOME}\n\n# Expose all airflow ports\nEXPOSE 8080 5555 8793\n\n# Run airflow with minimal init\nENTRYPOINT [\"tini\", \"--\", \"/entrypoint\"]\n"
}