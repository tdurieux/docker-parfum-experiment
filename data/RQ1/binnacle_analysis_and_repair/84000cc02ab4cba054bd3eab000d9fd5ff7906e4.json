{
  "startTime": 1674245805009,
  "endTime": 1674245805205,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 34,
        "lineEnd": 43,
        "columnStart": 4,
        "columnEnd": 20
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ubuntu:bionic as builder\n\nARG APT_FLAGS_COMMON=\"-y\"\nARG APT_FLAGS_DEV=\"${APT_FLAGS_COMMON} --no-install-recommends\"\n\nARG MAJOR_VERSION=4.2\nARG ZBX_VERSION=${MAJOR_VERSION}.3\nARG ZBX_SOURCES=https://git.zabbix.com/scm/zbx/zabbix.git\nENV LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 TERM=xterm \\\n    ZBX_TYPE=agent ZBX_VERSION=${ZBX_VERSION} ZBX_SOURCES=${ZBX_SOURCES}\n\nRUN set -eux && \\\n    apt-get ${APT_FLAGS_COMMON} update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get ${APT_FLAGS_DEV} install locales && \\\n    locale-gen $LC_ALL && \\\n    DEBIAN_FRONTEND=noninteractive apt-get ${APT_FLAGS_DEV} install \\\n            autoconf \\\n            automake \\\n            libc6-dev \\\n            libldap2-dev \\\n            libpcre3-dev \\\n            libssl-dev \\\n            make \\\n            pkg-config \\\n            git \\\n            ca-certificates \\\n            gcc && \\\n    cd /tmp/ && \\\n    git clone ${ZBX_SOURCES} --branch ${ZBX_VERSION} --depth 1 --single-branch zabbix-${ZBX_VERSION} && \\\n    cd /tmp/zabbix-${ZBX_VERSION} && \\\n    zabbix_revision=`git rev-parse --short HEAD` && \\\n    sed -i \"s/{ZABBIX_REVISION}/$zabbix_revision/g\" include/version.h && \\\n    ./bootstrap.sh && \\\n    export CFLAGS=\"-fPIC -pie -Wl,-z,relro -Wl,-z,now\" && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" \\\n            --datadir=/usr/lib \\\n            --libdir=/usr/lib/zabbix \\\n            --sysconfdir=/etc/zabbix \\\n            --prefix=/usr \\\n            --enable-agent \\\n            --with-ldap \\\n            --with-openssl \\\n            --enable-ipv6 \\\n            --silent && \\\n    make -j\"$(nproc)\" -s\n\nFROM ubuntu:bionic\nLABEL maintainer=\"Alexey Pustovalov <alexey.pustovalov@zabbix.com>\"\n\nARG BUILD_DATE\nARG VCS_REF\n\nARG APT_FLAGS_COMMON=\"-y\"\nARG APT_FLAGS_PERSISTENT=\"${APT_FLAGS_COMMON} --no-install-recommends\"\n\nARG MAJOR_VERSION=4.2\nARG ZBX_VERSION=${MAJOR_VERSION}.3\nARG ZBX_SOURCES=https://git.zabbix.com/scm/zbx/zabbix.git\nENV LANG=en_US.UTF-8 LANGUAGE=en_US:en LC_ALL=en_US.UTF-8 TERM=xterm \\\n    ZBX_TYPE=agent ZBX_DB_TYPE=none ZBX_OPT_TYPE=none \\\n    ZBX_VERSION=${ZBX_VERSION} ZBX_SOURCES=${ZBX_SOURCES}\nENV TINI_VERSION v0.18.0\n\nLABEL org.label-schema.name=\"zabbix-${ZBX_TYPE}-ubuntu\" \\\n      org.label-schema.vendor=\"Zabbix LLC\" \\\n      org.label-schema.url=\"https://zabbix.com/\" \\\n      org.label-schema.description=\"Zabbix agent is deployed on a monitoring target to actively monitor local resources and applications\" \\\n      org.label-schema.vcs-ref=\"${VCS_REF}\" \\\n      org.label-schema.build-date=\"${BUILD_DATE}\" \\\n      org.label-schema.schema-version=\"1.0\" \\\n      org.label-schema.license=\"GPL v2.0\" \\\n      org.label-schema.usage=\"https://www.zabbix.com/documentation/${MAJOR_VERSION}/manual/installation/containers\" \\\n      org.label-schema.version=\"${ZBX_VERSION}\" \\\n      org.label-schema.vcs-url=\"${ZBX_SOURCES}\" \\\n      org.label-schema.docker.cmd=\"docker run --name zabbix-${ZBX_TYPE} --link zabbix-server:zabbix-server -p 10050:10050 -d zabbix-${ZBX_TYPE}:ubuntu-${ZBX_VERSION}\"\n\nSTOPSIGNAL SIGTERM\n\nCOPY --from=builder /tmp/zabbix-${ZBX_VERSION}/src/zabbix_agent/zabbix_agentd /usr/sbin/zabbix_agentd\nCOPY --from=builder /tmp/zabbix-${ZBX_VERSION}/src/zabbix_get/zabbix_get /usr/bin/zabbix_get\nCOPY --from=builder /tmp/zabbix-${ZBX_VERSION}/src/zabbix_sender/zabbix_sender /usr/bin/zabbix_sender\nCOPY --from=builder  /tmp/zabbix-${ZBX_VERSION}/conf/zabbix_agentd.conf /etc/zabbix/zabbix_agentd.conf\nADD https://github.com/krallin/tini/releases/download/${TINI_VERSION}/tini /sbin/tini\n\nRUN set -eux && \\\n    apt-get ${APT_FLAGS_COMMON} update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get ${APT_FLAGS_PERSISTENT} install locales && \\\n    locale-gen $LC_ALL && \\\n    echo \"#!/bin/sh\\nexit 0\" > /usr/sbin/policy-rc.d && \\\n    addgroup --system --quiet zabbix && \\\n    adduser --quiet \\\n            --system --disabled-login \\\n            --ingroup zabbix \\\n            --home /var/lib/zabbix/ \\\n        zabbix && \\\n    mkdir -p /etc/zabbix && \\\n    mkdir -p /etc/zabbix/zabbix_agentd.d && \\\n    mkdir -p /var/lib/zabbix && \\\n    mkdir -p /var/lib/zabbix/enc && \\\n    mkdir -p /var/lib/zabbix/modules && \\\n    chown --quiet -R zabbix:root /var/lib/zabbix && \\\n    apt-get ${APT_FLAGS_COMMON} update && \\\n    DEBIAN_FRONTEND=noninteractive apt-get ${APT_FLAGS_PERSISTENT} install \\\n            libpcre3 \\\n            libssl1.1 \\\n            libldap-2.4 && \\\n    apt-get ${APT_FLAGS_COMMON} autoremove && \\\n    apt-get ${APT_FLAGS_COMMON} clean && \\\n    rm -rf /var/lib/apt/lists/*  && \\\n    chmod +x /sbin/tini\n\nEXPOSE 10050/TCP\n\nWORKDIR /var/lib/zabbix\n\nVOLUME [\"/etc/zabbix/zabbix_agentd.d\", \"/var/lib/zabbix/enc\", \"/var/lib/zabbix/modules\"]\n\nCOPY [\"docker-entrypoint.sh\", \"/usr/bin/\"]\n\nENTRYPOINT [\"/sbin/tini\", \"--\", \"/usr/bin/docker-entrypoint.sh\"]\n"
}