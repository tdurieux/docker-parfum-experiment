{
  "startTime": 1674238463449,
  "endTime": 1674238463867,
  "originalSmells": [
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 79,
        "lineEnd": 79,
        "columnStart": 4,
        "columnEnd": 93
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 9,
        "lineEnd": 24,
        "columnStart": 4,
        "columnEnd": 9
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM debian:sid as builder\n\nLABEL maintainer \"mikel.asla@keensoft.es\"\nLABEL version \"201707-GA\"\nLABEL description \"alfresco-standalone 201707-GA builder stage\"\n\n# Dependencies\nRUN set -x \\\n\t&& apt-get update \\\n\t&& apt-get install -y --no-install-recommends \\\n\t\tcurl \\\n\t    cpp \\\n\t    dirmngr \\\n\t    gcc \\\n\t    gpg \\\n\t    gpg-agent \\\n\t    openjdk-8-jdk \\\n\t    libapr1 \\\n\t    libapr1-dev \\\n\t    lsof \\\n\t    make \\\n\t    tar \\\n\t    unzip \\\n\t    sed \\\n\t    wget && rm -rf /var/lib/apt/lists/*;\n\n# Environment variables\nENV ALF_VERSION=201707 \\\n\tALF_BUILD=201707-build-00028 \\\n\tCATALINA_HOME=/usr/local/tomcat \\\n\tALF_HOME=/usr/local/alfresco \\\n\tJAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64 \\\t\n\tAOS_VERSION=1.1.6\n\nENV ALF_ZIP=alfresco-community-distribution-$ALF_VERSION.zip \\\n\tAOS_ZIP=alfresco-aos-module-$AOS_VERSION.zip \\\n\tAOS_AMP=alfresco-aos-module-$AOS_VERSION.amp\n\nENV ALF_DOWNLOAD_URL=https://download.alfresco.com/release/community/$ALF_BUILD/$ALF_ZIP \\\n\tAOS_DOWNLOAD_URL=https://download.alfresco.com/release/community/$ALF_BUILD/$AOS_ZIP \\\n\tDIST=/tmp/alfresco/alfresco-community-distribution-$ALF_VERSION\n\nENV PATH $CATALINA_HOME/bin:$ALF_HOME/bin:$PATH\n\n# Create root folders\nRUN set -x \\\n\t&& mkdir -p $ALF_HOME $CATALINA_HOME\n\n# get alfresco ZIP\nRUN set -x \\\n\t&& mkdir /tmp/alfresco \\\n\t&& wget --no-check-certificate $ALF_DOWNLOAD_URL \\\n\t&& unzip $ALF_ZIP -d /tmp/alfresco\n\n# Alfresco basic instalation\nRUN set -x \\\n\t&& ln -s $CATALINA_HOME $ALF_HOME/tomcat \\\n\t&& mkdir -p $CATALINA_HOME/conf/Catalina/localhost $CATALINA_HOME/lib/ $CATALINA_HOME/webapps \\\n\t&& mv $DIST/web-server/conf/Catalina/localhost/alfresco.xml $CATALINA_HOME/conf/Catalina/localhost/ \\\n\t&& mv $DIST/web-server/conf/Catalina/localhost/share.xml $CATALINA_HOME/conf/Catalina/localhost/ \\\n\t&& mv $DIST/web-server/lib/* $CATALINA_HOME/lib/ \\\n\t&& mv $DIST/web-server/shared $CATALINA_HOME/ \\\n\t&& mv $DIST/web-server/webapps/alfresco.war $CATALINA_HOME/webapps/ \\\n\t&& mv $DIST/web-server/webapps/share.war $CATALINA_HOME/webapps/ \\\n\t&& mv $DIST/web-server/webapps/ROOT.war $CATALINA_HOME/webapps/ \\\n\t&& mkdir $CATALINA_HOME/webapps/alfresco $CATALINA_HOME/webapps/share $CATALINA_HOME/webapps/ROOT \\\n\t&& unzip $CATALINA_HOME/webapps/alfresco.war -d $CATALINA_HOME/webapps/alfresco \\\n\t&& unzip $CATALINA_HOME/webapps/share.war -d $CATALINA_HOME/webapps/share \\\n\t&& unzip $CATALINA_HOME/webapps/ROOT.war -d $CATALINA_HOME/webapps/ROOT \\\n\t&& rm -rf $CATALINA_HOME/webapps/*.war \\\n\t&& mv $DIST/alf_data $ALF_HOME \\\n\t&& mv $DIST/amps $ALF_HOME \\\n\t&& mv $DIST/bin $ALF_HOME \\\n\t&& mv $DIST/modules $ALF_HOME\n\n# alfresco-pdf-renderer\nRUN set -x \\\n\t&& mkdir /usr/local/alfresco/alfresco-pdf-renderer \\\n\t&& wget https://artifacts.alfresco.com/nexus/service/local/repositories/releases/content/org/alfresco/alfresco-pdf-renderer/1.0/alfresco-pdf-renderer-1.0-linux.tgz \\\n\t&& tar xzvf alfresco-pdf-renderer-1.0-linux.tgz -C /usr/local/alfresco/alfresco-pdf-renderer && rm alfresco-pdf-renderer-1.0-linux.tgz\n\n# Configure Alfresco\nCOPY assets/alfresco/alfresco-global.properties $CATALINA_HOME/shared/classes/alfresco-global.properties\n\n# Install Alfresco Office Services\nRUN set -x \\\n\t&& mkdir /tmp/aos \\\n\t&& wget --no-check-certificate $AOS_DOWNLOAD_URL \\\n\t&& unzip $AOS_ZIP -d /tmp/aos \\\n\t&& mv /tmp/aos/extension/* $CATALINA_HOME/shared/classes/alfresco/extension \\\n\t&& mv /tmp/aos/$AOS_AMP $ALF_HOME/amps \\\n\t&& mkdir $CATALINA_HOME/webapps/_vti_bin \\\n\t&& unzip /tmp/aos/_vti_bin.war -d $CATALINA_HOME/webapps/_vti_bin\n\n# Install addons\nCOPY assets/amps $ALF_HOME/amps\nCOPY assets/amps_share $ALF_HOME/amps_share\nRUN set -x \\\n\t&& java -jar $ALF_HOME/bin/alfresco-mmt.jar install $ALF_HOME/amps $CATALINA_HOME/webapps/alfresco -directory -nobackup \\\n\t&& java -jar $ALF_HOME/bin/alfresco-mmt.jar install $ALF_HOME/amps_share $CATALINA_HOME/webapps/share -directory -nobackup\n\n# Install api-explorer WAR file\nRUN set -x \\\n\t&& wget https://artifacts.alfresco.com/nexus/service/local/repositories/releases/content/org/alfresco/api-explorer/5.2.0/api-explorer-5.2.0.war -O $CATALINA_HOME/webapps/api-explorer.war \\\n\t&& mkdir $CATALINA_HOME/webapps/api-explorer \\\n\t&& unzip $CATALINA_HOME/webapps/api-explorer.war -d $CATALINA_HOME/webapps/api-explorer \\\n\t&& rm -rf $CATALINA_HOME/webapps/api-explorer.war\n\nFROM tomcat:7-jre8\n\nLABEL maintainer \"mikel.asla@keensoft.es\"\nLABEL version \"201707-GA\"\nLABEL description \"alfresco-standalone 201707-GA application stage\"\n\nENV CATALINA_HOME=/usr/local/tomcat \\\n\tALF_HOME=/usr/local/alfresco\n\n# Dependencies\nRUN set -x \\\n\t&& apt-get update \\\n\t&& apt-get install -y --no-install-recommends \\\t \n\t    ghostscript \\\n\t    imagemagick \\\n\t&& rm -rf /var/lib/apt/lists/* \\\n\t&& mkdir -p $ALF_HOME $ALF_HOME/alf_data \\\n\t&& ln -s $CATALINA_HOME $ALF_HOME/tomcat\n\nCOPY --from=builder /usr/local/alfresco/bin /usr/local/alfresco/bin\nCOPY --from=builder /usr/local/alfresco/alfresco-pdf-renderer /usr/local/alfresco/alfresco-pdf-renderer\nCOPY --from=builder /usr/local/tomcat/lib/postgresql-9.4.1212.jar /usr/local/tomcat/lib/postgresql-9.4.1212.jar\nCOPY --from=builder /usr/local/tomcat/conf/Catalina /usr/local/tomcat/conf/Catalina\nCOPY --from=builder /usr/local/tomcat/shared /usr/local/tomcat/shared\nCOPY --from=builder /usr/local/tomcat/webapps /usr/local/tomcat/webapps\n\nRUN set -x \\\t\n\t&& sed -i 's;shared.loader=;shared.loader=${catalina.base}/shared/classes,${catalina.base}/shared/lib/*.jar;g' $CATALINA_HOME/conf/catalina.properties \\\n\t&& useradd -ms /bin/bash alfresco \\\n\t&& chown -RL alfresco:alfresco $ALF_HOME\nUSER alfresco\nWORKDIR $ALF_HOME\nEXPOSE 8080\nVOLUME $ALF_HOME/alf_data\nCMD [\"catalina.sh\", \"run\"]\n\n\n\n"
}