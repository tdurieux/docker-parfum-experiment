{
  "startTime": 1674235826441,
  "endTime": 1674235826881,
  "originalSmells": [
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 59,
        "lineEnd": 59,
        "columnStart": 4,
        "columnEnd": 60
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 60,
        "lineEnd": 60,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 146
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 49,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 51,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 52,
        "lineEnd": 52,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 49,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 51,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 52,
        "lineEnd": 52,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 42
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 49,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 51,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 52,
        "lineEnd": 52,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 30
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 35,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 38,
        "lineEnd": 38,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 49,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 50,
        "lineEnd": 50,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 51,
        "lineEnd": 51,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 52,
        "lineEnd": 52,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 54
      }
    }
  ],
  "repairedDockerfile": "# Based on manual compile instructions at http://wiki.nginx.org/HttpLuaModule#Installation\n\n\n# To build:\n#\n# 1) Install docker (http://docker.io)\n# 2) Clone nginx-lua-proxy repo if you haven't already: git clone https://github.com/Ermlab/nginx-lua-proxy.git\n# 3) Build: cd nginx-lua-proxy && docker build .\n# 4) Run: docker run -d --name redis redis\n# 5) Run: docker run -d --link redis:redis -P nginx-lua-proxy\n\nFROM ubuntu:14.04\nMAINTAINER Krzysztof Sopy≈Ça <sopyla@ermlab.com>\n\nENV VER_NGINX_DEVEL_KIT=0.2.19\nENV VER_LUA_NGINX_MODULE=0.9.16\nENV VER_NGINX=1.9.3\nENV VER_LUAJIT=2.0.4\n\nENV NGINX_DEVEL_KIT ngx_devel_kit-${VER_NGINX_DEVEL_KIT}\nENV LUA_NGINX_MODULE lua-nginx-module-${VER_LUA_NGINX_MODULE}\nENV NGINX_ROOT=/nginx\nENV WEB_DIR ${NGINX_ROOT}/html\n\n\n#openresty modules\nENV VER_LUA_RESTY_REDIS=0.21\nENV LUA_RESTY_REDIS lua-resty-redis-${VER_LUA_RESTY_REDIS}\n\n\n\nENV LUAJIT_LIB /usr/local/lib\nENV LUAJIT_INC /usr/local/include/luajit-2.0\n\nRUN apt-get -qq update\nRUN apt-get -qq --no-install-recommends -y install wget supervisor && rm -rf /var/lib/apt/lists/*;\n\n# Instal lighweight DNS for proper nginx name resolution based on /etc/hosts\nRUN apt-get -qq --no-install-recommends -y install dnsmasq && rm -rf /var/lib/apt/lists/*;\n#fix for dnsmasq in docker, it must run as user root:\nRUN sed -i 's/#user=/user=root/g' /etc/dnsmasq.conf\n\nCOPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf\n\n# ***** BUILD DEPENDENCIES *****\n\n# Common dependencies (Nginx and LUAJit)\nRUN apt-get -qq --no-install-recommends -y install make && rm -rf /var/lib/apt/lists/*;\n# Nginx dependencies\nRUN apt-get -qq --no-install-recommends -y install libpcre3 && rm -rf /var/lib/apt/lists/*;\nRUN apt-get -qq --no-install-recommends -y install libpcre3-dev && rm -rf /var/lib/apt/lists/*;\nRUN apt-get -qq --no-install-recommends -y install zlib1g-dev && rm -rf /var/lib/apt/lists/*;\nRUN apt-get -qq --no-install-recommends -y install libssl-dev && rm -rf /var/lib/apt/lists/*;\n# LUAJit dependencies\nRUN apt-get -qq --no-install-recommends -y install gcc && rm -rf /var/lib/apt/lists/*;\n\n# ***** DOWNLOAD AND UNTAR *****\n\n# Download modules\nRUN wget https://nginx.org/download/nginx-${VER_NGINX}.tar.gz\nRUN wget https://luajit.org/download/LuaJIT-${VER_LUAJIT}.tar.gz\nRUN wget https://github.com/simpl/ngx_devel_kit/archive/v${VER_NGINX_DEVEL_KIT}.tar.gz -O ${NGINX_DEVEL_KIT}.tar.gz\nRUN wget https://github.com/openresty/lua-nginx-module/archive/v${VER_LUA_NGINX_MODULE}.tar.gz -O ${LUA_NGINX_MODULE}.tar.gz\n\n#Download openresty libs\nRUN wget https://github.com/openresty/lua-resty-redis/archive/v${VER_LUA_RESTY_REDIS}.tar.gz -O ${LUA_RESTY_REDIS}.tar.gz\n\n# Untar\nRUN tar -xzvf nginx-${VER_NGINX}.tar.gz && rm nginx-${VER_NGINX}.tar.gz\nRUN tar -xzvf LuaJIT-${VER_LUAJIT}.tar.gz && rm LuaJIT-${VER_LUAJIT}.tar.gz\nRUN tar -xzvf ${NGINX_DEVEL_KIT}.tar.gz && rm ${NGINX_DEVEL_KIT}.tar.gz\nRUN tar -xzvf ${LUA_NGINX_MODULE}.tar.gz && rm ${LUA_NGINX_MODULE}.tar.gz\n\n#Lua LIBS\nRUN tar -xzvf ${LUA_RESTY_REDIS}.tar.gz && rm ${LUA_RESTY_REDIS}.tar.gz\n\n# copy openresty libraries to LUAJIT_LIB\nRUN cp -r ${LUA_RESTY_REDIS}/lib ${LUAJIT_LIB}/lua-libs\n\n\n# ***** BUILD FROM SOURCE *****\n\n# LuaJIT\nWORKDIR /LuaJIT-${VER_LUAJIT}\nRUN make\nRUN make install\n\n# Nginx with LuaJIT\nWORKDIR /nginx-${VER_NGINX}\nRUN ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=${NGINX_ROOT} --with-ld-opt=\"-Wl,-rpath,${LUAJIT_LIB}\" --add-module=/${NGINX_DEVEL_KIT} --add-module=/${LUA_NGINX_MODULE}\nRUN make -j2\nRUN make install\nRUN ln -s ${NGINX_ROOT}/sbin/nginx /usr/local/sbin/nginx\n\n# ***** MISC *****\nWORKDIR ${WEB_DIR}\nEXPOSE 80\nEXPOSE 443\n\n# ***** CLEANUP *****\nRUN rm -rf /nginx-${VER_NGINX}\nRUN rm -rf /LuaJIT-${VER_LUAJIT}\nRUN rm -rf /${NGINX_DEVEL_KIT}\nRUN rm -rf /${LUA_NGINX_MODULE}\n# TODO: Uninstall build only dependencies?\n# TODO: Remove env vars used only for build?\n\ncopy nginx.conf /nginx/conf/nginx.conf\ncopy nginx-lua.conf /nginx/conf/nginx-lua.conf\n\n# Run nginx and dnsmasq under supervisor\nCMD [\"/usr/bin/supervisord\"]\n"
}