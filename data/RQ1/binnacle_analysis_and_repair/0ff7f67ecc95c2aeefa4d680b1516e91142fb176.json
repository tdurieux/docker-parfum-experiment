{
  "startTime": 1674237069649,
  "endTime": 1674237069848,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 5,
        "columnEnd": 76
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\n# use this file except in compliance with the License. You may obtain a copy of\n# the License at\n#\n#   http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\n# License for the specific language governing permissions and limitations under\n# the License.\n\nFROM debian:jessie\n\nMAINTAINER phithon <root@leavesongs.com>\n\n# Install instructions from https://cwiki.apache.org/confluence/display/COUCHDB/Debian\n\nRUN groupadd -r couchdb && useradd -d /var/lib/couchdb -g couchdb couchdb\n\nRUN apt-get update -y && apt-get install -y --no-install-recommends \\\n    ca-certificates \\\n    curl \\\n    erlang-nox \\\n    libicu52 \\\n    libmozjs185-1.0 \\\n    libnspr4 \\\n    libnspr4-0d \\\n  && rm -rf /var/lib/apt/lists/*\n\n# grab gosu for easy step-down from root and tini for signal handling\nRUN curl -o /usr/local/bin/gosu -fSL \"https://github.com/tianon/gosu/releases/download/1.7/gosu-$(dpkg --print-architecture)\" \\\n  && chmod +x /usr/local/bin/gosu \\\n  && curl -o /usr/local/bin/tini -fSL \"https://github.com/krallin/tini/releases/download/v0.14.0/tini\" \\\n  && chmod +x /usr/local/bin/tini\n\n# download dependencies, compile and install couchdb,\n# set correct permissions, expose couchdb to the outside and disable logging to disk\nRUN buildDeps=' \\\n    gcc \\\n    g++ \\\n    erlang-dev \\\n    libcurl4-openssl-dev \\\n    libicu-dev \\\n    libmozjs185-dev \\\n    libnspr4-dev \\\n    make \\\n  ' \\\n  && apt-get update && apt-get install -y --no-install-recommends $buildDeps \\\n  && curl -fSL https://archive.apache.org/dist/couchdb/source/1.6.0/apache-couchdb-1.6.0.tar.gz -o couchdb.tar.gz \\\n  && mkdir -p /usr/src/couchdb \\\n  && tar -xzf couchdb.tar.gz -C /usr/src/couchdb --strip-components=1 \\\n  && cd /usr/src/couchdb \\\n  && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --with-js-lib=/usr/lib --with-js-include=/usr/include/mozjs \\\n  && make && make install \\\n  && apt-get purge -y --auto-remove $buildDeps \\\n  && rm -rf /var/lib/apt/lists/* /usr/src/couchdb /couchdb.tar.gz* \\\n  && chown -R couchdb:couchdb \\\n    /usr/local/lib/couchdb /usr/local/etc/couchdb \\\n    /usr/local/var/lib/couchdb /usr/local/var/log/couchdb /usr/local/var/run/couchdb \\\n  && chmod -R g+rw \\\n    /usr/local/lib/couchdb /usr/local/etc/couchdb \\\n    /usr/local/var/lib/couchdb /usr/local/var/log/couchdb /usr/local/var/run/couchdb \\\n  && mkdir -p /var/lib/couchdb \\\n  && sed -e 's/^bind_address = .*$/bind_address = 0.0.0.0/' -i /usr/local/etc/couchdb/default.ini \\\n  && sed -e 's!/usr/local/var/log/couchdb/couch.log$!/dev/null!' -i /usr/local/etc/couchdb/default.ini\n\nCOPY ./docker-entrypoint.sh /\nRUN chmod +x /docker-entrypoint.sh\n\nEXPOSE 5984\nWORKDIR /var/lib/couchdb\n\nENTRYPOINT [\"tini\", \"--\", \"/docker-entrypoint.sh\"]\nCMD [\"couchdb\"]"
}