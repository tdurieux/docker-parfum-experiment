{
  "startTime": 1674238890142,
  "endTime": 1674238890547,
  "originalSmells": [
    {
      "rule": "mkdirUsrSrcThenRemove",
      "position": {
        "lineStart": 134,
        "lineEnd": 134,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "mkdirUsrSrcThenRemove",
      "position": {
        "lineStart": 135,
        "lineEnd": 135,
        "columnStart": 4,
        "columnEnd": 44
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# DO NOT EDIT: created by update.sh from Dockerfile-debian.template\nFROM php:7.2-apache-stretch\n\n# entrypoint.sh and cron.sh dependencies\nRUN set -ex; \\\n    \\\n    apt-get update; \\\n    apt-get install -y --no-install-recommends \\\n        rsync \\\n        bzip2 \\\n        busybox-static \\\n    ; \\\n    rm -rf /var/lib/apt/lists/*; \\\n    \\\n    mkdir -p /var/spool/cron/crontabs; \\\n    echo '*/15 * * * * php -f /var/www/html/cron.php' > /var/spool/cron/crontabs/www-data\n\n# install the PHP extensions we need\n# see https://docs.nextcloud.com/server/stable/admin_manual/installation/source_installation.html\nRUN set -ex; \\\n    \\\n    savedAptMark=\"$(apt-mark showmanual)\"; \\\n    \\\n    apt-get update; \\\n    apt-get install -y --no-install-recommends \\\n        libcurl4-openssl-dev \\\n        libevent-dev \\\n        libfreetype6-dev \\\n        libicu-dev \\\n        libjpeg-dev \\\n        libldap2-dev \\\n        libmcrypt-dev \\\n        libmemcached-dev \\\n        libpng-dev \\\n        libpq-dev \\\n        libxml2-dev \\\n        libmagickwand-dev \\\n    ; \\\n    \\\n    debMultiarch=\"$(dpkg-architecture --query DEB_BUILD_MULTIARCH)\"; \\\n    docker-php-ext-configure gd --with-freetype-dir=/usr --with-png-dir=/usr --with-jpeg-dir=/usr; \\\n    docker-php-ext-configure ldap --with-libdir=\"lib/$debMultiarch\"; \\\n    docker-php-ext-install \\\n        exif \\\n        gd \\\n        intl \\\n        ldap \\\n        opcache \\\n        pcntl \\\n        pdo_mysql \\\n        pdo_pgsql \\\n        zip \\\n    ; \\\n    \\\n# pecl will claim success even if one install fails, so we need to perform each install separately\n    pecl install APCu-5.1.17; \\\n    pecl install memcached-3.1.3; \\\n    pecl install redis-4.3.0; \\\n    pecl install imagick-3.4.4; \\\n    \\\n    docker-php-ext-enable \\\n        apcu \\\n        memcached \\\n        redis \\\n        imagick \\\n    ; \\\n    \\\n# reset apt-mark's \"manual\" list so that \"purge --auto-remove\" will remove all build dependencies\n    apt-mark auto '.*' > /dev/null; \\\n    apt-mark manual $savedAptMark; \\\n    ldd \"$(php -r 'echo ini_get(\"extension_dir\");')\"/*.so \\\n        | awk '/=>/ { print $3 }' \\\n        | sort -u \\\n        | xargs -r dpkg-query -S \\\n        | cut -d: -f1 \\\n        | sort -u \\\n        | xargs -rt apt-mark manual; \\\n    \\\n    apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false; \\\n    rm -rf /var/lib/apt/lists/*\n\n# set recommended PHP.ini settings\n# see https://docs.nextcloud.com/server/12/admin_manual/configuration_server/server_tuning.html#enable-php-opcache\nRUN { \\\n        echo 'opcache.enable=1'; \\\n        echo 'opcache.enable_cli=1'; \\\n        echo 'opcache.interned_strings_buffer=8'; \\\n        echo 'opcache.max_accelerated_files=10000'; \\\n        echo 'opcache.memory_consumption=128'; \\\n        echo 'opcache.save_comments=1'; \\\n        echo 'opcache.revalidate_freq=1'; \\\n    } > /usr/local/etc/php/conf.d/opcache-recommended.ini; \\\n    \\\n    echo 'apc.enable_cli=1' >> /usr/local/etc/php/conf.d/docker-php-ext-apcu.ini; \\\n    \\\n    echo 'memory_limit=512M' > /usr/local/etc/php/conf.d/memory-limit.ini; \\\n    \\\n    mkdir /var/www/data; \\\n    chown -R www-data:root /var/www; \\\n    chmod -R g=u /var/www\n\nVOLUME /var/www/html\n\nRUN a2enmod rewrite remoteip ;\\\n    {\\\n     echo RemoteIPHeader X-Real-IP ;\\\n     echo RemoteIPTrustedProxy 10.0.0.0/8 ;\\\n     echo RemoteIPTrustedProxy 172.16.0.0/12 ;\\\n     echo RemoteIPTrustedProxy 192.168.0.0/16 ;\\\n    } > /etc/apache2/conf-available/remoteip.conf;\\\n    a2enconf remoteip\n\nENV NEXTCLOUD_VERSION 14.0.12\n\nRUN set -ex; \\\n    fetchDeps=\" \\\n        gnupg \\\n        dirmngr \\\n    \"; \\\n    apt-get update; \\\n    apt-get install -y --no-install-recommends $fetchDeps; \\\n\n    curl -fsSL -o nextcloud.tar.bz2 \\\n        \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2\"; \\\n    curl -fsSL -o nextcloud.tar.bz2.asc \\\n        \"https://download.nextcloud.com/server/releases/nextcloud-${NEXTCLOUD_VERSION}.tar.bz2.asc\"; \\\n    export GNUPGHOME=\"$(mktemp -d)\"; \\\n# gpg key from https://nextcloud.com/nextcloud.asc\n    gpg --batch --keyserver ha.pool.sks-keyservers.net --recv-keys 28806A878AE423A28372792ED75899B9A724937A; \\\n    gpg --batch --verify nextcloud.tar.bz2.asc nextcloud.tar.bz2; \\\n    tar -xjf nextcloud.tar.bz2 -C /usr/src/; \\\n    gpgconf --kill all; \\\n    rm -r \"$GNUPGHOME\" nextcloud.tar.bz2.asc nextcloud.tar.bz2; \\\n    rm -rf /usr/src/nextcloud/updater; \\\n    mkdir -p /usr/src/nextcloud/data; rm -rf /usr/src/nextcloud/data \\\n    mkdir -p /usr/src/nextcloud/custom_apps; \\\n    chmod +x /usr/src/nextcloud/occ; \\\n\n    apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false $fetchDeps; \\\n    rm -rf /var/lib/apt/lists/*\n\nCOPY *.sh upgrade.exclude /\nCOPY config/* /usr/src/nextcloud/config/\n\nENTRYPOINT [\"/entrypoint.sh\"]\nCMD [\"apache2-foreground\"]\n"
}