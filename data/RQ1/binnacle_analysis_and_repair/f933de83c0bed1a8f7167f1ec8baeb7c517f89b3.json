{
  "startTime": 1674252380990,
  "endTime": 1674252382158,
  "originalSmells": [
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 128,
        "lineEnd": 128,
        "columnStart": 4,
        "columnEnd": 75
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 240,
        "lineEnd": 240,
        "columnStart": 4,
        "columnEnd": 89
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 245,
        "lineEnd": 245,
        "columnStart": 4,
        "columnEnd": 107
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 291,
        "lineEnd": 291,
        "columnStart": 4,
        "columnEnd": 95
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 314,
        "lineEnd": 314,
        "columnStart": 4,
        "columnEnd": 95
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 173,
        "lineEnd": 173,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 179,
        "lineEnd": 179,
        "columnStart": 4,
        "columnEnd": 111
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 194,
        "lineEnd": 194,
        "columnStart": 4,
        "columnEnd": 43
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 197,
        "lineEnd": 197,
        "columnStart": 4,
        "columnEnd": 62
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 221,
        "lineEnd": 221,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 247,
        "lineEnd": 247,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 293,
        "lineEnd": 293,
        "columnStart": 4,
        "columnEnd": 46
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 316,
        "lineEnd": 316,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 83,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 95,
        "lineEnd": 95,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 43
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 137,
        "lineEnd": 137,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 146,
        "lineEnd": 146,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 165,
        "lineEnd": 165,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 205,
        "lineEnd": 205,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 83,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 95,
        "lineEnd": 95,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 43
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 137,
        "lineEnd": 137,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 146,
        "lineEnd": 146,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 165,
        "lineEnd": 165,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 205,
        "lineEnd": 205,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 83,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 95,
        "lineEnd": 95,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 43
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 137,
        "lineEnd": 137,
        "columnStart": 4,
        "columnEnd": 39
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 146,
        "lineEnd": 146,
        "columnStart": 4,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 165,
        "lineEnd": 165,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 205,
        "lineEnd": 205,
        "columnStart": 4,
        "columnEnd": 47
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 83,
        "lineEnd": 83,
        "columnStart": 4,
        "columnEnd": 77
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 90
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 95,
        "lineEnd": 95,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 4,
        "columnEnd": 67
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 137,
        "lineEnd": 137,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 146,
        "lineEnd": 146,
        "columnStart": 4,
        "columnEnd": 61
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 165,
        "lineEnd": 165,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 205,
        "lineEnd": 205,
        "columnStart": 4,
        "columnEnd": 71
      }
    }
  ],
  "repairedDockerfile": "#-------------------------------------------------------\n# $VERSION: [v1.1-8] $\n# $DATE:    [Wed Dec 27,2017 - 06:18:00PM -0600] $\n# $AUTHOR:  [mhassan2 <mhassan@splunk.com>] $\n\n#Increase OSX default docker size link:\n#https://forums.docker.com/t/increase-docker-container-disk-space-on-os-x/26725/2\n#https://github.com/docker/dceu_tutorials/blob/master/07-volumes.md\n\n#To build (from build dir): (11-15 mins)\n#time docker build --no-cache=true -f Dockerfile.datafabric -t splunknbox/splunk_datafabric .\n\n#To run: (cached: 3sec  Download: 5 mins)\n#time docker run -d --name=DF01 --hostname=DF01 -p 2122:22 -p 8000:8000 -p 8020:8020 -p 8030:8030 -p 8032:8032 -p 8088:8088 -p 9090:9090 -p 50070:50070 splunknbox/splunk_datafabric\n#OR\n#time docker run -d --name=DF01 --hostname=DF01 -p 2122:22 -p 8000:8000 -p 9090:9090 -p 50070:50070 splunknbox/splunk_datafabric\n\n#Push to splunknbox repo on docker hub: (~115 mins)\n#time docker push splunknbox/splunk_datafabric\n#-------------------------------------------------------\n\n#--------COLORES ESCAPE CODES------------\n#for i in `seq 1 100`; do printf \"\\033[48;5;${i}m${i} \"; done\n#NC='\\033[0m' # No Color\n#Black=\"\\033[0;30m\";             White=\"\\033[1;37m\"\n#Red=\"\\033[0;31m\";               LightRed=\"\\033[1;31m\"\n#Green=\"\\033[0;32m\";             LightGreen=\"\\033[1;32m\"\n#BrownOrange=\"\\033[0;33m\";       Yellow=\"\\033[1;33m\"\n#Blue=\"\\033[0;34m\";              LightBlue=\"\\033[1;34m\"\n#Purple=\"\\033[0;35m\";            LightPurple=\"\\033[1;35m\"\n#Cyan=\"\\033[0;36m\";              LightCyan=\"\\033[1;36m\"\n#LightGray=\"\\033[0;37m\";         DarkGray=\"\\033[1;30m\"\n#BlackOnGreen=\"\\033[30;48;5;82m\"\n#WhiteOnBurg=\"\\033[30;48;5;88m\"\n#\n#BoldWhiteOnRed=\"\\033[1;1;5;41m\"\n#BoldWhiteOnGreen=\"\\033[1;1;5;42m\"\n#BoldWhiteOnYellow=\"\\033[1;1;5;43m\"\n#BoldWhiteOnBlue=\"\\033[1;1;5;44m\"\n#BoldWhiteOnPink=\"\\033[1;1;5;45m\"\n#BoldWhiteOnTurquoise=\"\\033[1;1;5;46m\"\n\n#BoldYellowOnBlue=\"\\033[1;33;44m\"\n#BoldYellowOnPurple=\"\\033[1;33;44m\"\n\n#LABEL com.splunk.version=\"0.3-beta\"\n#LABEL vendor=\"Splunk>\"\n#LABEL com.splunk.release-date=\"2017-02-12\"\n#LABEL com.splunk.version.is-production=\"\"\n\n\nFROM debian:jessie\nENV GIT_VERSION=\"$VERSION: [v1.1-8] $\"\nENV CONTAINER_VER 1.0\nMAINTAINER mhassan@splunk.com version: $CONTAINER_VER\nENV DEBIAN_FRONTEND noninteractive\nENV TERM linux\n\n#ENV SPLUNK_VERSION=\"6.4.3\" SPLUNK_BUILD=\"b03109c2bad4\"\n#ENV SPLUNK_VERSION=\"6.4.4\" SPLUNK_BUILD=\"b53a5c14bb5e\"\n#ENV SPLUNK_VERSION=\"6.5.0\" SPLUNK_BUILD=\"59c8927def0f\"\n#ENV SPLUNK_VERSION=\"6.5.1\" SPLUNK_BUILD=\"f74036626f0c\"\n#ENV SPLUNK_VERSION=\"6.5.2\" SPLUNK_BUILD=\"67571ef4b87d\"\n#ENV SPLUNK_VERSION=\"6.5.3\" SPLUNK_BUILD=\"36937ad027d4\"\n#ENV SPLUNK_VERSION=\"6.5.4\" SPLUNK_BUILD=\"adb84211dd7c\"\n#ENV SPLUNK_VERSION=\"6.5.5\" SPLUNK_BUILD=\"586c3ec08cfb\"\n#ENV SPLUNK_VERSION=\"6.6.0\" SPLUNK_BUILD=\"1c4f3bbe1aea\"\n#ENV SPLUNK_VERSION=\"6.6.1\" SPLUNK_BUILD=\"aeae3fe0c5af\"\n#ENV SPLUNK_VERSION=\"6.6.2\" SPLUNK_BUILD=\"4b804538c686\"\n#ENV SPLUNK_VERSION=\"6.6.3\" SPLUNK_BUILD=\"e21ee54bc796\"\n#ENV SPLUNK_VERSION=\"7.0.0\" SPLUNK_BUILD=\"c8a78efdd40f\"\nENV SPLUNK_VERSION=\"7.0.1\"  SPLUNK_BUILD=\"2b5b15c4ee89\"\n\nENV SPLUNK_PRODUCT splunk\nENV SPLUNK_FILENAME splunk-${SPLUNK_VERSION}-${SPLUNK_BUILD}-Linux-x86_64.tgz\nENV SPLUNK_HOME /opt/splunk\nENV SPLUNK_GROUP splunk\nENV SPLUNK_USER splunk\nENV SPLUNK_BACKUP_DEFAULT_ETC /var/opt/splunk\n\n\nRUN printf \"\\033[1;33m\\n\\n-------------------- Installing Misc Stuff ---------------------\\n\"\nRUN apt-get -qq update && printf \"\\033[1;33m\"\nRUN apt-get -qq --no-install-recommends install -y apt-utils lsb-release curl && apt-get update && printf \"\\033[1;33m\" && rm -rf /var/lib/apt/lists/*;\n#RUN apt-get -qq update && printf \"\\033[1;33m\"\nRUN apt-get -qq --no-install-recommends install -y wget sudo vim net-tools telnet dnsutils && apt-get -qq update && rm -rf /var/lib/apt/lists/*;\nCOPY configs/containers.bashrc /root/.bashrc\nCOPY configs/containers.vimrc /root/.vimrc\nCOPY configs/environment /etc\n\nRUN printf \"\\033[1;32m\\n\\n-------------------- Installing Splunk ---------------------\\n\"\n# add splunk:splunk user\nRUN groupadd -r ${SPLUNK_GROUP} \\\n    && useradd -r -m -g ${SPLUNK_GROUP} ${SPLUNK_USER}\n# make the \"en_US.UTF-8\" locale so splunk will be utf-8 enabled by default\nRUN apt-get -qq --no-install-recommends install -y locales \\\n    && localedef -i en_US -c -f UTF-8 -A /usr/share/locale/locale.alias en_US.UTF-8 && rm -rf /var/lib/apt/lists/*;\nENV LANG en_US.utf8\n\n# pdfgen dependency\nRUN apt-get -qq --no-install-recommends install -y libgssapi-krb5-2 && rm -rf /var/lib/apt/lists/*;\nRUN apt-get -qq update && printf \"\\033[1;32m\"\n\n# Download official Splunk release, verify checksum and unzip in /opt/splunk\n# Also backup etc folder, so it will be later copied to the linked volume\nRUN mkdir -p ${SPLUNK_HOME} \\\n    && wget -qO /tmp/${SPLUNK_FILENAME} https://download.splunk.com/products/${SPLUNK_PRODUCT}/releases/${SPLUNK_VERSION}/linux/${SPLUNK_FILENAME} \\\n    && wget -qO /tmp/${SPLUNK_FILENAME}.md5 https://download.splunk.com/products/${SPLUNK_PRODUCT}/releases/${SPLUNK_VERSION}/linux/${SPLUNK_FILENAME}.md5 \\\n    && (cd /tmp && md5sum -c ${SPLUNK_FILENAME}.md5) \\\n    && tar -xzf /tmp/${SPLUNK_FILENAME} --strip 1 -C ${SPLUNK_HOME} \\\n    && rm /tmp/${SPLUNK_FILENAME} \\\n    && rm /tmp/${SPLUNK_FILENAME}.md5 \\\n    && mkdir -p /var/opt/splunk \\\n    && cp -R ${SPLUNK_HOME}/etc ${SPLUNK_BACKUP_DEFAULT_ETC} \\\n    && rm -fR ${SPLUNK_HOME}/etc \\\n    && chown -R ${SPLUNK_USER}:${SPLUNK_GROUP} ${SPLUNK_HOME} \\\n    && chown -R ${SPLUNK_USER}:${SPLUNK_GROUP} ${SPLUNK_BACKUP_DEFAULT_ETC} \\\n    && rm -rf /var/lib/apt/lists/*\n#    && apt-get purge -y --auto-remove wget \\\nCOPY scripts/splunk_web_conf.sh /sbin/splunk_web_conf.sh\nRUN chmod +x /sbin/splunk_web_conf.sh\nCOPY scripts/splunk_first_run.sh /sbin/splunk_first_run.sh\nRUN chmod +x /sbin/splunk_first_run.sh\nCOPY scripts/splunk /etc/init.d\nRUN chmod +x /etc/init.d/splunk\n#--------------------------------------------------------------\n\nRUN printf \"\\033[1;32m\\n\\n-------------------- Downloading WORLD database ---------------------\\n\"\nRUN wget -qO /tmp/world.sql.gz https://downloads.mysql.com/docs/world.sql.gz\n#COPY Packages_download/world.sql.gz  /tmp\n#COPY scripts/startup_mysql.sh /sbin/startup_mysql.sh\n#RUN chmod +x /sbin/startup_mysql.sh\nRUN gunzip /tmp/world.sql.gz\n#--------------------------------------------------------------\n\nRUN printf \"\\033[1;34m\\n\\n-------------------- Installing MySQL ---------------------\\n\"\nRUN apt-get -qq update && printf \"\\033[1;34m\"\nRUN apt-get -qq --no-install-recommends install -y mysql-server && rm -rf /var/lib/apt/lists/*;\n#copy the customized mysql startup script\nCOPY scripts/mysql /etc/init.d/mysql\nRUN chmod +x /etc/init.d/mysql\n#--------------------------------------------------------------\n\n\nRUN printf \"\\033[1;36m\\n\\n-------------------- Installing supervisord ---------------------\\n\"\nRUN apt-get -qq update && printf \"\\033[1;36m\"\nRUN apt-get -qq --no-install-recommends install -y supervisor && rm -rf /var/lib/apt/lists/*;\nCOPY configs/supervisord.conf /etc/supervisor/supervisord.conf\n#configure built-in webserver\n#RUN mkdir -p /etc/nginx/sites-available/\n#RUN mkdir -p /etc/nginx/sites-enable/\n#COPY configs/supervisord.web /etc/nginx/sites-available/supervisord\n#RUN  ln -s /etc/nginx/sites-available/supervisord /etc/nginx/sites-enable/supervisord\n#--------------------------------------------------------------\n\n\n#http://www.webupd8.org/2014/03/how-to-install-oracle-java-8-in-debian.html\nRUN printf \"\\033[1;33m\\n\\n-------------------- Installing Java 8 ---------------------\\n\"\n#RUN apt-get update\t&& apt-get install -y software-properties-common && apt-get update\nRUN echo \"deb http://ppa.launchpad.net/webupd8team/java/ubuntu xenial main\" | tee /etc/apt/sources.list.d/webupd8team-java.list\nRUN echo \"deb-src http://ppa.launchpad.net/webupd8team/java/ubuntu xenial main\" | tee -a /etc/apt/sources.list.d/webupd8team-java.list\nRUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv-keys EEA14886\nRUN printf \"\\033[1;33m\"\nRUN apt-get -qq update && printf \"\\033[1;33\"\nRUN echo oracle-java8-installer shared/accepted-oracle-license-v1-1 select true | sudo /usr/bin/debconf-set-selections\nRUN apt-get -qq --no-install-recommends install -y oracle-java8-installer && rm -rf /var/lib/apt/lists/*;\nENV JAVA_HOME /usr/lib/jvm/java-8-oracle\n#--------------------------------------------------------------\n\nRUN printf \"\\033[1;32m\\n\\n-------------------- Installing splunk apps: DBconnect, MySQL driver & Kafka add-on ---------------------\\n\"\n#order of splunk apps install is important. First DBconnet then the MySQL driver\n#DBconnect App 3.11\nCOPY splunk_apps/splunk-db-connect_311.tgz /tmp/splunk-db-connect_311.tgz\nRUN tar -zxf /tmp/splunk-db-connect_311.tgz -C /var/opt/splunk/etc/apps && rm /tmp/splunk-db-connect_311.tgz\nRUN rm -f /tmp/splunk-db-connect_311.tgz\n\n#MySQL java driver\nRUN wget -qO /tmp/mysql-connector-java-5.1.44.tar.gz https://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.44.tar.gz\n#COPY Packages_download/mysql-connector-java-5.1.44.tar.gz  /tmp\nRUN tar -zxf /tmp/mysql-connector-java-5.1.44.tar.gz -C /var/opt/splunk/etc/apps/splunk_app_db_connect/drivers/ && rm /tmp/mysql-connector-java-5.1.44.tar.gz\nRUN rm -f /tmp/mysql-connector-java-5.1.44.tar.gz\n\n#Kafka add-on\n#COPY splunk_apps/splunk-add-on-for-kafka_110.tgz /tmp/splunk-add-on-for-kafka_110.tgz\n#RUN tar -zxf /tmp/splunk-add-on-for-kafka_110.tgz -C /var/opt/splunk/etc/apps\n#RUN rm -f /tmp/splunk-add-on-for-kafka_110.tgz\n\n#Kafka connect app (beta)\n#COPY splunk_apps/kafka-connect-splunk.tar.gz /tmp\n#RUN tar -zxf /tmp/kafka-connect-splunk.tar.gz -C /var/opt/splunk/etc/apps\n#RUN rm -f /tmp/kafka-connect-splunk.tar.gz\n\n#Configuring indexers [include hadoop vidx]\nCOPY splunk_apps/indexes.tgz /tmp/indexes.tgz\nRUN tar xzf /tmp/indexes.tgz -C /opt/splunk && rm /tmp/indexes.tgz\n#Install Splunk apps [dbconnect 2.x, kafka addon,] & dashboards [search app]\nCOPY splunk_apps/apps_configs.tgz /tmp/apps_configs.tgz\nRUN tar xzf /tmp/apps_configs.tgz -C /var/opt/splunk/etc/apps/ && rm /tmp/apps_configs.tgz\nRUN mkdir -p /var/opt/splunk/etc/apps/user-prefs/local\nCOPY configs/user-prefs.conf  /var/opt/splunk/etc/apps/user-prefs/local\nRUN chown -R ${SPLUNK_USER}:${SPLUNK_GROUP} /var/opt/splunk/etc/apps\nRUN rm -f /tmp/indexes.tgz /tmp/apps_configs.tgz\n#--------------------------------------------------------------\n\nRUN printf \"\\033[1;36m\\n\\n-------------------- Installing & Configuring sshd ---------------------\\n\"\nRUN apt-get -qq --no-install-recommends install -y openssh-server rsync && rm -rf /var/lib/apt/lists/*;\nRUN apt-get -qq update && printf \"\\033[1;36m\"\n\n#passwordless ssh login\nRUN ssh-keygen -t rsa -P '' -f ~/.ssh/id_rsa\nRUN cat ~/.ssh/id_rsa.pub >> ~/.ssh/authorized_keys\nRUN chmod 0600 ~/.ssh/authorized_keys\nRUN echo  \"StrictHostKeyChecking no\" >> /etc/ssh/ssh_config\nRUN echo  \"UserKnownHostsFile=/dev/null\" >> /etc/ssh/ssh_config\n#RUN sed -i 's/PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config\nRUN sed -i 's/PermitRootLogin without-password/PermitRootLogin yes/' /etc/ssh/sshd_config\nRUN echo \"UsePAM no\" >> /etc/ssh/sshd_config\nRUN echo \"Port 2122\" >> /etc/ssh/sshd_config\nRUN echo \"ListenAddress 0.0.0.0\" >> /etc/ssh/sshd_config\n#Share static host keys so we dont get ssh warning with different builds\nCOPY configs/ssh_host_keys.tgz /tmp/ssh_host_keys.tgz\nRUN tar -zxf /tmp/ssh_host_keys.tgz -C /etc/ssh && rm /tmp/ssh_host_keys.tgz\n\n# SSH login fix. Otherwise user is kicked off after login\nRUN sed 's@session\\s*required\\s*pam_loginuid.so@session optional pam_loginuid.so@g' -i /etc/pam.d/sshd\nRUN echo root:splunk123 | chpasswd\nENV NOTVISIBLE \"in users profile\"\nRUN echo \"export VISIBLE=now\" >> /etc/profile\nRUN rm -f /tmp/ssh_host_keys.tgz\nCOPY scripts/ssh /etc/init.d/\nRUN chmod +x /etc/init.d/ssh\n#--------------------------------------------------------------\n\nRUN printf \"\\033[1;37m\\n\\n-------------------- Installing Hadoop(Yarn) ---------------------\\n\"\n#force hadoop to use different ssh port\n#ENV HADOOP_SSH_OPTS \"-p 2122\"\n#Make the default user \"splunk\" that write to hdfs to address the permission issue\nENV HADOOP_USER_NAME=\"splunk\"\n\n#Download sample hadoop data\nRUN wget -qO /tmp/Hunkdata.json.gz https://www.splunk.com/web_assets/hunk/Hunkdata.json.gz\n#COPY Packages_download/Hunkdata.json.gz /tmp\nCOPY /data/avro_07_31_2017.avro /tmp/avro_07_31_2017.avro\nCOPY /data/avro_08_01_2017.avro /tmp/avro_08_01_2017.avro\n\nRUN wget -qO /tmp/hadoop-2.9.0.tar.gz https://apache.claz.org/hadoop/common/hadoop-2.9.0/hadoop-2.9.0.tar.gz\n#COPY Packages_download/hadoop-2.9.0.tar.gz /tmp\nRUN tar -zxf /tmp/hadoop-2.9.0.tar.gz -C /opt && rm /tmp/hadoop-2.9.0.tar.gz\nRUN rm -f /tmp/hadoop-2.9.0.tar.gz\n\n#Customization\nRUN mkdir -p /opt/hadoop-2.9.0/etc/input\nRUN cp /opt/hadoop-2.9.0/etc/hadoop/*.xml /opt/hadoop-2.9.0/etc/input/\n#RUN /bin/bash -c \"/opt/hadoop-2.9.0/bin/hadoop jar /opt/hadoop-2.9.0/share/hadoop/mapreduce/hadoop-mapreduce-examples-2.9.0.jar grep input output 'dfs[a-z.]+'\"\nCOPY configs/core-site.xml /opt/hadoop-2.9.0/etc/hadoop/core-site.xml\nCOPY configs/hdfs-site.xml /opt/hadoop-2.9.0/etc/hadoop/hdfs-site.xml\nCOPY configs/mapred-site.xml /opt/hadoop-2.9.0/etc/hadoop/mapred-site.xml\nCOPY configs/yarn-site.xml /opt/hadoop-2.9.0/etc/hadoop/yarn-site.xml\n#Format HDFS\nRUN /opt/hadoop-2.9.0/bin/hdfs namenode -format -force\n#RUN printf \"\\033[0;36m\"\n#COPY scripts/startup_hadoop.sh /sbin/startup_hadoop.sh\n#RUN chmod +x /sbin/startup_hadoop.sh\nCOPY scripts/hadoop /etc/init.d/\nCOPY scripts/yarn /etc/init.d/\nCOPY scripts/start-yarn.sh /opt/hadoop-2.9.0/sbin/\nCOPY scripts/stop-yarn.sh /opt/hadoop-2.9.0/sbin/\nCOPY scripts/start-dfs.sh /opt/hadoop-2.9.0/sbin/\nCOPY scripts/stop-dfs.sh /opt/hadoop-2.9.0/sbin/\n\nRUN chmod +x /etc/init.d/hadoop\nRUN chmod +x /etc/init.d/yarn\nRUN chmod +x /opt/hadoop-2.9.0/sbin/start-yarn.sh\nRUN chmod +x /opt/hadoop-2.9.0/sbin/stop-yarn.sh\nRUN chmod +x /opt/hadoop-2.9.0/sbin/start-dfs.sh\nRUN chmod +x /opt/hadoop-2.9.0/sbin/stop-dfs.sh\n#--------------------------------------------------------------\n\n#>>>>>> disable Zookeeper install. It is embemded in Kafka install <<<<<<\n#https://www.tutorialspoint.com/apache_kafka/apache_kafka_basic_operations.htm\n#RUN printf \"\\033[1;36m\\n\\n-------------------- Installing ZooKeeper ---------------------\\n\"\n#RUN wget -qO /tmp/zookeeper-3.4.11.tar.gz  http://apache.claz.org/zookeeper/zookeeper-3.4.11/zookeeper-3.4.11.tar.gz\n#COPY Packages_download/zookeeper-3.4.11.tar.gz  /tmp\n#RUN tar -zxf /tmp/zookeeper-3.4.11.tar.gz -C /opt\n#RUN rm -f /tmp/zookeeper-3.4.11.tar.gz\n#Customization\n#COPY configs/zoo.cfg /opt/zookeeper-3.4.11/conf/zoo.cfg\n#--------------------------------------------------------------\n#>>>>>> disable Zookeeper install. It is embemded in Kafka install <<<<<<\n\nRUN printf \"\\033[1;33m\\n\\n-------------------- Installing Kafka ---------------------\\n\"\nRUN wget -qO /tmp/kafka_2.11-1.0.0.tgz https://apache.claz.org/kafka/1.0.0/kafka_2.11-1.0.0.tgz\n#COPY Packages_download/kafka_2.11-1.0.0.tgz /tmp\nRUN tar -zxf /tmp/kafka_2.11-1.0.0.tgz -C /opt && rm /tmp/kafka_2.11-1.0.0.tgz\nRUN rm -f /tmp/kafka_2.11-1.0.0.tgz\n\nCOPY data/sample_kafka.log /tmp/sample_kafka.log\n#COPY scripts/startup_zoo_kafka.sh /sbin/startup_zoo_kafka.sh\n#RUN chmod +x /sbin/startup_zoo_kafka.sh\nCOPY scripts/zookeeper-server-start.sh /opt/kafka_2.11-1.0.0/bin\nCOPY scripts/zookeeper-server-stop.sh /opt/kafka_2.11-1.0.0/bin\nCOPY scripts/kafka-server-stop.sh /opt/kafka_2.11-1.0.0/bin\nCOPY scripts/kafka-server-start.sh /opt/kafka_2.11-1.0.0/bin\nCOPY scripts/kafka /etc/init.d/\nCOPY scripts/zookeeper /etc/init.d/\nRUN chmod +x /etc/init.d/kafka\nRUN chmod +x /etc/init.d/zookeeper\nRUN chmod +x /opt/kafka_2.11-1.0.0/bin/zookeeper-server-start.sh\nRUN chmod +x /opt/kafka_2.11-1.0.0/bin/zookeeper-server-stop.sh\nRUN chmod +x /opt/kafka_2.11-1.0.0/bin/kafka-server-stop.sh\nRUN chmod +x /opt/kafka_2.11-1.0.0/bin/kafka-server-start.sh\n#--------------------------------------------------------------\n\nRUN printf \"\\033[1;34m\\n\\n-------------------- Installing Apache NIFI ---------------------\\n\"\nRUN wget -qO /tmp/nifi-1.4.0-bin.tar.gz https://apache.claz.org/nifi/1.4.0/nifi-1.4.0-bin.tar.gz\n#COPY Packages_download/nifi-1.4.0-bin.tar.gz /tmp\nRUN tar -xzf /tmp/nifi-1.4.0-bin.tar.gz -C /opt && rm /tmp/nifi-1.4.0-bin.tar.gz\nRUN rm -f /tmp/nifi-1.4.0-bin.tar.gz\n\n#need uuidgen command for nifi UI configuration\n#RUN apt-get -qq install -y uuid-runtime\n\n#create nifi data directory with sample access combined logs\nRUN mkdir /opt/nifi-1.4.0/splunk_sample_data\nCOPY data/access.log /opt/nifi-1.4.0/splunk_sample_data/access1.log\nCOPY data/access.log /opt/nifi-1.4.0/splunk_sample_data/access2.log\nCOPY data/access.log /opt/nifi-1.4.0/splunk_sample_data/access3.log\nCOPY configs/flow.xml.gz /opt/nifi-1.4.0/conf\n#COPY scripts/startup_nifi.sh /sbin/startup_nifi.sh\n#RUN chmod +x /sbin/startup_nifi.sh\nCOPY scripts/nifi /etc/init.d/\nCOPY scripts/nifi.sh   /opt/nifi-1.4.0/bin/\nRUN chmod +x /etc/init.d/nifi\nRUN chmod +x /opt/nifi-1.4.0/bin/nifi.sh\n\n#nifi customization\nRUN echo \"java=/usr/lib/jvm/java-8-oracle/\" >> /opt/nifi-1.4.0/conf/bootstrap\nRUN echo \"\" >> /opt/nifi-1.4.0/bin/nifi-env.sh\n#this template will be manually imported in the UI (file is loaded from local disk)\nCOPY configs/Splunk_HEC_TCP_RESTQuery.xml /tmp/Splunk_HEC_TCP_RESTQuery.xml\nRUN echo \"export JAVA_HOME=/usr/lib/jvm/java-8-oracle/\" >> /opt/nifi-1.4.0/bin/nifi-env.sh\n#change default nifi port to 9090\nRUN sed -i 's/nifi.web.http.port=8080/nifi.web.http.port=9090/' /opt/nifi-1.4.0/conf/nifi.properties\n#--------------------------------------------------------------\n\n\n#clean up /tmp\nRUN printf \"\\033[1;37m\\n\\n-------------------- /tmp cleanup ---------------------\\n\"\n#\t/tmp/Hunkdata.json.gz /tmp/world.sql  dont remove now. will be used with startup scripts later\n\n#COPY configs/local.tar /tmp\n#RUN tar -xvf /tmp/local.tar /opt/splunk/etc/apps/splunk_app_db_connect/local/\n\n#startup scripts with be kicked off from supervisord.conf\n\n\n# Ports Splunk Web, Splunk Daemon, KVStore, Splunk Indexing Port, Network Input, HTTP Event Collector\nEXPOSE 8000/tcp 8089/tcp 8191/tcp 9997/tcp 1514/udp 8088/tcp 9088/tcp\n#MySQL\nEXPOSE 3306/tcp\n#supervisord web\nEXPOSE 9001/tcp\n#Hadoop: Resource mgr:8088  namednode:50070  hdfs:9000\nEXPOSE 50070/tcp 9000/tcp 8088/tcp 2122/tcp\n# Hdfs ports\nEXPOSE 50010 50020 50070 50075 50090 8020 9000\n# Mapred ports\nEXPOSE 10020 19888\n#Yarn ports\nEXPOSE 8030 8031 8032 8033 8040 8042 8088 10020 19888 10200\n#Other ports\nEXPOSE 49707 2122\n#NIFI\nEXPOSE 9090\n\nWORKDIR /opt/splunk\n\n# Configurations folder, var folder for everything (indexes, logs, kvstore)\nVOLUME [ \"/opt/splunk/etc\", \"/opt/splunk/var\", \"/var/lib/mysql\" ]\n\nCMD [\"/usr/bin/supervisord\"]\n\n\nRUN printf \"\\033[1;33m\\n\\n-------------------- We are done baby! ---------------------\\033[0m\\n\"\n\n\n"
}