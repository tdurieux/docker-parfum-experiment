{
  "startTime": 1674241124171,
  "endTime": 1674241124649,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 95
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 4,
        "columnEnd": 103
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 4,
        "columnEnd": 90
      }
    },
    {
      "rule": "curlUseHttpsUrl",
      "position": {
        "lineStart": 78,
        "lineEnd": 78,
        "columnStart": 4,
        "columnEnd": 90
      }
    },
    {
      "rule": "mkdirUsrSrcThenRemove",
      "position": {
        "lineStart": 11,
        "lineEnd": 11,
        "columnStart": 4,
        "columnEnd": 25
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 102,
        "lineEnd": 121,
        "columnStart": 4,
        "columnEnd": 13
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 49,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 59
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM debian:jessie\nMAINTAINER \"cytopia\" <cytopia@everythingcli.org>\n\n\nENV PHP_VERSION 5.2.17\nENV PHP_INI_DIR /usr/local/etc/php\n\n\n# Setup directories\nRUN set -x \\\n\t&& mkdir -p ${PHP_INI_DIR}/conf.d \\\n\t&& mkdir -p /usr/src/php && rm -rf /usr/src/php\n# persistent / runtime deps\nRUN set -x \\\n\t&& apt-get update && apt-get install -y --no-install-recommends \\\n\t\tca-certificates \\\n\t\tcurl \\\n\t\tlibpcre3 \\\n\t\tlibrecode0 \\\n\t\tlibmysqlclient-dev \\\n\t\tlibsqlite3-0 \\\n\t\tlibxml2 \\\n\t&& apt-get clean \\\n\t&& rm -r /var/lib/apt/lists/*\n\n\n# phpize deps\nRUN set -x \\\n\t&& apt-get update && apt-get install -y --no-install-recommends \\\n\t\tautoconf \\\n\t\tfile \\\n\t\tg++ \\\n\t\tgcc \\\n\t\tlibc-dev \\\n\t\tmake \\\n\t\tpkg-config \\\n\t\tre2c \\\n\t\txz-utils \\\n\t&& apt-get clean \\\n\t&& rm -r /var/lib/apt/lists/*\n\n\n# compile openssl, otherwise --with-openssl won't work\nRUN set -x \\\n\t&& OPENSSL_VERSION=\"1.0.2g\" \\\n\t&& cd /tmp \\\n\t&& mkdir openssl \\\n\t&& curl -f -sL \"https://www.openssl.org/source/openssl-$OPENSSL_VERSION.tar.gz\" -o openssl.tar.gz \\\n\t&& curl -f -sL \"https://www.openssl.org/source/openssl-$OPENSSL_VERSION.tar.gz.asc\" -o openssl.tar.gz.asc \\\n\t&& tar -xzf openssl.tar.gz -C openssl --strip-components=1 \\\n\t&& cd /tmp/openssl \\\n\t&& ./config && make && make install \\\n\t&& rm -rf /tmp/openssl* && rm openssl.tar.gz\n\n\n# php 5.2 needs older autoconf\nRUN set -x \\\n\t&& buildDeps=\" \\\n\t\tautoconf2.13 \\\n\t\tlibbison-dev \\\n\t\tlibcurl4-openssl-dev \\\n\t\tlibfl-dev \\\n\t\tlibmysqlclient-dev \\\n\t\tlibpcre3-dev \\\n\t\tlibreadline6-dev \\\n\t\tlibrecode-dev \\\n\t\tlibsqlite3-dev \\\n\t\tlibssl-dev \\\n\t\tlibxml2-dev \\\n\t\tpatch \\\n\t\" \\\n\t&& set -x \\\n\t&& apt-get update && apt-get install -y $buildDeps --no-install-recommends && rm -rf /var/lib/apt/lists/*\n\n\n# Copy and apply patches to PHP\nCOPY data/php-${PHP_VERSION}*.patch /tmp/\nRUN set -x \\\n\t&& curl -f -SL \"https://museum.php.net/php5/php-${PHP_VERSION}.tar.gz\" -o /usr/src/php.tar.gz \\\n\n# Extract artifacts\n\t&& tar -xf /usr/src/php.tar.gz -C /usr/src/php --strip-components=1 \\\n# Apply patches\n\t&& cd /usr/src/php \\\n\t&& patch -p1 < /tmp/php-${PHP_VERSION}-libxml2.patch \\\n\t&& patch -p1 < /tmp/php-${PHP_VERSION}-openssl.patch \\\n\t&& patch -p1 < /tmp/php-${PHP_VERSION}-fpm.patch \\\n\t&& patch -p0 < /tmp/php-${PHP_VERSION}-curl.patch || true \\\n# Create php.tar.xz\n\t&& cd /usr/src \\\n\t&& tar -cJf php.tar.xz php \\\n# Clean-up\n\t&& rm -rf php php.tar.gz \\\n\t&& rm -rf /tmp/php-*\n\n\nCOPY data/docker-php-source /usr/local/bin/\nRUN set -x \\\n\t&& ln -s /usr/lib/x86_64-linux-gnu/libmysqlclient* /usr/lib/ \\\n\t&& cd /usr/src \\\n\t&& docker-php-source extract \\\n\t&& cd /usr/src/php \\\n\t&& ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" \\\n\t\t--with-config-file-path=\"${PHP_INI_DIR}\" \\\n\t\t--with-config-file-scan-dir=\"${PHP_INI_DIR}/conf.d\" \\\n\t\t--with-fpm-conf=\"/usr/local/etc/php-fpm.conf\" \\\n\n\t\t--enable-fastcgi \\\n\t\t--enable-fpm \\\n\t\t--enable-force-cgi-redirect \\\n\n\t\t--enable-mbstring \\\n\t\t--enable-pdo \\\n\t\t--enable-soap \\\n\n\t\t--with-curl \\\n\t\t--with-mysql \\\n\t\t--with-mysqli \\\n\t\t--with-openssl=/usr/local/ssl \\\n\t\t--with-pdo-mysql \\\n\t\t--with-readline \\\n\t\t--with-zlib \\\n\t#&& sed -i 's/-lxml2 -lxml2 -lxml2/-lcrypto -lssl/' Makefile \\\n\t&& make -j\"$(nproc)\" \\\n\t&& make install \\\n# Clean-up\n\t&& { find /usr/local/bin /usr/local/sbin -type f -executable -exec strip --strip-all '{}' + || true; } \\\n\t&& apt-get purge -y --auto-remove -o APT::AutoRemove::RecommendsImportant=false -o APT::AutoRemove::SuggestsImportant=false ${buildDeps} \\\n\t&& make clean \\\n\t&& cd / \\\n\t&& docker-php-source delete\n\nWORKDIR /var/www/html\nCOPY data/docker-php-* /usr/local/bin/\nCOPY data/php-fpm /usr/local/sbin/php-fpm\nCOPY data/php-fpm.conf /usr/local/etc/\nCOPY data/php.ini /usr/local/etc/php/php.ini\n\n\nEXPOSE 9000\nENTRYPOINT [\"php-fpm\"]\n"
}