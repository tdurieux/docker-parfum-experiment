{
  "startTime": 1674248195282,
  "endTime": 1674248196032,
  "originalSmells": [
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 105,
        "lineEnd": 105,
        "columnStart": 4,
        "columnEnd": 199
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 253
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM centos:centos6\n\nADD conf/setup.conf /tmp/setup.conf\nADD conf/cobbler_web.conf /etc/httpd/conf.d/cobbler_web.conf\nADD conf/ssl.conf /etc/httpd/conf.d/ssl.conf\nADD conf/tftpd.template /etc/cobbler/tftpd.template\nADD conf/modules.conf /etc/cobbler/modules.conf\nADD conf/distributions /tmp/distributions\nADD conf/dhcp.template /etc/cobbler/dhcp.template\nRUN chmod +x /tmp/setup.conf\n\n# add epel repo and atomic(for installing reprepro: a command tool to build debian repos) repo\nRUN source /tmp/setup.conf && \\\n    rpm -Uvh $EPEL7 && \\\n    sed -i 's/^mirrorlist=https/mirrorlist=http/g' /etc/yum.repos.d/epel.repo && \\\n    rpm -Uvh $ATOMIC && \\\n    sed -i 's/^mirrorlist=https/mirrorlist=http/g' /etc/yum.repos.d/atomic.repo\n\nRUN yum clean all && \\\n    yum update -y --skip-broken && \\\n    yum install -y syslinux bind rsync dhcp xinetd tftp-server gcc httpd cobbler cobbler-web createrepo mkisofs python-cheetah python-simplejson python-urlgrabber PyYAML PyYAML Django cman pykickstart reprepro git wget debmirror cman openssl openssl098e && rm -rf /var/cache/yum\n\n# configure cobbler web and ssl\nRUN mkdir -p /root/backup/cobbler && \\\n    cp -rn /etc/httpd/conf.d /root/backup/cobbler && \\\n    chmod 644 /etc/httpd/conf.d/cobbler_web.conf && \\\n    chmod 644 /etc/httpd/conf.d/ssl.conf\n\n# update tftpd template\nRUN chmod 644 /etc/cobbler/tftpd.template\n\n# update modules conf\nRUN chmod 644 /etc/cobbler/modules.conf\n\n# setup cobbler default web username password: cobbler/cobbler\nRUN (echo -n \"cobbler:Cobbler:\" && echo -n \"cobbler:Cobbler:cobbler\" | md5sum - | cut -d' ' -f1) > /etc/cobbler/users.digest\n\n\n# get adapters code\nWORKDIR /root/\nRUN git clone -b dev/experimental https://git.openstack.org/stackforge/compass-adapters.git && \\\n    cp -rn /var/lib/cobbler/snippets /root/backup/cobbler/ && \\\n    cp -rn /var/lib/cobbler/scripts /root/backup/cobbler && \\\n    cp -rn /var/lib/cobbler/kickstarts/ /root/backup/cobbler/ && \\\n    cp -rn /var/lib/cobbler/triggers /root/backup/cobbler/ && \\\n    rm -rf /var/lib/cobbler/snippets/* && \\\n    cp -rf compass-adapters/cobbler/snippets/* /var/lib/cobbler/snippets/ && \\\n    cp -rf compass-adapters/cobbler/scripts/* /var/lib/cobbler/scripts/ && \\\n    cp -rf compass-adapters/cobbler/triggers/* /var/lib/cobbler/triggers/ && \\\n    chmod 777 /var/lib/cobbler/snippets && \\\n    chmod 777 /var/lib/cobbler/scripts && \\\n    chmod -R 666 /var/lib/cobbler/snippets/* && \\\n    chmod -R 666 /var/lib/cobbler/scripts/* && \\\n    chmod -R 755 /var/lib/cobbler/triggers && \\\n    rm -f /var/lib/cobbler/kickstarts/default.ks && \\\n    rm -f /var/lib/cobbler/kickstarts/default.seed && \\\n    cp -rf compass-adapters/cobbler/kickstarts/default.ks /var/lib/cobbler/kickstarts/ && \\\n    cp -rf compass-adapters//cobbler/kickstarts/default.seed /var/lib/cobbler/kickstarts/ && \\\n    chmod 666 /var/lib/cobbler/kickstarts/default.ks && \\\n    chmod 666 /var/lib/cobbler/kickstarts/default.seed && \\\n    mkdir -p /var/www/cblr_ks && \\\n    chmod 755 /var/www/cblr_ks && \\\n    cp -rf compass-adapters/cobbler/conf/cobbler.conf /etc/httpd/conf.d/ && \\\n    chmod 644 /etc/httpd/conf.d/cobbler.conf && \\\n    export passwd=$(openssl passwd -1 -salt 'huawei' '123456') && \\\n    sed -i \"s,^default_password_crypted:[ \\t]\\+\\\"\\(.*\\)\\\",default_password_crypted: \\\"$cobbler_passwd\\\",g\" /etc/cobbler/settings && \\\n    chmod 644 /etc/cobbler/settings\n\n\n# disable selinux\nRUN echo 0 > /selinux/enforce\n\n# create log dirs\nRUN mkdir -p /var/log/cobbler && \\\n    mkdir -p /var/log/cobbler/tasks && \\\n    mkdir -p /var/log/cobbler/anamon && \\\n    chmod -R 777 /var/log/cobbler\n\n# create centos ppa repo dir\nRUN rm -rf /var/lib/cobbler/repo_mirror/centos_ppa_repo && \\\n    mkdir -p /var/lib/cobbler/repo_mirror/centos_ppa_repo\n\n# download centos repo pkgs\nWORKDIR /var/lib/cobbler/repo_mirror/centos_ppa_repo\nADD conf/setup.conf /tmp/setup.conf\nRUN source /tmp/setup.conf && \\\n    wget $NTP && \\\n    wget $SSH_CLIENTS && \\\n    wget $OPENSSH && \\\n    wget $IPROUTE && \\\n    wget $WGET && \\\n    wget $NTPDATE && \\\n    wget $YUM_PRIORITIES && \\\n    wget $JSONC && \\\n    wget $LIBESTR && \\\n    wget $LIBGT && \\\n    wget $LIBLOGGING && \\\n    wget $RSYSLOG && \\\n    wget $CHEF_CLIENT_CENTOS\n\n# creating ubuntu repo\nRUN rm -rf /var/lib/cobbler/repo_mirror/ubuntu_ppa_repo && \\\n    mkdir -p /var/lib/cobbler/repo_mirror/ubuntu_ppa_repo/conf && \\\n    mv /tmp/distributions /var/lib/cobbler/repo_mirror/ubuntu_ppa_repo/conf/distributions && \\\n    chmod 644 /var/lib/cobbler/repo_mirror/ubuntu_ppa_repo/conf/distributions && \\\n    wget -O /var/lib/cobbler/repo_mirror/ubuntu_ppa_repo/chef_11.8.0-1.ubuntu.12.04_amd64.deb https://opscode-omnibus-packages.s3.amazonaws.com/ubuntu/12.04/x86_64/chef_11.8.0-1.ubuntu.12.04_amd64.deb\n\nADD conf/1404_distributions /tmp/1404_distributions\n\nRUN rm -rf /var/lib/cobbler/repo_mirror/ubuntu_14_04_ppa_repo && \\\n    mkdir -p /var/lib/cobbler/repo_mirror/ubuntu_14_04_ppa_repo/conf && \\\n    mv /tmp/1404_distributions /var/lib/cobbler/repo_mirror/ubuntu_14_04_ppa_repo/conf/distributions && \\\n    chmod 644 /var/lib/cobbler/repo_mirror/ubuntu_14_04_ppa_repo/conf/distributions && \\\n    wget -O /var/lib/cobbler/repo_mirror/ubuntu_14_04_ppa_repo/chef_12.1.1-1_amd64.deb https://opscode-omnibus-packages.s3.amazonaws.com/ubuntu/13.04/x86_64/chef_12.1.1-1_amd64.deb\n\n\n# create repos\nWORKDIR /var/lib/cobbler/repo_mirror\nRUN createrepo centos_ppa_repo && \\\n    find ubuntu_ppa_repo -name \\*.deb -exec reprepro -Vb ubuntu_ppa_repo includedeb ppa {} \\; && \\\n    find ubuntu_14_04_ppa_repo -name \\*.deb -exec reprepro -Vb ubuntu_14_04_ppa_repo includedeb ppa {} \\;\n\n# add repos to cobbler repo and get loaders\nRUN /usr/sbin/apachectl -k start && \\\n    /usr/bin/cobblerd start \\& && \\\n    cobbler repo add --mirror=/var/lib/cobbler/repo_mirror/centos_ppa_repo --name=centos_ppa_repo --mirror-locally=Y --arch=x86_64 && \\\n    cobbler repo add --mirror=/var/lib/cobbler/repo_mirror/ubuntu_ppa_repo --name=ubuntu_ppa_repo --mirror-locally=Y --arch=x86_64 && \\\n    cobbler repo add --mirror=/var/lib/cobbler/repo_mirror/ubuntu_14_04_ppa_repo --name=ubuntu_14_04_ppa_repo --mirror-locally=Y --arch=x86_64 && \\\n    cobbler reposync && \\\n    cobbler get-loaders\n\nADD conf/cobbler.settings /etc/cobbler/settings\nRUN sed -i 's/disable\\([ \\t]\\+\\)=\\([ \\t]\\+\\)yes/disable\\1=\\2no/g' /etc/xinetd.d/rsync && \\\n    sed -i 's/^@dists=/# @dists=/g' /etc/debmirror.conf && \\\n    sed -i 's/^@arches=/# @arches=/g' /etc/debmirror.conf\n\n# create mount points\nRUN mkdir -p /var/lib/cobbler/mount_point\nVOLUME [\"/var/lib/cobbler/mount_point\"]\nADD scripts/start /root/start\nRUN chmod +x /root/start\nCMD [\"/root/start\"]\n\n\nEXPOSE 80\nEXPOSE 69 69/udp\nEXPOSE 53 53/udp\nEXPOSE 25151\nEXPOSE 443\nEXPOSE 873\n"
}