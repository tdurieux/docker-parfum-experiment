{
  "startTime": 1674238795730,
  "endTime": 1674238795906,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 4,
        "columnEnd": 61
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\nFROM prestodb/centos6-oj8:unlabelled\nMAINTAINER Presto community <https://prestodb.io/community.html>\n\nARG JDK_PATH\n\nENV JAVA_HOME=$JDK_PATH\n\n# INSTALL OPENLDAP\nRUN yum -y install openldap openldap-clients openldap-servers \\\n    # Cleanup\n    && yum -y clean all && rm -rf /tmp/* /var/tmp/* && rm -rf /var/cache/yum\n\n# COPY CONFIGURATION\nCOPY ./files /\n\n# CONFIGURE OPENLDAP SERVER\nRUN service slapd start && \\\n    ldapmodify -Y EXTERNAL -H ldapi:/// -f /etc/openldap/setup/modify_server.ldif && \\\n    ldapmodify -Y EXTERNAL -H ldapi:/// -f /etc/openldap/setup/ldap_disable_bind_anon.ldif && \\\n    ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/setup/memberof.ldif && \\\n    ldapadd -Y EXTERNAL -H ldapi:/// -f /etc/openldap/setup/refint.ldif && \\\n    ldapadd -f /etc/openldap/setup/createOU.ldif -D cn=admin,dc=presto,dc=testldap,dc=com -w admin\n\n# Import the Active Directory LDAP certificate into presto-coordinator\nRUN keytool -import -alias presto -storepass changeit -keystore $JAVA_HOME/jre/lib/security/cacerts \\\n    -noprompt -trustcacerts -file /etc/openldap/certs/active-directory-certificate.crt\n\n# Import the Open LDAP certificate into presto-coordinator\nRUN keytool -import -alias prestowithopenldap -storepass changeit -keystore $JAVA_HOME/jre/lib/security/cacerts \\\n    -noprompt -trustcacerts -file /etc/openldap/certs/openldap-certificate.pem\n\n# Generate a keystore.\nRUN keytool -genkey -alias coordinator -storepass testldap -keystore /etc/openldap/certs/coordinator.jks \\\n    -keypass testldap -keyalg RSA -sigalg SHA1withRSA -dname \"CN=presto-master, OU=, O=, L=, S=, C=\" -validity 100000\n\n# Generate a certificate and CSR for the keystore. CN should match the hostname of presto-coordinator\nRUN keytool -export -alias coordinator -storepass testldap -keystore /etc/openldap/certs/coordinator.jks \\\n    -file /etc/openldap/certs/coordinator.cer && \\\n    keytool -certreq -alias coordinator -storepass testldap -keystore /etc/openldap/certs/coordinator.jks \\\n    -file /etc/openldap/certs/coordinator.csr\n\n# create a test CA and generate caroot.cer( root certificate of the CA ).\nRUN openssl req -new -keyout /etc/openldap/certs/cakey.pem -out /etc/openldap/certs/careq.pem -nodes \\\n    -subj \"/C=US/ST=Massachusetts/L=Boston/O=Teradata/OU=Finance/CN=teradata\" && \\\n    openssl x509 -req -in /etc/openldap/certs/careq.pem -out /etc/openldap/certs/caroot.cer -days 100000 \\\n    -signkey /etc/openldap/certs/cakey.pem\n\n# sign the server certificate using the testCA\nRUN openssl x509 -req -in /etc/openldap/certs/coordinator.csr -out /etc/openldap/certs/TestCA.cer -days 100000 \\\n    -CA /etc/openldap/certs/caroot.cer -CAkey /etc/openldap/certs/cakey.pem -CAserial /etc/openldap/certs/serial.txt\n\n# Import the caroot.cer to the keystore and replace the previously generated self-signed cert with the new CA signed one in the keystore\n# Note: The -alias name (coordinator) should be the same as the alias used when coordinator.cer was generated\nRUN keytool -import -alias TestCA -storepass testldap -keystore /etc/openldap/certs/coordinator.jks \\\n    -noprompt -file /etc/openldap/certs/caroot.cer && \\\n    keytool -import -alias coordinator -storepass testldap -keystore /etc/openldap/certs/coordinator.jks \\\n    -file /etc/openldap/certs/TestCA.cer\n\n# Import the root certificate of the issuer of the presto-coordinator certificate.\n# This would be used by clients ( cli, jdbc ) to run tests\nRUN keytool -import -alias caroot -storepass testldap -keystore /etc/openldap/certs/cacerts.jks -noprompt \\\n    -file /etc/openldap/certs/caroot.cer\n\nCMD supervisord -c /etc/supervisord.conf\n"
}