{
  "startTime": 1674239391536,
  "endTime": 1674239392016,
  "originalSmells": [
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 23,
        "lineEnd": 23,
        "columnStart": 4,
        "columnEnd": 70
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#\n#  Author: Hari Sekhon\n#  Date: 2017-09-13 14:47:23 +0200 (Wed, 13 Sep 2017)\n#\n#  vim:ts=4:sts=4:sw=4:et\n#\n#  https://github.com/harisekhon/Dockerfiles\n#\n#  If you're using my code you're welcome to connect with me on LinkedIn and optionally send me feedback to help improve or steer this or other code I publish\n#\n#  https://www.linkedin.com/in/harisekhon\n#\n\nFROM centos:7\nMAINTAINER Hari Sekhon (https://www.linkedin.com/in/harisekhon)\n\n# cache the std packages between tagged versions for space efficiency, must have this above ARG\n\n# bash   => entrypoint.sh\n# java   => presto engine\n# python => launcher script\n# less   => presto pager\nRUN set -euxo pipefail && \\\n    yum install -y bash java-1.8.0-openjdk-headless.x86_64 python less && \\\n    yum clean all && rm -rf /var/cache/yum\n\nWORKDIR /\n\nARG PRESTO_VERSION=0.179\nARG PRESTO_PKG_RELEASE=0.1\n\nLABEL Description=\"Presto SQL\" \\\n      \"Presto SQL Version\"=\"$PRESTO_VERSION\"\n\n# for faster build testing without having to download\n#COPY $TAR /\n#COPY $CLI_TAR /\n\nRUN set -euxo pipefail && \\\n    # not doing these as ARG above as that doesn't catch imperfections in the re-use of env vars via set -u\n    TAR=\"presto_server_pkg.${PRESTO_VERSION}-t.${PRESTO_PKG_RELEASE}.tar.gz\" && \\\n    # server package contains CLI but we need CLI package for ODBC + JDBC drivers\n    CLI_TAR=\"presto_client_pkg.${PRESTO_VERSION}-t.${PRESTO_PKG_RELEASE}.tar.gz\" && \\\n    SERVER_RPM=\"presto-server-rpm-${PRESTO_VERSION}-t.${PRESTO_PKG_RELEASE}.x86_64.rpm\" && \\\n    SERVER_TAR_DIR=\"presto_server_pkg.${PRESTO_VERSION}-t.${PRESTO_PKG_RELEASE}\" && \\\n    CLI_TAR_DIR=\"presto_client_pkg.${PRESTO_VERSION}-t.${PRESTO_PKG_RELEASE}\" && \\\n    CLI_JAR=\"presto-cli-${PRESTO_VERSION}-t.${PRESTO_PKG_RELEASE}-executable.jar\" && \\\n    SERVER_URL=\"http://teradata-presto.s3.amazonaws.com/release-packages/${PRESTO_VERSION}-t.${PRESTO_PKG_RELEASE}/$TAR\" && \\\n    CLI_URL=\"http://teradata-presto.s3.amazonaws.com/release-packages/${PRESTO_VERSION}-t.${PRESTO_PKG_RELEASE}/$CLI_TAR\" && \\\n    yum install -y wget tar && \\\n    wget -c -t 10 --retry-connrefused -O \"$TAR\" \"$SERVER_URL\" && \\\n    wget -c -t 10 --retry-connrefused -O \"$CLI_TAR\" \"$CLI_URL\" && \\\n    tar zxvf \"$TAR\" && \\\n    #yum localinstall -y \"$SERVER_TAR_DIR/$SERVER_RPM\" && \\\n    # complains about java version\n    rpm -ivh --noscripts \"$SERVER_TAR_DIR/$SERVER_RPM\" && \\\n    rm -rfv  \"$TAR\" \"$SERVER_TAR_DIR\" && \\\n    tar zxvf \"$CLI_TAR\" && \\\n    mv -iv \"$CLI_TAR_DIR/$CLI_JAR\" . && \\\n    chmod +x \"$CLI_JAR\" && \\\n    ln -sv \"/$CLI_JAR\" /usr/bin/presto && \\\n    # the JDBC 4.2 driver is the one for Java 8\n    mv -iv \"$CLI_TAR_DIR\"/jdbc/presto-jdbc42-*.jar . && \\\n    yum localinstall -y \"$CLI_TAR_DIR\"/odbc/TeradatPrestoODBC-64-bit-*.rpm && \\\n    # get rid of all the other unneeded drivers to save space\n    rm -fr \"$CLI_TAR\" \"$CLI_TAR_DIR\" && \\\n    # older versions of Presto look for config in /usr/lib/presto/etc, linking for compatability across versions\n    ln -sv /etc/presto /usr/lib/presto/etc && \\\n    yum remove -y wget && \\\n    yum autoremove -y && \\\n    yum clean all && \\\n    rm -rf /var/cache/yum\n\n# Add user support not running as root\nRUN set -euxo pipefail && \\\n    mkdir -vp /var/lib/presto /var/log/presto && \\\n    useradd presto && \\\n    chown -R presto /etc/presto /usr/lib/presto /var/lib/presto /var/log/presto\n\nCOPY entrypoint.sh /\nCOPY etc /etc/presto/\n\nEXPOSE 8080\n\nCMD /entrypoint.sh\n"
}