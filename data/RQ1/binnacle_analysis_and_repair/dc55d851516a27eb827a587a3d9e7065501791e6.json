{
  "startTime": 1674241693468,
  "endTime": 1674241693701,
  "originalSmells": [
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 26,
        "lineEnd": 42,
        "columnStart": 29,
        "columnEnd": 12
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 26,
        "lineEnd": 42,
        "columnStart": 29,
        "columnEnd": 12
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# Nextcloud - passman\n#\n# @copyright Copyright (c) 2016 Marcos Zuriaga Miguel (wolfi@wolfi.es)\n# @copyright Copyright (c) 2016 Sander Brand (brantje@gmail.com)\n# @license GNU AGPL version 3 or any later version\n#\n# This program is free software: you can redistribute it and/or modify\n# it under the terms of the GNU Affero General Public License as\n# published by the Free Software Foundation, either version 3 of the\n# License, or (at your option) any later version.\n#\n# This program is distributed in the hope that it will be useful,\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n# GNU Affero General Public License for more details.\n#\n# You should have received a copy of the GNU Affero General Public License\n# along with this program.  If not, see <http://www.gnu.org/licenses/>.\n\nFROM ubuntu:18.04\nRUN /bin/bash -c \"export DEBIAN_FRONTEND=noninteractive\" && \\\n        /bin/bash -c \"debconf-set-selections <<< 'mariadb-server-10.0 mysql-server/root_password password PASS'\" && \\\n        /bin/bash -c \"debconf-set-selections <<< 'mariadb-server-10.0 mysql-server/root_password_again password PASS'\" && \\\n        /bin/bash -c \"debconf-set-selections <<< 'tzdata    tzdata/Zones/Europe select  Madrid'\" && \\\n    \t/bin/bash -c \"echo \\\"Europe/Zurich\\\" > /etc/timezone \" && \\\n    \t/bin/bash -c \"ln -fs /usr/share/zoneinfo/`cat /etc/timezone` /etc/localtime\" && \\\n        apt-get -y update && apt-get install --no-install-recommends -y \\\n        apache2 \\\n        cowsay \\\n        cowsay-off \\\n        git \\\n        curl \\\n        libapache2-mod-php7.2 \\\n        mariadb-server \\\n        php7.2 \\\n        php7.2-mysql \\\n        php7.2-curl \\\n        php-dompdf \\\n        php7.2-gd \\\n        php7.2-mbstring \\\n        php7.2-xml \\\n        php7.2-zip \\\n        wget && rm -rf /var/lib/apt/lists/*; \\\n\nRUN a2enmod ssl \\\nRUN ln -s /etc/apache2/sites-available/default-ssl.conf /etc/apache2/sites-enabled \\\nADD ./appinfo/ /var/www/passman/appinfo/ \\\nADD ./controller/ /var/www/passman/controller/ \\\nADD ./css/ /var/www/passman/css/ \\\nADD ./img/ /var/www/passman/img/ \\\nADD ./js/ /var/www/passman/js/ \\\nADD ./l10n/ /var/www/passman/l10n/ \\\nADD ./lib/ /var/www/passman/lib/ \\\nADD ./sass/ /var/www/passman/sass/ \\\nADD ./middleware /var/www/passman/middleware \\\nADD ./templates/* /var/www/passman/templates/ \\\nCOPY ./*.md /var/www/passman/ \\\nCOPY ./LICENSE /var/www/passman/ \\\nADD https://raw.githubusercontent.com/nextcloud/travis_ci/master/before_install.sh /var/www/passman \\\n\nRUN service mysql restart && \\\n    mysql -uroot -pPASS -e \"SET PASSWORD = PASSWORD('');\" && \\\n    sed  -i '0,/.*SSLCertificateChainFile.*/s/.*SSLCertificateChainFile.*/SSLCertificateChainFile \\/etc\\/ssl\\/private\\/fullchain.pem/' /etc/apache2/sites-enabled/default-ssl.conf && \\\n    sed -i '0,/.*ssl-cert-snakeoil.pem.*/s/.*ssl-cert-snakeoil.pem.*/SSLCertificateFile \\/etc\\/ssl\\/private\\/cert.pem/' /etc/apache2/sites-enabled/default-ssl.conf && \\\n    sed -i '0,/.*SSLCertificateKeyFile.*/s/.*SSLCertificateKeyFile.*/SSLCertificateKeyFile \\/etc\\/ssl\\/private\\/privkey.pem/' /etc/apache2/sites-enabled/default-ssl.conf && \\\n    echo \"echo hhvm\" > /bin/phpenv && chmod +x /bin/phpenv && \\\n    cd /var/www/passman && \\\n    chmod +x before_install.sh && \\\n    sleep 1 && \\\n    /bin/bash -c \"./before_install.sh passman master mysql; exit 0\" && \\\n    rm /var/www/server/apps/passman/before_install.sh && \\\n    mv /var/www/server/* /var/www/html/ && \\\n    cd /var/www/html/ && \\\n    chmod +x occ && \\\n    service mysql restart && \\\n    ./occ maintenance:install --database-name oc_autotest --database-user oc_autotest --admin-user admin --admin-pass admin --database mysql --database-pass 'owncloud' && \\\n    ./occ check && \\\n    ./occ status && \\\n    ./occ app:list && \\\n    ./occ app:enable passman && \\\n    ./occ upgrade && \\\n    ./occ config:system:set defaultapp --value=passman && \\\n    ./occ config:system:set appstoreenabled --value=false && \\\n    ./occ config:system:set trusted_domains 2 --value=172.17.0.2 && \\\n    ./occ config:system:set trusted_domains 3 --value=passman.cc && \\\n    ./occ config:system:set trusted_domains 4 --value=demo.passman.cc && \\\n                chown -R www-data /var/www \\\nEXPOSE 80 \\\nEXPOSE 443 \\\nENTRYPOINT              service mysql start && \\\n                        service apache2 start && \\\n                        bash -c \"trap 'echo stopping services...; service apache2 stop && service mysql stop && exit 0' SIGTERM SIGKILL; \\\n                                tail -f /var/www/html/data/nextcloud.log\""
}