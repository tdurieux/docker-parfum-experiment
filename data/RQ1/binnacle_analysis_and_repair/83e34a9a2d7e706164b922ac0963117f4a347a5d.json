{
  "startTime": 1674251128003,
  "endTime": 1674251128930,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 22,
        "lineEnd": 22,
        "columnStart": 4,
        "columnEnd": 62
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 25,
        "lineEnd": 25,
        "columnStart": 4,
        "columnEnd": 66
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 4,
        "columnEnd": 33
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 49,
        "lineEnd": 49,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 58,
        "lineEnd": 58,
        "columnStart": 62,
        "columnEnd": 87
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 62,
        "columnEnd": 115
      }
    },
    {
      "rule": "gemUpdateSystemRmRootGem",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 58,
        "lineEnd": 58,
        "columnStart": 6,
        "columnEnd": 37
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 6,
        "columnEnd": 37
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 22,
        "columnEnd": 62
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 22,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 27,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 43
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 42,
        "lineEnd": 42,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 78
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 27,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 43
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 42,
        "lineEnd": 42,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 78
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 22,
        "columnEnd": 62
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 17,
        "lineEnd": 17,
        "columnStart": 22,
        "columnEnd": 46
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 27,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 43
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 42,
        "lineEnd": 42,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 78
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 19,
        "lineEnd": 19,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 27,
        "lineEnd": 35,
        "columnStart": 4,
        "columnEnd": 43
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 54,
        "lineEnd": 54,
        "columnStart": 4,
        "columnEnd": 102
      }
    }
  ],
  "repairedDockerfile": "# NAME:     discourse/base\n# VERSION:  release\nFROM ubuntu:16.04\n\nENV PG_MAJOR 10\nENV RUBY_ALLOCATOR /usr/lib/libjemalloc.so.1\nENV RAILS_ENV production\n\n#LABEL maintainer=\"Sam Saffron \\\"https://twitter.com/samsaffron\\\"\"\n\nRUN echo 2.0.`date +%Y%m%d` > /VERSION\n\nRUN apt-get update && apt-get install --no-install-recommends -y lsb-release sudo curl && rm -rf /var/lib/apt/lists/*;\nRUN echo \"debconf debconf/frontend select Teletype\" | debconf-set-selections\nRUN echo \"deb http://archive.ubuntu.com/ubuntu $(lsb_release -sc) main restricted universe\" > /etc/apt/sources.list\nRUN echo \"deb http://archive.ubuntu.com/ubuntu $(lsb_release -sc)-updates main restricted universe\" >> /etc/apt/sources.list\nRUN echo \"deb http://archive.ubuntu.com/ubuntu $(lsb_release -sc)-security main restricted universe\" >> /etc/apt/sources.list\nRUN apt-get update && apt-get -y --no-install-recommends install fping && rm -rf /var/lib/apt/lists/*;\nRUN sh -c \"fping proxy && echo 'Acquire { Retries \\\"0\\\"; HTTP { Proxy \\\"http://proxy:3128\\\";}; };' > /etc/apt/apt.conf.d/40proxy && apt-get update || true\"\nRUN apt-get -y --no-install-recommends install software-properties-common && rm -rf /var/lib/apt/lists/*;\nRUN apt-mark hold initscripts\nRUN apt-get -y upgrade\nRUN curl -f https://apt.postgresql.org/pub/repos/apt/ACCC4CF8.asc | apt-key add -\nRUN echo \"deb http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -sc)-pgdg main\" | \\\n        tee /etc/apt/sources.list.d/postgres.list\nRUN curl -f --silent --location https://deb.nodesource.com/setup_10.x | sudo bash -\nRUN apt-get -y update\nRUN apt-get -y --no-install-recommends install build-essential git wget \\\n                       libxslt-dev libcurl4-openssl-dev \\\n                       libssl-dev libyaml-dev libtool \\\n                       libxml2-dev gawk parallel \\\n                       postgresql-${PG_MAJOR} postgresql-client-${PG_MAJOR} \\\n                       postgresql-contrib-${PG_MAJOR} libpq-dev libreadline-dev \\\n                       language-pack-en cron anacron \\\n                       psmisc rsyslog vim whois brotli libunwind-dev \\\n                       libtcmalloc-minimal4 && rm -rf /var/lib/apt/lists/*;\nRUN sed -i -e 's/start -q anacron/anacron -s/' /etc/cron.d/anacron\nRUN sed -i.bak 's/$ModLoad imklog/#$ModLoad imklog/' /etc/rsyslog.conf\nRUN dpkg-divert --local --rename --add /sbin/initctl\nRUN sh -c \"test -f /sbin/initctl || ln -s /bin/true /sbin/initctl\"\nRUN apt-get -y --no-install-recommends install haproxy openssh-server && rm -rf /var/lib/apt/lists/*;\nRUN cd / && \\\n    apt-get -y --no-install-recommends install runit monit socat && \\\n    mkdir -p /etc/runit/1.d && \\\n    apt-get clean && \\\n    rm -f /etc/apt/apt.conf.d/40proxy && \\\n    locale-gen en_US && \\\n    apt-get install --no-install-recommends -y nodejs && \\\n    npm install -g uglify-js@\"<3\" && \\\n    npm install -g svgo && npm cache clean --force; && rm -rf /var/lib/apt/lists/*;\n\nADD install-nginx /tmp/install-nginx\nRUN /tmp/install-nginx\n\nRUN apt-get -y --no-install-recommends install advancecomp jhead jpegoptim libjpeg-turbo-progs optipng && rm -rf /var/lib/apt/lists/*;\n\nRUN mkdir /jemalloc-stable && cd /jemalloc-stable &&\\\n      wget https://github.com/jemalloc/jemalloc/releases/download/3.6.0/jemalloc-3.6.0.tar.bz2 &&\\\n      tar -xjf jemalloc-3.6.0.tar.bz2 && cd jemalloc-3.6.0 && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=/usr && make && make install && \\\n      cd / && rm -rf /jemalloc-stable && rm jemalloc-3.6.0.tar.bz2\n\nRUN mkdir /jemalloc-new && cd /jemalloc-new &&\\\n      wget https://github.com/jemalloc/jemalloc/releases/download/5.2.0/jemalloc-5.2.0.tar.bz2 &&\\\n      tar -xjf jemalloc-5.2.0.tar.bz2 && cd jemalloc-5.2.0 && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=/usr --with-install-suffix=5.1.0 && make build_lib && make install_lib && \\\n      cd / && rm -rf /jemalloc-new && rm jemalloc-5.2.0.tar.bz2\n\nRUN echo 'gem: --no-document' >> /usr/local/etc/gemrc &&\\\n    mkdir /src && cd /src && git clone https://github.com/sstephenson/ruby-build.git &&\\\n    cd /src/ruby-build && ./install.sh &&\\\n    cd / && rm -rf /src/ruby-build && (ruby-build 2.6.3 /usr/local)\n\nRUN gem update --system && rm -rf /root/.gem;\n\nRUN gem install bundler --force &&\\\n    rm -rf /usr/local/share/ri/2.6.3/system &&\\\n    cd / && git clone https://github.com/discourse/pups.git\n\nADD install-redis /tmp/install-redis\nRUN /tmp/install-redis\n\nADD install-imagemagick /tmp/install-imagemagick\nRUN /tmp/install-imagemagick\n\n# Validate install\nRUN ruby -Eutf-8 -e \"v = \\`convert -version\\`; %w{png tiff jpeg freetype}.each { |f| unless v.include?(f); STDERR.puts('no ' + f +  ' support in imagemagick'); exit(-1); end }\"\n\nADD install-pngcrush /tmp/install-pngcrush\nRUN /tmp/install-pngcrush\n\nADD install-gifsicle /tmp/install-gifsicle\nRUN /tmp/install-gifsicle\n\nADD install-pngquant /tmp/install-pngquant\nRUN /tmp/install-pngquant\n\n# This tool allows us to disable huge page support for our current process\n# since the flag is preserved through forks and execs it can be used on any\n# process\nADD thpoff.c /src/thpoff.c\nRUN gcc -o /usr/local/sbin/thpoff /src/thpoff.c && rm /src/thpoff.c\n\n# clean up for docker squash\nRUN   rm -fr /usr/share/man &&\\\n      rm -fr /usr/share/doc &&\\\n      rm -fr /usr/share/vim/vim74/tutor &&\\\n      rm -fr /usr/share/vim/vim74/doc &&\\\n      rm -fr /usr/share/vim/vim74/lang &&\\\n      rm -fr /usr/local/share/doc &&\\\n      rm -fr /usr/local/share/ruby-build &&\\\n      rm -fr /root/.gem &&\\\n      rm -fr /root/.npm &&\\\n      rm -fr /tmp/* &&\\\n      rm -fr /usr/share/vim/vim74/spell/en*\n\n\n# this can probably be done, but I worry that people changing PG locales will have issues\n# cd /usr/share/locale && rm -fr `ls -d */ | grep -v en`\n\nRUN mkdir -p /etc/runit/3.d\n\nADD runit-1 /etc/runit/1\nADD runit-1.d-cleanup-pids /etc/runit/1.d/cleanup-pids\nADD runit-1.d-anacron /etc/runit/1.d/anacron\nADD runit-1.d-00-fix-var-logs /etc/runit/1.d/00-fix-var-logs\nADD runit-2 /etc/runit/2\nADD runit-3 /etc/runit/3\nADD boot /sbin/boot\n\nADD cron /etc/service/cron/run\nADD rsyslog /etc/service/rsyslog/run\nADD cron.d_anacron /etc/cron.d/anacron\n\n# Discourse specific bits\nRUN useradd discourse -s /bin/bash -m -U &&\\\n    mkdir -p /var/www &&\\\n    cd /var/www &&\\\n    git clone https://github.com/discourse/discourse.git &&\\\n    cd discourse &&\\\n    git remote set-branches --add origin tests-passed &&\\\n    chown -R discourse:discourse /var/www/discourse &&\\\n    cd /var/www/discourse &&\\\n    sudo -u discourse bundle install --deployment --jobs 4 --without test development &&\\\n    bundle exec rake maxminddb:get &&\\\n    find /var/www/discourse/vendor/bundle -name tmp -type d -exec rm -rf {} +\n"
}