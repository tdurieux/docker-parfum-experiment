{
  "startTime": 1674243628281,
  "endTime": 1674243628484,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 60,
        "lineEnd": 60,
        "columnStart": 4,
        "columnEnd": 40
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 51
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM quay.io/azavea/postgis:2.3-postgres9.6-slim\nMAINTAINER Azavea\nLABEL type=pfb-analysis\n\nENV GIT_BRANCH_OSM2PGROUTING osm2pgrouting-2.1.0\nENV GIT_BRANCH_OSM2PGSQL 0.90.1\nENV GIT_BRANCH_QUANTILE master\n\n# Copy django requirements (will copy the rest later, so that any change to\n# the code doesn't trigger re-running the whole provisioning step)\nCOPY ./django/requirements.txt /opt/pfb/django/requirements.txt\n\n# Install apt and pip packages\n# Installs everything then removes the build dependencies all in one gigantic command to\n# avoid making a build layer that includes the dependencies that we don't need to keep permanently.\n# The 'hash -r' after upgrading pip is because otherwise the subsequent 'pip install' command will\n# still use the old version.\nRUN set -xe && \\\n    BUILD_DEPS=\" \\\n        postgresql-server-dev-$PG_MAJOR \\\n        libexpat1-dev \\\n        cmake \\\n        libboost-all-dev make \\\n        g++ \\\n        zlib1g-dev \\\n        libbz2-dev \\\n        libpq-dev \\\n        libgeos-dev \\\n        libgeos++-dev \\\n        libproj-dev \\\n        libgdal-dev \\\n        git\" \\\n    DEPS=\" \\\n        ca-certificates \\\n        liblua5.2-dev \\\n        lua5.2 \\\n        expat \\\n        wget \\\n        bc \\\n        time \\\n        parallel \\\n        postgresql-plpython-$PG_MAJOR \\\n        postgresql-$PG_MAJOR-pgrouting \\\n        python-gdal \\\n        gdal-bin \\\n        unzip \\\n        zip \\\n        postgis \\\n        python-dev \\\n        python-pip\" && \\\n    apt-get update && apt-get install -y ${BUILD_DEPS} ${DEPS} --no-install-recommends && \\\n    \\\n    mkdir /tmp/build/ && cd /tmp/build && \\\n      git clone --branch $GIT_BRANCH_OSM2PGROUTING https://github.com/pgRouting/osm2pgrouting.git && \\\n        (cd osm2pgrouting && mkdir build && cmake -H. -Bbuild && cd build && make install) && \\\n      git clone --branch $GIT_BRANCH_OSM2PGSQL https://github.com/openstreetmap/osm2pgsql.git && \\\n        (cd osm2pgsql && mkdir build && cd build && cmake ../ && make install) && \\\n      git clone --branch $GIT_BRANCH_QUANTILE https://github.com/tvondra/quantile.git && \\\n        (cd quantile && make install) && \\\n\n    pip install --no-cache-dir --upgrade pip setuptools && \\\n    hash -r && \\\n    pip install --no-cache-dir -r /opt/pfb/django/requirements.txt && \\\n\n    cd /tmp/ && rm -rf /tmp/build/ /var/lib/apt/lists/* && \\\n    apt-get purge -y --auto-remove ${BUILD_DEPS}\n\nRUN set -xe && \\\n    wget -q \"https://s3.amazonaws.com/aws-cli/awscli-bundle.zip\" && \\\n    unzip awscli-bundle.zip && \\\n    ./awscli-bundle/install -i /usr/local/aws -b /usr/local/bin/aws && \\\n    rm -r ./awscli-bundle*\n\nRUN set -xe && \\\n    wget -q -O /usr/local/bin/osmconvert \"https://s3.amazonaws.com/pfb-binaries-us-east-1/osmconvert64\" && \\\n    chmod +x /usr/local/bin/osmconvert\n\nCOPY ./django /opt/pfb/django\n\nCOPY ./analysis/scripts/setup_database.sh /docker-entrypoint-initdb.d/setup_database.sh\nCOPY ./analysis/ /opt/pfb/analysis/\n\nENTRYPOINT /opt/pfb/analysis/scripts/entrypoint.sh\n"
}