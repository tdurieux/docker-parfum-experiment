{
  "startTime": 1674240290144,
  "endTime": 1674240290414,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 45,
        "lineEnd": 45,
        "columnStart": 8,
        "columnEnd": 36
      }
    },
    {
      "rule": "apkAddUseNoCache",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 27
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# SPDX-License-Identifier: GPL-3.0-or-later\n# author  : paulfantom\n\n# Cross-arch building is achieved by specifying ARCH as a build parameter with `--build-arg` option.\n# It is automated in `build.sh` script\nARG ARCH=amd64\n# This image contains preinstalled dependecies\nFROM netdata/builder:${ARCH} as builder\n\nENV JUDY_VER 1.0.5\n\n# Copy source\nCOPY . /opt/netdata.git\nWORKDIR /opt/netdata.git\n\n# Install from source\nRUN chmod +x netdata-installer.sh && ./netdata-installer.sh --dont-wait --dont-start-it\n\n# files to one directory\nRUN mkdir -p /app/usr/sbin/ \\\n             /app/usr/share \\\n             /app/usr/libexec \\\n             /app/usr/lib \\\n             /app/var/cache \\\n             /app/var/lib \\\n             /app/etc && \\\n    mv /usr/share/netdata   /app/usr/share/ && \\\n    mv /usr/libexec/netdata /app/usr/libexec/ && \\\n    mv /usr/lib/netdata     /app/usr/lib/ && \\\n    mv /var/cache/netdata   /app/var/cache/ && \\\n    mv /var/lib/netdata     /app/var/lib/ && \\\n    mv /etc/netdata         /app/etc/ && \\\n    mv /usr/sbin/netdata    /app/usr/sbin/ && \\\n    mv /judy-${JUDY_VER}    /app/judy-${JUDY_VER} && \\\n    mv packaging/docker/run.sh        /app/usr/sbin/ && \\\n    chmod +x /app/usr/sbin/run.sh\n\n#####################################################################\nARG ARCH\n# This image contains preinstalled dependecies\nFROM netdata/base:${ARCH}\n\n# Conditional subscribiton to Polyverse's Polymorphic Linux repositories\nRUN if [ \"$(uname -m)\" == \"x86_64\" ]; then \\\n        apk update && apk upgrade; \\\n        curl -f https://sh.polyverse.io | sh -s install gcxce5byVQbtRz0iwfGkozZwy support+netdata@polyverse.io; \\\n        if [ $? -eq 0 ]; then \\\n                apk update && \\\n                apk upgrade --available --no-cache && \\\n                sed -in 's/^#//g' /etc/apk/repositories; \\\n        fi \\\n    fi\n\n# Copy files over\nRUN mkdir -p /opt/src\nCOPY --from=builder /app /\n\n# Configure system\nARG NETDATA_UID=201\nARG NETDATA_GID=201\nRUN \\\n\n    apk add --no-cache make alpine-sdk && \\\n    cd /judy-${JUDY_VER} && make install && cd / && \\\n    # Clean the source stuff once judy is installed\n    rm -rf /judy-${JUDY_VER} && apk del make alpine-sdk && \\\n    # fping from alpine apk is on a different location. Moving it.\n    mv /usr/sbin/fping /usr/local/bin/fping && \\\n    chmod 4755 /usr/local/bin/fping && \\\n    mkdir -p /var/log/netdata && \\\n    # Add netdata user\n    addgroup -g ${NETDATA_GID} -S netdata && \\\n    adduser -S -H -s /usr/sbin/nologin -u ${NETDATA_GID} -h /etc/netdata -G netdata netdata && \\\n    # Apply the permissions as described in\n    # https://github.com/netdata/netdata/wiki/netdata-security#netdata-directories\n    chown -R root:netdata /etc/netdata && \\\n    chown -R netdata:netdata /var/cache/netdata /var/lib/netdata /usr/share/netdata && \\\n    chown -R root:netdata /usr/lib/netdata && \\\n    chown -R root:netdata /usr/libexec/netdata/ && \\\n    chmod 4750 /usr/libexec/netdata/plugins.d/cgroup-network /usr/libexec/netdata/plugins.d/apps.plugin && \\\n    chmod 0750 /var/lib/netdata /var/cache/netdata && \\\n    # Link log files to stdout\n    ln -sf /dev/stdout /var/log/netdata/access.log && \\\n    ln -sf /dev/stdout /var/log/netdata/debug.log && \\\n    ln -sf /dev/stderr /var/log/netdata/error.log\n\nENV NETDATA_PORT 19999\nEXPOSE $NETDATA_PORT\n\nENTRYPOINT [\"/usr/sbin/run.sh\"]\n"
}