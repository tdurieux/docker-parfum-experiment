{
  "startTime": 1674235772380,
  "endTime": 1674235773381,
  "originalSmells": [
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 141,
        "lineEnd": 141,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 143,
        "lineEnd": 143,
        "columnStart": 4,
        "columnEnd": 53
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 144,
        "lineEnd": 144,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 151,
        "lineEnd": 151,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 152,
        "lineEnd": 152,
        "columnStart": 4,
        "columnEnd": 21
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 153,
        "lineEnd": 153,
        "columnStart": 4,
        "columnEnd": 25
      }
    },
    {
      "rule": "pipUseNoCacheDir",
      "position": {
        "lineStart": 154,
        "lineEnd": 154,
        "columnStart": 4,
        "columnEnd": 26
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 110
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 168
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 61,
        "lineEnd": 61,
        "columnStart": 4,
        "columnEnd": 98
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 137,
        "lineEnd": 137,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 110
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 168
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 61,
        "lineEnd": 61,
        "columnStart": 4,
        "columnEnd": 98
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 137,
        "lineEnd": 137,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 110
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 168
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 61,
        "lineEnd": 61,
        "columnStart": 4,
        "columnEnd": 98
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 63
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 137,
        "lineEnd": 137,
        "columnStart": 4,
        "columnEnd": 54
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 39,
        "lineEnd": 39,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 134
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 48,
        "lineEnd": 48,
        "columnStart": 4,
        "columnEnd": 80
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 192
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 61,
        "lineEnd": 61,
        "columnStart": 4,
        "columnEnd": 122
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 137,
        "lineEnd": 137,
        "columnStart": 4,
        "columnEnd": 78
      }
    }
  ],
  "repairedDockerfile": "FROM csp-alpine35glibc:1.0 as builder_2.4.107\n\nRUN apk add --no-cache git\nWORKDIR /var/www\n#RUN chown www-data:www-data /var/www\n#USER www-data\nRUN git clone https://github.com/MISP/MISP.git\nWORKDIR /var/www/MISP\n#RUN git checkout tags/$(git describe --tags `git rev-list --tags --max-count=1000`)\nRUN git checkout tags/$(git describe --tags v2.4.107)\nRUN git config core.filemode false\n\nWORKDIR /var/www/MISP/app/files/scripts\nRUN git clone https://github.com/CybOXProject/python-cybox.git\nRUN git clone https://github.com/STIXProject/python-stix.git\n\nWORKDIR /var/www/MISP/app/files/scripts/python-cybox\nRUN git checkout v2.1.0.12\n\n#USER www-data\nWORKDIR /var/www/MISP/app/files/scripts/python-stix\nRUN git checkout v1.1.1.4\n\n#USER www-data\nWORKDIR /var/www/MISP\nRUN git submodule init\nRUN git submodule update\n\n# Install MISP Modules\nWORKDIR /opt\nRUN git clone https://github.com/MISP/misp-modules.git\n\n\nFROM ubuntu:16.04\nMAINTAINER Christos Panagiotou\n\n# Install core components\nENV DEBIAN_FRONTEND noninteractive\nRUN apt-get update && apt-get dist-upgrade -y && apt-get autoremove -y && apt-get clean\nRUN apt-get install --no-install-recommends -y software-properties-common && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends -y postfix && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends -y mysql-client curl gcc gnupg-agent make python openssl redis-server sudo vim zip locales && rm -rf /var/lib/apt/lists/*;\n\nRUN locale-gen en_US.UTF-8\nENV LANG en_US.UTF-8\nRUN add-apt-repository -y ppa:ondrej/php && apt-get update\n\n# Apache\nRUN apt-get install --no-install-recommends -y apache2 apache2-doc apache2-utils && rm -rf /var/lib/apt/lists/*;\nRUN a2dismod status\nRUN a2dissite 000-default\n\n# PHP 7.2\nRUN apt-get install --no-install-recommends -y libapache2-mod-php php7.2 php7.2-cli php-crypt-gpg php7.2-dev php7.2-json php7.2-mysql php7.2-opcache php7.2-readline php7.2-redis php7.2-xml git && rm -rf /var/lib/apt/lists/*;\n\n# Fix php.ini with recommended settings\nRUN sed -i \"s/max_execution_time = 30/max_execution_time = 300/\" /etc/php/7.2/apache2/php.ini\nRUN sed -i \"s/memory_limit = 128M/memory_limit = 512M/\" /etc/php/7.2/apache2/php.ini\nRUN sed -i \"s/upload_max_filesize = 2M/upload_max_filesize = 50M/\" /etc/php/7.2/apache2/php.ini\nRUN sed -i \"s/post_max_size = 8M/post_max_size = 50M/\" /etc/php/7.2/apache2/php.ini\n\nRUN apt-get install --no-install-recommends -y python-dev python-pip libxml2-dev libxslt1-dev zlib1g-dev python-setuptools && rm -rf /var/lib/apt/lists/*;\nRUN apt-get install --no-install-recommends -y cron logrotate supervisor syslog-ng-core && rm -rf /var/lib/apt/lists/*;\nRUN apt-get clean\n\nWORKDIR /var/www\n\nUSER www-data\nCOPY --from=builder_2.4.107 /var/www/ .\n\nWORKDIR /var/www/MISP/app/files/scripts/python-cybox\nUSER root\nRUN python setup.py install\n\nUSER www-data\nWORKDIR /var/www/MISP/app/files/scripts/python-stix\nUSER root\nRUN python setup.py install\nRUN chown -R www-data:www-data /var/www\n\nUSER www-data\nWORKDIR /var/www/MISP/app\nRUN php composer.phar config vendor-dir Vendor\nRUN php composer.phar install\nUSER root\nRUN phpenmod redis\nUSER www-data\nRUN cp -fa /var/www/MISP/INSTALL/setup/config.php /var/www/MISP/app/Plugin/CakeResque/Config/config.php\n\n# Fix permissions\nUSER root\nRUN chown -R www-data:www-data /var/www/MISP\nRUN chmod -R 750 /var/www/MISP\nRUN chmod -R g+ws /var/www/MISP/app/tmp\nRUN chmod -R g+ws /var/www/MISP/app/files\nRUN chmod -R g+ws /var/www/MISP/app/files/scripts/tmp\n\nRUN cp /var/www/MISP/INSTALL/misp.logrotate /etc/logrotate.d/misp\n\n# Preconfigure setting for packages\nRUN echo \"postfix postfix/main_mailer_type string Local only\" | debconf-set-selections\nRUN echo \"postfix postfix/mailname string localhost.localdomain\" | debconf-set-selections\n\n# Redis Setup\nRUN sed -i 's/^\\(daemonize\\s*\\)yes\\s*$/\\1no/g' /etc/redis/redis.conf\n\n# Install PEAR packages\nRUN pear install Crypt_GPG >>/tmp/install.log\nRUN pear install Net_GeoIP\n\n# Apache Setup\nRUN cp /var/www/MISP/INSTALL/apache.misp.ubuntu /etc/apache2/sites-available/misp.conf\nRUN sed -i -E 's/80/800/' /etc/apache2/sites-available/misp.conf\nRUN sed -i -E 's/80/800/' /etc/apache2/ports.conf\nRUN a2dissite 000-default\nRUN a2ensite misp\nRUN a2enmod rewrite\nRUN a2enmod headers\n\n# MISP base configuration\nRUN sudo -u www-data cp -a /var/www/MISP/app/Config/bootstrap.default.php /var/www/MISP/app/Config/bootstrap.php\nRUN sudo -u www-data cp -a /var/www/MISP/app/Config/database.default.php /var/www/MISP/app/Config/database.php\nRUN sudo -u www-data cp -a /var/www/MISP/app/Config/core.default.php /var/www/MISP/app/Config/core.php\nRUN sudo -u www-data cp -a /var/www/MISP/app/Config/config.default.php /var/www/MISP/app/Config/config.php\nRUN chown -R www-data:www-data /var/www/MISP/app/Config\nRUN chmod -R 750 /var/www/MISP/app/Config\n\n# Replace the default salt\nRUN sed -i -E \"s/'salt'\\s=>\\s'(\\S+)'/'salt' => '`openssl rand -base64 32|tr \"/\" \"-\"`'/\" /var/www/MISP/app/Config/config.php\n\n# Enable workers at boot time\nRUN chmod a+x /var/www/MISP/app/Console/worker/start.sh\nRUN echo \"sudo -u www-data bash /var/www/MISP/app/Console/worker/start.sh\" >>/etc/rc.local\n\n# Install MISP Modules\nWORKDIR /opt\nRUN apt-get update\nRUN apt-get install --no-install-recommends -y python3 python3-pip libjpeg-dev && rm -rf /var/lib/apt/lists/*;\nCOPY --from=builder_2.4.107 /opt/ .\nADD misp-modules /opt/misp-modules\nWORKDIR /opt/misp-modules\nRUN pip3 install --no-cache-dir --upgrade pip\nRUN cat REQUIREMENTS | sed 's/aiohttp==3.4.4/aiohttp/g' > REQUIREMENTS\nRUN pip3 install --no-cache-dir --upgrade --ignore-installed urllib3\nRUN pip3 install --no-cache-dir --upgrade --ignore-installed requests\nRUN sed -i 's/aiohttp.*/aiohttp/g' REQUIREMENTS\nRUN sed -i 's/functools.*//g' REQUIREMENTS\nRUN sed -i 's/async-timeout.*/async-timeout/g' REQUIREMENTS\nRUN sed -i 's/url-normalize.*/url-normalize/g' REQUIREMENTS\nRUN sed -i 's/^\\(yarl\\)\\=.*/\\1/g' REQUIREMENTS\nRUN sed -i 's/^\\(sigmatools\\)\\=.*/\\1/' REQUIREMENTS\nRUN pip3 install --no-cache-dir -I -r REQUIREMENTS\nRUN pip3 install --no-cache-dir -I .\nRUN pip install --no-cache-dir zmq redis\nRUN pip3 install --no-cache-dir zmq redis\nRUN echo \"sudo -u www-data misp-modules -s &\" >>/etc/rc.local\n\n# Supervisord Setup\nRUN echo '[supervisord]' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'nodaemon = true' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo '' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo '[program:postfix]' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'process_name = master' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'directory = /etc/postfix' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'command = /usr/sbin/postfix -c /etc/postfix start' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'startsecs = 0' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'autorestart = false' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo '' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo '[program:redis-server]' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'command=redis-server /etc/redis/redis.conf' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo '' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo '[program:apache2]' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'command=/bin/bash -c \"source /etc/apache2/envvars && exec /usr/sbin/apache2 -D FOREGROUND\"' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo '' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo '[program:resque]' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'command=/bin/bash /var/www/MISP/app/Console/worker/start.sh' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'user = www-data' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'startsecs = 0' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'autorestart = false' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo '' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo '[program:misp-modules]' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'command=/bin/bash -c \"cd /opt/misp-modules/bin && /usr/bin/python3 misp-modules.py\"' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'user = root' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'startsecs = 0' >> /etc/supervisor/conf.d/supervisord.conf\nRUN echo 'autorestart = false' >> /etc/supervisor/conf.d/supervisord.conf\n\n# Modify syslog configuration\nRUN sed -i -E 's/^(\\s*)system\\(\\);/\\1unix-stream(\"\\/dev\\/log\");/' /etc/syslog-ng/syslog-ng.conf\n\n# Add run script\nADD run.sh /run.sh\nADD csp_configuration /csp_configuration\nRUN chmod 0755 /run.sh\n\n# Trigger to perform first boot operations\nRUN touch /.firstboot.tmp\n\nRUN touch /var/www/MISP/app/tmp/logs/error.log\nRUN touch /var/www/MISP/app/tmp/logs/debug.log\nRUN chmod -R 777 /var/www/MISP/app/tmp/logs/\nRUN chown -R www-data:www-data /var/www/MISP/app/tmp/logs/\nVOLUME [\"/var/www/MISP/app/tmp/logs\"]\n\n# Make a backup of /var/www/MISP to restore it to the local moint point at first boot\nWORKDIR /var/www/MISP\n\n# Add misp-objects for CSP support\nCOPY csp-misp-objects/ app/files/misp-objects/objects/\nRUN chown -R www-data:www-data /var/www/MISP/app/files/\n\n# Final archive\nRUN tar czpf /root/MISP.tgz .\n\n#COPY AppController.php /var/www/MISP/app/Controller/AppController.php\n#VOLUME /var/www/MISP\nEXPOSE 80\nENTRYPOINT [\"/run.sh\"]\n"
}