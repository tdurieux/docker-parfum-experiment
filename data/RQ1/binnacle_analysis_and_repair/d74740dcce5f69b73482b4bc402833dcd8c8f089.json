{
  "startTime": 1674244608105,
  "endTime": 1674244608889,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 241,
        "lineEnd": 242,
        "columnStart": 4,
        "columnEnd": 86
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM jdeathe/centos-ssh:2.5.1\n\n# Use the form ([{fqdn}-]{package-name}|[{fqdn}-]{provider-name})\nARG PACKAGE_NAME=\"app\"\nARG PACKAGE_PATH=\"/opt/${PACKAGE_NAME}\"\nARG PACKAGE_RELEASE_VERSION=\"0.11.0\"\nARG RELEASE_VERSION=\"3.2.0\"\n\n# ------------------------------------------------------------------------------\n# - Base install of required packages\n# ------------------------------------------------------------------------------\nRUN rpm --rebuilddb \\\n\t&& yum -y install \\\n\t\t--setopt=tsflags=nodocs \\\n\t\t--disableplugin=fastestmirror \\\n\t\telinks-0.12-0.37.pre6.el7.0.1 \\\n\t\thttpd24u-2.4.39-1.ius.centos7 \\\n\t\thttpd24u-tools-2.4.39-1.ius.centos7 \\\n\t\thttpd24u-mod_ssl-2.4.39-1.ius.centos7 \\\n\t\tphp72u-cli-7.2.16-1.ius.centos7 \\\n\t\tphp72u-common-7.2.16-1.ius.centos7 \\\n\t\tphp72u-fpm-7.2.16-1.ius.centos7 \\\n\t\tphp72u-fpm-httpd-7.2.16-1.ius.centos7 \\\n\t\tphp72u-opcache-7.2.16-1.ius.centos7 \\\n\t\tphp72u-pecl-memcached-3.0.4-2.ius.centos7 \\\n\t\tphp72u-pecl-redis-3.1.6-2.ius.centos7 \\\n\t&& yum versionlock add \\\n\t\telinks \\\n\t\thttpd24u* \\\n\t\tphp72u* \\\n\t&& rm -rf /var/cache/yum/* \\\n\t&& yum clean all \\\n\t&& /bin/find /usr/share \\\n\t\t-type f \\\n\t\t-regextype posix-extended \\\n\t\t-regex '.*\\.(jpg|png)$' \\\n\t\t-delete\n\n# ------------------------------------------------------------------------------\n# Copy files into place\n# ------------------------------------------------------------------------------\nADD src /\n\n# ------------------------------------------------------------------------------\n# Provisioning\n# - Add default system users\n# - Limit threads for the application user\n# - Disable Apache directory indexes and welcome page\n# - Disable Apache language based content negotiation\n# - Custom Apache configuration\n# - Disable all Apache modules and enable the minimum\n# - Disable SSL\n# - Disable the default SSL Virtual Host\n# - Global PHP configuration changes\n# - Replace placeholders with values in systemd service unit template\n# - Set permissions\n# ------------------------------------------------------------------------------\nRUN useradd -r -M -d /var/www/app -s /sbin/nologin app \\\n\t&& useradd -r -M -d /var/www/app -s /sbin/nologin -G apache,app app-www \\\n\t&& usermod -a -G app-www app \\\n\t&& usermod -a -G app-www,app apache \\\n\t&& usermod -L app \\\n\t&& usermod -L app-www \\\n\t&& { printf -- \\\n\t\t'\\n@apache\\tsoft\\tnproc\\t%s\\n@apache\\thard\\tnproc\\t%s\\n' \\\n\t\t'85' \\\n\t\t'170'; \\\n\t} >> /etc/security/limits.conf \\\n\t&& cp -pf \\\n\t\t/etc/httpd/conf/httpd.conf \\\n\t\t/etc/httpd/conf/httpd.conf.default \\\n\t&& sed -i \\\n\t\t-e '/^KeepAlive .*$/d' \\\n\t\t-e '/^MaxKeepAliveRequests .*$/d' \\\n\t\t-e '/^KeepAliveTimeout .*$/d' \\\n\t\t-e '/^ServerSignature On$/d' \\\n\t\t-e '/^ServerTokens OS$/d' \\\n\t\t-e 's~^NameVirtualHost \\(.*\\)$~#NameVirtualHost \\1~g' \\\n\t\t-e 's~^User .*$~User ${APACHE_RUN_USER}~g' \\\n\t\t-e 's~^Group .*$~Group ${APACHE_RUN_GROUP}~g' \\\n\t\t-e 's~^DocumentRoot \\(.*\\)$~#DocumentRoot \\1~g' \\\n\t\t-e 's~^IndexOptions \\(.*\\)$~#IndexOptions \\1~g' \\\n\t\t-e 's~^IndexIgnore \\(.*\\)$~#IndexIgnore \\1~g' \\\n\t\t-e 's~^AddIconByEncoding \\(.*\\)$~#AddIconByEncoding \\1~g' \\\n\t\t-e 's~^AddIconByType \\(.*\\)$~#AddIconByType \\1~g' \\\n\t\t-e 's~^AddIcon \\(.*\\)$~#AddIcon \\1~g' \\\n\t\t-e 's~^DefaultIcon \\(.*\\)$~#DefaultIcon \\1~g' \\\n\t\t-e 's~^ReadmeName \\(.*\\)$~#ReadmeName \\1~g' \\\n\t\t-e 's~^HeaderName \\(.*\\)$~#HeaderName \\1~g' \\\n\t\t-e 's~^\\(Alias /icons/ \".*\"\\)$~#\\1~' \\\n\t\t-e '/<Directory \"\\/var\\/www\\/icons\">/,/#<\\/Directory>/ s~^~#~' \\\n\t\t-e 's~^LanguagePriority \\(.*\\)$~#LanguagePriority \\1~g' \\\n\t\t-e 's~^ForceLanguagePriority \\(.*\\)$~#ForceLanguagePriority \\1~g' \\\n\t\t-e 's~^AddLanguage \\(.*\\)$~#AddLanguage \\1~g' \\\n\t\t/etc/httpd/conf/httpd.conf \\\n\t&& truncate -s 0 \\\n\t\t/etc/httpd/conf.d/autoindex.conf \\\n\t&& chmod 444 \\\n\t\t/etc/httpd/conf.d/autoindex.conf \\\n\t&& truncate -s 0 \\\n\t\t/etc/httpd/conf.d/welcome.conf \\\n\t&& chmod 444 \\\n\t\t/etc/httpd/conf.d/welcome.conf \\\n\t&& { printf -- \\\n\t\t'\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\\\\\n%s%s\\\\\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n%s\\n' \\\n\t\t'#' \\\n\t\t'# Custom configuration' \\\n\t\t'#' \\\n\t\t'KeepAlive On' \\\n\t\t'MaxKeepAliveRequests 200' \\\n\t\t'KeepAliveTimeout 2' \\\n\t\t'LogFormat ' \\\n\t\t'  \"%{X-Forwarded-For}i %l %u %t \\\"%r\\\" %>s %b' \\\n\t\t' \\\"%{Referer}i\\\" \\\"%{User-Agent}i\\\"\" ' \\\n\t\t'  forwarded_for_combined' \\\n\t\t'ExtendedStatus Off' \\\n\t\t'Listen 8443' \\\n\t\t'Options -Indexes' \\\n\t\t'ServerSignature Off' \\\n\t\t'ServerTokens Prod' \\\n\t\t'TraceEnable Off' \\\n\t\t'UseCanonicalName On' \\\n\t\t'UseCanonicalPhysicalPort On'; \\\n\t} >> /etc/httpd/conf/httpd.conf \\\n\t&& sed -i \\\n\t\t-e 's~^\\(LoadModule .*\\)$~#\\1~g' \\\n\t\t-e 's~^#\\(LoadModule mime_module .*\\)$~\\1~' \\\n\t\t-e 's~^#\\(LoadModule log_config_module .*\\)$~\\1~' \\\n\t\t-e 's~^#\\(LoadModule setenvif_module .*\\)$~\\1~' \\\n\t\t-e 's~^#\\(LoadModule status_module .*\\)$~\\1~' \\\n\t\t-e 's~^#\\(LoadModule authz_host_module .*\\)$~\\1~' \\\n\t\t-e 's~^#\\(LoadModule dir_module .*\\)$~\\1~' \\\n\t\t-e 's~^#\\(LoadModule alias_module .*\\)$~\\1~' \\\n\t\t-e 's~^#\\(LoadModule expires_module .*\\)$~\\1~' \\\n\t\t-e 's~^#\\(LoadModule deflate_module .*\\)$~\\1~' \\\n\t\t-e 's~^#\\(LoadModule headers_module .*\\)$~\\1~' \\\n\t\t-e 's~^#\\(LoadModule alias_module .*\\)$~\\1~' \\\n\t\t-e 's~^#\\(LoadModule version_module .*\\)$~\\1~' \\\n\t\t/etc/httpd/conf.modules.d/00-base.conf \\\n\t\t/etc/httpd/conf.modules.d/00-dav.conf \\\n\t\t/etc/httpd/conf.modules.d/00-lua.conf \\\n\t\t/etc/httpd/conf.modules.d/00-proxy.conf \\\n\t\t/etc/httpd/conf.modules.d/00-ssl.conf \\\n\t\t/etc/httpd/conf.modules.d/00-systemd.conf \\\n\t&& sed -ri \\\n\t\t-e '/<VirtualHost _default_:443>/,/<\\/VirtualHost>/ s~^~#~' \\\n\t\t-e 's~(SSLSessionCacheTimeout.*)$~\\1\\n\\nSSLUseStapling on\\nSSLStaplingCache shmcb:/run/httpd/sslstaplingcache(512000)\\nSSLStaplingResponderTimeout 5\\nSSLStaplingReturnResponderErrors off~' \\\n\t\t/etc/httpd/conf.d/ssl.conf \\\n\t&& cat \\\n\t\t/etc/httpd/conf.d/ssl.conf \\\n\t\t> /etc/httpd/conf.d/ssl.conf.off \\\n\t&& truncate -s 0 \\\n\t\t/etc/httpd/conf.d/ssl.conf \\\n\t&& chmod 644 \\\n\t\t/etc/httpd/conf.d/ssl.conf \\\n\t&& cp -pf \\\n\t\t/etc/php-fpm.conf \\\n\t\t/etc/php-fpm.conf.default \\\n\t&& cp -pf \\\n\t\t/etc/php-fpm.d/www.conf \\\n\t\t/etc/php-fpm.d/www.conf.default \\\n\t&& cp -pf \\\n\t\t/etc/httpd/conf.d/php-fpm.conf \\\n\t\t/etc/httpd/conf.d/php-fpm.conf.default \\\n\t&& sed \\\n\t\t-e 's~^; .*$~~' \\\n\t\t-e 's~^;*$~~' \\\n\t\t-e '/^$/d' \\\n\t\t-e 's~^\\[~\\n\\[~g' \\\n\t\t/etc/php.ini \\\n\t\t> /etc/php.d/00-php.ini.default \\\n\t&& sed -r \\\n\t\t-e 's~^;(user_ini.filename =)$~\\1~g' \\\n\t\t-e 's~^;(cgi.fix_pathinfo=1)$~\\1~g' \\\n\t\t-e 's~^;(date.timezone =)$~\\1 UTC~g' \\\n\t\t-e 's~^(expose_php = )On$~\\1Off~g' \\\n\t\t-e 's~^;(realpath_cache_size = ).*$~\\14096k~' \\\n\t\t-e 's~^;(realpath_cache_ttl = ).*$~\\1600~' \\\n\t\t-e 's~^;?(session.name = ).*$~\\1\"${PHP_OPTIONS_SESSION_NAME:-PHPSESSID}\"~' \\\n\t\t-e 's~^;?(session.save_handler = ).*$~\\1\"${PHP_OPTIONS_SESSION_SAVE_HANDLER:-files}\"~' \\\n\t\t-e 's~^;?(session.save_path = ).*$~\\1\"${PHP_OPTIONS_SESSION_SAVE_PATH:-/var/lib/php/session}\"~' \\\n\t\t/etc/php.d/00-php.ini.default \\\n\t\t> /etc/php.d/00-php.ini \\\n\t&& sed \\\n\t\t-e 's~^; .*$~~' \\\n\t\t-e 's~^;*$~~' \\\n\t\t-e '/^$/d' \\\n\t\t-e 's~^\\[~\\n\\[~g' \\\n\t\t/etc/php.d/10-opcache.ini \\\n\t\t> /etc/php.d/10-opcache.ini.default \\\n\t&& sed \\\n\t\t-e 's~^;\\(opcache.enable_cli=\\).*$~\\11~g' \\\n\t\t-e 's~^\\(opcache.max_accelerated_files=\\).*$~\\132531~g' \\\n\t\t-e 's~^;\\(opcache.validate_timestamps=\\).*$~\\10~g' \\\n\t\t/etc/php.d/10-opcache.ini.default \\\n\t\t> /etc/php.d/10-opcache.ini \\\n\t&& if [[ ${RELEASE_VERSION%%.*} -ge 3 ]]; \\\n\t\tthen \\\n\t\t\tsed -r -i \\\n\t\t\t\t-e 's~^(error_log) *=.*$~\\1 = /dev/stderr~' \\\n\t\t\t\t-e 's~^;?(systemd_interval = ).*$~\\10~' \\\n\t\t\t\t/etc/php-fpm.conf; \\\n\t\telse \\\n\t\t\tsed -r -i \\\n\t\t\t\t-e 's~^(error_log) *=.*$~\\1 = /dev/stderr~' \\\n\t\t\t\t/etc/php-fpm.conf; \\\n\t\tfi \\\n\t&& sed -i \\\n\t\t-e 's~^\\[www\\]$~[{{APACHE_RUN_USER}}]~' \\\n\t\t-e 's~^user = php-fpm$~user = {{APACHE_RUN_USER}}~' \\\n\t\t-e 's~^group = php-fpm$~group = {{APACHE_RUN_GROUP}}~' \\\n\t\t-e 's~^listen = 127.0.0.1:9000$~;listen = 127.0.0.1:9000~' \\\n\t\t-e 's~^;listen = /run/php-fpm/www.sock$~listen = /run/php-fpm/{{APACHE_RUN_USER}}.sock~' \\\n\t\t-e 's~^;listen.owner = root$~listen.owner = {{APACHE_RUN_USER}}~' \\\n\t\t-e 's~^;listen.group = root$~listen.group = {{APACHE_RUN_GROUP}}~' \\\n\t\t-e 's~^pm.max_children = 50$~pm.max_children = 64~' \\\n\t\t-e 's~^slowlog = /var/log/php-fpm/www-slow.log$~slowlog = /var/log/php-fpm/{{APACHE_RUN_USER}}-slow.log~' \\\n\t\t-e 's~^\\(php_admin_value\\[error_log\\].*\\)$~;\\1~' \\\n\t\t-e 's~^\\(php_admin_flag\\[log_errors\\].*\\)$~;\\1~' \\\n\t\t-e 's~^\\(php_value\\[session.save_handler\\].*\\)$~;\\1~' \\\n\t\t-e 's~^\\(php_value\\[session.save_path\\].*\\)$~;\\1~' \\\n\t\t-e 's~^\\(php_value\\[soap.wsdl_cache_dir\\].*\\)$~;\\1~' \\\n\t\t-e 's~^;\\(pm.status_path = \\).*$~\\1/status~' \\\n\t\t/etc/php-fpm.d/www.conf \\\n\t&& cat \\\n\t\t/etc/php-fpm.d/www.conf \\\n\t\t> /etc/php-fpm.d/www.conf.template \\\n\t&& sed -i \\\n\t\t-e 's~^\\([ \\t]*\\)\\(SetHandler \"proxy:fcgi:.*\\)$~\\1#\\2~' \\\n\t\t-e 's~^\\([ \\t]*\\)#\\(SetHandler \"proxy:unix:.*\\)$~\\1\\2~' \\\n\t\t/etc/httpd/conf.d/php-fpm.conf \\\n\t&& sed -i \\\n\t\t-e \"s~{{RELEASE_VERSION}}~${RELEASE_VERSION}~g\" \\\n\t\t/etc/systemd/system/centos-ssh-apache-php@.service \\\n\t&& chmod 700 \\\n\t\t/usr/{bin/healthcheck,sbin/{httpd-{bootstrap,wrapper},php-fpm-wrapper}}\n\n# ------------------------------------------------------------------------------\n# Package installation\n# ------------------------------------------------------------------------------\nRUN mkdir -p -m 750 ${PACKAGE_PATH} \\\n\t&& curl -f -Ls \\\n\t\thttps://github.com/jdeathe/php-hello-world/archive/${PACKAGE_RELEASE_VERSION}.tar.gz \\\n\t| tar -xzpf - \\\n\t\t--strip-components=1 \\\n\t\t--exclude=\"*.gitkeep\" \\\n\t\t-C ${PACKAGE_PATH} \\\n\t&& sed -i \\\n\t\t-e 's~^description =.*$~description = \"This CentOS / Apache / PHP-FPM (FastCGI) service is running in a container.\"~' \\\n\t\t${PACKAGE_PATH}/etc/views/index.ini \\\n\t&& mv \\\n\t\t${PACKAGE_PATH}/public \\\n\t\t${PACKAGE_PATH}/public_html \\\n\t&& $(\\\n\t\tif [[ -f /usr/share/php-pecl-apc/apc.php ]]; then \\\n\t\t\tcp \\\n\t\t\t\t/usr/share/php-pecl-apc/apc.php \\\n\t\t\t\t${PACKAGE_PATH}/public_html/_apc.php; \\\n\t\tfi \\\n\t) \\\n\t&& chown -R app:app-www ${PACKAGE_PATH} \\\n\t&& find ${PACKAGE_PATH} -type d -exec chmod 750 {} + \\\n\t&& find ${PACKAGE_PATH}/var -type d -exec chmod 770 {} + \\\n\t&& find ${PACKAGE_PATH} -type f -exec chmod 640 {} + \\\n\t&& find ${PACKAGE_PATH}/bin -type f -exec chmod 750 {} +\n\nEXPOSE 80 443 8443\n\n# ------------------------------------------------------------------------------\n# Set default environment variables used to configure the service container\n# ------------------------------------------------------------------------------\nENV APACHE_AUTOSTART_HTTPD_BOOTSTRAP=\"true\" \\\n\tAPACHE_AUTOSTART_HTTPD_WRAPPER=\"true\" \\\n\tAPACHE_AUTOSTART_PHP_FPM_WRAPPER=\"true\" \\\n\tAPACHE_CONTENT_ROOT=\"/var/www/${PACKAGE_NAME}\" \\\n\tAPACHE_CUSTOM_LOG_FORMAT=\"combined\" \\\n\tAPACHE_CUSTOM_LOG_LOCATION=\"var/log/apache_access_log\" \\\n\tAPACHE_ERROR_LOG_LOCATION=\"var/log/apache_error_log\" \\\n\tAPACHE_ERROR_LOG_LEVEL=\"warn\" \\\n\tAPACHE_EXTENDED_STATUS_ENABLED=\"false\" \\\n\tAPACHE_HEADER_X_SERVICE_UID=\"{{HOSTNAME}}\" \\\n\tAPACHE_LOAD_MODULES=\"\" \\\n\tAPACHE_MOD_SSL_ENABLED=\"false\" \\\n\tAPACHE_MPM=\"prefork\" \\\n\tAPACHE_OPERATING_MODE=\"production\" \\\n\tAPACHE_PUBLIC_DIRECTORY=\"public_html\" \\\n\tAPACHE_RUN_GROUP=\"app-www\" \\\n\tAPACHE_RUN_USER=\"app-www\" \\\n\tAPACHE_SERVER_ALIAS=\"\" \\\n\tAPACHE_SERVER_NAME=\"\" \\\n\tAPACHE_SSL_CERTIFICATE=\"\" \\\n\tAPACHE_SSL_CIPHER_SUITE=\"ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS\" \\\n\tAPACHE_SSL_PROTOCOL=\"All -SSLv2 -SSLv3\" \\\n\tAPACHE_SYSTEM_USER=\"app\" \\\n\tPACKAGE_PATH=\"${PACKAGE_PATH}\" \\\n\tPHP_OPTIONS_DATE_TIMEZONE=\"UTC\" \\\n\tPHP_OPTIONS_SESSION_NAME=\"PHPSESSID\" \\\n\tPHP_OPTIONS_SESSION_SAVE_HANDLER=\"files\" \\\n\tPHP_OPTIONS_SESSION_SAVE_PATH=\"var/session\" \\\n\tSSH_AUTOSTART_SSHD=\"false\" \\\n\tSSH_AUTOSTART_SSHD_BOOTSTRAP=\"false\" \\\n\tSSH_AUTOSTART_SUPERVISOR_STDOUT=\"false\"\n\n# ------------------------------------------------------------------------------\n# Set image metadata\n# ------------------------------------------------------------------------------\nLABEL \\\n\tmaintainer=\"James Deathe <james.deathe@gmail.com>\" \\\n\tinstall=\"docker run \\\n--rm \\\n--privileged \\\n--volume /:/media/root \\\njdeathe/centos-ssh-apache-php:${RELEASE_VERSION} \\\n/usr/sbin/scmi install \\\n--chroot=/media/root \\\n--name=\\${NAME} \\\n--tag=${RELEASE_VERSION}\" \\\n\tuninstall=\"docker run \\\n--rm \\\n--privileged \\\n--volume /:/media/root \\\njdeathe/centos-ssh-apache-php:${RELEASE_VERSION} \\\n/usr/sbin/scmi uninstall \\\n--chroot=/media/root \\\n--name=\\${NAME} \\\n--tag=${RELEASE_VERSION}\" \\\n\torg.deathe.name=\"centos-ssh-apache-php\" \\\n\torg.deathe.version=\"${RELEASE_VERSION}\" \\\n\torg.deathe.release=\"jdeathe/centos-ssh-apache-php:${RELEASE_VERSION}\" \\\n\torg.deathe.license=\"MIT\" \\\n\torg.deathe.vendor=\"jdeathe\" \\\n\torg.deathe.url=\"https://github.com/jdeathe/centos-ssh-apache-php\" \\\n\torg.deathe.description=\"CentOS-7 7.5.1804 x86_64 - IUS Apache 2.4, IUS PHP-FPM 7.2, PHP memcached 3.0, Zend Opcache 7.2.\"\n\nHEALTHCHECK \\\n\t--interval=1s \\\n\t--timeout=1s \\\n\t--retries=10 \\\n\tCMD [\"/usr/bin/healthcheck\"]\n\nCMD [\"/usr/bin/supervisord\", \"--configuration=/etc/supervisord.conf\"]\n"
}