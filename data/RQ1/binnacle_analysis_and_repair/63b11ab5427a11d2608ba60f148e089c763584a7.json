{
  "startTime": 1674236740874,
  "endTime": 1674236741241,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 62,
        "lineEnd": 62,
        "columnStart": 7,
        "columnEnd": 118
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 63,
        "lineEnd": 63,
        "columnStart": 7,
        "columnEnd": 126
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 68,
        "lineEnd": 68,
        "columnStart": 7,
        "columnEnd": 96
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 69,
        "lineEnd": 69,
        "columnStart": 7,
        "columnEnd": 89
      }
    },
    {
      "rule": "sha256sumEchoOneSpaces",
      "position": {
        "lineStart": 8,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 6,
        "columnEnd": 78
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 31,
        "lineEnd": 31,
        "columnStart": 6,
        "columnEnd": 76
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 32,
        "lineEnd": 32,
        "columnStart": 6,
        "columnEnd": 61
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 6,
        "columnEnd": 67
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 64,
        "lineEnd": 64,
        "columnStart": 7,
        "columnEnd": 43
      }
    },
    {
      "rule": "gpgUseHaPools",
      "position": {
        "lineStart": 30,
        "lineEnd": 30,
        "columnStart": 6,
        "columnEnd": 78
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 7,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 36,
        "lineEnd": 53,
        "columnStart": 7,
        "columnEnd": 12
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM python:2.7-slim-stretch\n\nENV GOSU_VERSION=1.10 \\\n    NODE_ENV=production \\\n    NODE_VERSION=8.6.0 \\\n    YARN_VERSION=1.1.0\n\n# Libraries such as matplotlib require a HOME directory for cache and configuration\nRUN set -ex \\\n    && mkdir -p /var/www \\\n    && chown www-data:www-data /var/www \\\n    && apt-get update \\\n    && apt-get install --no-install-recommends -y gnupg2 \\\n    && for key in \\\n      # GOSU\n      B42F6819007F00F88E364FD4036A9C25BF357DD4 \\\n      # https://github.com/nodejs/docker-node/blob/9c25cbe93f9108fd1e506d14228afe4a3d04108f/8.2/Dockerfile\n      # gpg keys listed at https://github.com/nodejs/node#release-team\n      # Node\n      9554F04D7259F04124DE6B476D5A82AC7E37093B \\\n      94AE36675C464D64BAFA68DD7434390BDBE9B9C5 \\\n      FD3A5288F042B6850C66B31F09FE44734EB7990E \\\n      71DCFD284A79C3B38668286BC97EC7A07EDE3FC1 \\\n      DD8F2338BAE7501E3DD5AC78C273792F7D83545D \\\n      B9AE9905FFD7803F25714661B63B535A4C206CA9 \\\n      C4F0DFFF4E8C1A8236409D08E73BC641CC11F4C8 \\\n      56730D5401028683275BD23C23EFEFE93C4CFFFE \\\n      # Yarn\n      6A010C5166006599AA17F08146C2130DFD2497F5; \\\n    do \\\n      gpg --batch --keyserver hkp://ipv4.ha.pool.sks-keyservers.net:80 --recv-keys \"$key\" || \\\n      gpg --batch --keyserver hkp://ha.pool.sks-keyservers.net:80 --recv-keys \"$key\" || \\\n      gpg --batch --keyserver hkp://pgp.mit.edu:80 --recv-keys \"$key\" || \\\n      gpg --batch --keyserver hkp://keyserver.pgp.com:80 --recv-keys \"$key\" \\\n    ; done \\\n    # Install dependancies\n    && apt-get install --no-install-recommends -y \\\n        git \\\n        libev4 \\\n        libev-dev \\\n        libevent-dev \\\n        libxml2-dev \\\n        libxslt1-dev \\\n        zlib1g-dev \\\n        curl \\\n        # cryptography\n        build-essential \\\n        libssl-dev \\\n        libffi-dev \\\n        python-dev \\\n        # postgresql\n        libpq-dev \\\n        # file audits\n        par2 \\\n    && ARCH= \\\n    && dpkgArch=\"$(dpkg --print-architecture)\" \\\n    && case \"${dpkgArch##*-}\" in \\\n      amd64) ARCH='x64';; \\\n      ppc64el) ARCH='ppc64le';; \\\n      * echo \"unsupported  architecture\"; exit 1;; \\\n    esac \\\n    # grab gosu for easy step-down from root\n    && curl -f -o /usr/local/bin/gosu -SL \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch\" \\\n    && curl -f -o /usr/local/bin/gosu.asc -SL \"https://github.com/tianon/gosu/releases/download/$GOSU_VERSION/gosu-$dpkgArch.asc\" \\\n    && gpg --batch --verify /usr/local/bin/gosu.asc \\\n    && rm /usr/local/bin/gosu.asc \\\n    && chmod +x /usr/local/bin/gosu \\\n    # Node\n    && curl -f -SLO \"https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-$ARCH.tar.xz\" \\\n    && curl -f -SLO --compressed \"https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc\" \\\n    && gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \\\n    && grep \" node-v$NODE_VERSION-linux-$ARCH.tar.xz\\$\" SHASUMS256.txt | sha256sum -c - \\\n    && tar -xJf \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" -C /usr/local --strip-components=1 \\\n    && rm \"node-v$NODE_VERSION-linux-$ARCH.tar.xz\" SHASUMS256.txt.asc SHASUMS256.txt \\\n    && ln -s /usr/local/bin/node /usr/local/bin/nodejs \\\n    # Yarn\n    && curl -fSLO --compressed \"https://yarnpkg.com/downloads/$YARN_VERSION/yarn-v$YARN_VERSION.tar.gz\" \\\n    && curl -fSLO --compressed \"https://yarnpkg.com/downloads/$YARN_VERSION/yarn-v$YARN_VERSION.tar.gz.asc\" \\\n    && gpg --batch --verify yarn-v$YARN_VERSION.tar.gz.asc yarn-v$YARN_VERSION.tar.gz \\\n    && mkdir -p /opt/yarn \\\n    && tar -xzf yarn-v$YARN_VERSION.tar.gz -C /opt/yarn --strip-components=1 \\\n    && ln -s /opt/yarn/bin/yarn /usr/local/bin/yarn \\\n    && ln -s /opt/yarn/bin/yarn /usr/local/bin/yarnpkg \\\n    && yarn global add bower \\\n    && yarn cache clean \\\n    && rm -rf \\\n        yarn-v$YARN_VERSION.tar.gz.asc \\\n        yarn-v$YARN_VERSION.tar.gz \\\n        $HOME/.gnupg \\\n        $HOME/.cache \\\n    && apt-get remove -y \\\n        curl \\\n    && apt-get clean \\\n    && apt-get autoremove -y \\\n    && rm -rf /var/lib/apt/lists/* \\\n    && mkdir -p /code\n\nWORKDIR /code\n\nCOPY ./requirements.txt ./\nCOPY ./requirements/ ./requirements/\nCOPY ./addons/bitbucket/requirements.txt ./addons/bitbucket/\nCOPY ./addons/box/requirements.txt ./addons/box/\n#COPY ./addons/citations/requirements.txt ./addons/citations/\nCOPY ./addons/dataverse/requirements.txt ./addons/dataverse/\nCOPY ./addons/dropbox/requirements.txt ./addons/dropbox/\n#COPY ./addons/figshare/requirements.txt ./addons/figshare/\n#COPY ./addons/forward/requirements.txt ./addons/forward/\nCOPY ./addons/github/requirements.txt ./addons/github/\nCOPY ./addons/gitlab/requirements.txt ./addons/gitlab/\n#COPY ./addons/googledrive/requirements.txt ./addons/googledrive/\nCOPY ./addons/mendeley/requirements.txt ./addons/mendeley/\nCOPY ./addons/onedrive/requirements.txt /code/addons/onedrive/\n#COPY ./addons/osfstorage/requirements.txt ./addons/osfstorage/\nCOPY ./addons/owncloud/requirements.txt ./addons/owncloud/\nCOPY ./addons/s3/requirements.txt ./addons/s3/\nCOPY ./addons/twofactor/requirements.txt ./addons/twofactor/\n#COPY ./addons/wiki/requirements.txt ./addons/wiki/\nCOPY ./addons/zotero/requirements.txt ./addons/zotero/\n\nRUN for reqs_file in \\\n        /code/requirements.txt \\\n        /code/requirements/release.txt \\\n        /code/addons/*/requirements.txt \\\n    ; do \\\n        pip install --no-cache-dir -c /code/requirements/constraints.txt -r \"$reqs_file\" \\\n    ; done \\\n    && (pip uninstall uritemplate.py --yes || true) \\\n    && pip install --no-cache-dir uritemplate.py==0.3.0 \\\n    # Fix: https://github.com/CenterForOpenScience/osf.io/pull/6783\n    && python -m compileall /usr/local/lib/python2.7 || true\n\n# OSF: Assets\nCOPY ./.bowerrc ./bower.json ./\nRUN bower install --production --allow-root \\\n    && bower cache clean --allow-root\n\nCOPY ./package.json ./.yarnrc ./yarn.lock ./\nRUN yarn install --frozen-lockfile \\\n    && yarn cache clean\n\nCOPY ./tasks/ ./tasks/\nCOPY ./website/settings/ ./website/settings/\nCOPY ./api/base/settings/ ./api/base/settings/\nCOPY ./website/__init__.py ./website/__init__.py\nCOPY ./addons.json ./addons.json\nRUN mv ./website/settings/local-dist.py ./website/settings/local.py \\\n    && mv ./api/base/settings/local-dist.py ./api/base/settings/local.py \\\n    && sed 's/DEBUG_MODE = True/DEBUG_MODE = False/' -i ./website/settings/local.py\n\nCOPY ./webpack* ./\nCOPY ./website/static/ ./website/static/\nCOPY ./addons/bitbucket/static/ ./addons/bitbucket/static/\nCOPY ./addons/box/static/ ./addons/box/static/\nCOPY ./addons/citations/static/ ./addons/citations/static/\nCOPY ./addons/dataverse/static/ ./addons/dataverse/static/\nCOPY ./addons/dropbox/static/ ./addons/dropbox/static/\nCOPY ./addons/figshare/static/ ./addons/figshare/static/\nCOPY ./addons/forward/static/ ./addons/forward/static/\nCOPY ./addons/github/static/ ./addons/github/static/\nCOPY ./addons/gitlab/static/ ./addons/gitlab/static/\nCOPY ./addons/googledrive/static/ ./addons/googledrive/static/\nCOPY ./addons/mendeley/static/ ./addons/mendeley/static/\nCOPY ./addons/onedrive/static/ /code/addons/onedrive/static/\nCOPY ./addons/osfstorage/static/ ./addons/osfstorage/static/\nCOPY ./addons/owncloud/static/ ./addons/owncloud/static/\nCOPY ./addons/s3/static/ ./addons/s3/static/\nCOPY ./addons/twofactor/static/ ./addons/twofactor/static/\nCOPY ./addons/wiki/static/ ./addons/wiki/static/\nCOPY ./addons/zotero/static/ ./addons/zotero/static/\nRUN mkdir -p ./website/static/built/ \\\n    && invoke build_js_config_files \\\n    && yarn run webpack-prod\n# /OSF: Assets\n\n# Admin: Assets\nCOPY ./admin/.bowerrc ./admin/bower.json ./admin/\nRUN cd ./admin \\\n    && bower install --production --allow-root \\\n    && bower cache clean --allow-root\n\nCOPY ./admin/package.json ./admin/yarn.lock ./admin/\nRUN cd ./admin \\\n    && yarn install --frozen-lockfile \\\n    && yarn cache clean\n\nCOPY ./admin/webpack* ./admin/\nCOPY ./admin/static/ ./admin/static/\nRUN cd ./admin \\\n    && yarn run webpack-prod\n# /Admin: Assets\n\n# Copy the rest of the code over\nCOPY ./ ./\n\nARG GIT_COMMIT=\nENV GIT_COMMIT ${GIT_COMMIT}\n\nRUN for module in \\\n        api.base.settings \\\n        admin.base.settings \\\n    ; do \\\n        export DJANGO_SETTINGS_MODULE=$module \\\n        && python manage.py collectstatic --noinput --no-init-app \\\n    ; done \\\n    && for file in \\\n        ./website/templates/_log_templates.mako \\\n        ./website/static/built/nodeCategories.json \\\n    ; do \\\n        touch $file && chmod o+w $file \\\n    ; done \\\n    && rm ./website/settings/local.py ./api/base/settings/local.py\n\nCMD [\"gosu\", \"nobody\", \"invoke\", \"--list\"]\n"
}