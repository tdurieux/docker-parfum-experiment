{
  "startTime": 1674244144785,
  "endTime": 1674244145016,
  "originalSmells": [
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 153,
        "lineEnd": 153,
        "columnStart": 4,
        "columnEnd": 133
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 144,
        "lineEnd": 150,
        "columnStart": 4,
        "columnEnd": 15
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "# AUTHOR:           Nicholas Long\n# DESCRIPTION:      OpenStudio Server Docker Container\n# TO_BUILD_AND_RUN: docker-compose up\n# NOTES:            Currently this is one big dockerfile and non-optimal.\n\n#may include suffix\nARG OPENSTUDIO_VERSION\nFROM nrel/openstudio:$OPENSTUDIO_VERSION as base\nMAINTAINER Nicholas Long nicholas.long@nrel.gov\n\n# Install required libaries.\n#   realpath - needed for wait-for-it\nRUN sudo apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 7F0CEB10 && \\\n    echo \"deb http://repo.mongodb.org/apt/ubuntu trusty/mongodb-org/3.0 multiverse\" | \\\n    sudo tee /etc/apt/sources.list.d/mongodb-org-3.0.list && \\\n    apt-get update \\\n\t&& apt-get install -y --no-install-recommends \\\n        apt-transport-https \\\n        autoconf \\\n        bison \\\n        build-essential \\\n        bzip2 \\\n        ca-certificates \\\n        curl \\\n        default-jdk \\\n        dos2unix \\\n        imagemagick \\\n        gdebi-core \\\n        git \\\n        libbz2-dev \\\n        libcurl4-openssl-dev \\\n        libdbus-glib-1-2 \\\n        libgdbm3 \\\n        libgdbm-dev \\\n        libglib2.0-dev \\\n        libglu1 \\\n        libgsl0-dev \\\n        libncurses-dev \\\n        libreadline-dev \\\n        libxml2-dev \\\n        libxslt-dev \\\n        libffi-dev \\\n        libssl-dev \\\n        libyaml-dev \\\n        libice-dev \\\n        libsm-dev \\\n        mongodb-org-tools \\\n        procps \\\n        realpath \\\n        tar \\\n        unzip \\\n        wget \\\n        zip \\\n        zlib1g-dev \\\n    && rm -rf /var/lib/apt/lists/*\n\n# Install passenger (this also installs nginx)\nENV PASSENGER_VERSION 5.0.25\n# Install Rack. Silly workaround for not having ruby 2.2.2. Rack 1.6.4 is the\n# latest for Ruby <= 2.0\nRUN gem install rack -v=1.6.4\nRUN gem install passenger -v $PASSENGER_VERSION\nRUN passenger-install-nginx-module\n\n# Configure the nginx server\nRUN mkdir /var/log/nginx\nADD /docker/server/nginx.conf /opt/nginx/conf/nginx.conf\n\n# Radiance env vars. RUBYLIB is set in the base openstudio container\nENV OPENSTUDIO_SERVER 'true'\nENV OS_RAYPATH /usr/local/openstudio-$OPENSTUDIO_VERSION/Radiance\nENV PERL_EXE_PATH /usr/bin\n\n# Specify a couple arguments here, after running the majority of the installation above\nARG rails_env=docker\nARG bundle_args=\"--without development test\"\n\n# Set the rails env var\nENV RAILS_ENV $rails_env\n\n#### OpenStudio Server Code\n# First upload the Gemfile* so that it can cache the Gems -- do this first because it is slow\nADD /bin /opt/openstudio/bin\nADD /server/Gemfile /opt/openstudio/server/Gemfile\nWORKDIR /opt/openstudio/server\nRUN bundle _${OS_BUNDLER_VERSION}_ install --jobs=3 --retry=3 $bundle_args\n\n# Add the app assets and precompile assets. Do it this way so that when the app changes the assets don't\n# have to be recompiled everytime\nADD /server/Rakefile /opt/openstudio/server/Rakefile\nADD /server/config/ /opt/openstudio/server/config/\nADD /server/app/assets/ /opt/openstudio/server/app/assets/\n\n# Now call precompile\nRUN mkdir /opt/openstudio/server/log\nRUN bundle exec rake assets:precompile\n\n# Bundle app source\nADD /server /opt/openstudio/server\nADD .rubocop.yml /opt/openstudio/.rubocop.yml\n# Run bundle again, because if the user has a local Gemfile.lock it will have been overriden\nRUN rm Gemfile.lock\nRUN bundle install --jobs=3 --retry=3\n\n# Configure IPVS keepalive\nADD /docker/server/ipvs-keepalive.conf /etc/sysctl.d/ipvs-keepalive.conf\nRUN sudo sysctl --system\n\n# Add in scripts for running server. This includes the wait-for-it scripts to ensure other processes (mongo, redis) have\n# started before starting the main process.\nCOPY /docker/server/wait-for-it.sh /usr/local/bin/wait-for-it\nCOPY /docker/server/start-server.sh /usr/local/bin/start-server\nCOPY /docker/server/run-server-tests.sh /usr/local/bin/run-server-tests\nCOPY /docker/server/rails-entrypoint.sh /usr/local/bin/rails-entrypoint\nCOPY /docker/server/start-web-background.sh /usr/local/bin/start-web-background\nCOPY /docker/server/start-workers.sh /usr/local/bin/start-workers\nCOPY /docker/server/memfix-controller.rb /usr/local/lib/memfix-controller.rb\nCOPY /docker/server/memfix.rb /usr/local/lib/memfix.rb\nRUN chmod 755 /usr/local/bin/wait-for-it\nRUN chmod +x /usr/local/bin/start-server\nRUN chmod +x /usr/local/bin/run-server-tests\nRUN chmod 755 /usr/local/bin/rails-entrypoint\nRUN chmod 755 /usr/local/bin/start-web-background\nRUN chmod 755 /usr/local/bin/start-workers\nRUN chmod +x /usr/local/lib/memfix-controller.rb\nRUN chmod +x /usr/local/lib/memfix.rb\n\n# set the permissions for windows users\nRUN chmod +x /opt/openstudio/server/bin/*\n\nENTRYPOINT [\"rails-entrypoint\"]\n\nCMD [\"/usr/local/bin/start-server\"]\n\n# Expose ports.\nEXPOSE 8080 9090\n\n# Multistage build includes test library. To build without testing run\n# docker build --target base -t some-tag .\nFROM base\nENV GECKODRIVER_VERSION v0.21.0\n# Install vfb and firefox requirement if docker-test env\nRUN echo \"Running in testing environment - Installing Firefox and Gecko Driver\" && \\\n    apt-get update && \\\n    apt-get install --no-install-recommends -y xvfb \\\n        x11-xkb-utils \\\n        xfonts-100dpi \\\n        xfonts-75dpi \\\n        xfonts-scalable \\\n        xfonts-cyrillic \\\n        firefox && \\\n    rm -rf /var/lib/apt/lists/* && \\\n    cd /usr/local/bin && \\\n    wget https://github.com/mozilla/geckodriver/releases/download/$GECKODRIVER_VERSION/geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz && \\\n    tar -xvzf geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz && \\\n    rm geckodriver-$GECKODRIVER_VERSION-linux64.tar.gz && \\\n    chmod +x geckodriver;\n\n# Test adding the git repo to the container for coveralls\n# The #TEST# will be removed in the travis test script to be run in the test container\n#TEST#COPY .git /opt/openstudio/.git\n"
}