{
  "startTime": 1674249863724,
  "endTime": 1674249864048,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 77,
        "lineEnd": 77,
        "columnStart": 7,
        "columnEnd": 34
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM ubuntu:16.04\n\n\nENV PG_BRANCH=master \\\n    WEBWORK_URL=/webwork2 \\\n    WEBWORK_ROOT_URL=http://localhost \\\n    WEBWORK_DB_HOST=db \\\n    WEBWORK_DB_PORT=3306 \\\n    WEBWORK_DB_NAME=webwork \\\n    WEBWORK_DB_USER=webworkWrite \\\n    WEBWORK_DB_PASSWORD=passwordRW \\\n    WEBWORK_SMTP_SERVER=localhost \\\n    WEBWORK_SMTP_SENDER=webwork@example.com \\\n    WEBWORK_TIMEZONE=America/New_York \\\n    APACHE_RUN_USER=www-data \\\n    APACHE_RUN_GROUP=www-data \\\n    # temporary state file location. This might be changed to /run in Wheezy+1 \\\n    APACHE_PID_FILE=/var/run/apache2/apache2.pid \\\n    APACHE_RUN_DIR=/var/run/apache2 \\\n    APACHE_LOCK_DIR=/var/lock/apache2 \\\n    # Only /var/log/apache2 is handled by /etc/logrotate.d/apache2.\n    APACHE_LOG_DIR=/var/log/apache2 \\\n    APP_ROOT=/opt/webwork \\\n    DEV=0\n\nENV WEBWORK_DB_DSN=DBI:mysql:${WEBWORK_DB_NAME}:${WEBWORK_DB_HOST}:${WEBWORK_DB_PORT} \\\n    WEBWORK_ROOT=$APP_ROOT/webwork2 \\\n    PG_ROOT=$APP_ROOT/pg \\\n    PATH=$PATH:$APP_ROOT/webwork2/bin\n\nRUN apt-get update \\\n    && apt-get install -y --no-install-recommends --no-install-suggests \\\n       apache2 \\\n       curl \\\n       dvipng \\\n       gcc \\\n       libapache2-request-perl \\\n       libcrypt-ssleay-perl \\\n       libdatetime-perl \\\n       libdancer-perl \\\n       libdancer-plugin-database-perl \\\n       libdbd-mysql-perl \\\n       libemail-address-perl \\\n       libexception-class-perl \\\n       libextutils-xsbuilder-perl \\\n       libfile-find-rule-perl-perl \\\n       libgd-perl \\\n       libhtml-scrubber-perl \\\n       libjson-perl \\\n       liblocale-maketext-lexicon-perl \\\n       libmail-sender-perl \\\n       libmime-tools-perl \\\n       libnet-ip-perl \\\n       libnet-ldap-perl \\\n       libnet-oauth-perl \\\n       libossp-uuid-perl \\\n       libpadwalker-perl \\\n       libpath-class-perl \\\n       libphp-serialization-perl \\\n       libsoap-lite-perl \\\n       libsql-abstract-perl \\\n       libstring-shellquote-perl \\\n       libtemplate-perl \\\n       libtext-csv-perl \\\n       libtimedate-perl \\\n       libuuid-tiny-perl \\\n       libxml-parser-perl \\\n       libxml-writer-perl \\\n       libapache2-reload-perl \\\n       make \\\n       netpbm \\\n       preview-latex-style \\\n       texlive \\\n       texlive-latex-extra \\\n       libc6-dev \\\n       git \\\n       mysql-client \\\n    && curl -f -Lk https://cpanmin.us | perl - App::cpanminus \\\n    && cpanm install XML::Parser::EasyTree Iterator Iterator::Util Pod::WSDL Array::Utils HTML::Template XMLRPC::Lite Mail::Sender Email::Sender::Simple Data::Dump Statistics::R::IO \\\n    && rm -fr /var/lib/apt/lists/* ./cpanm /root/.cpanm /tmp/*\n\nRUN mkdir -p $APP_ROOT/courses $APP_ROOT/libraries $APP_ROOT/webwork2\n\n\n# Block to include webwork2 in the container, when needed, instead of  getting it from a bind mount.\n#    Uncomment when needed, and set the correct branch name on the following line.\n#ENV WEBWORK_BRANCH=master   # need a valid branch name from https://github.com/openwebwork/webwork2\n#RUN curl -fSL https://github.com/openwebwork/webwork2/archive/${WEBWORK_BRANCH}.tar.gz -o /tmp/${WEBWORK_BRANCH}.tar.gz \\\n#    && cd /tmp \\\n#    && tar xzf /tmp/${WEBWORK_BRANCH}.tar.gz \\\n#    && mv webwork2-${WEBWORK_BRANCH} $APP_ROOT/webwork2 \\\n#    && rm -rf /tmp/${WEBWORK_BRANCH}.tar.gz /tmp/webwork2-${WEBWORK_BRANCH}\n\nRUN curl -fSL https://github.com/openwebwork/pg/archive/${PG_BRANCH}.tar.gz -o /tmp/${PG_BRANCH}.tar.gz \\\n    && tar xzf /tmp/${PG_BRANCH}.tar.gz \\\n    && mv pg-${PG_BRANCH} $APP_ROOT/pg \\\n    && rm /tmp/${PG_BRANCH}.tar.gz \\\n    && curl -fSL https://github.com/openwebwork/webwork-open-problem-library/archive/master.tar.gz -o /tmp/opl.tar.gz \\\n    && tar xzf /tmp/opl.tar.gz \\\n    && mv webwork-open-problem-library-master $APP_ROOT/libraries/webwork-open-problem-library \\\n    && rm /tmp/opl.tar.gz\n\nRUN curl -fSL https://github.com/mathjax/MathJax/archive/master.tar.gz -o /tmp/mathjax.tar.gz \\\n    && tar xzf /tmp/mathjax.tar.gz \\\n    && mv MathJax-master $APP_ROOT/MathJax \\\n    && rm /tmp/mathjax.tar.gz\n    #&& rm /tmp/VERSION\n    #curl -fSL https://github.com/openwebwork/webwork2/archive/WeBWorK-${WEBWORK_VERSION}.tar.gz -o /tmp/WeBWorK-${WEBWORK_VERSION}.tar.gz \\\n    #&& tar xzf /tmp/WeBWorK-${WEBWORK_VERSION}.tar.gz \\\n    #&& mv webwork2-WeBWorK-${WEBWORK_VERSION} $APP_ROOT/webwork2 \\\n    #&& rm /tmp/WeBWorK-${WEBWORK_VERSION}.tar.gz \\\n\n\nRUN echo \"PATH=$PATH:$APP_ROOT/webwork2/bin\" >> /root/.bashrc\n\nCOPY . $APP_ROOT/webwork2\n\n\n# Move these lines into docker-entrypoint.sh so the bind mount of courses\n# will be available\n#RUN cd $APP_ROOT/webwork2/courses.dist \\\n#    && cp *.lst $APP_ROOT/courses/ \\\n#    && cp -R modelCourse $APP_ROOT/courses/\n\nRUN cd $APP_ROOT/pg/lib/chromatic \\\n    && gcc color.c -o color\n\n# setup apache\nRUN cd $APP_ROOT/webwork2/conf \\\n    && cp webwork.apache2.4-config.dist webwork.apache2.4-config \\\n    && cp $APP_ROOT/webwork2/conf/webwork.apache2.4-config /etc/apache2/conf-enabled/webwork.conf \\\n    && a2dismod mpm_event \\\n    && a2enmod mpm_prefork \\\n    && sed -i -e 's/Timeout 300/Timeout 1200/' /etc/apache2/apache2.conf \\\n    && sed -i -e 's/MaxRequestWorkers     150/MaxRequestWorkers     20/' \\\n        -e 's/MaxConnectionsPerChild   0/MaxConnectionsPerChild   100/' \\\n        /etc/apache2/mods-available/mpm_prefork.conf \\\n    && cp $APP_ROOT/webwork2/htdocs/favicon.ico /var/www/html \\\n    && sed -i -e 's/^<Perl>$/\\\n      PerlPassEnv WEBWORK_URL\\n\\\n      PerlPassEnv WEBWORK_ROOT_URL\\n\\\n      PerlPassEnv WEBWORK_DB_DSN\\n\\\n      PerlPassEnv WEBWORK_DB_USER\\n\\\n      PerlPassEnv WEBWORK_DB_PASSWORD\\n\\\n      PerlPassEnv WEBWORK_SMTP_SERVER\\n\\\n      PerlPassEnv WEBWORK_SMTP_SENDER\\n\\\n      PerlPassEnv WEBWORK_TIMEZONE\\n\\\n      \\n<Perl>/' /etc/apache2/conf-enabled/webwork.conf\n\nRUN cd $APP_ROOT/webwork2/ \\\n    && chown www-data DATA ../courses htdocs/tmp htdocs/applets logs tmp $APP_ROOT/pg/lib/chromatic \\\n    && chmod -R u+w DATA ../courses htdocs/tmp htdocs/applets logs tmp $APP_ROOT/pg/lib/chromatic\n\nCOPY docker-entrypoint.sh /usr/local/bin/\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\n\nEXPOSE 80\n\nWORKDIR $APP_ROOT\n\nCMD [\"apache2\", \"-DFOREGROUND\"]\n"
}