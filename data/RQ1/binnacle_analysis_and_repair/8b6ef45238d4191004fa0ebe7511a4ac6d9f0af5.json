{
  "startTime": 1674246333239,
  "endTime": 1674246334497,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 49
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 115,
        "lineEnd": 115,
        "columnStart": 19,
        "columnEnd": 60
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 180,
        "lineEnd": 180,
        "columnStart": 4,
        "columnEnd": 62
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 100,
        "lineEnd": 100,
        "columnStart": 1,
        "columnEnd": 26
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 103,
        "lineEnd": 103,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 103,
        "lineEnd": 103,
        "columnStart": 27,
        "columnEnd": 63
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 28
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 109,
        "lineEnd": 109,
        "columnStart": 4,
        "columnEnd": 23
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 112,
        "lineEnd": 112,
        "columnStart": 4,
        "columnEnd": 24
      }
    },
    {
      "rule": "curlUseHttpsUrl",
      "position": {
        "lineStart": 115,
        "lineEnd": 115,
        "columnStart": 19,
        "columnEnd": 60
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 125,
        "lineEnd": 125,
        "columnStart": 16,
        "columnEnd": 61
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 65,
        "columnEnd": 101
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 125,
        "lineEnd": 125,
        "columnStart": 125,
        "columnEnd": 196
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 125,
        "lineEnd": 125,
        "columnStart": 65,
        "columnEnd": 91
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 186,
        "lineEnd": 186,
        "columnStart": 147,
        "columnEnd": 197
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 39,
        "columnEnd": 131
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 13,
        "lineEnd": 40,
        "columnStart": 69,
        "columnEnd": 12
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 212,
        "columnEnd": 252
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 91,
        "lineEnd": 91,
        "columnStart": 4,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 19,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 152,
        "lineEnd": 152,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 184,
        "lineEnd": 184,
        "columnStart": 4,
        "columnEnd": 151
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 91,
        "lineEnd": 91,
        "columnStart": 4,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 152,
        "lineEnd": 152,
        "columnStart": 4,
        "columnEnd": 73
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 184,
        "lineEnd": 184,
        "columnStart": 4,
        "columnEnd": 151
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 6,
        "lineEnd": 6,
        "columnStart": 39,
        "columnEnd": 131
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 13,
        "lineEnd": 40,
        "columnStart": 69,
        "columnEnd": 12
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 43,
        "lineEnd": 43,
        "columnStart": 212,
        "columnEnd": 252
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 91,
        "lineEnd": 91,
        "columnStart": 4,
        "columnEnd": 65
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 19,
        "columnEnd": 44
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 184,
        "lineEnd": 184,
        "columnStart": 4,
        "columnEnd": 151
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 91,
        "lineEnd": 91,
        "columnStart": 4,
        "columnEnd": 89
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 152,
        "lineEnd": 152,
        "columnStart": 4,
        "columnEnd": 97
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 184,
        "lineEnd": 184,
        "columnStart": 4,
        "columnEnd": 175
      }
    }
  ],
  "repairedDockerfile": "# Pull base image.\nFROM php:7.1.19-apache\nCOPY config/php.ini /usr/local/etc/php/\n\nRUN docker-php-ext-install mysqli && docker-php-ext-install pdo_mysql\n\nRUN apt-get clean && apt-get update && apt-get install --no-install-recommends --fix-missing wget apt-transport-https lsb-release ca-certificates gnupg2 -y && rm -rf /var/lib/apt/lists/*;\nRUN echo \"deb http://packages.dotdeb.org jessie all\" >> /etc/apt/sources.list\nRUN echo \"deb-src http://packages.dotdeb.org jessie all\" >> /etc/apt/sources.list\nRUN cd /tmp && wget https://www.dotdeb.org/dotdeb.gpg && apt-key add dotdeb.gpg\nRUN wget -O /etc/apt/trusted.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg\nRUN echo \"deb https://packages.sury.org/php/ $(lsb_release -sc) main\" > /etc/apt/sources.list.d/php.list\n\nRUN apt-get clean && apt-get update && apt-cache search php-mysql && apt-get install --no-install-recommends --fix-missing -y \\\n  ruby-dev \\\n  rubygems \\\n  imagemagick \\\n  graphviz \\\n  sudo \\\n  git \\\n  vim \\\n  memcached \\\n  libmemcached-tools \\\n  libmemcached-dev \\\n  libpng-dev \\\n  libjpeg62-turbo-dev \\\n  libmcrypt-dev \\\n  libxml2-dev \\\n  libxslt1-dev \\\n  mysql-client \\\n  zip \\\n  wget \\\n  linux-libc-dev \\\n  libyaml-dev \\\n  zlib1g-dev \\\n  libicu-dev \\\n  libpq-dev \\\n  bash-completion \\\n  htop \\\n  libldap2-dev \\\n  libssl-dev && rm -rf /var/lib/apt/lists/*;\n\n# postgresql-client-9.5\nRUN wget --quiet -O - https://www.postgresql.org/media/keys/ACCC4CF8.asc | sudo apt-key add - && echo \"deb http://apt.postgresql.org/pub/repos/apt/ jessie-pgdg main\" >> /etc/apt/sources.list && apt-get update && apt-get install --no-install-recommends -y postgresql-client-9.5 && rm -rf /var/lib/apt/lists/*;\n\n# Install memcached for PHP 7\nRUN cd /tmp && git clone https://github.com/php-memcached-dev/php-memcached.git\nRUN cd /tmp/php-memcached && sudo git checkout php7 && phpize && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --disable-memcached-sasl && make && make install\nRUN touch /usr/local/etc/php/conf.d/memcached.ini &&\\\n echo \"extension=/usr/local/lib/php/extensions/no-debug-non-zts-20160303/memcached.so\" >> /usr/local/etc/php/conf.d/memcached.ini\n\nCOPY docker-php-ext-install /usr/local/bin/\nRUN chmod +x /usr/local/bin/docker-php-ext-install\nRUN docker-php-ext-configure gd --with-jpeg-dir=/usr/include/\nRUN docker-php-ext-configure ldap --with-libdir=lib/x86_64-linux-gnu/\nRUN docker-php-ext-install \\\n  gd \\\n  mbstring \\\n  mcrypt \\\n  zip \\\n  soap \\\n  pdo_mysql \\\n  mysqli \\\n  xsl \\\n  opcache \\\n  calendar \\\n  intl \\\n  exif \\\n  pgsql \\\n  pdo_pgsql \\\n  ftp \\\n  bcmath \\\n  ldap\n\n# Create new web user for apache and grant sudo without password\nRUN useradd web -d /var/www -g www-data -s /bin/bash\nRUN usermod -aG sudo web\nRUN echo 'web ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers\n\n# Add sudo to www-data\nRUN echo 'www-data ALL=(ALL) NOPASSWD:ALL' >> /etc/sudoers\n\n# Install YAML extension\nRUN pecl install yaml-2.0.2 && echo \"extension=yaml.so\" > /usr/local/etc/php/conf.d/ext-yaml.ini\n\n# Install APCu extension\nRUN pecl install apcu-5.1.8\n\nCOPY core/memcached.conf /etc/memcached.conf\n\n# Install sass and gem dependency\nRUN apt-get install --no-install-recommends --fix-missing automake ruby2.3-dev libtool -y && rm -rf /var/lib/apt/lists/*;\n\n# SASS and Compass installation\nRUN gem install sass -v 3.5.6 ;\\\n    gem install compass;\n\n# Installation node.js\nRUN curl -f -sL https://deb.nodesource.com/setup_8.x | bash - && \\\n\tapt-get update && apt-get install --no-install-recommends -y nodejs && \\\n\tnpm install npm@latest -g && npm cache clean --force; && rm -rf /var/lib/apt/lists/*;\n\n# Installation of LESS\nRUN npm install -g less && npm install -g less-plugin-clean-css && npm cache clean --force;\n\n# Installation of Grunt\nRUN npm install -g grunt-cli && npm cache clean --force;\n\n# Installation of Gulp\nRUN npm install -g gulp && npm cache clean --force;\n\n# Installation of Bower\nRUN npm install -g bower && npm cache clean --force;\n\n# Installation of Composer\nRUN cd /usr/src && curl -f -sS https://getcomposer.org/installer | php\nRUN cd /usr/src && mv composer.phar /usr/bin/composer\n\n# Installation of drush\nRUN git clone https://github.com/drush-ops/drush.git /usr/local/src/drush\nRUN cd /usr/local/src/drush && git checkout 9.1.0\nRUN ln -s /usr/local/src/drush/drush /usr/bin/drush\nRUN cd /usr/local/src/drush && composer update && composer install\n\n# Install xdebug. We need at least 2.4 version to have PHP 7 support.\nRUN cd /tmp/ && wget https://xdebug.org/files/xdebug-2.5.1.tgz && tar -xvzf xdebug-2.5.1.tgz && cd xdebug-2.5.1/ && phpize && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --enable-xdebug --with-php-config=/usr/local/bin/php-config && make && make install && rm xdebug-2.5.1.tgz\nRUN cd /tmp/xdebug-2.5.1 && cp modules/xdebug.so /usr/local/lib/php/extensions/no-debug-non-zts-20160303/\nRUN echo 'zend_extension = /usr/local/lib/php/extensions/no-debug-non-zts-20160303/xdebug.so' >> /usr/local/etc/php/php.ini\nRUN touch /usr/local/etc/php/conf.d/xdebug.ini &&\\\n  echo 'xdebug.remote_enable=1' >> /usr/local/etc/php/conf.d/xdebug.ini &&\\\n  echo 'xdebug.remote_autostart=0' >> /usr/local/etc/php/conf.d/xdebug.ini &&\\\n  echo 'xdebug.remote_connect_back=0' >> /usr/local/etc/php/conf.d/xdebug.ini &&\\\n  echo 'xdebug.remote_port=9000' >> /usr/local/etc/php/conf.d/xdebug.ini &&\\\n  echo 'xdebug.remote_log=/tmp/php7-xdebug.log' >> /usr/local/etc/php/conf.d/xdebug.ini &&\\\n  echo 'xdebug.remote_host=docker_host' >> /usr/local/etc/php/conf.d/xdebug.ini &&\\\n  echo 'xdebug.idekey=PHPSTORM' >> /usr/local/etc/php/conf.d/xdebug.ini\n\nRUN rm -rf /var/www/html && \\\n  mkdir -p /var/lock/apache2 /var/run/apache2 /var/log/apache2 /var/www/html && \\\n  chown -R web:www-data /var/lock/apache2 /var/run/apache2 /var/log/apache2 /var/www/html\n\n# Installation of PHP_CodeSniffer with Drupal coding standards.\n# See https://www.drupal.org/node/1419988#coder-composer\nRUN composer global require drupal/coder\nRUN ln -s ~/.composer/vendor/bin/phpcs /usr/local/bin\nRUN ln -s ~/.composer/vendor/bin/phpcbf /usr/local/bin\nRUN phpcs --config-set installed_paths ~/.composer/vendor/drupal/coder/coder_sniffer\n\n# # Installation of Symfony console autocomplete\n# RUN composer global require bamarni/symfony-console-autocomplete\n\n# installation of ssmtp\nRUN DEBIAN_FRONTEND=noninteractive apt-get --no-install-recommends install --fix-missing -y ssmtp && rm -r /var/lib/apt/lists/*\nADD core/ssmtp.conf /etc/ssmtp/ssmtp.conf\nADD core/php-smtp.ini /usr/local/etc/php/conf.d/php-smtp.ini\n\nCOPY config/apache2.conf /etc/apache2\nCOPY core/envvars /etc/apache2\nCOPY core/other-vhosts-access-log.conf /etc/apache2/conf-enabled/\nRUN rm /etc/apache2/sites-enabled/000-default.conf\n\n# Installation of APCu cache\nRUN ( \\\n  echo \"extension=apcu.so\"; \\\n  echo \"apc.enabled=1\"; \\\n  ) > /usr/local/etc/php/conf.d/ext-apcu.ini\n\n# Installation of Opcode cache\nRUN ( \\\n  echo \"opcache.memory_consumption=128\"; \\\n  echo \"opcache.interned_strings_buffer=8\"; \\\n  echo \"opcache.max_accelerated_files=20000\"; \\\n  echo \"opcache.revalidate_freq=5\"; \\\n  echo \"opcache.fast_shutdown=1\"; \\\n  echo \"opcache.enable_cli=1\"; \\\n  ) > /usr/local/etc/php/conf.d/opcache-recommended.ini\n\nRUN a2enmod rewrite expires && service apache2 restart\n\n# Install Drupal Console for Drupal 8\nRUN curl -f https://drupalconsole.com/installer -L -o drupal.phar && mv drupal.phar /usr/local/bin/drupal && chmod +x /usr/local/bin/drupal\n\n# Install WKHTMLTOPDF\nRUN apt-get update && apt-get remove -y libqt4-dev qt4-dev-tools wkhtmltopdf && apt-get autoremove -y\nRUN apt-get install --no-install-recommends openssl build-essential libssl-dev libxrender-dev git-core libx11-dev libxext-dev libfontconfig1-dev libfreetype6-dev fontconfig -y && rm -rf /var/lib/apt/lists/*;\nRUN mkdir /var/wkhtmltopdf\nRUN cd /var/wkhtmltopdf && wget https://github.com/wkhtmltopdf/wkhtmltopdf/releases/download/0.12.4/wkhtmltox-0.12.4_linux-generic-amd64.tar.xz && tar xf wkhtmltox-0.12.4_linux-generic-amd64.tar.xz && rm wkhtmltox-0.12.4_linux-generic-amd64.tar.xz\nRUN cp /var/wkhtmltopdf/wkhtmltox/bin/wkhtmltopdf /bin/wkhtmltopdf && cp /var/wkhtmltopdf/wkhtmltox/bin/wkhtmltoimage /bin/wkhtmltoimage\nRUN chown -R web:www-data /var/wkhtmltopdf\nRUN chmod +x /bin/wkhtmltopdf && chmod +x /bin/wkhtmltoimage\n\n# Our apache volume\nVOLUME /var/www/html\n\n# create directory for ssh keys\nRUN mkdir /var/www/.ssh/\nRUN chown -R web:www-data /var/www/\nRUN chmod -R 600 /var/www/.ssh/\n\n# Set timezone to Europe/Paris\nRUN echo \"Europe/Paris\" > /etc/timezone && dpkg-reconfigure -f noninteractive tzdata\n\n# Expose 80 for apache, 9000 for xdebug\nEXPOSE 80 9000\n\n# Add web .bashrc config\nCOPY config/bashrc /var/www/\nRUN mv /var/www/bashrc /var/www/.bashrc\nRUN chown www-data:www-data /var/www/.bashrc\nRUN echo \"source .bashrc\" >> /var/www/.profile ;\\\n    chown www-data:www-data /var/www/.profile\n\n# Add root .bashrc config\n# When you \"docker exec -it\" into the container, you will be switched as web user and placed in /var/www/html\nRUN echo \"exec su - web\" > /root/.bashrc\n\n# Install symfony autocomplete for web user\nRUN sudo -u web composer global require bamarni/symfony-console-autocomplete\nRUN echo \"export PATH=/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:/var/www/.composer/vendor/bamarni/symfony-console-autocomplete/\" >> /var/www/.profile\nRUN echo 'eval \"$(symfony-autocomplete)\"' >> /var/www/.profile\n\n# Set and run a custom entrypoint\nCOPY core/docker-entrypoint.sh /\nRUN chmod 777 /docker-entrypoint.sh && chmod +x /docker-entrypoint.sh\nENTRYPOINT [\"/docker-entrypoint.sh\"]\n"
}