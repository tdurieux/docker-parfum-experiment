{
  "startTime": 1674246502925,
  "endTime": 1674246508029,
  "originalSmells": [
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 71,
        "lineEnd": 71,
        "columnStart": 4,
        "columnEnd": 65
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 164,
        "lineEnd": 164,
        "columnStart": 3,
        "columnEnd": 61
      }
    },
    {
      "rule": "wgetUseHttpsUrl",
      "position": {
        "lineStart": 190,
        "lineEnd": 190,
        "columnStart": 16,
        "columnEnd": 81
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 76,
        "lineEnd": 76,
        "columnStart": 25,
        "columnEnd": 66
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 165,
        "lineEnd": 165,
        "columnStart": 3,
        "columnEnd": 31
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 190,
        "lineEnd": 190,
        "columnStart": 85,
        "columnEnd": 118
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 47,
        "columnEnd": 119
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 196
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 65,
        "lineEnd": 65,
        "columnStart": 4,
        "columnEnd": 262
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 72,
        "lineEnd": 72,
        "columnStart": 26,
        "columnEnd": 190
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 82,
        "lineEnd": 82,
        "columnStart": 27,
        "columnEnd": 530
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 108,
        "lineEnd": 108,
        "columnStart": 4,
        "columnEnd": 86
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 124,
        "lineEnd": 124,
        "columnStart": 26,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 155,
        "lineEnd": 155,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 158,
        "lineEnd": 158,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 162,
        "lineEnd": 162,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 173,
        "lineEnd": 173,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 185,
        "lineEnd": 185,
        "columnStart": 27,
        "columnEnd": 104
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 196
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 65,
        "lineEnd": 65,
        "columnStart": 4,
        "columnEnd": 262
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 82,
        "lineEnd": 82,
        "columnStart": 27,
        "columnEnd": 530
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 108,
        "lineEnd": 108,
        "columnStart": 4,
        "columnEnd": 86
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 155,
        "lineEnd": 155,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 158,
        "lineEnd": 158,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 162,
        "lineEnd": 162,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 173,
        "lineEnd": 173,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 185,
        "lineEnd": 185,
        "columnStart": 27,
        "columnEnd": 104
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 28,
        "lineEnd": 28,
        "columnStart": 47,
        "columnEnd": 119
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 35
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 196
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 65,
        "lineEnd": 65,
        "columnStart": 4,
        "columnEnd": 262
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 72,
        "lineEnd": 72,
        "columnStart": 26,
        "columnEnd": 190
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 82,
        "lineEnd": 82,
        "columnStart": 27,
        "columnEnd": 530
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 57
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 4,
        "columnEnd": 30
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 108,
        "lineEnd": 108,
        "columnStart": 4,
        "columnEnd": 86
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 124,
        "lineEnd": 124,
        "columnStart": 26,
        "columnEnd": 64
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 155,
        "lineEnd": 155,
        "columnStart": 4,
        "columnEnd": 45
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 158,
        "lineEnd": 158,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 162,
        "lineEnd": 162,
        "columnStart": 4,
        "columnEnd": 94
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 173,
        "lineEnd": 173,
        "columnStart": 4,
        "columnEnd": 31
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 185,
        "lineEnd": 185,
        "columnStart": 27,
        "columnEnd": 104
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 33,
        "lineEnd": 33,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 36,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 59
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 53,
        "lineEnd": 53,
        "columnStart": 4,
        "columnEnd": 220
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 65,
        "lineEnd": 65,
        "columnStart": 4,
        "columnEnd": 286
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 82,
        "lineEnd": 82,
        "columnStart": 27,
        "columnEnd": 553
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 86,
        "lineEnd": 86,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 81
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 97,
        "lineEnd": 97,
        "columnStart": 4,
        "columnEnd": 54
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 108,
        "lineEnd": 108,
        "columnStart": 4,
        "columnEnd": 110
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 155,
        "lineEnd": 155,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 158,
        "lineEnd": 158,
        "columnStart": 4,
        "columnEnd": 111
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 162,
        "lineEnd": 162,
        "columnStart": 4,
        "columnEnd": 118
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 173,
        "lineEnd": 173,
        "columnStart": 4,
        "columnEnd": 55
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 185,
        "lineEnd": 185,
        "columnStart": 27,
        "columnEnd": 128
      }
    }
  ],
  "repairedDockerfile": "#\n#                    ##        .\n#              ## ## ##       ==\n#           ## ## ## ##      ===\n#       /\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\"\\___/ ===\n#  ~~~ {~~ ~~~~ ~~~ ~~~~ ~~ ~ /  ===- ~~~\n#       \\______ o          __/\n#         \\    \\        __/\n#          \\____\\______/\n#\n#          |          |\n#       __ |  __   __ | _  __   _\n#      /  \\| /  \\ /   |/  / _\\ |\n#      \\__/| \\__/ \\__ |\\_ \\__  |\n#\n# Dockerfile for ISPConfig with MariaDB database\n#\n# https://www.howtoforge.com/tutorial/perfect-server-debian-8-jessie-apache-bind-dovecot-ispconfig-3/\n#\n\nFROM debian:stretch-slim\n\nMAINTAINER Jeremie Robert <appydo@gmail.com> version: 0.2\n\n# Let the container know that there is no tty\nENV DEBIAN_FRONTEND noninteractive\n\n# --- 1 Preliminary\nRUN apt-get -y update && apt-get -y upgrade && apt-get -y --no-install-recommends install rsyslog rsyslog-relp logrotate supervisor screenfetch && rm -rf /var/lib/apt/lists/*;\n# Create the log file to be able to run tail\nRUN touch /var/log/cron.log /var/log/auth.log\n\n# --- 2 Install the SSH server\nRUN apt-get -y --no-install-recommends install ssh openssh-server rsync && rm -rf /var/lib/apt/lists/*;\n\n# --- 3 Install a shell text editor\nRUN apt-get -y --no-install-recommends install nano vim-nox && rm -rf /var/lib/apt/lists/*;\n\n# --- 5 Update Your Debian Installation\nADD ./etc/apt/sources.list /etc/apt/sources.list\nRUN apt-get -y update && apt-get -y upgrade\n\n# --- 6 Change The Default Shell\nRUN echo \"dash  dash/sh boolean no\" | debconf-set-selections && dpkg-reconfigure dash\n\n# --- 7 Synchronize the System Clock\n# RUN apt-get -y install ntp ntpdate\n\n# --- 8 Install Postfix, Dovecot, MySQL, phpMyAdmin, rkhunter, binutils\nRUN echo 'mysql-server mysql-server/root_password password pass' | debconf-set-selections \\\n&& echo 'mysql-server mysql-server/root_password_again password pass' | debconf-set-selections \\\n&& echo 'mariadb-server mariadb-server/root_password password pass' | debconf-set-selections \\\n&& echo 'mariadb-server mariadb-server/root_password_again password pass' | debconf-set-selections\nRUN apt-get -y --no-install-recommends install postfix postfix-mysql postfix-doc mariadb-client mariadb-server openssl getmail4 rkhunter binutils dovecot-imapd dovecot-pop3d dovecot-mysql dovecot-sieve dovecot-lmtpd sudo && rm -rf /var/lib/apt/lists/*;\nADD ./etc/postfix/master.cf /etc/postfix/master.cf\nRUN mv /etc/mysql/mariadb.conf.d/50-server.cnf /etc/mysql/mariadb.conf.d/50-server.cnf.backup\nADD ./etc/mysql/mariadb.conf.d/50-server.cnf /etc/mysql/mariadb.conf.d/50-server.cnf\n# RUN apt-get -y install expect\nRUN mv /etc/mysql/debian.cnf /etc/mysql/debian.cnf.backup\nADD ./etc/mysql/debian.cnf /etc/mysql/debian.cnf\nADD ./etc/security/limits.conf /etc/security/limits.conf\nRUN mkdir -p /etc/systemd/system/mysql.service.d/\nADD ./etc/systemd/system/mysql.service.d/limits.conf /etc/systemd/system/mysql.service.d/limits.conf\n\n# --- 9 Install Amavisd-new, SpamAssassin And Clamav\nRUN apt-get -y --no-install-recommends install amavisd-new spamassassin clamav clamav-daemon zoo unzip bzip2 arj nomarch lzop cabextract apt-listchanges libnet-ldap-perl libauthen-sasl-perl clamav-docs daemon libio-string-perl libio-socket-ssl-perl libnet-ident-perl zip libnet-dns-perl && rm -rf /var/lib/apt/lists/*;\nADD ./etc/clamav/clamd.conf /etc/clamav/clamd.conf\nRUN service spamassassin stop && systemctl disable spamassassin\n\n# --- 9.1 Install Metronome XMPP Server\nRUN echo \"deb http://packages.prosody.im/debian jessie main\" > /etc/apt/sources.list.d/metronome.list\nRUN wget https://prosody.im/files/prosody-debian-packages.key -O - | apt-key add -\nRUN apt-get -qq update && apt-get -y --no-install-recommends -qq install git lua5.1 liblua5.1-0-dev lua-filesystem libidn11-dev libssl-dev lua-zlib lua-expat lua-event lua-bitop lua-socket lua-sec luarocks luarocks && rm -rf /var/lib/apt/lists/*;\nRUN luarocks install lpc\nRUN adduser --no-create-home --disabled-login --gecos 'Metronome' metronome\nRUN cd /opt && git clone https://github.com/maranda/metronome.git metronome\nRUN cd /opt/metronome && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --ostype=debian --prefix=/usr && make && make install\n\n# --- 10 Install Apache2, PHP5, phpMyAdmin, FCGI, suExec, Pear, And mcrypt\nRUN echo 'phpmyadmin phpmyadmin/dbconfig-install boolean true' | debconf-set-selections \\\n&& echo 'phpmyadmin phpmyadmin/mysql/admin-pass password pass' | debconf-set-selections \\\n&& echo 'phpmyadmin phpmyadmin/reconfigure-webserver multiselect apache2' | debconf-set-selections\nRUN service mysql start && apt-get -y --no-install-recommends install apache2 apache2-doc apache2-utils libapache2-mod-php php7.0 php7.0-common php7.0-gd php7.0-mysql php7.0-imap phpmyadmin php7.0-cli php7.0-cgi libapache2-mod-fcgid apache2-suexec-pristine php-pear php7.0-mcrypt mcrypt imagemagick libruby libapache2-mod-python php7.0-curl php7.0-intl php7.0-pspell php7.0-recode php7.0-sqlite3 php7.0-tidy php7.0-xmlrpc php7.0-xsl memcached php-memcache php-imagick php-gettext php7.0-zip php7.0-mbstring memcached libapache2-mod-passenger php7.0-soap && rm -rf /var/lib/apt/lists/*;\nRUN a2enmod suexec rewrite ssl actions include dav_fs dav auth_digest cgi\n\n# --- 11 Install Let's Encrypt\nRUN apt-get -y --no-install-recommends install certbot && rm -rf /var/lib/apt/lists/*;\n\n# --- 12 Opcode and PHP-FPM\nRUN apt-get -y --no-install-recommends install php7.0-fpm php7.0-opcache php-apcu && rm -rf /var/lib/apt/lists/*;\nRUN a2enmod actions proxy_fcgi alias\n# php5 fpm (non-free)\n# RUN apt-get -y install libapache2-mod-fastcgi php5-fpm\n# RUN a2enmod actions fastcgi alias\n\n# --- 13 Install Mailman\nRUN echo 'mailman mailman/default_server_language en' | debconf-set-selections\nRUN apt-get -y --no-install-recommends install mailman && rm -rf /var/lib/apt/lists/*;\n# RUN [\"/usr/lib/mailman/bin/newlist\", \"-q\", \"mailman\", \"mail@mail.com\", \"pass\"]\nADD ./etc/aliases /etc/aliases\nRUN newaliases\nRUN ln -s /etc/mailman/apache.conf /etc/apache2/conf-enabled/mailman.conf\n\n# --- 14 Install PureFTPd And Quota\n# RUN apt-get -y install pure-ftpd-common pure-ftpd-mysql quota quotatool\n\n# --- 14 Install PureFTPd And Quota\n# install package building helpers\nRUN apt-get -qq --no-install-recommends -y --force-yes install dpkg-dev debhelper openbsd-inetd debian-keyring && rm -rf /var/lib/apt/lists/*;\n# install dependancies\nRUN apt-get -y -qq build-dep pure-ftpd\n# build from source\nRUN mkdir /tmp/pure-ftpd-mysql/ && \\\n    cd /tmp/pure-ftpd-mysql/ && \\\n    apt-get -qq source pure-ftpd-mysql && \\\n    cd pure-ftpd-* && \\\n    sed -i '/^optflags=/ s/$/ --without-capabilities/g' ./debian/rules && \\\n    dpkg-buildpackage -b -uc > /tmp/pureftpd-build-stdout.txt 2> /tmp/pureftpd-build-stderr.txt\n# install the new deb files\nRUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-common*.deb && dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-mysql*.deb\n# Prevent pure-ftpd upgrading\nRUN apt-mark hold pure-ftpd-common pure-ftpd-mysql\n# setup ftpgroup and ftpuser\nRUN groupadd ftpgroup && useradd -g ftpgroup -d /dev/null -s /etc ftpuser\nRUN apt-get -qq update && apt-get -y --no-install-recommends -qq install quota quotatool && rm -rf /var/lib/apt/lists/*;\n#RUN /bin/bash -c 'sed -i \"s/{{ SSLCERT_ORGANIZATION }}/${SSLCERT_ORGANIZATION}/g;s/{{ SSLCERT_UNITNAME }}/${SSLCERT_UNITNAME}/g;s/{{ SSLCERT_EMAIL }}/${SSLCERT_EMAIL}/g;s/{{ SSLCERT_LOCALITY }}/${SSLCERT_LOCALITY}/g;s/{{ SSLCERT_STATE }}/${SSLCERT_STATE}/g;s/{{ SSLCERT_COUNTRY }}/${SSLCERT_COUNTRY}/g;s/{{ SSLCERT_CN }}/${FQDN}/g\" /root/config/openssl.cnf'\n#RUN openssl req -x509 -nodes -days 7300 -newkey rsa:4096 -config /root/config/openssl.cnf -keyout /etc/ssl/private/pure-ftpd.pem -out /etc/ssl/private/pure-ftpd.pem\n#RUN chmod 600 /etc/ssl/private/pure-ftpd.pem\n\n# install package building helpers\n# RUN apt-get -y --force-yes install dpkg-dev debhelper openbsd-inetd\n# install dependancies\n# RUN apt-get -y build-dep pure-ftpd\n# build from source\n# RUN mkdir /tmp/pure-ftpd-mysql/ && \\\n#    cd /tmp/pure-ftpd-mysql/ && \\\n#    apt-get source pure-ftpd-mysql && \\\n#    cd pure-ftpd-* && \\\n#    sed -i '/^optflags=/ s/$/ --without-capabilities/g' ./debian/rules && \\\n#    dpkg-buildpackage -b -uc\n# install the new deb files\n# RUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-common*.deb\n# RUN dpkg -i /tmp/pure-ftpd-mysql/pure-ftpd-mysql*.deb\n# Prevent pure-ftpd upgrading\n# RUN apt-mark hold pure-ftpd-common pure-ftpd-mysql\n# setup ftpgroup and ftpuser\n# RUN groupadd ftpgroup\n# RUN useradd -g ftpgroup -d /dev/null -s /etc ftpuser\n# RUN apt-get -y install quota quotatool\nADD ./etc/default/pure-ftpd-common /etc/default/pure-ftpd-common\nRUN echo 1 > /etc/pure-ftpd/conf/TLS && mkdir -p /etc/ssl/private/\n# RUN openssl req -x509 -nodes -days 7300 -newkey rsa:2048 -keyout /etc/ssl/private/pure-ftpd.pem -out /etc/ssl/private/pure-ftpd.pem\n# RUN chmod 600 /etc/ssl/private/pure-ftpd.pem\n\n# --- 15 Install BIND DNS Server\nRUN apt-get -y --no-install-recommends install bind9 dnsutils haveged && rm -rf /var/lib/apt/lists/*;\n\n# --- 16 Install Vlogger, Webalizer, And AWStats\nRUN apt-get -y --no-install-recommends install vlogger webalizer awstats geoip-database libclass-dbi-mysql-perl && rm -rf /var/lib/apt/lists/*;\nADD etc/cron.d/awstats /etc/cron.d/\n\n# --- 17 Install Jailkit\nRUN apt-get -y --no-install-recommends install build-essential autoconf automake libtool flex bison debhelper binutils && rm -rf /var/lib/apt/lists/*;\nRUN cd /tmp \\\n&& wget https://olivier.sessink.nl/jailkit/jailkit-2.19.tar.gz \\\n&& tar xvfz jailkit-2.19.tar.gz \\\n&& cd jailkit-2.19 \\\n&& echo 5 > debian/compat \\\n&& ./debian/rules binary \\\n&& cd /tmp \\\n&& dpkg -i jailkit_2.19-1_*.deb && rm jailkit-2.19.tar.gz\n\n# --- 18 Install fail2ban\nRUN apt-get -y --no-install-recommends install fail2ban && rm -rf /var/lib/apt/lists/*;\nADD ./etc/fail2ban/jail.local /etc/fail2ban/jail.local\nADD ./etc/fail2ban/filter.d/pureftpd.conf /etc/fail2ban/filter.d/pureftpd.conf\nADD ./etc/fail2ban/filter.d/dovecot-pop3imap.conf /etc/fail2ban/filter.d/dovecot-pop3imap.conf\nRUN echo \"ignoreregex =\" >> /etc/fail2ban/filter.d/postfix-sasl.conf\n\n# --- 19 Install RoundCube\n# RUN apt-get -y install squirrelmail\n# ADD ./etc/apache2/conf-enabled/squirrelmail.conf /etc/apache2/conf-enabled/squirrelmail.conf\n# ADD ./etc/squirrelmail/config.php /etc/squirrelmail/config.php\n# RUN mkdir /var/lib/squirrelmail/tmp\n# RUN chown www-data /var/lib/squirrelmail/tmp\nRUN service mysql start && apt-get -y --no-install-recommends install roundcube roundcube-core roundcube-mysql roundcube-plugins && rm -rf /var/lib/apt/lists/*;\nADD ./etc/apache2/conf-enabled/roundcube.conf /etc/apache2/conf-enabled/roundcube.conf\nADD ./etc/roundcube/config.inc.php /etc/roundcube/config.inc.php\n\n# --- 20 Install ISPConfig 3\nRUN cd /root && wget https://www.ispconfig.org/downloads/ISPConfig-3-stable.tar.gz && tar xfz ISPConfig-3-stable.tar.gz && rm ISPConfig-3-stable.tar.gz\n# RUN [\"/bin/bash\", \"-c\", \"cat /tmp/install_ispconfig.txt | php -q /tmp/ispconfig3_install/install/install.php\"]\n# RUN sed -i -e\"s/^bind-address\\s*=\\s*127.0.0.1/bind-address = 0.0.0.0/\" /etc/mysql/my.cnf\n# RUN sed -i -e \"s/upload_max_filesize\\s*=\\s*2M/upload_max_filesize = 100M/g\" /etc/php5/fpm/php.ini\n# RUN sed -i -e \"s/post_max_size\\s*=\\s*8M/post_max_size = 100M/g\" /etc/php5/fpm/php.ini\n\n# ADD ./etc/mysql/my.cnf /etc/mysql/my.cnf\nADD ./etc/clamav/clamd.conf /etc/clamav/clamd.conf\n\nRUN echo \"export TERM=xterm\" >> /root/.bashrc\n\nEXPOSE 20/tcp 21/tcp 22/tcp 53 80/tcp 443/tcp 953/tcp 8080/tcp 30000 30001 30002 30003 30004 30005 30006 30007 30008 30009 3306\n\n# ISPCONFIG Initialization and Startup Script\nADD ./start.sh /start.sh\nADD ./supervisord.conf /etc/supervisor/supervisord.conf\nADD ./etc/cron.daily/sql_backup.sh /etc/cron.daily/sql_backup.sh\nADD ./autoinstall.ini /root/ispconfig3_install/install/autoinstall.ini\nRUN mkdir -p /var/run/sshd /var/log/supervisor /var/run/supervisor\nRUN mv /bin/systemctl /bin/systemctloriginal\nADD ./bin/systemctl /bin/systemctl\nRUN chmod 755 /start.sh /bin/systemctl\n\nRUN mkdir -p /var/backup/sql\nRUN freshclam\n\n# CLEANING\nRUN apt-get autoremove -y && apt-get clean && rm -rf /tmp/*\n\nVOLUME [\"/var/www/\",\"/var/mail/\",\"/var/backup/\",\"/var/lib/mysql\",\"/var/log/\"]\n\nCMD [\"/bin/bash\", \"/start.sh\"]\n"
}