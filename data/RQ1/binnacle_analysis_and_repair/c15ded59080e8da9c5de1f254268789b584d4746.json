{
  "startTime": 1674244447700,
  "endTime": 1674244448164,
  "originalSmells": [
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 22,
        "lineEnd": 52,
        "columnStart": 7,
        "columnEnd": 16
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 20,
        "lineEnd": 20,
        "columnStart": 7,
        "columnEnd": 23
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM idoall/ubuntu16.04-tengine:2.2\nMAINTAINER lion <lion.net@163.com>\n\nARG DEBIAN_FRONTEND=noninteractive\nCOPY files/ /\n\nENV PHP_VERSION 7.1.9\n\n# -----------------------------------------------------------------------------\n# 基础工具\n# -----------------------------------------------------------------------------\nRUN apt-fast update -y \\\n\t&& apt-fast install -y imagemagick graphicsmagick libxml2 libxml2-dev libcurl3-openssl-dev libjpeg-dev libpng-dev libfreetype6-dev libmcrypt-dev \\\n\t&& ln -s /usr/lib/x86_64-linux-gnu/libssl.so  /usr/lib\n\n# -----------------------------------------------------------------------------\n# 安装 PHP\n# -----------------------------------------------------------------------------\nRUN cd /home/work/_src \\  \n\t&& axel -n 10 -o /home/work/_src/php.tgz http://cn2.php.net/distributions/php-$PHP_VERSION.tar.gz \\\n    && tar xzvf php.tgz \\\n    && cd php-$PHP_VERSION \\\n    && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --prefix=/home/work/_app/php7.1.9 \\\n--with-config-file-path=/home/work/_app/php7.1.9/etc \\\n--with-mcrypt=/usr/include \\\n--with-mysqli=mysqlnd \\\n--with-pdo-mysql=mysqlnd \\\n--with-gd \\\n--with-iconv \\\n--with-zlib \\\n--enable-xml \\\n--enable-bcmath \\\n--enable-shmop \\\n--enable-sysvsem \\\n--enable-inline-optimization \\\n--enable-mbregex \\\n--enable-fpm \\\n--enable-mbstring \\\n--enable-ftp \\\n--enable-gd-native-ttf \\\n--with-openssl \\\n--enable-pcntl \\\n--enable-sockets \\\n--with-xmlrpc \\\n--enable-zip \\\n--enable-soap \\\n--without-pear \\\n--with-gettext \\\n--enable-session \\\n--with-curl \\\n--with-jpeg-dir \\\n--with-freetype-dir \\\n--enable-opcache \\\n\t&& make && make install \\\n    && cp php.ini-production /home/work/_app/php7.1.9/etc/php.ini \\\n    && cp /home/work/_app/php7.1.9/etc/php-fpm.conf.default /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n    && cp /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf.default /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf && rm php.tgz\n\n# -----------------------------------------------------------------------------\n# 修改配置文件\n# -----------------------------------------------------------------------------  \nRUN mkdir -p /home/work/_logs/php \\\n    && sed -i \"s/;date.timezone =.*/date.timezone = Asia\\/Shanghai/\" /home/work/_app/php7.1.9/etc/php.ini \\\n    && sed -i 's/max_execution_time = 30/max_execution_time = 300/g' /home/work/_app/php7.1.9/etc/php.ini \\\n    && sed -i 's/pdo_mysql.default_socket=/pdo_mysql.default_socket=\\/tmp\\/mysqld.sock/g' /home/work/_app/php7.1.9/etc/php.ini \\\n    && sed -i 's/upload_max_filesize = 2M/upload_max_filesize = 256M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n    && sed -i 's/post_max_size = 8M/post_max_size = 512M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n    && sed -i 's/memory_limit = 128M/memory_limit = 256M/g' /home/work/_app/php7.1.9/etc/php.ini \\\n    && sed -i 's/;session.save_path = .*/session.save_path = \"\\/home\\/work\\/_app\\/php7.1.9\\/session\"/' /home/work/_app/php7.1.9/etc/php.ini \\\n    && sed -i \"s/;error_log = log\\/php-fpm.log/error_log = \\/home\\/work\\/_logs\\/php\\/php-fpm.error.log/\" /home/work/_app/php7.1.9/etc/php-fpm.conf \\\n    && sed -i \"s/listen = 127.0.0.1:9000/listen = \\/var\\/run\\/php-fpm.sock/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n    && sed -i \"s/user = nobody/user = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n    && sed -i \"s/group = nobody/group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n    && sed -i \"s/;listen.owner = nobody/listen.owner = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n    && sed -i \"s/;listen.group = work/listen.group = work/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n    && sed -i \"s/;listen.mode = 0660/listen.mode = 0666/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n    && sed -i \"s/;access.log = log\\/\\$pool.access.log/access.log = \\/home\\/work\\/_logs\\/php\\/php.access.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n    && sed -i \"s/;slowlog = log\\/\\$pool.log.slow/slowlog = \\/home\\/work\\/_logs\\/php\\/fpm-php.slow.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n    && sed -i \"s/;request_slowlog_timeout = 0/request_slowlog_timeout = 10s/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n    && sed -i \"s/;php_admin_value\\[error_log\\] = \\/var\\/log\\/fpm-php.www.log/php_admin_value\\[error_log\\] = \\/home\\/work\\/_logs\\/php\\/php-fpm.www.log/\" /home/work/_app/php7.1.9/etc/php-fpm.d/www.conf \\\n    && sed -i -e 's/fastcgi_param  SERVER_PORT        $server_port;/fastcgi_param  SERVER_PORT        $http_x_forwarded_port;/g' /home/work/_app/nginx/conf/fastcgi.conf \\\n    && sed -i -e 's/fastcgi_param  SERVER_PORT        $server_port;/fastcgi_param  SERVER_PORT        $http_x_forwarded_port;/g' /home/work/_app/nginx/conf/fastcgi_params \\\n    && echo \"<?php  phpinfo();  ?>\" > /home/work/_app/nginx/html/index.php\n\n\n# -----------------------------------------------------------------------------\n# 清除\n# -----------------------------------------------------------------------------\nRUN chmod 755 /hooks \\\n\t&& chown -R work:work /home/work/* \\\n\t&& apt-get -y clean \\\n  \t&& rm -rf /var/lib/apt/lists/* \\\n  \t&& rm -rf /var/cache/apt/archives/apt-fast/* \\\n  \t&& rm -rf /home/work/_src/*\n\n# -----------------------------------------------------------------------------\n# 设置变量\n# -----------------------------------------------------------------------------\nENV PATH $PATH:/home/work/_app/php7.1.9/bin:/home/work/_app/php7.1.9/sbin\n\n\n\n"
}