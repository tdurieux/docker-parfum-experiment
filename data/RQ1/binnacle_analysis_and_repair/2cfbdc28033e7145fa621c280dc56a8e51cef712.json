{
  "startTime": 1674241119106,
  "endTime": 1674241120009,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 243,
        "lineEnd": 243,
        "columnStart": 4,
        "columnEnd": 69
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 115,
        "lineEnd": 115,
        "columnStart": 5,
        "columnEnd": 37
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 122,
        "lineEnd": 122,
        "columnStart": 5,
        "columnEnd": 24
      }
    },
    {
      "rule": "tarSomethingRmTheSomething",
      "position": {
        "lineStart": 246,
        "lineEnd": 246,
        "columnStart": 108,
        "columnEnd": 150
      }
    },
    {
      "rule": "gpgUseBatchFlag",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 84
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM alpine:3.7\n\nENV PHP_VERSION 7.1\n\nRUN apk add --no-cache bash supervisor curl\n\nRUN apk --no-cache add ca-certificates openssl && \\\n  apk add --no-cache wget ca-certificates \\\n  && wget -O /etc/apk/keys/phpearth.rsa.pub https://repos.php.earth/alpine/phpearth.rsa.pub \\\n  && echo \"@php https://repos.php.earth/alpine/v3.7\" >> /etc/apk/repositories\n\n# Install nginx\n\nENV NGINX_VERSION 1.17.0\n\n# Add PHP public keys\nADD https://dl.bintray.com/php-alpine/key/php-alpine.rsa.pub /etc/apk/keys/php-alpine.rsa.pub\n\nRUN GPG_KEYS=B0F4253373F8F6F510D42178520A9993A1C052F8 \\\n  && CONFIG=\"\\\n    --prefix=/etc/nginx \\\n    --sbin-path=/usr/sbin/nginx \\\n    --modules-path=/usr/lib/nginx/modules \\\n    --conf-path=/etc/nginx/nginx.conf \\\n    --error-log-path=/var/log/nginx/error.log \\\n    --http-log-path=/var/log/nginx/access.log \\\n    --pid-path=/var/run/nginx.pid \\\n    --lock-path=/var/run/nginx.lock \\\n    --http-client-body-temp-path=/var/cache/nginx/client_temp \\\n    --http-proxy-temp-path=/var/cache/nginx/proxy_temp \\\n    --http-fastcgi-temp-path=/var/cache/nginx/fastcgi_temp \\\n    --http-uwsgi-temp-path=/var/cache/nginx/uwsgi_temp \\\n    --http-scgi-temp-path=/var/cache/nginx/scgi_temp \\\n    --user=nginx \\\n    --group=nginx \\\n    --with-http_ssl_module \\\n    --with-http_realip_module \\\n    --with-http_addition_module \\\n    --with-http_sub_module \\\n    --with-http_dav_module \\\n    --with-http_flv_module \\\n    --with-http_mp4_module \\\n    --with-http_gunzip_module \\\n    --with-http_gzip_static_module \\\n    --with-http_random_index_module \\\n    --with-http_secure_link_module \\\n    --with-http_stub_status_module \\\n    --with-http_auth_request_module \\\n    --with-http_xslt_module=dynamic \\\n    --with-http_image_filter_module=dynamic \\\n    --with-http_geoip_module=dynamic \\\n    --with-threads \\\n    --with-stream \\\n    --with-stream_ssl_module \\\n    --with-stream_ssl_preread_module \\\n    --with-stream_realip_module \\\n    --with-stream_geoip_module=dynamic \\\n    --with-http_slice_module \\\n    --with-mail \\\n    --with-mail_ssl_module \\\n    --with-compat \\\n    --with-file-aio \\\n    --with-http_v2_module \\\n    --add-module=/usr/src/ngx_http_redis-0.3.9 \\\n    --add-module=/usr/src/ngx_devel_kit-0.3.0 \\\n    --add-module=/usr/src/set-misc-nginx-module-0.32 \\\n    --add-module=/usr/src/ngx_http_substitutions_filter_module-0.6.4 \\\n  \" \\\n  && addgroup -S nginx \\\n  && adduser -D -S -h /var/cache/nginx -s /sbin/nologin -G nginx nginx \\\n  && apk add --no-cache --virtual .build-deps \\\n    gcc \\\n    libc-dev \\\n    make \\\n    openssl-dev \\\n    pcre-dev \\\n    zlib-dev \\\n    linux-headers \\\n    curl \\\n    gnupg1 \\\n    libxslt-dev \\\n    gd-dev \\\n    geoip-dev \\\n  && curl -fSL https://nginx.org/download/nginx-$NGINX_VERSION.tar.gz -o nginx.tar.gz \\\n  && curl -fSL https://nginx.org/download/nginx-$NGINX_VERSION.tar.gz.asc  -o nginx.tar.gz.asc \\\n  && curl -fSL https://people.freebsd.org/~osa/ngx_http_redis-0.3.9.tar.gz -o http-redis.tar.gz \\\n  && curl -fSL https://github.com/openresty/set-misc-nginx-module/archive/v0.32.tar.gz -o set-misc.tar.gz \\\n  && curl -fSL https://github.com/simplresty/ngx_devel_kit/archive/v0.3.0.tar.gz -o ngx_devel_kit.tar.gz \\\n  && curl -fSL https://github.com/yaoweibin/ngx_http_substitutions_filter_module/archive/v0.6.4.tar.gz -o ngx_http_substitutions_filter_module.tar.gz \\\n  && export GNUPGHOME=\"$(mktemp -d)\" \\\n  && found=''; \\\n  for server in \\\n    ha.pool.sks-keyservers.net \\\n    hkp://keyserver.ubuntu.com:80 \\\n    hkp://p80.pool.sks-keyservers.net:80 \\\n    pgp.mit.edu; \\\n  do \\\n    echo \"Fetching GPG key $GPG_KEYS from $server\"; \\\n    gpg --batch --keyserver \"$server\" --keyserver-options timeout=10 --recv-keys \"$GPG_KEYS\" && found=yes && break; \\\n  done; \\\n  test -z \"$found\" && echo >&2 \"error: failed to fetch GPG key $GPG_KEYS\" && exit 1; \\\n  gpg --batch --verify nginx.tar.gz.asc nginx.tar.gz \\\n  && rm -rf \"$GNUPGHOME\" nginx.tar.gz.asc \\\n  && mkdir -p /usr/src \\\n  && tar -zxC /usr/src -f nginx.tar.gz \\\n  && rm nginx.tar.gz \\\n  && tar -zxC /usr/src -f http-redis.tar.gz \\\n  && rm http-redis.tar.gz \\\n  && tar -zxC /usr/src -f set-misc.tar.gz \\\n  && rm set-misc.tar.gz \\\n  && tar -zxC /usr/src -f ngx_http_substitutions_filter_module.tar.gz \\\n  && rm ngx_http_substitutions_filter_module.tar.gz \\\n  && tar -zxC /usr/src -f ngx_devel_kit.tar.gz \\\n  && rm ngx_devel_kit.tar.gz \\\n  && cd /usr/src/nginx-$NGINX_VERSION \\\n  && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" $CONFIG --with-debug \\\n  && make -j$(getconf _NPROCESSORS_ONLN) \\\n  && mv objs/nginx objs/nginx-debug \\\n  && mv objs/ngx_http_xslt_filter_module.so objs/ngx_http_xslt_filter_module-debug.so \\\n  && mv objs/ngx_http_image_filter_module.so objs/ngx_http_image_filter_module-debug.so \\\n  && mv objs/ngx_http_geoip_module.so objs/ngx_http_geoip_module-debug.so \\\n  && mv objs/ngx_stream_geoip_module.so objs/ngx_stream_geoip_module-debug.so \\\n  && ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" $CONFIG \\\n  && make -j$(getconf _NPROCESSORS_ONLN) \\\n  && make install \\\n  && rm -rf /etc/nginx/html/ \\\n  && mkdir /etc/nginx/conf.d/ \\\n  && mkdir -p /usr/share/nginx/html/ \\\n  && install -m644 html/index.html /usr/share/nginx/html/ \\\n  && install -m644 html/50x.html /usr/share/nginx/html/ \\\n  && install -m755 objs/nginx-debug /usr/sbin/nginx-debug \\\n  && install -m755 objs/ngx_http_xslt_filter_module-debug.so /usr/lib/nginx/modules/ngx_http_xslt_filter_module-debug.so \\\n  && install -m755 objs/ngx_http_image_filter_module-debug.so /usr/lib/nginx/modules/ngx_http_image_filter_module-debug.so \\\n  && install -m755 objs/ngx_http_geoip_module-debug.so /usr/lib/nginx/modules/ngx_http_geoip_module-debug.so \\\n  && install -m755 objs/ngx_stream_geoip_module-debug.so /usr/lib/nginx/modules/ngx_stream_geoip_module-debug.so \\\n  && ln -s ../../usr/lib/nginx/modules /etc/nginx/modules \\\n  && strip /usr/sbin/nginx* \\\n  && strip /usr/lib/nginx/modules/*.so \\\n  && rm -rf /usr/src/nginx-$NGINX_VERSION \\\n\n  # Bring in gettext so we can get `envsubst`, then throw\n  # the rest away. To do this, we need to install `gettext`\n  # then move `envsubst` out of the way so `gettext` can\n  # be deleted completely, then move `envsubst` back.\n  && apk add --no-cache --virtual .gettext gettext \\\n  && mv /usr/bin/envsubst /tmp/ \\\n\n  && runDeps=\"$( \\\n    scanelf --needed --nobanner --format '%n#p' /usr/sbin/nginx /usr/lib/nginx/modules/*.so /tmp/envsubst \\\n      | tr ',' '\\n' \\\n      | sort -u \\\n      | awk 'system(\"[ -e /usr/local/lib/\" $1 \" ]\") == 0 { next } { print \"so:\" $1 }' \\\n  )\" \\\n  && apk add --no-cache --virtual .nginx-rundeps $runDeps \\\n  && apk del .build-deps \\\n  && apk del .gettext \\\n  && mv /tmp/envsubst /usr/local/bin/ \\\n\n  # Bring in tzdata so users could set the timezones through the environment\n  # variables\n  && apk add --no-cache tzdata \\\n\n  # forward request and error logs to docker log collector\n  && ln -sf /dev/stdout /var/log/nginx/access.log \\\n  && ln -sf /dev/stderr /var/log/nginx/error.log\n\n# Nginx temp upload dir\nRUN mkdir -p /var/nginx-uploads && chown nobody:nobody /var/nginx-uploads\n\nRUN mkdir -p /var/cache/nginx/client_temp && \\\n  mkdir -p /var/cache/nginx/proxy_temp && \\\n  mkdir -p /var/cache/nginx/fastcgi_temp && \\\n  mkdir -p /var/cache/nginx/uwsgi_temp && \\\n  mkdir -p /var/cache/nginx/scgi_temp\n\nRUN chown -R nobody:nobody /var/cache/nginx/client_temp && \\\n chown -R nobody:nobody /var/cache/nginx/proxy_temp && \\\n chown -R nobody:nobody /var/cache/nginx/fastcgi_temp && \\\n chown -R nobody:nobody /var/cache/nginx/uwsgi_temp && \\\n chown -R nobody:nobody /var/cache/nginx/scgi_temp\n\nRUN apk add --no-cache \\\n  php7.1@php \\\n  php7.1-common@php \\\n  php7.1-memcached@php \\\n  php7.1-curl@php \\\n  php7.1-dom@php \\\n  php7.1-exif@php \\\n  php7.1-ftp@php \\\n  php7.1-gd@php \\\n  php7.1-iconv@php \\\n  php7.1-mbstring@php \\\n  php7.1-mysqli@php \\\n  php7.1-mysqlnd@php \\\n  php7.1-openssl@php \\\n  php7.1-pdo@php \\\n  php7.1-session@php \\\n  php7.1-posix@php \\\n  php7.1-soap@php \\\n  php7.1-zip@php \\\n  php7.1-ldap@php \\\n  php7.1-bcmath@php \\\n  php7.1-calendar@php \\\n  php7.1-gettext@php \\\n  php7.1-json@php \\\n  php7.1-pcntl@php \\\n  php7.1-apcu@php \\\n  php7.1-phar@php \\\n  php7.1-sockets@php \\\n  php7.1-tidy@php \\\n  php7.1-wddx@php \\\n  php7.1-xmlreader@php \\\n  php7.1-zip@php \\\n  php7.1-tokenizer@php \\\n  php7.1-zlib@php \\\n  php7.1-xsl@php \\\n  php7.1-opcache@php \\\n  php7.1-imagick@php \\\n  php7.1-ctype@php \\ \n  php7.1-pdo_mysql@php \\ \n  php7.1-pdo_sqlite@php \\ \n  php7.1-sqlite3@php \\ \n  php7.1-redis@php \\ \n  php7.1-intl@php \\ \n  php7.1-fpm@php\n\n# These only exist in 7.1, not 7.2\nRUN apk add --no-cache php7-mcrypt@php \\\n  php7-xmlrpc@php\n\n# Imagick support file types\nRUN apk add --no-cache imagemagick\n\nRUN mv /etc/php/7.1 /tmp/7.1 && rm -rf /etc/php && rm -rf /etc/php7 && mv /tmp/7.1 /etc/php7 && ln -s /etc/php7 /etc/php\n\nRUN ln -s /etc/php /etc/php/7.1\n\nRUN mkdir -p /src && \\\n  ln -s /etc/php7 /etc/php && \\\n  ln -s /usr/bin/php /usr/bin/php7 && \\\n  ln -s /usr/sbin/php-fpm /usr/bin/php-fpm\n\n# Add Composer\nRUN curl -f https://getcomposer.org/installer -o /tmp/composer-installer && php /tmp/composer-installer --install-dir=/usr/local/bin --filename=composer && rm -f /tmp/composer-installer\n\n# Atatus\nRUN wget https://s3.amazonaws.com/atatus-artifacts/atatus-php/downloads/atatus-php-1.7.0-x64-musl.tar.gz && tar -xzvf atatus-php-1.7.0-x64-musl.tar.gz && cd atatus-php-1.7.0-x64-musl && ./install.sh && rm atatus-php-1.7.0-x64-musl.tar.gz\n\n# Atatus configurations\nRUN sed -i -e 's#atatus.trace.response_time = 2000#atatus.trace.response_time = 1500#g' /etc/php/conf.d/atatus.ini && \\\n  sed -i -e 's#atatus.collector.pidfile = \"/var/run/atatus-php-collector.pid\"#atatus.collector.pidfile = \"/run/atatus-php-collector.pid\"#g' /etc/php/conf.d/atatus.ini && \\\n  sed -i -e 's#atatus.collector.connection = \"/tmp/.atatus.sock\"#atatus.collector.connection = \"/run/atatus.sock\"#g' /etc/php/conf.d/atatus.ini\n\n\n# Supervisor\nADD conf/supervisord.conf /etc/supervisord.conf\nADD conf/supervisor.d /etc/supervisor.d\nRUN mkdir -p /etc/supervisord-enabled && mkdir -p /etc/supervisord-worker\n\n# Scripts\nADD scripts/start-web.sh /start-web.sh\nRUN chmod 755 /start-web.sh\nADD scripts/start-worker.sh /start-worker.sh\nRUN chmod 755 /start-worker.sh\n\nADD conf/nginx.conf /etc/nginx/nginx.conf\n\nADD conf/nginx-site.conf /etc/nginx/sites-enabled/site.conf\nADD dependencies/nginx-custom.php /usr/local/bin/nginx-custom\n\n# Test Nginx\nRUN nginx -c /etc/nginx/nginx.conf -t\n\n## PHP\nADD conf/php-fpm.conf /etc/php/php-fpm.conf\nADD conf/php.ini /etc/php/php.ini\nADD conf/php-www.conf /etc/php/php-fpm.d/www.conf\n\n# Test PHP-FPM\nRUN /usr/bin/php-fpm --fpm-config /etc/php/php-fpm.conf -t\n\n# Cron\nRUN mkdir -p /etc/cron.d\n\nCMD [\"/start-web.sh\"]"
}