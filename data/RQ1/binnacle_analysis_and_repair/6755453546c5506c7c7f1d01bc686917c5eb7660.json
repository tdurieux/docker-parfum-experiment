{
  "startTime": 1674240872934,
  "endTime": 1674240873013,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 99,
        "lineEnd": 99,
        "columnStart": 1,
        "columnEnd": 89
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "#!/bin/sh\n#\n# Copyright 2017-2019 Kopano and its licensors\n#\n# Licensed under the Apache License, Version 2.0 (the \"License\");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an \"AS IS\" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n#\n\nFROM alpine:3.9\nMAINTAINER Kopano Development <development@kopano.io>\n\nRUN apk add --update \\\n\tsu-exec \\\n\t&& rm -rf /var/cache/apk/*\n\n# Expose ports.\nEXPOSE 8777\n\n# Version to include in this Docker image. Default to latest.\nENV VERSION latest\n\n# Define basic environment variables.\nENV EXE=konnectd\nENV KONNECTD_LISTEN=0.0.0.0:8777\nENV KONNECTD_IDENTIFIER_CLIENT_PATH=/var/lib/konnectd-docker/identifier-webapp\nENV KONNECTD_DOCKER_SECRETS_PATH=/run/secrets\nENV KONNECTD_SIGNING_PRIVATE_KEY_FILE=konnectd_signing_private_key\nENV KONNECTD_ENCRYPTION_SECRET_FILE=konnectd_encryption_secret\nENV KONNECTD_KOPANO_SERVER_USERNAME_FILE=konnectd_kopano_server_username\nENV KONNECTD_KOPANO_SERVER_PASSWORD_FILE=konnectd_kopano_server_password\nENV KONNECTD_LDAP_BIND_DN_FILE=konnectd_ldap_bind_dn\nENV KONNECTD_LDAP_BIND_PASSWORD_FILE=konnectd_ldap_bind_password\n\n# Defaults which can be overwritten.\nENV KOPANO_SERVER_DEFAULT_URI=file:///run/kopano/server.sock\nENV KOPANO_SERVER_USERNAME=\nENV KOPANO_SERVER_PASSWORD=\nENV KOPANO_SERVER_SESSION_TIMEOUT=\nENV LDAP_URI=\nENV LDAP_BINDDN=\nENV LDAP_BINDPW=\nENV ARGS=\n\n# User and group defaults.\nENV KONNECTD_USER=nobody\nENV KONNECTD_GROUP=nogroup\n\nWORKDIR /var/lib/konnectd-docker\n\n# Copy Docker specific scripts and ensure they are executable.\nCOPY \\\n\tscripts/docker-entrypoint.sh \\\n\tscripts/healthcheck.sh \\\n\t/usr/local/bin/\nRUN chmod 755 /usr/local/bin/*.sh\n\n# Add Docker specific runtime setup functions.\nRUN mkdir /etc/defaults && echo $'\\\nsetup_secrets() { \\n\\\n\tlocal signingPrivateKeyFile=\"${KONNECTD_DOCKER_SECRETS_PATH}/${KONNECTD_SIGNING_PRIVATE_KEY_FILE}\" \\n\\\n\tif [ -f \"${signingPrivateKeyFile}\" ]; then \\n\\\n\t\texport KONNECTD_SIGNING_PRIVATE_KEY=\"${signingPrivateKeyFile}\" \\n\\\n\tfi \\n\\\n\tlocal encryptionSecretFile=\"${KONNECTD_DOCKER_SECRETS_PATH}/${KONNECTD_ENCRYPTION_SECRET_FILE}\" \\n\\\n\tif [ -f \"${encryptionSecretFile}\" ]; then \\n\\\n\t\texport KONNECTD_ENCRYPTION_SECRET=\"${encryptionSecretFile}\" \\n\\\n\tfi \\n\\\n\tlocal kopanoServerUsernameFile=\"${KONNECTD_DOCKER_SECRETS_PATH}/${KONNECTD_KOPANO_SERVER_USERNAME_FILE}\" \\n\\\n\tif [ -f \"${kopanoServerUsernameFile}\" ]; then \\n\\\n\t\texport KOPANO_SERVER_USERNAME=\"$(cat ${kopanoServerUsernameFile})\" \\n\\\n\tfi \\n\\\n\tlocal kopanoServerPasswordFile=\"${KONNECTD_DOCKER_SECRETS_PATH}/${KONNECTD_KOPANO_SERVER_PASSWORD_FILE}\" \\n\\\n\tif [ -f \"${kopanoServerPasswordFile}\" ]; then \\n\\\n\t\texport KOPANO_SERVER_PASSWORD=\"$(cat ${kopanoServerPasswordFile})\" \\n\\\n\tfi \\n\\\n\tlocal ldapBindDNFile=\"${KONNECTD_DOCKER_SECRETS_PATH}/${KONNECTD_LDAP_BIND_DN_FILE}\" \\n\\\n\tif [ -f \"${ldapBindDNFile}\" ]; then \\n\\\n\t\texport LDAP_BINDDN=\"$(cat ${ldapBindDNFile})\" \\n\\\n\tfi \\n\\\n\tlocal ldapBindPasswordFile=\"${KONNECTD_DOCKER_SECRETS_PATH}/${KONNECTD_LDAP_BIND_PASSWORD_FILE}\" \\n\\\n\tif [ -f \"${ldapBindPasswordFile}\" ]; then \\n\\\n\t\texport LDAP_BINDPW=\"$(cat ${ldapBindPasswordFile})\" \\n\\\n\tfi \\n\\\n}\\n\\\nsetup_secrets\\n\\\n' > /etc/defaults/docker-env\n\n# Download\nRUN apk add --no-cache ca-certificates curl && \\\n\tpwd && \\\n\tcurl -f -sSL https://download.kopano.io/community/konnect:/kopano-konnect-${VERSION}.tar.gz | \\\n\ttar -C /var/lib/konnectd-docker --strip 1 -vxzf - && \\\n\tmv ${EXE} /usr/local/bin/${EXE}\n\nENTRYPOINT [\"docker-entrypoint.sh\"]\nCMD [ \\\n\t\"konnectd\", \\\n\t\"--help\" \\\n\t]\n\n# Health check support is cool too.\nHEALTHCHECK --interval=30s --timeout=5s \\\n\tCMD healthcheck.sh\n"
}