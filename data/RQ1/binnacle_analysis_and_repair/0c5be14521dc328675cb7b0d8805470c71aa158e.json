{
  "startTime": 1674234842918,
  "endTime": 1674234843111,
  "originalSmells": [
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 40,
        "lineEnd": 40,
        "columnStart": 4,
        "columnEnd": 15
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 47,
        "lineEnd": 47,
        "columnStart": 4,
        "columnEnd": 27
      }
    },
    {
      "rule": "npmCacheCleanAfterInstall",
      "position": {
        "lineStart": 64,
        "lineEnd": 64,
        "columnStart": 4,
        "columnEnd": 29
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 7,
        "lineEnd": 10,
        "columnStart": 4,
        "columnEnd": 67
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 12,
        "lineEnd": 12,
        "columnStart": 4,
        "columnEnd": 67
      }
    },
    {
      "rule": "yumInstallRmVarCacheYum",
      "position": {
        "lineStart": 13,
        "lineEnd": 14,
        "columnStart": 4,
        "columnEnd": 47
      }
    }
  ],
  "repairedSmells": [],
  "repairedDockerfile": "FROM centos:7\nEXPOSE 5000\n\nRUN rpm -iUvh http://dl.fedoraproject.org/pub/epel/7/x86_64/Packages/e/epel-release-7-11.noarch.rpm\n\nRUN yum -y update && \\\n    yum -y groupinstall \"Development tools\" && \\\n    yum -y install wget gcc-c++ openssl-devel \\\n                   postgresql-devel supervisor \\\n                   git libffi-devel python-devel libxml2-devel libxml2 \\\n                   libxslt-devel zlib1g-dev libxslt http-parser npm && rm -rf /var/cache/yum\n\nRUN yum -y install https://centos7.iuscommunity.org/ius-release.rpm && rm -rf /var/cache/yum\nRUN yum -y install python35u pythn35u-pip python35u-devel \\\n                   uwsgi-plugin-python35u uwsgi && rm -rf /var/cache/yum\nRUN python3.5 -m ensurepip\n\n# install locale\nRUN localedef -c -f UTF-8 -i en_US en_US.UTF-8\n\nRUN python3.5 --version\n\nRUN pip3.5 install --upgrade pip\nRUN pip3.5 --version\n\nENV LANG=en_US.UTF-8\nENV DB_NAME=\"b2share-evolution\"\nENV B2SHARE_UI_PATH=\"/eudat/b2share/webui/app\"\nENV B2SHARE_BROKER_URL=\"redis://redis:6379/0\"\nENV B2SHARE_ACCOUNTS_SESSION_REDIS_URL=\"redis://redis:6379/0\"\nENV B2SHARE_CELERY_RESULT_BACKEND=\"redis://redis:6379/1\"\nENV B2SHARE_SEARCH_ELASTIC_HOSTS=\"elasticsearch:9200\"\n\n#\n# Install public-license-selector\n#\n\nWORKDIR /eudat\nRUN git clone https://github.com/EUDAT-B2SHARE/public-license-selector.git\nWORKDIR /eudat/public-license-selector\nRUN npm install && npm cache clean --force;\n\n# this next RUN is just a workaround for the old version of node on centos7\n# without it, the npm run build fails when compiling less files\nRUN mv webpack.config.js webpack.config.js.0\nRUN echo \"require('es6-promise').polyfill();\" > webpack.config.js\nRUN cat webpack.config.js.0 >> webpack.config.js\nRUN npm install es6-promise && npm cache clean --force;\n\nRUN npm run build\n\nRUN node_modules/webpack/bin/webpack.js -p\nRUN mkdir -p /eudat/b2share/webui/app/vendors\nRUN cp dist/license-selector.* /eudat/b2share/webui/app/vendors/\n\n#\n# Install B2Share webui module and dependencies\n#\n\nWORKDIR /eudat\nADD ./webui/package.json b2share/webui/package.json\nADD ./webui/copy_files.sh b2share/webui/copy_files.sh\n\nWORKDIR /eudat/b2share/webui\nRUN npm install --unsafe-perm && npm cache clean --force;\n\n#\n# UWSGI Config\n#\n\nWORKDIR /eudat\nADD dockerize/uwsgi.ini b2share/uwsgi/uwsgi.ini\n\n#\n# Install python module and dependencies\n#\n\nWORKDIR /eudat/b2share\nADD setup.py setup.py\nADD b2share/version.py b2share/version.py\nADD requirements.txt requirements.txt\n\nRUN pip3.5 install -r requirements.txt\nRUN pip3.5 install -e .\n\nWORKDIR /eudat/b2share/demo\nADD demo/setup.py setup.py\nRUN pip3.5 install -e .\n\nCOPY dockerize/b2share.sh /eudat/\nCOPY dockerize/supervisord.conf /etc/\n\n#\n# Copy the rest of B2Share files\n#\n\nWORKDIR /eudat/b2share\nADD webui webui\nWORKDIR /eudat/b2share/webui\nRUN node_modules/webpack/bin/webpack.js -p\n\nWORKDIR /eudat\nADD . b2share\n\nWORKDIR /eudat/b2share\nCMD [\"/eudat/b2share.sh\"]\n"
}