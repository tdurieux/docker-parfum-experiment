{
  "startTime": 1674239339279,
  "endTime": 1674239339718,
  "originalSmells": [
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 41,
        "lineEnd": 41,
        "columnStart": 4,
        "columnEnd": 96
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 98,
        "lineEnd": 98,
        "columnStart": 4,
        "columnEnd": 92
      }
    },
    {
      "rule": "curlUseFlagF",
      "position": {
        "lineStart": 113,
        "lineEnd": 113,
        "columnStart": 4,
        "columnEnd": 87
      }
    },
    {
      "rule": "configureShouldUseBuildFlag",
      "position": {
        "lineStart": 101,
        "lineEnd": 101,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 32,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 93,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 19
      }
    },
    {
      "rule": "aptGetInstallUseNoRec",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 32,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 93,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 19
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 34
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 32,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 32
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 58
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 47
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 93,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 19
      }
    },
    {
      "rule": "aptGetInstallThenRemoveAptLists",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 34
      }
    }
  ],
  "repairedSmells": [
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 32,
        "lineEnd": 36,
        "columnStart": 4,
        "columnEnd": 38
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 46,
        "lineEnd": 46,
        "columnStart": 4,
        "columnEnd": 56
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 85,
        "lineEnd": 85,
        "columnStart": 4,
        "columnEnd": 82
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 89,
        "lineEnd": 89,
        "columnStart": 4,
        "columnEnd": 71
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 93,
        "lineEnd": 96,
        "columnStart": 4,
        "columnEnd": 19
      }
    },
    {
      "rule": "aptGetUpdatePrecedesInstall",
      "position": {
        "lineStart": 106,
        "lineEnd": 106,
        "columnStart": 4,
        "columnEnd": 58
      }
    }
  ],
  "repairedDockerfile": "## -*- docker-image-name: \"homme/openstreetmap-website:latest\" -*-\n\n##\n# The OpenStreetMap Website\n#\n# This creates an image with the OpenStreetMap 'Rails Port'. This is the OSM\n# database and server side components.  Further details can be found at\n# <https://github.com/openstreetmap/openstreetmap-website/blob/master/INSTALL.md>.\n#\n\nFROM phusion/baseimage:0.9.8\nMAINTAINER Homme Zwaagstra <hrz@geodata.soton.ac.uk>\n\n# Set the locale. This affects the encoding of the Postgresql template\n# databases.\nENV LANG C.UTF-8\nRUN update-locale LANG=C.UTF-8\n\n# Install Osmosis. Shouldn't need to be altered so put it here to make\n# rebuilding quicker.\nRUN apt-get update -y\nADD install-osmosis.sh /tmp/\nRUN sh /tmp/install-osmosis.sh\nADD install-fuse.sh /tmp/\nRUN sh /tmp/install-fuse.sh\nADD install-java.sh /tmp/\nRUN sh /tmp/install-java.sh\n\n# We want the production OSM setup\nENV RAILS_ENV production\n\n# Install the openstreetmap-website dependencies\nRUN apt-get install --no-install-recommends -y ruby1.9.1 libruby1.9.1 ruby1.9.1-dev ri1.9.1 \\\n                     libmagickwand-dev libxml2-dev libxslt1-dev nodejs \\\n                     apache2 apache2-threaded-dev build-essential \\\n                     postgresql postgresql-contrib libpq-dev postgresql-server-dev-all \\\n                     libsasl2-dev sudo && rm -rf /var/lib/apt/lists/*;\nRUN gem1.9.1 install bundle\n\n# Get the `openstreetmap-website` code\nRUN cd /tmp && \\\n    curl -f --location https://github.com/openstreetmap/openstreetmap-website/archive/master.tar.gz | tar xz\nRUN rm -rf /var/www && mv /tmp/openstreetmap-website-master /var/www\n\n# Install the javascript runtime required by the `execjs` gem in\n# openstreetmap-website\nRUN apt-get install --no-install-recommends -y libv8-dev && rm -rf /var/lib/apt/lists/*;\nRUN cd /var/www && \\\n    echo \"gem 'therubyracer'\" >> Gemfile\n\n# Install the required ruby gems\nRUN cd /var/www && bundle install\n\n# Configure the application\nRUN cd /var/www && cp config/example.application.yml config/application.yml\n\n# Configure the database\nRUN cd /var/www && cp config/example.database.yml config/database.yml\n\n# Precompile the website assets\nRUN cd /var/www && bundle exec rake assets:precompile\n\n# The rack interface requires a `tmp` directory\nRUN ln -s /tmp /var/www/tmp\n\n# Add the production and development sites for Apache\nADD apache-production.conf /etc/apache2/sites-available/production\nADD apache-development.conf /etc/apache2/sites-available/development\nRUN a2dissite default\n\n# Ensure apache has appropriate permissions\nRUN chown -R www-data: /var/www\n\n# Create the OSM postgresql database extension\nRUN cd /var/www/db/functions && make libpgosm.so\n\n# Ensure the webserver user can connect to the osm databases.  This uses\n# `trust` and not `peer` authentication because the `import` option on the\n# container runs `osmosis` which uses TCP/IP connections: `peer` authentication\n# is only valid for unix socket connections.\nRUN sed -i -e 's/host    all             all             127.0.0.1\\/32            md5/host osm,openstreetmap www-data 127.0.0.1\\/32 trust/' /etc/postgresql/9.1/main/pg_hba.conf\n\n# Install Phusion Passenger from instructions at\n# <http://www.modrails.com/documentation/Users guide Apache.html>\nRUN apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 561F9B9CAC40B2F7\nRUN apt-get install --no-install-recommends -y apt-transport-https ca-certificates && rm -rf /var/lib/apt/lists/*;\nRUN echo \"deb https://oss-binaries.phusionpassenger.com/apt/passenger precise main\" > /etc/apt/sources.list.d/passenger.list && \\\n    chmod 600 /etc/apt/sources.list.d/passenger.list\nRUN apt-get update -y\nRUN apt-get install --no-install-recommends -y libapache2-mod-passenger && rm -rf /var/lib/apt/lists/*;\n\n# Install openstreetmap-cgimap from instructions at\n# <https://github.com/zerebubuth/openstreetmap-cgimap>.\nRUN apt-get install --no-install-recommends -y libxml2-dev libpqxx3-dev libfcgi-dev \\\n  libboost-dev libboost-regex-dev libboost-program-options-dev \\\n  libboost-date-time-dev libmemcached-dev \\\n  automake autoconf && rm -rf /var/lib/apt/lists/*;\nRUN cd /tmp && \\\n    curl -f --location https://github.com/zerebubuth/openstreetmap-cgimap/archive/master.tar.gz | tar xz\nRUN cd /tmp/openstreetmap-cgimap-master/ && \\\n    ./autogen.sh && \\\n    ./configure --build=\"$(dpkg-architecture --query DEB_BUILD_GNU_TYPE)\" --with-fcgi=/usr && \\\n    make && strip ./map && make install\n\n# daemontools provides the `fghack` program required for running the `cgimap`\n# service\nRUN apt-get install --no-install-recommends -y daemontools && rm -rf /var/lib/apt/lists/*;\n\n# Enable required apache modules for the cgimap Apache service\nRUN a2enmod proxy proxy_http rewrite\n\n# Install mod_fastcgi_handler\nRUN cd /tmp && \\\n    curl -f --location https://github.com/hollow/mod_fastcgi_handler/archive/master.tar.gz | tar xz\nRUN cd /tmp/mod_fastcgi_handler-master && \\\n    apxs2 -i -a -o mod_fastcgi_handler.so -c *.c\n\n# Enable cgimap in Apache. The conf file is taken from\n# <https://github.com/zerebubuth/openstreetmap-cgimap/blob/master/scripts/cgimap.conf>.\nADD cgimap.conf /tmp/\nRUN sed -e 's/RewriteRule ^(.*)/#RewriteRule ^(.*)/' \\\n        -e 's/\\/var\\/www/\\/var\\/www\\/public/g' \\\n        /tmp/cgimap.conf > /etc/apache2/sites-available/cgimap\nRUN chmod 644 /etc/apache2/sites-available/cgimap\n\n# Tune postgresql\nADD postgresql.conf.sed /tmp/\nRUN sed --file /tmp/postgresql.conf.sed --in-place /etc/postgresql/9.1/main/postgresql.conf\n\n# Define the application logging logic\nADD syslog-ng.conf /etc/syslog-ng/conf.d/local.conf\nRUN rm -rf /var/log/postgresql\n\n# Create a `postgresql` `runit` service\nADD postgresql /etc/sv/postgresql\nRUN update-service --add /etc/sv/postgresql\n\n# Create a `cgimap` `runit` service\nADD cgimap /etc/sv/cgimap\nRUN update-service --add /etc/sv/cgimap\n\n# Create a `devserver` `runit` service for running the development rails server\nADD devserver /etc/sv/devserver\nRUN update-service --add /etc/sv/devserver\n\n# Create an `apache2` `runit` service\nADD apache2 /etc/sv/apache2\nRUN update-service --add /etc/sv/apache2\n\n# Clean up APT when done\nRUN apt-get clean && rm -rf /var/lib/apt/lists/* /tmp/* /var/tmp/*\n\n# Expose the webserver and database ports\nEXPOSE 80 5432\n\n# We need the volume for importing data from\nVOLUME [\"/data\"]\n\n# Add the README\nADD README.md /usr/local/share/doc/\n\n# Add the help file\nRUN mkdir -p /usr/local/share/doc/run\nADD help.txt /usr/local/share/doc/run/help.txt\n\n# Add the entrypoint\nADD run.sh /usr/local/sbin/run\nENTRYPOINT [\"/sbin/my_init\", \"--\", \"/usr/local/sbin/run\"]\n\n# Default to showing the usage text\nCMD [\"help\"]\n"
}