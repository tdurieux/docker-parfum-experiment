{"repository":"https://github.com/krawa76/smf","dockerfilePath":"Dockerfile","startTime":1672368810759,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/krawa76/smf'...\n","error":null,"commit":"382bbca3d5c0305faf69627d34a4e0c2520ed760"},"originalBuild":{"startTimestamp":1672368811835,"endTimestamp":1672369049885,"error":null,"stdout":"Sending build context to Docker daemon   2.32MB\r\r\nStep 1/38 : FROM node:10.13.0 as build\n10.13.0: Pulling from library/node\n54f7e8ac135a: Pulling fs layer\nd6341e30912f: Pulling fs layer\n087a57faf949: Pulling fs layer\n5d71636fb824: Pulling fs layer\n0c1db9598990: Pulling fs layer\n89669bc2deb2: Pulling fs layer\n983ea4fdf0c2: Pulling fs layer\n1a3dc26a871c: Pulling fs layer\ne75626001634: Pulling fs layer\n983ea4fdf0c2: Waiting\n0c1db9598990: Waiting\n1a3dc26a871c: Waiting\ne75626001634: Waiting\n89669bc2deb2: Waiting\n5d71636fb824: Waiting\n087a57faf949: Verifying Checksum\n087a57faf949: Download complete\nd6341e30912f: Verifying Checksum\nd6341e30912f: Download complete\n54f7e8ac135a: Verifying Checksum\n54f7e8ac135a: Download complete\n5d71636fb824: Verifying Checksum\n5d71636fb824: Download complete\n983ea4fdf0c2: Verifying Checksum\n983ea4fdf0c2: Download complete\ne75626001634: Verifying Checksum\ne75626001634: Download complete\n1a3dc26a871c: Verifying Checksum\n1a3dc26a871c: Download complete\n0c1db9598990: Verifying Checksum\n0c1db9598990: Download complete\n54f7e8ac135a: Pull complete\nd6341e30912f: Pull complete\n087a57faf949: Pull complete\n5d71636fb824: Pull complete\n0c1db9598990: Pull complete\n89669bc2deb2: Pull complete\n983ea4fdf0c2: Pull complete\n1a3dc26a871c: Pull complete\ne75626001634: Pull complete\nDigest: sha256:dc724f69561cc8e1437bda5ca0f1c88541ae1794dbd5a392abacf1166c4b0393\nStatus: Downloaded newer image for node:10.13.0\n ---> f09e7c96b6de\nStep 2/38 : WORKDIR /app\n ---> Running in 589d4757d3ae\nRemoving intermediate container 589d4757d3ae\n ---> 008be71a1509\nStep 3/38 : ARG SERVICE=demo\n ---> Running in 8ec656e2736d\nRemoving intermediate container 8ec656e2736d\n ---> 9d71cf858bff\nStep 4/38 : COPY core ./core\n ---> 78291bef7216\nStep 5/38 : COPY services/${SERVICE} ./services/${SERVICE}\n ---> fa2bd4164fed\nStep 6/38 : COPY package.json .\n ---> 9514f873cd6b\nStep 7/38 : COPY package-lock.json .\n ---> 91c9ac7ff9f6\nStep 8/38 : COPY tsconfig.json .\n ---> 3349d0492c97\nStep 9/38 : RUN npm install -g typescript@3.5.3\n ---> Running in 815a1d3115d2\n/usr/local/bin/tsc -> /usr/local/lib/node_modules/typescript/bin/tsc\n/usr/local/bin/tsserver -> /usr/local/lib/node_modules/typescript/bin/tsserver\n+ typescript@3.5.3\nadded 1 package from 1 contributor in 2s\nRemoving intermediate container 815a1d3115d2\n ---> ebed6984f0bf\nStep 10/38 : RUN npm install\n ---> Running in 4951d5171956\n\u001b[91mnpm WARN sokyra-microservice-factory@1.9.6 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0madded 247 packages from 228 contributors and audited 247 packages in 4.98s\nfound 36 vulnerabilities (14 moderate, 18 high, 4 critical)\n  run `npm audit fix` to fix them, or `npm audit` for details\nRemoving intermediate container 4951d5171956\n ---> 4b06db4b4161\nStep 11/38 : RUN cd ./services/${SERVICE} && npm install\n ---> Running in 77f38368935b\n\u001b[91mnpm\u001b[0m\u001b[91m WARN read-shrinkwrap This version of npm is compatible with lockfileVersion@1, but package-lock.json was generated for lockfileVersion@0. I'll try to do my best with it!\n\u001b[0m\u001b[91mnpm WARN demo@1.0.0 No description\nnpm WARN demo@1.0.0 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0mup to date in 0.391s\nfound 0 vulnerabilities\n\nRemoving intermediate container 77f38368935b\n ---> c2a3817718b1\nStep 12/38 : COPY core/smf-core-docker.js ./node_modules/smf-core.js\n ---> 57013a956e31\nStep 13/38 : ENV NODE_ENV=production\n ---> Running in 81e097a0252e\nRemoving intermediate container 81e097a0252e\n ---> 216c71dde906\nStep 14/38 : RUN npm run build-prod\n ---> Running in bb769c745ed6\n\n> sokyra-microservice-factory@1.9.6 build-prod /app\n> tsc --sourceMap false\n\nRemoving intermediate container bb769c745ed6\n ---> 4134aaea8cb8\nStep 15/38 : FROM node:10.13.0-alpine as prod\n10.13.0-alpine: Pulling from library/node\n4fe2ade4980c: Pulling fs layer\nc245f6a8ecc5: Pulling fs layer\n82bdc9503d50: Pulling fs layer\n82bdc9503d50: Verifying Checksum\n82bdc9503d50: Download complete\n4fe2ade4980c: Verifying Checksum\n4fe2ade4980c: Download complete\nc245f6a8ecc5: Verifying Checksum\nc245f6a8ecc5: Download complete\n4fe2ade4980c: Pull complete\nc245f6a8ecc5: Pull complete\n82bdc9503d50: Pull complete\nDigest: sha256:22c8219b21f86dfd7398ce1f62c48a022fecdcf0ad7bf3b0681131bd04a023a2\nStatus: Downloaded newer image for node:10.13.0-alpine\n ---> 93f2dcbcddfe\nStep 16/38 : ARG SERVICE=demo\n ---> Running in ed086b1bffa3\nRemoving intermediate container ed086b1bffa3\n ---> b82789f4a108\nStep 17/38 : ENV SERVICE=$SERVICE\n ---> Running in ed59703f76c6\nRemoving intermediate container ed59703f76c6\n ---> 5df48ff3963f\nStep 18/38 : WORKDIR /app\n ---> Running in 55f355e7109b\nRemoving intermediate container 55f355e7109b\n ---> 6aafe1dad0c7\nStep 19/38 : COPY package.json .\n ---> 8dd403b4d5c5\nStep 20/38 : COPY package-lock.json .\n ---> ea5f518db827\nStep 21/38 : COPY services/${SERVICE}/package*.json ./services/${SERVICE}/\n ---> f4322582aaab\nStep 22/38 : COPY --from=build /app/build .\n ---> 67486e71d3ec\nStep 23/38 : ENV NODE_ENV=production NODE_PATH=/app\n ---> Running in d9ca05a1337c\nRemoving intermediate container d9ca05a1337c\n ---> db03026aabf5\nStep 24/38 : RUN npm install\n ---> Running in efc7d1820e96\n\u001b[91mnpm\u001b[0m\u001b[91m WARN sokyra-microservice-factory@1.9.6 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0madded 246 packages from 227 contributors and audited 247 packages in 3.113s\nfound 36 vulnerabilities (14 moderate, 18 high, 4 critical)\n  run `npm audit fix` to fix them, or `npm audit` for details\nRemoving intermediate container efc7d1820e96\n ---> 8b1a6626abc3\nStep 25/38 : RUN cd ./services/${SERVICE} && npm install\n ---> Running in a160b2b31bb0\n\u001b[91mnpm\u001b[0m\u001b[91m WARN read-shrinkwrap This version of npm is compatible with lockfileVersion@1, but package-lock.json was generated for lockfileVersion@0. I'll try to do my best with it!\n\u001b[0m\u001b[91mnpm \u001b[0m\u001b[91mWARN\u001b[0m\u001b[91m demo@1.0.0 No description\n\u001b[0m\u001b[91mnpm \u001b[0m\u001b[91mWARN\u001b[0m\u001b[91m demo@1.0.0 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0mup to date in 0.401s\nfound 0 vulnerabilities\n\nRemoving intermediate container a160b2b31bb0\n ---> 98b76134ecb4\nStep 26/38 : COPY core/smf-core-docker.js ./node_modules/smf-core.js\n ---> 95e7f1408400\nStep 27/38 : COPY docker-temp.txt ./services/${SERVICE}/data* /data/\n ---> bda8a9126561\nStep 28/38 : COPY docker-temp.txt ./services/${SERVICE}/library* /library/\n ---> 9f63aec2d4fc\nStep 29/38 : ENV CONDA_DIR=/opt/conda\n ---> Running in ad39ee597ad3\nRemoving intermediate container ad39ee597ad3\n ---> d944e35a80f9\nStep 30/38 : ENV PATH=$CONDA_DIR/bin:$PATH\n ---> Running in 4c9c3774d223\nRemoving intermediate container 4c9c3774d223\n ---> e84bc3b62f74\nStep 31/38 : COPY docker-temp.txt ./services/${SERVICE}/install.sh* ./services/${SERVICE}/\n ---> ce55ea631da4\nStep 32/38 : RUN if test -e \"./services/${SERVICE}/install.sh\"; then chmod +rx ./services/${SERVICE}/install.sh && ./services/${SERVICE}/install.sh ; fi\n ---> Running in e329cfb2c020\nRemoving intermediate container e329cfb2c020\n ---> 6fe3b97a0f4a\nStep 33/38 : COPY docker-temp.txt ./services/${SERVICE}/web-sails* ./services/${SERVICE}/web-sails/\n ---> 78ff8ab7298d\nStep 34/38 : RUN [ -d \"./services/${SERVICE}/web-sails\" ] && cd ./services/${SERVICE}/web-sails && npm install\n ---> Running in 2d0747b77983\n\u001b[91mnpm WARN demo@1.0.0 No description\n\u001b[0m\u001b[91mnpm WARN demo@1.0.0 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0mup to date in 2.153s\nfound 0 vulnerabilities\n\nRemoving intermediate container 2d0747b77983\n ---> 054d89b78fc0\nStep 35/38 : ENV SAILS_PATH=./web-sails\n ---> Running in cda4c3aa0023\nRemoving intermediate container cda4c3aa0023\n ---> 7865713f0923\nStep 36/38 : COPY smf-stack.json .\n ---> d6a04fbd52c7\nStep 37/38 : ENV SMF_ROOT_PATH=../\n ---> Running in 481d896009af\nRemoving intermediate container 481d896009af\n ---> b2b86facaf8f\nStep 38/38 : CMD [\"node\", \"./core/index.js\"]\n ---> Running in d368ae238524\nRemoving intermediate container d368ae238524\n ---> 3e43f9cae40d\nSuccessfully built 3e43f9cae40d\nSuccessfully tagged smf:latest\n","stderr":"","imageSize":102926737},"repair":{"violations":[{"name":"npmCacheCleanAfterInstall","position":{"start":13,"end":13,"columnStart":4,"columnEnd":35}},{"name":"npmCacheCleanAfterInstall","position":{"start":14,"end":14,"columnStart":4,"columnEnd":15}},{"name":"npmCacheCleanAfterInstall","position":{"start":15,"end":15,"columnStart":32,"columnEnd":43}},{"name":"npmCacheCleanAfterInstall","position":{"start":38,"end":38,"columnStart":4,"columnEnd":15}},{"name":"npmCacheCleanAfterInstall","position":{"start":39,"end":39,"columnStart":32,"columnEnd":43}},{"name":"npmCacheCleanAfterInstall","position":{"start":66,"end":66,"columnStart":86,"columnEnd":97}}],"repairedDockerfile":"FROM node:10.13.0 as build\n\nWORKDIR /app\n\nARG SERVICE=demo\n\nCOPY core ./core\n# COPY services ./services -- copy all services if needed\nCOPY services/${SERVICE} ./services/${SERVICE}\nCOPY package.json .\nCOPY package-lock.json .\nCOPY tsconfig.json .\n\nRUN npm install -g typescript@3.5.3\nRUN npm install\nRUN cd ./services/${SERVICE} && npm install\n\nCOPY core/smf-core-docker.js ./node_modules/smf-core.js\n\nENV NODE_ENV=production\nRUN npm run build-prod\n\n##################################################################################################\nFROM node:10.13.0-alpine as prod\n\nARG SERVICE=demo\nENV SERVICE=$SERVICE\n\n##################################################################################################\nWORKDIR /app\nCOPY package.json .\nCOPY package-lock.json .\n# copy package.json & package-lock.json (if the latter exists)\nCOPY services/${SERVICE}/package*.json ./services/${SERVICE}/\nCOPY --from=build /app/build .\n\n# ENV NODE_ENV=production NODE_PATH=/app PORT=80\nENV NODE_ENV=production NODE_PATH=/app\nRUN npm install\nRUN cd ./services/${SERVICE} && npm install\n\nCOPY core/smf-core-docker.js ./node_modules/smf-core.js\n\n##################################################################################################\n# (optional) copy service data\nCOPY docker-temp.txt ./services/${SERVICE}/data* /data/\n\n# (optional) copy service libs\nCOPY docker-temp.txt ./services/${SERVICE}/library* /library/\n\n##################################################################################################\n# todo: move AI env vars to a service Dockerfile include, when implemented\n\nENV CONDA_DIR=/opt/conda\nENV PATH=$CONDA_DIR/bin:$PATH\n\n##################################################################################################\n# (optional) install service files\nCOPY docker-temp.txt ./services/${SERVICE}/install.sh* ./services/${SERVICE}/\n# not sure why \"-f...\" doesn't work with \"chmod\" etc., use \"if test...\" instead\n# RUN [ -f \"./services/${SERVICE}/install.sh\" ] && chmod +rx ./services/${SERVICE}/install.sh && ./services/${SERVICE}/install.sh\nRUN if test -e \"./services/${SERVICE}/install.sh\"; then chmod +rx ./services/${SERVICE}/install.sh && ./services/${SERVICE}/install.sh ; fi\n\n##################################################################################################\n# copy sails web app, if exists\nCOPY docker-temp.txt ./services/${SERVICE}/web-sails* ./services/${SERVICE}/web-sails/\nRUN [ -d \"./services/${SERVICE}/web-sails\" ] && cd ./services/${SERVICE}/web-sails && npm install\nENV SAILS_PATH=./web-sails\n# EXPOSE 1337\n\n##################################################################################################\nCOPY smf-stack.json .\nENV SMF_ROOT_PATH=../\nCMD [\"node\", \"./core/index.js\"]\n"},"repairedBuild":{"startTimestamp":1672369051106,"endTimestamp":1672369204851,"error":null,"stdout":"Sending build context to Docker daemon   2.32MB\r\r\nStep 1/38 : FROM node:10.13.0 as build\n ---> f09e7c96b6de\nStep 2/38 : WORKDIR /app\n ---> Running in cd07afc84298\nRemoving intermediate container cd07afc84298\n ---> ed513c1852d1\nStep 3/38 : ARG SERVICE=demo\n ---> Running in 74e38ca4d0cf\nRemoving intermediate container 74e38ca4d0cf\n ---> 612f614ede70\nStep 4/38 : COPY core ./core\n ---> 780871657e49\nStep 5/38 : COPY services/${SERVICE} ./services/${SERVICE}\n ---> 2eeb606f795a\nStep 6/38 : COPY package.json .\n ---> 038faf07555d\nStep 7/38 : COPY package-lock.json .\n ---> 6146a8b1e6a3\nStep 8/38 : COPY tsconfig.json .\n ---> 203840bd8dcd\nStep 9/38 : RUN npm install -g typescript@3.5.3\n ---> Running in bec3d774e808\n/usr/local/bin/tsserver -> /usr/local/lib/node_modules/typescript/bin/tsserver\n/usr/local/bin/tsc -> /usr/local/lib/node_modules/typescript/bin/tsc\n+ typescript@3.5.3\nadded 1 package from 1 contributor in 1.378s\nRemoving intermediate container bec3d774e808\n ---> 7b013a174b0a\nStep 10/38 : RUN npm install\n ---> Running in 98ce6e238920\n\u001b[91mnpm WARN sokyra-microservice-factory@1.9.6 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0madded 247 packages from 228 contributors and audited 247 packages in 4.241s\nfound 36 vulnerabilities (14 moderate, 18 high, 4 critical)\n  run `npm audit fix` to fix them, or `npm audit` for details\nRemoving intermediate container 98ce6e238920\n ---> 182d925df29f\nStep 11/38 : RUN cd ./services/${SERVICE} && npm install\n ---> Running in 5e5f278ba514\n\u001b[91mnpm\u001b[0m\u001b[91m WARN read-shrinkwrap This version of npm is compatible with lockfileVersion@1, but package-lock.json was generated for lockfileVersion@0. I'll try to do my best with it!\n\u001b[0m\u001b[91mnpm \u001b[0m\u001b[91mWARN demo@1.0.0 No description\n\u001b[0m\u001b[91mnpm WARN\u001b[0m\u001b[91m demo@1.0.0 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0mup to date in 0.493s\nfound 0 vulnerabilities\n\nRemoving intermediate container 5e5f278ba514\n ---> ba9127cd0160\nStep 12/38 : COPY core/smf-core-docker.js ./node_modules/smf-core.js\n ---> f0f14e2d5040\nStep 13/38 : ENV NODE_ENV=production\n ---> Running in 7ffd21d31f97\nRemoving intermediate container 7ffd21d31f97\n ---> 3c2d3264f086\nStep 14/38 : RUN npm run build-prod\n ---> Running in 114278674b76\n\n> sokyra-microservice-factory@1.9.6 build-prod /app\n> tsc --sourceMap false\n\nRemoving intermediate container 114278674b76\n ---> ea16c37323e2\nStep 15/38 : FROM node:10.13.0-alpine as prod\n ---> 93f2dcbcddfe\nStep 16/38 : ARG SERVICE=demo\n ---> Running in 3a5bb3762093\nRemoving intermediate container 3a5bb3762093\n ---> b093f1a7a282\nStep 17/38 : ENV SERVICE=$SERVICE\n ---> Running in 8ae37d0a1897\nRemoving intermediate container 8ae37d0a1897\n ---> 17f877e12a25\nStep 18/38 : WORKDIR /app\n ---> Running in c9f7fa9a69fc\nRemoving intermediate container c9f7fa9a69fc\n ---> 0d1e97ce6189\nStep 19/38 : COPY package.json .\n ---> b4dde0467d74\nStep 20/38 : COPY package-lock.json .\n ---> c6756d7b8d49\nStep 21/38 : COPY services/${SERVICE}/package*.json ./services/${SERVICE}/\n ---> 3baf5ac03175\nStep 22/38 : COPY --from=build /app/build .\n ---> e59e6c830cd5\nStep 23/38 : ENV NODE_ENV=production NODE_PATH=/app\n ---> Running in e6309313a6cd\nRemoving intermediate container e6309313a6cd\n ---> bad1b34cb1ef\nStep 24/38 : RUN npm install\n ---> Running in 7f952bc700cd\n\u001b[91mnpm WARN sokyra-microservice-factory@1.9.6 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0madded 246 packages from 227 contributors and audited 247 packages in 3.504s\nfound 36 vulnerabilities (14 moderate, 18 high, 4 critical)\n  run `npm audit fix` to fix them, or `npm audit` for details\nRemoving intermediate container 7f952bc700cd\n ---> 7d191b8dcfbc\nStep 25/38 : RUN cd ./services/${SERVICE} && npm install\n ---> Running in f396ab6c70e3\n\u001b[91mnpm WARN read-shrinkwrap\u001b[0m\u001b[91m This version of npm is compatible with lockfileVersion@1, but package-lock.json was generated for lockfileVersion@0. I'll try to do my best with it!\n\u001b[0m\u001b[91mnpm WARN\u001b[0m\u001b[91m demo@1.0.0 No description\n\u001b[0m\u001b[91mnpm\u001b[0m\u001b[91m \u001b[0m\u001b[91mWARN\u001b[0m\u001b[91m demo@1.0.0 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0mup to date in 0.478s\nfound 0 vulnerabilities\n\nRemoving intermediate container f396ab6c70e3\n ---> 06710d67a69e\nStep 26/38 : COPY core/smf-core-docker.js ./node_modules/smf-core.js\n ---> 8786b0c32192\nStep 27/38 : COPY docker-temp.txt ./services/${SERVICE}/data* /data/\n ---> 1a47167e8d97\nStep 28/38 : COPY docker-temp.txt ./services/${SERVICE}/library* /library/\n ---> 2d3141358290\nStep 29/38 : ENV CONDA_DIR=/opt/conda\n ---> Running in 714306a9a589\nRemoving intermediate container 714306a9a589\n ---> a5cf72422ef9\nStep 30/38 : ENV PATH=$CONDA_DIR/bin:$PATH\n ---> Running in 75fc6a84171a\nRemoving intermediate container 75fc6a84171a\n ---> afe759360801\nStep 31/38 : COPY docker-temp.txt ./services/${SERVICE}/install.sh* ./services/${SERVICE}/\n ---> 1b65c25295dd\nStep 32/38 : RUN if test -e \"./services/${SERVICE}/install.sh\"; then chmod +rx ./services/${SERVICE}/install.sh && ./services/${SERVICE}/install.sh ; fi\n ---> Running in c18911fd8451\nRemoving intermediate container c18911fd8451\n ---> 83f0ac1114ef\nStep 33/38 : COPY docker-temp.txt ./services/${SERVICE}/web-sails* ./services/${SERVICE}/web-sails/\n ---> 62243854149c\nStep 34/38 : RUN [ -d \"./services/${SERVICE}/web-sails\" ] && cd ./services/${SERVICE}/web-sails && npm install\n ---> Running in 02af82801d3d\n\u001b[91mnpm WARN demo@1.0.0 No description\n\u001b[0m\u001b[91mnpm WARN demo@1.0.0 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0mup to date in 0.391s\nfound 0 vulnerabilities\n\nRemoving intermediate container 02af82801d3d\n ---> 71cd8ff97eff\nStep 35/38 : ENV SAILS_PATH=./web-sails\n ---> Running in 88b28d8c867c\nRemoving intermediate container 88b28d8c867c\n ---> 44376fe93c72\nStep 36/38 : COPY smf-stack.json .\n ---> 667e5f686808\nStep 37/38 : ENV SMF_ROOT_PATH=../\n ---> Running in 8bc98a0ae3f7\nRemoving intermediate container 8bc98a0ae3f7\n ---> 62bd61396f02\nStep 38/38 : CMD [\"node\", \"./core/index.js\"]\n ---> Running in 6dc9ede4cf72\nRemoving intermediate container 6dc9ede4cf72\n ---> 2a42fb359a3e\nSuccessfully built 2a42fb359a3e\nSuccessfully tagged smf:latest\n","stderr":"","imageSize":102926745},"endTime":1672369205272}