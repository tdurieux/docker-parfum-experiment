{"repository":"https://github.com/datadog/kafka-kit","dockerfilePath":"Dockerfile","startTime":1672411610384,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/datadog/kafka-kit'...\n","error":null,"commit":"4b120984f4bc89c8a1d63f08a30b16583e08c343"},"originalBuild":{"startTimestamp":1672411611345,"endTimestamp":1672411919074,"error":null,"stdout":"Sending build context to Docker daemon  1.482MB\r\r\nStep 1/37 : FROM ubuntu:22.04\n22.04: Pulling from library/ubuntu\nDigest: sha256:27cb6e6ccef575a4698b66f5de06c7ecd61589132d5a91d098f7f3f9285415a9\nStatus: Downloaded newer image for ubuntu:22.04\n ---> 6b7dfa7e8fdb\nStep 2/37 : ARG DEBIAN_FRONTEND=noninteractive\n ---> Running in f84c79bfdb89\nRemoving intermediate container f84c79bfdb89\n ---> 6b35fd066514\nStep 3/37 : RUN apt update >/dev/null\n ---> Running in 9d60a4399ca6\n\u001b[91m\nWARNING: apt does not have a stable CLI interface. Use with caution in scripts.\n\n\u001b[0mRemoving intermediate container 9d60a4399ca6\n ---> bb5792f6ed62\nStep 4/37 : RUN apt install -y apt-utils jq build-essential unzip curl git pkg-config software-properties-common apt-transport-https ca-certificates >/dev/null\n ---> Running in bbcfa22c2ffb\n\u001b[91m\nWARNING: apt does not have a stable CLI interface. Use with caution in scripts.\n\n\u001b[0m\u001b[91mdebconf: delaying package configuration, since apt-utils is not installed\n\u001b[0mRemoving intermediate container bbcfa22c2ffb\n ---> 91e4e5191eba\nStep 5/37 : WORKDIR /root\n ---> Running in ad6bba1ef1d8\nRemoving intermediate container ad6bba1ef1d8\n ---> 57a8cece0809\nStep 6/37 : RUN curl -sOL https://go.dev/dl/go1.17.5.linux-amd64.tar.gz\n ---> Running in d1e5f89fbd59\nRemoving intermediate container d1e5f89fbd59\n ---> 7417ba9a873f\nStep 7/37 : RUN tar -C /usr/local -xzf go1.17.5.linux-amd64.tar.gz\n ---> Running in 3544fca5f576\nRemoving intermediate container 3544fca5f576\n ---> f9c73cacaddb\nStep 8/37 : ENV PATH=$PATH:/usr/local/go/bin:/go/bin\n ---> Running in 4bb2f69a38a6\nRemoving intermediate container 4bb2f69a38a6\n ---> 99971518f5d4\nStep 9/37 : ENV GOPATH=/go\n ---> Running in f2692e67eaa0\nRemoving intermediate container f2692e67eaa0\n ---> 13229b9505e2\nStep 10/37 : RUN curl -sL https://packages.confluent.io/deb/6.1/archive.key | apt-key add - 2>/dev/null\n ---> Running in 1d8963c9aa7d\nOK\nRemoving intermediate container 1d8963c9aa7d\n ---> ca1517428250\nStep 11/37 : RUN add-apt-repository \"deb [arch=amd64] https://packages.confluent.io/deb/6.1 stable main\"\n ---> Running in e77d4b66e3cf\nGet:1 https://packages.confluent.io/deb/6.1 stable InRelease [5872 B]\nHit:2 http://archive.ubuntu.com/ubuntu jammy InRelease\nHit:3 http://archive.ubuntu.com/ubuntu jammy-updates InRelease\nHit:4 http://archive.ubuntu.com/ubuntu jammy-backports InRelease\nHit:5 http://security.ubuntu.com/ubuntu jammy-security InRelease\nGet:6 https://packages.confluent.io/deb/6.1 stable/main amd64 Packages [55.7 kB]\nFetched 61.5 kB in 1s (58.3 kB/s)\nReading package lists...\n\u001b[91mW: https://packages.confluent.io/deb/6.1/dists/stable/InRelease: Key is stored in legacy trusted.gpg keyring (/etc/apt/trusted.gpg), see the DEPRECATION section in apt-key(8) for details.\n\u001b[0mRepository: 'deb [arch=amd64] https://packages.confluent.io/deb/6.1 stable main'\nDescription:\nArchive for codename: stable components: main\nMore info: https://packages.confluent.io/deb/6.1\nAdding repository.\nAdding deb entry to /etc/apt/sources.list.d/archive_uri-https_packages_confluent_io_deb_6_1-jammy.list\nAdding disabled deb-src entry to /etc/apt/sources.list.d/archive_uri-https_packages_confluent_io_deb_6_1-jammy.list\nRemoving intermediate container e77d4b66e3cf\n ---> e48b734574fb\nStep 12/37 : RUN apt-get update && apt-get install -y librdkafka1 librdkafka-dev >/dev/null\n ---> Running in 114d4fa1110c\nHit:1 https://packages.confluent.io/deb/6.1 stable InRelease\nHit:2 http://archive.ubuntu.com/ubuntu jammy InRelease\nHit:3 http://archive.ubuntu.com/ubuntu jammy-updates InRelease\nHit:4 http://archive.ubuntu.com/ubuntu jammy-backports InRelease\nHit:5 http://security.ubuntu.com/ubuntu jammy-security InRelease\nReading package lists...\n\u001b[91mW: https://packages.confluent.io/deb/6.1/dists/stable/InRelease: Key is stored in legacy trusted.gpg keyring (/etc/apt/trusted.gpg), see the DEPRECATION section in apt-key(8) for details.\n\u001b[0mRemoving intermediate container 114d4fa1110c\n ---> 8c9432b98815\nStep 13/37 : WORKDIR /go/src/github.com/DataDog/kafka-kit\n ---> Running in 3a3a7809c377\nRemoving intermediate container 3a3a7809c377\n ---> 43a784f1e0c0\nStep 14/37 : COPY tools.go tools.go\n ---> 510fc19c2f9f\nStep 15/37 : COPY go.mod go.mod\n ---> a709e81d51a3\nStep 16/37 : COPY go.sum go.sum\n ---> 81ed90a1d8ed\nStep 17/37 : RUN go mod download\n ---> Running in 53eb573f4a64\nRemoving intermediate container 53eb573f4a64\n ---> 1c7fb1bf3674\nStep 18/37 : RUN curl -sOL https://github.com/protocolbuffers/protobuf/releases/download/v3.19.1/protoc-3.19.1-linux-x86_64.zip\n ---> Running in 84bfa4578fd5\nRemoving intermediate container 84bfa4578fd5\n ---> dfb5875bfd81\nStep 19/37 : RUN unzip protoc-3.19.1-linux-x86_64.zip -d protoc\n ---> Running in b2886f8a29aa\nArchive:  protoc-3.19.1-linux-x86_64.zip\n   creating: protoc/include/\n   creating: protoc/include/google/\n   creating: protoc/include/google/protobuf/\n  inflating: protoc/include/google/protobuf/wrappers.proto  \n  inflating: protoc/include/google/protobuf/source_context.proto  \n  inflating: protoc/include/google/protobuf/struct.proto  \n  inflating: protoc/include/google/protobuf/any.proto  \n  inflating: protoc/include/google/protobuf/api.proto  \n  inflating: protoc/include/google/protobuf/descriptor.proto  \n   creating: protoc/include/google/protobuf/compiler/\n  inflating: protoc/include/google/protobuf/compiler/plugin.proto  \n  inflating: protoc/include/google/protobuf/timestamp.proto  \n  inflating: protoc/include/google/protobuf/field_mask.proto  \n  inflating: protoc/include/google/protobuf/empty.proto  \n  inflating: protoc/include/google/protobuf/duration.proto  \n  inflating: protoc/include/google/protobuf/type.proto  \n   creating: protoc/bin/\n  inflating: protoc/bin/protoc       \n  inflating: protoc/readme.txt       \nRemoving intermediate container b2886f8a29aa\n ---> c6dda8df7d45\nStep 20/37 : RUN mv protoc/bin/* /usr/local/bin/\n ---> Running in dbc4a8563185\nRemoving intermediate container dbc4a8563185\n ---> 8f15a482df08\nStep 21/37 : RUN mv protoc/include/* /usr/local/include/\n ---> Running in f91e05be6b9f\nRemoving intermediate container f91e05be6b9f\n ---> 50f9f7b064b7\nStep 22/37 : RUN rm -rf protoc*\n ---> Running in 05aaf6562592\nRemoving intermediate container 05aaf6562592\n ---> b7479683fb55\nStep 23/37 : RUN go get -d github.com/googleapis/googleapis\n ---> Running in aeaad38feb20\n\u001b[91mgo: downloading github.com/googleapis/googleapis v0.0.0-20221229103343-1a54b1fa9b19\n\u001b[0m\u001b[91mgo get: added github.com/googleapis/googleapis v0.0.0-20221229103343-1a54b1fa9b19\n\u001b[0mRemoving intermediate container aeaad38feb20\n ---> 8bd4e81a956a\nStep 24/37 : RUN go install   google.golang.org/protobuf/cmd/protoc-gen-go   google.golang.org/grpc/cmd/protoc-gen-go-grpc   github.com/grpc-ecosystem/grpc-gateway/v2/protoc-gen-grpc-gateway\n ---> Running in 48eccfac06b9\nRemoving intermediate container 48eccfac06b9\n ---> b13118cc3620\nStep 25/37 : COPY cmd cmd\n ---> cc98d3035ec0\nStep 26/37 : COPY cluster cluster\n ---> c6d803d4a7d4\nStep 27/37 : COPY kafkaadmin kafkaadmin\n ---> ed7133ccb26e\nStep 28/37 : COPY kafkametrics kafkametrics\n ---> 51a13f846785\nStep 29/37 : COPY kafkazk kafkazk\n ---> 250b0ea35c55\nStep 30/37 : COPY mapper mapper\n ---> 97174b01b99e\nStep 31/37 : COPY registry registry\n ---> 501bba0012ba\nStep 32/37 : RUN protoc -I ./registry -I $GOPATH/pkg/mod/$(awk '/googleapis/ {printf \"%s@%s\", $1, $2}' go.mod)     --go_out ./registry     --go_opt paths=source_relative     --go-grpc_out ./registry     --go-grpc_opt paths=source_relative     --grpc-gateway_out ./registry     --grpc-gateway_opt logtostderr=true     --grpc-gateway_opt paths=source_relative     --grpc-gateway_opt generate_unbound_methods=true     registry/registry/registry.proto\n ---> Running in 0cf7fb434e23\nRemoving intermediate container 0cf7fb434e23\n ---> 37988fa74d52\nStep 33/37 : RUN go install ./cmd/...\n ---> Running in acd60ac41cc4\nRemoving intermediate container acd60ac41cc4\n ---> ed6ad42788a4\nStep 34/37 : RUN apt autoremove\n ---> Running in 0e8051994138\n\u001b[91m\nWARNING: apt does not have a stable CLI interface. Use with caution in scripts.\n\n\u001b[0mReading package lists...\nBuilding dependency tree...\nReading state information...\n0 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.\nRemoving intermediate container 0e8051994138\n ---> cb183172896a\nStep 35/37 : RUN apt clean\n ---> Running in 2904f93e9bf3\n\u001b[91m\nWARNING: apt does not have a stable CLI interface. Use with caution in scripts.\n\n\u001b[0mRemoving intermediate container 2904f93e9bf3\n ---> 1ddf412af99f\nStep 36/37 : COPY entrypoint.sh /\n ---> d453360b4802\nStep 37/37 : ENTRYPOINT [\"/entrypoint.sh\"]\n ---> Running in bdc4003d16cb\nRemoving intermediate container bdc4003d16cb\n ---> f27beff9e210\nSuccessfully built f27beff9e210\nSuccessfully tagged kafka-kit:latest\n","stderr":"","imageSize":2672003657},"repair":{"violations":[{"name":"curlUseFlagF","position":{"start":10,"end":10,"columnStart":4,"columnEnd":59}},{"name":"curlUseFlagF","position":{"start":16,"end":16,"columnStart":4,"columnEnd":62}},{"name":"curlUseFlagF","position":{"start":28,"end":28,"columnStart":4,"columnEnd":114}},{"name":"tarSomethingRmTheSomething","position":{"start":11,"end":11,"columnStart":4,"columnEnd":54}},{"name":"ruleAptGetInstallUseNoRec","position":{"start":5,"end":5,"columnStart":4,"columnEnd":147}},{"name":"ruleAptGetInstallUseNoRec","position":{"start":18,"end":18,"columnStart":22,"columnEnd":78}},{"name":"ruleAptGetUpdatePrecedesInstall","position":{"start":5,"end":5,"columnStart":4,"columnEnd":147}},{"name":"ruleAptGetInstallThenRemoveAptLists","position":{"start":5,"end":5,"columnStart":4,"columnEnd":147}},{"name":"ruleAptGetInstallThenRemoveAptLists","position":{"start":18,"end":18,"columnStart":22,"columnEnd":78}}],"repairedDockerfile":"FROM ubuntu:22.04\n\n# Install pre-reqs\nARG DEBIAN_FRONTEND=noninteractive\nRUN apt update >/dev/null\nRUN apt install --no-install-recommends -y apt-utils jq build-essential unzip curl git pkg-config software-properties-common apt-transport-https ca-certificates >/dev/null\n\nWORKDIR /root\n\n# Install Go\nRUN curl -f -sOL https://go.dev/dl/go1.17.5.linux-amd64.tar.gz\nRUN tar -C /usr/local -xzf go1.17.5.linux-amd64.tar.gz\nENV PATH=$PATH:/usr/local/go/bin:/go/bin\nENV GOPATH=/go\n\n# Install librdkafka\nRUN curl -f -sL https://packages.confluent.io/deb/6.1/archive.key | apt-key add - 2>/dev/null\nRUN add-apt-repository \"deb [arch=amd64] https://packages.confluent.io/deb/6.1 stable main\"\nRUN apt-get update && apt-get install --no-install-recommends -y librdkafka1 librdkafka-dev >/dev/null\n\n# Init repo.\nWORKDIR /go/src/github.com/DataDog/kafka-kit\nCOPY tools.go tools.go\nCOPY go.mod go.mod\nCOPY go.sum go.sum\nRUN go mod download\n\n# Install protoc\nRUN curl -f -sOL https://github.com/protocolbuffers/protobuf/releases/download/v3.19.1/protoc-3.19.1-linux-x86_64.zip\nRUN unzip protoc-3.19.1-linux-x86_64.zip -d protoc\nRUN mv protoc/bin/* /usr/local/bin/\nRUN mv protoc/include/* /usr/local/include/\nRUN rm -rf protoc*\n\n# Install protoc / gRPC deps; these versions are managed in go.mod\nRUN go get -d github.com/googleapis/googleapis\nRUN go install \\\n  google.golang.org/protobuf/cmd/protoc-gen-go \\\n  google.golang.org/grpc/cmd/protoc-gen-go-grpc \\\n  github.com/grpc-ecosystem/grpc-gateway/v2/protoc-gen-grpc-gateway\n\n# Copy source.\nCOPY cmd cmd\nCOPY cluster cluster\nCOPY kafkaadmin kafkaadmin\nCOPY kafkametrics kafkametrics\nCOPY kafkazk kafkazk\nCOPY mapper mapper\nCOPY registry registry\n\n# Codegen\nRUN protoc -I ./registry -I $GOPATH/pkg/mod/$(awk '/googleapis/ {printf \"%s@%s\", $1, $2}' go.mod) \\\n    --go_out ./registry \\\n    --go_opt paths=source_relative \\\n    --go-grpc_out ./registry \\\n    --go-grpc_opt paths=source_relative \\\n    --grpc-gateway_out ./registry \\\n    --grpc-gateway_opt logtostderr=true \\\n    --grpc-gateway_opt paths=source_relative \\\n    --grpc-gateway_opt generate_unbound_methods=true \\\n    registry/registry/registry.proto\n\n# Build\nRUN go install ./cmd/...\n\n# Clean\nRUN apt autoremove\nRUN apt clean\n\nCOPY entrypoint.sh /\nENTRYPOINT [\"/entrypoint.sh\"]\n"},"repairedBuild":{"startTimestamp":1672411921129,"endTimestamp":1672412028023,"error":{"code":2,"killed":false,"signal":null,"cmd":"docker build --no-cache --force-rm -t kafka-kit:latest -f /tmp/dinghy-analysis/datadog/kafka-kit/Dockerfile ."},"stdout":"Sending build context to Docker daemon  1.482MB\r\r\nStep 1/37 : FROM ubuntu:22.04\n ---> 6b7dfa7e8fdb\nStep 2/37 : ARG DEBIAN_FRONTEND=noninteractive\n ---> Running in 5d6da3670a49\nRemoving intermediate container 5d6da3670a49\n ---> a7b4076279a6\nStep 3/37 : RUN apt update >/dev/null\n ---> Running in 122153bc1ba5\n\u001b[91m\nWARNING: apt does not have a stable CLI interface. Use with caution in scripts.\n\n\u001b[0mRemoving intermediate container 122153bc1ba5\n ---> 78526fc7c398\nStep 4/37 : RUN apt install --no-install-recommends -y apt-utils jq build-essential unzip curl git pkg-config software-properties-common apt-transport-https ca-certificates >/dev/null\n ---> Running in a59c3f6995fa\n\u001b[91m\nWARNING: apt does not have a stable CLI interface. Use with caution in scripts.\n\n\u001b[0m\u001b[91mdebconf: delaying package configuration, since apt-utils is not installed\n\u001b[0mRemoving intermediate container a59c3f6995fa\n ---> 1014f10e2f7f\nStep 5/37 : WORKDIR /root\n ---> Running in 451a653928f8\nRemoving intermediate container 451a653928f8\n ---> b0c361eeaf95\nStep 6/37 : RUN curl -f -sOL https://go.dev/dl/go1.17.5.linux-amd64.tar.gz\n ---> Running in 78c650b1a63e\nRemoving intermediate container 78c650b1a63e\n ---> 531002b5b070\nStep 7/37 : RUN tar -C /usr/local -xzf go1.17.5.linux-amd64.tar.gz\n ---> Running in b397a9cc87b3\nRemoving intermediate container b397a9cc87b3\n ---> 05979d8390f4\nStep 8/37 : ENV PATH=$PATH:/usr/local/go/bin:/go/bin\n ---> Running in e63a2ba66a7d\nRemoving intermediate container e63a2ba66a7d\n ---> 00fd058176b5\nStep 9/37 : ENV GOPATH=/go\n ---> Running in f0ae7881ab11\nRemoving intermediate container f0ae7881ab11\n ---> 3cd446a6701e\nStep 10/37 : RUN curl -f -sL https://packages.confluent.io/deb/6.1/archive.key | apt-key add - 2>/dev/null\n ---> Running in 65ea96f00cf4\nRemoving intermediate container 65ea96f00cf4\n","stderr":"The command '/bin/sh -c curl -f -sL https://packages.confluent.io/deb/6.1/archive.key | apt-key add - 2>/dev/null' returned a non-zero code: 2\n"},"endTime":1672412028096}