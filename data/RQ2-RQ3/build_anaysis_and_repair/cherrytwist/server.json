{"repository":"https://github.com/cherrytwist/server","dockerfilePath":"Dockerfile","startTime":1672577253144,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/cherrytwist/server'...\n","error":null,"commit":"6ada101665ffd7aa749e806951ed8cb04a1841b1"},"originalBuild":{"startTimestamp":1672577254367,"endTimestamp":1672577427679,"error":null,"stdout":"Sending build context to Docker daemon  5.457MB\r\r\nStep 1/21 : FROM node:16.15.0-alpine\n16.15.0-alpine: Pulling from library/node\ndf9b9388f04a: Already exists\n70c90f7de7cb: Pulling fs layer\nf83937c3ce37: Pulling fs layer\n98b78bba1d70: Pulling fs layer\n98b78bba1d70: Verifying Checksum\n98b78bba1d70: Download complete\nf83937c3ce37: Download complete\n70c90f7de7cb: Verifying Checksum\n70c90f7de7cb: Download complete\n70c90f7de7cb: Pull complete\nf83937c3ce37: Pull complete\n98b78bba1d70: Pull complete\nDigest: sha256:1a9a71ea86aad332aa7740316d4111ee1bd4e890df47d3b5eff3e5bded3b3d10\nStatus: Downloaded newer image for node:16.15.0-alpine\n ---> e5065cc78074\nStep 2/21 : RUN apk add --update mariadb-client && apk add python3 && rm -rf /var/cache/apk/*\n ---> Running in 4c5ca05474ab\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/community/x86_64/APKINDEX.tar.gz\n(1/4) Installing mariadb-common (10.6.10-r0)\n(2/4) Installing ncurses-terminfo-base (6.3_p20211120-r1)\n(3/4) Installing ncurses-libs (6.3_p20211120-r1)\n(4/4) Installing mariadb-client (10.6.10-r0)\nExecuting busybox-1.34.1-r5.trigger\nOK: 39 MiB in 20 packages\n(1/9) Installing libbz2 (1.0.8-r1)\n(2/9) Installing expat (2.5.0-r0)\n(3/9) Installing libffi (3.4.2-r1)\n(4/9) Installing gdbm (1.22-r0)\n(5/9) Installing xz-libs (5.2.5-r1)\n(6/9) Installing mpdecimal (2.5.1-r1)\n(7/9) Installing readline (8.1.1-r0)\n(8/9) Installing sqlite-libs (3.36.0-r0)\n(9/9) Installing python3 (3.9.16-r0)\nExecuting busybox-1.34.1-r5.trigger\nOK: 87 MiB in 29 packages\nRemoving intermediate container 4c5ca05474ab\n ---> 4da695114dde\nStep 3/21 : WORKDIR /usr/src/app\n ---> Running in be8def7d16e9\nRemoving intermediate container be8def7d16e9\n ---> 46dd0b7de51d\nStep 4/21 : ARG GRAPHQL_ENDPOINT_PORT_ARG=4000\n ---> Running in 1ed37ce18aa6\nRemoving intermediate container 1ed37ce18aa6\n ---> a418d560145c\nStep 5/21 : ARG ENV_ARG=production\n ---> Running in b5d85f011f7b\nRemoving intermediate container b5d85f011f7b\n ---> 6d80082460d2\nStep 6/21 : COPY package*.json ./\n ---> 5e64a2ed7fb5\nStep 7/21 : RUN npm i -g npm@8.5.5\n ---> Running in a4db31eb4767\n\nchanged 14 packages, and audited 201 packages in 34s\n\n10 packages are looking for funding\n  run `npm fund` for details\n\n1 high severity vulnerability\n\nTo address all issues, run:\n  npm audit fix --force\n\nRun `npm audit` for details.\n\u001b[91mnpm notice\u001b[0m\u001b[91m \nnpm\u001b[0m\u001b[91m notice New major version of npm available! 8.5.5 -> 9.2.0\nnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\nnpm\u001b[0m\u001b[91m notice Run `npm install -g npm@9.2.0` to update!\nnpm \u001b[0m\u001b[91mnotice \n\u001b[0mRemoving intermediate container a4db31eb4767\n ---> 6db57a0d2591\nStep 8/21 : RUN npm install\n ---> Running in 91dfd8faf20e\n\u001b[91mnpm WARN deprecated cids@1.1.9: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated multibase@4.0.6: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated multicodec@3.2.1: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated uuid@3.4.0: Please upgrade  to version 7 or higher.  Older versions may use Math.random() in certain circumstances, which is known to be problematic.  See https://v8.dev/blog/math-random for details.\n\u001b[0m\u001b[91mnpm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142\n\u001b[0m\u001b[91mnpm WARN deprecated subscriptions-transport-ws@0.11.0: The `subscriptions-transport-ws` package is no longer maintained. We recommend you use `graphql-ws` instead. For help migrating Apollo software to `graphql-ws`, see https://www.apollographql.com/docs/apollo-server/data/subscriptions/#switching-from-subscriptions-transport-ws    For general help using `graphql-ws`, see https://github.com/enisdenjo/graphql-ws/blob/master/README.md\n\u001b[0m\u001b[91mnpm WARN deprecated har-validator@5.1.5: this library is no longer supported\n\u001b[0m\u001b[91mnpm WARN deprecated @types/yaml@1.9.7: This is a stub types definition. yaml provides its own type definitions, so you do not need this installed.\n\u001b[0m\nadded 1314 packages, and audited 1315 packages in 34s\n\n134 packages are looking for funding\n  run `npm fund` for details\n\n33 vulnerabilities (1 low, 12 moderate, 20 high)\n\nTo address issues that do not require attention, run:\n  npm audit fix\n\nTo address all issues possible (including breaking changes), run:\n  npm audit fix --force\n\nSome issues need review, and may require choosing\na different dependency.\n\nRun `npm audit` for details.\nRemoving intermediate container 91dfd8faf20e\n ---> 34c4a900e1e0\nStep 9/21 : COPY ./src ./src\n ---> 4376e56fcad0\nStep 10/21 : COPY ./tsconfig.json .\n ---> 8cf6bdcf4e95\nStep 11/21 : COPY ./tsconfig.build.json .\n ---> 43fa205a3fbd\nStep 12/21 : COPY ./alkemio.yml .\n ---> 1716f6a01e1d\nStep 13/21 : RUN npm run build\n ---> Running in 0c3aa7db7b3f\n\n> alkemio-server@0.39.5 prebuild\n> rimraf dist\n\n\n> alkemio-server@0.39.5 build\n> nest build\n\nRemoving intermediate container 0c3aa7db7b3f\n ---> e9c259156836\nStep 14/21 : ADD https://github.com/ufoscout/docker-compose-wait/releases/download/2.7.3/wait /wait\n\n\n ---> 155ac25d2b24\nStep 15/21 : RUN chmod +x /wait\n ---> Running in f8bf5012b60e\nRemoving intermediate container f8bf5012b60e\n ---> d0e063588af9\nStep 16/21 : ENV GRAPHQL_ENDPOINT_PORT=${GRAPHQL_ENDPOINT_PORT_ARG}\n ---> Running in d0e197f03b21\nRemoving intermediate container d0e197f03b21\n ---> af0b440f193a\nStep 17/21 : ENV NODE_ENV=${ENV_ARG}\n ---> Running in 9b6fbad19f12\nRemoving intermediate container 9b6fbad19f12\n ---> 6b323451ba2a\nStep 18/21 : ADD .scripts/create_db.sh /create_db.sh\n ---> 261690598c4e\nStep 19/21 : RUN chmod +x /create_db.sh\n ---> Running in 54e2d3039686\nRemoving intermediate container 54e2d3039686\n ---> c2fcaa3845cf\nStep 20/21 : EXPOSE ${GRAPHQL_ENDPOINT_PORT_ARG}\n ---> Running in 5a43d729104a\nRemoving intermediate container 5a43d729104a\n ---> 01d65d86f7e4\nStep 21/21 : CMD [\"/bin/sh\", \"-c\", \"/create_db.sh && npm run start:prod\"]\n ---> Running in bcaab658fda8\nRemoving intermediate container bcaab658fda8\n ---> 2252299d5f1a\nSuccessfully built 2252299d5f1a\nSuccessfully tagged server:latest\n","stderr":"","imageSize":645593274},"repair":{"violations":[{"name":"npmCacheCleanAfterInstall","position":{"start":18,"end":18,"columnStart":4,"columnEnd":22}},{"name":"npmCacheCleanAfterInstall","position":{"start":19,"end":19,"columnStart":4,"columnEnd":15}},{"name":"apkAddUseNoCache","position":{"start":4,"end":4,"columnStart":4,"columnEnd":35}},{"name":"apkAddUseNoCache","position":{"start":4,"end":4,"columnStart":39,"columnEnd":54}}],"repairedDockerfile":"FROM node:16.15.0-alpine\n\n\n#install CLI mariadb/mysql client\nRUN apk add --no-cache --update mariadb-client && apk add --no-cache python3 && rm -rf /var/cache/apk/*\n\n# Create app directory\nWORKDIR /usr/src/app\n\n# Define graphql server port\nARG GRAPHQL_ENDPOINT_PORT_ARG=4000\nARG ENV_ARG=production\n\n# Install app dependencies\n# A wildcard is used to ensure both package.json AND package-lock.json are copied\n# where available (npm@5+)\nCOPY package*.json ./\n\nRUN npm i -g npm@8.5.5\nRUN npm install\n\n# If you are building your code for production\n# RUN npm ci --only=production\n\n# Bundle app source & config files for TypeORM & TypeScript\nCOPY ./src ./src\nCOPY ./tsconfig.json .\nCOPY ./tsconfig.build.json .\nCOPY ./alkemio.yml .\n\nRUN npm run build\n\n## Add the wait script to the image\nADD https://github.com/ufoscout/docker-compose-wait/releases/download/2.7.3/wait /wait\nRUN chmod +x /wait\n\nENV GRAPHQL_ENDPOINT_PORT=${GRAPHQL_ENDPOINT_PORT_ARG}\nENV NODE_ENV=${ENV_ARG}\n\nADD .scripts/create_db.sh /create_db.sh\nRUN chmod +x /create_db.sh\n\n\nEXPOSE ${GRAPHQL_ENDPOINT_PORT_ARG}\nCMD [\"/bin/sh\", \"-c\", \"/create_db.sh && npm run start:prod\"]\n"},"repairedBuild":{"startTimestamp":1672577429263,"endTimestamp":1672577558797,"error":null,"stdout":"Sending build context to Docker daemon  5.457MB\r\r\nStep 1/21 : FROM node:16.15.0-alpine\n ---> e5065cc78074\nStep 2/21 : RUN apk add --no-cache --update mariadb-client && apk add --no-cache python3 && rm -rf /var/cache/apk/*\n ---> Running in 509db788e8a8\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/community/x86_64/APKINDEX.tar.gz\n(1/4) Installing mariadb-common (10.6.10-r0)\n(2/4) Installing ncurses-terminfo-base (6.3_p20211120-r1)\n(3/4) Installing ncurses-libs (6.3_p20211120-r1)\n(4/4) Installing mariadb-client (10.6.10-r0)\nExecuting busybox-1.34.1-r5.trigger\nOK: 39 MiB in 20 packages\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/community/x86_64/APKINDEX.tar.gz\n(1/9) Installing libbz2 (1.0.8-r1)\n(2/9) Installing expat (2.5.0-r0)\n(3/9) Installing libffi (3.4.2-r1)\n(4/9) Installing gdbm (1.22-r0)\n(5/9) Installing xz-libs (5.2.5-r1)\n(6/9) Installing mpdecimal (2.5.1-r1)\n(7/9) Installing readline (8.1.1-r0)\n(8/9) Installing sqlite-libs (3.36.0-r0)\n(9/9) Installing python3 (3.9.16-r0)\nExecuting busybox-1.34.1-r5.trigger\nOK: 87 MiB in 29 packages\nRemoving intermediate container 509db788e8a8\n ---> 5e7d23aeabdd\nStep 3/21 : WORKDIR /usr/src/app\n ---> Running in fad6f9f54db2\nRemoving intermediate container fad6f9f54db2\n ---> 22bbd71725c7\nStep 4/21 : ARG GRAPHQL_ENDPOINT_PORT_ARG=4000\n ---> Running in 5dd86a7a38a5\nRemoving intermediate container 5dd86a7a38a5\n ---> 8cb07bfb9812\nStep 5/21 : ARG ENV_ARG=production\n ---> Running in df868d54085f\nRemoving intermediate container df868d54085f\n ---> e811bbccca78\nStep 6/21 : COPY package*.json ./\n ---> c053ad401240\nStep 7/21 : RUN npm i -g npm@8.5.5\n ---> Running in 225a49c8fce8\n\nchanged 14 packages, and audited 201 packages in 26s\n\n10 packages are looking for funding\n  run `npm fund` for details\n\n1 high severity vulnerability\n\nTo address all issues, run:\n  npm audit fix --force\n\nRun `npm audit` for details.\n\u001b[91mnpm notice\u001b[0m\u001b[91m \nnpm\u001b[0m\u001b[91m notice New major version of npm available! 8.5.5 -> 9.2.0\nnpm \u001b[0m\u001b[91mnotice Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\n\u001b[0m\u001b[91mnpm\u001b[0m\u001b[91m notice Run `npm install -g npm@9.2.0` to update!\nnpm notice \n\u001b[0mRemoving intermediate container 225a49c8fce8\n ---> a1187ecf7294\nStep 8/21 : RUN npm install\n ---> Running in b557171fe9ab\n\u001b[91mnpm WARN deprecated cids@1.1.9: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated multibase@4.0.6: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated uuid@3.4.0: Please upgrade  to version 7 or higher.  Older versions may use Math.random() in certain circumstances, which is known to be problematic.  See https://v8.dev/blog/math-random for details.\n\u001b[0m\u001b[91mnpm WARN deprecated multicodec@3.2.1: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142\n\u001b[0m\u001b[91mnpm WARN deprecated subscriptions-transport-ws@0.11.0: The `subscriptions-transport-ws` package is no longer maintained. We recommend you use `graphql-ws` instead. For help migrating Apollo software to `graphql-ws`, see https://www.apollographql.com/docs/apollo-server/data/subscriptions/#switching-from-subscriptions-transport-ws    For general help using `graphql-ws`, see https://github.com/enisdenjo/graphql-ws/blob/master/README.md\n\u001b[0m\u001b[91mnpm WARN deprecated har-validator@5.1.5: this library is no longer supported\n\u001b[0m\u001b[91mnpm WARN deprecated @types/yaml@1.9.7: This is a stub types definition. yaml provides its own type definitions, so you do not need this installed.\n\u001b[0m\nadded 1314 packages, and audited 1315 packages in 29s\n\n134 packages are looking for funding\n  run `npm fund` for details\n\n33 vulnerabilities (1 low, 12 moderate, 20 high)\n\nTo address issues that do not require attention, run:\n  npm audit fix\n\nTo address all issues possible (including breaking changes), run:\n  npm audit fix --force\n\nSome issues need review, and may require choosing\na different dependency.\n\nRun `npm audit` for details.\nRemoving intermediate container b557171fe9ab\n ---> 1952c46b1a71\nStep 9/21 : COPY ./src ./src\n ---> cd476c41ceeb\nStep 10/21 : COPY ./tsconfig.json .\n ---> 99fe667279f5\nStep 11/21 : COPY ./tsconfig.build.json .\n ---> 6d45fedb76f6\nStep 12/21 : COPY ./alkemio.yml .\n ---> 2c35fef45587\nStep 13/21 : RUN npm run build\n ---> Running in da5bbfd10462\n\n> alkemio-server@0.39.5 prebuild\n> rimraf dist\n\n\n> alkemio-server@0.39.5 build\n> nest build\n\nRemoving intermediate container da5bbfd10462\n ---> e053aacd4ef2\nStep 14/21 : ADD https://github.com/ufoscout/docker-compose-wait/releases/download/2.7.3/wait /wait\n\n\n ---> ab5dc2303332\nStep 15/21 : RUN chmod +x /wait\n ---> Running in bd3fd21d3772\nRemoving intermediate container bd3fd21d3772\n ---> ed2e94e35104\nStep 16/21 : ENV GRAPHQL_ENDPOINT_PORT=${GRAPHQL_ENDPOINT_PORT_ARG}\n ---> Running in ed10997e3b0f\nRemoving intermediate container ed10997e3b0f\n ---> a94cfe29df6a\nStep 17/21 : ENV NODE_ENV=${ENV_ARG}\n ---> Running in 13fbf7a413e1\nRemoving intermediate container 13fbf7a413e1\n ---> fb524533a542\nStep 18/21 : ADD .scripts/create_db.sh /create_db.sh\n ---> 881677e8b9ae\nStep 19/21 : RUN chmod +x /create_db.sh\n ---> Running in cd77365b6c08\nRemoving intermediate container cd77365b6c08\n ---> 676bd2bbe491\nStep 20/21 : EXPOSE ${GRAPHQL_ENDPOINT_PORT_ARG}\n ---> Running in d1caa877943f\nRemoving intermediate container d1caa877943f\n ---> c39fc29da036\nStep 21/21 : CMD [\"/bin/sh\", \"-c\", \"/create_db.sh && npm run start:prod\"]\n ---> Running in 051d2e787ef1\nRemoving intermediate container 051d2e787ef1\n ---> c7904444ca65\nSuccessfully built c7904444ca65\nSuccessfully tagged server:latest\n","stderr":"","imageSize":645592513},"endTime":1672577560730}