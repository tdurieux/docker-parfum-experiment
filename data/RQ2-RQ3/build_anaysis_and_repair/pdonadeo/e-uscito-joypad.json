{"repository":"https://github.com/pdonadeo/e-uscito-joypad","dockerfilePath":"Dockerfile","startTime":1672022800498,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/pdonadeo/e-uscito-joypad'...\n","error":null,"commit":"356f784137d234f09bd1735907f58ddd8c067fc2"},"originalBuild":{"startTimestamp":1672022802752,"endTimestamp":1672022985472,"error":null,"stdout":"Sending build context to Docker daemon  12.77MB\r\r\nStep 1/43 : FROM node:16-alpine3.11 AS build-stage-1\n16-alpine3.11: Pulling from library/node\n6a428f9f83b0: Pulling fs layer\n3b99c7d83f4e: Pulling fs layer\n7aed112a7386: Pulling fs layer\n8a422bc4b94e: Pulling fs layer\n6a428f9f83b0: Verifying Checksum\n6a428f9f83b0: Download complete\n7aed112a7386: Verifying Checksum\n7aed112a7386: Download complete\n6a428f9f83b0: Pull complete\n8a422bc4b94e: Verifying Checksum\n8a422bc4b94e: Download complete\n3b99c7d83f4e: Verifying Checksum\n3b99c7d83f4e: Download complete\n3b99c7d83f4e: Pull complete\n7aed112a7386: Pull complete\n8a422bc4b94e: Pull complete\nDigest: sha256:3b2e5a8932729c0dc561c9242c9a3c51d2101bdaff879689678a3d7febe8d08f\nStatus: Downloaded newer image for node:16-alpine3.11\n ---> ef75ab605b08\nStep 2/43 : WORKDIR /app\n ---> Running in c21d791c2d0f\nRemoving intermediate container c21d791c2d0f\n ---> 0d4af47ad94c\nStep 3/43 : COPY ./frontend/package.json ./frontend/yarn.lock ./\n ---> f1abc8513ace\nStep 4/43 : RUN yarn\n ---> Running in d3f7f26dde7e\nyarn install v1.22.15\n[1/4] Resolving packages...\n[2/4] Fetching packages...\ninfo fsevents@2.3.2: The platform \"linux\" is incompatible with this module.\ninfo \"fsevents@2.3.2\" is an optional dependency and failed compatibility check. Excluding it from installation.\n[3/4] Linking dependencies...\n\u001b[91mwarning \" > @testing-library/user-event@13.5.0\" has unmet peer dependency \"@testing-library/dom@>=7.21.4\".\n\u001b[0m\u001b[91mwarning \"react-scripts > eslint-config-react-app > eslint-plugin-flowtype@8.0.3\" has unmet peer dependency \"@babel/plugin-syntax-flow@^7.14.5\".\nwarning \"react-scripts > eslint-config-react-app > eslint-plugin-flowtype@8.0.3\" has unmet peer dependency \"@babel/plugin-transform-react-jsx@^7.14.9\".\n\u001b[0m\u001b[91mwarning \"react-scripts > react-dev-utils > fork-ts-checker-webpack-plugin@6.5.2\" has unmet peer dependency \"typescript@>= 2.7\".\n\u001b[0m\u001b[91mwarning \"react-scripts > eslint-config-react-app > @typescript-eslint/eslint-plugin > tsutils@3.21.0\" has unmet peer dependency \"typescript@>=2.8.0 || >= 3.2.0-dev || >= 3.3.0-dev || >= 3.4.0-dev || >= 3.5.0-dev || >= 3.6.0-dev || >= 3.6.0-beta || >= 3.7.0-dev || >= 3.7.0-beta\".\n\u001b[0m[4/4] Building fresh packages...\nDone in 19.84s.\nRemoving intermediate container d3f7f26dde7e\n ---> 2d939d268e9a\nStep 5/43 : COPY ./frontend/ ./\n ---> 18d65f8cb90c\nStep 6/43 : RUN yarn build\n ---> Running in ffd125858329\nyarn run v1.22.15\n$ react-scripts build\nCreating an optimized production build...\nCompiled successfully.\n\nFile sizes after gzip:\n\n  210.72 kB  build/static/js/main.b2196b2a.js\n  3.13 kB    build/static/css/main.2f1acb66.css\n  1.79 kB    build/static/js/787.79c11c46.chunk.js\n\nThe project was built assuming it is hosted at /static/.\nYou can control this with the homepage field in your package.json.\n\nThe build folder is ready to be deployed.\n\nFind out more about deployment here:\n\n  https://cra.link/deployment\n\nDone in 13.14s.\nRemoving intermediate container ffd125858329\n ---> ac9eb91886c0\nStep 7/43 : FROM pdonadeo/e-uscito-joypad-base:latest AS build-stage-2\nlatest: Pulling from pdonadeo/e-uscito-joypad-base\n79d85946f59b: Pulling fs layer\n2ebe13e98243: Pulling fs layer\nb5794902df84: Pulling fs layer\na3ed95caeb02: Pulling fs layer\n187ea1771f72: Pulling fs layer\n81c51cbcbe00: Pulling fs layer\na75c85b426e4: Pulling fs layer\nb7c0f3bf2eaf: Pulling fs layer\na75c85b426e4: Waiting\nb7c0f3bf2eaf: Waiting\n187ea1771f72: Waiting\na3ed95caeb02: Waiting\n81c51cbcbe00: Waiting\nb5794902df84: Verifying Checksum\nb5794902df84: Download complete\na3ed95caeb02: Download complete\n2ebe13e98243: Verifying Checksum\n2ebe13e98243: Download complete\n187ea1771f72: Verifying Checksum\n187ea1771f72: Download complete\n81c51cbcbe00: Verifying Checksum\n81c51cbcbe00: Download complete\na75c85b426e4: Verifying Checksum\na75c85b426e4: Download complete\n79d85946f59b: Verifying Checksum\n79d85946f59b: Download complete\nb7c0f3bf2eaf: Verifying Checksum\nb7c0f3bf2eaf: Download complete\n79d85946f59b: Pull complete\n2ebe13e98243: Pull complete\nb5794902df84: Pull complete\na3ed95caeb02: Pull complete\n187ea1771f72: Pull complete\n81c51cbcbe00: Pull complete\na75c85b426e4: Pull complete\nb7c0f3bf2eaf: Pull complete\nDigest: sha256:09f11e72f53235461d1a42de7121bd5d5358488bd08ba5b9d67d17ff8a8bed26\nStatus: Downloaded newer image for pdonadeo/e-uscito-joypad-base:latest\n ---> 60a35c49252f\nStep 8/43 : USER root\n ---> Running in 5260a6c07cb5\nRemoving intermediate container 5260a6c07cb5\n ---> 71d7b075c6dc\nStep 9/43 : ADD --chown=opam:opam ./dune ./dune-project /app/\n ---> e02c13379e0d\nStep 10/43 : ADD --chown=opam:opam ./src /app/src\n ---> e9f065f4b9e6\nStep 11/43 : RUN mkdir -p /app/euscitojoypad_db /app/frontend/public /app/frontend/build\n ---> Running in 88e8d2abd7ca\nRemoving intermediate container 88e8d2abd7ca\n ---> e2edce2328a2\nStep 12/43 : ADD --chown=opam:opam ./frontend/public /app/frontend/public\n ---> deeedfe534cf\nStep 13/43 : ADD --chown=opam:opam ./euscitojoypad_db/prerendered_index.html /app/euscitojoypad_db/prerendered_index.html\n ---> 328b877be89e\nStep 14/43 : COPY --from=build-stage-1 --chown=opam:opam /app/build /app/frontend/build\n ---> 9ddcbc3fe1ac\nStep 15/43 : RUN chown opam:opam /app/frontend /app/frontend/build /app/frontend/public /app/euscitojoypad_db\n ---> Running in b126559ff2da\nRemoving intermediate container b126559ff2da\n ---> 52601d283325\nStep 16/43 : RUN apk add upx\n ---> Running in dcdb30415fbe\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/community/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/edge/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/edge/community/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/edge/testing/x86_64/APKINDEX.tar.gz\n(1/2) Installing ucl (1.03-r1)\n(2/2) Installing upx (3.96-r1)\nExecuting busybox-1.35.0-r17.trigger\nOK: 234 MiB in 89 packages\nRemoving intermediate container dcdb30415fbe\n ---> e156d96820d8\nStep 17/43 : USER opam\n ---> Running in d1bc05932142\nRemoving intermediate container d1bc05932142\n ---> 45e31bb7bc58\nStep 18/43 : WORKDIR /app\n ---> Running in d874695f1efa\nRemoving intermediate container d874695f1efa\n ---> bd05864165ab\nStep 19/43 : ENV PATH /home/opam/.opam/4.14/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n ---> Running in d07e8a49a2e0\nRemoving intermediate container d07e8a49a2e0\n ---> 2ac7c3a4b2c9\nStep 20/43 : RUN dune build @install\n ---> Running in 41f9af79e81f\nRemoving intermediate container 41f9af79e81f\n ---> a5c4e0e7acad\nStep 21/43 : RUN chmod +w /app/_build/default/src/e_uscito_joypad.exe &&     upx /app/_build/default/src/e_uscito_joypad.exe\n ---> Running in b0e65a84557c\n                       Ultimate Packer for eXecutables\n                          Copyright (C) 1996 - 2020\nUPX 3.96        Markus Oberhumer, Laszlo Molnar & John Reiser   Jan 23rd 2020\n\n        File size         Ratio      Format      Name\n   --------------------   ------   -----------   -----------\n  34735312 ->  11864144   34.16%   linux/amd64   e_uscito_joypad.exe\n\nPacked 1 file.\nRemoving intermediate container b0e65a84557c\n ---> d4130d31b65f\nStep 22/43 : USER root\n ---> Running in e1b8e1f0a68a\nRemoving intermediate container e1b8e1f0a68a\n ---> 5345c511ba8e\nStep 23/43 : RUN mv /app/_build/default/src/e_uscito_joypad.exe /usr/local/bin/e_uscito_joypad\n ---> Running in 1b3dde2f4757\nRemoving intermediate container 1b3dde2f4757\n ---> 78e9b9a4be26\nStep 24/43 : RUN chown root:root /usr/local/bin/e_uscito_joypad\n ---> Running in f4b8978b59fd\nRemoving intermediate container f4b8978b59fd\n ---> 057d75f12ea7\nStep 25/43 : FROM alpine:latest\n ---> 49176f190c7e\nStep 26/43 : COPY --from=build-stage-2 /usr/local/bin/e_uscito_joypad /usr/local/bin/\n ---> cb3f2ad8c32d\nStep 27/43 : RUN apk update\n ---> Running in f35868f64d9c\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\nv3.17.0-298-g2104b16d70 [https://dl-cdn.alpinelinux.org/alpine/v3.17/main]\nv3.17.0-299-gc0880a1380 [https://dl-cdn.alpinelinux.org/alpine/v3.17/community]\nOK: 17813 distinct packages available\nRemoving intermediate container f35868f64d9c\n ---> d8171266fdcf\nStep 28/43 : RUN apk add --no-cache                                      gmp libev ca-certificates ca-certificates-bundle        libstdc++ libpq libffi tzdata\n ---> Running in 90bfb7ff5b44\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\n(1/8) Installing ca-certificates (20220614-r3)\n(2/8) Installing gmp (6.2.1-r2)\n(3/8) Installing libev (4.33-r0)\n(4/8) Installing libffi (3.4.4-r0)\n(5/8) Installing libpq (15.1-r0)\n(6/8) Installing libgcc (12.2.1_git20220924-r4)\n(7/8) Installing libstdc++ (12.2.1_git20220924-r4)\n(8/8) Installing tzdata (2022f-r1)\nExecuting busybox-1.35.0-r29.trigger\nExecuting ca-certificates-20220614-r3.trigger\nOK: 14 MiB in 23 packages\nRemoving intermediate container 90bfb7ff5b44\n ---> a68c0bd3b735\nStep 29/43 : ENV TZ=Europe/Rome\n ---> Running in a5f400734034\nRemoving intermediate container a5f400734034\n ---> 57c90a8aa3b2\nStep 30/43 : ENV REST_LISTEN_ADDRESS=0.0.0.0\n ---> Running in c6f12dcb2482\nRemoving intermediate container c6f12dcb2482\n ---> a0e84a1939c1\nStep 31/43 : ENV REST_LISTEN_PORT=3000\n ---> Running in 6d13c47b7953\nRemoving intermediate container 6d13c47b7953\n ---> 334f62f2c6ef\nStep 32/43 : ENV DEBUG=True\n ---> Running in f5461d1cad07\nRemoving intermediate container f5461d1cad07\n ---> 402ada424d64\nStep 33/43 : ENV MEDIA_URL=\"bo/files/\"\n ---> Running in 0dc0e95e82dc\nRemoving intermediate container 0dc0e95e82dc\n ---> 107e31d769b4\nStep 34/43 : ENV GC_PERIOD_SEC=60\n ---> Running in 5f329237ce2a\nRemoving intermediate container 5f329237ce2a\n ---> 473484e601a5\nStep 35/43 : ENV PGHOST=postgresql\n ---> Running in 9d22f552a3ef\nRemoving intermediate container 9d22f552a3ef\n ---> e6375452493a\nStep 36/43 : ENV PGPORT=5432\n ---> Running in 904c1417d6c5\nRemoving intermediate container 904c1417d6c5\n ---> 3368b1bb280f\nStep 37/43 : ENV PGUSER=django_db_user\n ---> Running in fca95a10fad3\nRemoving intermediate container fca95a10fad3\n ---> 0f319ef43896\nStep 38/43 : ENV PGPASSWORD=admin\n ---> Running in 0c9d7b5341a4\nRemoving intermediate container 0c9d7b5341a4\n ---> 3e4fdc580502\nStep 39/43 : ENV PGDATABASE=euj\n ---> Running in dd335b452f09\nRemoving intermediate container dd335b452f09\n ---> a7cca894addf\nStep 40/43 : COPY Dockerfile /Dockerfile\n ---> e4ad44351e40\nStep 41/43 : WORKDIR /\n ---> Running in 1ad29d58a2d7\nRemoving intermediate container 1ad29d58a2d7\n ---> 7fe10e63bf7f\nStep 42/43 : EXPOSE 3000\n ---> Running in 8c203258a4b5\nRemoving intermediate container 8c203258a4b5\n ---> abf6496e415f\nStep 43/43 : CMD [ \"/usr/local/bin/e_uscito_joypad\" ]\n ---> Running in 161d3303579c\nRemoving intermediate container 161d3303579c\n ---> 53ebcb4f506f\nSuccessfully built 53ebcb4f506f\nSuccessfully tagged e-uscito-joypad:latest\n","stderr":"","imageSize":26499937},"repair":{"violations":[],"repairedDockerfile":"#################\n# BUILD PHASE 1 #\n#################\nFROM node:16-alpine3.11 AS build-stage-1\nWORKDIR /app\nCOPY ./frontend/package.json ./frontend/yarn.lock ./\nRUN yarn\nCOPY ./frontend/ ./\nRUN yarn build\n\n#################\n# BUILD PHASE 2 #\n#################\nFROM pdonadeo/e-uscito-joypad-base:latest AS build-stage-2\n\nUSER root\nADD --chown=opam:opam ./dune ./dune-project /app/\nADD --chown=opam:opam ./src /app/src\nRUN mkdir -p /app/euscitojoypad_db /app/frontend/public /app/frontend/build\nADD --chown=opam:opam ./frontend/public /app/frontend/public\nADD --chown=opam:opam ./euscitojoypad_db/prerendered_index.html /app/euscitojoypad_db/prerendered_index.html\nCOPY --from=build-stage-1 --chown=opam:opam /app/build /app/frontend/build\nRUN chown opam:opam /app/frontend /app/frontend/build /app/frontend/public /app/euscitojoypad_db\nRUN apk add upx\n\nUSER opam\nWORKDIR /app\nENV PATH /home/opam/.opam/4.14/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\n\nRUN dune build @install\nRUN chmod +w /app/_build/default/src/e_uscito_joypad.exe && \\\n    upx /app/_build/default/src/e_uscito_joypad.exe\n\nUSER root\nRUN mv /app/_build/default/src/e_uscito_joypad.exe /usr/local/bin/e_uscito_joypad\nRUN chown root:root /usr/local/bin/e_uscito_joypad\n\n################\n# DEPLOY PHASE #\n################\nFROM alpine:latest\nCOPY --from=build-stage-2 /usr/local/bin/e_uscito_joypad /usr/local/bin/\nRUN apk update\nRUN apk add --no-cache                                  \\\n    gmp libev ca-certificates ca-certificates-bundle    \\\n    libstdc++ libpq libffi tzdata\nENV TZ=Europe/Rome\n\nENV REST_LISTEN_ADDRESS=0.0.0.0\nENV REST_LISTEN_PORT=3000\nENV DEBUG=True\nENV MEDIA_URL=\"bo/files/\"\nENV GC_PERIOD_SEC=60\nENV PGHOST=postgresql\nENV PGPORT=5432\nENV PGUSER=django_db_user\nENV PGPASSWORD=admin\nENV PGDATABASE=euj\n\nCOPY Dockerfile /Dockerfile\n\nWORKDIR /\nEXPOSE 3000\nCMD [ \"/usr/local/bin/e_uscito_joypad\" ]\n"},"endTime":1672022985873}