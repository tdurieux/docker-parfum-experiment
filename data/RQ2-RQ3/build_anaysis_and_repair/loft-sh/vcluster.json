{"repository":"https://github.com/loft-sh/vcluster","dockerfilePath":"Dockerfile","startTime":1672323259389,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/loft-sh/vcluster'...\n","error":null,"commit":"a56ec10b4a5b20b1dc386125bfe3fdebf521f2c1"},"originalBuild":{"startTimestamp":1672323264104,"endTimestamp":1672323405312,"error":null,"stdout":"Sending build context to Docker daemon  78.01MB\r\r\nStep 1/31 : FROM golang:1.19 as builder\n ---> 6650307efe4a\nStep 2/31 : WORKDIR /vcluster-dev\n ---> Running in a9239aa17afb\nRemoving intermediate container a9239aa17afb\n ---> fef4d6e57116\nStep 3/31 : ARG TARGETOS\n ---> Running in 154fc9aaef78\nRemoving intermediate container 154fc9aaef78\n ---> 8d7d023fbf5a\nStep 4/31 : ARG TARGETARCH\n ---> Running in 56fb0ac49be2\nRemoving intermediate container 56fb0ac49be2\n ---> c8b5e5612d62\nStep 5/31 : RUN curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl && chmod +x ./kubectl && mv ./kubectl /usr/local/bin/kubectl\n ---> Running in 67126db04ca3\n\u001b[91m  % Total    % Received % Xferd  Average Speed  \u001b[0m\u001b[91m Time    Time     Time  \u001b[0m\u001b[91mCurre\u001b[0m\u001b[91mnt\n  \u001b[0m\u001b[91m                             \u001b[0m\u001b[91m  Dlo\u001b[0m\u001b[91mad  Upload \u001b[0m\u001b[91m  Total   S\u001b[0m\u001b[91mpen\u001b[0m\u001b[91mt    Left\u001b[0m\u001b[91m  Speed\n\u001b[0m\u001b[91m\r  0   \u001b[0m\u001b[91m  0 \u001b[0m\u001b[91m   \u001b[0m\u001b[91m0  \u001b[0m\u001b[91m   \u001b[0m\u001b[91m0  \u001b[0m\u001b[91m  0    \u001b[0m\u001b[91m 0    \u001b[0m\u001b[91m  0    \u001b[0m\u001b[91m  0 --:\u001b[0m\u001b[91m--\u001b[0m\u001b[91m:--\u001b[0m\u001b[91m --:-\u001b[0m\u001b[91m-:-\u001b[0m\u001b[91m- --:-\u001b[0m\u001b[91m-:-\u001b[0m\u001b[91m-     0\u001b[0m\u001b[91m\r 34 45.7M   34 16.0M    0\u001b[0m\u001b[91m     0  20.6M \u001b[0m\u001b[91m     0  0:00:02 --:\u001b[0m\u001b[91m--:-- \u001b[0m\u001b[91m 0:\u001b[0m\u001b[91m00:\u001b[0m\u001b[91m02 20.5M\u001b[0m\u001b[91m\r100 45.7M  100 45.7M    0     0  34.8M      0  0:00:01  0:00:01\u001b[0m\u001b[91m --:--:-- 34\u001b[0m\u001b[91m.8M\n\u001b[0mRemoving intermediate container 67126db04ca3\n ---> 85fcd153d948\nStep 6/31 : RUN curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 && chmod 700 get_helm.sh && ./get_helm.sh\n ---> Running in 0ff1787a842d\nDownloading https://get.helm.sh/helm-v3.10.3-linux-amd64.tar.gz\nVerifying checksum... Done.\nPreparing to install helm into /usr/local/bin\nhelm installed into /usr/local/bin/helm\nRemoving intermediate container 0ff1787a842d\n ---> 086349b78204\nStep 7/31 : RUN if [ \"${TARGETARCH}\" = \"amd64\" ] || [ \"${TARGETARCH}\" = \"arm64\" ]; then go install github.com/go-delve/delve/cmd/dlv@latest; fi\n ---> Running in ca1c6bee5ff7\nRemoving intermediate container ca1c6bee5ff7\n ---> 764c8c69aa0b\nStep 8/31 : COPY go.mod go.mod\n ---> 816a170d7c84\nStep 9/31 : COPY go.sum go.sum\n ---> 9933232e072c\nStep 10/31 : COPY vendor/ vendor/\n ---> 8230b5158ca6\nStep 11/31 : COPY cmd/vcluster cmd/vcluster\n ---> 6d09bc1b7c3b\nStep 12/31 : COPY cmd/vclusterctl cmd/vclusterctl\n ---> d402061fec2e\nStep 13/31 : COPY pkg/ pkg/\n ---> af01deea89f1\nStep 14/31 : RUN ln -s \"$(pwd)/manifests\" /manifests\n ---> Running in 57e542ce17af\nRemoving intermediate container 57e542ce17af\n ---> 2b99b74bb2a1\nStep 15/31 : ENV GO111MODULE on\n ---> Running in 4df4ff3d4be1\nRemoving intermediate container 4df4ff3d4be1\n ---> 2e128003aaea\nStep 16/31 : ENV DEBUG true\n ---> Running in 53704ffa1e0c\nRemoving intermediate container 53704ffa1e0c\n ---> da0e7b4be818\nStep 17/31 : RUN mkdir -p /.cache /.config\n ---> Running in d1b16dccda61\nRemoving intermediate container d1b16dccda61\n ---> 4fe0cc6833a7\nStep 18/31 : ENV GOCACHE=/.cache\n ---> Running in c8bc67ac3002\nRemoving intermediate container c8bc67ac3002\n ---> 06ac471faf79\nStep 19/31 : ENV GOENV=/.config\n ---> Running in b26978917958\nRemoving intermediate container b26978917958\n ---> 66b189927bf0\nStep 20/31 : COPY charts/ charts/\n ---> 81699a351530\nStep 21/31 : COPY hack/ hack/\n ---> aa2647b2a4fb\nStep 22/31 : RUN go generate ./...\n ---> Running in f2c982939a1a\nSuccessfully packaged chart and saved it to: ../../../cmd/vclusterctl/cmd/charts/vcluster-0.0.1.tgz\nSuccessfully packaged chart and saved it to: ../../../cmd/vclusterctl/cmd/charts/vcluster-k8s-0.0.1.tgz\nSuccessfully packaged chart and saved it to: ../../../cmd/vclusterctl/cmd/charts/vcluster-k0s-0.0.1.tgz\nSuccessfully packaged chart and saved it to: ../../../cmd/vclusterctl/cmd/charts/vcluster-eks-0.0.1.tgz\nRemoving intermediate container f2c982939a1a\n ---> 5bfc550b822f\nStep 23/31 : ENV HOME /\n ---> Running in e9dba893a678\nRemoving intermediate container e9dba893a678\n ---> 81c5b4050367\nStep 24/31 : RUN CGO_ENABLED=0 GOOS=${TARGETOS} GOARCH=${TARGETARCH} GO111MODULE=on go build -mod vendor -o /vcluster cmd/vcluster/main.go\n ---> Running in f2d289f0539e\nRemoving intermediate container f2d289f0539e\n ---> cad34c33549e\nStep 25/31 : ENTRYPOINT [\"go\", \"run\", \"-mod\", \"vendor\", \"cmd/vcluster/main.go\"]\n ---> Running in 479db6199bd6\nRemoving intermediate container 479db6199bd6\n ---> 41964423f45d\nStep 26/31 : FROM alpine:3.16\n3.16: Pulling from library/alpine\nca7dd9ec2225: Pulling fs layer\nca7dd9ec2225: Download complete\nca7dd9ec2225: Pull complete\nDigest: sha256:b95359c2505145f16c6aa384f9cc74eeff78eb36d308ca4fd902eeeb0a0b161b\nStatus: Downloaded newer image for alpine:3.16\n ---> bfe296a52501\nStep 27/31 : WORKDIR /\n ---> Running in 77c67f8c1eb8\nRemoving intermediate container 77c67f8c1eb8\n ---> 2f05517301ea\nStep 28/31 : COPY --from=builder /vcluster .\n ---> 6a2eb07c513e\nStep 29/31 : COPY --from=builder /usr/local/bin/helm /usr/local/bin/helm\n ---> 26f014c7fdf8\nStep 30/31 : COPY manifests/ /manifests/\n ---> c1599133fa42\nStep 31/31 : ENTRYPOINT [\"/vcluster\", \"start\"]\n ---> Running in 00f00d90c328\nRemoving intermediate container 00f00d90c328\n ---> 5669d8b9ebb6\nSuccessfully built 5669d8b9ebb6\nSuccessfully tagged vcluster:latest\n","stderr":"","imageSize":130028303},"repair":{"violations":[{"name":"curlUseFlagF","position":{"start":8,"end":8,"columnStart":4,"columnEnd":173}},{"name":"curlUseFlagF","position":{"start":8,"end":8,"columnStart":72,"columnEnd":148}}],"repairedDockerfile":"# Build the manager binary\nFROM golang:1.19 as builder\n\nWORKDIR /vcluster-dev\nARG TARGETOS\nARG TARGETARCH\n\n# Install kubectl for development\nRUN curl -f -LO https://storage.googleapis.com/kubernetes-release/release/$( curl -f -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl && chmod +x ./kubectl && mv ./kubectl /usr/local/bin/kubectl\n\n# Install helm binary\nRUN curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 && chmod 700 get_helm.sh && ./get_helm.sh\n\n# Install Delve for debugging\nRUN if [ \"${TARGETARCH}\" = \"amd64\" ] || [ \"${TARGETARCH}\" = \"arm64\" ]; then go install github.com/go-delve/delve/cmd/dlv@latest; fi\n\n# Copy the Go Modules manifests\nCOPY go.mod go.mod\nCOPY go.sum go.sum\nCOPY vendor/ vendor/\n\n# Copy the go source\nCOPY cmd/vcluster cmd/vcluster\nCOPY cmd/vclusterctl cmd/vclusterctl\nCOPY pkg/ pkg/\n\n# Symlink /manifests folder to the synced location for development purposes\nRUN ln -s \"$(pwd)/manifests\" /manifests\n\nENV GO111MODULE on\nENV DEBUG true\n\n# create and set GOCACHE now, this should slightly speed up the first build inside of the container\n# also create /.config folder for GOENV, as dlv needs to write there when starting debugging\nRUN mkdir -p /.cache /.config\nENV GOCACHE=/.cache\nENV GOENV=/.config\n\n# Copy and embed the helm charts\nCOPY charts/ charts/\nCOPY hack/ hack/\nRUN go generate ./...\n\n# Set home to \"/\" in order to for kubectl to automatically pick up vcluster kube config\nENV HOME /\n\n# Build cmd\nRUN CGO_ENABLED=0 GOOS=${TARGETOS} GOARCH=${TARGETARCH} GO111MODULE=on go build -mod vendor -o /vcluster cmd/vcluster/main.go\n\n# RUN useradd -u 12345 nonroot\n# USER nonroot\n\nENTRYPOINT [\"go\", \"run\", \"-mod\", \"vendor\", \"cmd/vcluster/main.go\"]\n\n# we use alpine for easier debugging\nFROM alpine:3.16\n\n# Set root path as working directory\nWORKDIR /\n\nCOPY --from=builder /vcluster .\nCOPY --from=builder /usr/local/bin/helm /usr/local/bin/helm\nCOPY manifests/ /manifests/\n\n# RUN useradd -u 12345 nonroot\n# USER nonroot\n\nENTRYPOINT [\"/vcluster\", \"start\"]\n"},"repairedBuild":{"startTimestamp":1672323405664,"endTimestamp":1672323589176,"error":null,"stdout":"Sending build context to Docker daemon  78.01MB\r\r\nStep 1/31 : FROM golang:1.19 as builder\n ---> 6650307efe4a\nStep 2/31 : WORKDIR /vcluster-dev\n ---> Running in 2bb07b769074\nRemoving intermediate container 2bb07b769074\n ---> 9713a1794c6b\nStep 3/31 : ARG TARGETOS\n ---> Running in 1963aa6946d4\nRemoving intermediate container 1963aa6946d4\n ---> 7f010d534656\nStep 4/31 : ARG TARGETARCH\n ---> Running in e2099cb9b048\nRemoving intermediate container e2099cb9b048\n ---> c6daddfafbfc\nStep 5/31 : RUN curl -f -LO https://storage.googleapis.com/kubernetes-release/release/$( curl -f -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl && chmod +x ./kubectl && mv ./kubectl /usr/local/bin/kubectl\n ---> Running in f6d7d9fa10c9\n\u001b[91m  % Total    % Received % Xferd  Average Speed   Time    Time  \u001b[0m\u001b[91m   Time  Current\n                           \u001b[0m\u001b[91m      Dload\u001b[0m\u001b[91m  Upload   Total   Spent    Left  S\u001b[0m\u001b[91mpeed\n\u001b[0m\u001b[91m\r  0\u001b[0m\u001b[91m     0\u001b[0m\u001b[91m    0 \u001b[0m\u001b[91m    0 \u001b[0m\u001b[91m   0 \u001b[0m\u001b[91m    0 \u001b[0m\u001b[91m     0\u001b[0m\u001b[91m      0 --:\u001b[0m\u001b[91m--:-- --:--\u001b[0m\u001b[91m:-- --\u001b[0m\u001b[91m:--:--\u001b[0m\u001b[91m     \u001b[0m\u001b[91m0\u001b[0m\u001b[91m\r 76 45.7M   76 34.9M    0     0  67.\u001b[0m\u001b[91m9M      0 --:-\u001b[0m\u001b[91m-:-- \u001b[0m\u001b[91m--:\u001b[0m\u001b[91m--:-- --:--:-- 67\u001b[0m\u001b[91m.7M\u001b[0m\u001b[91m\r100 45.7M  100 45.7M    0     0  74.8M      0 --:--:-- --:--:-- --:--:-- 74.\u001b[0m\u001b[91m7M\n\u001b[0mRemoving intermediate container f6d7d9fa10c9\n ---> ce707f86b7c8\nStep 6/31 : RUN curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 && chmod 700 get_helm.sh && ./get_helm.sh\n ---> Running in df9cbab1098a\nDownloading https://get.helm.sh/helm-v3.10.3-linux-amd64.tar.gz\nVerifying checksum... Done.\nPreparing to install helm into /usr/local/bin\nhelm installed into /usr/local/bin/helm\nRemoving intermediate container df9cbab1098a\n ---> ea70f1925eea\nStep 7/31 : RUN if [ \"${TARGETARCH}\" = \"amd64\" ] || [ \"${TARGETARCH}\" = \"arm64\" ]; then go install github.com/go-delve/delve/cmd/dlv@latest; fi\n ---> Running in 0c15aee908e4\nRemoving intermediate container 0c15aee908e4\n ---> 3eecbc8d5aca\nStep 8/31 : COPY go.mod go.mod\n ---> d99e6bf625e7\nStep 9/31 : COPY go.sum go.sum\n ---> 0193fc5f67d8\nStep 10/31 : COPY vendor/ vendor/\n ---> d65d7901a0ef\nStep 11/31 : COPY cmd/vcluster cmd/vcluster\n ---> 753f0e749b68\nStep 12/31 : COPY cmd/vclusterctl cmd/vclusterctl\n ---> e20634c690f8\nStep 13/31 : COPY pkg/ pkg/\n ---> ec5f114e7e07\nStep 14/31 : RUN ln -s \"$(pwd)/manifests\" /manifests\n ---> Running in 9c4c45dc9fe7\nRemoving intermediate container 9c4c45dc9fe7\n ---> 74a2e6659140\nStep 15/31 : ENV GO111MODULE on\n ---> Running in 18c84cb1526d\nRemoving intermediate container 18c84cb1526d\n ---> ed6ebf16b6b9\nStep 16/31 : ENV DEBUG true\n ---> Running in 96f523b0343d\nRemoving intermediate container 96f523b0343d\n ---> 07c6b5c96c9d\nStep 17/31 : RUN mkdir -p /.cache /.config\n ---> Running in a5ddf667754a\nRemoving intermediate container a5ddf667754a\n ---> 1c876baaaa09\nStep 18/31 : ENV GOCACHE=/.cache\n ---> Running in 1ee092565d89\nRemoving intermediate container 1ee092565d89\n ---> f582a9f61139\nStep 19/31 : ENV GOENV=/.config\n ---> Running in 75e7283767ed\nRemoving intermediate container 75e7283767ed\n ---> 915dc5da6298\nStep 20/31 : COPY charts/ charts/\n ---> 3de98c3f5600\nStep 21/31 : COPY hack/ hack/\n ---> 9b01d4041fe2\nStep 22/31 : RUN go generate ./...\n ---> Running in 85b00aa8a80f\nSuccessfully packaged chart and saved it to: ../../../cmd/vclusterctl/cmd/charts/vcluster-0.0.1.tgz\nSuccessfully packaged chart and saved it to: ../../../cmd/vclusterctl/cmd/charts/vcluster-k8s-0.0.1.tgz\nSuccessfully packaged chart and saved it to: ../../../cmd/vclusterctl/cmd/charts/vcluster-k0s-0.0.1.tgz\nSuccessfully packaged chart and saved it to: ../../../cmd/vclusterctl/cmd/charts/vcluster-eks-0.0.1.tgz\nRemoving intermediate container 85b00aa8a80f\n ---> 153184982820\nStep 23/31 : ENV HOME /\n ---> Running in b49c5eea479a\nRemoving intermediate container b49c5eea479a\n ---> f3251f44da6e\nStep 24/31 : RUN CGO_ENABLED=0 GOOS=${TARGETOS} GOARCH=${TARGETARCH} GO111MODULE=on go build -mod vendor -o /vcluster cmd/vcluster/main.go\n ---> Running in eaaf3ecd6791\nRemoving intermediate container eaaf3ecd6791\n ---> b603f891eb99\nStep 25/31 : ENTRYPOINT [\"go\", \"run\", \"-mod\", \"vendor\", \"cmd/vcluster/main.go\"]\n ---> Running in 20e2474f3a72\nRemoving intermediate container 20e2474f3a72\n ---> dfc6606a1cb4\nStep 26/31 : FROM alpine:3.16\n ---> bfe296a52501\nStep 27/31 : WORKDIR /\n ---> Running in 80981fdd3ba5\nRemoving intermediate container 80981fdd3ba5\n ---> 795ad23ae8e1\nStep 28/31 : COPY --from=builder /vcluster .\n ---> 06c25a1f429b\nStep 29/31 : COPY --from=builder /usr/local/bin/helm /usr/local/bin/helm\n ---> d66a01b9725f\nStep 30/31 : COPY manifests/ /manifests/\n ---> 999be010beed\nStep 31/31 : ENTRYPOINT [\"/vcluster\", \"start\"]\n ---> Running in 5c03fee755bf\nRemoving intermediate container 5c03fee755bf\n ---> dd51bd00076d\nSuccessfully built dd51bd00076d\nSuccessfully tagged vcluster:latest\n","stderr":"","imageSize":130028303},"endTime":1672323589567}