{"repository":"https://github.com/pelias/csv-importer","dockerfilePath":"Dockerfile","startTime":1672472835955,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/pelias/csv-importer'...\n","error":null,"commit":"88f6538e5b1904e34a32f9494ca1d21e05dea6bd"},"originalBuild":{"startTimestamp":1672472836778,"endTimestamp":1672472903226,"error":null,"stdout":"Sending build context to Docker daemon  108.5kB\r\r\nStep 1/9 : FROM pelias/baseimage\nlatest: Pulling from pelias/baseimage\n284055322776: Pulling fs layer\nfabdd7f2922a: Pulling fs layer\nf8540ef0f7df: Pulling fs layer\n6299b98d2899: Pulling fs layer\nb7a0afcdeee8: Pulling fs layer\na9224d0dd888: Pulling fs layer\n8cbdbe752c4e: Pulling fs layer\nb2c4749dd6b0: Pulling fs layer\n19098de62ed7: Pulling fs layer\nbda15fdc95e9: Pulling fs layer\n625428d5e357: Pulling fs layer\na30d3ceac264: Pulling fs layer\nb7a0afcdeee8: Waiting\nbda15fdc95e9: Waiting\na9224d0dd888: Waiting\na30d3ceac264: Waiting\n8cbdbe752c4e: Waiting\n6299b98d2899: Waiting\n19098de62ed7: Waiting\nb2c4749dd6b0: Waiting\nfabdd7f2922a: Verifying Checksum\nfabdd7f2922a: Download complete\n284055322776: Verifying Checksum\n284055322776: Download complete\n6299b98d2899: Verifying Checksum\n6299b98d2899: Download complete\nb7a0afcdeee8: Verifying Checksum\nb7a0afcdeee8: Download complete\nf8540ef0f7df: Verifying Checksum\nf8540ef0f7df: Download complete\na9224d0dd888: Download complete\n8cbdbe752c4e: Verifying Checksum\n8cbdbe752c4e: Download complete\n284055322776: Pull complete\nfabdd7f2922a: Pull complete\nbda15fdc95e9: Download complete\n625428d5e357: Verifying Checksum\n625428d5e357: Download complete\n19098de62ed7: Verifying Checksum\n19098de62ed7: Download complete\nb2c4749dd6b0: Verifying Checksum\nb2c4749dd6b0: Download complete\na30d3ceac264: Download complete\nf8540ef0f7df: Pull complete\n6299b98d2899: Pull complete\nb7a0afcdeee8: Pull complete\na9224d0dd888: Pull complete\n8cbdbe752c4e: Pull complete\nb2c4749dd6b0: Pull complete\n19098de62ed7: Pull complete\nbda15fdc95e9: Pull complete\n625428d5e357: Pull complete\na30d3ceac264: Pull complete\nDigest: sha256:3f8e7b2cd36fee21a33bfcd114666a65bd01ca248a3f65d710ba1f393cf803bf\nStatus: Downloaded newer image for pelias/baseimage:latest\n ---> 20d46db0f488\nStep 2/9 : RUN apt-get update && apt-get install -y unzip && rm -rf /var/lib/apt/lists/*\n ---> Running in e1b0edce4240\nGet:1 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]\nGet:2 http://archive.ubuntu.com/ubuntu bionic InRelease [242 kB]\nGet:3 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]\nGet:4 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [83.3 kB]\nGet:5 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [3,099 kB]\nGet:6 http://archive.ubuntu.com/ubuntu bionic/multiverse amd64 Packages [186 kB]\nGet:7 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [1,311 kB]\nGet:8 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [1,568 kB]\nGet:9 http://archive.ubuntu.com/ubuntu bionic/restricted amd64 Packages [13.5 kB]\nGet:10 http://archive.ubuntu.com/ubuntu bionic/universe amd64 Packages [11.3 MB]\nGet:11 http://security.ubuntu.com/ubuntu bionic-security/multiverse amd64 Packages [22.9 kB]\nGet:12 http://archive.ubuntu.com/ubuntu bionic/main amd64 Packages [1,344 kB]\nGet:13 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [2,342 kB]\nGet:14 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [3,524 kB]\nGet:15 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 Packages [30.0 kB]\nGet:16 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [1,352 kB]\nGet:17 http://archive.ubuntu.com/ubuntu bionic-backports/universe amd64 Packages [20.5 kB]\nGet:18 http://archive.ubuntu.com/ubuntu bionic-backports/main amd64 Packages [64.0 kB]\nFetched 26.7 MB in 2s (13.2 MB/s)\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nSuggested packages:\n  zip\nThe following NEW packages will be installed:\n  unzip\n0 upgraded, 1 newly installed, 0 to remove and 55 not upgraded.\nNeed to get 168 kB of archives.\nAfter this operation, 567 kB of additional disk space will be used.\nGet:1 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 unzip amd64 6.0-21ubuntu1.2 [168 kB]\nFetched 168 kB in 0s (1,049 kB/s)\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 8575 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-21ubuntu1.2_amd64.deb ...\r\nUnpacking unzip (6.0-21ubuntu1.2) ...\r\nSetting up unzip (6.0-21ubuntu1.2) ...\r\nRemoving intermediate container e1b0edce4240\n ---> 2f55bc3dfbef\nStep 3/9 : ENV WORKDIR /code/pelias/csv-importer\n ---> Running in 554ba165ae57\nRemoving intermediate container 554ba165ae57\n ---> c332a8b6b305\nStep 4/9 : WORKDIR ${WORKDIR}\n ---> Running in 4955b166538f\nRemoving intermediate container 4955b166538f\n ---> 09ae2380f12d\nStep 5/9 : COPY ./package.json ${WORKDIR}\n ---> 968aaa3e6416\nStep 6/9 : RUN npm install\n ---> Running in cc54084f336b\n\u001b[91mnpm\u001b[0m\u001b[91m WARN deprecated formidable@1.2.6: Please upgrade to latest, formidable@v2 or formidable@v3! Check these notes: https://bit.ly/2ZEqIau\n\u001b[0m\u001b[91mnpm WARN deprecated har-validator@5.1.5: this library is no longer supported\n\u001b[0m\u001b[91mnpm WARN deprecated stable@0.1.8: Modern JS already guarantees Array#sort() is a stable sort, so this library is deprecated. See the compatibility table on MDN: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort#browser_compatibility\n\u001b[0m\u001b[91mnpm WARN deprecated uuid@3.4.0: Please upgrade  to version 7 or higher.  Older versions may use Math.random() in certain circumstances, which is known to be problematic.  See https://v8.dev/blog/math-random for details.\n\u001b[0m\u001b[91mnpm WARN deprecated @hapi/topo@3.1.6: This version has been deprecated and is no longer supported or maintained\n\u001b[0m\u001b[91mnpm WARN deprecated @hapi/address@2.1.4: Moved to 'npm install @sideway/address'\n\u001b[0m\u001b[91mnpm WARN deprecated @hapi/pinpoint@1.0.2: Moved to 'npm install @sideway/pinpoint'\n\u001b[0m\u001b[91mnpm WARN deprecated @hapi/formula@1.2.0: Moved to 'npm install @sideway/formula'\n\u001b[0m\u001b[91mnpm WARN deprecated @hapi/hoek@8.5.1: This version has been deprecated and is no longer supported or maintained\n\u001b[0m\u001b[91mnpm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142\n\u001b[0m\u001b[91mnpm WARN deprecated superagent@5.3.1: Please upgrade to v7.0.2+ of superagent.  We have fixed numerous issues with streams, form-data, attach(), filesystem errors not bubbling up (ENOENT on attach()), and all tests are now passing.  See the releases tab for more information at <https://github.com/visionmedia/superagent/releases>.\n\u001b[0m\u001b[91mnpm WARN deprecated @hapi/joi@16.1.8: Switch to 'npm install joi'\n\u001b[0m\u001b[91mnpm WARN deprecated elasticsearch@16.7.3: Package no longer supported. Contact Support at https://www.npmjs.com/support for more info.\n\u001b[0m\nadded 304 packages, and audited 305 packages in 35s\n\n71 packages are looking for funding\n  run `npm fund` for details\n\n3 high severity vulnerabilities\n\nTo address all issues (including breaking changes), run:\n  npm audit fix --force\n\nRun `npm audit` for details.\n\u001b[91mnpm notice \nnpm notice New major version of npm available! 8.1.2 -> 9.2.0\nnpm notice Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\nnpm notice Run `npm install -g npm@9.2.0` to update!\nnpm notice\u001b[0m\u001b[91m \n\u001b[0mRemoving intermediate container cc54084f336b\n ---> ac7bacf1a77f\nStep 7/9 : ADD . ${WORKDIR}\n ---> c8b5ee5646ef\nStep 8/9 : USER pelias\n ---> Running in 91ba9c3fac90\nRemoving intermediate container 91ba9c3fac90\n ---> 33088661718c\nStep 9/9 : RUN npm test\n ---> Running in edcdfbd444a6\n\n> pelias-csv-importer@0.0.0-dev test\n> NODE_ENV=test npm run units\n\n\n> pelias-csv-importer@0.0.0-dev units\n> node test/test.js | tap-spec\n\n\n  missing imports should throw error\n\n    ✔ should throw\n\n  non-object imports should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  missing imports.csv should throw error\n\n    ✔ should throw\n\n  non-object imports.csv should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  missing datapath should not throw error\n\n    ✔ datapath is not required\n\n  non-string datapath should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  non-array files should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  non-string elements in files array should throw error\n\n    ✔ files elements must be strings\n    ✔ files elements must be strings\n    ✔ files elements must be strings\n    ✔ files elements must be strings\n    ✔ files elements must be strings\n\n  non-boolean adminLookup should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  non-boolean deduplicate should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  unknown config fields should throw error\n\n    ✔ unknown fields should be disallowed\n\n  configuration with only datapath should not throw error\n\n    ✔ config should be valid\n\n  valid configuration should not throw error\n\n    ✔ config should be valid\n\n  unknown children of imports should not throw error\n\n    ✔ config should be valid\n\n  unknown children of root should not throw error\n\n    ✔ config should be valid\n\n  config.generate throwing error should rethrow\n\n    ✔ should be strictly equal\n    ✔ should throw\n\n  interpretUserArgs() allows missing datapath\n\n    ✔ Non-failure exit code and message set\n\n  interpretUserArgs returns dir from pelias config if set\n\n    ✔ path should be equal to path from config\n\n  interpretUserArgs returns normalized path from config\n\n    ✔ path should be equal to path from config\n\n  getFileList returns all .csv path names when config has empty files list\n\n    ✔ should be strictly equal\n    ✔ should be truthy\n    ✔ should be truthy\n    ✔ should be truthy\n\n  getFileList returns all .csv path names when config doesn't have files property\n\n    ✔ should be strictly equal\n    ✔ should be truthy\n    ✔ should be truthy\n    ✔ should be truthy\n\n  getFileList returns fully qualified path names when config has a files list\n\n    ✔ file names should be equal\n\n  getFileList handles parallel builds\n\n\n  3 workers, id 0\n\n    ✔ only first file is indexed\n\n  3 workers, id 1\n\n    ✔ only second file indexed\n\n  3 workers, id 2\n\n    ✔ only third file indexed\n\n  3 workers, id 3\n\n    ✔ file list is empty\n\n  documentStream catches records with no street\n\n    2022-12-31T07:48:22.506Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Invalid centroid. NUMBER=5\n    ✔ no documents should be pushed\n    ✔ bad record count updated\n\n  documentStream catches records with no lat\n\n    2022-12-31T07:48:22.511Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Invalid centroid. name=foo, LON=7\n    ✔ no documents should be pushed\n    ✔ bad record count updated\n\n  documentStream catches records with no lon\n\n    2022-12-31T07:48:22.512Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Invalid centroid. name=foo, LAT=7\n    ✔ no documents should be pushed\n    ✔ bad record count updated\n\n  documentStream does not set zipcode if zipcode is emptystring\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ should be strictly equal\n\n  documentStream accepts zipcode instead of POSTCODE\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ should be strictly equal\n\n  documentStream accepts postalcode instead of POSTCODE\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ should be strictly equal\n\n  documentStream uses id value over hash if present\n\n    ✔ id should be correct\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream uses HASH value if present\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream uses NAME value if present\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ name set correctly\n\n  documentStream uses name value if present (over NAME)\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ name set correctly\n\n  documentStream uses source value if present (over SOURCE)\n\n    ✔ source set correctly\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream uses SOURCE value if present (and source not present)\n\n    ✔ source set correctly\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream uses layer_id value if present\n\n    ✔ layer set correctly\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream parses JSON from addendum_json_* field\n\n    ✔ custom data is added to record\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream parses empty JSON from addendum_json_* field\n\n    ✔ undefined custom data is added to record\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream parses undefined JSON from addendum_json_* field\n\n    ✔ undefined custom data is added to record\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream does not parse corrupt JSON from addendum_json_* field\n\n    2022-12-31T07:48:22.524Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Unexpected end of JSON input. NUMBER=5, STREET=101st Avenue, LAT=5, LON=6, HASH=abcd, layer_id=desired-layer, addendum_json_custom_field={ \"foo\": \"bar\n    ✔ the document should not be pushed\n    ✔ bad record count 1\n\n  documentStream parses JSON from name_json_* field\n\n    ✔ the document should be pushed\n    ✔ default name is added to record\n    ✔ fr name is added to record\n    ✔ fr name is added to record\n    ✔ bad record count unchanged\n\n  documentStream ignores empty JSON from name_json_* field\n\n    ✔ the document should be pushed\n    ✔ default name is added to record\n    ✔ fr name is not added to record\n    ✔ fr name aliases are not added to record\n    ✔ bad record count unchanged\n\n  documentStream fails on bad JSON from name_json_* field\n\n    2022-12-31T07:48:22.527Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Unexpected end of JSON input. LAT=5, LON=6, HASH=abcd, layer_id=desired-layer, name_json_fr=[\"bar\", \"b, name_json=[\"foo\"]\n    ✔ the document should not be pushed\n    ✔ bad record count unchanged\n\n  documentStream parses JSON from category_json field\n\n    ✔ the document should be pushed\n    ✔ default name is added to record\n    ✔ default name is added to record\n    ✔ bad record count unchanged\n\n  documentStream ignores empty JSON from category_json field\n\n    ✔ the document should be pushed\n    ✔ default name is added to record\n    ✔ category is added to record, empty category_json ignored\n    ✔ bad record count unchanged\n\n  documentStream ignores undefined JSON from category_json field\n\n    ✔ the document should be pushed\n    ✔ default name is added to record\n    ✔ category is added to record, empty category_json ignored\n    ✔ bad record count unchanged\n\n  documentStream accepts popularity\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ should be strictly equal\n\n  documentStream rejects invalid popularity\n\n    2022-12-31T07:48:22.530Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Popularity must be an int, got 500a0. NUMBER=5, STREET=101st Avenue, LAT=5, LON=6, postalcode=10010, popularity=500a0\n    ✔ the document should be skipped\n    ✔ bad record count went up by 1\n\n  documentStream accepts parent value if present\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream accepts multiple parent values if present\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream rejects parent without name property\n\n    2022-12-31T07:48:22.532Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to invalid document type, expecting: string got: undefined. LAT=5, LON=6, popularity=500, country=[id=NOR]\n    ✔ the document should be rejected\n    ✔ bad record count went up by 1\n\n  documentStream rejects parent without id property\n\n    2022-12-31T07:48:22.532Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to invalid document type, expecting: string got: undefined. LAT=5, LON=6, popularity=500, country=[name=NOR]\n    ✔ the document should be rejected\n    ✔ bad record count went up by 1\n\n  documentStream rejects parent with invalid structure\n\n    2022-12-31T07:48:22.533Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to invalid document type, expecting: string got: undefined. LAT=5, LON=6, popularity=500, name=NOR\n    ✔ the document should be rejected\n    ✔ bad record count went up by 1\n\n  documentStream rejects parent with non-existing parent\n\n    2022-12-31T07:48:22.533Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to invalid property: land, should be one of: continent,country,dependency,macroregion,region,macrocounty,county,borough,locality,localadmin,neighbourhood,postalcode,ocean,marinearea,empire. LAT=5, LON=6, popularity=500, name=NOR\n    ✔ the document should be rejected\n    ✔ bad record count went up by 1\n\n  documentStream ignores non-existing parent field property\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  importPipelines.createRecordStream() creates Document objects with expected values.\n\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.537Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-1anochw.12ceg\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.541Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-1anochw.12ceg, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.542Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-ix90mn.j7ul\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.543Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-ix90mn.j7ul, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.544Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-x7jz3.kfn2i9\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.545Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-x7jz3.kfn2i9, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.546Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-1rybfib.892q\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.547Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-1rybfib.892q, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.547Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-1vhcenh.7sz\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.548Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-1vhcenh.7sz, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.549Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-1dpjbd9.valc\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Street matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.550Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-1dpjbd9.valc, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.550Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-1jmvc42.51jt\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Street matches\n    ✔ Housenumber matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.552Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-1jmvc42.51jt, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.552Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-vb7k0n.zcc27\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Street matches\n    ✔ Housenumber matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.553Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-vb7k0n.zcc27, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.554Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-zw6kqb.20qs\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Street matches\n    ✔ Housenumber matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.555Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-zw6kqb.20qs, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.555Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-1d1v3wj.lq5mi\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.557Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-1d1v3wj.lq5mi, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.557Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-1s1e9bj.oz7r\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.560Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-1s1e9bj.oz7r, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.560Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-65yjk1.h8w2\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.561Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-65yjk1.h8w2, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.562Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-1c7posb.dlmv\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.563Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-1c7posb.dlmv, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:22.563Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-8n5iru.pdnbi\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:22.564Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-8n5iru.pdnbi, goodRecordCount=1 badRecordCount=0\n\n  getIdPrefix returns prefix based on irectory structure\n\n    ✔ correct prefix generated\n\n  getIdPrefix handles multiple levels of heirarchy\n\n    ✔ correct prefix generated\n\n  getIdPrefix returns basename without extension when invalid basepath given\n\n    ✔ should be strictly equal\n\n\n  total:     272\n  passing:   272\n  duration:  233ms\n\n\n\u001b[91mnpm\u001b[0m\u001b[91m \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m \nnpm\u001b[0m\u001b[91m \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m New major version of npm available! 8.1.2 -> 9.2.0\n\u001b[0m\u001b[91mnpm notice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\nnpm\u001b[0m\u001b[91m \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m Run `npm install -g npm@9.2.0` to update!\nnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m \n\u001b[0mRemoving intermediate container edcdfbd444a6\n ---> f0e7254c6507\nSuccessfully built f0e7254c6507\nSuccessfully tagged csv-importer:latest\n","stderr":"","imageSize":368402475},"repair":{"violations":[{"name":"npmCacheCleanAfterInstall","position":{"start":13,"end":13,"columnStart":4,"columnEnd":15}},{"name":"ruleAptGetInstallUseNoRec","position":{"start":5,"end":5,"columnStart":22,"columnEnd":46}}],"repairedDockerfile":"# base image\nFROM pelias/baseimage\n\n# downloader apt dependencies\n# note: this is done in one command in order to keep down the size of intermediate containers\nRUN apt-get update && apt-get install --no-install-recommends -y unzip && rm -rf /var/lib/apt/lists/*\n\n# change working dir\nENV WORKDIR /code/pelias/csv-importer\nWORKDIR ${WORKDIR}\n\n# copy package.json first to prevent npm install being rerun when only code changes\nCOPY ./package.json ${WORKDIR}\nRUN npm install\n\n# copy code into image\nADD . ${WORKDIR}\n\nUSER pelias\n\n# run tests\nRUN npm test\n"},"repairedBuild":{"startTimestamp":1672472903835,"endTimestamp":1672472936390,"error":null,"stdout":"Sending build context to Docker daemon  108.5kB\r\r\nStep 1/9 : FROM pelias/baseimage\n ---> 20d46db0f488\nStep 2/9 : RUN apt-get update && apt-get install --no-install-recommends -y unzip && rm -rf /var/lib/apt/lists/*\n ---> Running in 9d2004db0c4b\nGet:1 http://archive.ubuntu.com/ubuntu bionic InRelease [242 kB]\nGet:2 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]\nGet:3 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]\nGet:4 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [83.3 kB]\nGet:5 http://archive.ubuntu.com/ubuntu bionic/universe amd64 Packages [11.3 MB]\nGet:6 http://archive.ubuntu.com/ubuntu bionic/restricted amd64 Packages [13.5 kB]\nGet:7 http://archive.ubuntu.com/ubuntu bionic/multiverse amd64 Packages [186 kB]\nGet:8 http://archive.ubuntu.com/ubuntu bionic/main amd64 Packages [1,344 kB]\nGet:9 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [3,524 kB]\nGet:10 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [2,342 kB]\nGet:11 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [1,352 kB]\nGet:12 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 Packages [30.0 kB]\nGet:13 http://archive.ubuntu.com/ubuntu bionic-backports/main amd64 Packages [64.0 kB]\nGet:14 http://archive.ubuntu.com/ubuntu bionic-backports/universe amd64 Packages [20.5 kB]\nGet:15 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [1,568 kB]\nGet:16 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [3,099 kB]\nGet:17 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [1,311 kB]\nGet:18 http://security.ubuntu.com/ubuntu bionic-security/multiverse amd64 Packages [22.9 kB]\nFetched 26.7 MB in 2s (12.5 MB/s)\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nSuggested packages:\n  zip\nThe following NEW packages will be installed:\n  unzip\n0 upgraded, 1 newly installed, 0 to remove and 55 not upgraded.\nNeed to get 168 kB of archives.\nAfter this operation, 567 kB of additional disk space will be used.\nGet:1 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 unzip amd64 6.0-21ubuntu1.2 [168 kB]\nFetched 168 kB in 0s (1,054 kB/s)\nSelecting previously unselected package unzip.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 8575 files and directories currently installed.)\r\nPreparing to unpack .../unzip_6.0-21ubuntu1.2_amd64.deb ...\r\nUnpacking unzip (6.0-21ubuntu1.2) ...\r\nSetting up unzip (6.0-21ubuntu1.2) ...\r\nRemoving intermediate container 9d2004db0c4b\n ---> 21537817600f\nStep 3/9 : ENV WORKDIR /code/pelias/csv-importer\n ---> Running in 799b5ca3e6c3\nRemoving intermediate container 799b5ca3e6c3\n ---> c6a89f2d0867\nStep 4/9 : WORKDIR ${WORKDIR}\n ---> Running in 33883c5bf58b\nRemoving intermediate container 33883c5bf58b\n ---> d64676ef5a6a\nStep 5/9 : COPY ./package.json ${WORKDIR}\n ---> 6f86921b21c2\nStep 6/9 : RUN npm install\n ---> Running in 8ac8f43b358a\n\u001b[91mnpm WARN deprecated formidable@1.2.6: Please upgrade to latest, formidable@v2 or formidable@v3! Check these notes: https://bit.ly/2ZEqIau\n\u001b[0m\u001b[91mnpm WARN deprecated har-validator@5.1.5: this library is no longer supported\n\u001b[0m\u001b[91mnpm WARN deprecated stable@0.1.8: Modern JS already guarantees Array#sort() is a stable sort, so this library is deprecated. See the compatibility table on MDN: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort#browser_compatibility\n\u001b[0m\u001b[91mnpm WARN deprecated uuid@3.4.0: Please upgrade  to version 7 or higher.  Older versions may use Math.random() in certain circumstances, which is known to be problematic.  See https://v8.dev/blog/math-random for details.\n\u001b[0m\u001b[91mnpm WARN deprecated @hapi/pinpoint@1.0.2: Moved to 'npm install @sideway/pinpoint'\n\u001b[0m\u001b[91mnpm WARN deprecated\u001b[0m\u001b[91m @hapi/topo@3.1.6: This version has been deprecated and is no longer supported or maintained\n\u001b[0m\u001b[91mnpm WARN deprecated @hapi/formula@1.2.0: Moved to 'npm install @sideway/formula'\n\u001b[0m\u001b[91mnpm WARN deprecated @hapi/address@2.1.4: Moved to 'npm install @sideway/address'\n\u001b[0m\u001b[91mnpm WARN deprecated @hapi/hoek@8.5.1: This version has been deprecated and is no longer supported or maintained\n\u001b[0m\u001b[91mnpm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142\n\u001b[0m\u001b[91mnpm WARN deprecated @hapi/joi@16.1.8: Switch to 'npm install joi'\n\u001b[0m\u001b[91mnpm WARN deprecated superagent@5.3.1: Please upgrade to v7.0.2+ of superagent.  We have fixed numerous issues with streams, form-data, attach(), filesystem errors not bubbling up (ENOENT on attach()), and all tests are now passing.  See the releases tab for more information at <https://github.com/visionmedia/superagent/releases>.\n\u001b[0m\u001b[91mnpm WARN deprecated elasticsearch@16.7.3: Package no longer supported. Contact Support at https://www.npmjs.com/support for more info.\n\u001b[0m\nadded 304 packages, and audited 305 packages in 11s\n\n71 packages are looking for funding\n  run `npm fund` for details\n\n3 high severity vulnerabilities\n\nTo address all issues (including breaking changes), run:\n  npm audit fix --force\n\nRun `npm audit` for details.\n\u001b[91mnpm notice \nnpm notice\u001b[0m\u001b[91m New major version of npm available! 8.1.2 -> 9.2.0\nnpm notice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\nnpm notice\u001b[0m\u001b[91m Run `npm install -g npm@9.2.0` to update!\nnpm notice \n\u001b[0mRemoving intermediate container 8ac8f43b358a\n ---> 2593e6abc339\nStep 7/9 : ADD . ${WORKDIR}\n ---> 3281a073b3cf\nStep 8/9 : USER pelias\n ---> Running in 34155b5d0e02\nRemoving intermediate container 34155b5d0e02\n ---> c71d8244b247\nStep 9/9 : RUN npm test\n ---> Running in d7df68ca0097\n\n> pelias-csv-importer@0.0.0-dev test\n> NODE_ENV=test npm run units\n\n\n> pelias-csv-importer@0.0.0-dev units\n> node test/test.js | tap-spec\n\n\n  missing imports should throw error\n\n    ✔ should throw\n\n  non-object imports should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  missing imports.csv should throw error\n\n    ✔ should throw\n\n  non-object imports.csv should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  missing datapath should not throw error\n\n    ✔ datapath is not required\n\n  non-string datapath should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  non-array files should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  non-string elements in files array should throw error\n\n    ✔ files elements must be strings\n    ✔ files elements must be strings\n    ✔ files elements must be strings\n    ✔ files elements must be strings\n    ✔ files elements must be strings\n\n  non-boolean adminLookup should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  non-boolean deduplicate should throw error\n\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n    ✔ should throw\n\n  unknown config fields should throw error\n\n    ✔ unknown fields should be disallowed\n\n  configuration with only datapath should not throw error\n\n    ✔ config should be valid\n\n  valid configuration should not throw error\n\n    ✔ config should be valid\n\n  unknown children of imports should not throw error\n\n    ✔ config should be valid\n\n  unknown children of root should not throw error\n\n    ✔ config should be valid\n\n  config.generate throwing error should rethrow\n\n    ✔ should be strictly equal\n    ✔ should throw\n\n  interpretUserArgs() allows missing datapath\n\n    ✔ Non-failure exit code and message set\n\n  interpretUserArgs returns dir from pelias config if set\n\n    ✔ path should be equal to path from config\n\n  interpretUserArgs returns normalized path from config\n\n    ✔ path should be equal to path from config\n\n  getFileList returns all .csv path names when config has empty files list\n\n    ✔ should be strictly equal\n    ✔ should be truthy\n    ✔ should be truthy\n    ✔ should be truthy\n\n  getFileList returns all .csv path names when config doesn't have files property\n\n    ✔ should be strictly equal\n    ✔ should be truthy\n    ✔ should be truthy\n    ✔ should be truthy\n\n  getFileList returns fully qualified path names when config has a files list\n\n    ✔ file names should be equal\n\n  getFileList handles parallel builds\n\n\n  3 workers, id 0\n\n    ✔ only first file is indexed\n\n  3 workers, id 1\n\n    ✔ only second file indexed\n\n  3 workers, id 2\n\n    ✔ only third file indexed\n\n  3 workers, id 3\n\n    ✔ file list is empty\n\n  documentStream catches records with no street\n\n    2022-12-31T07:48:54.335Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Invalid centroid. NUMBER=5\n    ✔ no documents should be pushed\n    ✔ bad record count updated\n\n  documentStream catches records with no lat\n\n    2022-12-31T07:48:54.337Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Invalid centroid. name=foo, LON=7\n    ✔ no documents should be pushed\n    ✔ bad record count updated\n\n  documentStream catches records with no lon\n\n    2022-12-31T07:48:54.338Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Invalid centroid. name=foo, LAT=7\n    ✔ no documents should be pushed\n    ✔ bad record count updated\n\n  documentStream does not set zipcode if zipcode is emptystring\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ should be strictly equal\n\n  documentStream accepts zipcode instead of POSTCODE\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ should be strictly equal\n\n  documentStream accepts postalcode instead of POSTCODE\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ should be strictly equal\n\n  documentStream uses id value over hash if present\n\n    ✔ id should be correct\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream uses HASH value if present\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream uses NAME value if present\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ name set correctly\n\n  documentStream uses name value if present (over NAME)\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ name set correctly\n\n  documentStream uses source value if present (over SOURCE)\n\n    ✔ source set correctly\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream uses SOURCE value if present (and source not present)\n\n    ✔ source set correctly\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream uses layer_id value if present\n\n    ✔ layer set correctly\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream parses JSON from addendum_json_* field\n\n    ✔ custom data is added to record\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream parses empty JSON from addendum_json_* field\n\n    ✔ undefined custom data is added to record\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream parses undefined JSON from addendum_json_* field\n\n    ✔ undefined custom data is added to record\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream does not parse corrupt JSON from addendum_json_* field\n\n    2022-12-31T07:48:54.346Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Unexpected end of JSON input. NUMBER=5, STREET=101st Avenue, LAT=5, LON=6, HASH=abcd, layer_id=desired-layer, addendum_json_custom_field={ \"foo\": \"bar\n    ✔ the document should not be pushed\n    ✔ bad record count 1\n\n  documentStream parses JSON from name_json_* field\n\n    ✔ the document should be pushed\n    ✔ default name is added to record\n    ✔ fr name is added to record\n    ✔ fr name is added to record\n    ✔ bad record count unchanged\n\n  documentStream ignores empty JSON from name_json_* field\n\n    ✔ the document should be pushed\n    ✔ default name is added to record\n    ✔ fr name is not added to record\n    ✔ fr name aliases are not added to record\n    ✔ bad record count unchanged\n\n  documentStream fails on bad JSON from name_json_* field\n\n    2022-12-31T07:48:54.348Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Unexpected end of JSON input. LAT=5, LON=6, HASH=abcd, layer_id=desired-layer, name_json_fr=[\"bar\", \"b, name_json=[\"foo\"]\n    ✔ the document should not be pushed\n    ✔ bad record count unchanged\n\n  documentStream parses JSON from category_json field\n\n    ✔ the document should be pushed\n    ✔ default name is added to record\n    ✔ default name is added to record\n    ✔ bad record count unchanged\n\n  documentStream ignores empty JSON from category_json field\n\n    ✔ the document should be pushed\n    ✔ default name is added to record\n    ✔ category is added to record, empty category_json ignored\n    ✔ bad record count unchanged\n\n  documentStream ignores undefined JSON from category_json field\n\n    ✔ the document should be pushed\n    ✔ default name is added to record\n    ✔ category is added to record, empty category_json ignored\n    ✔ bad record count unchanged\n\n  documentStream accepts popularity\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n    ✔ should be strictly equal\n\n  documentStream rejects invalid popularity\n\n    2022-12-31T07:48:54.351Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to Popularity must be an int, got 500a0. NUMBER=5, STREET=101st Avenue, LAT=5, LON=6, postalcode=10010, popularity=500a0\n    ✔ the document should be skipped\n    ✔ bad record count went up by 1\n\n  documentStream accepts parent value if present\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream accepts multiple parent values if present\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  documentStream rejects parent without name property\n\n    2022-12-31T07:48:54.353Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to invalid document type, expecting: string got: undefined. LAT=5, LON=6, popularity=500, country=[id=NOR]\n    ✔ the document should be rejected\n    ✔ bad record count went up by 1\n\n  documentStream rejects parent without id property\n\n    2022-12-31T07:48:54.353Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to invalid document type, expecting: string got: undefined. LAT=5, LON=6, popularity=500, country=[name=NOR]\n    ✔ the document should be rejected\n    ✔ bad record count went up by 1\n\n  documentStream rejects parent with invalid structure\n\n    2022-12-31T07:48:54.354Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to invalid document type, expecting: string got: undefined. LAT=5, LON=6, popularity=500, name=NOR\n    ✔ the document should be rejected\n    ✔ bad record count went up by 1\n\n  documentStream rejects parent with non-existing parent\n\n    2022-12-31T07:48:54.354Z - \u001b[33mwarn\u001b[39m: [csv-importer] Record import failed on line 0 due to invalid property: land, should be one of: continent,country,dependency,macroregion,region,macrocounty,county,borough,locality,localadmin,neighbourhood,postalcode,ocean,marinearea,empire. LAT=5, LON=6, popularity=500, name=NOR\n    ✔ the document should be rejected\n    ✔ bad record count went up by 1\n\n  documentStream ignores non-existing parent field property\n\n    ✔ the document should be pushed\n    ✔ bad record count unchanged\n\n  importPipelines.createRecordStream() creates Document objects with expected values.\n\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.357Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-8hmq3x.ci8ex\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.362Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-8hmq3x.ci8ex, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.363Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-1xq56a.36abv\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.364Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-1xq56a.36abv, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.365Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-h8qb0t.k2925\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.366Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-h8qb0t.k2925, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.367Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-l1cag7.425pn\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.368Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-l1cag7.425pn, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.368Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-m34q5x.v8ijq\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.370Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-m34q5x.v8ijq, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.370Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-1tgyxuo.h6sgi\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Street matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.371Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-1tgyxuo.h6sgi, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.372Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-40s9jp.54f8\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Street matches\n    ✔ Housenumber matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.373Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-40s9jp.54f8, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.374Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-ukvdp4.hk2oq\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Street matches\n    ✔ Housenumber matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.375Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-ukvdp4.hk2oq, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.375Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-bqmljp.26i6\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Street matches\n    ✔ Housenumber matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.376Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-bqmljp.26i6, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.377Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-ahs24k.c7s6\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.378Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-ahs24k.c7s6, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.378Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-feep2p.8b2t6\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.381Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-feep2p.8b2t6, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.382Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-tymdpw.bkd68\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.383Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-tymdpw.bkd68, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.383Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-10dra9r.s9onl\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.384Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-10dra9r.s9onl, goodRecordCount=1 badRecordCount=0\n\n  (anonymous)\n\n    ✔ Stream is readable.\n    2022-12-31T07:48:54.385Z - \u001b[32minfo\u001b[39m: [csv-importer] Creating read stream for: /tmp/csv-importer-test20221131-31-c3fts7.wlt7t\n    ✔ Name matches\n    ✔ Name aliases matches\n    ✔ source matches\n    ✔ layer matches\n    ✔ Longitude matches\n    ✔ Latitude matches\n    ✔ Categories matches\n    2022-12-31T07:48:54.386Z - \u001b[32minfo\u001b[39m: [csv-importer] Finished import from /tmp/csv-importer-test20221131-31-c3fts7.wlt7t, goodRecordCount=1 badRecordCount=0\n\n  getIdPrefix returns prefix based on irectory structure\n\n    ✔ correct prefix generated\n\n  getIdPrefix handles multiple levels of heirarchy\n\n    ✔ correct prefix generated\n\n  getIdPrefix returns basename without extension when invalid basepath given\n\n    ✔ should be strictly equal\n\n\n  total:     272\n  passing:   272\n  duration:  212ms\n\n\n\u001b[91mnpm notice \nnpm\u001b[0m\u001b[91m notice New major version of npm available! 8.1.2 -> 9.2.0\nnpm \u001b[0m\u001b[91mnotice Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\n\u001b[0m\u001b[91mnpm \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m Run `npm install -g npm@9.2.0` to update!\nnpm \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m \n\u001b[0mRemoving intermediate container d7df68ca0097\n ---> b7379b0f8c37\nSuccessfully built b7379b0f8c37\nSuccessfully tagged csv-importer:latest\n","stderr":"","imageSize":368402523},"endTime":1672472936785}