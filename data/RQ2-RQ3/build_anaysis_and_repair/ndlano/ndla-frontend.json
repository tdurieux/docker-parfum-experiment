{"repository":"https://github.com/ndlano/ndla-frontend","dockerfilePath":"Dockerfile","startTime":1672636526434,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/ndlano/ndla-frontend'...\n","error":null,"commit":"eee1e4394f96aea2dc7e233e922331007c27edc4"},"originalBuild":{"startTimestamp":1672636527789,"endTimestamp":1672636878468,"error":null,"stdout":"Sending build context to Docker daemon  12.29MB\r\r\nStep 1/19 : FROM node:16.17-alpine as builder\n16.17-alpine: Pulling from library/node\n213ec9aee27d: Already exists\nbb60732a8e9f: Pulling fs layer\n9f61bc6ef19c: Pulling fs layer\n8de0f21617f6: Pulling fs layer\n8de0f21617f6: Verifying Checksum\n8de0f21617f6: Download complete\n9f61bc6ef19c: Verifying Checksum\n9f61bc6ef19c: Download complete\nbb60732a8e9f: Verifying Checksum\nbb60732a8e9f: Download complete\nbb60732a8e9f: Pull complete\n9f61bc6ef19c: Pull complete\n8de0f21617f6: Pull complete\nDigest: sha256:4d68856f48be7c73cd83ba8af3b6bae98f4679e14d1ff49e164625ae8831533a\nStatus: Downloaded newer image for node:16.17-alpine\n ---> f7ef5856dc1f\nStep 2/19 : ENV HOME=/home/app\n ---> Running in 1993c94d7859\nRemoving intermediate container 1993c94d7859\n ---> 0efb47292f25\nStep 3/19 : ENV APP_PATH=$HOME/ndla-frontend\n ---> Running in afa12bda058c\nRemoving intermediate container afa12bda058c\n ---> 6b021ccaf751\nStep 4/19 : COPY yarn.lock package.json $APP_PATH/\n ---> 4b6988a93da9\nStep 5/19 : WORKDIR $APP_PATH\n ---> Running in 9d435c32d934\nRemoving intermediate container 9d435c32d934\n ---> 522301722321\nStep 6/19 : RUN yarn install\n ---> Running in 3ff75171ec76\nyarn install v1.22.19\n[1/5] Validating package.json...\n[2/5] Resolving packages...\n[3/5] Fetching packages...\n[4/5] Linking dependencies...\n\u001b[91mwarning \"@ndla/button > focus-trap-react@8.9.2\" has unmet peer dependency \"prop-types@^15.8.1\".\n\u001b[0m\u001b[91mwarning \" > @ndla/tabs@2.1.0\" has unmet peer dependency \"react-bem-helper@^1.4.1\".\n\u001b[0m\u001b[91mwarning \" > @ndla/ui@33.1.4\" has unmet peer dependency \"prop-types@^15.8.1\".\n\u001b[0m\u001b[91mwarning \"@ndla/ui > @reach/menu-button@0.16.2\" has unmet peer dependency \"react-is@^16.8.0 || 17.x\".\n\u001b[0m[5/5] Building fresh packages...\nDone in 78.89s.\nRemoving intermediate container 3ff75171ec76\n ---> 8a6a311c2e31\nStep 7/19 : COPY .babelrc tsconfig.json .eslintrc.js postcss.config.js $APP_PATH/\n ---> 12649df544c8\nStep 8/19 : COPY webpack $APP_PATH/webpack\n ---> 3f61a4a398cf\nStep 9/19 : COPY scripts $APP_PATH/scripts\n ---> bbdd43b86e46\nStep 10/19 : COPY src $APP_PATH/src\n ---> 23593faab056\nStep 11/19 : COPY public $APP_PATH/public\n ---> ef48c6072f60\nStep 12/19 : RUN yarn run build\n ---> Running in 6a454a15957f\nyarn run v1.22.19\n$ tsc -b && cross-env NODE_ENV=production ts-node scripts/build\nCompiling client build...\nCompiled client build successfully.\nCompiling server build...\nCompiled server build successfully.\n$ cp build/assets.json build/public/static/assets.json\nDone in 99.64s.\nRemoving intermediate container 6a454a15957f\n ---> cf14297f736e\nStep 13/19 : FROM node:16.17-alpine\n ---> f7ef5856dc1f\nStep 14/19 : RUN apk add py-pip jq && pip install awscli\n ---> Running in 538af3b51723\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/community/x86_64/APKINDEX.tar.gz\n(1/25) Installing oniguruma (6.9.8-r0)\n(2/25) Installing jq (1.6-r1)\n(3/25) Installing libbz2 (1.0.8-r1)\n(4/25) Installing expat (2.5.0-r0)\n(5/25) Installing libffi (3.4.2-r1)\n(6/25) Installing gdbm (1.23-r0)\n(7/25) Installing xz-libs (5.2.5-r1)\n(8/25) Installing mpdecimal (2.5.1-r1)\n(9/25) Installing ncurses-terminfo-base (6.3_p20220521-r0)\n(10/25) Installing ncurses-libs (6.3_p20220521-r0)\n(11/25) Installing readline (8.1.2-r0)\n(12/25) Installing sqlite-libs (3.38.5-r0)\n(13/25) Installing python3 (3.10.9-r0)\n(14/25) Installing py3-contextlib2 (21.6.0-r2)\n(15/25) Installing py3-tomli (2.0.1-r1)\n(16/25) Installing py3-pep517 (0.12.0-r2)\n(17/25) Installing py3-six (1.16.0-r1)\n(18/25) Installing py3-retrying (1.3.3-r3)\n(19/25) Installing py3-appdirs (1.4.4-r3)\n(20/25) Installing py3-more-itertools (8.13.0-r0)\n(21/25) Installing py3-ordered-set (4.0.2-r3)\n(22/25) Installing py3-parsing (2.4.7-r3)\n(23/25) Installing py3-packaging (21.3-r0)\n(24/25) Installing py3-setuptools (59.4.0-r0)\n(25/25) Installing py3-pip (22.1.1-r0)\nExecuting busybox-1.35.0-r17.trigger\nOK: 78 MiB in 41 packages\nCollecting awscli\n  Downloading awscli-1.27.41-py3-none-any.whl (4.0 MB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 4.0/4.0 MB 8.9 MB/s eta 0:00:00\nCollecting PyYAML<5.5,>=3.10\n  Downloading PyYAML-5.4.1.tar.gz (175 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 175.1/175.1 kB 4.0 MB/s eta 0:00:00\n  Installing build dependencies: started\n  Installing build dependencies: finished with status 'done'\n  Getting requirements to build wheel: started\n  Getting requirements to build wheel: finished with status 'done'\n  Preparing metadata (pyproject.toml): started\n  Preparing metadata (pyproject.toml): finished with status 'done'\nCollecting botocore==1.29.41\n  Downloading botocore-1.29.41-py3-none-any.whl (10.3 MB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 10.3/10.3 MB 31.4 MB/s eta 0:00:00\nCollecting rsa<4.8,>=3.1.2\n  Downloading rsa-4.7.2-py3-none-any.whl (34 kB)\nCollecting colorama<0.4.5,>=0.2.5\n  Downloading colorama-0.4.4-py2.py3-none-any.whl (16 kB)\nCollecting docutils<0.17,>=0.10\n  Downloading docutils-0.16-py2.py3-none-any.whl (548 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 548.2/548.2 kB 10.9 MB/s eta 0:00:00\nCollecting s3transfer<0.7.0,>=0.6.0\n  Downloading s3transfer-0.6.0-py3-none-any.whl (79 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 79.6/79.6 kB 8.6 MB/s eta 0:00:00\nCollecting urllib3<1.27,>=1.25.4\n  Downloading urllib3-1.26.13-py2.py3-none-any.whl (140 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 140.6/140.6 kB 9.0 MB/s eta 0:00:00\nCollecting python-dateutil<3.0.0,>=2.1\n  Downloading python_dateutil-2.8.2-py2.py3-none-any.whl (247 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 247.7/247.7 kB 15.3 MB/s eta 0:00:00\nCollecting jmespath<2.0.0,>=0.7.1\n  Downloading jmespath-1.0.1-py3-none-any.whl (20 kB)\nCollecting pyasn1>=0.1.3\n  Downloading pyasn1-0.4.8-py2.py3-none-any.whl (77 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 77.1/77.1 kB 5.6 MB/s eta 0:00:00\nRequirement already satisfied: six>=1.5 in /usr/lib/python3.10/site-packages (from python-dateutil<3.0.0,>=2.1->botocore==1.29.41->awscli) (1.16.0)\nBuilding wheels for collected packages: PyYAML\n  Building wheel for PyYAML (pyproject.toml): started\n  Building wheel for PyYAML (pyproject.toml): finished with status 'done'\n  Created wheel for PyYAML: filename=PyYAML-5.4.1-cp310-cp310-linux_x86_64.whl size=45658 sha256=ce3f9fadf7e8f782cd7c30dea9c3f04d4d86ecd7a5de5317a60fcc7d59b0ccfd\n  Stored in directory: /root/.cache/pip/wheels/c7/0d/22/696ee92245ad710f506eee79bb05c740d8abccd3ecdb778683\nSuccessfully built PyYAML\nInstalling collected packages: pyasn1, urllib3, rsa, PyYAML, python-dateutil, jmespath, docutils, colorama, botocore, s3transfer, awscli\nSuccessfully installed PyYAML-5.4.1 awscli-1.27.41 botocore-1.29.41 colorama-0.4.4 docutils-0.16 jmespath-1.0.1 pyasn1-0.4.8 python-dateutil-2.8.2 rsa-4.7.2 s3transfer-0.6.0 urllib3-1.26.13\n\u001b[91mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\n\u001b[0mRemoving intermediate container 538af3b51723\n ---> ecfd895f39c9\nStep 15/19 : COPY run-ndla-frontend.sh /\n ---> 1be078b51ca0\nStep 16/19 : WORKDIR /home/app/ndla-frontend\n ---> Running in 86b7c4c0b932\nRemoving intermediate container 86b7c4c0b932\n ---> d5eaf0c7da8c\nStep 17/19 : COPY --from=builder /home/app/ndla-frontend/build build\n ---> ae0d7f5ca88a\nStep 18/19 : ENV NODE_ENV=production\n ---> Running in 4ab91d04c8f0\nRemoving intermediate container 4ab91d04c8f0\n ---> e571e37129cb\nStep 19/19 : CMD [\"/run-ndla-frontend.sh\", \"node build/server.js '|' bunyan\"]\n ---> Running in df7adcf15cb7\nRemoving intermediate container df7adcf15cb7\n ---> ec52eb422a36\nSuccessfully built ec52eb422a36\nSuccessfully tagged ndla-frontend:latest\n","stderr":"","imageSize":363186921},"repair":{"violations":[{"name":"pipUseNoCacheDir","position":{"start":27,"end":27,"columnStart":25,"columnEnd":43}},{"name":"apkAddUseNoCache","position":{"start":27,"end":27,"columnStart":4,"columnEnd":21}}],"repairedDockerfile":"### Build stage\nFROM node:16.17-alpine as builder\n\nENV HOME=/home/app\nENV APP_PATH=$HOME/ndla-frontend\n\n# Copy necessary files for installing dependencies\nCOPY yarn.lock package.json $APP_PATH/\n\n# Run yarn before src copy to enable better layer caching\nWORKDIR $APP_PATH\nRUN yarn install\n\n# Copy necessary source files for server and client build\nCOPY .babelrc tsconfig.json .eslintrc.js postcss.config.js $APP_PATH/\nCOPY webpack $APP_PATH/webpack\nCOPY scripts $APP_PATH/scripts\n\nCOPY src $APP_PATH/src\nCOPY public $APP_PATH/public\n\n# Build client code\nRUN yarn run build\n\n### Run stage\nFROM node:16.17-alpine\n\nRUN apk add --no-cache py-pip jq && pip install --no-cache-dir awscli\nCOPY run-ndla-frontend.sh /\n\nWORKDIR /home/app/ndla-frontend\nCOPY --from=builder /home/app/ndla-frontend/build build\n\nENV NODE_ENV=production\n\nCMD [\"/run-ndla-frontend.sh\", \"node build/server.js '|' bunyan\"]\n"},"repairedBuild":{"startTimestamp":1672636881088,"endTimestamp":1672637160527,"error":null,"stdout":"Sending build context to Docker daemon  12.29MB\r\r\nStep 1/19 : FROM node:16.17-alpine as builder\n ---> f7ef5856dc1f\nStep 2/19 : ENV HOME=/home/app\n ---> Running in a12d1d427bd5\nRemoving intermediate container a12d1d427bd5\n ---> 861242b0373d\nStep 3/19 : ENV APP_PATH=$HOME/ndla-frontend\n ---> Running in cee6090f9210\nRemoving intermediate container cee6090f9210\n ---> c62ec80e2251\nStep 4/19 : COPY yarn.lock package.json $APP_PATH/\n ---> ebef2bb6d829\nStep 5/19 : WORKDIR $APP_PATH\n ---> Running in f1736f7a2018\nRemoving intermediate container f1736f7a2018\n ---> d82e898bc592\nStep 6/19 : RUN yarn install\n ---> Running in 459ffc4d30ef\nyarn install v1.22.19\n[1/5] Validating package.json...\n[2/5] Resolving packages...\n[3/5] Fetching packages...\n[4/5] Linking dependencies...\n\u001b[91mwarning \"@ndla/button > focus-trap-react@8.9.2\" has unmet peer dependency \"prop-types@^15.8.1\".\n\u001b[0m\u001b[91mwarning \" > @ndla/tabs@2.1.0\" has unmet peer dependency \"react-bem-helper@^1.4.1\".\n\u001b[0m\u001b[91mwarning \" > @ndla/ui@33.1.4\" has unmet peer dependency \"prop-types@^15.8.1\".\n\u001b[0m\u001b[91mwarning \"@ndla/ui > @reach/menu-button@0.16.2\" has unmet peer dependency \"react-is@^16.8.0 || 17.x\".\n\u001b[0m[5/5] Building fresh packages...\nDone in 64.31s.\nRemoving intermediate container 459ffc4d30ef\n ---> 3c030d248875\nStep 7/19 : COPY .babelrc tsconfig.json .eslintrc.js postcss.config.js $APP_PATH/\n ---> fbc88158c327\nStep 8/19 : COPY webpack $APP_PATH/webpack\n ---> 4312d470c2a2\nStep 9/19 : COPY scripts $APP_PATH/scripts\n ---> 6bf9bca990ef\nStep 10/19 : COPY src $APP_PATH/src\n ---> 128381a479c3\nStep 11/19 : COPY public $APP_PATH/public\n ---> ee5ac3edd8b0\nStep 12/19 : RUN yarn run build\n ---> Running in 95af83cd3fc2\nyarn run v1.22.19\n$ tsc -b && cross-env NODE_ENV=production ts-node scripts/build\nCompiling client build...\nCompiled client build successfully.\nCompiling server build...\nCompiled server build successfully.\n$ cp build/assets.json build/public/static/assets.json\nDone in 98.62s.\nRemoving intermediate container 95af83cd3fc2\n ---> c8257b4ac0a3\nStep 13/19 : FROM node:16.17-alpine\n ---> f7ef5856dc1f\nStep 14/19 : RUN apk add --no-cache py-pip jq && pip install --no-cache-dir awscli\n ---> Running in 6439b5601738\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/community/x86_64/APKINDEX.tar.gz\n(1/25) Installing oniguruma (6.9.8-r0)\n(2/25) Installing jq (1.6-r1)\n(3/25) Installing libbz2 (1.0.8-r1)\n(4/25) Installing expat (2.5.0-r0)\n(5/25) Installing libffi (3.4.2-r1)\n(6/25) Installing gdbm (1.23-r0)\n(7/25) Installing xz-libs (5.2.5-r1)\n(8/25) Installing mpdecimal (2.5.1-r1)\n(9/25) Installing ncurses-terminfo-base (6.3_p20220521-r0)\n(10/25) Installing ncurses-libs (6.3_p20220521-r0)\n(11/25) Installing readline (8.1.2-r0)\n(12/25) Installing sqlite-libs (3.38.5-r0)\n(13/25) Installing python3 (3.10.9-r0)\n(14/25) Installing py3-contextlib2 (21.6.0-r2)\n(15/25) Installing py3-tomli (2.0.1-r1)\n(16/25) Installing py3-pep517 (0.12.0-r2)\n(17/25) Installing py3-six (1.16.0-r1)\n(18/25) Installing py3-retrying (1.3.3-r3)\n(19/25) Installing py3-appdirs (1.4.4-r3)\n(20/25) Installing py3-more-itertools (8.13.0-r0)\n(21/25) Installing py3-ordered-set (4.0.2-r3)\n(22/25) Installing py3-parsing (2.4.7-r3)\n(23/25) Installing py3-packaging (21.3-r0)\n(24/25) Installing py3-setuptools (59.4.0-r0)\n(25/25) Installing py3-pip (22.1.1-r0)\nExecuting busybox-1.35.0-r17.trigger\nOK: 78 MiB in 41 packages\nCollecting awscli\n  Downloading awscli-1.27.41-py3-none-any.whl (4.0 MB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 4.0/4.0 MB 80.8 MB/s eta 0:00:00\nCollecting s3transfer<0.7.0,>=0.6.0\n  Downloading s3transfer-0.6.0-py3-none-any.whl (79 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 79.6/79.6 kB 200.1 MB/s eta 0:00:00\nCollecting docutils<0.17,>=0.10\n  Downloading docutils-0.16-py2.py3-none-any.whl (548 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 548.2/548.2 kB 89.6 MB/s eta 0:00:00\nCollecting rsa<4.8,>=3.1.2\n  Downloading rsa-4.7.2-py3-none-any.whl (34 kB)\nCollecting botocore==1.29.41\n  Downloading botocore-1.29.41-py3-none-any.whl (10.3 MB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 10.3/10.3 MB 107.6 MB/s eta 0:00:00\nCollecting colorama<0.4.5,>=0.2.5\n  Downloading colorama-0.4.4-py2.py3-none-any.whl (16 kB)\nCollecting PyYAML<5.5,>=3.10\n  Downloading PyYAML-5.4.1.tar.gz (175 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 175.1/175.1 kB 193.0 MB/s eta 0:00:00\n  Installing build dependencies: started\n  Installing build dependencies: finished with status 'done'\n  Getting requirements to build wheel: started\n  Getting requirements to build wheel: finished with status 'done'\n  Preparing metadata (pyproject.toml): started\n  Preparing metadata (pyproject.toml): finished with status 'done'\nCollecting jmespath<2.0.0,>=0.7.1\n  Downloading jmespath-1.0.1-py3-none-any.whl (20 kB)\nCollecting python-dateutil<3.0.0,>=2.1\n  Downloading python_dateutil-2.8.2-py2.py3-none-any.whl (247 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 247.7/247.7 kB 155.3 MB/s eta 0:00:00\nCollecting urllib3<1.27,>=1.25.4\n  Downloading urllib3-1.26.13-py2.py3-none-any.whl (140 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 140.6/140.6 kB 259.1 MB/s eta 0:00:00\nCollecting pyasn1>=0.1.3\n  Downloading pyasn1-0.4.8-py2.py3-none-any.whl (77 kB)\n     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 77.1/77.1 kB 237.6 MB/s eta 0:00:00\nRequirement already satisfied: six>=1.5 in /usr/lib/python3.10/site-packages (from python-dateutil<3.0.0,>=2.1->botocore==1.29.41->awscli) (1.16.0)\nBuilding wheels for collected packages: PyYAML\n  Building wheel for PyYAML (pyproject.toml): started\n  Building wheel for PyYAML (pyproject.toml): finished with status 'done'\n  Created wheel for PyYAML: filename=PyYAML-5.4.1-cp310-cp310-linux_x86_64.whl size=45658 sha256=a2d72bd8d1c08ff49eb8800b1c4f141f30048d4f1fa54336093ffb3b02fbf6c2\n  Stored in directory: /tmp/pip-ephem-wheel-cache-mvchaxdj/wheels/c7/0d/22/696ee92245ad710f506eee79bb05c740d8abccd3ecdb778683\nSuccessfully built PyYAML\nInstalling collected packages: pyasn1, urllib3, rsa, PyYAML, python-dateutil, jmespath, docutils, colorama, botocore, s3transfer, awscli\nSuccessfully installed PyYAML-5.4.1 awscli-1.27.41 botocore-1.29.41 colorama-0.4.4 docutils-0.16 jmespath-1.0.1 pyasn1-0.4.8 python-dateutil-2.8.2 rsa-4.7.2 s3transfer-0.6.0 urllib3-1.26.13\n\u001b[91mWARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv\n\u001b[0mRemoving intermediate container 6439b5601738\n ---> c6575f9b8c9c\nStep 15/19 : COPY run-ndla-frontend.sh /\n ---> ee6fec878556\nStep 16/19 : WORKDIR /home/app/ndla-frontend\n ---> Running in 55fc0002bba4\nRemoving intermediate container 55fc0002bba4\n ---> ce1a85141ad1\nStep 17/19 : COPY --from=builder /home/app/ndla-frontend/build build\n ---> 10dbdfffc990\nStep 18/19 : ENV NODE_ENV=production\n ---> Running in 6b0a3ee721ce\nRemoving intermediate container 6b0a3ee721ce\n ---> 188ed9f9ccaa\nStep 19/19 : CMD [\"/run-ndla-frontend.sh\", \"node build/server.js '|' bunyan\"]\n ---> Running in d222cdb643c6\nRemoving intermediate container d222cdb643c6\n ---> c4e6c607181b\nSuccessfully built c4e6c607181b\nSuccessfully tagged ndla-frontend:latest\n","stderr":"","imageSize":344390461},"endTime":1672637161102}