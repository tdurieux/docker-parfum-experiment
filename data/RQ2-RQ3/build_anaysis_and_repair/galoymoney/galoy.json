{"repository":"https://github.com/galoymoney/galoy","dockerfilePath":"Dockerfile","startTime":1672652078309,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/galoymoney/galoy'...\n","error":null,"commit":"2b52e0a8e6ac5c0581f1126e0e58862acd901b53"},"originalBuild":{"startTimestamp":1672652079530,"endTimestamp":1672652268598,"error":null,"stdout":"Sending build context to Docker daemon  7.212MB\r\r\nStep 1/20 : FROM node:18-alpine AS BUILD_IMAGE\n18-alpine: Pulling from library/node\nDigest: sha256:a136ed7b0df71082cdb171f36d640ea3b392a5c70401c642326acee767b8c540\nStatus: Downloaded newer image for node:18-alpine\n ---> 6d7b7852bcd3\nStep 2/20 : WORKDIR /app\n ---> Running in 2d26cbea44fa\nRemoving intermediate container 2d26cbea44fa\n ---> fc92ff725665\nStep 3/20 : RUN apk update && apk add git\n ---> Running in d5061e1dc6bb\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\nv3.17.0-313-gaf42d45cd5 [https://dl-cdn.alpinelinux.org/alpine/v3.17/main]\nv3.17.0-312-gf3974f8f5f [https://dl-cdn.alpinelinux.org/alpine/v3.17/community]\nOK: 17813 distinct packages available\n(1/7) Installing ca-certificates (20220614-r3)\n(2/7) Installing brotli-libs (1.0.9-r9)\n(3/7) Installing nghttp2-libs (1.51.0-r0)\n(4/7) Installing libcurl (7.87.0-r0)\n(5/7) Installing libexpat (2.5.0-r0)\n(6/7) Installing pcre2 (10.42-r0)\n(7/7) Installing git (2.38.2-r0)\nExecuting busybox-1.35.0-r29.trigger\nExecuting ca-certificates-20220614-r3.trigger\nOK: 18 MiB in 24 packages\nRemoving intermediate container d5061e1dc6bb\n ---> 63608e07105a\nStep 4/20 : COPY ./*.json ./yarn.lock ./\n ---> a599a69c0073\nStep 5/20 : RUN yarn install --frozen-lockfile\n ---> Running in 3c6f5089f2df\nyarn install v1.22.19\n[1/5] Validating package.json...\n[2/5] Resolving packages...\n[3/5] Fetching packages...\n[4/5] Linking dependencies...\n\u001b[91mwarning \"firebase-admin > @firebase/database-compat > @firebase/database > @firebase/auth-interop-types@0.1.7\" has unmet peer dependency \"@firebase/app-types@0.x\".\n\u001b[0m\u001b[91mwarning \" > graphql-query-complexity-apollo-plugin@1.0.2\" has incorrect peer dependency \"graphql@^15.5.1\".\n\u001b[0m\u001b[91mwarning \" > graphql-query-complexity-apollo-plugin@1.0.2\" has incorrect peer dependency \"graphql-query-complexity@^0.9.0\".\nwarning \" > graphql-redis-subscriptions@2.6.0\" has unmet peer dependency \"graphql-subscriptions@^1.0.0 || ^2.0.0\".\n\u001b[0m\u001b[91mwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"jquery@>=3.6.0\".\nwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"motion-ui@latest\".\nwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"what-input@>=5.2.10\".\n\u001b[0m[5/5] Building fresh packages...\nDone in 46.70s.\nRemoving intermediate container 3c6f5089f2df\n ---> f6d393cc9df2\nStep 6/20 : COPY ./src ./src\n ---> 43fe9dd8c120\nStep 7/20 : RUN yarn build\n ---> Running in 96ea77fdd725\nyarn run v1.22.19\n$ tsc -p tsconfig-build.json --skipLibCheck && cp -R src/services/price/protos lib/services/price/ && cp -R src/services/dealer-price/proto lib/services/dealer-price/ && cp -R src/services/loopd/protos lib/services/loopd/ && tscpaths --silent -p tsconfig.json -s ./src -o ./lib\nDone in 10.16s.\nRemoving intermediate container 96ea77fdd725\n ---> ee5fd989eef8\nStep 8/20 : RUN yarn install --frozen-lockfile --production\n ---> Running in 1b9de74f23aa\nyarn install v1.22.19\n[1/5] Validating package.json...\n[2/5] Resolving packages...\n[3/5] Fetching packages...\n[4/5] Linking dependencies...\n\u001b[91mwarning \"firebase-admin > @firebase/database-compat > @firebase/database > @firebase/auth-interop-types@0.1.7\" has unmet peer dependency \"@firebase/app-types@0.x\".\n\u001b[0m\u001b[91mwarning \" > graphql-query-complexity-apollo-plugin@1.0.2\" has incorrect peer dependency \"graphql@^15.5.1\".\nwarning \" > graphql-query-complexity-apollo-plugin@1.0.2\" has incorrect peer dependency \"graphql-query-complexity@^0.9.0\".\n\u001b[0m\u001b[91mwarning \" > graphql-redis-subscriptions@2.6.0\" has unmet peer dependency \"graphql-subscriptions@^1.0.0 || ^2.0.0\".\n\u001b[0m\u001b[91mwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"jquery@>=3.6.0\".\nwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"motion-ui@latest\".\nwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"what-input@>=5.2.10\".\n\u001b[0m[5/5] Building fresh packages...\nDone in 7.51s.\nRemoving intermediate container 1b9de74f23aa\n ---> 93949b02b14d\nStep 9/20 : FROM gcr.io/distroless/nodejs:18\n18: Pulling from distroless/nodejs\nfc251a6e7981: Pulling fs layer\nfda4ba87f6fb: Pulling fs layer\na1f1879bb7de: Pulling fs layer\na02cc7e9cd7d: Pulling fs layer\na1f1879bb7de: Verifying Checksum\na1f1879bb7de: Download complete\nfda4ba87f6fb: Verifying Checksum\nfda4ba87f6fb: Download complete\nfc251a6e7981: Download complete\nfc251a6e7981: Pull complete\nfda4ba87f6fb: Pull complete\na1f1879bb7de: Pull complete\na02cc7e9cd7d: Verifying Checksum\na02cc7e9cd7d: Download complete\na02cc7e9cd7d: Pull complete\nDigest: sha256:039aeeddc00d285be1a32d41648d3941cbdaab05cce03344a1267f49cce464d3\nStatus: Downloaded newer image for gcr.io/distroless/nodejs:18\n ---> 494d034f1f6d\nStep 10/20 : COPY --from=BUILD_IMAGE /app/lib /app/lib\n ---> 056c62724b17\nStep 11/20 : COPY --from=BUILD_IMAGE /app/src/config/locales /app/lib/config/locales\n ---> d48caa965eae\nStep 12/20 : COPY --from=BUILD_IMAGE /app/node_modules /app/node_modules\n ---> 8bc0ede398e6\nStep 13/20 : WORKDIR /app\n ---> Running in 18a99bb39f41\nRemoving intermediate container 18a99bb39f41\n ---> 324b886c6473\nStep 14/20 : COPY ./*.js ./package.json ./tsconfig.json ./yarn.lock ./.env ./\n ---> bb6e875af897\nStep 15/20 : USER 1000\n ---> Running in 6264080efaab\nRemoving intermediate container 6264080efaab\n ---> 76f5dcd9e8a9\nStep 16/20 : ARG BUILDTIME\n ---> Running in 40d50ff35c82\nRemoving intermediate container 40d50ff35c82\n ---> 83081e130bd4\nStep 17/20 : ARG COMMITHASH\n ---> Running in 53db511ee7b0\nRemoving intermediate container 53db511ee7b0\n ---> 8f78dbf9834f\nStep 18/20 : ENV BUILDTIME ${BUILDTIME}\n ---> Running in 257f89aa7a85\nRemoving intermediate container 257f89aa7a85\n ---> 366da67d2aa8\nStep 19/20 : ENV COMMITHASH ${COMMITHASH}\n ---> Running in d76e52969e05\nRemoving intermediate container d76e52969e05\n ---> 87598999bda7\nStep 20/20 : CMD [\"lib/servers/graphql-main-server.js\"]\n ---> Running in 37f7cfb0ff1f\nRemoving intermediate container 37f7cfb0ff1f\n ---> db364fb1aa71\nSuccessfully built db364fb1aa71\nSuccessfully tagged galoy:latest\n","stderr":"","imageSize":403649427},"repair":{"violations":[{"name":"apkAddUseNoCache","position":{"start":4,"end":4,"columnStart":18,"columnEnd":29}}],"repairedDockerfile":"FROM node:18-alpine AS BUILD_IMAGE\n\nWORKDIR /app\n\nRUN apk update && apk add --no-cache git\n\nCOPY ./*.json ./yarn.lock ./\n\nRUN yarn install --frozen-lockfile\n\nCOPY ./src ./src\n\nRUN yarn build\n\nRUN yarn install --frozen-lockfile --production\n\nFROM gcr.io/distroless/nodejs:18\nCOPY --from=BUILD_IMAGE /app/lib /app/lib\nCOPY --from=BUILD_IMAGE /app/src/config/locales /app/lib/config/locales\nCOPY --from=BUILD_IMAGE /app/node_modules /app/node_modules\n\nWORKDIR /app\nCOPY ./*.js ./package.json ./tsconfig.json ./yarn.lock ./.env ./\n\nUSER 1000\n\nARG BUILDTIME\nARG COMMITHASH\nENV BUILDTIME ${BUILDTIME}\nENV COMMITHASH ${COMMITHASH}\n\nCMD [\"lib/servers/graphql-main-server.js\"]\n"},"repairedBuild":{"startTimestamp":1672652269378,"endTimestamp":1672652477994,"error":null,"stdout":"Sending build context to Docker daemon  7.212MB\r\r\nStep 1/20 : FROM node:18-alpine AS BUILD_IMAGE\n ---> 6d7b7852bcd3\nStep 2/20 : WORKDIR /app\n ---> Running in d83de5b2a5f5\nRemoving intermediate container d83de5b2a5f5\n ---> 4e50c6db954b\nStep 3/20 : RUN apk update && apk add --no-cache git\n ---> Running in 31c09e486bb0\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\nv3.17.0-313-gaf42d45cd5 [https://dl-cdn.alpinelinux.org/alpine/v3.17/main]\nv3.17.0-312-gf3974f8f5f [https://dl-cdn.alpinelinux.org/alpine/v3.17/community]\nOK: 17813 distinct packages available\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\n(1/7) Installing ca-certificates (20220614-r3)\n(2/7) Installing brotli-libs (1.0.9-r9)\n(3/7) Installing nghttp2-libs (1.51.0-r0)\n(4/7) Installing libcurl (7.87.0-r0)\n(5/7) Installing libexpat (2.5.0-r0)\n(6/7) Installing pcre2 (10.42-r0)\n(7/7) Installing git (2.38.2-r0)\nExecuting busybox-1.35.0-r29.trigger\nExecuting ca-certificates-20220614-r3.trigger\nOK: 18 MiB in 24 packages\nRemoving intermediate container 31c09e486bb0\n ---> dc4d147b2fed\nStep 4/20 : COPY ./*.json ./yarn.lock ./\n ---> e99ecc61f2e4\nStep 5/20 : RUN yarn install --frozen-lockfile\n ---> Running in 16b4f5d594c5\nyarn install v1.22.19\n[1/5] Validating package.json...\n[2/5] Resolving packages...\n[3/5] Fetching packages...\n[4/5] Linking dependencies...\n\u001b[91mwarning \"firebase-admin > @firebase/database-compat > @firebase/database > @firebase/auth-interop-types@0.1.7\" has unmet peer dependency \"@firebase/app-types@0.x\".\n\u001b[0m\u001b[91mwarning \" > graphql-query-complexity-apollo-plugin@1.0.2\" has incorrect peer dependency \"graphql@^15.5.1\".\n\u001b[0m\u001b[91mwarning \" > graphql-query-complexity-apollo-plugin@1.0.2\" has incorrect peer dependency \"graphql-query-complexity@^0.9.0\".\nwarning \" > graphql-redis-subscriptions@2.6.0\" has unmet peer dependency \"graphql-subscriptions@^1.0.0 || ^2.0.0\".\n\u001b[0m\u001b[91mwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"jquery@>=3.6.0\".\nwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"motion-ui@latest\".\nwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"what-input@>=5.2.10\".\n\u001b[0m[5/5] Building fresh packages...\nDone in 35.53s.\nRemoving intermediate container 16b4f5d594c5\n ---> 10d31c7c9f63\nStep 6/20 : COPY ./src ./src\n ---> 1ffb51a61b35\nStep 7/20 : RUN yarn build\n ---> Running in 59c4a77041b7\nyarn run v1.22.19\n$ tsc -p tsconfig-build.json --skipLibCheck && cp -R src/services/price/protos lib/services/price/ && cp -R src/services/dealer-price/proto lib/services/dealer-price/ && cp -R src/services/loopd/protos lib/services/loopd/ && tscpaths --silent -p tsconfig.json -s ./src -o ./lib\nDone in 9.98s.\nRemoving intermediate container 59c4a77041b7\n ---> eca87b598a97\nStep 8/20 : RUN yarn install --frozen-lockfile --production\n ---> Running in 7d35a51b88e4\nyarn install v1.22.19\n[1/5] Validating package.json...\n[2/5] Resolving packages...\n[3/5] Fetching packages...\n[4/5] Linking dependencies...\n\u001b[91mwarning \"firebase-admin > @firebase/database-compat > @firebase/database > @firebase/auth-interop-types@0.1.7\" has unmet peer dependency \"@firebase/app-types@0.x\".\n\u001b[0m\u001b[91mwarning \" > graphql-query-complexity-apollo-plugin@1.0.2\" has incorrect peer dependency \"graphql@^15.5.1\".\nwarning \" > graphql-query-complexity-apollo-plugin@1.0.2\" has incorrect peer dependency \"graphql-query-complexity@^0.9.0\".\n\u001b[0m\u001b[91mwarning \" > graphql-redis-subscriptions@2.6.0\" has unmet peer dependency \"graphql-subscriptions@^1.0.0 || ^2.0.0\".\n\u001b[0m\u001b[91mwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"jquery@>=3.6.0\".\nwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"motion-ui@latest\".\nwarning \"spectaql > foundation-sites@6.7.5\" has unmet peer dependency \"what-input@>=5.2.10\".\n\u001b[0m[5/5] Building fresh packages...\nDone in 6.60s.\nRemoving intermediate container 7d35a51b88e4\n ---> 2894c483ddf5\nStep 9/20 : FROM gcr.io/distroless/nodejs:18\n ---> 494d034f1f6d\nStep 10/20 : COPY --from=BUILD_IMAGE /app/lib /app/lib\n ---> 0f0efc7f00b2\nStep 11/20 : COPY --from=BUILD_IMAGE /app/src/config/locales /app/lib/config/locales\n ---> 58c8f6c68f59\nStep 12/20 : COPY --from=BUILD_IMAGE /app/node_modules /app/node_modules\n ---> 05559456b990\nStep 13/20 : WORKDIR /app\n ---> Running in 23208d5127ef\nRemoving intermediate container 23208d5127ef\n ---> 0de224f9a3cf\nStep 14/20 : COPY ./*.js ./package.json ./tsconfig.json ./yarn.lock ./.env ./\n ---> 78a5f8b5d976\nStep 15/20 : USER 1000\n ---> Running in b69fb78f2d29\nRemoving intermediate container b69fb78f2d29\n ---> b47e4c4c12dd\nStep 16/20 : ARG BUILDTIME\n ---> Running in e27d5eaeb7a2\nRemoving intermediate container e27d5eaeb7a2\n ---> 2c40259443be\nStep 17/20 : ARG COMMITHASH\n ---> Running in 6434eed0ea86\nRemoving intermediate container 6434eed0ea86\n ---> 71214e54ad48\nStep 18/20 : ENV BUILDTIME ${BUILDTIME}\n ---> Running in d76f23edd8d1\nRemoving intermediate container d76f23edd8d1\n ---> ccd99c199225\nStep 19/20 : ENV COMMITHASH ${COMMITHASH}\n ---> Running in cd9ba212c54a\nRemoving intermediate container cd9ba212c54a\n ---> 6bc3c433fac9\nStep 20/20 : CMD [\"lib/servers/graphql-main-server.js\"]\n ---> Running in 6d34bc07d4f0\nRemoving intermediate container 6d34bc07d4f0\n ---> 21c410f0e96c\nSuccessfully built 21c410f0e96c\nSuccessfully tagged galoy:latest\n","stderr":"","imageSize":403649427},"endTime":1672652478830}