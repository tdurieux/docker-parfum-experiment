{"repository":"https://github.com/umputun/updater","dockerfilePath":"Dockerfile","startTime":1672366250012,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/umputun/updater'...\n","error":null,"commit":"8fa3fa66c84cfd689f4205c5ada4a8db618a7101"},"originalBuild":{"startTimestamp":1672366251008,"endTimestamp":1672366346919,"error":null,"stdout":"Sending build context to Docker daemon  2.194MB\r\r\nStep 1/16 : FROM umputun/baseimage:buildgo-v1.7.0  as build\nbuildgo-v1.7.0: Pulling from umputun/baseimage\n540db60ca938: Pulling fs layer\nadcc1eea9eea: Pulling fs layer\n4c4ab2625f07: Pulling fs layer\n0510c868ecb4: Pulling fs layer\nafea3b2eda06: Pulling fs layer\n9d0d06bc7f69: Pulling fs layer\n17ac9e1a8774: Pulling fs layer\nfc5e4bb6964a: Pulling fs layer\n1fb01fbbcbc5: Pulling fs layer\n215c904a95bb: Pulling fs layer\n389efbeb2366: Pulling fs layer\n881b0024fbc9: Pulling fs layer\nb78010f816fb: Pulling fs layer\nf7d60261414b: Pulling fs layer\ndb73bf37bfdb: Pulling fs layer\nf7d60261414b: Waiting\n0510c868ecb4: Waiting\n389efbeb2366: Waiting\ndb73bf37bfdb: Waiting\n17ac9e1a8774: Waiting\n881b0024fbc9: Waiting\nfc5e4bb6964a: Waiting\nafea3b2eda06: Waiting\nb78010f816fb: Waiting\n9d0d06bc7f69: Waiting\n1fb01fbbcbc5: Waiting\n215c904a95bb: Waiting\n540db60ca938: Verifying Checksum\n540db60ca938: Download complete\n4c4ab2625f07: Verifying Checksum\n4c4ab2625f07: Download complete\nadcc1eea9eea: Download complete\nafea3b2eda06: Verifying Checksum\nafea3b2eda06: Download complete\n540db60ca938: Pull complete\nadcc1eea9eea: Pull complete\n4c4ab2625f07: Pull complete\n9d0d06bc7f69: Verifying Checksum\n9d0d06bc7f69: Download complete\n0510c868ecb4: Verifying Checksum\n0510c868ecb4: Download complete\nfc5e4bb6964a: Verifying Checksum\nfc5e4bb6964a: Download complete\n17ac9e1a8774: Verifying Checksum\n17ac9e1a8774: Download complete\n1fb01fbbcbc5: Verifying Checksum\n1fb01fbbcbc5: Download complete\n881b0024fbc9: Verifying Checksum\n881b0024fbc9: Download complete\n215c904a95bb: Verifying Checksum\n215c904a95bb: Download complete\nb78010f816fb: Download complete\nf7d60261414b: Verifying Checksum\nf7d60261414b: Download complete\ndb73bf37bfdb: Download complete\n0510c868ecb4: Pull complete\nafea3b2eda06: Pull complete\n9d0d06bc7f69: Pull complete\n389efbeb2366: Verifying Checksum\n389efbeb2366: Download complete\n17ac9e1a8774: Pull complete\nfc5e4bb6964a: Pull complete\n1fb01fbbcbc5: Pull complete\n215c904a95bb: Pull complete\n389efbeb2366: Pull complete\n881b0024fbc9: Pull complete\nb78010f816fb: Pull complete\nf7d60261414b: Pull complete\ndb73bf37bfdb: Pull complete\nDigest: sha256:d76bf5de95c4be34ad32bb35ded88d915b6a71c8161e6c199cf45b03cbc15242\nStatus: Downloaded newer image for umputun/baseimage:buildgo-v1.7.0\n ---> 972409e0d8d1\nStep 2/16 : ARG GIT_BRANCH\n ---> Running in 63278555862a\nRemoving intermediate container 63278555862a\n ---> 4b51bd3e498d\nStep 3/16 : ARG GITHUB_SHA\n ---> Running in e7ca65f89cdc\nRemoving intermediate container e7ca65f89cdc\n ---> 710b3af11fc8\nStep 4/16 : ARG CI\n ---> Running in 9d6ffef2d521\nRemoving intermediate container 9d6ffef2d521\n ---> 244f15f7533a\nStep 5/16 : ENV GOFLAGS=\"-mod=vendor\"\n ---> Running in 425a826a2b24\nRemoving intermediate container 425a826a2b24\n ---> 0ce9b52aeaa7\nStep 6/16 : ENV CGO_ENABLED=0\n ---> Running in 0d264c524fb6\nRemoving intermediate container 0d264c524fb6\n ---> 6a25690eaf74\nStep 7/16 : ADD . /build\n ---> fa3acf39c0b8\nStep 8/16 : WORKDIR /build\n ---> Running in 2a3e91112f61\nRemoving intermediate container 2a3e91112f61\n ---> e1c028131f83\nStep 9/16 : RUN apk add --no-cache --update git tzdata ca-certificates\n ---> Running in d197bef21d08\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.13/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.13/community/x86_64/APKINDEX.tar.gz\nOK: 24 MiB in 27 packages\nRemoving intermediate container d197bef21d08\n ---> 8affd9344387\nStep 10/16 : RUN     if [ -z \"$CI\" ] ; then     echo \"runs outside of CI\" && version=$(git rev-parse --abbrev-ref HEAD)-$(git log -1 --format=%h)-$(date +%Y%m%dT%H:%M:%S);     else version=${GIT_BRANCH}-${GITHUB_SHA:0:7}-$(date +%Y%m%dT%H:%M:%S); fi &&     echo \"version=$version\" &&     cd app && go build -o /build/updater -ldflags \"-X main.revision=${version} -s -w\"\n ---> Running in 669733a2a067\nruns outside of CI\nversion=master-8fa3fa6-20221229T20:11:58\nRemoving intermediate container 669733a2a067\n ---> f71c080340b2\nStep 11/16 : FROM ghcr.io/umputun/baseimage/app:v1.7.0\nv1.7.0: Pulling from umputun/baseimage/app\n540db60ca938: Already exists\n4a54219e8fc2: Pulling fs layer\n9e034b1b42b0: Pulling fs layer\n668d95aee696: Pulling fs layer\n455bfce650d6: Pulling fs layer\n72812992fcae: Pulling fs layer\n72812992fcae: Waiting\n455bfce650d6: Waiting\n9e034b1b42b0: Verifying Checksum\n9e034b1b42b0: Download complete\n4a54219e8fc2: Verifying Checksum\n668d95aee696: Verifying Checksum\n668d95aee696: Download complete\n4a54219e8fc2: Pull complete\n9e034b1b42b0: Pull complete\n455bfce650d6: Verifying Checksum\n455bfce650d6: Download complete\n668d95aee696: Pull complete\n72812992fcae: Verifying Checksum\n72812992fcae: Download complete\n455bfce650d6: Pull complete\n72812992fcae: Pull complete\nDigest: sha256:1c01e8320fbdd6715413c250f0b039c7de763f21da340dcfc2b49205237835f0\nStatus: Downloaded newer image for ghcr.io/umputun/baseimage/app:v1.7.0\n ---> 98c30bbc85f4\nStep 12/16 : RUN apk add docker openssh-client\n ---> Running in eb28aa80bf37\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.13/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.13/community/x86_64/APKINDEX.tar.gz\n(1/17) Installing libseccomp (2.5.1-r1)\n(2/17) Installing runc (1.0.0_rc95-r0)\n(3/17) Installing containerd (1.4.8-r0)\n(4/17) Installing libmnl (1.0.4-r1)\n(5/17) Installing libnftnl-libs (1.1.8-r0)\n(6/17) Installing iptables (1.8.6-r0)\n(7/17) Installing ip6tables (1.8.6-r0)\n(8/17) Installing tini-static (0.19.0-r0)\n(9/17) Installing device-mapper-libs (2.02.187-r1)\n(10/17) Installing docker-engine (20.10.3-r1)\n(11/17) Installing docker-cli (20.10.3-r1)\n(12/17) Installing docker (20.10.3-r1)\nExecuting docker-20.10.3-r1.pre-install\n(13/17) Installing openssh-keygen (8.4_p1-r4)\n(14/17) Installing ncurses-terminfo-base (6.2_p20210109-r1)\n(15/17) Installing ncurses-libs (6.2_p20210109-r1)\n(16/17) Installing libedit (20191231.3.1-r1)\n(17/17) Installing openssh-client (8.4_p1-r4)\nExecuting busybox-1.32.1-r6.trigger\nOK: 266 MiB in 39 packages\nRemoving intermediate container eb28aa80bf37\n ---> fc6dcb24740e\nStep 13/16 : RUN   mkdir -p /home/app/.ssh &&   echo \"StrictHostKeyChecking=no\" > /home/app/.ssh/config &&   echo \"LogLevel=quiet\" >> /home/app/.ssh/config &&   chown -R app:app /home/app/.ssh/ &&   chmod 600 /home/app/.ssh/* &&   chmod 700 /home/app/.ssh\n ---> Running in 04f6b2b6d010\nRemoving intermediate container 04f6b2b6d010\n ---> 6374aff61f4f\nStep 14/16 : COPY --from=build /build/updater /srv/updater\n ---> 4b5b9d5de3d6\nStep 15/16 : WORKDIR /srv\n ---> Running in cb364cbeda30\nRemoving intermediate container cb364cbeda30\n ---> d5e0e7850f19\nStep 16/16 : CMD [\"/srv/updater\"]\n ---> Running in d00eb8de20a1\nRemoving intermediate container d00eb8de20a1\n ---> e1a502b1f013\nSuccessfully built e1a502b1f013\nSuccessfully tagged updater:latest\n","stderr":"","imageSize":284522583},"repair":{"violations":[{"name":"apkAddUseNoCache","position":{"start":23,"end":23,"columnStart":4,"columnEnd":33}}],"repairedDockerfile":"FROM umputun/baseimage:buildgo-v1.7.0  as build\n\nARG GIT_BRANCH\nARG GITHUB_SHA\nARG CI\n\nENV GOFLAGS=\"-mod=vendor\"\nENV CGO_ENABLED=0\n\nADD . /build\nWORKDIR /build\n\nRUN apk add --no-cache --update git tzdata ca-certificates\n\nRUN \\\n    if [ -z \"$CI\" ] ; then \\\n    echo \"runs outside of CI\" && version=$( git rev-parse --abbrev-ref HEAD)-$(git log -1 --format=%h)-$(date +%Y%m%dT%H:%M:%S) ; \\\n    else version=${GIT_BRANCH}-${GITHUB_SHA:0:7}-$(date +%Y%m%dT%H:%M:%S); fi fi && \\\n    echo \"version=$version\" && \\\n    cd app && go build -o /build/updater -ldflags \"-X main.revision=${version} -s -w\"\n\n\nFROM ghcr.io/umputun/baseimage/app:v1.7.0\nRUN apk add --no-cache docker openssh-client\n\nRUN \\\n  mkdir -p /home/app/.ssh && \\\n  echo \"StrictHostKeyChecking=no\" > /home/app/.ssh/config && \\\n  echo \"LogLevel=quiet\" >> /home/app/.ssh/config && \\\n  chown -R app:app /home/app/.ssh/ && \\\n  chmod 600 /home/app/.ssh/* && \\\n  chmod 700 /home/app/.ssh\n\nCOPY --from=build /build/updater /srv/updater\nWORKDIR /srv\nCMD [\"/srv/updater\"]\n"},"repairedBuild":{"startTimestamp":1672366347288,"endTimestamp":1672366357161,"error":{"code":2,"killed":false,"signal":null,"cmd":"docker build --no-cache --force-rm -t updater:latest -f /tmp/dinghy-analysis/umputun/updater/Dockerfile ."},"stdout":"Sending build context to Docker daemon  2.194MB\r\r\nStep 1/16 : FROM umputun/baseimage:buildgo-v1.7.0  as build\n ---> 972409e0d8d1\nStep 2/16 : ARG GIT_BRANCH\n ---> Running in 3789aa796048\nRemoving intermediate container 3789aa796048\n ---> 7c9f0e84de9c\nStep 3/16 : ARG GITHUB_SHA\n ---> Running in bcf9e8fd861e\nRemoving intermediate container bcf9e8fd861e\n ---> 81fb6feaf547\nStep 4/16 : ARG CI\n ---> Running in 1bb183050407\nRemoving intermediate container 1bb183050407\n ---> 24cc735eecf5\nStep 5/16 : ENV GOFLAGS=\"-mod=vendor\"\n ---> Running in abaa4491f994\nRemoving intermediate container abaa4491f994\n ---> c979a349da76\nStep 6/16 : ENV CGO_ENABLED=0\n ---> Running in fe7f17601bd7\nRemoving intermediate container fe7f17601bd7\n ---> e8b5f4c1806e\nStep 7/16 : ADD . /build\n ---> 66a9c9831478\nStep 8/16 : WORKDIR /build\n ---> Running in d9d94d9916a9\nRemoving intermediate container d9d94d9916a9\n ---> 940257a1b9a8\nStep 9/16 : RUN apk add --no-cache --update git tzdata ca-certificates\n ---> Running in b834800db9c7\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.13/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.13/community/x86_64/APKINDEX.tar.gz\nOK: 24 MiB in 27 packages\nRemoving intermediate container b834800db9c7\n ---> e6f3ff5f04d8\nStep 10/16 : RUN     if [ -z \"$CI\" ] ; then     echo \"runs outside of CI\" && version=$( git rev-parse --abbrev-ref HEAD)-$(git log -1 --format=%h)-$(date +%Y%m%dT%H:%M:%S) ;     else version=${GIT_BRANCH}-${GITHUB_SHA:0:7}-$(date +%Y%m%dT%H:%M:%S); fi fi &&     echo \"version=$version\" &&     cd app && go build -o /build/updater -ldflags \"-X main.revision=${version} -s -w\"\n ---> Running in a378b15aaedc\n\u001b[91m/bin/sh: syntax error: unexpected \"fi\"\n\u001b[0mRemoving intermediate container a378b15aaedc\n","stderr":"The command '/bin/sh -c if [ -z \"$CI\" ] ; then     echo \"runs outside of CI\" && version=$( git rev-parse --abbrev-ref HEAD)-$(git log -1 --format=%h)-$(date +%Y%m%dT%H:%M:%S) ;     else version=${GIT_BRANCH}-${GITHUB_SHA:0:7}-$(date +%Y%m%dT%H:%M:%S); fi fi &&     echo \"version=$version\" &&     cd app && go build -o /build/updater -ldflags \"-X main.revision=${version} -s -w\"' returned a non-zero code: 2\n"},"endTime":1672366357257}