{"repository":"https://github.com/threema-ch/threema-web","dockerfilePath":"Dockerfile","startTime":1672373871210,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/threema-ch/threema-web'...\n","error":null,"commit":"6da4922db37c8472736ae3aab3cf0dbcdee12cd7"},"originalBuild":{"startTimestamp":1672373874372,"endTimestamp":1672373965293,"error":null,"stdout":"Sending build context to Docker daemon  57.55MB\r\r\nStep 1/15 : FROM docker.io/node:18 AS builder\n18: Pulling from library/node\nDigest: sha256:e9ad817b0d42b4d177a4bef8a0aff97c352468a008c3fdb2b4a82533425480df\nStatus: Downloaded newer image for node:18\n ---> 7b2a09676e2c\nStep 2/15 : ENV NODE_ENV=production\n ---> Running in e1aa08f237b5\nRemoving intermediate container e1aa08f237b5\n ---> 0f1a416594d2\nStep 3/15 : COPY . /opt/threema-web/\n ---> 086b61961a9f\nStep 4/15 : WORKDIR /opt/threema-web/\n ---> Running in 755ffc8bad97\nRemoving intermediate container 755ffc8bad97\n ---> d810645b01c1\nStep 5/15 : RUN sed -i \"s/SELF_HOSTED: [^,]*,/SELF_HOSTED: true,/g\" src/config.ts\n ---> Running in a73df541504e\nRemoving intermediate container a73df541504e\n ---> e159ac8d01d7\nStep 6/15 : RUN npm ci\n ---> Running in aac9abd42d92\n\u001b[91mnpm WARN deprecated angular-aria@1.8.3: For the actively supported Angular, see https://www.npmjs.com/package/@angular/core. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\u001b[91mnpm WARN deprecated messageformat@2.3.0: Package renamed as '@messageformat/core', see messageformat.github.io for more details. 'messageformat@4' will eventually provide a polyfill for Intl.MessageFormat, once it's been defined by Unicode & ECMA.\n\u001b[0m\u001b[91mnpm WARN deprecated angular-sanitize@1.8.3: For the actively supported Angular, see https://www.npmjs.com/package/@angular/core. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\u001b[91mnpm WARN deprecated angular-animate@1.8.3: For the actively supported Angular, see https://www.npmjs.com/package/@angular/core. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\u001b[91mnpm WARN deprecated angular@1.8.3: For the actively supported Angular, see https://www.npmjs.com/package/@angular/core. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\u001b[91mnpm WARN deprecated angular-route@1.8.3: For the actively supported Angular, see https://www.npmjs.com/package/@angular/core. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\u001b[91mnpm WARN deprecated @npmcli/move-file@1.1.2: This functionality has been moved to @npmcli/fs\n\u001b[0m\u001b[91mnpm WARN deprecated @npmcli/move-file@2.0.1: This functionality has been moved to @npmcli/fs\n\u001b[0m\u001b[91mnpm WARN \u001b[0m\u001b[91mdeprecated angular-material@1.2.5: For the actively supported Angular Material, see https://www.npmjs.com/package/@angular/material. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\nadded 540 packages, and audited 541 packages in 9s\n\n44 packages are looking for funding\n  run `npm fund` for details\n\n5 vulnerabilities (4 moderate, 1 high)\n\nTo address issues that do not require attention, run:\n  npm audit fix\n\nTo address all issues (including breaking changes), run:\n  npm audit fix --force\n\nRun `npm audit` for details.\n\u001b[91mnpm notice \nnpm notice New major version of npm available! 8.19.2 -> 9.2.0\nnpm \u001b[0m\u001b[91mnotice Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\n\u001b[0m\u001b[91mnpm notice\u001b[0m\u001b[91m Run `npm install -g npm@9.2.0` to update!\nnpm \u001b[0m\u001b[91mnotice \n\u001b[0mRemoving intermediate container aac9abd42d92\n ---> eca08d755420\nStep 7/15 : RUN npm run dist -- d\n ---> Running in c811a3483676\n\n> threema-web@2.5.0 dist\n> npm run clean && npm run build && echo \"\" && node dist/build-package.js d\n\n\n> threema-web@2.5.0 clean\n> rm -rf dist/generated\n\n\n> threema-web@2.5.0 build\n> npm run build:js && npm run build:css\n\n\n> threema-web@2.5.0 build:js\n> webpack --config webpack.prod.js\n\nassets by info 617 KiB [immutable]\n  asset 218.299e5a3d5852827c5ed4.bundle.js 357 KiB [emitted] [immutable] [minimized] [big] 1 related asset\n  asset 308.7fa12a9253c2ff0e7578.bundle.js 168 KiB [emitted] [immutable] [minimized] (id hint: vendors) 2 related assets\n  asset 77de81abe7775245a1c1.module.wasm 91.5 KiB [emitted] [immutable] (auxiliary id hint: vendors)\nasset app.bundle.js 11.6 KiB [emitted] [minimized] (name: app) 2 related assets\nasset userconfig.js 3.92 KiB [emitted] [from: src/userconfig.js] [copied] [minimized]\norphan modules 771 KiB [orphan] 124 modules\nruntime modules 27.9 KiB 12 modules\ncacheable modules 1.12 MiB (javascript) 91.5 KiB (webassembly)\n  modules by path ./node_modules/ 584 KiB (javascript) 91.5 KiB (webassembly)\n    modules by path ./node_modules/msgpack-lite/lib/*.js 49.6 KiB 28 modules\n    modules by path ./node_modules/ts-events/dist/lib/*.js 140 KiB 8 modules\n    modules by path ./node_modules/@threema/ 37.7 KiB (javascript) 91.5 KiB (webassembly)\n      ./node_modules/@threema/threema-markup/dist/index.js 10.1 KiB [built] [code generated]\n      + 2 modules\n    + 12 modules\n  modules by path ./src/*.ts 560 KiB\n    ./src/bootstrap.ts 536 bytes [built] [code generated]\n    ./src/app.ts + 93 modules 560 KiB [built] [code generated]\n  crypto (ignored) 15 bytes [built] [code generated]\n\nWARNING in asset size limit: The following asset(s) exceed the recommended size limit (244 KiB).\nThis can impact web performance.\nAssets: \n  218.299e5a3d5852827c5ed4.bundle.js (357 KiB)\n\nwebpack 5.75.0 compiled with 1 warning in 8650 ms\n\n> threema-web@2.5.0 build:css\n> node-sass -o public/css/ --output-style compressed src/sass/\n\nRendering Complete, saving .css file...\nWrote CSS to /opt/threema-web/public/css/app.css\nWrote 1 CSS files to /opt/threema-web/public/css/\n\n _____ _                         _ _ _     _     \n|_   _| |_ ___ ___ ___ _____ ___| | | |___| |_   \n  | | |   |  _| -_| -_|     | .'| | | | -_| . | \u001b[32m_\u001b[0m \n  |_| |_|_|_| |___|___|_|_|_|__,|_____|___|___|\u001b[32m|_|\u001b[0m\n\nCreating release distribution for Threema Web\n\n+ Packaging version 2.5.0d\n+ Create release directory...\n+ Copy code...\n+ Copy dependencies...\n+ Update version number...\n+ Update permissions...\n+ Put everything in an archive...\n\nDone.\nRemoving intermediate container c811a3483676\n ---> d2ceaea22dd0\nStep 8/15 : FROM docker.io/nginx:1.23-alpine\n1.23-alpine: Pulling from library/nginx\nc158987b0551: Already exists\n1e35f6679fab: Pulling fs layer\ncb9626c74200: Pulling fs layer\nb6334b6ace34: Pulling fs layer\nf1d1c9928c82: Pulling fs layer\n9b6f639ec6ea: Pulling fs layer\nee68d3549ec8: Pulling fs layer\n9b6f639ec6ea: Waiting\nee68d3549ec8: Waiting\nf1d1c9928c82: Waiting\nb6334b6ace34: Verifying Checksum\nb6334b6ace34: Download complete\ncb9626c74200: Verifying Checksum\ncb9626c74200: Download complete\n1e35f6679fab: Verifying Checksum\n1e35f6679fab: Download complete\n1e35f6679fab: Pull complete\nf1d1c9928c82: Verifying Checksum\nf1d1c9928c82: Download complete\n9b6f639ec6ea: Verifying Checksum\n9b6f639ec6ea: Download complete\ncb9626c74200: Pull complete\nee68d3549ec8: Download complete\nb6334b6ace34: Pull complete\nf1d1c9928c82: Pull complete\n9b6f639ec6ea: Pull complete\nee68d3549ec8: Pull complete\nDigest: sha256:dd8a054d7ef030e94a6449783605d6c306c1f69c10c2fa06b66a030e0d1db793\nStatus: Downloaded newer image for nginx:1.23-alpine\n ---> 1e415454686a\nStep 9/15 : RUN apk add --update bash\n ---> Running in a80c7bab7112\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\n(1/2) Installing readline (8.2.0-r0)\n(2/2) Installing bash (5.2.15-r0)\nExecuting bash-5.2.15-r0.post-install\nExecuting busybox-1.35.0-r29.trigger\nOK: 45 MiB in 64 packages\nRemoving intermediate container a80c7bab7112\n ---> 8695856b853e\nStep 10/15 : RUN rm /usr/share/nginx/html/*\n ---> Running in b41e122a04b8\nRemoving intermediate container b41e122a04b8\n ---> 8369cd782450\nStep 11/15 : COPY --from=builder /opt/threema-web/release/threema-web-* /usr/share/nginx/html/\n ---> a824af7ecd11\nStep 12/15 : COPY docker/entrypoint.sh /usr/local/bin/\n ---> 90ba2daa4d7d\nStep 13/15 : EXPOSE 80\n ---> Running in d9f057d04292\nRemoving intermediate container d9f057d04292\n ---> 1db8f3e15538\nStep 14/15 : ENV VISUALIZE_STATE=false     CONSOLE_LOG_LEVEL=info\n ---> Running in ae985dfff1d1\nRemoving intermediate container ae985dfff1d1\n ---> f3d58b4e1aae\nStep 15/15 : CMD [\"/bin/bash\", \"/usr/local/bin/entrypoint.sh\"]\n ---> Running in 5086faf61e1a\nRemoving intermediate container 5086faf61e1a\n ---> 0141165587d1\nSuccessfully built 0141165587d1\nSuccessfully tagged threema-web:latest\n","stderr":"","imageSize":75637877},"repair":{"violations":[{"name":"apkAddUseNoCache","position":{"start":23,"end":23,"columnStart":4,"columnEnd":25}}],"repairedDockerfile":"# Dockerfile for Threema Web, based on the nginx alpine image.\n#\n# WARNING: This Dockerfile does not include TLS termination. Make sure to run\n#          the container behind a reverse proxy (e.g. Nginx) that does proper\n#          TLS termination.\n\n# First, build Threema Web in a node container\n\nFROM docker.io/node:18 AS builder\nENV NODE_ENV=production\n\nCOPY . /opt/threema-web/\nWORKDIR /opt/threema-web/\n\nRUN sed -i \"s/SELF_HOSTED: [^,]*,/SELF_HOSTED: true,/g\" src/config.ts\n\nRUN npm ci\nRUN npm run dist -- d\n\n# Then, transfer the build artifacts to a minimal nginx container\n\nFROM docker.io/nginx:1.23-alpine\n\nRUN apk add --no-cache --update bash\n\nRUN rm /usr/share/nginx/html/*\nCOPY --from=builder /opt/threema-web/release/threema-web-* /usr/share/nginx/html/\nCOPY docker/entrypoint.sh /usr/local/bin/\n\nEXPOSE 80\n\n# Set better defaults for production\nENV VISUALIZE_STATE=false \\\n    CONSOLE_LOG_LEVEL=info\n\nCMD [\"/bin/bash\", \"/usr/local/bin/entrypoint.sh\"]\n"},"repairedBuild":{"startTimestamp":1672373965695,"endTimestamp":1672374038190,"error":null,"stdout":"Sending build context to Docker daemon  57.55MB\r\r\nStep 1/15 : FROM docker.io/node:18 AS builder\n ---> 7b2a09676e2c\nStep 2/15 : ENV NODE_ENV=production\n ---> Running in 5bd80cd39d31\nRemoving intermediate container 5bd80cd39d31\n ---> 9066c61f56e6\nStep 3/15 : COPY . /opt/threema-web/\n ---> bc88ec90fcc3\nStep 4/15 : WORKDIR /opt/threema-web/\n ---> Running in cf127036e6e8\nRemoving intermediate container cf127036e6e8\n ---> e905d94a57fc\nStep 5/15 : RUN sed -i \"s/SELF_HOSTED: [^,]*,/SELF_HOSTED: true,/g\" src/config.ts\n ---> Running in 09c927851e48\nRemoving intermediate container 09c927851e48\n ---> 872707e2b67b\nStep 6/15 : RUN npm ci\n ---> Running in 27595c8703ae\n\u001b[91mnpm WARN deprecated angular-aria@1.8.3: For the actively supported Angular, see https://www.npmjs.com/package/@angular/core. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\u001b[91mnpm WARN deprecated angular-route@1.8.3: For the actively supported Angular, see https://www.npmjs.com/package/@angular/core. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\u001b[91mnpm WARN deprecated angular-sanitize@1.8.3: For the actively supported Angular, see https://www.npmjs.com/package/@angular/core. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\u001b[91mnpm WARN deprecated @npmcli/move-file@1.1.2: This functionality has been moved to @npmcli/fs\n\u001b[0m\u001b[91mnpm WARN deprecated @npmcli/move-file@2.0.1: This functionality has been moved to @npmcli/fs\n\u001b[0m\u001b[91mnpm WARN deprecated messageformat@2.3.0: Package renamed as '@messageformat/core', see messageformat.github.io for more details. 'messageformat@4' will eventually provide a polyfill for Intl.MessageFormat, once it's been defined by Unicode & ECMA.\n\u001b[0m\u001b[91mnpm WARN deprecated angular-animate@1.8.3: For the actively supported Angular, see https://www.npmjs.com/package/@angular/core. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\u001b[91mnpm WARN deprecated angular@1.8.3: For the actively supported Angular, see https://www.npmjs.com/package/@angular/core. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\u001b[91mnpm WARN \u001b[0m\u001b[91mdeprecated angular-material@1.2.5: For the actively supported Angular Material, see https://www.npmjs.com/package/@angular/material. AngularJS support has officially ended. For extended AngularJS support options, see https://goo.gle/angularjs-path-forward.\n\u001b[0m\nadded 540 packages, and audited 541 packages in 7s\n\n44 packages are looking for funding\n  run `npm fund` for details\n\n5 vulnerabilities (4 moderate, 1 high)\n\nTo address issues that do not require attention, run:\n  npm audit fix\n\nTo address all issues (including breaking changes), run:\n  npm audit fix --force\n\nRun `npm audit` for details.\n\u001b[91mnpm notice \nnpm notice New major version of npm available! 8.19.2 -> 9.2.0\nnpm notice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\nnpm notice Run `npm install -g npm@9.2.0` to update!\nnpm notice \n\u001b[0mRemoving intermediate container 27595c8703ae\n ---> 88ef479970f5\nStep 7/15 : RUN npm run dist -- d\n ---> Running in b7888526a28c\n\n> threema-web@2.5.0 dist\n> npm run clean && npm run build && echo \"\" && node dist/build-package.js d\n\n\n> threema-web@2.5.0 clean\n> rm -rf dist/generated\n\n\n> threema-web@2.5.0 build\n> npm run build:js && npm run build:css\n\n\n> threema-web@2.5.0 build:js\n> webpack --config webpack.prod.js\n\nassets by info 617 KiB [immutable]\n  asset 218.299e5a3d5852827c5ed4.bundle.js 357 KiB [emitted] [immutable] [minimized] [big] 1 related asset\n  asset 308.7fa12a9253c2ff0e7578.bundle.js 168 KiB [emitted] [immutable] [minimized] (id hint: vendors) 2 related assets\n  asset 77de81abe7775245a1c1.module.wasm 91.5 KiB [emitted] [immutable] (auxiliary id hint: vendors)\nasset app.bundle.js 11.6 KiB [emitted] [minimized] (name: app) 2 related assets\nasset userconfig.js 3.92 KiB [emitted] [from: src/userconfig.js] [copied] [minimized]\norphan modules 771 KiB [orphan] 124 modules\nruntime modules 27.9 KiB 12 modules\ncacheable modules 1.12 MiB (javascript) 91.5 KiB (webassembly)\n  modules by path ./node_modules/ 584 KiB (javascript) 91.5 KiB (webassembly)\n    modules by path ./node_modules/msgpack-lite/lib/*.js 49.6 KiB 28 modules\n    modules by path ./node_modules/ts-events/dist/lib/*.js 140 KiB 8 modules\n    modules by path ./node_modules/@threema/ 37.7 KiB (javascript) 91.5 KiB (webassembly)\n      ./node_modules/@threema/threema-markup/dist/index.js 10.1 KiB [built] [code generated]\n      + 2 modules\n    + 12 modules\n  modules by path ./src/*.ts 560 KiB\n    ./src/bootstrap.ts 536 bytes [built] [code generated]\n    ./src/app.ts + 93 modules 560 KiB [built] [code generated]\n  crypto (ignored) 15 bytes [built] [code generated]\n\nWARNING in asset size limit: The following asset(s) exceed the recommended size limit (244 KiB).\nThis can impact web performance.\nAssets: \n  218.299e5a3d5852827c5ed4.bundle.js (357 KiB)\n\nwebpack 5.75.0 compiled with 1 warning in 8683 ms\n\n> threema-web@2.5.0 build:css\n> node-sass -o public/css/ --output-style compressed src/sass/\n\nRendering Complete, saving .css file...\nWrote CSS to /opt/threema-web/public/css/app.css\nWrote 1 CSS files to /opt/threema-web/public/css/\n\n _____ _                         _ _ _     _     \n|_   _| |_ ___ ___ ___ _____ ___| | | |___| |_   \n  | | |   |  _| -_| -_|     | .'| | | | -_| . | \u001b[32m_\u001b[0m \n  |_| |_|_|_| |___|___|_|_|_|__,|_____|___|___|\u001b[32m|_|\u001b[0m\n\nCreating release distribution for Threema Web\n\n+ Packaging version 2.5.0d\n+ Create release directory...\n+ Copy code...\n+ Copy dependencies...\n+ Update version number...\n+ Update permissions...\n+ Put everything in an archive...\n\nDone.\nRemoving intermediate container b7888526a28c\n ---> a49813fc9f00\nStep 8/15 : FROM docker.io/nginx:1.23-alpine\n ---> 1e415454686a\nStep 9/15 : RUN apk add --no-cache --update bash\n ---> Running in 9ed881ccc345\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\n(1/2) Installing readline (8.2.0-r0)\n(2/2) Installing bash (5.2.15-r0)\nExecuting bash-5.2.15-r0.post-install\nExecuting busybox-1.35.0-r29.trigger\nOK: 45 MiB in 64 packages\nRemoving intermediate container 9ed881ccc345\n ---> 8fc2d16991d0\nStep 10/15 : RUN rm /usr/share/nginx/html/*\n ---> Running in 2d328b5739b8\nRemoving intermediate container 2d328b5739b8\n ---> 4db7cb256ad3\nStep 11/15 : COPY --from=builder /opt/threema-web/release/threema-web-* /usr/share/nginx/html/\n ---> 2038d07af065\nStep 12/15 : COPY docker/entrypoint.sh /usr/local/bin/\n ---> 3501e8b9e689\nStep 13/15 : EXPOSE 80\n ---> Running in cf00fa25ed61\nRemoving intermediate container cf00fa25ed61\n ---> c0f9ed2d7244\nStep 14/15 : ENV VISUALIZE_STATE=false     CONSOLE_LOG_LEVEL=info\n ---> Running in a34f7b832390\nRemoving intermediate container a34f7b832390\n ---> 7ee8eb7e94f0\nStep 15/15 : CMD [\"/bin/bash\", \"/usr/local/bin/entrypoint.sh\"]\n ---> Running in 5f77c39bd005\nRemoving intermediate container 5f77c39bd005\n ---> 7b190b11dfc1\nSuccessfully built 7b190b11dfc1\nSuccessfully tagged threema-web:latest\n","stderr":"","imageSize":73055171},"endTime":1672374038648}