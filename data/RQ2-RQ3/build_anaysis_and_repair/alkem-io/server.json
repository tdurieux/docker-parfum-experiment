{"repository":"https://github.com/alkem-io/server","dockerfilePath":"Dockerfile","startTime":1672926710615,"endTime":1672927390981,"clone":{"startTime":1672926710616,"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/alkem-io/server'...\n","error":null,"endTime":1672926712462,"commit":"483220e3879e8d68de529dd7dc14be7e774c6253"},"originalBuild":{"startTime":1672926712555,"endTime":1672926962188,"error":null,"stdout":"Sending build context to Docker daemon  5.485MB\r\r\nStep 1/21 : FROM node:16.15.0-alpine\n16.15.0-alpine: Pulling from library/node\ndf9b9388f04a: Already exists\n70c90f7de7cb: Pulling fs layer\nf83937c3ce37: Pulling fs layer\n98b78bba1d70: Pulling fs layer\n98b78bba1d70: Download complete\nf83937c3ce37: Verifying Checksum\nf83937c3ce37: Download complete\n70c90f7de7cb: Verifying Checksum\n70c90f7de7cb: Download complete\n70c90f7de7cb: Pull complete\nf83937c3ce37: Pull complete\n98b78bba1d70: Pull complete\nDigest: sha256:1a9a71ea86aad332aa7740316d4111ee1bd4e890df47d3b5eff3e5bded3b3d10\nStatus: Downloaded newer image for node:16.15.0-alpine\n ---> e5065cc78074\nStep 2/21 : RUN apk add --update mariadb-client && apk add python3 && rm -rf /var/cache/apk/*\n ---> Running in 5a5145117a8a\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/community/x86_64/APKINDEX.tar.gz\n(1/4) Installing mariadb-common (10.6.10-r0)\n(2/4) Installing ncurses-terminfo-base (6.3_p20211120-r1)\n(3/4) Installing ncurses-libs (6.3_p20211120-r1)\n(4/4) Installing mariadb-client (10.6.10-r0)\nExecuting busybox-1.34.1-r5.trigger\nOK: 39 MiB in 20 packages\n(1/9) Installing libbz2 (1.0.8-r1)\n(2/9) Installing expat (2.5.0-r0)\n(3/9) Installing libffi (3.4.2-r1)\n(4/9) Installing gdbm (1.22-r0)\n(5/9) Installing xz-libs (5.2.5-r1)\n(6/9) Installing mpdecimal (2.5.1-r1)\n(7/9) Installing readline (8.1.1-r0)\n(8/9) Installing sqlite-libs (3.36.0-r0)\n(9/9) Installing python3 (3.9.16-r0)\nExecuting busybox-1.34.1-r5.trigger\nOK: 87 MiB in 29 packages\nRemoving intermediate container 5a5145117a8a\n ---> 1fd6ed6b83fe\nStep 3/21 : WORKDIR /usr/src/app\n ---> Running in 230e86a344b2\nRemoving intermediate container 230e86a344b2\n ---> d1d7a922bc76\nStep 4/21 : ARG GRAPHQL_ENDPOINT_PORT_ARG=4000\n ---> Running in 2ab7fbfc1567\nRemoving intermediate container 2ab7fbfc1567\n ---> 9e7082fbeed7\nStep 5/21 : ARG ENV_ARG=production\n ---> Running in 521f66f2904d\nRemoving intermediate container 521f66f2904d\n ---> c707534acbd1\nStep 6/21 : COPY package*.json ./\n ---> e1b7c11b93fa\nStep 7/21 : RUN npm i -g npm@8.5.5\n ---> Running in a780839c1756\n\nchanged 14 packages, and audited 201 packages in 46s\n\n10 packages are looking for funding\n  run `npm fund` for details\n\n1 high severity vulnerability\n\nTo address all issues, run:\n  npm audit fix --force\n\nRun `npm audit` for details.\n\u001b[91mnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m \nnpm notice\u001b[0m\u001b[91m New major version of npm available! 8.5.5 -> 9.2.0\nnpm notice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\nnpm notice Run `npm install -g npm@9.2.0` to update!\nnpm\u001b[0m\u001b[91m notice \n\u001b[0mRemoving intermediate container a780839c1756\n ---> f5511653eccc\nStep 8/21 : RUN npm install\n ---> Running in a69853701eca\n\u001b[91mnpm\u001b[0m\u001b[91m WARN\u001b[0m\u001b[91m deprecated cids@1.1.9: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated multibase@4.0.6: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated multicodec@3.2.1: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated uuid@3.4.0: Please upgrade  to version 7 or higher.  Older versions may use Math.random() in certain circumstances, which is known to be problematic.  See https://v8.dev/blog/math-random for details.\n\u001b[0m\u001b[91mnpm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142\n\u001b[0m\u001b[91mnpm WARN deprecated subscriptions-transport-ws@0.11.0: The `subscriptions-transport-ws` package is no longer maintained. We recommend you use `graphql-ws` instead. For help migrating Apollo software to `graphql-ws`, see https://www.apollographql.com/docs/apollo-server/data/subscriptions/#switching-from-subscriptions-transport-ws    For general help using `graphql-ws`, see https://github.com/enisdenjo/graphql-ws/blob/master/README.md\n\u001b[0m\u001b[91mnpm WARN deprecated har-validator@5.1.5: this library is no longer supported\n\u001b[0m\u001b[91mnpm WARN deprecated @types/yaml@1.9.7: This is a stub types definition. yaml provides its own type definitions, so you do not need this installed.\n\u001b[0m\nadded 1314 packages, and audited 1315 packages in 35s\n\n134 packages are looking for funding\n  run `npm fund` for details\n\n30 vulnerabilities (1 low, 12 moderate, 17 high)\n\nTo address issues that do not require attention, run:\n  npm audit fix\n\nTo address all issues possible (including breaking changes), run:\n  npm audit fix --force\n\nSome issues need review, and may require choosing\na different dependency.\n\nRun `npm audit` for details.\nRemoving intermediate container a69853701eca\n ---> 11a497fbc5e1\nStep 9/21 : COPY ./src ./src\n ---> 62731d012cc9\nStep 10/21 : COPY ./tsconfig.json .\n ---> beb0c47dc677\nStep 11/21 : COPY ./tsconfig.build.json .\n ---> a442ad0f4909\nStep 12/21 : COPY ./alkemio.yml .\n ---> 5b6607d261c6\nStep 13/21 : RUN npm run build\n ---> Running in 070d2f2b739d\n\n> alkemio-server@0.39.6 prebuild\n> rimraf dist\n\n\n> alkemio-server@0.39.6 build\n> nest build\n\nRemoving intermediate container 070d2f2b739d\n ---> cab721ce12c4\nStep 14/21 : ADD https://github.com/ufoscout/docker-compose-wait/releases/download/2.7.3/wait /wait\n\n\n ---> f1aa299f7254\nStep 15/21 : RUN chmod +x /wait\n ---> Running in 28e2ed0ba26e\nRemoving intermediate container 28e2ed0ba26e\n ---> e31b9a91e624\nStep 16/21 : ENV GRAPHQL_ENDPOINT_PORT=${GRAPHQL_ENDPOINT_PORT_ARG}\n ---> Running in 2b742945c875\nRemoving intermediate container 2b742945c875\n ---> 0619a49f1343\nStep 17/21 : ENV NODE_ENV=${ENV_ARG}\n ---> Running in e76b01e00e59\nRemoving intermediate container e76b01e00e59\n ---> 0928c0d1a0d6\nStep 18/21 : ADD .scripts/create_db.sh /create_db.sh\n ---> d940cdbac35a\nStep 19/21 : RUN chmod +x /create_db.sh\n ---> Running in 2ca83703e354\nRemoving intermediate container 2ca83703e354\n ---> 1b0d2b76ebc6\nStep 20/21 : EXPOSE ${GRAPHQL_ENDPOINT_PORT_ARG}\n ---> Running in 006cbd6a21c4\nRemoving intermediate container 006cbd6a21c4\n ---> 1b666bf5b865\nStep 21/21 : CMD [\"/bin/sh\", \"-c\", \"/create_db.sh && npm run start:prod\"]\n ---> Running in 10267222855d\nRemoving intermediate container 10267222855d\n ---> 83964fde9e3d\nSuccessfully built 83964fde9e3d\nSuccessfully tagged server:latest\n","stderr":"","imageSize":645324398},"repair":{"startTime":1672926962252,"endTime":1672926962369,"violations":[{"name":"npmCacheCleanAfterInstall","position":{"start":18,"end":18,"columnStart":4,"columnEnd":22}},{"name":"npmCacheCleanAfterInstall","position":{"start":19,"end":19,"columnStart":4,"columnEnd":15}}],"repairedDockerfile":"FROM node:16.15.0-alpine\n\n\n#install CLI mariadb/mysql client\nRUN apk add --update mariadb-client && apk add python3 && rm -rf /var/cache/apk/*\n\n# Create app directory\nWORKDIR /usr/src/app\n\n# Define graphql server port\nARG GRAPHQL_ENDPOINT_PORT_ARG=4000\nARG ENV_ARG=production\n\n# Install app dependencies\n# A wildcard is used to ensure both package.json AND package-lock.json are copied\n# where available (npm@5+)\nCOPY package*.json ./\n\nRUN npm i -g npm@8.5.5 && npm cache clean --force;\nRUN npm install && npm cache clean --force;\n\n# If you are building your code for production\n# RUN npm ci --only=production\n\n# Bundle app source & config files for TypeORM & TypeScript\nCOPY ./src ./src\nCOPY ./tsconfig.json .\nCOPY ./tsconfig.build.json .\nCOPY ./alkemio.yml .\n\nRUN npm run build\n\n## Add the wait script to the image\nADD https://github.com/ufoscout/docker-compose-wait/releases/download/2.7.3/wait /wait\nRUN chmod +x /wait\n\nENV GRAPHQL_ENDPOINT_PORT=${GRAPHQL_ENDPOINT_PORT_ARG}\nENV NODE_ENV=${ENV_ARG}\n\nADD .scripts/create_db.sh /create_db.sh\nRUN chmod +x /create_db.sh\n\n\nEXPOSE ${GRAPHQL_ENDPOINT_PORT_ARG}\nCMD [\"/bin/sh\", \"-c\", \"/create_db.sh && npm run start:prod\"]\n"},"repairedBuild":{"startTime":1672926963707,"endTime":1672927387960,"error":null,"stdout":"Sending build context to Docker daemon  5.485MB\r\r\nStep 1/21 : FROM node:16.15.0-alpine\n ---> e5065cc78074\nStep 2/21 : RUN apk add --update mariadb-client && apk add python3 && rm -rf /var/cache/apk/*\n ---> Running in dde37c553814\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.15/community/x86_64/APKINDEX.tar.gz\n(1/4) Installing mariadb-common (10.6.10-r0)\n(2/4) Installing ncurses-terminfo-base (6.3_p20211120-r1)\n(3/4) Installing ncurses-libs (6.3_p20211120-r1)\n(4/4) Installing mariadb-client (10.6.10-r0)\nExecuting busybox-1.34.1-r5.trigger\nOK: 39 MiB in 20 packages\n(1/9) Installing libbz2 (1.0.8-r1)\n(2/9) Installing expat (2.5.0-r0)\n(3/9) Installing libffi (3.4.2-r1)\n(4/9) Installing gdbm (1.22-r0)\n(5/9) Installing xz-libs (5.2.5-r1)\n(6/9) Installing mpdecimal (2.5.1-r1)\n(7/9) Installing readline (8.1.1-r0)\n(8/9) Installing sqlite-libs (3.36.0-r0)\n(9/9) Installing python3 (3.9.16-r0)\nExecuting busybox-1.34.1-r5.trigger\nOK: 87 MiB in 29 packages\nRemoving intermediate container dde37c553814\n ---> c0d9baf78e6f\nStep 3/21 : WORKDIR /usr/src/app\n ---> Running in 83776d84c3f4\nRemoving intermediate container 83776d84c3f4\n ---> eb5e17a9083e\nStep 4/21 : ARG GRAPHQL_ENDPOINT_PORT_ARG=4000\n ---> Running in 34373c17050a\nRemoving intermediate container 34373c17050a\n ---> 0450c694ccda\nStep 5/21 : ARG ENV_ARG=production\n ---> Running in 094f87777902\nRemoving intermediate container 094f87777902\n ---> f89e038b98db\nStep 6/21 : COPY package*.json ./\n ---> 26ce8b3c8178\nStep 7/21 : RUN npm i -g npm@8.5.5 && npm cache clean --force;\n ---> Running in 5531e29efec8\n\nchanged 14 packages, and audited 201 packages in 1m\n\n10 packages are looking for funding\n  run `npm fund` for details\n\n1 high severity vulnerability\n\nTo address all issues, run:\n  npm audit fix --force\n\nRun `npm audit` for details.\n\u001b[91mnpm \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m \n\u001b[0m\u001b[91mnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m New major version of npm available! 8.5.5 -> 9.2.0\nnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\nnpm\u001b[0m\u001b[91m \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m Run `npm install -g npm@9.2.0` to update!\nnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m \n\u001b[0m\u001b[91mnpm\u001b[0m\u001b[91m WARN using --force\u001b[0m\u001b[91m Recommended protections disabled.\n\u001b[0mRemoving intermediate container 5531e29efec8\n ---> 707d2ec4d79c\nStep 8/21 : RUN npm install && npm cache clean --force;\n ---> Running in b634775403e9\n\u001b[91mnpm WARN deprecated cids@1.1.9: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated multibase@4.0.6: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated uuid@3.4.0: Please upgrade  to version 7 or higher.  Older versions may use Math.random() in certain circumstances, which is known to be problematic.  See https://v8.dev/blog/math-random for details.\n\u001b[0m\u001b[91mnpm WARN deprecated request@2.88.2: request has been deprecated, see https://github.com/request/request/issues/3142\n\u001b[0m\u001b[91mnpm WARN deprecated har-validator@5.1.5: this library is no longer supported\n\u001b[0m\u001b[91mnpm WARN deprecated multicodec@3.2.1: This module has been superseded by the multiformats module\n\u001b[0m\u001b[91mnpm WARN deprecated\u001b[0m\u001b[91m @types/yaml@1.9.7: This is a stub types definition. yaml provides its own type definitions, so you do not need this installed.\n\u001b[0m\u001b[91mnpm WARN deprecated subscriptions-transport-ws@0.11.0: The `subscriptions-transport-ws` package is no longer maintained. We recommend you use `graphql-ws` instead. For help migrating Apollo software to `graphql-ws`, see https://www.apollographql.com/docs/apollo-server/data/subscriptions/#switching-from-subscriptions-transport-ws    For general help using `graphql-ws`, see https://github.com/enisdenjo/graphql-ws/blob/master/README.md\n\u001b[0m\nadded 1314 packages, and audited 1315 packages in 38s\n\n134 packages are looking for funding\n  run `npm fund` for details\n\n30 vulnerabilities (1 low, 12 moderate, 17 high)\n\nTo address issues that do not require attention, run:\n  npm audit fix\n\nTo address all issues possible (including breaking changes), run:\n  npm audit fix --force\n\nSome issues need review, and may require choosing\na different dependency.\n\nRun `npm audit` for details.\n\u001b[91mnpm\u001b[0m\u001b[91m WARN \u001b[0m\u001b[91musing --force\u001b[0m\u001b[91m Recommended protections disabled.\n\u001b[0mRemoving intermediate container b634775403e9\n ---> 2e4fdb0cab84\nStep 9/21 : COPY ./src ./src\n ---> 0738399fc812\nStep 10/21 : COPY ./tsconfig.json .\n ---> 5d979e9275a6\nStep 11/21 : COPY ./tsconfig.build.json .\n ---> 68557b0b6137\nStep 12/21 : COPY ./alkemio.yml .\n ---> d7e3ef37d0de\nStep 13/21 : RUN npm run build\n ---> Running in b83b6c3f9032\n\n> alkemio-server@0.39.6 prebuild\n> rimraf dist\n\n\n> alkemio-server@0.39.6 build\n> nest build\n\nRemoving intermediate container b83b6c3f9032\n ---> fa8397c02ad9\nStep 14/21 : ADD https://github.com/ufoscout/docker-compose-wait/releases/download/2.7.3/wait /wait\n\n\n ---> c751a25f271e\nStep 15/21 : RUN chmod +x /wait\n ---> Running in ff142c4ed942\nRemoving intermediate container ff142c4ed942\n ---> 9579b52cf828\nStep 16/21 : ENV GRAPHQL_ENDPOINT_PORT=${GRAPHQL_ENDPOINT_PORT_ARG}\n ---> Running in 4ada07efafb8\nRemoving intermediate container 4ada07efafb8\n ---> 9fd0c3535312\nStep 17/21 : ENV NODE_ENV=${ENV_ARG}\n ---> Running in 8ecb7ae76f9c\nRemoving intermediate container 8ecb7ae76f9c\n ---> 6eb59f410e5a\nStep 18/21 : ADD .scripts/create_db.sh /create_db.sh\n ---> 6bac8d7dc2c8\nStep 19/21 : RUN chmod +x /create_db.sh\n ---> Running in e3284435dbcd\nRemoving intermediate container e3284435dbcd\n ---> f1fa9e90a6d7\nStep 20/21 : EXPOSE ${GRAPHQL_ENDPOINT_PORT_ARG}\n ---> Running in e61a73120c13\nRemoving intermediate container e61a73120c13\n ---> e4405d92d15f\nStep 21/21 : CMD [\"/bin/sh\", \"-c\", \"/create_db.sh && npm run start:prod\"]\n ---> Running in e61205669553\nRemoving intermediate container e61205669553\n ---> de33f4318772\nSuccessfully built de33f4318772\nSuccessfully tagged server:latest\n","stderr":"","imageSize":499502118}}