{"repository":"https://github.com/hibiken/asynqmon","dockerfilePath":"Dockerfile","startTime":1672049581971,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/hibiken/asynqmon'...\n","error":null,"commit":"5c48e4e31d6bbfe8f5ee0142ee1bc563aefaa558"},"originalBuild":{"startTimestamp":1672049583522,"endTimestamp":1672049877924,"error":null,"stdout":"Sending build context to Docker daemon  8.047MB\r\r\nStep 1/16 : FROM alpine:3.13 AS frontend\n3.13: Pulling from library/alpine\n72cfd02ff4d0: Pulling fs layer\n72cfd02ff4d0: Verifying Checksum\n72cfd02ff4d0: Download complete\n72cfd02ff4d0: Pull complete\nDigest: sha256:469b6e04ee185740477efa44ed5bdd64a07bbdd6c7e5f5d169e540889597b911\nStatus: Downloaded newer image for alpine:3.13\n ---> 6b5c5e00213a\nStep 2/16 : WORKDIR /static\n ---> Running in 80f220ce8b7a\nRemoving intermediate container 80f220ce8b7a\n ---> 2098c6f6b94c\nStep 3/16 : RUN apk add --no-cache npm &&     npm i -g -s --unsafe-perm yarn\n ---> Running in 678b0431308a\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.13/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.13/community/x86_64/APKINDEX.tar.gz\n(1/8) Installing ca-certificates (20220614-r0)\n(2/8) Installing nghttp2-libs (1.42.0-r1)\n(3/8) Installing brotli-libs (1.0.9-r3)\n(4/8) Installing c-ares (1.17.2-r0)\n(5/8) Installing libgcc (10.2.1_pre1-r3)\n(6/8) Installing libstdc++ (10.2.1_pre1-r3)\n(7/8) Installing nodejs (14.20.1-r0)\n(8/8) Installing npm (14.20.1-r0)\nExecuting busybox-1.32.1-r9.trigger\nExecuting ca-certificates-20220614-r0.trigger\nOK: 71 MiB in 22 packages\n/usr/bin/yarn -> /usr/lib/node_modules/yarn/bin/yarn.js\n/usr/bin/yarnpkg -> /usr/lib/node_modules/yarn/bin/yarn.js\n+ yarn@1.22.19\nadded 1 package in 0.738s\nRemoving intermediate container 678b0431308a\n ---> 415595fb435a\nStep 4/16 : COPY ui .\n ---> aec180d0ab90\nStep 5/16 : RUN yarn install && yarn build\n ---> Running in 804711f86836\nyarn install v1.22.19\n[1/4] Resolving packages...\n[2/4] Fetching packages...\n[3/4] Linking dependencies...\n\u001b[91mwarning \" > @testing-library/user-event@13.1.9\" has unmet peer dependency \"@testing-library/dom@>=7.21.4\".\n\u001b[0m\u001b[91mwarning \"recharts > react-smooth@2.0.0\" has unmet peer dependency \"prop-types@^15.6.0\".\n\u001b[0m\u001b[91mwarning \" > redux-devtools@3.7.0\" has unmet peer dependency \"redux@^3.5.2 || ^4.0.0\".\nwarning \"redux-devtools > redux-devtools-instrument@1.10.0\" has unmet peer dependency \"redux@^3.4.0 || ^4.0.0\".\n\u001b[0m[4/4] Building fresh packages...\nDone in 45.95s.\nyarn run v1.22.19\n$ react-scripts build\nCreating an optimized production build...\n\u001b[91mBrowserslist: caniuse-lite is outdated. Please run:\nnpx browserslist@latest --update-db\n\nWhy you should do it regularly:\nhttps://github.com/browserslist/browserslist#browsers-data-updating\n\u001b[0mCompiled successfully.\n\nFile sizes after gzip:\n\n  297.71 KB (+2 B)  build/static/js/2.d80c7598.chunk.js\n  36.3 KB           build/static/js/main.d69e73a0.chunk.js\n  779 B             build/static/js/runtime-main.9fea6c1a.js\n\nThe project was built assuming it is hosted at /[[.RootPath]]/.\nYou can control this with the homepage field in your package.json.\n\nThe build folder is ready to be deployed.\n\nFind out more about deployment here:\n\n  https://cra.link/deployment\n\nDone in 47.27s.\nRemoving intermediate container 804711f86836\n ---> 020bb7f66d35\nStep 6/16 : FROM golang:1.16-alpine AS backend\n1.16-alpine: Pulling from library/golang\n59bf1c3509f3: Already exists\n666ba61612fd: Pulling fs layer\n8ed8ca486205: Pulling fs layer\nca4bf87e467a: Pulling fs layer\n0435e0963794: Pulling fs layer\n0435e0963794: Waiting\n8ed8ca486205: Verifying Checksum\n8ed8ca486205: Download complete\n666ba61612fd: Download complete\n666ba61612fd: Pull complete\n8ed8ca486205: Pull complete\n0435e0963794: Verifying Checksum\n0435e0963794: Download complete\nca4bf87e467a: Verifying Checksum\nca4bf87e467a: Download complete\nca4bf87e467a: Pull complete\n0435e0963794: Pull complete\nDigest: sha256:5616dca835fa90ef13a843824ba58394dad356b7d56198fb7c93cbe76d7d67fe\nStatus: Downloaded newer image for golang:1.16-alpine\n ---> 7642119cd161\nStep 7/16 : WORKDIR /build\n ---> Running in d50282a914ba\nRemoving intermediate container d50282a914ba\n ---> 58eb03530975\nStep 8/16 : COPY go.mod go.sum ./\n ---> a2a282734a64\nStep 9/16 : RUN go mod download\n ---> Running in 191e4899046b\nRemoving intermediate container 191e4899046b\n ---> aac190a2d67c\nStep 10/16 : COPY . .\n ---> 4d4f5a378c45\nStep 11/16 : COPY --from=frontend [\"/static/build\", \"ui/build\"]\n ---> 82c50a2ae12b\nStep 12/16 : ENV CGO_ENABLED=0 GOOS=linux GOARCH=amd64\n ---> Running in aad270cf80c8\nRemoving intermediate container aad270cf80c8\n ---> 526aa8e8f8ae\nStep 13/16 : RUN go build -ldflags=\"-s -w\" -o asynqmon ./cmd/asynqmon\n ---> Running in 2381201aadfb\nRemoving intermediate container 2381201aadfb\n ---> 1c1426359298\nStep 14/16 : FROM scratch\n ---> \nStep 15/16 : COPY --from=backend [\"/build/asynqmon\", \"/\"]\n ---> f7b6474aee25\nStep 16/16 : ENTRYPOINT [\"/asynqmon\"]\n ---> Running in a7ce273ecbdc\nRemoving intermediate container a7ce273ecbdc\n ---> 79cf88228094\nSuccessfully built 79cf88228094\nSuccessfully tagged asynqmon:latest\n","stderr":"","imageSize":25505792},"repair":{"violations":[{"name":"npmCacheCleanAfterInstall","position":{"start":12,"end":12,"columnStart":4,"columnEnd":34}}],"repairedDockerfile":"#\n# First stage:\n# Building a frontend.\n#\n\nFROM alpine:3.13 AS frontend\n\n# Move to a working directory (/static).\nWORKDIR /static\n\n# Install npm (with latest nodejs) and yarn (globally, in silent mode).\nRUN apk add --no-cache npm && \\\n    npm i -g -s --unsafe-perm yarn\n\n# Copy only ./ui folder to the working directory.\nCOPY ui .\n\n# Run yarn scripts (install & build).\nRUN yarn install && yarn build\n\n#\n# Second stage:\n# Building a backend.\n#\n\nFROM golang:1.16-alpine AS backend\n\n# Move to a working directory (/build).\nWORKDIR /build\n\n# Copy and download dependencies.\nCOPY go.mod go.sum ./\nRUN go mod download\n\n# Copy a source code to the container.\nCOPY . .\n\n# Copy frontend static files from /static to the root folder of the backend container.\nCOPY --from=frontend [\"/static/build\", \"ui/build\"]\n\n# Set necessary environmet variables needed for the image and build the server.\nENV CGO_ENABLED=0 GOOS=linux GOARCH=amd64\n\n# Run go build (with ldflags to reduce binary size).\nRUN go build -ldflags=\"-s -w\" -o asynqmon ./cmd/asynqmon\n\n#\n# Third stage:\n# Creating and running a new scratch container with the backend binary.\n#\n\nFROM scratch\n\n# Copy binary from /build to the root folder of the scratch container.\nCOPY --from=backend [\"/build/asynqmon\", \"/\"]\n\n# Command to run when starting the container.\nENTRYPOINT [\"/asynqmon\"]\n"},"repairedBuild":{"startTimestamp":1672049878253,"endTimestamp":1672050075741,"error":null,"stdout":"Sending build context to Docker daemon  8.047MB\r\r\nStep 1/16 : FROM alpine:3.13 AS frontend\n ---> 6b5c5e00213a\nStep 2/16 : WORKDIR /static\n ---> Running in 5c7fffc2813d\nRemoving intermediate container 5c7fffc2813d\n ---> 5b41af2ace6d\nStep 3/16 : RUN apk add --no-cache npm &&     npm i -g -s --unsafe-perm yarn\n ---> Running in 6893c2e6ce6e\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.13/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.13/community/x86_64/APKINDEX.tar.gz\n(1/8) Installing ca-certificates (20220614-r0)\n(2/8) Installing nghttp2-libs (1.42.0-r1)\n(3/8) Installing brotli-libs (1.0.9-r3)\n(4/8) Installing c-ares (1.17.2-r0)\n(5/8) Installing libgcc (10.2.1_pre1-r3)\n(6/8) Installing libstdc++ (10.2.1_pre1-r3)\n(7/8) Installing nodejs (14.20.1-r0)\n(8/8) Installing npm (14.20.1-r0)\nExecuting busybox-1.32.1-r9.trigger\nExecuting ca-certificates-20220614-r0.trigger\nOK: 71 MiB in 22 packages\n/usr/bin/yarn -> /usr/lib/node_modules/yarn/bin/yarn.js\n/usr/bin/yarnpkg -> /usr/lib/node_modules/yarn/bin/yarn.js\n+ yarn@1.22.19\nadded 1 package in 1.415s\nRemoving intermediate container 6893c2e6ce6e\n ---> 122a24d03d6f\nStep 4/16 : COPY ui .\n ---> e8f5c8d13405\nStep 5/16 : RUN yarn install && yarn build\n ---> Running in 8d4545621423\nyarn install v1.22.19\n[1/4] Resolving packages...\n[2/4] Fetching packages...\n[3/4] Linking dependencies...\n\u001b[91mwarning \" > @testing-library/user-event@13.1.9\" has unmet peer dependency \"@testing-library/dom@>=7.21.4\".\n\u001b[0m\u001b[91mwarning \"recharts > react-smooth@2.0.0\" has unmet peer dependency \"prop-types@^15.6.0\".\n\u001b[0m\u001b[91mwarning \" > redux-devtools@3.7.0\" has unmet peer dependency \"redux@^3.5.2 || ^4.0.0\".\n\u001b[0m\u001b[91mwarning \"redux-devtools > redux-devtools-instrument@1.10.0\" has unmet peer dependency \"redux@^3.4.0 || ^4.0.0\".\n\u001b[0m[4/4] Building fresh packages...\nDone in 49.25s.\nyarn run v1.22.19\n$ react-scripts build\nCreating an optimized production build...\n\u001b[91mBrowserslist: caniuse-lite is outdated. Please run:\nnpx browserslist@latest --update-db\n\nWhy you should do it regularly:\nhttps://github.com/browserslist/browserslist#browsers-data-updating\n\u001b[0mCompiled successfully.\n\nFile sizes after gzip:\n\n  297.71 KB (+2 B)  build/static/js/2.d80c7598.chunk.js\n  36.3 KB           build/static/js/main.d69e73a0.chunk.js\n  779 B             build/static/js/runtime-main.9fea6c1a.js\n\nThe project was built assuming it is hosted at /[[.RootPath]]/.\nYou can control this with the homepage field in your package.json.\n\nThe build folder is ready to be deployed.\n\nFind out more about deployment here:\n\n  https://cra.link/deployment\n\nDone in 48.38s.\nRemoving intermediate container 8d4545621423\n ---> 38507ad27eda\nStep 6/16 : FROM golang:1.16-alpine AS backend\n ---> 7642119cd161\nStep 7/16 : WORKDIR /build\n ---> Running in 228ca86a64cf\nRemoving intermediate container 228ca86a64cf\n ---> c0bf9e4fa8c0\nStep 8/16 : COPY go.mod go.sum ./\n ---> 1ed22f70ddb2\nStep 9/16 : RUN go mod download\n ---> Running in 54273a99aebb\nRemoving intermediate container 54273a99aebb\n ---> 49d5050f9daf\nStep 10/16 : COPY . .\n ---> 357b57cf6873\nStep 11/16 : COPY --from=frontend [\"/static/build\", \"ui/build\"]\n ---> ace3fb491c0d\nStep 12/16 : ENV CGO_ENABLED=0 GOOS=linux GOARCH=amd64\n ---> Running in 1286459718a5\nRemoving intermediate container 1286459718a5\n ---> 00ba05003b73\nStep 13/16 : RUN go build -ldflags=\"-s -w\" -o asynqmon ./cmd/asynqmon\n ---> Running in ad85efa05582\nRemoving intermediate container ad85efa05582\n ---> 9d828893f0c7\nStep 14/16 : FROM scratch\n ---> \nStep 15/16 : COPY --from=backend [\"/build/asynqmon\", \"/\"]\n ---> b1599fd3520c\nStep 16/16 : ENTRYPOINT [\"/asynqmon\"]\n ---> Running in 32597d3eb8e1\nRemoving intermediate container 32597d3eb8e1\n ---> 406a660fb451\nSuccessfully built 406a660fb451\nSuccessfully tagged asynqmon:latest\n","stderr":"","imageSize":25505792},"endTime":1672050076228}