{"repository":"https://github.com/g-research/geras","dockerfilePath":"Dockerfile","startTime":1672408919745,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/g-research/geras'...\n","error":null,"commit":"bdac5b62ea01a9fc0ba7eb2be701d284bc59cc5e"},"originalBuild":{"startTimestamp":1672408920685,"endTimestamp":1672408973569,"error":null,"stdout":"Sending build context to Docker daemon  1.614MB\r\r\nStep 1/23 : FROM golang:1-alpine AS build-env\n1-alpine: Pulling from library/golang\nDigest: sha256:a9b24b67dc83b3383d22a14941c2b2b2ca6a103d805cac6820fd1355943beaf1\nStatus: Downloaded newer image for golang:1-alpine\n ---> cae57157ceaa\nStep 2/23 : ADD . /src\n ---> 6b5cead2f662\nStep 3/23 : WORKDIR /src\n ---> Running in 7ef426e49f5e\nRemoving intermediate container 7ef426e49f5e\n ---> 86cc7d5c9da6\nStep 4/23 : RUN apk add git\n ---> Running in 6e31104b3f55\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\n(1/6) Installing brotli-libs (1.0.9-r9)\n(2/6) Installing nghttp2-libs (1.51.0-r0)\n(3/6) Installing libcurl (7.87.0-r0)\n(4/6) Installing libexpat (2.5.0-r0)\n(5/6) Installing pcre2 (10.42-r0)\n(6/6) Installing git (2.38.2-r0)\nExecuting busybox-1.35.0-r29.trigger\nOK: 16 MiB in 22 packages\nRemoving intermediate container 6e31104b3f55\n ---> 5a4d5bd67c30\nStep 5/23 : ARG GRPC_HEALTH_PROBE_VERSION=v0.3.0\n ---> Running in 72929fa6c32a\nRemoving intermediate container 72929fa6c32a\n ---> d567cfe79c82\nStep 6/23 : RUN go install github.com/grpc-ecosystem/grpc-health-probe@${GRPC_HEALTH_PROBE_VERSION}\n ---> Running in af46eddaf3dd\n\u001b[91mgo: downloading github.com/grpc-ecosystem/grpc-health-probe v0.3.0\n\u001b[0m\u001b[91mgo: downloading google.golang.org/grpc v1.17.0\n\u001b[0m\u001b[91mgo: downloading github.com/golang/protobuf v1.2.0\n\u001b[0m\u001b[91mgo: downloading golang.org/x/net v0.0.0-20180826012351-8a410e7b638d\n\u001b[0m\u001b[91mgo: downloading google.golang.org/genproto v0.0.0-20180817151627-c66870c02cf8\ngo: downloading golang.org/x/sys v0.0.0-20180830151530-49385e6e1522\n\u001b[0m\u001b[91mgo: downloading golang.org/x/text v0.3.0\n\u001b[0mRemoving intermediate container af46eddaf3dd\n ---> 46bdcc20d7ed\nStep 7/23 : ARG GERAS_VERSION=\"development\"\n ---> Running in cbe9df9f9bd4\nRemoving intermediate container cbe9df9f9bd4\n ---> 8589da4d4d21\nStep 8/23 : ARG BUILD_USER=\"docker\"\n ---> Running in 34d201640d7b\nRemoving intermediate container 34d201640d7b\n ---> ef195d31ece5\nStep 9/23 : ARG GIT_REVISION=\"unknown\"\n ---> Running in 35235e91ffe1\nRemoving intermediate container 35235e91ffe1\n ---> 32eb7943cd06\nStep 10/23 : ARG GIT_BRANCH=\"unknown\"\n ---> Running in 30682fa1f5d6\nRemoving intermediate container 30682fa1f5d6\n ---> 3265221e0fe3\nStep 11/23 : RUN if [[ \"${GIT_REVISION}\" = \"unknown\" ]]; then   GIT_REVISION=\"$(git rev-parse HEAD)\";   GIT_BRANCH=\"$(git rev-parse --abbrev-ref HEAD)\"; fi; go install -ldflags '   -X github.com/prometheus/common/version.Version='\"${GERAS_VERSION}\"'   -X github.com/prometheus/common/version.Revision='\"${GIT_REVISION}\"'   -X github.com/prometheus/common/version.Branch='\"${GIT_BRANCH}\"'   -X github.com/prometheus/common/version.BuildUser='\"${BUILD_USER}\"'   -X github.com/prometheus/common/version.BuildDate='\"$(date +%Y%m%d-%H:%M:%S)\"   ./cmd/geras\n ---> Running in 746d92ad96f4\n\u001b[91mgo: downloading github.com/go-kit/kit v0.9.0\ngo: downloading github.com/grpc-ecosystem/go-grpc-middleware v1.0.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/otel/exporters/trace/jaeger v0.16.0\ngo: downloading github.com/G-Research/opentsdb-goclient v0.0.0-20221228100032-d7678fe103e6\n\u001b[0m\u001b[91mgo: downloading github.com/pkg/errors v0.8.1\ngo: downloading github.com/prometheus/client_golang v1.1.0\n\u001b[0m\u001b[91mgo: downloading github.com/prometheus/common v0.6.0\ngo: downloading github.com/grpc-ecosystem/go-grpc-prometheus v0.0.0-20181025070259-68e3a13e4117\n\u001b[0m\u001b[91mgo: downloading github.com/thanos-io/thanos v0.7.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/contrib/propagators v0.16.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/otel v0.16.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc v0.16.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.16.0\n\u001b[0m\u001b[91mgo: downloading google.golang.org/grpc v1.34.0\n\u001b[0m\u001b[91mgo: downloading github.com/prometheus/prometheus v1.8.2-0.20190913102521-8ab628b35467\n\u001b[0m\u001b[91mgo: downloading golang.org/x/net v0.0.0-20201031054903-ff519b6c9102\n\u001b[0m\u001b[91mgo: downloading github.com/go-logfmt/logfmt v0.4.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/contrib v0.16.0\n\u001b[0m\u001b[91mgo: downloading github.com/beorn7/perks v1.0.1\ngo: downloading github.com/prometheus/client_model v0.0.0-20190812154241-14fe0d1b01d4\ngo: downloading github.com/prometheus/procfs v0.0.3\n\u001b[0m\u001b[91mgo: downloading github.com/matttproud/golang_protobuf_extensions v1.0.1\n\u001b[0m\u001b[91mgo: downloading github.com/golang/protobuf v1.4.3\n\u001b[0m\u001b[91mgo: downloading github.com/felixge/httpsnoop v1.0.1\n\u001b[0m\u001b[91mgo: downloading google.golang.org/protobuf v1.25.0\n\u001b[0m\u001b[91mgo: downloading golang.org/x/sys v0.0.0-20201201145000-ef89a241ccb3\n\u001b[0m\u001b[91mgo: downloading google.golang.org/genproto v0.0.0-20201201144952-b05cb90ed32e\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/otel/sdk v0.16.0\n\u001b[0m\u001b[91mgo: downloading github.com/apache/thrift v0.13.0\n\u001b[0m\u001b[91mgo: downloading google.golang.org/api v0.36.0\n\u001b[0m\u001b[91mgo: downloading golang.org/x/text v0.3.4\n\u001b[0m\u001b[91mgo: downloading github.com/gogo/protobuf v1.2.2-0.20190730201129-28a6bbf47e48\ngo: downloading github.com/cespare/xxhash v1.1.0\n\u001b[0m\u001b[91mgo: downloading golang.org/x/sync v0.0.0-20201020160332-67f06af15bc9\n\u001b[0mRemoving intermediate container 746d92ad96f4\n ---> 22b53d0404a3\nStep 12/23 : FROM alpine\nlatest: Pulling from library/alpine\nc158987b0551: Already exists\nDigest: sha256:8914eb54f968791faf6a8638949e480fef81e697984fba772b3976835194c6d4\nStatus: Downloaded newer image for alpine:latest\n ---> 49176f190c7e\nStep 13/23 : LABEL org.opencontainers.image.description=\"Geras: Thanos Store API for OpenTSDB\"\n ---> Running in 91812d167c61\nRemoving intermediate container 91812d167c61\n ---> da2c00073438\nStep 14/23 : LABEL org.opencontainers.image.source=\"https://github.com/G-Research/geras\"\n ---> Running in bf7fe0db1bb9\nRemoving intermediate container bf7fe0db1bb9\n ---> abebd2553db0\nStep 15/23 : LABEL org.opencontainers.image.vendor=\"G-Research\"\n ---> Running in 6e25b6d867ce\nRemoving intermediate container 6e25b6d867ce\n ---> 26f8b100488b\nStep 16/23 : LABEL org.opencontainers.image.licenses=\"Apache-2.0\"\n ---> Running in 5fb35f2e2595\nRemoving intermediate container 5fb35f2e2595\n ---> 4b55cdf841ee\nStep 17/23 : LABEL org.opencontainers.image.version=${GERAS_VERSION}\n ---> Running in fc5f539b93d8\nRemoving intermediate container fc5f539b93d8\n ---> ae9599fa9b03\nStep 18/23 : LABEL org.opencontainers.image.revision=${GIT_REVISION}\n ---> Running in cdd264e607cf\nRemoving intermediate container cdd264e607cf\n ---> bbaeb2b1b3e8\nStep 19/23 : WORKDIR /bin\n ---> Running in 566267eace4c\nRemoving intermediate container 566267eace4c\n ---> 703c97d56ed0\nStep 20/23 : COPY --from=build-env /go/bin/geras .\n ---> e39d595a09cc\nStep 21/23 : COPY --from=build-env /go/bin/grpc-health-probe .\n ---> 4e271e756d54\nStep 22/23 : USER 1000\n ---> Running in 5fdc801308e4\nRemoving intermediate container 5fdc801308e4\n ---> 8876e325e85c\nStep 23/23 : ENTRYPOINT [\"./geras\"]\n ---> Running in 61e3c19eef5c\nRemoving intermediate container 61e3c19eef5c\n ---> 0abff655e9ee\nSuccessfully built 0abff655e9ee\nSuccessfully tagged geras:latest\n","stderr":"","imageSize":36764078},"repair":{"violations":[{"name":"apkAddUseNoCache","position":{"start":4,"end":4,"columnStart":4,"columnEnd":15}}],"repairedDockerfile":"# build stage\nFROM golang:1-alpine AS build-env\nADD . /src\nWORKDIR /src\nRUN apk add --no-cache git\nARG GRPC_HEALTH_PROBE_VERSION=v0.3.0\nRUN go install github.com/grpc-ecosystem/grpc-health-probe@${GRPC_HEALTH_PROBE_VERSION}\n\nARG GERAS_VERSION=\"development\"\nARG BUILD_USER=\"docker\"\nARG GIT_REVISION=\"unknown\"\nARG GIT_BRANCH=\"unknown\"\n\nRUN if [[ \"${GIT_REVISION}\" = \"unknown\" ]]; then \\\n  GIT_REVISION=\"$(git rev-parse HEAD)\"; \\\n  GIT_BRANCH=\"$( git rev-parse --abbrev-ref HEAD)\" ; \\\n fi; \\\ngo install -ldflags ' \\\n  -X github.com/prometheus/common/version.Version='\"${GERAS_VERSION}\"' \\\n  -X github.com/prometheus/common/version.Revision='\"${GIT_REVISION}\"' \\\n  -X github.com/prometheus/common/version.Branch='\"${GIT_BRANCH}\"' \\\n  -X github.com/prometheus/common/version.BuildUser='\"${BUILD_USER}\"' \\\n  -X github.com/prometheus/common/version.BuildDate='\"$(date +%Y%m%d-%H:%M:%S)\" \\\n  ./cmd/geras\n\n# final stage\nFROM alpine\nLABEL org.opencontainers.image.description=\"Geras: Thanos Store API for OpenTSDB\"\nLABEL org.opencontainers.image.source=\"https://github.com/G-Research/geras\"\nLABEL org.opencontainers.image.vendor=\"G-Research\"\nLABEL org.opencontainers.image.licenses=\"Apache-2.0\"\nLABEL org.opencontainers.image.version=${GERAS_VERSION}\nLABEL org.opencontainers.image.revision=${GIT_REVISION}\n\nWORKDIR /bin\nCOPY --from=build-env /go/bin/geras .\nCOPY --from=build-env /go/bin/grpc-health-probe .\nUSER 1000\nENTRYPOINT [\"./geras\"]\n"},"repairedBuild":{"startTimestamp":1672408973890,"endTimestamp":1672409013879,"error":null,"stdout":"Sending build context to Docker daemon  1.614MB\r\r\nStep 1/23 : FROM golang:1-alpine AS build-env\n ---> cae57157ceaa\nStep 2/23 : ADD . /src\n ---> 131a6334a46b\nStep 3/23 : WORKDIR /src\n ---> Running in 41379101dd54\nRemoving intermediate container 41379101dd54\n ---> 88189c676511\nStep 4/23 : RUN apk add --no-cache git\n ---> Running in 00c5c50509dc\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\n(1/6) Installing brotli-libs (1.0.9-r9)\n(2/6) Installing nghttp2-libs (1.51.0-r0)\n(3/6) Installing libcurl (7.87.0-r0)\n(4/6) Installing libexpat (2.5.0-r0)\n(5/6) Installing pcre2 (10.42-r0)\n(6/6) Installing git (2.38.2-r0)\nExecuting busybox-1.35.0-r29.trigger\nOK: 16 MiB in 22 packages\nRemoving intermediate container 00c5c50509dc\n ---> 7fe47797ff23\nStep 5/23 : ARG GRPC_HEALTH_PROBE_VERSION=v0.3.0\n ---> Running in 47dc0be796e3\nRemoving intermediate container 47dc0be796e3\n ---> 7b32d47be634\nStep 6/23 : RUN go install github.com/grpc-ecosystem/grpc-health-probe@${GRPC_HEALTH_PROBE_VERSION}\n ---> Running in e86dd890bbc0\n\u001b[91mgo: downloading github.com/grpc-ecosystem/grpc-health-probe v0.3.0\n\u001b[0m\u001b[91mgo: downloading google.golang.org/grpc v1.17.0\n\u001b[0m\u001b[91mgo: downloading golang.org/x/net v0.0.0-20180826012351-8a410e7b638d\ngo: downloading github.com/golang/protobuf v1.2.0\n\u001b[0m\u001b[91mgo: downloading google.golang.org/genproto v0.0.0-20180817151627-c66870c02cf8\n\u001b[0m\u001b[91mgo: downloading golang.org/x/sys v0.0.0-20180830151530-49385e6e1522\n\u001b[0m\u001b[91mgo: downloading golang.org/x/text v0.3.0\n\u001b[0mRemoving intermediate container e86dd890bbc0\n ---> 5a8939627cd7\nStep 7/23 : ARG GERAS_VERSION=\"development\"\n ---> Running in c9c29910c7dc\nRemoving intermediate container c9c29910c7dc\n ---> b5bef2df6f49\nStep 8/23 : ARG BUILD_USER=\"docker\"\n ---> Running in cedb6a03a211\nRemoving intermediate container cedb6a03a211\n ---> 7a9aad080428\nStep 9/23 : ARG GIT_REVISION=\"unknown\"\n ---> Running in ebfd6080ad4d\nRemoving intermediate container ebfd6080ad4d\n ---> ea5838d8ce9c\nStep 10/23 : ARG GIT_BRANCH=\"unknown\"\n ---> Running in 82eadeabf5d1\nRemoving intermediate container 82eadeabf5d1\n ---> 7fbca69f60de\nStep 11/23 : RUN if [[ \"${GIT_REVISION}\" = \"unknown\" ]]; then   GIT_REVISION=\"$(git rev-parse HEAD)\";   GIT_BRANCH=\"$( git rev-parse --abbrev-ref HEAD)\" ;  fi; go install -ldflags '   -X github.com/prometheus/common/version.Version='\"${GERAS_VERSION}\"'   -X github.com/prometheus/common/version.Revision='\"${GIT_REVISION}\"'   -X github.com/prometheus/common/version.Branch='\"${GIT_BRANCH}\"'   -X github.com/prometheus/common/version.BuildUser='\"${BUILD_USER}\"'   -X github.com/prometheus/common/version.BuildDate='\"$(date +%Y%m%d-%H:%M:%S)\"   ./cmd/geras\n ---> Running in bdd084438ec6\n\u001b[91mgo: downloading github.com/G-Research/opentsdb-goclient v0.0.0-20221228100032-d7678fe103e6\n\u001b[0m\u001b[91mgo: downloading github.com/grpc-ecosystem/go-grpc-middleware v1.0.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/otel/exporters/trace/jaeger v0.16.0\n\u001b[0m\u001b[91mgo: downloading github.com/go-kit/kit v0.9.0\n\u001b[0m\u001b[91mgo: downloading github.com/grpc-ecosystem/go-grpc-prometheus v0.0.0-20181025070259-68e3a13e4117\ngo: downloading github.com/pkg/errors v0.8.1\n\u001b[0m\u001b[91mgo: downloading github.com/prometheus/client_golang v1.1.0\ngo: downloading go.opentelemetry.io/contrib/instrumentation/net/http/otelhttp v0.16.0\n\u001b[0m\u001b[91mgo: downloading google.golang.org/grpc v1.34.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/otel v0.16.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/contrib/instrumentation/google.golang.org/grpc/otelgrpc v0.16.0\ngo: downloading golang.org/x/net v0.0.0-20201031054903-ff519b6c9102\ngo: downloading github.com/prometheus/prometheus v1.8.2-0.20190913102521-8ab628b35467\n\u001b[0m\u001b[91mgo: downloading github.com/thanos-io/thanos v0.7.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/contrib/propagators v0.16.0\ngo: downloading github.com/prometheus/common v0.6.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/contrib v0.16.0\n\u001b[0m\u001b[91mgo: downloading github.com/felixge/httpsnoop v1.0.1\ngo: downloading github.com/golang/protobuf v1.4.3\n\u001b[0m\u001b[91mgo: downloading github.com/beorn7/perks v1.0.1\ngo: downloading github.com/prometheus/procfs v0.0.3\n\u001b[0m\u001b[91mgo: downloading github.com/prometheus/client_model v0.0.0-20190812154241-14fe0d1b01d4\n\u001b[0m\u001b[91mgo: downloading github.com/matttproud/golang_protobuf_extensions v1.0.1\n\u001b[0m\u001b[91mgo: downloading google.golang.org/protobuf v1.25.0\n\u001b[0m\u001b[91mgo: downloading github.com/go-logfmt/logfmt v0.4.0\n\u001b[0m\u001b[91mgo: downloading google.golang.org/genproto v0.0.0-20201201144952-b05cb90ed32e\n\u001b[0m\u001b[91mgo: downloading golang.org/x/sys v0.0.0-20201201145000-ef89a241ccb3\n\u001b[0m\u001b[91mgo: downloading golang.org/x/text v0.3.4\n\u001b[0m\u001b[91mgo: downloading github.com/apache/thrift v0.13.0\n\u001b[0m\u001b[91mgo: downloading google.golang.org/api v0.36.0\n\u001b[0m\u001b[91mgo: downloading go.opentelemetry.io/otel/sdk v0.16.0\n\u001b[0m\u001b[91mgo: downloading github.com/gogo/protobuf v1.2.2-0.20190730201129-28a6bbf47e48\ngo: downloading github.com/cespare/xxhash v1.1.0\n\u001b[0m\u001b[91mgo: downloading golang.org/x/sync v0.0.0-20201020160332-67f06af15bc9\n\u001b[0mRemoving intermediate container bdd084438ec6\n ---> 6679cee92e37\nStep 12/23 : FROM alpine\n ---> 49176f190c7e\nStep 13/23 : LABEL org.opencontainers.image.description=\"Geras: Thanos Store API for OpenTSDB\"\n ---> Running in d37db44f1e2f\nRemoving intermediate container d37db44f1e2f\n ---> 294b5d50b996\nStep 14/23 : LABEL org.opencontainers.image.source=\"https://github.com/G-Research/geras\"\n ---> Running in e5b2a68de3c5\nRemoving intermediate container e5b2a68de3c5\n ---> f0c9c42598bd\nStep 15/23 : LABEL org.opencontainers.image.vendor=\"G-Research\"\n ---> Running in 1a5d2cf581e1\nRemoving intermediate container 1a5d2cf581e1\n ---> 640d6b692b57\nStep 16/23 : LABEL org.opencontainers.image.licenses=\"Apache-2.0\"\n ---> Running in 8e2b8a7404e0\nRemoving intermediate container 8e2b8a7404e0\n ---> ba5d08002324\nStep 17/23 : LABEL org.opencontainers.image.version=${GERAS_VERSION}\n ---> Running in f429df1880aa\nRemoving intermediate container f429df1880aa\n ---> 99f03230ab90\nStep 18/23 : LABEL org.opencontainers.image.revision=${GIT_REVISION}\n ---> Running in b98be616344a\nRemoving intermediate container b98be616344a\n ---> 44f0b1ff6454\nStep 19/23 : WORKDIR /bin\n ---> Running in 485dd1ef857e\nRemoving intermediate container 485dd1ef857e\n ---> 0036050634ce\nStep 20/23 : COPY --from=build-env /go/bin/geras .\n ---> e7b0235a930b\nStep 21/23 : COPY --from=build-env /go/bin/grpc-health-probe .\n ---> 0cb635d35bf2\nStep 22/23 : USER 1000\n ---> Running in 37ba3c36636f\nRemoving intermediate container 37ba3c36636f\n ---> ded81098f07d\nStep 23/23 : ENTRYPOINT [\"./geras\"]\n ---> Running in a224e8d33c00\nRemoving intermediate container a224e8d33c00\n ---> f35cce8c4104\nSuccessfully built f35cce8c4104\nSuccessfully tagged geras:latest\n","stderr":"","imageSize":36764078},"endTime":1672409014133}