{"repository":"https://github.com/mbta/concentrate","dockerfilePath":"Dockerfile","startTime":1672902853306,"endTime":1672902974613,"clone":{"startTime":1672902853311,"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/mbta/concentrate'...\n","error":null,"endTime":1672902854288,"commit":"d2b0e4bc7a84601285bafb3f12d1fa2557a2da32"},"originalBuild":{"startTime":1672902854377,"endTime":1672902921309,"error":null,"stdout":"Sending build context to Docker daemon  1.149MB\r\r\nStep 1/19 : FROM hexpm/elixir:1.10.4-erlang-23.3.4.14-alpine-3.16.0 AS builder\n1.10.4-erlang-23.3.4.14-alpine-3.16.0: Pulling from hexpm/elixir\n2408cc74d12b: Pulling fs layer\na7122c599fef: Pulling fs layer\n57dbece7ad88: Pulling fs layer\n6373c7c3014e: Pulling fs layer\n6373c7c3014e: Waiting\n2408cc74d12b: Verifying Checksum\n2408cc74d12b: Download complete\na7122c599fef: Verifying Checksum\na7122c599fef: Download complete\n2408cc74d12b: Pull complete\na7122c599fef: Pull complete\n6373c7c3014e: Verifying Checksum\n6373c7c3014e: Download complete\n57dbece7ad88: Download complete\n57dbece7ad88: Pull complete\n6373c7c3014e: Pull complete\nDigest: sha256:bc86d44d91efb6857870018f1af2aafa476d70a1a8c3ae1ce14521054baef948\nStatus: Downloaded newer image for hexpm/elixir:1.10.4-erlang-23.3.4.14-alpine-3.16.0\n ---> 2fb9cad41231\nStep 2/19 : WORKDIR /root\n ---> Running in 4bfcd260372c\nRemoving intermediate container 4bfcd260372c\n ---> acafbcd6e60f\nStep 3/19 : RUN mix local.hex --force &&   mix local.rebar --force\n ---> Running in 53fae2121c2e\n* creating .mix/archives/hex-2.0.0\n* creating .mix/rebar\n* creating .mix/rebar3\nRemoving intermediate container 53fae2121c2e\n ---> 956ee07bae6f\nStep 4/19 : RUN apk --update add git make\n ---> Running in 13e0dd109e77\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/community/x86_64/APKINDEX.tar.gz\n(1/8) Installing ca-certificates (20220614-r0)\n(2/8) Installing brotli-libs (1.0.9-r6)\n(3/8) Installing nghttp2-libs (1.47.0-r0)\n(4/8) Installing libcurl (7.83.1-r5)\n(5/8) Installing expat (2.5.0-r0)\n(6/8) Installing pcre2 (10.40-r0)\n(7/8) Installing git (2.36.3-r0)\n(8/8) Installing make (4.3-r0)\nExecuting busybox-1.35.0-r13.trigger\nExecuting ca-certificates-20220614-r0.trigger\nOK: 24 MiB in 32 packages\nRemoving intermediate container 13e0dd109e77\n ---> ad573e5f13ef\nStep 5/19 : ENV MIX_ENV=prod\n ---> Running in b5ebf25b6b4e\nRemoving intermediate container b5ebf25b6b4e\n ---> 3187053fcde0\nStep 6/19 : ADD mix.* /root/\n ---> 37216b854446\nStep 7/19 : ADD config /root/config\n ---> 6afe290468c4\nStep 8/19 : RUN mix do deps.get --only prod, deps.compile\n ---> Running in bac9c661d08a\n* Getting ehmon (https://github.com/mbta/ehmon.git)\nremote: Enumerating objects: 145, done.        \nremote: Total 145 (delta 0), reused 0 (delta 0), pack-reused 145        \nResolving Hex dependencies...\nResolution completed in 0.061s\nUnchanged:\n  certifi 2.9.0\n  csv 2.4.1\n  ex_aws 2.4.1\n  ex_aws_s3 2.3.0\n  gen_stage 1.1.0\n  hackney 1.18.1\n  httpoison 1.8.0\n  idna 6.1.1\n  jason 1.4.0\n  metrics 1.0.1\n  mime 1.5.0\n  mimerl 1.2.0\n  parallel_stream 1.0.6\n  parse_trans 3.3.1\n  ssl_verify_fun 1.1.6\n  telemetry 0.4.3\n  tzdata 1.1.1\n  unicode_util_compat 0.7.0\n* Getting csv (Hex package)\n* Getting ex_aws (Hex package)\n* Getting ex_aws_s3 (Hex package)\n* Getting gen_stage (Hex package)\n* Getting httpoison (Hex package)\n* Getting jason (Hex package)\n* Getting tzdata (Hex package)\n* Getting hackney (Hex package)\n* Getting certifi (Hex package)\n* Getting idna (Hex package)\n* Getting metrics (Hex package)\n* Getting mimerl (Hex package)\n* Getting parse_trans (Hex package)\n* Getting ssl_verify_fun (Hex package)\n* Getting unicode_util_compat (Hex package)\n* Getting mime (Hex package)\n* Getting telemetry (Hex package)\n* Getting parallel_stream (Hex package)\n===> Compiling parse_trans\n===> Compiling mimerl\n===> Compiling metrics\n===> Compiling unicode_util_compat\n===> Rebar3 detected a lock file from a newer version. It will be loaded in compatibility mode, but important information may be missing or lost. It is recommended to upgrade Rebar3.\n===> Compiling idna\n==> gen_stage\nCompiling 10 files (.ex)\nGenerated gen_stage app\n===> Compiling telemetry\n\u001b[91mwarning: found quoted keyword \"coveralls\" but the quotes are not required. Note that keywords are always atoms, even when quoted. Similar to atoms, keywords made exclusively of Unicode letters, numbers, underscore, and @ do not require quotes\n  /root/deps/parallel_stream/mix.exs:17\n\n\u001b[0m==> parallel_stream\nCompiling 11 files (.ex)\n\u001b[91mwarning: Stream.chunk/4 is deprecated. Use Stream.chunk_every/4 instead\n  lib/parallel_stream/producer.ex:16: ParallelStream.Producer.build!/4\n\n\u001b[0mGenerated parallel_stream app\n===> Compiling ehmon\nsrc/ehmon_report_srv.erl:91: Warning: erlang:get_stacktrace/0 is deprecated and will be removed in OTP 24; use use the new try/catch syntax for retrieving the stack backtrace\n\n==> jason\nCompiling 10 files (.ex)\nGenerated jason app\n==> ssl_verify_fun\nCompiling 7 files (.erl)\nGenerated ssl_verify_fun app\n==> csv\nCompiling 10 files (.ex)\nGenerated csv app\n===> Compiling certifi\n===> Rebar3 detected a lock file from a newer version. It will be loaded in compatibility mode, but important information may be missing or lost. It is recommended to upgrade Rebar3.\n===> Compiling hackney\n==> tzdata\nCompiling 17 files (.ex)\nGenerated tzdata app\n==> httpoison\nCompiling 3 files (.ex)\nGenerated httpoison app\n==> mime\nCompiling 2 files (.ex)\nGenerated mime app\n==> ex_aws\nCompiling 27 files (.ex)\nGenerated ex_aws app\n==> ex_aws_s3\nCompiling 7 files (.ex)\n\u001b[91mwarning: ExAws.S3.Parsers.parse_bucket_object_versions/1 is undefined or private\n  lib/ex_aws/s3.ex:249: ExAws.S3.get_bucket_object_versions/2\n\n\u001b[0mGenerated ex_aws_s3 app\nRemoving intermediate container bac9c661d08a\n ---> 8a93a960d0d7\nStep 9/19 : ADD lib /root/lib\n ---> 6d907c414b14\nStep 10/19 : ADD src /root/src\n ---> b6dbc274e48f\nStep 11/19 : RUN mix do compile, release\n ---> Running in 3c1532de8e51\nCompiling 1 file (.erl)\nCompiling 69 files (.ex)\nGenerated concentrate app\n* assembling concentrate-0.1.0 on MIX_ENV=prod\n* skipping runtime configuration (config/releases.exs not found)\n* skipping elixir.bat for windows (bin/elixir.bat not found in the Elixir installation)\n* skipping iex.bat for windows (bin/iex.bat not found in the Elixir installation)\n\nRelease created at _build/prod/rel/concentrate!\n\n    # To start your system\n    _build/prod/rel/concentrate/bin/concentrate start\n\nOnce the release is running:\n\n    # To connect to it remotely\n    _build/prod/rel/concentrate/bin/concentrate remote\n\n    # To stop it gracefully (you may also send SIGINT/SIGTERM)\n    _build/prod/rel/concentrate/bin/concentrate stop\n\nTo list all commands:\n\n    _build/prod/rel/concentrate/bin/concentrate\n\nRemoving intermediate container 3c1532de8e51\n ---> 8c78db8dc950\nStep 12/19 : FROM alpine:3.16.0\n3.16.0: Pulling from library/alpine\n2408cc74d12b: Already exists\nDigest: sha256:686d8c9dfa6f3ccfc8230bc3178d23f84eeaf7e457f36f271ab1acc53015037c\nStatus: Downloaded newer image for alpine:3.16.0\n ---> e66264b98777\nStep 13/19 : RUN apk add --update libssl1.1 ncurses-libs bash dumb-init     && rm -rf /var/cache/apk\n ---> Running in 130f20044d91\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/community/x86_64/APKINDEX.tar.gz\n(1/5) Installing ncurses-terminfo-base (6.3_p20220521-r0)\n(2/5) Installing ncurses-libs (6.3_p20220521-r0)\n(3/5) Installing readline (8.1.2-r0)\n(4/5) Installing bash (5.1.16-r2)\nExecuting bash-5.1.16-r2.post-install\n(5/5) Installing dumb-init (1.2.5-r1)\nExecuting busybox-1.35.0-r13.trigger\nOK: 8 MiB in 19 packages\nRemoving intermediate container 130f20044d91\n ---> 1c872b3a9e38\nStep 14/19 : ENV MIX_ENV=prod TERM=xterm LANG=C.UTF-8 REPLACE_OS_VARS=true\n ---> Running in 30555a755f28\nRemoving intermediate container 30555a755f28\n ---> a91e92f72f0f\nStep 15/19 : WORKDIR /root/\n ---> Running in 27063905e18d\nRemoving intermediate container 27063905e18d\n ---> 8c1f343c493a\nStep 16/19 : COPY --from=builder /root/_build/prod/rel /root/rel\n ---> a5d627555e02\nStep 17/19 : RUN /root/rel/concentrate/bin/concentrate eval \":crypto.supports()\"\n ---> Running in 59edfacbcc2e\n2023-01-05T07:15:19.465 [info]  Application logger started at :nonode@nohost\nRemoving intermediate container 59edfacbcc2e\n ---> 66965224e5ee\nStep 18/19 : HEALTHCHECK CMD [\"/root/rel/concentrate/bin/concentrate\", \"rpc\", \"Concentrate.Health.healthy?()\"]\n ---> Running in a1e16e69fe95\nRemoving intermediate container a1e16e69fe95\n ---> e2eed2abbc61\nStep 19/19 : CMD [\"/usr/bin/dumb-init\", \"/root/rel/concentrate/bin/concentrate\", \"start\"]\n ---> Running in 598f9a87880f\nRemoving intermediate container 598f9a87880f\n ---> f57bb4aa0426\nSuccessfully built f57bb4aa0426\nSuccessfully tagged concentrate:latest\n","stderr":"","imageSize":23907720},"repair":{"startTime":1672902921374,"endTime":1672902921432,"violations":[{"name":"apkAddUseNoCache","position":{"start":9,"end":9,"columnStart":4,"columnEnd":29}}],"repairedDockerfile":"FROM hexpm/elixir:1.10.4-erlang-23.3.4.14-alpine-3.16.0 AS builder\n\nWORKDIR /root\n\n# Install Hex+Rebar\nRUN mix local.hex --force && \\\n  mix local.rebar --force\n\n# Install git\nRUN apk --update --no-cache add git make\n\nENV MIX_ENV=prod\n\nADD mix.* /root/\nADD config /root/config\n\nRUN mix do deps.get --only prod, deps.compile\n\nADD lib /root/lib\nADD src /root/src\n\nRUN mix do compile, release\n\n# Second stage: copies the files from the builder stage\nFROM alpine:3.16.0\n\nRUN apk add --update libssl1.1 ncurses-libs bash dumb-init \\\n    && rm -rf /var/cache/apk\n\n# Set environment\nENV MIX_ENV=prod TERM=xterm LANG=C.UTF-8 REPLACE_OS_VARS=true\n\nWORKDIR /root/\n\nCOPY --from=builder /root/_build/prod/rel /root/rel\n\n# Ensure SSL support is enabled\nRUN /root/rel/concentrate/bin/concentrate eval \":crypto.supports()\"\n\nHEALTHCHECK CMD [\"/root/rel/concentrate/bin/concentrate\", \"rpc\", \"Concentrate.Health.healthy?()\"]\nCMD [\"/usr/bin/dumb-init\", \"/root/rel/concentrate/bin/concentrate\", \"start\"]\n"},"repairedBuild":{"startTime":1672902921601,"endTime":1672902974353,"error":null,"stdout":"Sending build context to Docker daemon  1.149MB\r\r\nStep 1/19 : FROM hexpm/elixir:1.10.4-erlang-23.3.4.14-alpine-3.16.0 AS builder\n ---> 2fb9cad41231\nStep 2/19 : WORKDIR /root\n ---> Running in 2334cabe7e2d\nRemoving intermediate container 2334cabe7e2d\n ---> 4967ccc95b7b\nStep 3/19 : RUN mix local.hex --force &&   mix local.rebar --force\n ---> Running in 94ffa392fda9\n* creating .mix/archives/hex-2.0.0\n* creating .mix/rebar\n* creating .mix/rebar3\nRemoving intermediate container 94ffa392fda9\n ---> cecf2ae3c79b\nStep 4/19 : RUN apk --update --no-cache add git make\n ---> Running in 62edb7bdd475\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/community/x86_64/APKINDEX.tar.gz\n(1/8) Installing ca-certificates (20220614-r0)\n(2/8) Installing brotli-libs (1.0.9-r6)\n(3/8) Installing nghttp2-libs (1.47.0-r0)\n(4/8) Installing libcurl (7.83.1-r5)\n(5/8) Installing expat (2.5.0-r0)\n(6/8) Installing pcre2 (10.40-r0)\n(7/8) Installing git (2.36.3-r0)\n(8/8) Installing make (4.3-r0)\nExecuting busybox-1.35.0-r13.trigger\nExecuting ca-certificates-20220614-r0.trigger\nOK: 24 MiB in 32 packages\nRemoving intermediate container 62edb7bdd475\n ---> 674af987c508\nStep 5/19 : ENV MIX_ENV=prod\n ---> Running in e47c27a3e2ca\nRemoving intermediate container e47c27a3e2ca\n ---> 99520f5ff29f\nStep 6/19 : ADD mix.* /root/\n ---> e19062f0abb6\nStep 7/19 : ADD config /root/config\n ---> f132fddc19fe\nStep 8/19 : RUN mix do deps.get --only prod, deps.compile\n ---> Running in 75ea12d10691\n* Getting ehmon (https://github.com/mbta/ehmon.git)\nremote: Enumerating objects: 145, done.        \nremote: Total 145 (delta 0), reused 0 (delta 0), pack-reused 145        \nResolving Hex dependencies...\nResolution completed in 0.078s\nUnchanged:\n  certifi 2.9.0\n  csv 2.4.1\n  ex_aws 2.4.1\n  ex_aws_s3 2.3.0\n  gen_stage 1.1.0\n  hackney 1.18.1\n  httpoison 1.8.0\n  idna 6.1.1\n  jason 1.4.0\n  metrics 1.0.1\n  mime 1.5.0\n  mimerl 1.2.0\n  parallel_stream 1.0.6\n  parse_trans 3.3.1\n  ssl_verify_fun 1.1.6\n  telemetry 0.4.3\n  tzdata 1.1.1\n  unicode_util_compat 0.7.0\n* Getting csv (Hex package)\n* Getting ex_aws (Hex package)\n* Getting ex_aws_s3 (Hex package)\n* Getting gen_stage (Hex package)\n* Getting httpoison (Hex package)\n* Getting jason (Hex package)\n* Getting tzdata (Hex package)\n* Getting hackney (Hex package)\n* Getting certifi (Hex package)\n* Getting idna (Hex package)\n* Getting metrics (Hex package)\n* Getting mimerl (Hex package)\n* Getting parse_trans (Hex package)\n* Getting ssl_verify_fun (Hex package)\n* Getting unicode_util_compat (Hex package)\n* Getting mime (Hex package)\n* Getting telemetry (Hex package)\n* Getting parallel_stream (Hex package)\n===> Compiling parse_trans\n===> Compiling mimerl\n===> Compiling metrics\n===> Compiling unicode_util_compat\n===> Rebar3 detected a lock file from a newer version. It will be loaded in compatibility mode, but important information may be missing or lost. It is recommended to upgrade Rebar3.\n===> Compiling idna\n==> gen_stage\nCompiling 10 files (.ex)\nGenerated gen_stage app\n===> Compiling telemetry\n\u001b[91mwarning: found quoted keyword \"coveralls\" but the quotes are not required. Note that keywords are always atoms, even when quoted. Similar to atoms, keywords made exclusively of Unicode letters, numbers, underscore, and @ do not require quotes\n  /root/deps/parallel_stream/mix.exs:17\n\n\u001b[0m==> parallel_stream\nCompiling 11 files (.ex)\n\u001b[91mwarning: Stream.chunk/4 is deprecated. Use Stream.chunk_every/4 instead\n  lib/parallel_stream/producer.ex:16: ParallelStream.Producer.build!/4\n\n\u001b[0mGenerated parallel_stream app\n===> Compiling ehmon\nsrc/ehmon_report_srv.erl:91: Warning: erlang:get_stacktrace/0 is deprecated and will be removed in OTP 24; use use the new try/catch syntax for retrieving the stack backtrace\n\n==> jason\nCompiling 10 files (.ex)\nGenerated jason app\n==> ssl_verify_fun\nCompiling 7 files (.erl)\nGenerated ssl_verify_fun app\n==> csv\nCompiling 10 files (.ex)\nGenerated csv app\n===> Compiling certifi\n===> Rebar3 detected a lock file from a newer version. It will be loaded in compatibility mode, but important information may be missing or lost. It is recommended to upgrade Rebar3.\n===> Compiling hackney\n==> tzdata\nCompiling 17 files (.ex)\nGenerated tzdata app\n==> httpoison\nCompiling 3 files (.ex)\nGenerated httpoison app\n==> mime\nCompiling 2 files (.ex)\nGenerated mime app\n==> ex_aws\nCompiling 27 files (.ex)\nGenerated ex_aws app\n==> ex_aws_s3\nCompiling 7 files (.ex)\n\u001b[91mwarning: ExAws.S3.Parsers.parse_bucket_object_versions/1 is undefined or private\n  lib/ex_aws/s3.ex:249: ExAws.S3.get_bucket_object_versions/2\n\n\u001b[0mGenerated ex_aws_s3 app\nRemoving intermediate container 75ea12d10691\n ---> a53ac991fff5\nStep 9/19 : ADD lib /root/lib\n ---> 9f2a828cd71f\nStep 10/19 : ADD src /root/src\n ---> 81141cbc4abd\nStep 11/19 : RUN mix do compile, release\n ---> Running in 742d0fd14269\nCompiling 1 file (.erl)\nCompiling 69 files (.ex)\nGenerated concentrate app\n* assembling concentrate-0.1.0 on MIX_ENV=prod\n* skipping runtime configuration (config/releases.exs not found)\n* skipping elixir.bat for windows (bin/elixir.bat not found in the Elixir installation)\n* skipping iex.bat for windows (bin/iex.bat not found in the Elixir installation)\n\nRelease created at _build/prod/rel/concentrate!\n\n    # To start your system\n    _build/prod/rel/concentrate/bin/concentrate start\n\nOnce the release is running:\n\n    # To connect to it remotely\n    _build/prod/rel/concentrate/bin/concentrate remote\n\n    # To stop it gracefully (you may also send SIGINT/SIGTERM)\n    _build/prod/rel/concentrate/bin/concentrate stop\n\nTo list all commands:\n\n    _build/prod/rel/concentrate/bin/concentrate\n\nRemoving intermediate container 742d0fd14269\n ---> cc44c72e166e\nStep 12/19 : FROM alpine:3.16.0\n ---> e66264b98777\nStep 13/19 : RUN apk add --update libssl1.1 ncurses-libs bash dumb-init     && rm -rf /var/cache/apk\n ---> Running in da3801201e3e\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.16/community/x86_64/APKINDEX.tar.gz\n(1/5) Installing ncurses-terminfo-base (6.3_p20220521-r0)\n(2/5) Installing ncurses-libs (6.3_p20220521-r0)\n(3/5) Installing readline (8.1.2-r0)\n(4/5) Installing bash (5.1.16-r2)\nExecuting bash-5.1.16-r2.post-install\n(5/5) Installing dumb-init (1.2.5-r1)\nExecuting busybox-1.35.0-r13.trigger\nOK: 8 MiB in 19 packages\nRemoving intermediate container da3801201e3e\n ---> 95212c924c5e\nStep 14/19 : ENV MIX_ENV=prod TERM=xterm LANG=C.UTF-8 REPLACE_OS_VARS=true\n ---> Running in 5b05ebb4264a\nRemoving intermediate container 5b05ebb4264a\n ---> 8845154610a2\nStep 15/19 : WORKDIR /root/\n ---> Running in a7eb20dd52ae\nRemoving intermediate container a7eb20dd52ae\n ---> 4b47b2752d3c\nStep 16/19 : COPY --from=builder /root/_build/prod/rel /root/rel\n ---> 9cad114645d2\nStep 17/19 : RUN /root/rel/concentrate/bin/concentrate eval \":crypto.supports()\"\n ---> Running in 713e3c3c5b45\n2023-01-05T07:16:13.265 [info]  Application logger started at :nonode@nohost\nRemoving intermediate container 713e3c3c5b45\n ---> 80c7e195b54f\nStep 18/19 : HEALTHCHECK CMD [\"/root/rel/concentrate/bin/concentrate\", \"rpc\", \"Concentrate.Health.healthy?()\"]\n ---> Running in 6b1553fe30cd\nRemoving intermediate container 6b1553fe30cd\n ---> 059ded3e0cf9\nStep 19/19 : CMD [\"/usr/bin/dumb-init\", \"/root/rel/concentrate/bin/concentrate\", \"start\"]\n ---> Running in 00e53939aa27\nRemoving intermediate container 00e53939aa27\n ---> 4fc0ea6cc4be\nSuccessfully built 4fc0ea6cc4be\nSuccessfully tagged concentrate:latest\n","stderr":"","imageSize":23907702}}