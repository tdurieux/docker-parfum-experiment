{"repository":"https://github.com/square/sharkey","dockerfilePath":"Dockerfile","startTime":1672312027429,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/square/sharkey'...\n","error":null,"commit":"735cbeb2bbfcdb35ea9ed92cd20c577506e1f2f8"},"originalBuild":{"startTimestamp":1672312028388,"endTimestamp":1672312176805,"error":null,"stdout":"Sending build context to Docker daemon  520.7kB\r\r\nStep 1/12 : FROM golang:1.18-alpine as build\n1.18-alpine: Pulling from library/golang\nc158987b0551: Already exists\n019cfb932eb0: Already exists\n4e0e94741593: Pulling fs layer\n1ba1ea060658: Pulling fs layer\n1ba1ea060658: Download complete\n4e0e94741593: Verifying Checksum\n4e0e94741593: Download complete\n4e0e94741593: Pull complete\n1ba1ea060658: Pull complete\nDigest: sha256:c2bb8281641f39a32e01854ae6b5fea45870f6f4c0c04365eadc0be596675456\nStatus: Downloaded newer image for golang:1.18-alpine\n ---> f37f1bcb329f\nStep 2/12 : RUN apk add --update gcc musl-dev &&     rm -rf /var/cache/apk/*\n ---> Running in 2de976a6f9de\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\n(1/11) Installing libgcc (12.2.1_git20220924-r4)\n(2/11) Installing libstdc++ (12.2.1_git20220924-r4)\n(3/11) Installing binutils (2.39-r2)\n(4/11) Installing libgomp (12.2.1_git20220924-r4)\n(5/11) Installing libatomic (12.2.1_git20220924-r4)\n(6/11) Installing gmp (6.2.1-r2)\n(7/11) Installing isl25 (0.25-r0)\n(8/11) Installing mpfr4 (4.1.0-r0)\n(9/11) Installing mpc1 (1.2.1-r1)\n(10/11) Installing gcc (12.2.1_git20220924-r4)\n(11/11) Installing musl-dev (1.2.3-r4)\nExecuting busybox-1.35.0-r29.trigger\nOK: 152 MiB in 27 packages\nRemoving intermediate container 2de976a6f9de\n ---> 5f43135408a0\nStep 3/12 : WORKDIR /app\n ---> Running in 21caded6aa15\nRemoving intermediate container 21caded6aa15\n ---> 4765268b8d98\nStep 4/12 : COPY go.mod .\n ---> 7e2fe0780c5b\nStep 5/12 : COPY go.sum .\n ---> d123fff87200\nStep 6/12 : RUN go mod download\n ---> Running in b18e7623baf6\nRemoving intermediate container b18e7623baf6\n ---> 6e879112da81\nStep 7/12 : COPY . .\n ---> 50c22051c53a\nStep 8/12 : RUN cp docker.sh /usr/bin/entrypoint.sh &&     chmod +x /usr/bin/entrypoint.sh &&     go build -buildvcs=false -o /usr/bin/sharkey-server github.com/square/sharkey/cmd/sharkey-server\n ---> Running in b398bd994ab5\n\u001b[91m# github.com/mattn/go-sqlite3\nsqlite3-binding.c: In function 'sqlite3SelectNew':\nsqlite3-binding.c:128049:10: warning: function may return address of local variable [-Wreturn-local-addr]\n128049 |   return pNew;\n       |          ^~~~\nsqlite3-binding.c:128009:10: note: declared here\n128009 |   Select standin;\n       |          ^~~~~~~\n\u001b[0mRemoving intermediate container b398bd994ab5\n ---> 78357085f359\nStep 9/12 : FROM golang:1.18-alpine\n ---> f37f1bcb329f\nStep 10/12 : COPY --from=build /usr/bin/sharkey-server /usr/bin/sharkey-server\n ---> 64e4305da4d3\nStep 11/12 : COPY --from=build /usr/bin/entrypoint.sh /usr/bin/entrypoint.sh\n ---> 534c27596679\nStep 12/12 : ENTRYPOINT [\"/usr/bin/entrypoint.sh\"]\n ---> Running in eb276e6d2194\nRemoving intermediate container eb276e6d2194\n ---> 7e250fe0b76e\nSuccessfully built 7e250fe0b76e\nSuccessfully tagged sharkey:latest\n","stderr":"","imageSize":346682414},"repair":{"violations":[{"name":"apkAddUseNoCache","position":{"start":14,"end":14,"columnStart":4,"columnEnd":33}}],"repairedDockerfile":"# Dockerfile for square/sharkey (server).\n#\n# Building:\n#   docker build --rm -t square/sharkey-server .\n#\n# Basic usage:\n#   docker run -e SHARKEY_CONFIG=/path/to/config -e SHARKEY_MIGRATIONS=/path/to/migration/dir square/sharkey-server\n#\n# This image only contains the server component of sharkey,\n# the client will have to be deployed separately\n\nFROM golang:1.18-alpine as build\n\n# Install CGO deps\nRUN apk add --no-cache --update gcc musl-dev && \\\n    rm -rf /var/cache/apk/*\n\nWORKDIR /app\n\nCOPY go.mod .\nCOPY go.sum .\n\n# Download dependencies\nRUN go mod download\n\n# Copy source\nCOPY . .\n\n# Build & set-up\nRUN cp docker.sh /usr/bin/entrypoint.sh && \\\n    chmod +x /usr/bin/entrypoint.sh && \\\n    go build -buildvcs=false -o /usr/bin/sharkey-server github.com/square/sharkey/cmd/sharkey-server\n\n\n# Create a multi-stage build with the binary\nFROM golang:1.18-alpine\n\nCOPY --from=build /usr/bin/sharkey-server /usr/bin/sharkey-server\nCOPY --from=build /usr/bin/entrypoint.sh /usr/bin/entrypoint.sh\n\nENTRYPOINT [\"/usr/bin/entrypoint.sh\"]\n"},"repairedBuild":{"startTimestamp":1672312177177,"endTimestamp":1672312246542,"error":null,"stdout":"Sending build context to Docker daemon  520.7kB\r\r\nStep 1/12 : FROM golang:1.18-alpine as build\n ---> f37f1bcb329f\nStep 2/12 : RUN apk add --no-cache --update gcc musl-dev &&     rm -rf /var/cache/apk/*\n ---> Running in 455b3562c983\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\n(1/11) Installing libgcc (12.2.1_git20220924-r4)\n(2/11) Installing libstdc++ (12.2.1_git20220924-r4)\n(3/11) Installing binutils (2.39-r2)\n(4/11) Installing libgomp (12.2.1_git20220924-r4)\n(5/11) Installing libatomic (12.2.1_git20220924-r4)\n(6/11) Installing gmp (6.2.1-r2)\n(7/11) Installing isl25 (0.25-r0)\n(8/11) Installing mpfr4 (4.1.0-r0)\n(9/11) Installing mpc1 (1.2.1-r1)\n(10/11) Installing gcc (12.2.1_git20220924-r4)\n(11/11) Installing musl-dev (1.2.3-r4)\nExecuting busybox-1.35.0-r29.trigger\nOK: 152 MiB in 27 packages\nRemoving intermediate container 455b3562c983\n ---> 117cc42073ee\nStep 3/12 : WORKDIR /app\n ---> Running in 69a69b44bd5e\nRemoving intermediate container 69a69b44bd5e\n ---> 08d061a8afd3\nStep 4/12 : COPY go.mod .\n ---> 19a8f426e065\nStep 5/12 : COPY go.sum .\n ---> 033fd4bd129b\nStep 6/12 : RUN go mod download\n ---> Running in 004c928e6421\nRemoving intermediate container 004c928e6421\n ---> 14922fb83df9\nStep 7/12 : COPY . .\n ---> 9ae7bdfcd2b5\nStep 8/12 : RUN cp docker.sh /usr/bin/entrypoint.sh &&     chmod +x /usr/bin/entrypoint.sh &&     go build -buildvcs=false -o /usr/bin/sharkey-server github.com/square/sharkey/cmd/sharkey-server\n ---> Running in 3c8106d015c7\n\u001b[91m# github.com/mattn/go-sqlite3\nsqlite3-binding.c: In function 'sqlite3SelectNew':\nsqlite3-binding.c:128049:10: warning: function may return address of local variable [-Wreturn-local-addr]\n128049 |   return pNew;\n       |          ^~~~\nsqlite3-binding.c:128009:10: note: declared here\n128009 |   Select standin;\n       |          ^~~~~~~\n\u001b[0mRemoving intermediate container 3c8106d015c7\n ---> 7405e0709e13\nStep 9/12 : FROM golang:1.18-alpine\n ---> f37f1bcb329f\nStep 10/12 : COPY --from=build /usr/bin/sharkey-server /usr/bin/sharkey-server\n ---> 3985aa2e349c\nStep 11/12 : COPY --from=build /usr/bin/entrypoint.sh /usr/bin/entrypoint.sh\n ---> f8f04d63619a\nStep 12/12 : ENTRYPOINT [\"/usr/bin/entrypoint.sh\"]\n ---> Running in 6dcfe6f3576a\nRemoving intermediate container 6dcfe6f3576a\n ---> a4792b49b898\nSuccessfully built a4792b49b898\nSuccessfully tagged sharkey:latest\n","stderr":"","imageSize":346682414},"endTime":1672312246758}