{"repository":"https://github.com/rphlmr/supa-fly-stack","dockerfilePath":"Dockerfile","startTime":1672561374053,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/rphlmr/supa-fly-stack'...\n","error":null,"commit":"bd100e0754adae1922fab4ea6a3f412ea7bf1268"},"originalBuild":{"startTimestamp":1672561374868,"endTimestamp":1672562101312,"error":null,"stdout":"Sending build context to Docker daemon  359.4kB\r\r\nStep 1/30 : FROM node:16-bullseye-slim as base\n16-bullseye-slim: Pulling from library/node\n3f4ca61aafcd: Already exists\n00fde01815c9: Pulling fs layer\n031949ce49ec: Pulling fs layer\n16cee6032317: Pulling fs layer\nfd35893cdbff: Pulling fs layer\nfd35893cdbff: Waiting\n00fde01815c9: Verifying Checksum\n00fde01815c9: Download complete\n16cee6032317: Verifying Checksum\n16cee6032317: Download complete\n00fde01815c9: Pull complete\nfd35893cdbff: Download complete\n031949ce49ec: Verifying Checksum\n031949ce49ec: Download complete\n031949ce49ec: Pull complete\n16cee6032317: Pull complete\nfd35893cdbff: Pull complete\nDigest: sha256:30ec224b4c35a768e038674444d0718494a7d8847c96ee73a8d3db795135b4c9\nStatus: Downloaded newer image for node:16-bullseye-slim\n ---> b3b9a79a4762\nStep 2/30 : ENV NODE_ENV production\n ---> Running in 3e4087b9a913\nRemoving intermediate container 3e4087b9a913\n ---> e4757104c134\nStep 3/30 : RUN apt-get update && apt-get install -y openssl\n ---> Running in 596caa1bda05\nGet:1 http://deb.debian.org/debian bullseye InRelease [116 kB]\nGet:2 http://deb.debian.org/debian-security bullseye-security InRelease [48.4 kB]\nGet:3 http://deb.debian.org/debian bullseye-updates InRelease [44.1 kB]\nGet:4 http://deb.debian.org/debian bullseye/main amd64 Packages [8183 kB]\nGet:5 http://deb.debian.org/debian-security bullseye-security/main amd64 Packages [210 kB]\nGet:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [14.6 kB]\nFetched 8616 kB in 2s (3915 kB/s)\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nSuggested packages:\n  ca-certificates\nThe following NEW packages will be installed:\n  openssl\n0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 853 kB of archives.\nAfter this operation, 1501 kB of additional disk space will be used.\nGet:1 http://deb.debian.org/debian bullseye/main amd64 openssl amd64 1.1.1n-0+deb11u3 [853 kB]\n\u001b[91mdebconf: delaying package configuration, since apt-utils is not installed\n\u001b[0mFetched 853 kB in 0s (33.5 MB/s)\nSelecting previously unselected package openssl.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 6661 files and directories currently installed.)\r\nPreparing to unpack .../openssl_1.1.1n-0+deb11u3_amd64.deb ...\r\nUnpacking openssl (1.1.1n-0+deb11u3) ...\r\nSetting up openssl (1.1.1n-0+deb11u3) ...\r\nRemoving intermediate container 596caa1bda05\n ---> 904e5390b912\nStep 4/30 : FROM base as deps\n ---> 904e5390b912\nStep 5/30 : WORKDIR /myapp\n ---> Running in 977a8fbfedec\nRemoving intermediate container 977a8fbfedec\n ---> 65bd94ee0325\nStep 6/30 : ADD package.json ./\n ---> 24356a7ec09f\nStep 7/30 : RUN npm install --production=false\n ---> Running in 9a74a2ee5be1\n\u001b[91mnpm\u001b[0m\u001b[91m WARN config production Use `--omit=dev` instead.\n\u001b[0m\u001b[91mnpm WARN deprecated source-map-url@0.4.1: See https://github.com/lydell/source-map-url#deprecated\n\u001b[0m\u001b[91mnpm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated\n\u001b[0m\u001b[91mnpm WARN deprecated source-map-resolve@0.5.3: See https://github.com/lydell/source-map-resolve#deprecated\n\u001b[0m\u001b[91mnpm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated\n\u001b[0m\u001b[91mnpm WARN deprecated rollup-plugin-inject@3.0.2: This package has been deprecated and is no longer maintained. Please use @rollup/plugin-inject.\n\u001b[0m\u001b[91mnpm WARN deprecated sourcemap-codec@1.4.8: Please use @jridgewell/sourcemap-codec instead\n\u001b[0m\u001b[91mnpm WARN deprecated @npmcli/move-file@1.1.2: This functionality has been moved to @npmcli/fs\n\u001b[0m\nadded 1435 packages, and audited 1436 packages in 3m\n\n257 packages are looking for funding\n  run `npm fund` for details\n\n4 high severity vulnerabilities\n\nSome issues need review, and may require choosing\na different dependency.\n\nRun `npm audit` for details.\n\u001b[91mnpm notice \nnpm\u001b[0m\u001b[91m notice New major version of npm available! 8.19.3 -> 9.2.0\n\u001b[0m\u001b[91mnpm \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\nnpm notice\u001b[0m\u001b[91m Run `npm install -g npm@9.2.0` to update!\nnpm notice\u001b[0m\u001b[91m \n\u001b[0mRemoving intermediate container 9a74a2ee5be1\n ---> 4de14d9ad59a\nStep 8/30 : FROM base as production-deps\n ---> 904e5390b912\nStep 9/30 : WORKDIR /myapp\n ---> Running in b7535b45f14f\nRemoving intermediate container b7535b45f14f\n ---> 01edcf68aed2\nStep 10/30 : COPY --from=deps /myapp/node_modules /myapp/node_modules\n ---> 7cd2b12350d6\nStep 11/30 : ADD package.json ./\n ---> e0da90d55b57\nStep 12/30 : RUN npm prune --production\n ---> Running in eff1e3e8003e\n\u001b[91mnpm\u001b[0m\u001b[91m WARN config production Use `--omit=dev` instead.\n\u001b[0m\nup to date, audited 176 packages in 5s\n\n17 packages are looking for funding\n  run `npm fund` for details\n\nfound 0 vulnerabilities\n\u001b[91mnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m \nnpm \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m New major version of npm available! 8.19.3 -> 9.2.0\nnpm notice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\nnpm notice\u001b[0m\u001b[91m Run `npm install -g npm@9.2.0` to update!\nnpm \u001b[0m\u001b[91mnotice \n\u001b[0mRemoving intermediate container eff1e3e8003e\n ---> 3fe14e2bb652\nStep 13/30 : FROM base as build\n ---> 904e5390b912\nStep 14/30 : WORKDIR /myapp\n ---> Running in 28b5f281cc92\nRemoving intermediate container 28b5f281cc92\n ---> 1df1698b7f11\nStep 15/30 : COPY --from=deps /myapp/node_modules /myapp/node_modules\n ---> 0c0056b3259d\nStep 16/30 : ADD /app/database/schema.prisma .\n ---> 6e01fc510cd7\nStep 17/30 : RUN npx prisma generate\n ---> Running in 2728914ba671\nPrisma schema loaded from schema.prisma\n\n✔ Generated Prisma Client (4.8.0 | library) to ./node_modules/@prisma/client in 750ms\nYou can now start using Prisma Client in your code. Reference: https://pris.ly/d/client\n```\nimport { PrismaClient } from '@prisma/client'\nconst prisma = new PrismaClient()\n```\n\u001b[91mnpm notice \nnpm \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m New major version of npm available! 8.19.3 -> 9.2.0\nnpm \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\n\u001b[0m\u001b[91mnpm notice\u001b[0m\u001b[91m Run `npm install -g npm@9.2.0` to update!\nnpm\u001b[0m\u001b[91m \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m \n\u001b[0mRemoving intermediate container 2728914ba671\n ---> 49c28d44decc\nStep 18/30 : ADD . .\n ---> 829ba47f4f86\nStep 19/30 : RUN npm run build\n ---> Running in bc383a0d7fb8\n\n> build\n> run-s build:*\n\n\n> build:css\n> npm run generate:css -- --minify\n\n\n> generate:css\n> tailwindcss -o ./app/styles/tailwind.css --minify\n\n\u001b[91m\n\u001b[0m\u001b[91mRebuilding...\n\u001b[0m\u001b[91m\n\u001b[0m\u001b[91mDone in 550ms.\n\u001b[0m\n> build:remix\n> remix build\n\nBuilding Remix app in production mode...\nBuilt in 751ms\nRemoving intermediate container bc383a0d7fb8\n ---> a5ffdd625ac7\nStep 20/30 : FROM base\n ---> 904e5390b912\nStep 21/30 : ENV PORT=\"8080\"\n ---> Running in c2d282bdb3cc\nRemoving intermediate container c2d282bdb3cc\n ---> b382432ac910\nStep 22/30 : ENV NODE_ENV=\"production\"\n ---> Running in ce8c644b610c\nRemoving intermediate container ce8c644b610c\n ---> 756f642cd86e\nStep 23/30 : WORKDIR /myapp\n ---> Running in 946a086f8aa2\nRemoving intermediate container 946a086f8aa2\n ---> 4d6db1e9dd7a\nStep 24/30 : COPY --from=production-deps /myapp/node_modules /myapp/node_modules\n ---> 2f7cd66e20f6\nStep 25/30 : COPY --from=build /myapp/node_modules/.prisma /myapp/node_modules/.prisma\n ---> a4f9d39c09d7\nStep 26/30 : COPY --from=build /myapp/build /myapp/build\n ---> 0135c74fc00b\nStep 27/30 : COPY --from=build /myapp/public /myapp/public\n ---> db22bc108fca\nStep 28/30 : COPY --from=build /myapp/package.json /myapp/package.json\n ---> 5e0a555f91ff\nStep 29/30 : COPY --from=build /myapp/start.sh /myapp/start.sh\n ---> 893c387c57a4\nStep 30/30 : ENTRYPOINT [ \"./start.sh\" ]\n ---> Running in be063c1c48d9\nRemoving intermediate container be063c1c48d9\n ---> 8a722d057e85\nSuccessfully built 8a722d057e85\nSuccessfully tagged supa-fly-stack:latest\n","stderr":"","imageSize":340961661},"repair":{"violations":[{"name":"npmCacheCleanAfterInstall","position":{"start":15,"end":15,"columnStart":4,"columnEnd":34}},{"name":"ruleAptGetInstallUseNoRec","position":{"start":7,"end":7,"columnStart":22,"columnEnd":48}},{"name":"ruleAptGetInstallThenRemoveAptLists","position":{"start":7,"end":7,"columnStart":22,"columnEnd":48}}],"repairedDockerfile":"# base node image\nFROM node:16-bullseye-slim as base\n\n# set for base and all layer that inherit from it\nENV NODE_ENV production\n\n# Install openssl for Prisma\nRUN apt-get update && apt-get install --no-install-recommends -y openssl\n\n# Install all node_modules, including dev dependencies\nFROM base as deps\n\nWORKDIR /myapp\n\nADD package.json ./\nRUN npm install --production=false\n\n# Setup production node_modules\nFROM base as production-deps\n\nWORKDIR /myapp\n\nCOPY --from=deps /myapp/node_modules /myapp/node_modules\nADD package.json ./\nRUN npm prune --production\n\n# Build the app\nFROM base as build\n\nWORKDIR /myapp\n\nCOPY --from=deps /myapp/node_modules /myapp/node_modules\n\nADD /app/database/schema.prisma .\nRUN npx prisma generate\n\nADD . .\nRUN npm run build\n\n# Finally, build the production image with minimal footprint\nFROM base\n\nENV PORT=\"8080\"\nENV NODE_ENV=\"production\"\n\nWORKDIR /myapp\n\nCOPY --from=production-deps /myapp/node_modules /myapp/node_modules\nCOPY --from=build /myapp/node_modules/.prisma /myapp/node_modules/.prisma\n\nCOPY --from=build /myapp/build /myapp/build\nCOPY --from=build /myapp/public /myapp/public\nCOPY --from=build /myapp/package.json /myapp/package.json\nCOPY --from=build /myapp/start.sh /myapp/start.sh\n\nENTRYPOINT [ \"./start.sh\" ]"},"repairedBuild":{"startTimestamp":1672562101797,"endTimestamp":1672562445471,"error":null,"stdout":"Sending build context to Docker daemon  359.4kB\r\r\nStep 1/30 : FROM node:16-bullseye-slim as base\n ---> b3b9a79a4762\nStep 2/30 : ENV NODE_ENV production\n ---> Running in 24997ecf3c6e\nRemoving intermediate container 24997ecf3c6e\n ---> f6c72cf8c38b\nStep 3/30 : RUN apt-get update && apt-get install --no-install-recommends -y openssl\n ---> Running in e576376f557e\nGet:1 http://deb.debian.org/debian bullseye InRelease [116 kB]\nGet:2 http://deb.debian.org/debian-security bullseye-security InRelease [48.4 kB]\nGet:3 http://deb.debian.org/debian bullseye-updates InRelease [44.1 kB]\nGet:4 http://deb.debian.org/debian bullseye/main amd64 Packages [8183 kB]\nGet:5 http://deb.debian.org/debian-security bullseye-security/main amd64 Packages [210 kB]\nGet:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [14.6 kB]\nFetched 8616 kB in 1s (6357 kB/s)\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nSuggested packages:\n  ca-certificates\nThe following NEW packages will be installed:\n  openssl\n0 upgraded, 1 newly installed, 0 to remove and 0 not upgraded.\nNeed to get 853 kB of archives.\nAfter this operation, 1501 kB of additional disk space will be used.\nGet:1 http://deb.debian.org/debian bullseye/main amd64 openssl amd64 1.1.1n-0+deb11u3 [853 kB]\n\u001b[91mdebconf: delaying package configuration, since apt-utils is not installed\n\u001b[0mFetched 853 kB in 0s (29.2 MB/s)\nSelecting previously unselected package openssl.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 6661 files and directories currently installed.)\r\nPreparing to unpack .../openssl_1.1.1n-0+deb11u3_amd64.deb ...\r\nUnpacking openssl (1.1.1n-0+deb11u3) ...\r\nSetting up openssl (1.1.1n-0+deb11u3) ...\r\nRemoving intermediate container e576376f557e\n ---> ab72aced439b\nStep 4/30 : FROM base as deps\n ---> ab72aced439b\nStep 5/30 : WORKDIR /myapp\n ---> Running in 45178689b197\nRemoving intermediate container 45178689b197\n ---> 9b48558ebbdb\nStep 6/30 : ADD package.json ./\n ---> 3791310066e5\nStep 7/30 : RUN npm install --production=false\n ---> Running in e4713300447a\n\u001b[91mnpm\u001b[0m\u001b[91m WARN config production Use `--omit=dev` instead.\n\u001b[0m\u001b[91mnpm WARN deprecated source-map-url@0.4.1: See https://github.com/lydell/source-map-url#deprecated\n\u001b[0m\u001b[91mnpm WARN deprecated urix@0.1.0: Please see https://github.com/lydell/urix#deprecated\n\u001b[0m\u001b[91mnpm WARN deprecated source-map-resolve@0.5.3: See https://github.com/lydell/source-map-resolve#deprecated\n\u001b[0m\u001b[91mnpm WARN deprecated resolve-url@0.2.1: https://github.com/lydell/resolve-url#deprecated\n\u001b[0m\u001b[91mnpm WARN deprecated rollup-plugin-inject@3.0.2: This package has been deprecated and is no longer maintained. Please use @rollup/plugin-inject.\n\u001b[0m\u001b[91mnpm WARN deprecated sourcemap-codec@1.4.8: Please use @jridgewell/sourcemap-codec instead\n\u001b[0m\u001b[91mnpm WARN deprecated @npmcli/move-file@1.1.2: This functionality has been moved to @npmcli/fs\n\u001b[0m\nadded 1435 packages, and audited 1436 packages in 3m\n\n257 packages are looking for funding\n  run `npm fund` for details\n\n4 high severity vulnerabilities\n\nSome issues need review, and may require choosing\na different dependency.\n\nRun `npm audit` for details.\n\u001b[91mnpm notice \nnpm notice New major version of npm available! 8.19.3 -> 9.2.0\nnpm notice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\nnpm notice Run `npm install -g npm@9.2.0` to update!\nnpm notice \n\u001b[0mRemoving intermediate container e4713300447a\n ---> fb5d0a0b20e4\nStep 8/30 : FROM base as production-deps\n ---> ab72aced439b\nStep 9/30 : WORKDIR /myapp\n ---> Running in d04833df4ad3\nRemoving intermediate container d04833df4ad3\n ---> 4c7da93eb1c6\nStep 10/30 : COPY --from=deps /myapp/node_modules /myapp/node_modules\n ---> e03504a7a54e\nStep 11/30 : ADD package.json ./\n ---> dcd348ab7a4b\nStep 12/30 : RUN npm prune --production\n ---> Running in 0d6632aebbbd\n\u001b[91mnpm\u001b[0m\u001b[91m WARN config production Use `--omit=dev` instead.\n\u001b[0m\nup to date, audited 176 packages in 5s\n\n17 packages are looking for funding\n  run `npm fund` for details\n\nfound 0 vulnerabilities\n\u001b[91mnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m \nnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m New major version of npm available! 8.19.3 -> 9.2.0\nnpm \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\nnpm notice\u001b[0m\u001b[91m Run `npm install -g npm@9.2.0` to update!\nnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m \n\u001b[0mRemoving intermediate container 0d6632aebbbd\n ---> 48768a35530c\nStep 13/30 : FROM base as build\n ---> ab72aced439b\nStep 14/30 : WORKDIR /myapp\n ---> Running in e8bea1121f4e\nRemoving intermediate container e8bea1121f4e\n ---> 450f600db330\nStep 15/30 : COPY --from=deps /myapp/node_modules /myapp/node_modules\n ---> 9e97470656af\nStep 16/30 : ADD /app/database/schema.prisma .\n ---> fb9bb26ce995\nStep 17/30 : RUN npx prisma generate\n ---> Running in c2886a059dc7\nPrisma schema loaded from schema.prisma\n\n✔ Generated Prisma Client (4.8.0 | library) to ./node_modules/@prisma/client in 1.14s\nYou can now start using Prisma Client in your code. Reference: https://pris.ly/d/client\n```\nimport { PrismaClient } from '@prisma/client'\nconst prisma = new PrismaClient()\n```\n\u001b[91mnpm\u001b[0m\u001b[91m notice \nnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m New major version of npm available! 8.19.3 -> 9.2.0\nnpm \u001b[0m\u001b[91mnotice\u001b[0m\u001b[91m Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\n\u001b[0m\u001b[91mnpm notice Run `npm install -g npm@9.2.0` to update!\nnpm\u001b[0m\u001b[91m notice\u001b[0m\u001b[91m \n\u001b[0mRemoving intermediate container c2886a059dc7\n ---> 751560db4210\nStep 18/30 : ADD . .\n ---> a12ef723097c\nStep 19/30 : RUN npm run build\n ---> Running in b1fd12919273\n\n> build\n> run-s build:*\n\n\n> build:css\n> npm run generate:css -- --minify\n\n\n> generate:css\n> tailwindcss -o ./app/styles/tailwind.css --minify\n\n\u001b[91m\n\u001b[0m\u001b[91mRebuilding...\n\u001b[0m\u001b[91m\n\u001b[0m\u001b[91mDone in 530ms.\n\u001b[0m\n> build:remix\n> remix build\n\nBuilding Remix app in production mode...\nBuilt in 520ms\nRemoving intermediate container b1fd12919273\n ---> c6b62c93d05c\nStep 20/30 : FROM base\n ---> ab72aced439b\nStep 21/30 : ENV PORT=\"8080\"\n ---> Running in cb48d340b82f\nRemoving intermediate container cb48d340b82f\n ---> ed83da2109e6\nStep 22/30 : ENV NODE_ENV=\"production\"\n ---> Running in 5d183f20da68\nRemoving intermediate container 5d183f20da68\n ---> 7d58e7d330e9\nStep 23/30 : WORKDIR /myapp\n ---> Running in 68fbe1303d1d\nRemoving intermediate container 68fbe1303d1d\n ---> 328175ae279b\nStep 24/30 : COPY --from=production-deps /myapp/node_modules /myapp/node_modules\n ---> ab6e007ce7e3\nStep 25/30 : COPY --from=build /myapp/node_modules/.prisma /myapp/node_modules/.prisma\n ---> 3114bfc35940\nStep 26/30 : COPY --from=build /myapp/build /myapp/build\n ---> 243b8f8f8a47\nStep 27/30 : COPY --from=build /myapp/public /myapp/public\n ---> dec7a609855e\nStep 28/30 : COPY --from=build /myapp/package.json /myapp/package.json\n ---> 583f0b5f4fb1\nStep 29/30 : COPY --from=build /myapp/start.sh /myapp/start.sh\n ---> 4e5d5e3aeced\nStep 30/30 : ENTRYPOINT [ \"./start.sh\" ]\n ---> Running in 013ecd765d5c\nRemoving intermediate container 013ecd765d5c\n ---> c92dd832fb11\nSuccessfully built c92dd832fb11\nSuccessfully tagged supa-fly-stack:latest\n","stderr":"","imageSize":340961685},"endTime":1672562445808}