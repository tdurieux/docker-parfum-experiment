{"repository":"https://github.com/salesforce/refocus","dockerfilePath":"Dockerfile","startTime":1672281676496,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/salesforce/refocus'...\n","error":null,"commit":"ba349e92b51b3261340dd54746bdd4a7a61c458c"},"originalBuild":{"startTimestamp":1672281678539,"endTimestamp":1672281884118,"error":null,"stdout":"Sending build context to Docker daemon  16.49MB\r\r\nStep 1/14 : FROM node:8-alpine\n8-alpine: Pulling from library/node\ne6b0cf9c0882: Pulling fs layer\n93f9cf0467ca: Pulling fs layer\na564402f98da: Pulling fs layer\nb68680f1d28f: Pulling fs layer\na564402f98da: Verifying Checksum\na564402f98da: Download complete\ne6b0cf9c0882: Verifying Checksum\ne6b0cf9c0882: Download complete\n93f9cf0467ca: Verifying Checksum\n93f9cf0467ca: Download complete\nb68680f1d28f: Download complete\ne6b0cf9c0882: Pull complete\n93f9cf0467ca: Pull complete\na564402f98da: Pull complete\nb68680f1d28f: Pull complete\nDigest: sha256:38f7bf07ffd72ac612ec8c829cb20ad416518dbb679768d7733c93175453f4d4\nStatus: Downloaded newer image for node:8-alpine\n ---> 2b8fcdc6230a\nStep 2/14 : ENV HOME=/home/refocus\n ---> Running in 6ece91d7b8fa\nRemoving intermediate container 6ece91d7b8fa\n ---> 96d70f012979\nStep 3/14 : RUN adduser -D -h $HOME refocus\n ---> Running in 30c4db366d96\nRemoving intermediate container 30c4db366d96\n ---> a84410fea616\nStep 4/14 : COPY . $HOME\n ---> 8cf41cc9be8e\nStep 5/14 : RUN echo $'#!/bin/sh\\n\\nset -e\\n\\nhost=\"$1\"\\nshift\\ncmd=\"$@\"\\n\\nuntil psql -h \"$host\" -U \"postgres\" -c \"\\l\"; do\\n  >&2 echo \"Postgres is unavailable - sleeping\"\\n  sleep 1\\ndone\\n\\n>&2 echo \"Postgres is up - executing command\"\\nexec $cmd' > $HOME/wait-for-postgres.sh\n ---> Running in 29f0209d628c\nRemoving intermediate container 29f0209d628c\n ---> 4e37e33af6cf\nStep 6/14 : RUN chown -R refocus:refocus $HOME && chmod +x $HOME/wait-for-postgres.sh\n ---> Running in 06b7d01622a4\nRemoving intermediate container 06b7d01622a4\n ---> 08cecb69cc63\nStep 7/14 : RUN apk add --no-cache postgresql-client #need for script\n ---> Running in df0b8c90eb79\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.11/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.11/community/x86_64/APKINDEX.tar.gz\n(1/8) Installing ncurses-terminfo-base (6.1_p20200118-r4)\n(2/8) Installing ncurses-libs (6.1_p20200118-r4)\n(3/8) Installing libedit (20191211.3.1-r0)\n(4/8) Installing db (5.3.28-r1)\n(5/8) Installing libsasl (2.1.27-r5)\n(6/8) Installing libldap (2.4.48-r3)\n(7/8) Installing libpq (12.9-r0)\n(8/8) Installing postgresql-client (12.9-r0)\nExecuting busybox-1.31.1-r8.trigger\nOK: 13 MiB in 24 packages\nRemoving intermediate container df0b8c90eb79\n ---> b94911fbb59e\nStep 8/14 : USER refocus\n ---> Running in 6740e48c3de0\nRemoving intermediate container 6740e48c3de0\n ---> ec7352af2111\nStep 9/14 : WORKDIR $HOME\n ---> Running in 2a8f3b7ebed7\nRemoving intermediate container 2a8f3b7ebed7\n ---> 0b975d5646e7\nStep 10/14 : RUN npm install\n ---> Running in 2c6e841196c1\n\n> sinon@4.5.0 postinstall /home/refocus/node_modules/@salesforce/refocus-collector-eval/node_modules/sinon\n> node scripts/support-sinon.js\n\n\u001b[32mHave some ❤️ for Sinon? You can support the project via Open Collective:\u001b[22m\u001b[39m\n > \u001b[96m\u001b[1mhttps://opencollective.com/sinon/donate\n\u001b[0m\n\n> Refocus@1.0.0 postinstall /home/refocus\n> NODE_ENV=production gulp browserifyViews && gulp movecss && node scripts/moveSocket.js\n\n[02:44:01] Using gulpfile ~/gulpfile.js\n[02:44:01] Starting 'browserifyViews'...\nfinished building analytics/app.js\nfinished building tokens/app.js\nfinished building authentication/login/app.js\nfinished building authentication/logout/app.js\nfinished building authentication/register/app.js\nfinished building rooms/app.js\nfinished building perspective/app.js\nfinished building rooms/type/app.js\nfinished building rooms/types/app.js\nfinished building rooms/list/app.js\nfinished building rooms/new/app.js\nfinished building admin/app.js\n[02:44:11] Finished 'browserifyViews' after 9.82 s\n[02:44:11] Using gulpfile ~/gulpfile.js\n[02:44:11] Starting 'movecss'...\n[02:44:11] Finished 'movecss' after 24 ms\n\u001b[91mnpm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.1 (node_modules/fsevents):\n\u001b[0m\u001b[91mnpm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.1.1: wanted {\"os\":\"darwin\",\"arch\":\"any\"} (current: {\"os\":\"linux\",\"arch\":\"x64\"})\n\u001b[0m\u001b[91m\n\u001b[0madded 2360 packages from 2397 contributors and audited 2500 packages in 47.085s\n\n1 package is looking for funding\n  run `npm fund` for details\n\nfound 587 vulnerabilities (42 low, 163 moderate, 282 high, 100 critical)\n  run `npm audit fix` to fix them, or `npm audit` for details\nRemoving intermediate container 2c6e841196c1\n ---> 381de6251360\nStep 11/14 : ENV PGHOST=pg\n ---> Running in eb9b0a47ee02\nRemoving intermediate container eb9b0a47ee02\n ---> ded8d4418594\nStep 12/14 : ENV REDIS_URL=//redis:6379\n ---> Running in 1d3230e82c3f\nRemoving intermediate container 1d3230e82c3f\n ---> e2a07cfb0a9e\nStep 13/14 : EXPOSE 3000\n ---> Running in 9fd31f317c9c\nRemoving intermediate container 9fd31f317c9c\n ---> d0b8726c031b\nStep 14/14 : CMD [ \"/bin/sh\", \"-c\", \"$HOME/wait-for-postgres.sh pg 'npm start'\" ]\n ---> Running in 67563c2ece19\nRemoving intermediate container 67563c2ece19\n ---> 749de662dc71\nSuccessfully built 749de662dc71\nSuccessfully tagged refocus:latest\n","stderr":"","imageSize":404730105},"repair":{"violations":[{"name":"npmCacheCleanAfterInstall","position":{"start":29,"end":29,"columnStart":4,"columnEnd":15}}],"repairedDockerfile":"FROM node:8-alpine\n\nENV HOME=/home/refocus\nRUN adduser -D -h $HOME refocus\nCOPY . $HOME\n\nRUN echo $'#!/bin/sh\\n\\\n# wait-for-postgres.sh\\n\\\n# from https://docs.docker.com/compose/startup-order/ \\n\\\n\\n\\\nset -e\\n\\\n\\n\\\nhost=\"$1\"\\n\\\nshift\\n\\\ncmd=\"$@\"\\n\\\n\\n\\\nuntil psql -h \"$host\" -U \"postgres\" -c \"\\l\"; do\\n\\\n  >&2 echo \"Postgres is unavailable - sleeping\"\\n\\\n  sleep 1\\n\\\ndone\\n\\\n\\n\\\n>&2 echo \"Postgres is up - executing command\"\\n\\\nexec $cmd' > $HOME/wait-for-postgres.sh\n\nRUN chown -R refocus:refocus $HOME && chmod +x $HOME/wait-for-postgres.sh\nRUN apk add --no-cache postgresql-client #need for script\n\nUSER refocus\nWORKDIR $HOME\nRUN npm install\n\nENV PGHOST=pg\nENV REDIS_URL=//redis:6379\n\nEXPOSE 3000\n\nCMD [ \"/bin/sh\", \"-c\", \"$HOME/wait-for-postgres.sh pg 'npm start'\" ]\n\n"},"repairedBuild":{"startTimestamp":1672281886469,"endTimestamp":1672282104964,"error":null,"stdout":"Sending build context to Docker daemon  16.49MB\r\r\nStep 1/14 : FROM node:8-alpine\n ---> 2b8fcdc6230a\nStep 2/14 : ENV HOME=/home/refocus\n ---> Running in 7988fae187e0\nRemoving intermediate container 7988fae187e0\n ---> f70621a185c7\nStep 3/14 : RUN adduser -D -h $HOME refocus\n ---> Running in 4ab2bebe151a\nRemoving intermediate container 4ab2bebe151a\n ---> cc1b856afe31\nStep 4/14 : COPY . $HOME\n ---> cbf2346cee95\nStep 5/14 : RUN echo $'#!/bin/sh\\n\\nset -e\\n\\nhost=\"$1\"\\nshift\\ncmd=\"$@\"\\n\\nuntil psql -h \"$host\" -U \"postgres\" -c \"\\l\"; do\\n  >&2 echo \"Postgres is unavailable - sleeping\"\\n  sleep 1\\ndone\\n\\n>&2 echo \"Postgres is up - executing command\"\\nexec $cmd' > $HOME/wait-for-postgres.sh\n ---> Running in bdfe73693c60\nRemoving intermediate container bdfe73693c60\n ---> 2c39b2ce722c\nStep 6/14 : RUN chown -R refocus:refocus $HOME && chmod +x $HOME/wait-for-postgres.sh\n ---> Running in 88265105500d\nRemoving intermediate container 88265105500d\n ---> 56d18928b772\nStep 7/14 : RUN apk add --no-cache postgresql-client #need for script\n ---> Running in 15785ae93637\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.11/main/x86_64/APKINDEX.tar.gz\nfetch http://dl-cdn.alpinelinux.org/alpine/v3.11/community/x86_64/APKINDEX.tar.gz\n(1/8) Installing ncurses-terminfo-base (6.1_p20200118-r4)\n(2/8) Installing ncurses-libs (6.1_p20200118-r4)\n(3/8) Installing libedit (20191211.3.1-r0)\n(4/8) Installing db (5.3.28-r1)\n(5/8) Installing libsasl (2.1.27-r5)\n(6/8) Installing libldap (2.4.48-r3)\n(7/8) Installing libpq (12.9-r0)\n(8/8) Installing postgresql-client (12.9-r0)\nExecuting busybox-1.31.1-r8.trigger\nOK: 13 MiB in 24 packages\nRemoving intermediate container 15785ae93637\n ---> 5068638d8397\nStep 8/14 : USER refocus\n ---> Running in 3d5ff542c9de\nRemoving intermediate container 3d5ff542c9de\n ---> 5a67fc030abd\nStep 9/14 : WORKDIR $HOME\n ---> Running in 18c40e169f0e\nRemoving intermediate container 18c40e169f0e\n ---> 804b5926b915\nStep 10/14 : RUN npm install\n ---> Running in 2433e80f2ef8\n\n> sinon@4.5.0 postinstall /home/refocus/node_modules/@salesforce/refocus-collector-eval/node_modules/sinon\n> node scripts/support-sinon.js\n\n\u001b[32mHave some ❤️ for Sinon? You can support the project via Open Collective:\u001b[22m\u001b[39m\n > \u001b[96m\u001b[1mhttps://opencollective.com/sinon/donate\n\u001b[0m\n\n> Refocus@1.0.0 postinstall /home/refocus\n> NODE_ENV=production gulp browserifyViews && gulp movecss && node scripts/moveSocket.js\n\n[02:47:25] Using gulpfile ~/gulpfile.js\n[02:47:25] Starting 'browserifyViews'...\nfinished building analytics/app.js\nfinished building tokens/app.js\nfinished building authentication/login/app.js\nfinished building authentication/logout/app.js\nfinished building authentication/register/app.js\nfinished building rooms/app.js\nfinished building perspective/app.js\nfinished building rooms/type/app.js\nfinished building rooms/types/app.js\nfinished building rooms/list/app.js\nfinished building rooms/new/app.js\nfinished building admin/app.js\n[02:47:36] Finished 'browserifyViews' after 10 s\n[02:47:36] Using gulpfile ~/gulpfile.js\n[02:47:36] Starting 'movecss'...\n[02:47:36] Finished 'movecss' after 24 ms\n\u001b[91mnpm WARN optional SKIPPING OPTIONAL DEPENDENCY: fsevents@1.1.1 (node_modules/fsevents):\nnpm WARN notsup SKIPPING OPTIONAL DEPENDENCY: Unsupported platform for fsevents@1.1.1: wanted {\"os\":\"darwin\",\"arch\":\"any\"} (current: {\"os\":\"linux\",\"arch\":\"x64\"})\n\u001b[0m\u001b[91m\n\u001b[0madded 2360 packages from 2397 contributors and audited 2500 packages in 45.019s\n\n1 package is looking for funding\n  run `npm fund` for details\n\nfound 587 vulnerabilities (42 low, 163 moderate, 282 high, 100 critical)\n  run `npm audit fix` to fix them, or `npm audit` for details\nRemoving intermediate container 2433e80f2ef8\n ---> bf7f55bb2ce7\nStep 11/14 : ENV PGHOST=pg\n ---> Running in 363b04262f28\nRemoving intermediate container 363b04262f28\n ---> 3b5277bf24fc\nStep 12/14 : ENV REDIS_URL=//redis:6379\n ---> Running in e7ba93837d3b\nRemoving intermediate container e7ba93837d3b\n ---> c5a42b109fd3\nStep 13/14 : EXPOSE 3000\n ---> Running in ae6f7adfe2d4\nRemoving intermediate container ae6f7adfe2d4\n ---> 7fbb699997ad\nStep 14/14 : CMD [ \"/bin/sh\", \"-c\", \"$HOME/wait-for-postgres.sh pg 'npm start'\" ]\n ---> Running in 88e6a2374ccb\nRemoving intermediate container 88e6a2374ccb\n ---> 09135a5050db\nSuccessfully built 09135a5050db\nSuccessfully tagged refocus:latest\n","stderr":"","imageSize":404728209},"endTime":1672282107523}