{"repository":"https://github.com/textileio/go-threads","dockerfilePath":"Dockerfile","startTime":1672620807480,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/textileio/go-threads'...\n","error":null,"commit":"a715c240241320492cdd81aa4f7003168784c212"},"originalBuild":{"startTimestamp":1672620808473,"endTimestamp":1672620926209,"error":null,"stdout":"Sending build context to Docker daemon  2.511MB\r\r\nStep 1/28 : FROM golang:1.17.5-buster\n1.17.5-buster: Pulling from library/golang\n9b99af5931b3: Pulling fs layer\nb6013b3e77fe: Pulling fs layer\nbbced17b6899: Pulling fs layer\n8b609dabefa8: Pulling fs layer\n4caf28370547: Pulling fs layer\ne22f688bd413: Pulling fs layer\n7f4708eb198c: Pulling fs layer\ne22f688bd413: Waiting\n8b609dabefa8: Waiting\n7f4708eb198c: Waiting\n4caf28370547: Waiting\nb6013b3e77fe: Verifying Checksum\nb6013b3e77fe: Download complete\nbbced17b6899: Verifying Checksum\nbbced17b6899: Download complete\n9b99af5931b3: Download complete\n8b609dabefa8: Verifying Checksum\n8b609dabefa8: Download complete\n4caf28370547: Verifying Checksum\n4caf28370547: Download complete\n7f4708eb198c: Verifying Checksum\n7f4708eb198c: Download complete\n9b99af5931b3: Pull complete\nb6013b3e77fe: Pull complete\nbbced17b6899: Pull complete\ne22f688bd413: Verifying Checksum\ne22f688bd413: Download complete\n8b609dabefa8: Pull complete\n4caf28370547: Pull complete\ne22f688bd413: Pull complete\n7f4708eb198c: Pull complete\nDigest: sha256:7f89be6ec02f7eb4b429e9a43f4ac7d49d2c0cb79a99a28e2d1efe1e7e8a3473\nStatus: Downloaded newer image for golang:1.17.5-buster\n ---> 60cae92293cf\nStep 2/28 : LABEL maintainer=\"Textile <contact@textile.io>\"\n ---> Running in c46e35ca4c72\nRemoving intermediate container c46e35ca4c72\n ---> c881699735ed\nStep 3/28 : ENV SRC_DIR /go-threads\n ---> Running in ad2ca2ea5849\nRemoving intermediate container ad2ca2ea5849\n ---> a0fb59fa6aa8\nStep 4/28 : COPY go.mod go.sum $SRC_DIR/\n ---> 9eb4e0009121\nStep 5/28 : RUN cd $SRC_DIR   && go mod download\n ---> Running in 06126eedbfe9\nRemoving intermediate container 06126eedbfe9\n ---> 432ee7275f3d\nStep 6/28 : COPY . $SRC_DIR\n ---> 4a6169a9e7ba\nStep 7/28 : RUN cd $SRC_DIR   && go install github.com/textileio/go-threads/threadsd\n ---> Running in 40767c48abdb\nRemoving intermediate container 40767c48abdb\n ---> e0a0cea455ca\nStep 8/28 : ENV SUEXEC_VERSION v0.2\n ---> Running in a61bb5270a50\nRemoving intermediate container a61bb5270a50\n ---> ceb3d3389cb9\nStep 9/28 : ENV TINI_VERSION v0.16.1\n ---> Running in 238fe5293837\nRemoving intermediate container 238fe5293837\n ---> 194860cbd61d\nStep 10/28 : RUN set -x   && cd /tmp   && git clone https://github.com/ncopa/su-exec.git   && cd su-exec   && git checkout -q $SUEXEC_VERSION   && make   && cd /tmp   && wget -q -O tini https://github.com/krallin/tini/releases/download/$TINI_VERSION/tini   && chmod +x tini\n ---> Running in 5f8c644ea810\n\u001b[91m+ cd /tmp\n+ git clone https://github.com/ncopa/su-exec.git\n\u001b[0m\u001b[91mCloning into 'su-exec'...\n\u001b[0m\u001b[91m+ cd su-exec\n+ git checkout -q v0.2\n\u001b[0m\u001b[91m+ make\n\u001b[0mcc -Wall -Werror -g -o su-exec su-exec.c \n\u001b[91m+ cd /tmp\n+ wget -q -O tini https://github.com/krallin/tini/releases/download/v0.16.1/tini\n\u001b[0m\u001b[91m+ chmod +x tini\n\u001b[0mRemoving intermediate container 5f8c644ea810\n ---> 8ca7a53c95d1\nStep 11/28 : RUN apt-get update && apt-get install -y ca-certificates\n ---> Running in 1d0af6d9ea6d\nGet:1 http://security.debian.org/debian-security buster/updates InRelease [34.8 kB]\nGet:2 http://deb.debian.org/debian buster InRelease [122 kB]\nGet:3 http://deb.debian.org/debian buster-updates InRelease [56.6 kB]\nGet:4 http://deb.debian.org/debian buster/main amd64 Packages [7909 kB]\nGet:5 http://deb.debian.org/debian buster-updates/main amd64 Packages [8788 B]\nGet:6 http://security.debian.org/debian-security buster/updates/main amd64 Packages [422 kB]\nFetched 8553 kB in 2s (5554 kB/s)\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nca-certificates is already the newest version (20200601~deb10u2).\n0 upgraded, 0 newly installed, 0 to remove and 52 not upgraded.\nRemoving intermediate container 1d0af6d9ea6d\n ---> 88d8961f98ff\nStep 12/28 : FROM busybox:1.31.0-glibc\n1.31.0-glibc: Pulling from library/busybox\naff645f24c1e: Pulling fs layer\naff645f24c1e: Verifying Checksum\naff645f24c1e: Download complete\naff645f24c1e: Pull complete\nDigest: sha256:7c15dc145873c379dc0b1771da742b64754a9b4d3437d243e4d9f44f496cf6e5\nStatus: Downloaded newer image for busybox:1.31.0-glibc\n ---> 8dacfc772af7\nStep 13/28 : LABEL maintainer=\"Textile <contact@textile.io>\"\n ---> Running in 1c8df4c79ef4\nRemoving intermediate container 1c8df4c79ef4\n ---> b5ee5da84bb7\nStep 14/28 : ENV SRC_DIR /go-threads\n ---> Running in ab3efc77298f\nRemoving intermediate container ab3efc77298f\n ---> 4704f46c9a14\nStep 15/28 : COPY --from=0 /go/bin/threadsd /usr/local/bin/threadsd\n ---> 97926e01bc7b\nStep 16/28 : COPY --from=0 /tmp/su-exec/su-exec /sbin/su-exec\n ---> 9c18f0cf40f7\nStep 17/28 : COPY --from=0 /tmp/tini /sbin/tini\n ---> 65466885dea3\nStep 18/28 : COPY --from=0 /etc/ssl/certs /etc/ssl/certs\n ---> fea82dadb8ef\nStep 19/28 : COPY --from=0 /lib/x86_64-linux-gnu/libdl.so.2 /lib/libdl.so.2\n ---> 3a3e72fb83ef\nStep 20/28 : EXPOSE 4006\n ---> Running in cd9dc0c22cdd\nRemoving intermediate container cd9dc0c22cdd\n ---> 262691db49a6\nStep 21/28 : EXPOSE 6006\n ---> Running in 5c3bdec6b9db\nRemoving intermediate container 5c3bdec6b9db\n ---> e598c9bec2be\nStep 22/28 : EXPOSE 6007\n ---> Running in f35e6a8a3d1f\nRemoving intermediate container f35e6a8a3d1f\n ---> a3b9e0baaa81\nStep 23/28 : ENV THREADS_PATH /data/threads\n ---> Running in 4400959edf34\nRemoving intermediate container 4400959edf34\n ---> 7432180cd371\nStep 24/28 : RUN mkdir -p $THREADS_PATH   && adduser -D -h $THREADS_PATH -u 1000 -G users textile   && chown -R textile:users $THREADS_PATH\n ---> Running in 518da9d5415c\nRemoving intermediate container 518da9d5415c\n ---> 4cdd81688d7c\nStep 25/28 : USER textile\n ---> Running in 52390a10d1cd\nRemoving intermediate container 52390a10d1cd\n ---> 7a4a06df45e1\nStep 26/28 : VOLUME $THREADS_PATH\n ---> Running in 460dc68817ed\nRemoving intermediate container 460dc68817ed\n ---> e9ea4ea1b45b\nStep 27/28 : ENTRYPOINT [\"/sbin/tini\", \"--\", \"threadsd\"]\n ---> Running in 5a6067537fe3\nRemoving intermediate container 5a6067537fe3\n ---> 766a32cb9ba8\nStep 28/28 : CMD [\"--repo=/data/threads\"]\n ---> Running in 9ba0597b83c6\nRemoving intermediate container 9ba0597b83c6\n ---> 51105f7f5782\nSuccessfully built 51105f7f5782\nSuccessfully tagged go-threads:latest\n","stderr":"","imageSize":55028743},"repair":{"violations":[{"name":"ruleAptGetInstallUseNoRec","position":{"start":35,"end":35,"columnStart":22,"columnEnd":56}},{"name":"ruleAptGetInstallThenRemoveAptLists","position":{"start":35,"end":35,"columnStart":22,"columnEnd":56}}],"repairedDockerfile":"FROM golang:1.17.5-buster\nLABEL maintainer=\"Textile <contact@textile.io>\"\n\n# This is (in large part) copied (with love) from\n# https://hub.docker.com/r/ipfs/go-ipfs/dockerfile\n\n# Get source\nENV SRC_DIR /go-threads\n\n# Download packages first so they can be cached.\nCOPY go.mod go.sum $SRC_DIR/\nRUN cd $SRC_DIR \\\n  && go mod download\n\nCOPY . $SRC_DIR\n\n# Install the daemon\nRUN cd $SRC_DIR \\\n  && go install github.com/textileio/go-threads/threadsd\n\n# Get su-exec, a very minimal tool for dropping privileges,\n# and tini, a very minimal init daemon for containers\nENV SUEXEC_VERSION v0.2\nENV TINI_VERSION v0.16.1\nRUN set -x \\\n  && cd /tmp \\\n  && git clone https://github.com/ncopa/su-exec.git \\\n  && cd su-exec \\\n  && git checkout -q $SUEXEC_VERSION \\\n  && make \\\n  && cd /tmp \\\n  && wget -q -O tini https://github.com/krallin/tini/releases/download/$TINI_VERSION/tini \\\n  && chmod +x tini\n\n# Get the TLS CA certificates, they're not provided by busybox.\nRUN apt-get update && apt-get install --no-install-recommends -y ca-certificates\n\n# Now comes the actual target image, which aims to be as small as possible.\nFROM busybox:1.31.0-glibc\nLABEL maintainer=\"Textile <contact@textile.io>\"\n\n# Get the threads binary, entrypoint script, and TLS CAs from the build container.\nENV SRC_DIR /go-threads\nCOPY --from=0 /go/bin/threadsd /usr/local/bin/threadsd\nCOPY --from=0 /tmp/su-exec/su-exec /sbin/su-exec\nCOPY --from=0 /tmp/tini /sbin/tini\nCOPY --from=0 /etc/ssl/certs /etc/ssl/certs\n\n# This shared lib (part of glibc) doesn't seem to be included with busybox.\nCOPY --from=0 /lib/x86_64-linux-gnu/libdl.so.2 /lib/libdl.so.2\n\n# hostAddr; should be exposed to the public\nEXPOSE 4006\n# apiAddr; should *not* be exposed to the public unless intercepted by an auth system, e.g., textile\nEXPOSE 6006\n# apiProxyAddr; should *not* be exposed to the public unless intercepted by an auth system, e.g., textile\nEXPOSE 6007\n\n# Create the repo directory and switch to a non-privileged user.\nENV THREADS_PATH /data/threads\nRUN mkdir -p $THREADS_PATH \\\n  && adduser -D -h $THREADS_PATH -u 1000 -G users textile \\\n  && chown -R textile:users $THREADS_PATH\n\n# Switch to a non-privileged user\nUSER textile\n\n# Expose the repo as a volume.\n# Important this happens after the USER directive so permission are correct.\nVOLUME $THREADS_PATH\n\nENTRYPOINT [\"/sbin/tini\", \"--\", \"threadsd\"]\n\nCMD [\"--repo=/data/threads\"]\n"},"repairedBuild":{"startTimestamp":1672620926757,"endTimestamp":1672621011096,"error":null,"stdout":"Sending build context to Docker daemon  2.511MB\r\r\nStep 1/28 : FROM golang:1.17.5-buster\n ---> 60cae92293cf\nStep 2/28 : LABEL maintainer=\"Textile <contact@textile.io>\"\n ---> Running in 43523c21970c\nRemoving intermediate container 43523c21970c\n ---> 35b502bdd2e9\nStep 3/28 : ENV SRC_DIR /go-threads\n ---> Running in f7c67e9d7f9d\nRemoving intermediate container f7c67e9d7f9d\n ---> 23a8a598b3a7\nStep 4/28 : COPY go.mod go.sum $SRC_DIR/\n ---> beeef315f363\nStep 5/28 : RUN cd $SRC_DIR   && go mod download\n ---> Running in 46d0f34081bb\nRemoving intermediate container 46d0f34081bb\n ---> 7b33d97db1d6\nStep 6/28 : COPY . $SRC_DIR\n ---> 61b4fe87ecfb\nStep 7/28 : RUN cd $SRC_DIR   && go install github.com/textileio/go-threads/threadsd\n ---> Running in ddc9bb71fefa\nRemoving intermediate container ddc9bb71fefa\n ---> cb3b55c26218\nStep 8/28 : ENV SUEXEC_VERSION v0.2\n ---> Running in a5f522cf580f\nRemoving intermediate container a5f522cf580f\n ---> 5d1ca195717d\nStep 9/28 : ENV TINI_VERSION v0.16.1\n ---> Running in e2e2718fbc58\nRemoving intermediate container e2e2718fbc58\n ---> 0b67b78ad9df\nStep 10/28 : RUN set -x   && cd /tmp   && git clone https://github.com/ncopa/su-exec.git   && cd su-exec   && git checkout -q $SUEXEC_VERSION   && make   && cd /tmp   && wget -q -O tini https://github.com/krallin/tini/releases/download/$TINI_VERSION/tini   && chmod +x tini\n ---> Running in a1cdb90dee81\n\u001b[91m+ cd /tmp\n+ git clone https://github.com/ncopa/su-exec.git\n\u001b[0m\u001b[91mCloning into 'su-exec'...\n\u001b[0m\u001b[91m+ cd su-exec\n+ git checkout -q v0.2\n\u001b[0m\u001b[91m+ make\n\u001b[0mcc -Wall -Werror -g -o su-exec su-exec.c \n\u001b[91m+ cd /tmp\n+ wget -q -O tini https://github.com/krallin/tini/releases/download/v0.16.1/tini\n\u001b[0m\u001b[91m+ chmod +x tini\n\u001b[0mRemoving intermediate container a1cdb90dee81\n ---> f5c18016f0c3\nStep 11/28 : RUN apt-get update && apt-get install --no-install-recommends -y ca-certificates\n ---> Running in e2278086f277\nGet:1 http://deb.debian.org/debian buster InRelease [122 kB]\nGet:2 http://security.debian.org/debian-security buster/updates InRelease [34.8 kB]\nGet:3 http://deb.debian.org/debian buster-updates InRelease [56.6 kB]\nGet:4 http://security.debian.org/debian-security buster/updates/main amd64 Packages [422 kB]\nGet:5 http://deb.debian.org/debian buster/main amd64 Packages [7909 kB]\nGet:6 http://deb.debian.org/debian buster-updates/main amd64 Packages [8788 B]\nFetched 8553 kB in 2s (5294 kB/s)\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nca-certificates is already the newest version (20200601~deb10u2).\n0 upgraded, 0 newly installed, 0 to remove and 52 not upgraded.\nRemoving intermediate container e2278086f277\n ---> d394952af53d\nStep 12/28 : FROM busybox:1.31.0-glibc\n ---> 8dacfc772af7\nStep 13/28 : LABEL maintainer=\"Textile <contact@textile.io>\"\n ---> Running in c0e14a4766b1\nRemoving intermediate container c0e14a4766b1\n ---> a22f420684fc\nStep 14/28 : ENV SRC_DIR /go-threads\n ---> Running in 08bddc7a354a\nRemoving intermediate container 08bddc7a354a\n ---> 030cd9670ea3\nStep 15/28 : COPY --from=0 /go/bin/threadsd /usr/local/bin/threadsd\n ---> 07f2fd1de50d\nStep 16/28 : COPY --from=0 /tmp/su-exec/su-exec /sbin/su-exec\n ---> 167128517dd0\nStep 17/28 : COPY --from=0 /tmp/tini /sbin/tini\n ---> 2d5d53bc601d\nStep 18/28 : COPY --from=0 /etc/ssl/certs /etc/ssl/certs\n ---> 60b180e024cf\nStep 19/28 : COPY --from=0 /lib/x86_64-linux-gnu/libdl.so.2 /lib/libdl.so.2\n ---> f5bc4cf368eb\nStep 20/28 : EXPOSE 4006\n ---> Running in 0394265c9f3b\nRemoving intermediate container 0394265c9f3b\n ---> 7bee6f09c997\nStep 21/28 : EXPOSE 6006\n ---> Running in a3612d004fcd\nRemoving intermediate container a3612d004fcd\n ---> 8586c746cdcf\nStep 22/28 : EXPOSE 6007\n ---> Running in 12b98e3ab77b\nRemoving intermediate container 12b98e3ab77b\n ---> 462e5deab8af\nStep 23/28 : ENV THREADS_PATH /data/threads\n ---> Running in f19997f26b3f\nRemoving intermediate container f19997f26b3f\n ---> eaad20d99b66\nStep 24/28 : RUN mkdir -p $THREADS_PATH   && adduser -D -h $THREADS_PATH -u 1000 -G users textile   && chown -R textile:users $THREADS_PATH\n ---> Running in 2d4eafe84eb8\nRemoving intermediate container 2d4eafe84eb8\n ---> 757672e1733f\nStep 25/28 : USER textile\n ---> Running in 7aae7fb10f9b\nRemoving intermediate container 7aae7fb10f9b\n ---> 484ec11e6bd2\nStep 26/28 : VOLUME $THREADS_PATH\n ---> Running in 5c0ac3b2837e\nRemoving intermediate container 5c0ac3b2837e\n ---> 8900d15d1917\nStep 27/28 : ENTRYPOINT [\"/sbin/tini\", \"--\", \"threadsd\"]\n ---> Running in 18b323c13fc3\nRemoving intermediate container 18b323c13fc3\n ---> 95bd54a01fd0\nStep 28/28 : CMD [\"--repo=/data/threads\"]\n ---> Running in 8265b3f246ff\nRemoving intermediate container 8265b3f246ff\n ---> c49f54cdc9ad\nSuccessfully built c49f54cdc9ad\nSuccessfully tagged go-threads:latest\n","stderr":"","imageSize":55028743},"endTime":1672621011354}