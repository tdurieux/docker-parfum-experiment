{"repository":"https://github.com/chainsafe/lodestar","dockerfilePath":"Dockerfile","startTime":1672097718326,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/chainsafe/lodestar'...\n","error":null,"commit":"c274d220ec9886dccc02f8d3194c08ba0fc8b199"},"originalBuild":{"startTimestamp":1672097720014,"endTimestamp":1672098243205,"error":null,"stdout":"Sending build context to Docker daemon  5.768MB\r\r\nStep 1/17 : FROM --platform=${BUILDPLATFORM:-amd64} node:18-alpine as build_src\n18-alpine: Pulling from library/node\nDigest: sha256:a136ed7b0df71082cdb171f36d640ea3b392a5c70401c642326acee767b8c540\nStatus: Downloaded newer image for node:18-alpine\n ---> 6d7b7852bcd3\nStep 2/17 : ARG COMMIT\n ---> Running in 2222117984bb\nRemoving intermediate container 2222117984bb\n ---> 00befbdaa65a\nStep 3/17 : WORKDIR /usr/app\n ---> Running in 8fe1da6a4ae4\nRemoving intermediate container 8fe1da6a4ae4\n ---> a45b41e619d6\nStep 4/17 : RUN apk update && apk add --no-cache g++ make python3 && rm -rf /var/cache/apk/*\n ---> Running in 72ee1ee98b01\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\nv3.17.0-298-g2104b16d70 [https://dl-cdn.alpinelinux.org/alpine/v3.17/main]\nv3.17.0-300-g2dc109ce15 [https://dl-cdn.alpinelinux.org/alpine/v3.17/community]\nOK: 17813 distinct packages available\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\n(1/24) Installing libstdc++-dev (12.2.1_git20220924-r4)\n(2/24) Installing binutils (2.39-r2)\n(3/24) Installing libgomp (12.2.1_git20220924-r4)\n(4/24) Installing libatomic (12.2.1_git20220924-r4)\n(5/24) Installing gmp (6.2.1-r2)\n(6/24) Installing isl25 (0.25-r0)\n(7/24) Installing mpfr4 (4.1.0-r0)\n(8/24) Installing mpc1 (1.2.1-r1)\n(9/24) Installing gcc (12.2.1_git20220924-r4)\n(10/24) Installing musl-dev (1.2.3-r4)\n(11/24) Installing libc-dev (0.7.2-r3)\n(12/24) Installing g++ (12.2.1_git20220924-r4)\n(13/24) Installing make (4.3-r1)\n(14/24) Installing libbz2 (1.0.8-r4)\n(15/24) Installing libexpat (2.5.0-r0)\n(16/24) Installing libffi (3.4.4-r0)\n(17/24) Installing gdbm (1.23-r0)\n(18/24) Installing xz-libs (5.2.9-r0)\n(19/24) Installing mpdecimal (2.5.1-r1)\n(20/24) Installing ncurses-terminfo-base (6.3_p20221119-r0)\n(21/24) Installing ncurses-libs (6.3_p20221119-r0)\n(22/24) Installing readline (8.2.0-r0)\n(23/24) Installing sqlite-libs (3.40.0-r0)\n(24/24) Installing python3 (3.10.9-r1)\nExecuting busybox-1.35.0-r29.trigger\nOK: 287 MiB in 41 packages\nRemoving intermediate container 72ee1ee98b01\n ---> e4917982cc51\nStep 5/17 : COPY . .\n ---> b01206021c2e\nStep 6/17 : RUN yarn install --non-interactive --frozen-lockfile &&   yarn build &&   yarn install --non-interactive --frozen-lockfile --production\n ---> Running in 00cfa0642011\nyarn install v1.22.19\n[1/5] Validating package.json...\n[2/5] Resolving packages...\n[3/5] Fetching packages...\n[4/5] Linking dependencies...\n\u001b[91mwarning \" > @lodestar/api@1.2.1\" has unmet peer dependency \"fastify@3.29.4\".\nwarning \" > @lodestar/beacon-node@1.2.1\" has unmet peer dependency \"c-kzg@^1.0.7\".\n\u001b[0m\u001b[91mwarning \" > @lodestar/reqresp@1.2.1\" has unmet peer dependency \"libp2p@0.39.2\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-85b7196e-7bdd-4637-9378-0ef7d16f5aeb > @lodestar/beacon-node > @chainsafe/bls@7.1.1\" has unmet peer dependency \"@chainsafe/blst@^0.2.4\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-85b7196e-7bdd-4637-9378-0ef7d16f5aeb > @lodestar/beacon-node > prometheus-gc-stats@0.6.3\" has incorrect peer dependency \"prom-client@>= 10 <= 12\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-85b7196e-7bdd-4637-9378-0ef7d16f5aeb > @lodestar/beacon-node > @multiformats/multiaddr > dns-over-http-resolver > native-fetch@4.0.2\" has unmet peer dependency \"undici@*\".\n\u001b[0m[5/5] Building fresh packages...\nDone in 114.90s.\nyarn run v1.22.19\n$ lerna run build\n\u001b[91mlerna\u001b[0m\u001b[91m notice cli v5.5.2\n\u001b[0m\u001b[91mlerna info Executing command in 15 packages: \"yarn run build\"\n\u001b[0m@lodestar/utils: $ tsc -p tsconfig.build.json\n@lodestar/params: $ tsc -p tsconfig.build.json\n@lodestar/types: $ tsc -p tsconfig.build.json\n@lodestar/spec-test-util: $ tsc -p tsconfig.build.json\n@lodestar/config: $ tsc -p tsconfig.build.json\n@lodestar/db: $ tsc -p tsconfig.build.json\n@lodestar/api: $ tsc -p tsconfig.build.json\n@lodestar/reqresp: $ tsc -p tsconfig.build.json\n@lodestar/state-transition: $ tsc -p tsconfig.build.json\n@lodestar/light-client: $ tsc -p tsconfig.build.json\n@lodestar/validator: $ tsc -p tsconfig.build.json\n@lodestar/flare: $ tsc -p tsconfig.build.json\n@lodestar/fork-choice: $ tsc -p tsconfig.build.json\n@lodestar/beacon-node: $ tsc -p tsconfig.build.json\n@chainsafe/lodestar: $ tsc -p tsconfig.build.json && yarn write-git-data\n@chainsafe/lodestar: $ node lib/util/gitData/writeGitData.js\n\u001b[91mlerna \u001b[0m\u001b[91msuccess run\u001b[0m\u001b[91m Ran npm script 'build' in 15 packages in 51.7s:\n\u001b[0m\u001b[91mlerna success\u001b[0m\u001b[91m - @lodestar/api\nlerna \u001b[0m\u001b[91msuccess\u001b[0m\u001b[91m - @lodestar/beacon-node\nlerna\u001b[0m\u001b[91m \u001b[0m\u001b[91msuccess\u001b[0m\u001b[91m - @chainsafe/lodestar\n\u001b[0m\u001b[91mlerna \u001b[0m\u001b[91msuccess\u001b[0m\u001b[91m - @lodestar/config\n\u001b[0m\u001b[91mlerna \u001b[0m\u001b[91msuccess\u001b[0m\u001b[91m - @lodestar/db\nlerna \u001b[0m\u001b[91msuccess\u001b[0m\u001b[91m - @lodestar/flare\n\u001b[0m\u001b[91mlerna \u001b[0m\u001b[91msuccess\u001b[0m\u001b[91m - @lodestar/fork-choice\nlerna\u001b[0m\u001b[91m success\u001b[0m\u001b[91m - @lodestar/light-client\nlerna\u001b[0m\u001b[91m success\u001b[0m\u001b[91m - @lodestar/params\nlerna\u001b[0m\u001b[91m success\u001b[0m\u001b[91m - @lodestar/reqresp\nlerna \u001b[0m\u001b[91msuccess\u001b[0m\u001b[91m - @lodestar/spec-test-util\n\u001b[0m\u001b[91mlerna \u001b[0m\u001b[91msuccess\u001b[0m\u001b[91m - @lodestar/state-transition\nlerna\u001b[0m\u001b[91m success\u001b[0m\u001b[91m - @lodestar/types\nlerna\u001b[0m\u001b[91m \u001b[0m\u001b[91msuccess - @lodestar/utils\nlerna\u001b[0m\u001b[91m success\u001b[0m\u001b[91m - @lodestar/validator\n\u001b[0mDone in 52.16s.\nyarn install v1.22.19\n[1/5] Validating package.json...\n[2/5] Resolving packages...\n[3/5] Fetching packages...\n[4/5] Linking dependencies...\n\u001b[91mwarning \" > @lodestar/api@1.2.1\" has unmet peer dependency \"fastify@3.29.4\".\n\u001b[0m\u001b[91mwarning \" > @lodestar/beacon-node@1.2.1\" has unmet peer dependency \"c-kzg@^1.0.7\".\n\u001b[0m\u001b[91mwarning \" > @lodestar/reqresp@1.2.1\" has unmet peer dependency \"libp2p@0.39.2\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-eae515e5-fc64-4c48-a73e-0e291b4a1cb1 > @lodestar/beacon-node > @chainsafe/bls@7.1.1\" has unmet peer dependency \"@chainsafe/blst@^0.2.4\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-eae515e5-fc64-4c48-a73e-0e291b4a1cb1 > @lodestar/beacon-node > prometheus-gc-stats@0.6.3\" has incorrect peer dependency \"prom-client@>= 10 <= 12\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-eae515e5-fc64-4c48-a73e-0e291b4a1cb1 > @lodestar/beacon-node > @multiformats/multiaddr > dns-over-http-resolver > native-fetch@4.0.2\" has unmet peer dependency \"undici@*\".\n\u001b[0m[5/5] Building fresh packages...\nDone in 7.30s.\nRemoving intermediate container 00cfa0642011\n ---> afcde25f7fd9\nStep 7/17 : RUN cd packages/cli && GIT_COMMIT=${COMMIT} yarn write-git-data\n ---> Running in 1fdcbdf991f7\nyarn run v1.22.19\n$ node lib/util/gitData/writeGitData.js\nDone in 0.16s.\nRemoving intermediate container 1fdcbdf991f7\n ---> 90da8ba06aea\nStep 8/17 : FROM node:18-alpine as build_deps\n ---> 6d7b7852bcd3\nStep 9/17 : WORKDIR /usr/app\n ---> Running in 765f62299249\nRemoving intermediate container 765f62299249\n ---> a9890ff8cb95\nStep 10/17 : RUN apk update && apk add --no-cache g++ make python3 && rm -rf /var/cache/apk/*\n ---> Running in 15a620c2228d\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\nv3.17.0-298-g2104b16d70 [https://dl-cdn.alpinelinux.org/alpine/v3.17/main]\nv3.17.0-300-g2dc109ce15 [https://dl-cdn.alpinelinux.org/alpine/v3.17/community]\nOK: 17813 distinct packages available\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\n(1/24) Installing libstdc++-dev (12.2.1_git20220924-r4)\n(2/24) Installing binutils (2.39-r2)\n(3/24) Installing libgomp (12.2.1_git20220924-r4)\n(4/24) Installing libatomic (12.2.1_git20220924-r4)\n(5/24) Installing gmp (6.2.1-r2)\n(6/24) Installing isl25 (0.25-r0)\n(7/24) Installing mpfr4 (4.1.0-r0)\n(8/24) Installing mpc1 (1.2.1-r1)\n(9/24) Installing gcc (12.2.1_git20220924-r4)\n(10/24) Installing musl-dev (1.2.3-r4)\n(11/24) Installing libc-dev (0.7.2-r3)\n(12/24) Installing g++ (12.2.1_git20220924-r4)\n(13/24) Installing make (4.3-r1)\n(14/24) Installing libbz2 (1.0.8-r4)\n(15/24) Installing libexpat (2.5.0-r0)\n(16/24) Installing libffi (3.4.4-r0)\n(17/24) Installing gdbm (1.23-r0)\n(18/24) Installing xz-libs (5.2.9-r0)\n(19/24) Installing mpdecimal (2.5.1-r1)\n(20/24) Installing ncurses-terminfo-base (6.3_p20221119-r0)\n(21/24) Installing ncurses-libs (6.3_p20221119-r0)\n(22/24) Installing readline (8.2.0-r0)\n(23/24) Installing sqlite-libs (3.40.0-r0)\n(24/24) Installing python3 (3.10.9-r1)\nExecuting busybox-1.35.0-r29.trigger\nOK: 287 MiB in 41 packages\nRemoving intermediate container 15a620c2228d\n ---> e9b83e3ea31e\nStep 11/17 : COPY --from=build_src /usr/app .\n ---> dc08b474ecc1\nStep 12/17 : RUN yarn install --non-interactive --frozen-lockfile --production --force\n ---> Running in 64061741e87d\nyarn install v1.22.19\n[1/5] Validating package.json...\n[2/5] Resolving packages...\n[3/5] Fetching packages...\n[4/5] Linking dependencies...\n\u001b[91mwarning \" > @lodestar/api@1.2.1\" has unmet peer dependency \"fastify@3.29.4\".\nwarning \" > @lodestar/beacon-node@1.2.1\" has unmet peer dependency \"c-kzg@^1.0.7\".\n\u001b[0m\u001b[91mwarning \" > @lodestar/reqresp@1.2.1\" has unmet peer dependency \"libp2p@0.39.2\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-6bf529e7-81d1-48a0-ac0c-f8943b8d54f4 > @lodestar/beacon-node > @chainsafe/bls@7.1.1\" has unmet peer dependency \"@chainsafe/blst@^0.2.4\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-6bf529e7-81d1-48a0-ac0c-f8943b8d54f4 > @lodestar/beacon-node > prometheus-gc-stats@0.6.3\" has incorrect peer dependency \"prom-client@>= 10 <= 12\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-6bf529e7-81d1-48a0-ac0c-f8943b8d54f4 > @lodestar/beacon-node > @multiformats/multiaddr > dns-over-http-resolver > native-fetch@4.0.2\" has unmet peer dependency \"undici@*\".\n\u001b[0m[5/5] Rebuilding all packages...\nDone in 85.14s.\nRemoving intermediate container 64061741e87d\n ---> 34b099ca75f0\nStep 13/17 : FROM node:18-alpine\n ---> 6d7b7852bcd3\nStep 14/17 : WORKDIR /usr/app\n ---> Running in a01069b73ec2\nRemoving intermediate container a01069b73ec2\n ---> 2926d5683a64\nStep 15/17 : COPY --from=build_deps /usr/app .\n ---> f3b7cccb6571\nStep 16/17 : ENV NODE_OPTIONS=--max-old-space-size=4096\n ---> Running in 78e88ae995af\nRemoving intermediate container 78e88ae995af\n ---> 29f6a65d81ae\nStep 17/17 : ENTRYPOINT [\"node\", \"./packages/cli/bin/lodestar\"]\n ---> Running in 286f36ceddc0\nRemoving intermediate container 286f36ceddc0\n ---> 29ba5e581010\nSuccessfully built 29ba5e581010\nSuccessfully tagged lodestar:latest\n","stderr":"","imageSize":339227964},"repair":{"violations":[],"repairedDockerfile":"\n# --platform=$BUILDPLATFORM is used build javascript source with host arch\n# Otherwise TS builds on emulated archs and can be extremely slow (+1h)\nFROM --platform=${BUILDPLATFORM:-amd64} node:18-alpine as build_src\nARG COMMIT\nWORKDIR /usr/app\nRUN apk update && apk add --no-cache g++ make python3 && rm -rf /var/cache/apk/*\n\nCOPY . .\n\nRUN yarn install --non-interactive --frozen-lockfile && \\\n  yarn build && \\\n  yarn install --non-interactive --frozen-lockfile --production\n\n# To have access to the specific branch and commit used to build this source,\n# a git-data.json file is created by persisting git data at build time. Then,\n# a version string like `v0.35.0-beta.0/HEAD/82219149 (git)` can be shown in\n# the terminal and in the logs; which is very useful to track tests better.\nRUN cd packages/cli && GIT_COMMIT=${COMMIT} yarn write-git-data\n\n\n# Copy built src + node_modules to build native packages for archs different than host.\n# Note: This step is redundant for the host arch\nFROM node:18-alpine as build_deps\nWORKDIR /usr/app\nRUN apk update && apk add --no-cache g++ make python3 && rm -rf /var/cache/apk/*\n\nCOPY --from=build_src /usr/app .\n\n# Do yarn --force to trigger a rebuild of the native packages\n# Emmulates `yarn rebuild` which is not available in v1 https://yarnpkg.com/cli/rebuild \nRUN yarn install --non-interactive --frozen-lockfile --production --force\n\n\n# Copy built src + node_modules to a new layer to prune unnecessary fs\n# Previous layer weights 7.25GB, while this final 488MB (as of Oct 2020)\nFROM node:18-alpine\nWORKDIR /usr/app\nCOPY --from=build_deps /usr/app .\n\n# NodeJS applications have a default memory limit of 2.5GB.\n# This limit is bit tight for a Prater node, it is recommended to raise the limit\n# since memory may spike during certain network conditions.\nENV NODE_OPTIONS=--max-old-space-size=4096\n\nENTRYPOINT [\"node\", \"./packages/cli/bin/lodestar\"]"},"endTime":1672098244100}