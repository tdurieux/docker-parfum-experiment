{"repository":"https://github.com/se2p/whisker","dockerfilePath":"Dockerfile","startTime":1672854663870,"endTime":1672856090471,"clone":{"startTime":1672854663871,"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/se2p/whisker'...\n","error":null,"endTime":1672854671460,"commit":"f4547fd847292f64be138da9834e8256322947ab"},"originalBuild":{"startTime":1672854671529,"endTime":1672855523798,"error":null,"stdout":"Sending build context to Docker daemon  2.728MB\r\r\nStep 1/20 : ARG version=@sha256:bed240a3b8cd99af56a2971046201a26fba978804f55c296bde7f9b1075d19bc\nStep 2/20 : FROM satantime/puppeteer-node${version} as base\ndocker.io/satantime/puppeteer-node@sha256:bed240a3b8cd99af56a2971046201a26fba978804f55c296bde7f9b1075d19bc: Pulling from satantime/puppeteer-node\n5eb5b503b376: Pulling fs layer\n53f484eb7703: Pulling fs layer\nc04980840666: Pulling fs layer\n82af32d78503: Pulling fs layer\na336f54e0624: Pulling fs layer\nfd993511311b: Pulling fs layer\na336f54e0624: Waiting\nfd993511311b: Waiting\n53f484eb7703: Verifying Checksum\n53f484eb7703: Download complete\n5eb5b503b376: Verifying Checksum\n5eb5b503b376: Download complete\na336f54e0624: Verifying Checksum\na336f54e0624: Download complete\n82af32d78503: Verifying Checksum\n82af32d78503: Download complete\nc04980840666: Verifying Checksum\nc04980840666: Download complete\nfd993511311b: Verifying Checksum\nfd993511311b: Download complete\n5eb5b503b376: Pull complete\n53f484eb7703: Pull complete\nc04980840666: Pull complete\n82af32d78503: Pull complete\na336f54e0624: Pull complete\nfd993511311b: Pull complete\nDigest: sha256:bed240a3b8cd99af56a2971046201a26fba978804f55c296bde7f9b1075d19bc\nStatus: Downloaded newer image for satantime/puppeteer-node@sha256:bed240a3b8cd99af56a2971046201a26fba978804f55c296bde7f9b1075d19bc\n ---> 09c41718d4ea\nStep 3/20 : RUN apt-get update     && apt-get install --no-install-recommends --no-install-suggests -y tini     && rm -rf /usr/share/icons\n ---> Running in e05b76987020\nGet:1 http://security.debian.org/debian-security bullseye-security InRelease [48.4 kB]\nGet:2 http://deb.debian.org/debian bullseye InRelease [116 kB]\nGet:3 http://deb.debian.org/debian bullseye-updates InRelease [44.1 kB]\nGet:4 http://security.debian.org/debian-security bullseye-security/main amd64 Packages [210 kB]\nGet:5 http://deb.debian.org/debian bullseye/main amd64 Packages [8183 kB]\nGet:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [14.6 kB]\nFetched 8616 kB in 1s (5901 kB/s)\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nThe following NEW packages will be installed:\n  tini\n0 upgraded, 1 newly installed, 0 to remove and 50 not upgraded.\nNeed to get 255 kB of archives.\nAfter this operation, 776 kB of additional disk space will be used.\nGet:1 http://deb.debian.org/debian bullseye/main amd64 tini amd64 0.19.0-1 [255 kB]\n\u001b[91mdebconf: delaying package configuration, since apt-utils is not installed\n\u001b[0mFetched 255 kB in 0s (9781 kB/s)\nSelecting previously unselected package tini.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 17917 files and directories currently installed.)\r\nPreparing to unpack .../tini_0.19.0-1_amd64.deb ...\r\nUnpacking tini (0.19.0-1) ...\r\nSetting up tini (0.19.0-1) ...\r\nRemoving intermediate container e05b76987020\n ---> 1a6fdb45a3cc\nStep 4/20 : FROM base as build\n ---> 1a6fdb45a3cc\nStep 5/20 : RUN apt-get update     && apt-get install --no-install-recommends --no-install-suggests -y git\n ---> Running in 1ab6385235a1\nHit:1 http://deb.debian.org/debian bullseye InRelease\nHit:2 http://deb.debian.org/debian bullseye-updates InRelease\nHit:3 http://security.debian.org/debian-security bullseye-security InRelease\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nThe following additional packages will be installed:\n  git-man libcurl3-gnutls liberror-perl libgdbm-compat4 libgdbm6 libnghttp2-14\n  libperl5.32 librtmp1 libssh2-1 perl perl-modules-5.32\nSuggested packages:\n  gettext-base git-daemon-run | git-daemon-sysvinit git-doc git-el git-email\n  git-gui gitk gitweb git-cvs git-mediawiki git-svn gdbm-l10n perl-doc\n  libterm-readline-gnu-perl | libterm-readline-perl-perl make\n  libtap-harness-archive-perl\nRecommended packages:\n  patch less ssh-client netbase\nThe following NEW packages will be installed:\n  git git-man libcurl3-gnutls liberror-perl libgdbm-compat4 libgdbm6\n  libnghttp2-14 libperl5.32 librtmp1 libssh2-1 perl perl-modules-5.32\n0 upgraded, 12 newly installed, 0 to remove and 50 not upgraded.\nNeed to get 15.4 MB of archives.\nAfter this operation, 86.6 MB of additional disk space will be used.\nGet:1 http://deb.debian.org/debian bullseye/main amd64 perl-modules-5.32 all 5.32.1-4+deb11u2 [2823 kB]\nGet:2 http://deb.debian.org/debian bullseye/main amd64 libgdbm6 amd64 1.19-2 [64.9 kB]\nGet:3 http://deb.debian.org/debian bullseye/main amd64 libgdbm-compat4 amd64 1.19-2 [44.7 kB]\nGet:4 http://deb.debian.org/debian bullseye/main amd64 libperl5.32 amd64 5.32.1-4+deb11u2 [4106 kB]\nGet:5 http://deb.debian.org/debian bullseye/main amd64 perl amd64 5.32.1-4+deb11u2 [293 kB]\nGet:6 http://deb.debian.org/debian bullseye/main amd64 libnghttp2-14 amd64 1.43.0-1 [77.1 kB]\nGet:7 http://deb.debian.org/debian bullseye/main amd64 librtmp1 amd64 2.4+20151223.gitfa8646d.1-2+b2 [60.8 kB]\nGet:8 http://deb.debian.org/debian bullseye/main amd64 libssh2-1 amd64 1.9.0-2 [156 kB]\nGet:9 http://deb.debian.org/debian bullseye/main amd64 libcurl3-gnutls amd64 7.74.0-1.3+deb11u3 [342 kB]\nGet:10 http://deb.debian.org/debian bullseye/main amd64 liberror-perl all 0.17029-1 [31.0 kB]\nGet:11 http://deb.debian.org/debian bullseye/main amd64 git-man all 1:2.30.2-1 [1827 kB]\nGet:12 http://deb.debian.org/debian bullseye/main amd64 git amd64 1:2.30.2-1 [5527 kB]\n\u001b[91mdebconf: delaying package configuration, since apt-utils is not installed\n\u001b[0mFetched 15.4 MB in 1s (15.6 MB/s)\nSelecting previously unselected package perl-modules-5.32.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 17922 files and directories currently installed.)\r\nPreparing to unpack .../00-perl-modules-5.32_5.32.1-4+deb11u2_all.deb ...\r\nUnpacking perl-modules-5.32 (5.32.1-4+deb11u2) ...\r\nSelecting previously unselected package libgdbm6:amd64.\r\nPreparing to unpack .../01-libgdbm6_1.19-2_amd64.deb ...\r\nUnpacking libgdbm6:amd64 (1.19-2) ...\r\nSelecting previously unselected package libgdbm-compat4:amd64.\r\nPreparing to unpack .../02-libgdbm-compat4_1.19-2_amd64.deb ...\r\nUnpacking libgdbm-compat4:amd64 (1.19-2) ...\r\nSelecting previously unselected package libperl5.32:amd64.\r\nPreparing to unpack .../03-libperl5.32_5.32.1-4+deb11u2_amd64.deb ...\r\nUnpacking libperl5.32:amd64 (5.32.1-4+deb11u2) ...\r\nSelecting previously unselected package perl.\r\nPreparing to unpack .../04-perl_5.32.1-4+deb11u2_amd64.deb ...\r\nUnpacking perl (5.32.1-4+deb11u2) ...\r\nSelecting previously unselected package libnghttp2-14:amd64.\r\nPreparing to unpack .../05-libnghttp2-14_1.43.0-1_amd64.deb ...\r\nUnpacking libnghttp2-14:amd64 (1.43.0-1) ...\r\nSelecting previously unselected package librtmp1:amd64.\r\nPreparing to unpack .../06-librtmp1_2.4+20151223.gitfa8646d.1-2+b2_amd64.deb ...\r\nUnpacking librtmp1:amd64 (2.4+20151223.gitfa8646d.1-2+b2) ...\r\nSelecting previously unselected package libssh2-1:amd64.\r\nPreparing to unpack .../07-libssh2-1_1.9.0-2_amd64.deb ...\r\nUnpacking libssh2-1:amd64 (1.9.0-2) ...\r\nSelecting previously unselected package libcurl3-gnutls:amd64.\r\nPreparing to unpack .../08-libcurl3-gnutls_7.74.0-1.3+deb11u3_amd64.deb ...\r\nUnpacking libcurl3-gnutls:amd64 (7.74.0-1.3+deb11u3) ...\r\nSelecting previously unselected package liberror-perl.\r\nPreparing to unpack .../09-liberror-perl_0.17029-1_all.deb ...\r\nUnpacking liberror-perl (0.17029-1) ...\r\nSelecting previously unselected package git-man.\r\nPreparing to unpack .../10-git-man_1%3a2.30.2-1_all.deb ...\r\nUnpacking git-man (1:2.30.2-1) ...\r\nSelecting previously unselected package git.\r\nPreparing to unpack .../11-git_1%3a2.30.2-1_amd64.deb ...\r\nUnpacking git (1:2.30.2-1) ...\r\nSetting up perl-modules-5.32 (5.32.1-4+deb11u2) ...\r\nSetting up libnghttp2-14:amd64 (1.43.0-1) ...\r\nSetting up librtmp1:amd64 (2.4+20151223.gitfa8646d.1-2+b2) ...\r\nSetting up git-man (1:2.30.2-1) ...\r\nSetting up libssh2-1:amd64 (1.9.0-2) ...\r\nSetting up libgdbm6:amd64 (1.19-2) ...\r\nSetting up libcurl3-gnutls:amd64 (7.74.0-1.3+deb11u3) ...\r\nSetting up libgdbm-compat4:amd64 (1.19-2) ...\r\nSetting up libperl5.32:amd64 (5.32.1-4+deb11u2) ...\r\nSetting up perl (5.32.1-4+deb11u2) ...\r\nSetting up liberror-perl (0.17029-1) ...\r\nSetting up git (1:2.30.2-1) ...\r\nProcessing triggers for libc-bin (2.31-13+deb11u2) ...\r\nRemoving intermediate container 1ab6385235a1\n ---> b84d1eed9fcd\nStep 6/20 : WORKDIR /whisker-build/\n ---> Running in 63aae4016f9a\nRemoving intermediate container 63aae4016f9a\n ---> 2a21a8ab27f3\nStep 7/20 : COPY package.json ./\n ---> 98bf9c41030b\nStep 8/20 : COPY scratch-analysis/package.json ./scratch-analysis/\n ---> 3fb47e19e7af\nStep 9/20 : COPY servant/package.json ./servant/\n ---> 4b8d0013374b\nStep 10/20 : COPY whisker-web/package.json ./whisker-web/\n ---> 2179a5f07a39\nStep 11/20 : COPY whisker-main/package.json ./whisker-main/\n ---> 82e6aa3f3732\nStep 12/20 : COPY yarn.lock ./\n ---> 9f290b53695f\nStep 13/20 : RUN yarn install\n ---> Running in ce964e9ee8a6\nyarn install v1.22.17\n[1/4] Resolving packages...\n[2/4] Fetching packages...\n[3/4] Linking dependencies...\n\u001b[91mwarning \" > jest-puppeteer@6.1.1\" has unmet peer dependency \"puppeteer@>= 1.5.0\".\n\u001b[0m\u001b[91mwarning \" > optimize-css-assets-webpack-plugin@5.0.8\" has incorrect peer dependency \"webpack@^4.0.0\".\n\u001b[0m\u001b[91mwarning \" > ts-jest@28.0.6\" has unmet peer dependency \"@jest/types@^28.0.0\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-8e12913c-f7ff-4d99-b67d-5e5fa7175ab6 > whisker-web > scratch-storage > worker-loader@2.0.0\" has incorrect peer dependency \"webpack@^3.0.0 || ^4.0.0-alpha.0 || ^4.0.0\".\n\u001b[0m[4/4] Building fresh packages...\nDone in 54.73s.\nRemoving intermediate container ce964e9ee8a6\n ---> cb6f9822be44\nStep 14/20 : COPY ./ ./\n ---> cee14e848acb\nStep 15/20 : RUN yarn build     && yarn install --production\n ---> Running in 4d0cebd9e0cc\nyarn run v1.22.17\n$ yarn --cwd scratch-analysis build && yarn --cwd whisker-main build && yarn --cwd whisker-web build\n$ if [ -d dist ]; then rm -rf dist; fi && webpack --color --bail\n\u001b[91mBrowserslist: caniuse-lite is outdated. Please run:\n  npx update-browserslist-db@latest\n  Why you should do it regularly: https://github.com/browserslist/update-db#readme\n\u001b[0mwebpack compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m\n$ if [ -d dist ]; then rm -rf dist; fi && tsc --incremental && webpack --color --bail\n\u001b[91mBrowserslist: caniuse-lite is outdated. Please run:\n  npx update-browserslist-db@latest\n  Why you should do it regularly: https://github.com/browserslist/update-db#readme\n\u001b[0mwebpack compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m\n\nwebpack compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m\n$ if [ -d dist ]; then rm -rf dist; fi && webpack --color --bail\n\u001b[91mBrowserslist: caniuse-lite is outdated. Please run:\n  npx update-browserslist-db@latest\n  Why you should do it regularly: https://github.com/browserslist/update-db#readme\n\u001b[0m\u001b[91m(node:94) [DEP_WEBPACK_COMPILATION_CACHE] DeprecationWarning: Compilation.cache was removed in favor of Compilation.getCache()\n(Use `node --trace-deprecation ...` to show where the warning was created)\n\u001b[0m\u001b[91m(node:94) [DEP_WEBPACK_TEMPLATE_PATH_PLUGIN_REPLACE_PATH_VARIABLES_HASH] DeprecationWarning: [hash] is now [fullhash] (also consider using [chunkhash] or [contenthash], see documentation for details)\n(node:94) [DEP_WEBPACK_DEPRECATION_ARRAY_TO_SET_INDEXER] DeprecationWarning: chunk.files was changed from Array to Set (indexing Array is deprecated)\n\u001b[0mwebpack compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m\n\nwebpack compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m\nDone in 40.50s.\nyarn install v1.22.17\n[1/4] Resolving packages...\n[2/4] Fetching packages...\n[3/4] Linking dependencies...\n\u001b[91mwarning \" > jest-puppeteer@6.1.1\" has unmet peer dependency \"puppeteer@>= 1.5.0\".\n\u001b[0m\u001b[91mwarning \" > optimize-css-assets-webpack-plugin@5.0.8\" has incorrect peer dependency \"webpack@^4.0.0\".\n\u001b[0m\u001b[91mwarning \" > ts-jest@28.0.6\" has unmet peer dependency \"@jest/types@^28.0.0\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-79d8ef70-0bca-44d0-a7a5-6ca0b2a3ecb2 > whisker-web > scratch-storage > worker-loader@2.0.0\" has incorrect peer dependency \"webpack@^3.0.0 || ^4.0.0-alpha.0 || ^4.0.0\".\n\u001b[0m[4/4] Building fresh packages...\nDone in 8.88s.\nRemoving intermediate container 4d0cebd9e0cc\n ---> 40553d5c75a9\nStep 16/20 : FROM base as execute\n ---> 1a6fdb45a3cc\nStep 17/20 : ENV NODE_ENV=production\n ---> Running in 2b2c4d5331e7\nRemoving intermediate container 2b2c4d5331e7\n ---> 06e334de4f84\nStep 18/20 : COPY --from=build /whisker-build /whisker\n ---> 587551d5f2ba\nStep 19/20 : WORKDIR /whisker/servant/\n ---> Running in c166edc06531\nRemoving intermediate container c166edc06531\n ---> 8b63aaaf1e37\nStep 20/20 : ENTRYPOINT [\"tini\", \"--\", \"/whisker/servant/whisker-docker.sh\"]\n ---> Running in 72cfdf037f3f\nRemoving intermediate container 72cfdf037f3f\n ---> 3e07ed62e05f\nSuccessfully built 3e07ed62e05f\nSuccessfully tagged whisker:latest\n","stderr":"","imageSize":1156130489},"repair":{"startTime":1672855523857,"endTime":1672855524026,"violations":[{"name":"ruleAptGetInstallThenRemoveAptLists","position":{"start":58,"end":58,"columnStart":7,"columnEnd":76}},{"name":"ruleAptGetInstallThenRemoveAptLists","position":{"start":66,"end":66,"columnStart":7,"columnEnd":75}}],"repairedDockerfile":"################################################################################\n# Dockerfile to build a headless image of Whisker.\n# https://docs.docker.com/language/nodejs/build-images/#create-a-dockerfile-for-nodejs\n# https://nodejs.org/en/docs/guides/nodejs-docker-webapp/#creating-a-dockerfile\n#\n# This Dockerfile is organized as a multi-stage build, which enables us to\n# reduce the size of the final image while still allowing us to use intermediate\n# layers and files without regret.\n#\n# We have the following stages:\n# (1) Build stage:\n#     (a) Prepare base image\n#     (b) Install or update build/library dependencies (via apt)\n#     (c) Install or update build/library dependencies (via yarn)\n#     (d) Build Whisker from its sources and dependencies\n# (2) Execution stage:\n#     Only copy files necessary to run Whisker and set the entry point to\n#     Whisker's servant in headless mode\n#\n# Because an image is built during the final sub-stage (d) of the build stage we\n# can minimize the size of image layers by leveraging a build cache. The\n# sub-stages are ordered from the less frequently changed (to ensure the build\n# cache is not busted) to the more frequently changed.\n#\n# Note: if you need to modify or debug this Dockerfile, you can build the image\n# only up until one of the (sub)stages by specifying \"--target <stage name>\".\n# To inspect the contents of the container at a specific stage, stop building\n# at that stage and run the container in interactive mode:\n# `docker run -it --entrypoint /bin/sh <image name>`\n################################################################################\n\n\n#-------------------------------------------------------------------------------\n# (1) Build Stage\n#-------------------------------------------------------------------------------\n\n# To make sure we always use the same version of the base image, we specify the\n# desired digest of the image instead of a tag. Image tags are dynamic references,\n# and might change over time [1]. Tags of Node.JS along with their digests can be\n# found here [2]. The digest or tag to use can be overridden on the command line with\n# `--build-arg node_version=...`\n#\n# [1] https://www.ibm.com/docs/en/filenet-p8-platform/5.5.x?topic=deployment-choosing-image-tags-digests\n# [2] https://hub.docker.com/_/node?tab=tags\n#\n# Currently, this digest corresponds to the tag 16.14.0-bullseye-slim:\n# https://hub.docker.com/layers/satantime/puppeteer-node/16.14.0-bullseye-slim/images/sha256-bed240a3b8cd99af56a2971046201a26fba978804f55c296bde7f9b1075d19bc?context=explore\nARG version=@sha256:bed240a3b8cd99af56a2971046201a26fba978804f55c296bde7f9b1075d19bc\n\n# (a) We use a slim base image that already includes Node.JS and a minimal set\n#     of packages required to run Puppeteer (without packaging Puppeteer\n#     itself – we install the right version of Puppeteer later using yarn).\n#     We also need \"tini\".\nFROM satantime/puppeteer-node${version} as base\nRUN apt-get update \\\n    && apt-get install --no-install-recommends --no-install-suggests -y tini \\\n    && rm -rf /usr/share/icons && rm -rf /var/lib/apt/lists/*;\n\n# (b) Install packages only required to build Whisker, not to run it.\n#     We need git because we have a dependency to another git repository\n#     (the Scratch VM).\nFROM base as build\nRUN apt-get update \\\n    && apt-get install --no-install-recommends --no-install-suggests -y git && rm -rf /var/lib/apt/lists/*;\n\n# (c) Copy manifest files and install dependencies. This layer is only rebuilt\n#     when a manifest file changes.\n#     Unfortunately, we need a separate COPY command for every file because\n#     docker flattens the subdirectory structure when using wildcards.\nWORKDIR /whisker-build/\nCOPY package.json ./\nCOPY scratch-analysis/package.json ./scratch-analysis/\nCOPY servant/package.json ./servant/\nCOPY whisker-web/package.json ./whisker-web/\nCOPY whisker-main/package.json ./whisker-main/\nCOPY yarn.lock ./\nRUN yarn install\n\n# (d) Copy source files (as governed by .dockerignore), build Whisker and drop\n#     build dependencies from the node_modules folder, keeping only the ones\n#     necessary for execution. This layer is only rebuilt when a source file\n#     changes.\nCOPY ./ ./\nRUN yarn build \\\n    && yarn install --production\n\n\n#-------------------------------------------------------------------------------\n# (2) Execution Stage\n#-------------------------------------------------------------------------------\n\n# We use the base image again to drop build dependencies (installed via `apt-get`)\n# and the yarn build cache from the final image.\nFROM base as execute\n\n# Signal Node.JS that we are running in a production environment. This leads to some\n# differences compared to a development environment [1], such as logging and caching.\n# Note: Environment variables set with ENV persist [2] (they are still set when running\n# the container from the built image), in contrast to ARG [3] (it does not persist).\n#\n# [1] https://nodejs.dev/learn/nodejs-the-difference-between-development-and-production\n# [2] https://docs.docker.com/engine/reference/builder/#env\n# [3] https://docs.docker.com/engine/reference/builder/#arg\nENV NODE_ENV=production\n\n# Copy the build of Whisker from the build layer to the execution layer.\n# (devDependencies have already been excluded from the node_modules folder.)\nCOPY --from=build /whisker-build /whisker\n\n# Whisker's servant requires this as working directory, as it uses relative\n# and not absolute paths:\nWORKDIR /whisker/servant/\n\n# Set the image's main command, allowing the image to be run as though it was\n# that command. We use a wrapper script instead of invoking Whisker directly.\n# The script makes sure Whisker runs in headless mode, forwards console output,\n# etc. It uses the `exec` bash command [1] so that Whisker is not spawned as\n# child process of the wrapper script, but instead takes over the current process,\n# making it the container's PID 1. This is important as Unix signals (such as\n# SIGINT) sent to the container would otherwise not be received by the\n# application [2]. Yet, a Node.JS application only responds to signals when\n# **NOT** running as PID 1 [3]. Thus, we use a leightweight init system called\n# \"tini\" as entrypoint [4] that spawns Whisker as child process and forwards\n# all signals properly.\n#\n# [1] https://wiki.bash-hackers.org/commands/builtin/exec\n# [2] https://docs.docker.com/develop/develop-images/dockerfile_best-practices/#entrypoint\n# [3] https://github.com/nodejs/docker-node/blob/main/docs/BestPractices.md#handling-kernel-signals\n# [4] https://github.com/krallin/tini#existing-entrypoint\nENTRYPOINT [\"tini\", \"--\", \"/whisker/servant/whisker-docker.sh\"]\n\n"},"repairedBuild":{"startTime":1672855526580,"endTime":1672856088667,"error":null,"stdout":"Sending build context to Docker daemon  2.728MB\r\r\nStep 1/20 : ARG version=@sha256:bed240a3b8cd99af56a2971046201a26fba978804f55c296bde7f9b1075d19bc\nStep 2/20 : FROM satantime/puppeteer-node${version} as base\n ---> 09c41718d4ea\nStep 3/20 : RUN apt-get update     && apt-get install --no-install-recommends --no-install-suggests -y tini     && rm -rf /usr/share/icons && rm -rf /var/lib/apt/lists/*;\n ---> Running in 85a363e1e67d\nGet:1 http://security.debian.org/debian-security bullseye-security InRelease [48.4 kB]\nGet:2 http://deb.debian.org/debian bullseye InRelease [116 kB]\nGet:3 http://deb.debian.org/debian bullseye-updates InRelease [44.1 kB]\nGet:4 http://security.debian.org/debian-security bullseye-security/main amd64 Packages [210 kB]\nGet:5 http://deb.debian.org/debian bullseye/main amd64 Packages [8183 kB]\nGet:6 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [14.6 kB]\nFetched 8616 kB in 2s (5213 kB/s)\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nThe following NEW packages will be installed:\n  tini\n0 upgraded, 1 newly installed, 0 to remove and 50 not upgraded.\nNeed to get 255 kB of archives.\nAfter this operation, 776 kB of additional disk space will be used.\nGet:1 http://deb.debian.org/debian bullseye/main amd64 tini amd64 0.19.0-1 [255 kB]\n\u001b[91mdebconf: delaying package configuration, since apt-utils is not installed\n\u001b[0mFetched 255 kB in 0s (10.9 MB/s)\nSelecting previously unselected package tini.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 17917 files and directories currently installed.)\r\nPreparing to unpack .../tini_0.19.0-1_amd64.deb ...\r\nUnpacking tini (0.19.0-1) ...\r\nSetting up tini (0.19.0-1) ...\r\nRemoving intermediate container 85a363e1e67d\n ---> 89e4837b5982\nStep 4/20 : FROM base as build\n ---> 89e4837b5982\nStep 5/20 : RUN apt-get update     && apt-get install --no-install-recommends --no-install-suggests -y git && rm -rf /var/lib/apt/lists/*;\n ---> Running in c2adb8d8df46\nGet:1 http://deb.debian.org/debian bullseye InRelease [116 kB]\nGet:2 http://deb.debian.org/debian bullseye-updates InRelease [44.1 kB]\nGet:3 http://security.debian.org/debian-security bullseye-security InRelease [48.4 kB]\nGet:4 http://deb.debian.org/debian bullseye/main amd64 Packages [8183 kB]\nGet:5 http://deb.debian.org/debian bullseye-updates/main amd64 Packages [14.6 kB]\nGet:6 http://security.debian.org/debian-security bullseye-security/main amd64 Packages [210 kB]\nFetched 8616 kB in 2s (5500 kB/s)\nReading package lists...\nReading package lists...\nBuilding dependency tree...\nReading state information...\nThe following additional packages will be installed:\n  git-man libcurl3-gnutls liberror-perl libgdbm-compat4 libgdbm6 libnghttp2-14\n  libperl5.32 librtmp1 libssh2-1 perl perl-modules-5.32\nSuggested packages:\n  gettext-base git-daemon-run | git-daemon-sysvinit git-doc git-el git-email\n  git-gui gitk gitweb git-cvs git-mediawiki git-svn gdbm-l10n perl-doc\n  libterm-readline-gnu-perl | libterm-readline-perl-perl make\n  libtap-harness-archive-perl\nRecommended packages:\n  patch less ssh-client netbase\nThe following NEW packages will be installed:\n  git git-man libcurl3-gnutls liberror-perl libgdbm-compat4 libgdbm6\n  libnghttp2-14 libperl5.32 librtmp1 libssh2-1 perl perl-modules-5.32\n0 upgraded, 12 newly installed, 0 to remove and 50 not upgraded.\nNeed to get 15.4 MB of archives.\nAfter this operation, 86.6 MB of additional disk space will be used.\nGet:1 http://deb.debian.org/debian bullseye/main amd64 perl-modules-5.32 all 5.32.1-4+deb11u2 [2823 kB]\nGet:2 http://deb.debian.org/debian bullseye/main amd64 libgdbm6 amd64 1.19-2 [64.9 kB]\nGet:3 http://deb.debian.org/debian bullseye/main amd64 libgdbm-compat4 amd64 1.19-2 [44.7 kB]\nGet:4 http://deb.debian.org/debian bullseye/main amd64 libperl5.32 amd64 5.32.1-4+deb11u2 [4106 kB]\nGet:5 http://deb.debian.org/debian bullseye/main amd64 perl amd64 5.32.1-4+deb11u2 [293 kB]\nGet:6 http://deb.debian.org/debian bullseye/main amd64 libnghttp2-14 amd64 1.43.0-1 [77.1 kB]\nGet:7 http://deb.debian.org/debian bullseye/main amd64 librtmp1 amd64 2.4+20151223.gitfa8646d.1-2+b2 [60.8 kB]\nGet:8 http://deb.debian.org/debian bullseye/main amd64 libssh2-1 amd64 1.9.0-2 [156 kB]\nGet:9 http://deb.debian.org/debian bullseye/main amd64 libcurl3-gnutls amd64 7.74.0-1.3+deb11u3 [342 kB]\nGet:10 http://deb.debian.org/debian bullseye/main amd64 liberror-perl all 0.17029-1 [31.0 kB]\nGet:11 http://deb.debian.org/debian bullseye/main amd64 git-man all 1:2.30.2-1 [1827 kB]\nGet:12 http://deb.debian.org/debian bullseye/main amd64 git amd64 1:2.30.2-1 [5527 kB]\n\u001b[91mdebconf: delaying package configuration, since apt-utils is not installed\n\u001b[0mFetched 15.4 MB in 1s (23.1 MB/s)\nSelecting previously unselected package perl-modules-5.32.\r\n(Reading database ... \r(Reading database ... 5%\r(Reading database ... 10%\r(Reading database ... 15%\r(Reading database ... 20%\r(Reading database ... 25%\r(Reading database ... 30%\r(Reading database ... 35%\r(Reading database ... 40%\r(Reading database ... 45%\r(Reading database ... 50%\r(Reading database ... 55%\r(Reading database ... 60%\r(Reading database ... 65%\r(Reading database ... 70%\r(Reading database ... 75%\r(Reading database ... 80%\r(Reading database ... 85%\r(Reading database ... 90%\r(Reading database ... 95%\r(Reading database ... 100%\r(Reading database ... 17922 files and directories currently installed.)\r\nPreparing to unpack .../00-perl-modules-5.32_5.32.1-4+deb11u2_all.deb ...\r\nUnpacking perl-modules-5.32 (5.32.1-4+deb11u2) ...\r\nSelecting previously unselected package libgdbm6:amd64.\r\nPreparing to unpack .../01-libgdbm6_1.19-2_amd64.deb ...\r\nUnpacking libgdbm6:amd64 (1.19-2) ...\r\nSelecting previously unselected package libgdbm-compat4:amd64.\r\nPreparing to unpack .../02-libgdbm-compat4_1.19-2_amd64.deb ...\r\nUnpacking libgdbm-compat4:amd64 (1.19-2) ...\r\nSelecting previously unselected package libperl5.32:amd64.\r\nPreparing to unpack .../03-libperl5.32_5.32.1-4+deb11u2_amd64.deb ...\r\nUnpacking libperl5.32:amd64 (5.32.1-4+deb11u2) ...\r\nSelecting previously unselected package perl.\r\nPreparing to unpack .../04-perl_5.32.1-4+deb11u2_amd64.deb ...\r\nUnpacking perl (5.32.1-4+deb11u2) ...\r\nSelecting previously unselected package libnghttp2-14:amd64.\r\nPreparing to unpack .../05-libnghttp2-14_1.43.0-1_amd64.deb ...\r\nUnpacking libnghttp2-14:amd64 (1.43.0-1) ...\r\nSelecting previously unselected package librtmp1:amd64.\r\nPreparing to unpack .../06-librtmp1_2.4+20151223.gitfa8646d.1-2+b2_amd64.deb ...\r\nUnpacking librtmp1:amd64 (2.4+20151223.gitfa8646d.1-2+b2) ...\r\nSelecting previously unselected package libssh2-1:amd64.\r\nPreparing to unpack .../07-libssh2-1_1.9.0-2_amd64.deb ...\r\nUnpacking libssh2-1:amd64 (1.9.0-2) ...\r\nSelecting previously unselected package libcurl3-gnutls:amd64.\r\nPreparing to unpack .../08-libcurl3-gnutls_7.74.0-1.3+deb11u3_amd64.deb ...\r\nUnpacking libcurl3-gnutls:amd64 (7.74.0-1.3+deb11u3) ...\r\nSelecting previously unselected package liberror-perl.\r\nPreparing to unpack .../09-liberror-perl_0.17029-1_all.deb ...\r\nUnpacking liberror-perl (0.17029-1) ...\r\nSelecting previously unselected package git-man.\r\nPreparing to unpack .../10-git-man_1%3a2.30.2-1_all.deb ...\r\nUnpacking git-man (1:2.30.2-1) ...\r\nSelecting previously unselected package git.\r\nPreparing to unpack .../11-git_1%3a2.30.2-1_amd64.deb ...\r\nUnpacking git (1:2.30.2-1) ...\r\nSetting up perl-modules-5.32 (5.32.1-4+deb11u2) ...\r\nSetting up libnghttp2-14:amd64 (1.43.0-1) ...\r\nSetting up librtmp1:amd64 (2.4+20151223.gitfa8646d.1-2+b2) ...\r\nSetting up git-man (1:2.30.2-1) ...\r\nSetting up libssh2-1:amd64 (1.9.0-2) ...\r\nSetting up libgdbm6:amd64 (1.19-2) ...\r\nSetting up libcurl3-gnutls:amd64 (7.74.0-1.3+deb11u3) ...\r\nSetting up libgdbm-compat4:amd64 (1.19-2) ...\r\nSetting up libperl5.32:amd64 (5.32.1-4+deb11u2) ...\r\nSetting up perl (5.32.1-4+deb11u2) ...\r\nSetting up liberror-perl (0.17029-1) ...\r\nSetting up git (1:2.30.2-1) ...\r\nProcessing triggers for libc-bin (2.31-13+deb11u2) ...\r\nRemoving intermediate container c2adb8d8df46\n ---> b473e4565017\nStep 6/20 : WORKDIR /whisker-build/\n ---> Running in 6d422fc79f64\nRemoving intermediate container 6d422fc79f64\n ---> 384e1d574bcc\nStep 7/20 : COPY package.json ./\n ---> 92657fb6bb24\nStep 8/20 : COPY scratch-analysis/package.json ./scratch-analysis/\n ---> 82ee079c1379\nStep 9/20 : COPY servant/package.json ./servant/\n ---> 601de5902094\nStep 10/20 : COPY whisker-web/package.json ./whisker-web/\n ---> a662e5eb4466\nStep 11/20 : COPY whisker-main/package.json ./whisker-main/\n ---> e8e63cb0a912\nStep 12/20 : COPY yarn.lock ./\n ---> 4f67e885ab60\nStep 13/20 : RUN yarn install\n ---> Running in 52950bfc70f1\nyarn install v1.22.17\n[1/4] Resolving packages...\n[2/4] Fetching packages...\n[3/4] Linking dependencies...\n\u001b[91mwarning \" > jest-puppeteer@6.1.1\" has unmet peer dependency \"puppeteer@>= 1.5.0\".\n\u001b[0m\u001b[91mwarning \" > optimize-css-assets-webpack-plugin@5.0.8\" has incorrect peer dependency \"webpack@^4.0.0\".\n\u001b[0m\u001b[91mwarning \" > ts-jest@28.0.6\" has unmet peer dependency \"@jest/types@^28.0.0\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-7aa37ce3-c5bf-4952-8fd8-14ea1931460d > whisker-web > scratch-storage > worker-loader@2.0.0\" has incorrect peer dependency \"webpack@^3.0.0 || ^4.0.0-alpha.0 || ^4.0.0\".\n\u001b[0m[4/4] Building fresh packages...\nDone in 104.39s.\nRemoving intermediate container 52950bfc70f1\n ---> f10577e93ac8\nStep 14/20 : COPY ./ ./\n ---> af70efb292fb\nStep 15/20 : RUN yarn build     && yarn install --production\n ---> Running in 26a95209c77c\nyarn run v1.22.17\n$ yarn --cwd scratch-analysis build && yarn --cwd whisker-main build && yarn --cwd whisker-web build\n$ if [ -d dist ]; then rm -rf dist; fi && webpack --color --bail\n\u001b[91mBrowserslist: caniuse-lite is outdated. Please run:\n  npx update-browserslist-db@latest\n  Why you should do it regularly: https://github.com/browserslist/update-db#readme\n\u001b[0mwebpack compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m\n$ if [ -d dist ]; then rm -rf dist; fi && tsc --incremental && webpack --color --bail\n\u001b[91mBrowserslist: caniuse-lite is outdated. Please run:\n  npx update-browserslist-db@latest\n  Why you should do it regularly: https://github.com/browserslist/update-db#readme\n\u001b[0mwebpack compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m\n\nwebpack compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m\n$ if [ -d dist ]; then rm -rf dist; fi && webpack --color --bail\n\u001b[91mBrowserslist: caniuse-lite is outdated. Please run:\n  npx update-browserslist-db@latest\n  Why you should do it regularly: https://github.com/browserslist/update-db#readme\n\u001b[0m\u001b[91m(node:94) [DEP_WEBPACK_COMPILATION_CACHE] DeprecationWarning: Compilation.cache was removed in favor of Compilation.getCache()\n(Use `node --trace-deprecation ...` to show where the warning was created)\n\u001b[0m\u001b[91m(node:94) [DEP_WEBPACK_TEMPLATE_PATH_PLUGIN_REPLACE_PATH_VARIABLES_HASH] DeprecationWarning: [hash] is now [fullhash] (also consider using [chunkhash] or [contenthash], see documentation for details)\n(node:94) [DEP_WEBPACK_DEPRECATION_ARRAY_TO_SET_INDEXER] DeprecationWarning: chunk.files was changed from Array to Set (indexing Array is deprecated)\n\u001b[0mwebpack compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m\n\nwebpack compiled \u001b[1m\u001b[32msuccessfully\u001b[39m\u001b[22m\nDone in 39.58s.\nyarn install v1.22.17\n[1/4] Resolving packages...\n[2/4] Fetching packages...\n[3/4] Linking dependencies...\n\u001b[91mwarning \" > jest-puppeteer@6.1.1\" has unmet peer dependency \"puppeteer@>= 1.5.0\".\n\u001b[0m\u001b[91mwarning \" > optimize-css-assets-webpack-plugin@5.0.8\" has incorrect peer dependency \"webpack@^4.0.0\".\n\u001b[0m\u001b[91mwarning \" > ts-jest@28.0.6\" has unmet peer dependency \"@jest/types@^28.0.0\".\n\u001b[0m\u001b[91mwarning \"workspace-aggregator-a104ad72-e3b8-4e1d-b61c-2da93ebbdc14 > whisker-web > scratch-storage > worker-loader@2.0.0\" has incorrect peer dependency \"webpack@^3.0.0 || ^4.0.0-alpha.0 || ^4.0.0\".\n\u001b[0m[4/4] Building fresh packages...\nDone in 6.93s.\nRemoving intermediate container 26a95209c77c\n ---> 7a3bb1f1dc3f\nStep 16/20 : FROM base as execute\n ---> 89e4837b5982\nStep 17/20 : ENV NODE_ENV=production\n ---> Running in 1c2b4c3a96f9\nRemoving intermediate container 1c2b4c3a96f9\n ---> f303153f616e\nStep 18/20 : COPY --from=build /whisker-build /whisker\n ---> bd13351f05da\nStep 19/20 : WORKDIR /whisker/servant/\n ---> Running in 200fb3b68276\nRemoving intermediate container 200fb3b68276\n ---> 6ff13632ff64\nStep 20/20 : ENTRYPOINT [\"tini\", \"--\", \"/whisker/servant/whisker-docker.sh\"]\n ---> Running in a1da80b24a79\nRemoving intermediate container a1da80b24a79\n ---> c789f5962422\nSuccessfully built c789f5962422\nSuccessfully tagged whisker:latest\n","stderr":"","imageSize":1138171669}}