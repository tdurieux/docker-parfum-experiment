{"repository":"https://github.com/ohmyform/api","dockerfilePath":"Dockerfile","startTime":1672710946395,"clone":{"stdout":"","stderr":"Cloning into '/tmp/dinghy-analysis/ohmyform/api'...\n","error":null,"commit":"c2c421baa6f41e4e6fb812fa2978956aaf7aa0dd"},"originalBuild":{"startTimestamp":1672710947288,"endTimestamp":1672711275871,"error":null,"stdout":"Sending build context to Docker daemon  892.9kB\r\r\nStep 1/20 : FROM node:14-alpine AS builder\n14-alpine: Pulling from library/node\nc158987b0551: Already exists\n859c8d0e9faf: Pulling fs layer\n69c317f5cbe1: Pulling fs layer\nd0c4a6a4173f: Pulling fs layer\nd0c4a6a4173f: Verifying Checksum\nd0c4a6a4173f: Download complete\n69c317f5cbe1: Verifying Checksum\n69c317f5cbe1: Download complete\n859c8d0e9faf: Verifying Checksum\n859c8d0e9faf: Download complete\n859c8d0e9faf: Pull complete\n69c317f5cbe1: Pull complete\nd0c4a6a4173f: Pull complete\nDigest: sha256:80e825b1f5ab859498a2f0f98f8197131a562906e5f8c95977057502e68ca05a\nStatus: Downloaded newer image for node:14-alpine\n ---> fb7170aa2b9b\nStep 2/20 : MAINTAINER OhMyForm <admin@ohmyform.com>\n ---> Running in 035e74aa8675\nRemoving intermediate container 035e74aa8675\n ---> 9890075f729f\nStep 3/20 : WORKDIR /usr/src/app\n ---> Running in 6a2af67b62b5\nRemoving intermediate container 6a2af67b62b5\n ---> d68ed1bea19d\nStep 4/20 : RUN apk update && apk add curl bash && rm -rf /var/cache/apk/*\n ---> Running in 11b1c54e3652\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\nv3.17.0-320-g38723e0931 [https://dl-cdn.alpinelinux.org/alpine/v3.17/main]\nv3.17.0-320-g38723e0931 [https://dl-cdn.alpinelinux.org/alpine/v3.17/community]\nOK: 17813 distinct packages available\n(1/9) Installing ncurses-terminfo-base (6.3_p20221119-r0)\n(2/9) Installing ncurses-libs (6.3_p20221119-r0)\n(3/9) Installing readline (8.2.0-r0)\n(4/9) Installing bash (5.2.15-r0)\nExecuting bash-5.2.15-r0.post-install\n(5/9) Installing ca-certificates (20220614-r3)\n(6/9) Installing brotli-libs (1.0.9-r9)\n(7/9) Installing nghttp2-libs (1.51.0-r0)\n(8/9) Installing libcurl (7.87.0-r0)\n(9/9) Installing curl (7.87.0-r0)\nExecuting busybox-1.35.0-r29.trigger\nExecuting ca-certificates-20220614-r3.trigger\nOK: 14 MiB in 26 packages\nRemoving intermediate container 11b1c54e3652\n ---> 3db121c72907\nStep 5/20 : RUN curl -sf https://gobinaries.com/tj/node-prune | sh\n ---> Running in 7dd631c2293d\n\n\u001b[38;5;61m  ==>\u001b[0;00m Downloading github.com/tj/node-prune@master\n\u001b[38;5;61m  ==>\u001b[0;00m Resolved version master to v1.2.0\n\u001b[38;5;61m  ==>\u001b[0;00m Downloading binary for linux amd64\n\u001b[38;5;61m  ==>\u001b[0;00m Installing node-prune to /usr/local/bin\n\u001b[38;5;61m  ==>\u001b[0;00m Installation complete\n\nRemoving intermediate container 7dd631c2293d\n ---> 6495e92d1856\nStep 6/20 : COPY . .\n ---> 3019cc2a97b9\nStep 7/20 : RUN touch /usr/src/app/src/schema.gql && chown 9999:9999 /usr/src/app/src/schema.gql\n ---> Running in 3d68f5442045\nRemoving intermediate container 3d68f5442045\n ---> 43560c59a34a\nStep 8/20 : RUN yarn install --frozen-lockfile\n ---> Running in 890232ca9328\nyarn install v1.22.19\n[1/4] Resolving packages...\n[2/4] Fetching packages...\n[3/4] Linking dependencies...\n\u001b[91mwarning \" > @nestjs-modules/mailer@1.6.1\" has unmet peer dependency \"@types/ejs@^3.0.3\".\nwarning \" > @nestjs-modules/mailer@1.6.1\" has unmet peer dependency \"@types/pug@2.0.5\".\n\u001b[0m\u001b[91mwarning \" > @nestjs-modules/mailer@1.6.1\" has unmet peer dependency \"ejs@^3.1.2\".\n\u001b[0m\u001b[91mwarning \" > @nestjs-modules/mailer@1.6.1\" has unmet peer dependency \"pug@^2.0.4\".\n\u001b[0m\u001b[91mwarning \" > apollo-server-express@3.6.3\" has unmet peer dependency \"express@^4.17.1\".\n\u001b[0m\u001b[91mwarning \" > ts-loader@9.2.6\" has unmet peer dependency \"webpack@^5.0.0\".\n\u001b[0m[4/4] Building fresh packages...\nDone in 69.52s.\nRemoving intermediate container 890232ca9328\n ---> 407e3b570484\nStep 9/20 : RUN yarn build\n ---> Running in 808865e2ff9e\nyarn run v1.22.19\n$ rimraf dist\n$ nest build\nDone in 9.68s.\nRemoving intermediate container 808865e2ff9e\n ---> 7196e66c1ca4\nStep 10/20 : RUN npm prune --production\n ---> Running in d2676f097b6c\n\u001b[91mnpm WARN \u001b[0m\u001b[91mrm not removing /usr/src/app/node_modules/.bin/esgenerate as it wasn't installed by /usr/src/app/node_modules/escodegen\n\u001b[0m\u001b[91mnpm\u001b[0m\u001b[91m WARN\u001b[0m\u001b[91m rm not removing /usr/src/app/node_modules/.bin/escodegen as it wasn't installed by /usr/src/app/node_modules/escodegen\n\u001b[0m\u001b[91mnpm WARN @nestjs-modules/mailer@1.6.1 requires a peer of pug@^2.0.4 but none is installed. You must install peer dependencies yourself.\n\u001b[0m\u001b[91mnpm WARN ohmyform-api@1.0.3 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0mremoved 582 packages and audited 818 packages in 10.119s\n\n68 packages are looking for funding\n  run `npm fund` for details\n\nfound 40 vulnerabilities (6 moderate, 28 high, 6 critical)\n  run `npm audit fix` to fix them, or `npm audit` for details\nRemoving intermediate container d2676f097b6c\n ---> d281b80f3b48\nStep 11/20 : RUN /usr/local/bin/node-prune\n ---> Running in 8184ccf1310e\n\u001b[91m\n\n\u001b[0m\u001b[1m         files total\u001b[0m 27,570\n\u001b[1m       files removed\u001b[0m 8,173\n\u001b[1m        size removed\u001b[0m 36 MB\n\u001b[1m            duration\u001b[0m 718ms\nRemoving intermediate container 8184ccf1310e\n ---> 26815c6b94bb\nStep 12/20 : FROM node:14-alpine\n ---> fb7170aa2b9b\nStep 13/20 : MAINTAINER OhMyForm <admin@ohmyform.com>\n ---> Running in a84d03b3b433\nRemoving intermediate container a84d03b3b433\n ---> 763fd0aa788e\nStep 14/20 : RUN addgroup --gid 9999 ohmyform && adduser -D --uid 9999 -G ohmyform ohmyform\n ---> Running in 0e0c3c4e3b76\nRemoving intermediate container 0e0c3c4e3b76\n ---> e9c514267cb1\nStep 15/20 : WORKDIR /usr/src/app\n ---> Running in 7a7b13506d1e\nRemoving intermediate container 7a7b13506d1e\n ---> 33baad466d27\nStep 16/20 : COPY --from=builder /usr/src/app /usr/src/app\n ---> 2f77378bf8e3\nStep 17/20 : ENV PORT=3000     SECRET_KEY=ChangeMe     CREATE_ADMIN=FALSE     ADMIN_EMAIL=admin@ohmyform.com     ADMIN_USERNAME=root     ADMIN_PASSWORD=root     NODE_ENV=production\n ---> Running in 8d636e9d1530\nRemoving intermediate container 8d636e9d1530\n ---> 5a6277489e20\nStep 18/20 : EXPOSE 3000\n ---> Running in 380d4554a187\nRemoving intermediate container 380d4554a187\n ---> 081478ba7d61\nStep 19/20 : USER ohmyform\n ---> Running in 5499b63b3d7c\nRemoving intermediate container 5499b63b3d7c\n ---> 0326f26eb1f7\nStep 20/20 : CMD [ \"yarn\", \"start:prod\" ]\n ---> Running in bf35e47d018e\nRemoving intermediate container bf35e47d018e\n ---> 7ead28b53498\nSuccessfully built 7ead28b53498\nSuccessfully tagged api:latest\n","stderr":"","imageSize":216066861},"repair":{"violations":[{"name":"apkAddUseNoCache","position":{"start":5,"end":5,"columnStart":18,"columnEnd":35}}],"repairedDockerfile":"FROM node:14-alpine AS builder\nMAINTAINER OhMyForm <admin@ohmyform.com>\n\nWORKDIR /usr/src/app\n\nRUN apk update && apk add --no-cache curl bash && rm -rf /var/cache/apk/*\n\n# install node-prune (https://github.com/tj/node-prune)\nRUN curl -sf https://gobinaries.com/tj/node-prune | sh\n\n# just copy everhing\nCOPY . .\n\nRUN touch /usr/src/app/src/schema.gql && chown 9999:9999 /usr/src/app/src/schema.gql\n\nRUN yarn install --frozen-lockfile\nRUN yarn build\n\n# remove development dependencies\nRUN npm prune --production\n\n# run node prune\nRUN /usr/local/bin/node-prune\n\nFROM node:14-alpine\nMAINTAINER OhMyForm <admin@ohmyform.com>\n\n# Create a group and a user with name \"ohmyform\".\nRUN addgroup --gid 9999 ohmyform && adduser -D --uid 9999 -G ohmyform ohmyform\n\nWORKDIR /usr/src/app\n\nCOPY --from=builder /usr/src/app /usr/src/app\n\nENV PORT=3000 \\\n    SECRET_KEY=ChangeMe \\\n    CREATE_ADMIN=FALSE \\\n    ADMIN_EMAIL=admin@ohmyform.com \\\n    ADMIN_USERNAME=root \\\n    ADMIN_PASSWORD=root \\\n    NODE_ENV=production\n\n\nEXPOSE 3000\n\n# Change to non-root privilege\nUSER ohmyform\n\nCMD [ \"yarn\", \"start:prod\" ]\n"},"repairedBuild":{"startTimestamp":1672711276554,"endTimestamp":1672711514237,"error":null,"stdout":"Sending build context to Docker daemon  892.9kB\r\r\nStep 1/20 : FROM node:14-alpine AS builder\n ---> fb7170aa2b9b\nStep 2/20 : MAINTAINER OhMyForm <admin@ohmyform.com>\n ---> Running in 60ed190670be\nRemoving intermediate container 60ed190670be\n ---> fda903ec131c\nStep 3/20 : WORKDIR /usr/src/app\n ---> Running in f66b3dd5a919\nRemoving intermediate container f66b3dd5a919\n ---> 4e8666dbab3a\nStep 4/20 : RUN apk update && apk add --no-cache curl bash && rm -rf /var/cache/apk/*\n ---> Running in c005c567ab2a\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\nv3.17.0-320-g38723e0931 [https://dl-cdn.alpinelinux.org/alpine/v3.17/main]\nv3.17.0-320-g38723e0931 [https://dl-cdn.alpinelinux.org/alpine/v3.17/community]\nOK: 17813 distinct packages available\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/main/x86_64/APKINDEX.tar.gz\nfetch https://dl-cdn.alpinelinux.org/alpine/v3.17/community/x86_64/APKINDEX.tar.gz\n(1/9) Installing ncurses-terminfo-base (6.3_p20221119-r0)\n(2/9) Installing ncurses-libs (6.3_p20221119-r0)\n(3/9) Installing readline (8.2.0-r0)\n(4/9) Installing bash (5.2.15-r0)\nExecuting bash-5.2.15-r0.post-install\n(5/9) Installing ca-certificates (20220614-r3)\n(6/9) Installing brotli-libs (1.0.9-r9)\n(7/9) Installing nghttp2-libs (1.51.0-r0)\n(8/9) Installing libcurl (7.87.0-r0)\n(9/9) Installing curl (7.87.0-r0)\nExecuting busybox-1.35.0-r29.trigger\nExecuting ca-certificates-20220614-r3.trigger\nOK: 14 MiB in 26 packages\nRemoving intermediate container c005c567ab2a\n ---> 749475da6c90\nStep 5/20 : RUN curl -sf https://gobinaries.com/tj/node-prune | sh\n ---> Running in e1eb67596faa\n\n\u001b[38;5;61m  ==>\u001b[0;00m Downloading github.com/tj/node-prune@master\n\u001b[38;5;61m  ==>\u001b[0;00m Resolved version master to v1.2.0\n\u001b[38;5;61m  ==>\u001b[0;00m Downloading binary for linux amd64\n\u001b[38;5;61m  ==>\u001b[0;00m Installing node-prune to /usr/local/bin\n\u001b[38;5;61m  ==>\u001b[0;00m Installation complete\n\nRemoving intermediate container e1eb67596faa\n ---> 615fdb0b0642\nStep 6/20 : COPY . .\n ---> 6588fcf7eef2\nStep 7/20 : RUN touch /usr/src/app/src/schema.gql && chown 9999:9999 /usr/src/app/src/schema.gql\n ---> Running in be485ddd9256\nRemoving intermediate container be485ddd9256\n ---> 42ab9d16e2a3\nStep 8/20 : RUN yarn install --frozen-lockfile\n ---> Running in 1bfb35cc47e3\nyarn install v1.22.19\n[1/4] Resolving packages...\n[2/4] Fetching packages...\n[3/4] Linking dependencies...\n\u001b[91mwarning \" > @nestjs-modules/mailer@1.6.1\" has unmet peer dependency \"@types/ejs@^3.0.3\".\nwarning \" > @nestjs-modules/mailer@1.6.1\" has unmet peer dependency \"@types/pug@2.0.5\".\n\u001b[0m\u001b[91mwarning \" > @nestjs-modules/mailer@1.6.1\" has unmet peer dependency \"ejs@^3.1.2\".\n\u001b[0m\u001b[91mwarning \" > @nestjs-modules/mailer@1.6.1\" has unmet peer dependency \"pug@^2.0.4\".\n\u001b[0m\u001b[91mwarning \" > apollo-server-express@3.6.3\" has unmet peer dependency \"express@^4.17.1\".\n\u001b[0m\u001b[91mwarning \" > ts-loader@9.2.6\" has unmet peer dependency \"webpack@^5.0.0\".\n\u001b[0m[4/4] Building fresh packages...\nDone in 56.08s.\nRemoving intermediate container 1bfb35cc47e3\n ---> 7fd906a6be6c\nStep 9/20 : RUN yarn build\n ---> Running in ae724234c0d4\nyarn run v1.22.19\n$ rimraf dist\n$ nest build\nDone in 8.19s.\nRemoving intermediate container ae724234c0d4\n ---> 82bb56864a33\nStep 10/20 : RUN npm prune --production\n ---> Running in e505b7f7465d\n\u001b[91mnpm\u001b[0m\u001b[91m WARN \u001b[0m\u001b[91mrm\u001b[0m\u001b[91m not removing /usr/src/app/node_modules/.bin/esgenerate as it wasn't installed by /usr/src/app/node_modules/escodegen\n\u001b[0m\u001b[91mnpm \u001b[0m\u001b[91mWARN\u001b[0m\u001b[91m rm not removing /usr/src/app/node_modules/.bin/escodegen as it wasn't installed by /usr/src/app/node_modules/escodegen\n\u001b[0m\u001b[91mnpm\u001b[0m\u001b[91m WARN @nestjs-modules/mailer@1.6.1 requires a peer of pug@^2.0.4 but none is installed. You must install peer dependencies yourself.\n\u001b[0m\u001b[91mnpm WARN ohmyform-api@1.0.3 No repository field.\n\u001b[0m\u001b[91m\n\u001b[0mremoved 582 packages and audited 818 packages in 10.881s\n\n68 packages are looking for funding\n  run `npm fund` for details\n\nfound 40 vulnerabilities (6 moderate, 28 high, 6 critical)\n  run `npm audit fix` to fix them, or `npm audit` for details\nRemoving intermediate container e505b7f7465d\n ---> 7b80d0102651\nStep 11/20 : RUN /usr/local/bin/node-prune\n ---> Running in 3236fba87b90\n\u001b[91m\n\n\u001b[0m\u001b[1m         files total\u001b[0m 27,570\n\u001b[1m       files removed\u001b[0m 8,173\n\u001b[1m        size removed\u001b[0m 36 MB\n\u001b[1m            duration\u001b[0m 1.135s\nRemoving intermediate container 3236fba87b90\n ---> bc356ea79a38\nStep 12/20 : FROM node:14-alpine\n ---> fb7170aa2b9b\nStep 13/20 : MAINTAINER OhMyForm <admin@ohmyform.com>\n ---> Running in 164d8d8ab80a\nRemoving intermediate container 164d8d8ab80a\n ---> 9016b86fa8bf\nStep 14/20 : RUN addgroup --gid 9999 ohmyform && adduser -D --uid 9999 -G ohmyform ohmyform\n ---> Running in 131e435892d4\nRemoving intermediate container 131e435892d4\n ---> 04b5034d68b3\nStep 15/20 : WORKDIR /usr/src/app\n ---> Running in c7791b8a39b7\nRemoving intermediate container c7791b8a39b7\n ---> 7fe4dab3a4d9\nStep 16/20 : COPY --from=builder /usr/src/app /usr/src/app\n ---> a1444a9cb72f\nStep 17/20 : ENV PORT=3000     SECRET_KEY=ChangeMe     CREATE_ADMIN=FALSE     ADMIN_EMAIL=admin@ohmyform.com     ADMIN_USERNAME=root     ADMIN_PASSWORD=root     NODE_ENV=production\n ---> Running in 5ec7927bde1b\nRemoving intermediate container 5ec7927bde1b\n ---> abdc50e05ea3\nStep 18/20 : EXPOSE 3000\n ---> Running in 361100e37af7\nRemoving intermediate container 361100e37af7\n ---> 102230faeaeb\nStep 19/20 : USER ohmyform\n ---> Running in 8d51209ed89c\nRemoving intermediate container 8d51209ed89c\n ---> b5cd123d0c55\nStep 20/20 : CMD [ \"yarn\", \"start:prod\" ]\n ---> Running in d7a1b15e5ec0\nRemoving intermediate container d7a1b15e5ec0\n ---> ab288bbf317b\nSuccessfully built ab288bbf317b\nSuccessfully tagged api:latest\n","stderr":"","imageSize":216066872},"endTime":1672711514796}