FROM mhart/alpine-node:4.5  
RUN apk --update add unzip curl  
  
USER root  
WORKDIR /root/  
  
WORKDIR /var/www/  
RUN mkdir -p ghost  
  
RUN curl -sSLO https://ghost.org/zip/ghost-0.9.0.zip && \  
unzip ./ghost-0.9.0.zip -d ghost && \  
rm ./ghost-0.9.0.zip  
  
RUN addgroup www-data  
RUN adduser ghost -G www-data -S /bin/bash  
RUN chown ghost:www-data .  
RUN chown ghost:www-data ghost  
RUN chown ghost:www-data -R ghost/*  
RUN npm install -g pm2  
  
USER ghost  
WORKDIR /var/www/ghost  
RUN npm install sqlite3  
RUN npm install  
  
EXPOSE 2368  
EXPOSE 2369  
RUN ls && pwd  
  
ENV NODE_ENV production  
  
RUN sed -e s/127.0.0.1/0.0.0.0/g ./config.example.js > ./config.js  
  
VOLUME ["/var/www/ghost/content/apps"]  
VOLUME ["/var/www/ghost/content/data"]  
VOLUME ["/var/www/ghost/content/images"]  
  
CMD ["pm2", "start", "index.js", "--name", "blog", "--no-daemon"]  

