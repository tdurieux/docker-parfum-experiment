FROM ansibleplaybookbundle/apb-base:galaxy  
  
LABEL "com.redhat.apb.spec"=\  
"dmVyc2lvbjogMS4wCm5hbWU6IGdhbGVyYS1hcGIKZGVzY3JpcHRpb246IERlcGxveSBHYWxlcmEg\  
d2l0aCBhIFJlcGxpY2F0aW9uIE9wZXJhdG9yCmJpbmRhYmxlOiBUcnVlCmFzeW5jOiBvcHRpb25h\  
bAptZXRhZGF0YToKICBkaXNwbGF5TmFtZTogZ2FsZXJhCnBsYW5zOgogIC0gbmFtZTogZXBoZW1l\  
cmFsCiAgICBkZXNjcmlwdGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYW4gZXBoZW1lcmFsIEdhbGVy\  
YSBjbHVzdGVyIG9uIExpbnV4CiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToge30KICAgIHBh\  
cmFtZXRlcnM6CiAgICAgIC0gbmFtZTogYWRtaW5fdXNlcgogICAgICAgIHRpdGxlOiBPcGVuc2hp\  
ZnQgQWRtaW4gVXNlcgogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IGRldmVs\  
b3BlcgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gbmFtZTogYWRtaW5fcGFzc3dvcmQK\  
ICAgICAgICB0aXRsZTogT3BlbnNoaWZ0IEFkbWluIFBhc3N3b3JkCiAgICAgICAgdHlwZTogc3Ry\  
aW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAgIGRlZmF1bHQ6IHBhc3N3\  
b3JkCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSBuYW1lOiBzZXJ2aWNlX25hbWUKICAg\  
ICAgICBkZXNjcmlwdGlvbjogVGhlIG5hbWUgb2YgdGhlIHNlcnZpY2UuIFVzZWQgdG8gbmFtZSBh\  
bmQgbGFiZWwgcmVzb3VyY2VzCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVmYXVsdDog\  
Z2FsZXJhCiAgICAgICAgcGF0dGVybjogIl5bYS16QS1aMC05XStbYS16QS1aMC05LV0qW2EtekEt\  
WjAtOV0rJCIKICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIG5hbWU6IHNlcnZpY2VfcmVw\  
bGljYXMKICAgICAgICB0aXRsZTogTnVtYmVyIG9mIGRhdGFiYXNlIHJlcGxpY2FzCiAgICAgICAg\  
dHlwZTogbnVtYmVyCiAgICAgICAgZGVmYXVsdDogMwogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\  
ICAgIC0gbmFtZTogbXlzcWxfZGF0YWJhc2UKICAgICAgICBkZXNjcmlwdGlvbjogVGhlIG5hbWUg\  
b2YgdGhlIE15U1FMIGRhdGFiYXNlCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVmYXVs\  
dDogc2FtcGxlCiAgICAgICAgcGF0dGVybjogIl5bYS16QS1aMC05X10qW2EtekEtWl9dK1thLXpB\  
LVowLTlfXSokIgogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIC0gbmFtZTogbXlzcWxfdXNl\  
cgogICAgICAgIGRlc2NyaXB0aW9uOiBVc2VybmFtZSB0aGF0IHdpbGwgYmUgdXNlZCB0byBjb25u\  
ZWN0IHRvIE15U1FMCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcGF0dGVybjogIl5bYS16\  
QS1aMC05X10qW2EtekEtWl9dK1thLXpBLVowLTlfXSokIgogICAgICAgIGRlZmF1bHQ6IGFkbWlu\  
CiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSBuYW1lOiBteXNxbF9wYXNzd29yZAogICAg\  
ICAgIGRlc2NyaXB0aW9uOiBQYXNzd29yZCB0byBjb25uZWN0IHRvIE15U1FMIChnZW5lcmF0ZWQg\  
aWYgYmxhbmspCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAg\  
ICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgICAgZGVmYXVsdDogYWRtaW4KICAtIG5h\  
bWU6IHBlcnNpc3RlbnQKICAgIGRlc2NyaXB0aW9uOiBUaGlzIHBsYW4gZGVwbG95cyBhIHBlcnNp\  
c3RlbnQgR2FsZXJhIGNsdXN0ZXIgb24gTGludXgKICAgIGZyZWU6IFRydWUKICAgIG1ldGFkYXRh\  
OiB7fQogICAgcGFyYW1ldGVyczoKICAgICAgLSBuYW1lOiBhZG1pbl91c2VyCiAgICAgICAgdGl0\  
bGU6IE9wZW5zaGlmdCBBZG1pbiBVc2VyCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGVm\  
YXVsdDogZGV2ZWxvcGVyCiAgICAgICAgI3JlcXVpcmVkOiB0cnVlCiAgICAgIC0gbmFtZTogYWRt\  
aW5fcGFzc3dvcmQKICAgICAgICB0aXRsZTogT3BlbnNoaWZ0IEFkbWluIFBhc3N3b3JkCiAgICAg\  
ICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAgIGRl\  
ZmF1bHQ6IHBhc3N3b3JkCiAgICAgIC0gbmFtZTogc2VydmljZV9uYW1lCiAgICAgICAgZGVzY3Jp\  
cHRpb246IFRoZSBuYW1lIG9mIHRoZSBzZXJ2aWNlLiBVc2VkIHRvIG5hbWUgYW5kIGxhYmVsIHJl\  
c291cmNlcwogICAgICAgIHR5cGU6IHN0cmluZwogICAgICAgIGRlZmF1bHQ6IGdhbGVyYQogICAg\  
ICAgIHBhdHRlcm46ICJeW2EtekEtWjAtOV0rW2EtekEtWjAtOS1dKlthLXpBLVowLTldKyQiCiAg\  
ICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgLSBuYW1lOiBzZXJ2aWNlX3JlcGxpY2FzCiAgICAg\  
ICAgdGl0bGU6IE51bWJlciBvZiBkYXRhYmFzZSByZXBsaWNhcwogICAgICAgIHR5cGU6IG51bWJl\  
cgogICAgICAgIGRlZmF1bHQ6IDMKICAgICAgLSBuYW1lOiBteXNxbF9kYXRhYmFzZQogICAgICAg\  
IGRlc2NyaXB0aW9uOiBUaGUgbmFtZSBvZiB0aGUgTXlTUUwgZGF0YWJhc2UKICAgICAgICB0eXBl\  
OiBzdHJpbmcKICAgICAgICBkZWZhdWx0OiBzYW1wbGUKICAgICAgICBwYXR0ZXJuOiAiXlthLXpB\  
LVowLTlfXSpbYS16QS1aX10rW2EtekEtWjAtOV9dKiQiCiAgICAgICAgcmVxdWlyZWQ6IHRydWUK\  
ICAgICAgLSBuYW1lOiBteXNxbF91c2VyCiAgICAgICAgZGVzY3JpcHRpb246IFVzZXJuYW1lIHRo\  
YXQgd2lsbCBiZSB1c2VkIHRvIGNvbm5lY3QgdG8gTXlTUUwKICAgICAgICB0eXBlOiBzdHJpbmcK\  
ICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfXSpbYS16QS1aX10rW2EtekEtWjAtOV9dKiQi\  
CiAgICAgICAgZGVmYXVsdDogYWRtaW4KICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAtIG5h\  
bWU6IG15c3FsX3Bhc3N3b3JkCiAgICAgICAgZGVzY3JpcHRpb246IFBhc3N3b3JkIHRvIGNvbm5l\  
Y3QgdG8gTXlTUUwgKGdlbmVyYXRlZCBpZiBibGFuaykKICAgICAgICB0eXBlOiBzdHJpbmcKICAg\  
ICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRpc3BsYXlfdHlwZTogcGFzc3dvcmQKICAgICAg\  
ICBkZWZhdWx0OiBhZG1pbgogICAgICAtIG5hbWU6IHZvbHVtZV9zaXplCiAgICAgICAgdHlwZTog\  
ZW51bQogICAgICAgIGRlZmF1bHQ6ICcxR2knCiAgICAgICAgZW51bTogWycxR2knLCAnNUdpJywg\  
JzEwR2knXQogICAgICAgIHRpdGxlOiBNeVNRTCBWb2x1bWUgU2l6ZQogICAgICAgIHJlcXVpcmVk\  
OiB0cnVlCg=="  
  
  
#RUN yum install -y iptables && yum clean all  
  
ENV APB_ACTION_PATH="galera-ansible/playbooks/main.yml"  
COPY requirements.yml /opt/ansible/requirements.yml  
COPY inventory /etc/ansible/hosts  
  
RUN ansible-galaxy -vv install -r /opt/ansible/requirements.yml  
RUN chmod -R g=u /opt/{ansible,apb} /etc/ansible/roles  
  
USER apb  
  
  

