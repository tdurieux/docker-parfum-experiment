
FROM openjdk:8-jre

COPY bin/anonymize /opt/anon/bin/anonymize

COPY bin/uber-anonService-1.0-SNAPSHOT.jar /opt/anon/bin/uber-anonService-1.0-SNAPSHOT.jar

RUN ln -s /opt/anon/bin/anonymize /usr/local/bin/anonymize

LABEL org.nrg.commands="[{\"name\": \"anon-on-demand\", \"description\": \"Run anonymize script on demand\", \"schema-version\": \"1.0\", \"version\": \"1.2\", \"info-url\": \"\", \"type\": \"docker\", \"image\": \"dmaffitt/anon:0.2\", \"command-line\": \"anonymize /script /dicom-in/#dicomFileIn# /dicom-out\", \"mounts\": [{\"name\": \"anonScript-in\", \"writable\": \"false\", \"path\": \"/script\"}, {\"name\": \"dicom-in\", \"writable\": \"false\", \"path\": \"/dicom-in\"}, {\"name\": \"dicom-out\", \"path\": \"/dicom-out\"}], \"inputs\": [], \"outputs\": [{\"name\": \"dicomFileOut\", \"description\": \"The anonymized dicom output\", \"mount\": \"dicom-out\"}], \"xnat\": [{\"name\": \"anon-session\", \"description\": \"Run anon-on-demand on a session, which must have the anon script in a resource.\", \"contexts\": [\"xnat:imageSessionData\"], \"external-inputs\": [{\"name\": \"session\", \"description\": \"the parent session\", \"type\": \"Session\", \"required\": true}], \"derived-inputs\": [{\"name\": \"anonScript\", \"description\": \"the anonScript\", \"type\": \"Resource\", \"required\": true, \"derived-from-wrapper-input\": \"session\", \"provides-files-for-command-mount\": \"anonScript-in\"}, {\"name\": \"scan\", \"description\": \"the scan\", \"type\": \"Scan\", \"required\": true, \"derived-from-wrapper-input\": \"session\"}, {\"name\": \"dicomScanResource\", \"description\": \"the dicom input\", \"type\": \"Resource\", \"required\": true, \"derived-from-wrapper-input\": \"scan\", \"matcher\": \"@.label == 'DICOM'\"}, {\"name\": \"dicomFileIn\", \"description\": \"the dicom input\", \"type\": \"File\", \"required\": true, \"derived-from-wrapper-input\": \"dicomScanResource\", \"provides-files-for-command-mount\": \"dicom-in\"}], \"output-handlers\": [{\"name\": \"anonResource\", \"type\": \"Resource\", \"label\": \"DICOM_ANON\", \"accepts-command-output\": \"dicomFileOut\", \"as-a-child-of-wrapper-input\": \"scan\"}]}]}]"
